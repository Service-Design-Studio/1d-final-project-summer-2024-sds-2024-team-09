<% content_for :title, "Video History" %>
<div class="text-center">
    <h1 class="display-4">Video History</h1>
    <ul class="list-group mt-4">
        <% @videos.each do |video| %>
            <li class="list-group-item">
                <h2>
                    <a href="#" class="video-title" data-target="video-<%= video.id %>">
                        <%= video.title %>
                    </a>
                    <button class="btn btn-sm btn-secondary ml-2 edit-btn" data-id="<%= video.id %>">Edit</button>
                </h2>
                <p>Uploaded on: <%= video.upload_date.strftime('%B %d, %Y %I:%M %p') %></p>
                <div id="video-<%= video.id %>" class="video-container" style="display: none;">
                    <video width="320" height="240" controls>
                        <source src="<%= video.url %>" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>
                <div id="edit-form-<%= video.id %>" class="edit-form" style="display: none;">
                    <%= form_with model: video, url: video_path(video), method: :put, local: true do |form| %>
                        <div class="form-group">
                            <%= form.label :title %>
                            <%= form.text_field :title, class: "form-control" %>
                        </div>
                        <%= form.submit "Save", class: "btn btn-primary" %>
                    <% end %>
                </div>
            </li>
        <% end %>
    </ul>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const titles = document.querySelectorAll(".video-title");
        const editButtons = document.querySelectorAll(".edit-btn");

        titles.forEach(title => {
            title.addEventListener("click", function(event) {
                event.preventDefault();
                const targetId = this.getAttribute("data-target");
                const videoContainer = document.getElementById(targetId);
                if (videoContainer.style.display === "none") {
                    videoContainer.style.display = "block";
                } else {
                    videoContainer.style.display = "none";
                }
            });
        });

        editButtons.forEach(button => {
            button.addEventListener("click", function(event) {
                event.stopPropagation(); // Prevent the click event from bubbling up to the video title link
                const videoId = this.getAttribute("data-id");
                const editForm = document.getElementById(`edit-form-${videoId}`);
                if (editForm.style.display === "none") {
                    editForm.style.display = "block";
                } else {
                    editForm.style.display = "none";
                }
            });
        });
    });
</script>
