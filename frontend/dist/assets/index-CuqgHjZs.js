function sQ(o,s){for(var l=0;l<s.length;l++){const h=s[l];if(typeof h!="string"&&!Array.isArray(h)){for(const _ in h)if(_!=="default"&&!(_ in o)){const g=Object.getOwnPropertyDescriptor(h,_);g&&Object.defineProperty(o,_,g.get?g:{enumerable:!0,get:()=>h[_]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))h(_);new MutationObserver(_=>{for(const g of _)if(g.type==="childList")for(const C of g.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&h(C)}).observe(document,{childList:!0,subtree:!0});function l(_){const g={};return _.integrity&&(g.integrity=_.integrity),_.referrerPolicy&&(g.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?g.credentials="include":_.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function h(_){if(_.ep)return;_.ep=!0;const g=l(_);fetch(_.href,g)}})();var C_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xR(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function aQ(o){if(o.__esModule)return o;var s=o.default;if(typeof s=="function"){var l=function h(){return this instanceof h?Reflect.construct(s,arguments,this.constructor):s.apply(this,arguments)};l.prototype=s.prototype}else l={};return Object.defineProperty(l,"__esModule",{value:!0}),Object.keys(o).forEach(function(h){var _=Object.getOwnPropertyDescriptor(o,h);Object.defineProperty(l,h,_.get?_:{enumerable:!0,get:function(){return o[h]}})}),l}var nV={exports:{}},VE={},rV={exports:{}},Lt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mp=Symbol.for("react.element"),cQ=Symbol.for("react.portal"),dQ=Symbol.for("react.fragment"),lQ=Symbol.for("react.strict_mode"),uQ=Symbol.for("react.profiler"),hQ=Symbol.for("react.provider"),pQ=Symbol.for("react.context"),fQ=Symbol.for("react.forward_ref"),mQ=Symbol.for("react.suspense"),_Q=Symbol.for("react.memo"),EQ=Symbol.for("react.lazy"),mx=Symbol.iterator;function gQ(o){return o===null||typeof o!="object"?null:(o=mx&&o[mx]||o["@@iterator"],typeof o=="function"?o:null)}var iV={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},oV=Object.assign,sV={};function cu(o,s,l){this.props=o,this.context=s,this.refs=sV,this.updater=l||iV}cu.prototype.isReactComponent={};cu.prototype.setState=function(o,s){if(typeof o!="object"&&typeof o!="function"&&o!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,o,s,"setState")};cu.prototype.forceUpdate=function(o){this.updater.enqueueForceUpdate(this,o,"forceUpdate")};function aV(){}aV.prototype=cu.prototype;function UR(o,s,l){this.props=o,this.context=s,this.refs=sV,this.updater=l||iV}var VR=UR.prototype=new aV;VR.constructor=UR;oV(VR,cu.prototype);VR.isPureReactComponent=!0;var _x=Array.isArray,cV=Object.prototype.hasOwnProperty,jR={current:null},dV={key:!0,ref:!0,__self:!0,__source:!0};function lV(o,s,l){var h,_={},g=null,C=null;if(s!=null)for(h in s.ref!==void 0&&(C=s.ref),s.key!==void 0&&(g=""+s.key),s)cV.call(s,h)&&!dV.hasOwnProperty(h)&&(_[h]=s[h]);var b=arguments.length-2;if(b===1)_.children=l;else if(1<b){for(var D=Array(b),M=0;M<b;M++)D[M]=arguments[M+2];_.children=D}if(o&&o.defaultProps)for(h in b=o.defaultProps,b)_[h]===void 0&&(_[h]=b[h]);return{$$typeof:Mp,type:o,key:g,ref:C,props:_,_owner:jR.current}}function SQ(o,s){return{$$typeof:Mp,type:o.type,key:s,ref:o.ref,props:o.props,_owner:o._owner}}function FR(o){return typeof o=="object"&&o!==null&&o.$$typeof===Mp}function TQ(o){var s={"=":"=0",":":"=2"};return"$"+o.replace(/[=:]/g,function(l){return s[l]})}var Ex=/\/+/g;function Zy(o,s){return typeof o=="object"&&o!==null&&o.key!=null?TQ(""+o.key):s.toString(36)}function W_(o,s,l,h,_){var g=typeof o;(g==="undefined"||g==="boolean")&&(o=null);var C=!1;if(o===null)C=!0;else switch(g){case"string":case"number":C=!0;break;case"object":switch(o.$$typeof){case Mp:case cQ:C=!0}}if(C)return C=o,_=_(C),o=h===""?"."+Zy(C,0):h,_x(_)?(l="",o!=null&&(l=o.replace(Ex,"$&/")+"/"),W_(_,s,l,"",function(M){return M})):_!=null&&(FR(_)&&(_=SQ(_,l+(!_.key||C&&C.key===_.key?"":(""+_.key).replace(Ex,"$&/")+"/")+o)),s.push(_)),1;if(C=0,h=h===""?".":h+":",_x(o))for(var b=0;b<o.length;b++){g=o[b];var D=h+Zy(g,b);C+=W_(g,s,l,D,_)}else if(D=gQ(o),typeof D=="function")for(o=D.call(o),b=0;!(g=o.next()).done;)g=g.value,D=h+Zy(g,b++),C+=W_(g,s,l,D,_);else if(g==="object")throw s=String(o),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return C}function R_(o,s,l){if(o==null)return o;var h=[],_=0;return W_(o,h,"","",function(g){return s.call(l,g,_++)}),h}function vQ(o){if(o._status===-1){var s=o._result;s=s(),s.then(function(l){(o._status===0||o._status===-1)&&(o._status=1,o._result=l)},function(l){(o._status===0||o._status===-1)&&(o._status=2,o._result=l)}),o._status===-1&&(o._status=0,o._result=s)}if(o._status===1)return o._result.default;throw o._result}var Zr={current:null},H_={transition:null},yQ={ReactCurrentDispatcher:Zr,ReactCurrentBatchConfig:H_,ReactCurrentOwner:jR};function uV(){throw Error("act(...) is not supported in production builds of React.")}Lt.Children={map:R_,forEach:function(o,s,l){R_(o,function(){s.apply(this,arguments)},l)},count:function(o){var s=0;return R_(o,function(){s++}),s},toArray:function(o){return R_(o,function(s){return s})||[]},only:function(o){if(!FR(o))throw Error("React.Children.only expected to receive a single React element child.");return o}};Lt.Component=cu;Lt.Fragment=dQ;Lt.Profiler=uQ;Lt.PureComponent=UR;Lt.StrictMode=lQ;Lt.Suspense=mQ;Lt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yQ;Lt.act=uV;Lt.cloneElement=function(o,s,l){if(o==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+o+".");var h=oV({},o.props),_=o.key,g=o.ref,C=o._owner;if(s!=null){if(s.ref!==void 0&&(g=s.ref,C=jR.current),s.key!==void 0&&(_=""+s.key),o.type&&o.type.defaultProps)var b=o.type.defaultProps;for(D in s)cV.call(s,D)&&!dV.hasOwnProperty(D)&&(h[D]=s[D]===void 0&&b!==void 0?b[D]:s[D])}var D=arguments.length-2;if(D===1)h.children=l;else if(1<D){b=Array(D);for(var M=0;M<D;M++)b[M]=arguments[M+2];h.children=b}return{$$typeof:Mp,type:o.type,key:_,ref:g,props:h,_owner:C}};Lt.createContext=function(o){return o={$$typeof:pQ,_currentValue:o,_currentValue2:o,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},o.Provider={$$typeof:hQ,_context:o},o.Consumer=o};Lt.createElement=lV;Lt.createFactory=function(o){var s=lV.bind(null,o);return s.type=o,s};Lt.createRef=function(){return{current:null}};Lt.forwardRef=function(o){return{$$typeof:fQ,render:o}};Lt.isValidElement=FR;Lt.lazy=function(o){return{$$typeof:EQ,_payload:{_status:-1,_result:o},_init:vQ}};Lt.memo=function(o,s){return{$$typeof:_Q,type:o,compare:s===void 0?null:s}};Lt.startTransition=function(o){var s=H_.transition;H_.transition={};try{o()}finally{H_.transition=s}};Lt.unstable_act=uV;Lt.useCallback=function(o,s){return Zr.current.useCallback(o,s)};Lt.useContext=function(o){return Zr.current.useContext(o)};Lt.useDebugValue=function(){};Lt.useDeferredValue=function(o){return Zr.current.useDeferredValue(o)};Lt.useEffect=function(o,s){return Zr.current.useEffect(o,s)};Lt.useId=function(){return Zr.current.useId()};Lt.useImperativeHandle=function(o,s,l){return Zr.current.useImperativeHandle(o,s,l)};Lt.useInsertionEffect=function(o,s){return Zr.current.useInsertionEffect(o,s)};Lt.useLayoutEffect=function(o,s){return Zr.current.useLayoutEffect(o,s)};Lt.useMemo=function(o,s){return Zr.current.useMemo(o,s)};Lt.useReducer=function(o,s,l){return Zr.current.useReducer(o,s,l)};Lt.useRef=function(o){return Zr.current.useRef(o)};Lt.useState=function(o){return Zr.current.useState(o)};Lt.useSyncExternalStore=function(o,s,l){return Zr.current.useSyncExternalStore(o,s,l)};Lt.useTransition=function(){return Zr.current.useTransition()};Lt.version="18.3.1";rV.exports=Lt;var we=rV.exports;const Ys=xR(we),CQ=sQ({__proto__:null,default:Ys},[we]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RQ=we,wQ=Symbol.for("react.element"),IQ=Symbol.for("react.fragment"),AQ=Object.prototype.hasOwnProperty,bQ=RQ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,OQ={key:!0,ref:!0,__self:!0,__source:!0};function hV(o,s,l){var h,_={},g=null,C=null;l!==void 0&&(g=""+l),s.key!==void 0&&(g=""+s.key),s.ref!==void 0&&(C=s.ref);for(h in s)AQ.call(s,h)&&!OQ.hasOwnProperty(h)&&(_[h]=s[h]);if(o&&o.defaultProps)for(h in s=o.defaultProps,s)_[h]===void 0&&(_[h]=s[h]);return{$$typeof:wQ,type:o,key:g,ref:C,props:_,_owner:bQ.current}}VE.Fragment=IQ;VE.jsx=hV;VE.jsxs=hV;nV.exports=VE;var L=nV.exports,pV={exports:{}},Vi={},fV={exports:{}},mV={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(o){function s(Ee,De){var Ke=Ee.length;Ee.push(De);e:for(;0<Ke;){var _t=Ke-1>>>1,nn=Ee[_t];if(0<_(nn,De))Ee[_t]=De,Ee[Ke]=nn,Ke=_t;else break e}}function l(Ee){return Ee.length===0?null:Ee[0]}function h(Ee){if(Ee.length===0)return null;var De=Ee[0],Ke=Ee.pop();if(Ke!==De){Ee[0]=Ke;e:for(var _t=0,nn=Ee.length,ei=nn>>>1;_t<ei;){var Yn=2*(_t+1)-1,Xo=Ee[Yn],ur=Yn+1,ea=Ee[ur];if(0>_(Xo,Ke))ur<nn&&0>_(ea,Xo)?(Ee[_t]=ea,Ee[ur]=Ke,_t=ur):(Ee[_t]=Xo,Ee[Yn]=Ke,_t=Yn);else if(ur<nn&&0>_(ea,Ke))Ee[_t]=ea,Ee[ur]=Ke,_t=ur;else break e}}return De}function _(Ee,De){var Ke=Ee.sortIndex-De.sortIndex;return Ke!==0?Ke:Ee.id-De.id}if(typeof performance=="object"&&typeof performance.now=="function"){var g=performance;o.unstable_now=function(){return g.now()}}else{var C=Date,b=C.now();o.unstable_now=function(){return C.now()-b}}var D=[],M=[],j=1,x=null,W=3,te=!1,X=!1,ie=!1,ve=typeof setTimeout=="function"?setTimeout:null,K=typeof clearTimeout=="function"?clearTimeout:null,H=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Y(Ee){for(var De=l(M);De!==null;){if(De.callback===null)h(M);else if(De.startTime<=Ee)h(M),De.sortIndex=De.expirationTime,s(D,De);else break;De=l(M)}}function pe(Ee){if(ie=!1,Y(Ee),!X)if(l(D)!==null)X=!0,Dt(Ne);else{var De=l(M);De!==null&&he(pe,De.startTime-Ee)}}function Ne(Ee,De){X=!1,ie&&(ie=!1,K(He),He=-1),te=!0;var Ke=W;try{for(Y(De),x=l(D);x!==null&&(!(x.expirationTime>De)||Ee&&!vr());){var _t=x.callback;if(typeof _t=="function"){x.callback=null,W=x.priorityLevel;var nn=_t(x.expirationTime<=De);De=o.unstable_now(),typeof nn=="function"?x.callback=nn:x===l(D)&&h(D),Y(De)}else h(D);x=l(D)}if(x!==null)var ei=!0;else{var Yn=l(M);Yn!==null&&he(pe,Yn.startTime-De),ei=!1}return ei}finally{x=null,W=Ke,te=!1}}var ke=!1,Pe=null,He=-1,mn=5,mt=-1;function vr(){return!(o.unstable_now()-mt<mn)}function Gr(){if(Pe!==null){var Ee=o.unstable_now();mt=Ee;var De=!0;try{De=Pe(!0,Ee)}finally{De?So():(ke=!1,Pe=null)}}else ke=!1}var So;if(typeof H=="function")So=function(){H(Gr)};else if(typeof MessageChannel<"u"){var Ve=new MessageChannel,nt=Ve.port2;Ve.port1.onmessage=Gr,So=function(){nt.postMessage(null)}}else So=function(){ve(Gr,0)};function Dt(Ee){Pe=Ee,ke||(ke=!0,So())}function he(Ee,De){He=ve(function(){Ee(o.unstable_now())},De)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(Ee){Ee.callback=null},o.unstable_continueExecution=function(){X||te||(X=!0,Dt(Ne))},o.unstable_forceFrameRate=function(Ee){0>Ee||125<Ee?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):mn=0<Ee?Math.floor(1e3/Ee):5},o.unstable_getCurrentPriorityLevel=function(){return W},o.unstable_getFirstCallbackNode=function(){return l(D)},o.unstable_next=function(Ee){switch(W){case 1:case 2:case 3:var De=3;break;default:De=W}var Ke=W;W=De;try{return Ee()}finally{W=Ke}},o.unstable_pauseExecution=function(){},o.unstable_requestPaint=function(){},o.unstable_runWithPriority=function(Ee,De){switch(Ee){case 1:case 2:case 3:case 4:case 5:break;default:Ee=3}var Ke=W;W=Ee;try{return De()}finally{W=Ke}},o.unstable_scheduleCallback=function(Ee,De,Ke){var _t=o.unstable_now();switch(typeof Ke=="object"&&Ke!==null?(Ke=Ke.delay,Ke=typeof Ke=="number"&&0<Ke?_t+Ke:_t):Ke=_t,Ee){case 1:var nn=-1;break;case 2:nn=250;break;case 5:nn=1073741823;break;case 4:nn=1e4;break;default:nn=5e3}return nn=Ke+nn,Ee={id:j++,callback:De,priorityLevel:Ee,startTime:Ke,expirationTime:nn,sortIndex:-1},Ke>_t?(Ee.sortIndex=Ke,s(M,Ee),l(D)===null&&Ee===l(M)&&(ie?(K(He),He=-1):ie=!0,he(pe,Ke-_t))):(Ee.sortIndex=nn,s(D,Ee),X||te||(X=!0,Dt(Ne))),Ee},o.unstable_shouldYield=vr,o.unstable_wrapCallback=function(Ee){var De=W;return function(){var Ke=W;W=De;try{return Ee.apply(this,arguments)}finally{W=Ke}}}})(mV);fV.exports=mV;var NQ=fV.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DQ=we,Ui=NQ;function Ie(o){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+o,l=1;l<arguments.length;l++)s+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+o+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var _V=new Set,pp={};function fd(o,s){eu(o,s),eu(o+"Capture",s)}function eu(o,s){for(pp[o]=s,o=0;o<s.length;o++)_V.add(s[o])}var Js=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),OC=Object.prototype.hasOwnProperty,PQ=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,gx={},Sx={};function LQ(o){return OC.call(Sx,o)?!0:OC.call(gx,o)?!1:PQ.test(o)?Sx[o]=!0:(gx[o]=!0,!1)}function kQ(o,s,l,h){if(l!==null&&l.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return h?!1:l!==null?!l.acceptsBooleans:(o=o.toLowerCase().slice(0,5),o!=="data-"&&o!=="aria-");default:return!1}}function MQ(o,s,l,h){if(s===null||typeof s>"u"||kQ(o,s,l,h))return!0;if(h)return!1;if(l!==null)switch(l.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function $r(o,s,l,h,_,g,C){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=h,this.attributeNamespace=_,this.mustUseProperty=l,this.propertyName=o,this.type=s,this.sanitizeURL=g,this.removeEmptyString=C}var br={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(o){br[o]=new $r(o,0,!1,o,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(o){var s=o[0];br[s]=new $r(s,1,!1,o[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(o){br[o]=new $r(o,2,!1,o.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(o){br[o]=new $r(o,2,!1,o,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(o){br[o]=new $r(o,3,!1,o.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(o){br[o]=new $r(o,3,!0,o,null,!1,!1)});["capture","download"].forEach(function(o){br[o]=new $r(o,4,!1,o,null,!1,!1)});["cols","rows","size","span"].forEach(function(o){br[o]=new $r(o,6,!1,o,null,!1,!1)});["rowSpan","start"].forEach(function(o){br[o]=new $r(o,5,!1,o.toLowerCase(),null,!1,!1)});var BR=/[\-:]([a-z])/g;function GR(o){return o[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(o){var s=o.replace(BR,GR);br[s]=new $r(s,1,!1,o,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(o){var s=o.replace(BR,GR);br[s]=new $r(s,1,!1,o,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(o){var s=o.replace(BR,GR);br[s]=new $r(s,1,!1,o,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(o){br[o]=new $r(o,1,!1,o.toLowerCase(),null,!1,!1)});br.xlinkHref=new $r("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(o){br[o]=new $r(o,1,!1,o.toLowerCase(),null,!0,!0)});function WR(o,s,l,h){var _=br.hasOwnProperty(s)?br[s]:null;(_!==null?_.type!==0:h||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(MQ(s,l,_,h)&&(l=null),h||_===null?LQ(s)&&(l===null?o.removeAttribute(s):o.setAttribute(s,""+l)):_.mustUseProperty?o[_.propertyName]=l===null?_.type===3?!1:"":l:(s=_.attributeName,h=_.attributeNamespace,l===null?o.removeAttribute(s):(_=_.type,l=_===3||_===4&&l===!0?"":""+l,h?o.setAttributeNS(h,s,l):o.setAttribute(s,l))))}var $s=DQ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w_=Symbol.for("react.element"),kl=Symbol.for("react.portal"),Ml=Symbol.for("react.fragment"),HR=Symbol.for("react.strict_mode"),NC=Symbol.for("react.profiler"),EV=Symbol.for("react.provider"),gV=Symbol.for("react.context"),KR=Symbol.for("react.forward_ref"),DC=Symbol.for("react.suspense"),PC=Symbol.for("react.suspense_list"),zR=Symbol.for("react.memo"),Ba=Symbol.for("react.lazy"),SV=Symbol.for("react.offscreen"),Tx=Symbol.iterator;function Bh(o){return o===null||typeof o!="object"?null:(o=Tx&&o[Tx]||o["@@iterator"],typeof o=="function"?o:null)}var Fn=Object.assign,$y;function Xh(o){if($y===void 0)try{throw Error()}catch(l){var s=l.stack.trim().match(/\n( *(at )?)/);$y=s&&s[1]||""}return`
`+$y+o}var eC=!1;function tC(o,s){if(!o||eC)return"";eC=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(M){var h=M}Reflect.construct(o,[],s)}else{try{s.call()}catch(M){h=M}o.call(s.prototype)}else{try{throw Error()}catch(M){h=M}o()}}catch(M){if(M&&h&&typeof M.stack=="string"){for(var _=M.stack.split(`
`),g=h.stack.split(`
`),C=_.length-1,b=g.length-1;1<=C&&0<=b&&_[C]!==g[b];)b--;for(;1<=C&&0<=b;C--,b--)if(_[C]!==g[b]){if(C!==1||b!==1)do if(C--,b--,0>b||_[C]!==g[b]){var D=`
`+_[C].replace(" at new "," at ");return o.displayName&&D.includes("<anonymous>")&&(D=D.replace("<anonymous>",o.displayName)),D}while(1<=C&&0<=b);break}}}finally{eC=!1,Error.prepareStackTrace=l}return(o=o?o.displayName||o.name:"")?Xh(o):""}function xQ(o){switch(o.tag){case 5:return Xh(o.type);case 16:return Xh("Lazy");case 13:return Xh("Suspense");case 19:return Xh("SuspenseList");case 0:case 2:case 15:return o=tC(o.type,!1),o;case 11:return o=tC(o.type.render,!1),o;case 1:return o=tC(o.type,!0),o;default:return""}}function LC(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case Ml:return"Fragment";case kl:return"Portal";case NC:return"Profiler";case HR:return"StrictMode";case DC:return"Suspense";case PC:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case gV:return(o.displayName||"Context")+".Consumer";case EV:return(o._context.displayName||"Context")+".Provider";case KR:var s=o.render;return o=o.displayName,o||(o=s.displayName||s.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case zR:return s=o.displayName||null,s!==null?s:LC(o.type)||"Memo";case Ba:s=o._payload,o=o._init;try{return LC(o(s))}catch{}}return null}function UQ(o){var s=o.type;switch(o.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=s.render,o=o.displayName||o.name||"",s.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return LC(s);case 8:return s===HR?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function ic(o){switch(typeof o){case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function TV(o){var s=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function VQ(o){var s=TV(o)?"checked":"value",l=Object.getOwnPropertyDescriptor(o.constructor.prototype,s),h=""+o[s];if(!o.hasOwnProperty(s)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var _=l.get,g=l.set;return Object.defineProperty(o,s,{configurable:!0,get:function(){return _.call(this)},set:function(C){h=""+C,g.call(this,C)}}),Object.defineProperty(o,s,{enumerable:l.enumerable}),{getValue:function(){return h},setValue:function(C){h=""+C},stopTracking:function(){o._valueTracker=null,delete o[s]}}}}function I_(o){o._valueTracker||(o._valueTracker=VQ(o))}function vV(o){if(!o)return!1;var s=o._valueTracker;if(!s)return!0;var l=s.getValue(),h="";return o&&(h=TV(o)?o.checked?"true":"false":o.value),o=h,o!==l?(s.setValue(o),!0):!1}function oE(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}function kC(o,s){var l=s.checked;return Fn({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??o._wrapperState.initialChecked})}function vx(o,s){var l=s.defaultValue==null?"":s.defaultValue,h=s.checked!=null?s.checked:s.defaultChecked;l=ic(s.value!=null?s.value:l),o._wrapperState={initialChecked:h,initialValue:l,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function yV(o,s){s=s.checked,s!=null&&WR(o,"checked",s,!1)}function MC(o,s){yV(o,s);var l=ic(s.value),h=s.type;if(l!=null)h==="number"?(l===0&&o.value===""||o.value!=l)&&(o.value=""+l):o.value!==""+l&&(o.value=""+l);else if(h==="submit"||h==="reset"){o.removeAttribute("value");return}s.hasOwnProperty("value")?xC(o,s.type,l):s.hasOwnProperty("defaultValue")&&xC(o,s.type,ic(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(o.defaultChecked=!!s.defaultChecked)}function yx(o,s,l){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var h=s.type;if(!(h!=="submit"&&h!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+o._wrapperState.initialValue,l||s===o.value||(o.value=s),o.defaultValue=s}l=o.name,l!==""&&(o.name=""),o.defaultChecked=!!o._wrapperState.initialChecked,l!==""&&(o.name=l)}function xC(o,s,l){(s!=="number"||oE(o.ownerDocument)!==o)&&(l==null?o.defaultValue=""+o._wrapperState.initialValue:o.defaultValue!==""+l&&(o.defaultValue=""+l))}var Qh=Array.isArray;function ql(o,s,l,h){if(o=o.options,s){s={};for(var _=0;_<l.length;_++)s["$"+l[_]]=!0;for(l=0;l<o.length;l++)_=s.hasOwnProperty("$"+o[l].value),o[l].selected!==_&&(o[l].selected=_),_&&h&&(o[l].defaultSelected=!0)}else{for(l=""+ic(l),s=null,_=0;_<o.length;_++){if(o[_].value===l){o[_].selected=!0,h&&(o[_].defaultSelected=!0);return}s!==null||o[_].disabled||(s=o[_])}s!==null&&(s.selected=!0)}}function UC(o,s){if(s.dangerouslySetInnerHTML!=null)throw Error(Ie(91));return Fn({},s,{value:void 0,defaultValue:void 0,children:""+o._wrapperState.initialValue})}function Cx(o,s){var l=s.value;if(l==null){if(l=s.children,s=s.defaultValue,l!=null){if(s!=null)throw Error(Ie(92));if(Qh(l)){if(1<l.length)throw Error(Ie(93));l=l[0]}s=l}s==null&&(s=""),l=s}o._wrapperState={initialValue:ic(l)}}function CV(o,s){var l=ic(s.value),h=ic(s.defaultValue);l!=null&&(l=""+l,l!==o.value&&(o.value=l),s.defaultValue==null&&o.defaultValue!==l&&(o.defaultValue=l)),h!=null&&(o.defaultValue=""+h)}function Rx(o){var s=o.textContent;s===o._wrapperState.initialValue&&s!==""&&s!==null&&(o.value=s)}function RV(o){switch(o){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function VC(o,s){return o==null||o==="http://www.w3.org/1999/xhtml"?RV(s):o==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":o}var A_,wV=function(o){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,l,h,_){MSApp.execUnsafeLocalFunction(function(){return o(s,l,h,_)})}:o}(function(o,s){if(o.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in o)o.innerHTML=s;else{for(A_=A_||document.createElement("div"),A_.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=A_.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;s.firstChild;)o.appendChild(s.firstChild)}});function fp(o,s){if(s){var l=o.firstChild;if(l&&l===o.lastChild&&l.nodeType===3){l.nodeValue=s;return}}o.textContent=s}var np={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},jQ=["Webkit","ms","Moz","O"];Object.keys(np).forEach(function(o){jQ.forEach(function(s){s=s+o.charAt(0).toUpperCase()+o.substring(1),np[s]=np[o]})});function IV(o,s,l){return s==null||typeof s=="boolean"||s===""?"":l||typeof s!="number"||s===0||np.hasOwnProperty(o)&&np[o]?(""+s).trim():s+"px"}function AV(o,s){o=o.style;for(var l in s)if(s.hasOwnProperty(l)){var h=l.indexOf("--")===0,_=IV(l,s[l],h);l==="float"&&(l="cssFloat"),h?o.setProperty(l,_):o[l]=_}}var FQ=Fn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function jC(o,s){if(s){if(FQ[o]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(Ie(137,o));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(Ie(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(Ie(61))}if(s.style!=null&&typeof s.style!="object")throw Error(Ie(62))}}function FC(o,s){if(o.indexOf("-")===-1)return typeof s.is=="string";switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var BC=null;function YR(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var GC=null,Jl=null,Xl=null;function wx(o){if(o=Vp(o)){if(typeof GC!="function")throw Error(Ie(280));var s=o.stateNode;s&&(s=WE(s),GC(o.stateNode,o.type,s))}}function bV(o){Jl?Xl?Xl.push(o):Xl=[o]:Jl=o}function OV(){if(Jl){var o=Jl,s=Xl;if(Xl=Jl=null,wx(o),s)for(o=0;o<s.length;o++)wx(s[o])}}function NV(o,s){return o(s)}function DV(){}var nC=!1;function PV(o,s,l){if(nC)return o(s,l);nC=!0;try{return NV(o,s,l)}finally{nC=!1,(Jl!==null||Xl!==null)&&(DV(),OV())}}function mp(o,s){var l=o.stateNode;if(l===null)return null;var h=WE(l);if(h===null)return null;l=h[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(o=o.type,h=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!h;break e;default:o=!1}if(o)return null;if(l&&typeof l!="function")throw Error(Ie(231,s,typeof l));return l}var WC=!1;if(Js)try{var Gh={};Object.defineProperty(Gh,"passive",{get:function(){WC=!0}}),window.addEventListener("test",Gh,Gh),window.removeEventListener("test",Gh,Gh)}catch{WC=!1}function BQ(o,s,l,h,_,g,C,b,D){var M=Array.prototype.slice.call(arguments,3);try{s.apply(l,M)}catch(j){this.onError(j)}}var rp=!1,sE=null,aE=!1,HC=null,GQ={onError:function(o){rp=!0,sE=o}};function WQ(o,s,l,h,_,g,C,b,D){rp=!1,sE=null,BQ.apply(GQ,arguments)}function HQ(o,s,l,h,_,g,C,b,D){if(WQ.apply(this,arguments),rp){if(rp){var M=sE;rp=!1,sE=null}else throw Error(Ie(198));aE||(aE=!0,HC=M)}}function md(o){var s=o,l=o;if(o.alternate)for(;s.return;)s=s.return;else{o=s;do s=o,s.flags&4098&&(l=s.return),o=s.return;while(o)}return s.tag===3?l:null}function LV(o){if(o.tag===13){var s=o.memoizedState;if(s===null&&(o=o.alternate,o!==null&&(s=o.memoizedState)),s!==null)return s.dehydrated}return null}function Ix(o){if(md(o)!==o)throw Error(Ie(188))}function KQ(o){var s=o.alternate;if(!s){if(s=md(o),s===null)throw Error(Ie(188));return s!==o?null:o}for(var l=o,h=s;;){var _=l.return;if(_===null)break;var g=_.alternate;if(g===null){if(h=_.return,h!==null){l=h;continue}break}if(_.child===g.child){for(g=_.child;g;){if(g===l)return Ix(_),o;if(g===h)return Ix(_),s;g=g.sibling}throw Error(Ie(188))}if(l.return!==h.return)l=_,h=g;else{for(var C=!1,b=_.child;b;){if(b===l){C=!0,l=_,h=g;break}if(b===h){C=!0,h=_,l=g;break}b=b.sibling}if(!C){for(b=g.child;b;){if(b===l){C=!0,l=g,h=_;break}if(b===h){C=!0,h=g,l=_;break}b=b.sibling}if(!C)throw Error(Ie(189))}}if(l.alternate!==h)throw Error(Ie(190))}if(l.tag!==3)throw Error(Ie(188));return l.stateNode.current===l?o:s}function kV(o){return o=KQ(o),o!==null?MV(o):null}function MV(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var s=MV(o);if(s!==null)return s;o=o.sibling}return null}var xV=Ui.unstable_scheduleCallback,Ax=Ui.unstable_cancelCallback,zQ=Ui.unstable_shouldYield,YQ=Ui.unstable_requestPaint,Zn=Ui.unstable_now,qQ=Ui.unstable_getCurrentPriorityLevel,qR=Ui.unstable_ImmediatePriority,UV=Ui.unstable_UserBlockingPriority,cE=Ui.unstable_NormalPriority,JQ=Ui.unstable_LowPriority,VV=Ui.unstable_IdlePriority,jE=null,Rs=null;function XQ(o){if(Rs&&typeof Rs.onCommitFiberRoot=="function")try{Rs.onCommitFiberRoot(jE,o,void 0,(o.current.flags&128)===128)}catch{}}var Go=Math.clz32?Math.clz32:$Q,QQ=Math.log,ZQ=Math.LN2;function $Q(o){return o>>>=0,o===0?32:31-(QQ(o)/ZQ|0)|0}var b_=64,O_=4194304;function Zh(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function dE(o,s){var l=o.pendingLanes;if(l===0)return 0;var h=0,_=o.suspendedLanes,g=o.pingedLanes,C=l&268435455;if(C!==0){var b=C&~_;b!==0?h=Zh(b):(g&=C,g!==0&&(h=Zh(g)))}else C=l&~_,C!==0?h=Zh(C):g!==0&&(h=Zh(g));if(h===0)return 0;if(s!==0&&s!==h&&!(s&_)&&(_=h&-h,g=s&-s,_>=g||_===16&&(g&4194240)!==0))return s;if(h&4&&(h|=l&16),s=o.entangledLanes,s!==0)for(o=o.entanglements,s&=h;0<s;)l=31-Go(s),_=1<<l,h|=o[l],s&=~_;return h}function eZ(o,s){switch(o){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function tZ(o,s){for(var l=o.suspendedLanes,h=o.pingedLanes,_=o.expirationTimes,g=o.pendingLanes;0<g;){var C=31-Go(g),b=1<<C,D=_[C];D===-1?(!(b&l)||b&h)&&(_[C]=eZ(b,s)):D<=s&&(o.expiredLanes|=b),g&=~b}}function KC(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function jV(){var o=b_;return b_<<=1,!(b_&4194240)&&(b_=64),o}function rC(o){for(var s=[],l=0;31>l;l++)s.push(o);return s}function xp(o,s,l){o.pendingLanes|=s,s!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,s=31-Go(s),o[s]=l}function nZ(o,s){var l=o.pendingLanes&~s;o.pendingLanes=s,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=s,o.mutableReadLanes&=s,o.entangledLanes&=s,s=o.entanglements;var h=o.eventTimes;for(o=o.expirationTimes;0<l;){var _=31-Go(l),g=1<<_;s[_]=0,h[_]=-1,o[_]=-1,l&=~g}}function JR(o,s){var l=o.entangledLanes|=s;for(o=o.entanglements;l;){var h=31-Go(l),_=1<<h;_&s|o[h]&s&&(o[h]|=s),l&=~_}}var dn=0;function FV(o){return o&=-o,1<o?4<o?o&268435455?16:536870912:4:1}var BV,XR,GV,WV,HV,zC=!1,N_=[],Ja=null,Xa=null,Qa=null,_p=new Map,Ep=new Map,Wa=[],rZ="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function bx(o,s){switch(o){case"focusin":case"focusout":Ja=null;break;case"dragenter":case"dragleave":Xa=null;break;case"mouseover":case"mouseout":Qa=null;break;case"pointerover":case"pointerout":_p.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ep.delete(s.pointerId)}}function Wh(o,s,l,h,_,g){return o===null||o.nativeEvent!==g?(o={blockedOn:s,domEventName:l,eventSystemFlags:h,nativeEvent:g,targetContainers:[_]},s!==null&&(s=Vp(s),s!==null&&XR(s)),o):(o.eventSystemFlags|=h,s=o.targetContainers,_!==null&&s.indexOf(_)===-1&&s.push(_),o)}function iZ(o,s,l,h,_){switch(s){case"focusin":return Ja=Wh(Ja,o,s,l,h,_),!0;case"dragenter":return Xa=Wh(Xa,o,s,l,h,_),!0;case"mouseover":return Qa=Wh(Qa,o,s,l,h,_),!0;case"pointerover":var g=_.pointerId;return _p.set(g,Wh(_p.get(g)||null,o,s,l,h,_)),!0;case"gotpointercapture":return g=_.pointerId,Ep.set(g,Wh(Ep.get(g)||null,o,s,l,h,_)),!0}return!1}function KV(o){var s=$c(o.target);if(s!==null){var l=md(s);if(l!==null){if(s=l.tag,s===13){if(s=LV(l),s!==null){o.blockedOn=s,HV(o.priority,function(){GV(l)});return}}else if(s===3&&l.stateNode.current.memoizedState.isDehydrated){o.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}o.blockedOn=null}function K_(o){if(o.blockedOn!==null)return!1;for(var s=o.targetContainers;0<s.length;){var l=YC(o.domEventName,o.eventSystemFlags,s[0],o.nativeEvent);if(l===null){l=o.nativeEvent;var h=new l.constructor(l.type,l);BC=h,l.target.dispatchEvent(h),BC=null}else return s=Vp(l),s!==null&&XR(s),o.blockedOn=l,!1;s.shift()}return!0}function Ox(o,s,l){K_(o)&&l.delete(s)}function oZ(){zC=!1,Ja!==null&&K_(Ja)&&(Ja=null),Xa!==null&&K_(Xa)&&(Xa=null),Qa!==null&&K_(Qa)&&(Qa=null),_p.forEach(Ox),Ep.forEach(Ox)}function Hh(o,s){o.blockedOn===s&&(o.blockedOn=null,zC||(zC=!0,Ui.unstable_scheduleCallback(Ui.unstable_NormalPriority,oZ)))}function gp(o){function s(_){return Hh(_,o)}if(0<N_.length){Hh(N_[0],o);for(var l=1;l<N_.length;l++){var h=N_[l];h.blockedOn===o&&(h.blockedOn=null)}}for(Ja!==null&&Hh(Ja,o),Xa!==null&&Hh(Xa,o),Qa!==null&&Hh(Qa,o),_p.forEach(s),Ep.forEach(s),l=0;l<Wa.length;l++)h=Wa[l],h.blockedOn===o&&(h.blockedOn=null);for(;0<Wa.length&&(l=Wa[0],l.blockedOn===null);)KV(l),l.blockedOn===null&&Wa.shift()}var Ql=$s.ReactCurrentBatchConfig,lE=!0;function sZ(o,s,l,h){var _=dn,g=Ql.transition;Ql.transition=null;try{dn=1,QR(o,s,l,h)}finally{dn=_,Ql.transition=g}}function aZ(o,s,l,h){var _=dn,g=Ql.transition;Ql.transition=null;try{dn=4,QR(o,s,l,h)}finally{dn=_,Ql.transition=g}}function QR(o,s,l,h){if(lE){var _=YC(o,s,l,h);if(_===null)pC(o,s,h,uE,l),bx(o,h);else if(iZ(_,o,s,l,h))h.stopPropagation();else if(bx(o,h),s&4&&-1<rZ.indexOf(o)){for(;_!==null;){var g=Vp(_);if(g!==null&&BV(g),g=YC(o,s,l,h),g===null&&pC(o,s,h,uE,l),g===_)break;_=g}_!==null&&h.stopPropagation()}else pC(o,s,h,null,l)}}var uE=null;function YC(o,s,l,h){if(uE=null,o=YR(h),o=$c(o),o!==null)if(s=md(o),s===null)o=null;else if(l=s.tag,l===13){if(o=LV(s),o!==null)return o;o=null}else if(l===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;o=null}else s!==o&&(o=null);return uE=o,null}function zV(o){switch(o){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(qQ()){case qR:return 1;case UV:return 4;case cE:case JQ:return 16;case VV:return 536870912;default:return 16}default:return 16}}var Ka=null,ZR=null,z_=null;function YV(){if(z_)return z_;var o,s=ZR,l=s.length,h,_="value"in Ka?Ka.value:Ka.textContent,g=_.length;for(o=0;o<l&&s[o]===_[o];o++);var C=l-o;for(h=1;h<=C&&s[l-h]===_[g-h];h++);return z_=_.slice(o,1<h?1-h:void 0)}function Y_(o){var s=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&s===13&&(o=13)):o=s,o===10&&(o=13),32<=o||o===13?o:0}function D_(){return!0}function Nx(){return!1}function ji(o){function s(l,h,_,g,C){this._reactName=l,this._targetInst=_,this.type=h,this.nativeEvent=g,this.target=C,this.currentTarget=null;for(var b in o)o.hasOwnProperty(b)&&(l=o[b],this[b]=l?l(g):g[b]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?D_:Nx,this.isPropagationStopped=Nx,this}return Fn(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=D_)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=D_)},persist:function(){},isPersistent:D_}),s}var du={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},$R=ji(du),Up=Fn({},du,{view:0,detail:0}),cZ=ji(Up),iC,oC,Kh,FE=Fn({},Up,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:e0,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Kh&&(Kh&&o.type==="mousemove"?(iC=o.screenX-Kh.screenX,oC=o.screenY-Kh.screenY):oC=iC=0,Kh=o),iC)},movementY:function(o){return"movementY"in o?o.movementY:oC}}),Dx=ji(FE),dZ=Fn({},FE,{dataTransfer:0}),lZ=ji(dZ),uZ=Fn({},Up,{relatedTarget:0}),sC=ji(uZ),hZ=Fn({},du,{animationName:0,elapsedTime:0,pseudoElement:0}),pZ=ji(hZ),fZ=Fn({},du,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),mZ=ji(fZ),_Z=Fn({},du,{data:0}),Px=ji(_Z),EZ={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},gZ={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},SZ={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function TZ(o){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(o):(o=SZ[o])?!!s[o]:!1}function e0(){return TZ}var vZ=Fn({},Up,{key:function(o){if(o.key){var s=EZ[o.key]||o.key;if(s!=="Unidentified")return s}return o.type==="keypress"?(o=Y_(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?gZ[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:e0,charCode:function(o){return o.type==="keypress"?Y_(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?Y_(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),yZ=ji(vZ),CZ=Fn({},FE,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Lx=ji(CZ),RZ=Fn({},Up,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:e0}),wZ=ji(RZ),IZ=Fn({},du,{propertyName:0,elapsedTime:0,pseudoElement:0}),AZ=ji(IZ),bZ=Fn({},FE,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),OZ=ji(bZ),NZ=[9,13,27,32],t0=Js&&"CompositionEvent"in window,ip=null;Js&&"documentMode"in document&&(ip=document.documentMode);var DZ=Js&&"TextEvent"in window&&!ip,qV=Js&&(!t0||ip&&8<ip&&11>=ip),kx=" ",Mx=!1;function JV(o,s){switch(o){case"keyup":return NZ.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function XV(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var xl=!1;function PZ(o,s){switch(o){case"compositionend":return XV(s);case"keypress":return s.which!==32?null:(Mx=!0,kx);case"textInput":return o=s.data,o===kx&&Mx?null:o;default:return null}}function LZ(o,s){if(xl)return o==="compositionend"||!t0&&JV(o,s)?(o=YV(),z_=ZR=Ka=null,xl=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return qV&&s.locale!=="ko"?null:s.data;default:return null}}var kZ={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xx(o){var s=o&&o.nodeName&&o.nodeName.toLowerCase();return s==="input"?!!kZ[o.type]:s==="textarea"}function QV(o,s,l,h){bV(h),s=hE(s,"onChange"),0<s.length&&(l=new $R("onChange","change",null,l,h),o.push({event:l,listeners:s}))}var op=null,Sp=null;function MZ(o){c5(o,0)}function BE(o){var s=jl(o);if(vV(s))return o}function xZ(o,s){if(o==="change")return s}var ZV=!1;if(Js){var aC;if(Js){var cC="oninput"in document;if(!cC){var Ux=document.createElement("div");Ux.setAttribute("oninput","return;"),cC=typeof Ux.oninput=="function"}aC=cC}else aC=!1;ZV=aC&&(!document.documentMode||9<document.documentMode)}function Vx(){op&&(op.detachEvent("onpropertychange",$V),Sp=op=null)}function $V(o){if(o.propertyName==="value"&&BE(Sp)){var s=[];QV(s,Sp,o,YR(o)),PV(MZ,s)}}function UZ(o,s,l){o==="focusin"?(Vx(),op=s,Sp=l,op.attachEvent("onpropertychange",$V)):o==="focusout"&&Vx()}function VZ(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return BE(Sp)}function jZ(o,s){if(o==="click")return BE(s)}function FZ(o,s){if(o==="input"||o==="change")return BE(s)}function BZ(o,s){return o===s&&(o!==0||1/o===1/s)||o!==o&&s!==s}var zo=typeof Object.is=="function"?Object.is:BZ;function Tp(o,s){if(zo(o,s))return!0;if(typeof o!="object"||o===null||typeof s!="object"||s===null)return!1;var l=Object.keys(o),h=Object.keys(s);if(l.length!==h.length)return!1;for(h=0;h<l.length;h++){var _=l[h];if(!OC.call(s,_)||!zo(o[_],s[_]))return!1}return!0}function jx(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function Fx(o,s){var l=jx(o);o=0;for(var h;l;){if(l.nodeType===3){if(h=o+l.textContent.length,o<=s&&h>=s)return{node:l,offset:s-o};o=h}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=jx(l)}}function e5(o,s){return o&&s?o===s?!0:o&&o.nodeType===3?!1:s&&s.nodeType===3?e5(o,s.parentNode):"contains"in o?o.contains(s):o.compareDocumentPosition?!!(o.compareDocumentPosition(s)&16):!1:!1}function t5(){for(var o=window,s=oE();s instanceof o.HTMLIFrameElement;){try{var l=typeof s.contentWindow.location.href=="string"}catch{l=!1}if(l)o=s.contentWindow;else break;s=oE(o.document)}return s}function n0(o){var s=o&&o.nodeName&&o.nodeName.toLowerCase();return s&&(s==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||s==="textarea"||o.contentEditable==="true")}function GZ(o){var s=t5(),l=o.focusedElem,h=o.selectionRange;if(s!==l&&l&&l.ownerDocument&&e5(l.ownerDocument.documentElement,l)){if(h!==null&&n0(l)){if(s=h.start,o=h.end,o===void 0&&(o=s),"selectionStart"in l)l.selectionStart=s,l.selectionEnd=Math.min(o,l.value.length);else if(o=(s=l.ownerDocument||document)&&s.defaultView||window,o.getSelection){o=o.getSelection();var _=l.textContent.length,g=Math.min(h.start,_);h=h.end===void 0?g:Math.min(h.end,_),!o.extend&&g>h&&(_=h,h=g,g=_),_=Fx(l,g);var C=Fx(l,h);_&&C&&(o.rangeCount!==1||o.anchorNode!==_.node||o.anchorOffset!==_.offset||o.focusNode!==C.node||o.focusOffset!==C.offset)&&(s=s.createRange(),s.setStart(_.node,_.offset),o.removeAllRanges(),g>h?(o.addRange(s),o.extend(C.node,C.offset)):(s.setEnd(C.node,C.offset),o.addRange(s)))}}for(s=[],o=l;o=o.parentNode;)o.nodeType===1&&s.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<s.length;l++)o=s[l],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var WZ=Js&&"documentMode"in document&&11>=document.documentMode,Ul=null,qC=null,sp=null,JC=!1;function Bx(o,s,l){var h=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;JC||Ul==null||Ul!==oE(h)||(h=Ul,"selectionStart"in h&&n0(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),sp&&Tp(sp,h)||(sp=h,h=hE(qC,"onSelect"),0<h.length&&(s=new $R("onSelect","select",null,s,l),o.push({event:s,listeners:h}),s.target=Ul)))}function P_(o,s){var l={};return l[o.toLowerCase()]=s.toLowerCase(),l["Webkit"+o]="webkit"+s,l["Moz"+o]="moz"+s,l}var Vl={animationend:P_("Animation","AnimationEnd"),animationiteration:P_("Animation","AnimationIteration"),animationstart:P_("Animation","AnimationStart"),transitionend:P_("Transition","TransitionEnd")},dC={},n5={};Js&&(n5=document.createElement("div").style,"AnimationEvent"in window||(delete Vl.animationend.animation,delete Vl.animationiteration.animation,delete Vl.animationstart.animation),"TransitionEvent"in window||delete Vl.transitionend.transition);function GE(o){if(dC[o])return dC[o];if(!Vl[o])return o;var s=Vl[o],l;for(l in s)if(s.hasOwnProperty(l)&&l in n5)return dC[o]=s[l];return o}var r5=GE("animationend"),i5=GE("animationiteration"),o5=GE("animationstart"),s5=GE("transitionend"),a5=new Map,Gx="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function sc(o,s){a5.set(o,s),fd(s,[o])}for(var lC=0;lC<Gx.length;lC++){var uC=Gx[lC],HZ=uC.toLowerCase(),KZ=uC[0].toUpperCase()+uC.slice(1);sc(HZ,"on"+KZ)}sc(r5,"onAnimationEnd");sc(i5,"onAnimationIteration");sc(o5,"onAnimationStart");sc("dblclick","onDoubleClick");sc("focusin","onFocus");sc("focusout","onBlur");sc(s5,"onTransitionEnd");eu("onMouseEnter",["mouseout","mouseover"]);eu("onMouseLeave",["mouseout","mouseover"]);eu("onPointerEnter",["pointerout","pointerover"]);eu("onPointerLeave",["pointerout","pointerover"]);fd("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fd("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fd("onBeforeInput",["compositionend","keypress","textInput","paste"]);fd("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fd("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fd("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $h="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zZ=new Set("cancel close invalid load scroll toggle".split(" ").concat($h));function Wx(o,s,l){var h=o.type||"unknown-event";o.currentTarget=l,HQ(h,s,void 0,o),o.currentTarget=null}function c5(o,s){s=(s&4)!==0;for(var l=0;l<o.length;l++){var h=o[l],_=h.event;h=h.listeners;e:{var g=void 0;if(s)for(var C=h.length-1;0<=C;C--){var b=h[C],D=b.instance,M=b.currentTarget;if(b=b.listener,D!==g&&_.isPropagationStopped())break e;Wx(_,b,M),g=D}else for(C=0;C<h.length;C++){if(b=h[C],D=b.instance,M=b.currentTarget,b=b.listener,D!==g&&_.isPropagationStopped())break e;Wx(_,b,M),g=D}}}if(aE)throw o=HC,aE=!1,HC=null,o}function An(o,s){var l=s[eR];l===void 0&&(l=s[eR]=new Set);var h=o+"__bubble";l.has(h)||(d5(s,o,2,!1),l.add(h))}function hC(o,s,l){var h=0;s&&(h|=4),d5(l,o,h,s)}var L_="_reactListening"+Math.random().toString(36).slice(2);function vp(o){if(!o[L_]){o[L_]=!0,_V.forEach(function(l){l!=="selectionchange"&&(zZ.has(l)||hC(l,!1,o),hC(l,!0,o))});var s=o.nodeType===9?o:o.ownerDocument;s===null||s[L_]||(s[L_]=!0,hC("selectionchange",!1,s))}}function d5(o,s,l,h){switch(zV(s)){case 1:var _=sZ;break;case 4:_=aZ;break;default:_=QR}l=_.bind(null,s,l,o),_=void 0,!WC||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(_=!0),h?_!==void 0?o.addEventListener(s,l,{capture:!0,passive:_}):o.addEventListener(s,l,!0):_!==void 0?o.addEventListener(s,l,{passive:_}):o.addEventListener(s,l,!1)}function pC(o,s,l,h,_){var g=h;if(!(s&1)&&!(s&2)&&h!==null)e:for(;;){if(h===null)return;var C=h.tag;if(C===3||C===4){var b=h.stateNode.containerInfo;if(b===_||b.nodeType===8&&b.parentNode===_)break;if(C===4)for(C=h.return;C!==null;){var D=C.tag;if((D===3||D===4)&&(D=C.stateNode.containerInfo,D===_||D.nodeType===8&&D.parentNode===_))return;C=C.return}for(;b!==null;){if(C=$c(b),C===null)return;if(D=C.tag,D===5||D===6){h=g=C;continue e}b=b.parentNode}}h=h.return}PV(function(){var M=g,j=YR(l),x=[];e:{var W=a5.get(o);if(W!==void 0){var te=$R,X=o;switch(o){case"keypress":if(Y_(l)===0)break e;case"keydown":case"keyup":te=yZ;break;case"focusin":X="focus",te=sC;break;case"focusout":X="blur",te=sC;break;case"beforeblur":case"afterblur":te=sC;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":te=Dx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":te=lZ;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":te=wZ;break;case r5:case i5:case o5:te=pZ;break;case s5:te=AZ;break;case"scroll":te=cZ;break;case"wheel":te=OZ;break;case"copy":case"cut":case"paste":te=mZ;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":te=Lx}var ie=(s&4)!==0,ve=!ie&&o==="scroll",K=ie?W!==null?W+"Capture":null:W;ie=[];for(var H=M,Y;H!==null;){Y=H;var pe=Y.stateNode;if(Y.tag===5&&pe!==null&&(Y=pe,K!==null&&(pe=mp(H,K),pe!=null&&ie.push(yp(H,pe,Y)))),ve)break;H=H.return}0<ie.length&&(W=new te(W,X,null,l,j),x.push({event:W,listeners:ie}))}}if(!(s&7)){e:{if(W=o==="mouseover"||o==="pointerover",te=o==="mouseout"||o==="pointerout",W&&l!==BC&&(X=l.relatedTarget||l.fromElement)&&($c(X)||X[Xs]))break e;if((te||W)&&(W=j.window===j?j:(W=j.ownerDocument)?W.defaultView||W.parentWindow:window,te?(X=l.relatedTarget||l.toElement,te=M,X=X?$c(X):null,X!==null&&(ve=md(X),X!==ve||X.tag!==5&&X.tag!==6)&&(X=null)):(te=null,X=M),te!==X)){if(ie=Dx,pe="onMouseLeave",K="onMouseEnter",H="mouse",(o==="pointerout"||o==="pointerover")&&(ie=Lx,pe="onPointerLeave",K="onPointerEnter",H="pointer"),ve=te==null?W:jl(te),Y=X==null?W:jl(X),W=new ie(pe,H+"leave",te,l,j),W.target=ve,W.relatedTarget=Y,pe=null,$c(j)===M&&(ie=new ie(K,H+"enter",X,l,j),ie.target=Y,ie.relatedTarget=ve,pe=ie),ve=pe,te&&X)t:{for(ie=te,K=X,H=0,Y=ie;Y;Y=Pl(Y))H++;for(Y=0,pe=K;pe;pe=Pl(pe))Y++;for(;0<H-Y;)ie=Pl(ie),H--;for(;0<Y-H;)K=Pl(K),Y--;for(;H--;){if(ie===K||K!==null&&ie===K.alternate)break t;ie=Pl(ie),K=Pl(K)}ie=null}else ie=null;te!==null&&Hx(x,W,te,ie,!1),X!==null&&ve!==null&&Hx(x,ve,X,ie,!0)}}e:{if(W=M?jl(M):window,te=W.nodeName&&W.nodeName.toLowerCase(),te==="select"||te==="input"&&W.type==="file")var Ne=xZ;else if(xx(W))if(ZV)Ne=FZ;else{Ne=VZ;var ke=UZ}else(te=W.nodeName)&&te.toLowerCase()==="input"&&(W.type==="checkbox"||W.type==="radio")&&(Ne=jZ);if(Ne&&(Ne=Ne(o,M))){QV(x,Ne,l,j);break e}ke&&ke(o,W,M),o==="focusout"&&(ke=W._wrapperState)&&ke.controlled&&W.type==="number"&&xC(W,"number",W.value)}switch(ke=M?jl(M):window,o){case"focusin":(xx(ke)||ke.contentEditable==="true")&&(Ul=ke,qC=M,sp=null);break;case"focusout":sp=qC=Ul=null;break;case"mousedown":JC=!0;break;case"contextmenu":case"mouseup":case"dragend":JC=!1,Bx(x,l,j);break;case"selectionchange":if(WZ)break;case"keydown":case"keyup":Bx(x,l,j)}var Pe;if(t0)e:{switch(o){case"compositionstart":var He="onCompositionStart";break e;case"compositionend":He="onCompositionEnd";break e;case"compositionupdate":He="onCompositionUpdate";break e}He=void 0}else xl?JV(o,l)&&(He="onCompositionEnd"):o==="keydown"&&l.keyCode===229&&(He="onCompositionStart");He&&(qV&&l.locale!=="ko"&&(xl||He!=="onCompositionStart"?He==="onCompositionEnd"&&xl&&(Pe=YV()):(Ka=j,ZR="value"in Ka?Ka.value:Ka.textContent,xl=!0)),ke=hE(M,He),0<ke.length&&(He=new Px(He,o,null,l,j),x.push({event:He,listeners:ke}),Pe?He.data=Pe:(Pe=XV(l),Pe!==null&&(He.data=Pe)))),(Pe=DZ?PZ(o,l):LZ(o,l))&&(M=hE(M,"onBeforeInput"),0<M.length&&(j=new Px("onBeforeInput","beforeinput",null,l,j),x.push({event:j,listeners:M}),j.data=Pe))}c5(x,s)})}function yp(o,s,l){return{instance:o,listener:s,currentTarget:l}}function hE(o,s){for(var l=s+"Capture",h=[];o!==null;){var _=o,g=_.stateNode;_.tag===5&&g!==null&&(_=g,g=mp(o,l),g!=null&&h.unshift(yp(o,g,_)),g=mp(o,s),g!=null&&h.push(yp(o,g,_))),o=o.return}return h}function Pl(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5);return o||null}function Hx(o,s,l,h,_){for(var g=s._reactName,C=[];l!==null&&l!==h;){var b=l,D=b.alternate,M=b.stateNode;if(D!==null&&D===h)break;b.tag===5&&M!==null&&(b=M,_?(D=mp(l,g),D!=null&&C.unshift(yp(l,D,b))):_||(D=mp(l,g),D!=null&&C.push(yp(l,D,b)))),l=l.return}C.length!==0&&o.push({event:s,listeners:C})}var YZ=/\r\n?/g,qZ=/\u0000|\uFFFD/g;function Kx(o){return(typeof o=="string"?o:""+o).replace(YZ,`
`).replace(qZ,"")}function k_(o,s,l){if(s=Kx(s),Kx(o)!==s&&l)throw Error(Ie(425))}function pE(){}var XC=null,QC=null;function ZC(o,s){return o==="textarea"||o==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var $C=typeof setTimeout=="function"?setTimeout:void 0,JZ=typeof clearTimeout=="function"?clearTimeout:void 0,zx=typeof Promise=="function"?Promise:void 0,XZ=typeof queueMicrotask=="function"?queueMicrotask:typeof zx<"u"?function(o){return zx.resolve(null).then(o).catch(QZ)}:$C;function QZ(o){setTimeout(function(){throw o})}function fC(o,s){var l=s,h=0;do{var _=l.nextSibling;if(o.removeChild(l),_&&_.nodeType===8)if(l=_.data,l==="/$"){if(h===0){o.removeChild(_),gp(s);return}h--}else l!=="$"&&l!=="$?"&&l!=="$!"||h++;l=_}while(l);gp(s)}function Za(o){for(;o!=null;o=o.nextSibling){var s=o.nodeType;if(s===1||s===3)break;if(s===8){if(s=o.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return o}function Yx(o){o=o.previousSibling;for(var s=0;o;){if(o.nodeType===8){var l=o.data;if(l==="$"||l==="$!"||l==="$?"){if(s===0)return o;s--}else l==="/$"&&s++}o=o.previousSibling}return null}var lu=Math.random().toString(36).slice(2),Cs="__reactFiber$"+lu,Cp="__reactProps$"+lu,Xs="__reactContainer$"+lu,eR="__reactEvents$"+lu,ZZ="__reactListeners$"+lu,$Z="__reactHandles$"+lu;function $c(o){var s=o[Cs];if(s)return s;for(var l=o.parentNode;l;){if(s=l[Xs]||l[Cs]){if(l=s.alternate,s.child!==null||l!==null&&l.child!==null)for(o=Yx(o);o!==null;){if(l=o[Cs])return l;o=Yx(o)}return s}o=l,l=o.parentNode}return null}function Vp(o){return o=o[Cs]||o[Xs],!o||o.tag!==5&&o.tag!==6&&o.tag!==13&&o.tag!==3?null:o}function jl(o){if(o.tag===5||o.tag===6)return o.stateNode;throw Error(Ie(33))}function WE(o){return o[Cp]||null}var tR=[],Fl=-1;function ac(o){return{current:o}}function bn(o){0>Fl||(o.current=tR[Fl],tR[Fl]=null,Fl--)}function vn(o,s){Fl++,tR[Fl]=o.current,o.current=s}var oc={},Br=ac(oc),Ei=ac(!1),ad=oc;function tu(o,s){var l=o.type.contextTypes;if(!l)return oc;var h=o.stateNode;if(h&&h.__reactInternalMemoizedUnmaskedChildContext===s)return h.__reactInternalMemoizedMaskedChildContext;var _={},g;for(g in l)_[g]=s[g];return h&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=s,o.__reactInternalMemoizedMaskedChildContext=_),_}function gi(o){return o=o.childContextTypes,o!=null}function fE(){bn(Ei),bn(Br)}function qx(o,s,l){if(Br.current!==oc)throw Error(Ie(168));vn(Br,s),vn(Ei,l)}function l5(o,s,l){var h=o.stateNode;if(s=s.childContextTypes,typeof h.getChildContext!="function")return l;h=h.getChildContext();for(var _ in h)if(!(_ in s))throw Error(Ie(108,UQ(o)||"Unknown",_));return Fn({},l,h)}function mE(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||oc,ad=Br.current,vn(Br,o),vn(Ei,Ei.current),!0}function Jx(o,s,l){var h=o.stateNode;if(!h)throw Error(Ie(169));l?(o=l5(o,s,ad),h.__reactInternalMemoizedMergedChildContext=o,bn(Ei),bn(Br),vn(Br,o)):bn(Ei),vn(Ei,l)}var Hs=null,HE=!1,mC=!1;function u5(o){Hs===null?Hs=[o]:Hs.push(o)}function e$(o){HE=!0,u5(o)}function cc(){if(!mC&&Hs!==null){mC=!0;var o=0,s=dn;try{var l=Hs;for(dn=1;o<l.length;o++){var h=l[o];do h=h(!0);while(h!==null)}Hs=null,HE=!1}catch(_){throw Hs!==null&&(Hs=Hs.slice(o+1)),xV(qR,cc),_}finally{dn=s,mC=!1}}return null}var Bl=[],Gl=0,_E=null,EE=0,ho=[],po=0,cd=null,Ks=1,zs="";function Xc(o,s){Bl[Gl++]=EE,Bl[Gl++]=_E,_E=o,EE=s}function h5(o,s,l){ho[po++]=Ks,ho[po++]=zs,ho[po++]=cd,cd=o;var h=Ks;o=zs;var _=32-Go(h)-1;h&=~(1<<_),l+=1;var g=32-Go(s)+_;if(30<g){var C=_-_%5;g=(h&(1<<C)-1).toString(32),h>>=C,_-=C,Ks=1<<32-Go(s)+_|l<<_|h,zs=g+o}else Ks=1<<g|l<<_|h,zs=o}function r0(o){o.return!==null&&(Xc(o,1),h5(o,1,0))}function i0(o){for(;o===_E;)_E=Bl[--Gl],Bl[Gl]=null,EE=Bl[--Gl],Bl[Gl]=null;for(;o===cd;)cd=ho[--po],ho[po]=null,zs=ho[--po],ho[po]=null,Ks=ho[--po],ho[po]=null}var xi=null,Mi=null,kn=!1,Bo=null;function p5(o,s){var l=fo(5,null,null,0);l.elementType="DELETED",l.stateNode=s,l.return=o,s=o.deletions,s===null?(o.deletions=[l],o.flags|=16):s.push(l)}function Xx(o,s){switch(o.tag){case 5:var l=o.type;return s=s.nodeType!==1||l.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(o.stateNode=s,xi=o,Mi=Za(s.firstChild),!0):!1;case 6:return s=o.pendingProps===""||s.nodeType!==3?null:s,s!==null?(o.stateNode=s,xi=o,Mi=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(l=cd!==null?{id:Ks,overflow:zs}:null,o.memoizedState={dehydrated:s,treeContext:l,retryLane:1073741824},l=fo(18,null,null,0),l.stateNode=s,l.return=o,o.child=l,xi=o,Mi=null,!0):!1;default:return!1}}function nR(o){return(o.mode&1)!==0&&(o.flags&128)===0}function rR(o){if(kn){var s=Mi;if(s){var l=s;if(!Xx(o,s)){if(nR(o))throw Error(Ie(418));s=Za(l.nextSibling);var h=xi;s&&Xx(o,s)?p5(h,l):(o.flags=o.flags&-4097|2,kn=!1,xi=o)}}else{if(nR(o))throw Error(Ie(418));o.flags=o.flags&-4097|2,kn=!1,xi=o}}}function Qx(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;xi=o}function M_(o){if(o!==xi)return!1;if(!kn)return Qx(o),kn=!0,!1;var s;if((s=o.tag!==3)&&!(s=o.tag!==5)&&(s=o.type,s=s!=="head"&&s!=="body"&&!ZC(o.type,o.memoizedProps)),s&&(s=Mi)){if(nR(o))throw f5(),Error(Ie(418));for(;s;)p5(o,s),s=Za(s.nextSibling)}if(Qx(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Ie(317));e:{for(o=o.nextSibling,s=0;o;){if(o.nodeType===8){var l=o.data;if(l==="/$"){if(s===0){Mi=Za(o.nextSibling);break e}s--}else l!=="$"&&l!=="$!"&&l!=="$?"||s++}o=o.nextSibling}Mi=null}}else Mi=xi?Za(o.stateNode.nextSibling):null;return!0}function f5(){for(var o=Mi;o;)o=Za(o.nextSibling)}function nu(){Mi=xi=null,kn=!1}function o0(o){Bo===null?Bo=[o]:Bo.push(o)}var t$=$s.ReactCurrentBatchConfig;function zh(o,s,l){if(o=l.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(Ie(309));var h=l.stateNode}if(!h)throw Error(Ie(147,o));var _=h,g=""+o;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===g?s.ref:(s=function(C){var b=_.refs;C===null?delete b[g]:b[g]=C},s._stringRef=g,s)}if(typeof o!="string")throw Error(Ie(284));if(!l._owner)throw Error(Ie(290,o))}return o}function x_(o,s){throw o=Object.prototype.toString.call(s),Error(Ie(31,o==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":o))}function Zx(o){var s=o._init;return s(o._payload)}function m5(o){function s(K,H){if(o){var Y=K.deletions;Y===null?(K.deletions=[H],K.flags|=16):Y.push(H)}}function l(K,H){if(!o)return null;for(;H!==null;)s(K,H),H=H.sibling;return null}function h(K,H){for(K=new Map;H!==null;)H.key!==null?K.set(H.key,H):K.set(H.index,H),H=H.sibling;return K}function _(K,H){return K=nc(K,H),K.index=0,K.sibling=null,K}function g(K,H,Y){return K.index=Y,o?(Y=K.alternate,Y!==null?(Y=Y.index,Y<H?(K.flags|=2,H):Y):(K.flags|=2,H)):(K.flags|=1048576,H)}function C(K){return o&&K.alternate===null&&(K.flags|=2),K}function b(K,H,Y,pe){return H===null||H.tag!==6?(H=yC(Y,K.mode,pe),H.return=K,H):(H=_(H,Y),H.return=K,H)}function D(K,H,Y,pe){var Ne=Y.type;return Ne===Ml?j(K,H,Y.props.children,pe,Y.key):H!==null&&(H.elementType===Ne||typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===Ba&&Zx(Ne)===H.type)?(pe=_(H,Y.props),pe.ref=zh(K,H,Y),pe.return=K,pe):(pe=eE(Y.type,Y.key,Y.props,null,K.mode,pe),pe.ref=zh(K,H,Y),pe.return=K,pe)}function M(K,H,Y,pe){return H===null||H.tag!==4||H.stateNode.containerInfo!==Y.containerInfo||H.stateNode.implementation!==Y.implementation?(H=CC(Y,K.mode,pe),H.return=K,H):(H=_(H,Y.children||[]),H.return=K,H)}function j(K,H,Y,pe,Ne){return H===null||H.tag!==7?(H=rd(Y,K.mode,pe,Ne),H.return=K,H):(H=_(H,Y),H.return=K,H)}function x(K,H,Y){if(typeof H=="string"&&H!==""||typeof H=="number")return H=yC(""+H,K.mode,Y),H.return=K,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case w_:return Y=eE(H.type,H.key,H.props,null,K.mode,Y),Y.ref=zh(K,null,H),Y.return=K,Y;case kl:return H=CC(H,K.mode,Y),H.return=K,H;case Ba:var pe=H._init;return x(K,pe(H._payload),Y)}if(Qh(H)||Bh(H))return H=rd(H,K.mode,Y,null),H.return=K,H;x_(K,H)}return null}function W(K,H,Y,pe){var Ne=H!==null?H.key:null;if(typeof Y=="string"&&Y!==""||typeof Y=="number")return Ne!==null?null:b(K,H,""+Y,pe);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case w_:return Y.key===Ne?D(K,H,Y,pe):null;case kl:return Y.key===Ne?M(K,H,Y,pe):null;case Ba:return Ne=Y._init,W(K,H,Ne(Y._payload),pe)}if(Qh(Y)||Bh(Y))return Ne!==null?null:j(K,H,Y,pe,null);x_(K,Y)}return null}function te(K,H,Y,pe,Ne){if(typeof pe=="string"&&pe!==""||typeof pe=="number")return K=K.get(Y)||null,b(H,K,""+pe,Ne);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case w_:return K=K.get(pe.key===null?Y:pe.key)||null,D(H,K,pe,Ne);case kl:return K=K.get(pe.key===null?Y:pe.key)||null,M(H,K,pe,Ne);case Ba:var ke=pe._init;return te(K,H,Y,ke(pe._payload),Ne)}if(Qh(pe)||Bh(pe))return K=K.get(Y)||null,j(H,K,pe,Ne,null);x_(H,pe)}return null}function X(K,H,Y,pe){for(var Ne=null,ke=null,Pe=H,He=H=0,mn=null;Pe!==null&&He<Y.length;He++){Pe.index>He?(mn=Pe,Pe=null):mn=Pe.sibling;var mt=W(K,Pe,Y[He],pe);if(mt===null){Pe===null&&(Pe=mn);break}o&&Pe&&mt.alternate===null&&s(K,Pe),H=g(mt,H,He),ke===null?Ne=mt:ke.sibling=mt,ke=mt,Pe=mn}if(He===Y.length)return l(K,Pe),kn&&Xc(K,He),Ne;if(Pe===null){for(;He<Y.length;He++)Pe=x(K,Y[He],pe),Pe!==null&&(H=g(Pe,H,He),ke===null?Ne=Pe:ke.sibling=Pe,ke=Pe);return kn&&Xc(K,He),Ne}for(Pe=h(K,Pe);He<Y.length;He++)mn=te(Pe,K,He,Y[He],pe),mn!==null&&(o&&mn.alternate!==null&&Pe.delete(mn.key===null?He:mn.key),H=g(mn,H,He),ke===null?Ne=mn:ke.sibling=mn,ke=mn);return o&&Pe.forEach(function(vr){return s(K,vr)}),kn&&Xc(K,He),Ne}function ie(K,H,Y,pe){var Ne=Bh(Y);if(typeof Ne!="function")throw Error(Ie(150));if(Y=Ne.call(Y),Y==null)throw Error(Ie(151));for(var ke=Ne=null,Pe=H,He=H=0,mn=null,mt=Y.next();Pe!==null&&!mt.done;He++,mt=Y.next()){Pe.index>He?(mn=Pe,Pe=null):mn=Pe.sibling;var vr=W(K,Pe,mt.value,pe);if(vr===null){Pe===null&&(Pe=mn);break}o&&Pe&&vr.alternate===null&&s(K,Pe),H=g(vr,H,He),ke===null?Ne=vr:ke.sibling=vr,ke=vr,Pe=mn}if(mt.done)return l(K,Pe),kn&&Xc(K,He),Ne;if(Pe===null){for(;!mt.done;He++,mt=Y.next())mt=x(K,mt.value,pe),mt!==null&&(H=g(mt,H,He),ke===null?Ne=mt:ke.sibling=mt,ke=mt);return kn&&Xc(K,He),Ne}for(Pe=h(K,Pe);!mt.done;He++,mt=Y.next())mt=te(Pe,K,He,mt.value,pe),mt!==null&&(o&&mt.alternate!==null&&Pe.delete(mt.key===null?He:mt.key),H=g(mt,H,He),ke===null?Ne=mt:ke.sibling=mt,ke=mt);return o&&Pe.forEach(function(Gr){return s(K,Gr)}),kn&&Xc(K,He),Ne}function ve(K,H,Y,pe){if(typeof Y=="object"&&Y!==null&&Y.type===Ml&&Y.key===null&&(Y=Y.props.children),typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case w_:e:{for(var Ne=Y.key,ke=H;ke!==null;){if(ke.key===Ne){if(Ne=Y.type,Ne===Ml){if(ke.tag===7){l(K,ke.sibling),H=_(ke,Y.props.children),H.return=K,K=H;break e}}else if(ke.elementType===Ne||typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===Ba&&Zx(Ne)===ke.type){l(K,ke.sibling),H=_(ke,Y.props),H.ref=zh(K,ke,Y),H.return=K,K=H;break e}l(K,ke);break}else s(K,ke);ke=ke.sibling}Y.type===Ml?(H=rd(Y.props.children,K.mode,pe,Y.key),H.return=K,K=H):(pe=eE(Y.type,Y.key,Y.props,null,K.mode,pe),pe.ref=zh(K,H,Y),pe.return=K,K=pe)}return C(K);case kl:e:{for(ke=Y.key;H!==null;){if(H.key===ke)if(H.tag===4&&H.stateNode.containerInfo===Y.containerInfo&&H.stateNode.implementation===Y.implementation){l(K,H.sibling),H=_(H,Y.children||[]),H.return=K,K=H;break e}else{l(K,H);break}else s(K,H);H=H.sibling}H=CC(Y,K.mode,pe),H.return=K,K=H}return C(K);case Ba:return ke=Y._init,ve(K,H,ke(Y._payload),pe)}if(Qh(Y))return X(K,H,Y,pe);if(Bh(Y))return ie(K,H,Y,pe);x_(K,Y)}return typeof Y=="string"&&Y!==""||typeof Y=="number"?(Y=""+Y,H!==null&&H.tag===6?(l(K,H.sibling),H=_(H,Y),H.return=K,K=H):(l(K,H),H=yC(Y,K.mode,pe),H.return=K,K=H),C(K)):l(K,H)}return ve}var ru=m5(!0),_5=m5(!1),gE=ac(null),SE=null,Wl=null,s0=null;function a0(){s0=Wl=SE=null}function c0(o){var s=gE.current;bn(gE),o._currentValue=s}function iR(o,s,l){for(;o!==null;){var h=o.alternate;if((o.childLanes&s)!==s?(o.childLanes|=s,h!==null&&(h.childLanes|=s)):h!==null&&(h.childLanes&s)!==s&&(h.childLanes|=s),o===l)break;o=o.return}}function Zl(o,s){SE=o,s0=Wl=null,o=o.dependencies,o!==null&&o.firstContext!==null&&(o.lanes&s&&(_i=!0),o.firstContext=null)}function Eo(o){var s=o._currentValue;if(s0!==o)if(o={context:o,memoizedValue:s,next:null},Wl===null){if(SE===null)throw Error(Ie(308));Wl=o,SE.dependencies={lanes:0,firstContext:o}}else Wl=Wl.next=o;return s}var ed=null;function d0(o){ed===null?ed=[o]:ed.push(o)}function E5(o,s,l,h){var _=s.interleaved;return _===null?(l.next=l,d0(s)):(l.next=_.next,_.next=l),s.interleaved=l,Qs(o,h)}function Qs(o,s){o.lanes|=s;var l=o.alternate;for(l!==null&&(l.lanes|=s),l=o,o=o.return;o!==null;)o.childLanes|=s,l=o.alternate,l!==null&&(l.childLanes|=s),l=o,o=o.return;return l.tag===3?l.stateNode:null}var Ga=!1;function l0(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function g5(o,s){o=o.updateQueue,s.updateQueue===o&&(s.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function qs(o,s){return{eventTime:o,lane:s,tag:0,payload:null,callback:null,next:null}}function $a(o,s,l){var h=o.updateQueue;if(h===null)return null;if(h=h.shared,Yt&2){var _=h.pending;return _===null?s.next=s:(s.next=_.next,_.next=s),h.pending=s,Qs(o,l)}return _=h.interleaved,_===null?(s.next=s,d0(h)):(s.next=_.next,_.next=s),h.interleaved=s,Qs(o,l)}function q_(o,s,l){if(s=s.updateQueue,s!==null&&(s=s.shared,(l&4194240)!==0)){var h=s.lanes;h&=o.pendingLanes,l|=h,s.lanes=l,JR(o,l)}}function $x(o,s){var l=o.updateQueue,h=o.alternate;if(h!==null&&(h=h.updateQueue,l===h)){var _=null,g=null;if(l=l.firstBaseUpdate,l!==null){do{var C={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};g===null?_=g=C:g=g.next=C,l=l.next}while(l!==null);g===null?_=g=s:g=g.next=s}else _=g=s;l={baseState:h.baseState,firstBaseUpdate:_,lastBaseUpdate:g,shared:h.shared,effects:h.effects},o.updateQueue=l;return}o=l.lastBaseUpdate,o===null?l.firstBaseUpdate=s:o.next=s,l.lastBaseUpdate=s}function TE(o,s,l,h){var _=o.updateQueue;Ga=!1;var g=_.firstBaseUpdate,C=_.lastBaseUpdate,b=_.shared.pending;if(b!==null){_.shared.pending=null;var D=b,M=D.next;D.next=null,C===null?g=M:C.next=M,C=D;var j=o.alternate;j!==null&&(j=j.updateQueue,b=j.lastBaseUpdate,b!==C&&(b===null?j.firstBaseUpdate=M:b.next=M,j.lastBaseUpdate=D))}if(g!==null){var x=_.baseState;C=0,j=M=D=null,b=g;do{var W=b.lane,te=b.eventTime;if((h&W)===W){j!==null&&(j=j.next={eventTime:te,lane:0,tag:b.tag,payload:b.payload,callback:b.callback,next:null});e:{var X=o,ie=b;switch(W=s,te=l,ie.tag){case 1:if(X=ie.payload,typeof X=="function"){x=X.call(te,x,W);break e}x=X;break e;case 3:X.flags=X.flags&-65537|128;case 0:if(X=ie.payload,W=typeof X=="function"?X.call(te,x,W):X,W==null)break e;x=Fn({},x,W);break e;case 2:Ga=!0}}b.callback!==null&&b.lane!==0&&(o.flags|=64,W=_.effects,W===null?_.effects=[b]:W.push(b))}else te={eventTime:te,lane:W,tag:b.tag,payload:b.payload,callback:b.callback,next:null},j===null?(M=j=te,D=x):j=j.next=te,C|=W;if(b=b.next,b===null){if(b=_.shared.pending,b===null)break;W=b,b=W.next,W.next=null,_.lastBaseUpdate=W,_.shared.pending=null}}while(!0);if(j===null&&(D=x),_.baseState=D,_.firstBaseUpdate=M,_.lastBaseUpdate=j,s=_.shared.interleaved,s!==null){_=s;do C|=_.lane,_=_.next;while(_!==s)}else g===null&&(_.shared.lanes=0);ld|=C,o.lanes=C,o.memoizedState=x}}function eU(o,s,l){if(o=s.effects,s.effects=null,o!==null)for(s=0;s<o.length;s++){var h=o[s],_=h.callback;if(_!==null){if(h.callback=null,h=l,typeof _!="function")throw Error(Ie(191,_));_.call(h)}}}var jp={},ws=ac(jp),Rp=ac(jp),wp=ac(jp);function td(o){if(o===jp)throw Error(Ie(174));return o}function u0(o,s){switch(vn(wp,s),vn(Rp,o),vn(ws,jp),o=s.nodeType,o){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:VC(null,"");break;default:o=o===8?s.parentNode:s,s=o.namespaceURI||null,o=o.tagName,s=VC(s,o)}bn(ws),vn(ws,s)}function iu(){bn(ws),bn(Rp),bn(wp)}function S5(o){td(wp.current);var s=td(ws.current),l=VC(s,o.type);s!==l&&(vn(Rp,o),vn(ws,l))}function h0(o){Rp.current===o&&(bn(ws),bn(Rp))}var Un=ac(0);function vE(o){for(var s=o;s!==null;){if(s.tag===13){var l=s.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===o)break;for(;s.sibling===null;){if(s.return===null||s.return===o)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var _C=[];function p0(){for(var o=0;o<_C.length;o++)_C[o]._workInProgressVersionPrimary=null;_C.length=0}var J_=$s.ReactCurrentDispatcher,EC=$s.ReactCurrentBatchConfig,dd=0,Vn=null,dr=null,Sr=null,yE=!1,ap=!1,Ip=0,n$=0;function Ur(){throw Error(Ie(321))}function f0(o,s){if(s===null)return!1;for(var l=0;l<s.length&&l<o.length;l++)if(!zo(o[l],s[l]))return!1;return!0}function m0(o,s,l,h,_,g){if(dd=g,Vn=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,J_.current=o===null||o.memoizedState===null?s$:a$,o=l(h,_),ap){g=0;do{if(ap=!1,Ip=0,25<=g)throw Error(Ie(301));g+=1,Sr=dr=null,s.updateQueue=null,J_.current=c$,o=l(h,_)}while(ap)}if(J_.current=CE,s=dr!==null&&dr.next!==null,dd=0,Sr=dr=Vn=null,yE=!1,s)throw Error(Ie(300));return o}function _0(){var o=Ip!==0;return Ip=0,o}function ys(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Sr===null?Vn.memoizedState=Sr=o:Sr=Sr.next=o,Sr}function go(){if(dr===null){var o=Vn.alternate;o=o!==null?o.memoizedState:null}else o=dr.next;var s=Sr===null?Vn.memoizedState:Sr.next;if(s!==null)Sr=s,dr=o;else{if(o===null)throw Error(Ie(310));dr=o,o={memoizedState:dr.memoizedState,baseState:dr.baseState,baseQueue:dr.baseQueue,queue:dr.queue,next:null},Sr===null?Vn.memoizedState=Sr=o:Sr=Sr.next=o}return Sr}function Ap(o,s){return typeof s=="function"?s(o):s}function gC(o){var s=go(),l=s.queue;if(l===null)throw Error(Ie(311));l.lastRenderedReducer=o;var h=dr,_=h.baseQueue,g=l.pending;if(g!==null){if(_!==null){var C=_.next;_.next=g.next,g.next=C}h.baseQueue=_=g,l.pending=null}if(_!==null){g=_.next,h=h.baseState;var b=C=null,D=null,M=g;do{var j=M.lane;if((dd&j)===j)D!==null&&(D=D.next={lane:0,action:M.action,hasEagerState:M.hasEagerState,eagerState:M.eagerState,next:null}),h=M.hasEagerState?M.eagerState:o(h,M.action);else{var x={lane:j,action:M.action,hasEagerState:M.hasEagerState,eagerState:M.eagerState,next:null};D===null?(b=D=x,C=h):D=D.next=x,Vn.lanes|=j,ld|=j}M=M.next}while(M!==null&&M!==g);D===null?C=h:D.next=b,zo(h,s.memoizedState)||(_i=!0),s.memoizedState=h,s.baseState=C,s.baseQueue=D,l.lastRenderedState=h}if(o=l.interleaved,o!==null){_=o;do g=_.lane,Vn.lanes|=g,ld|=g,_=_.next;while(_!==o)}else _===null&&(l.lanes=0);return[s.memoizedState,l.dispatch]}function SC(o){var s=go(),l=s.queue;if(l===null)throw Error(Ie(311));l.lastRenderedReducer=o;var h=l.dispatch,_=l.pending,g=s.memoizedState;if(_!==null){l.pending=null;var C=_=_.next;do g=o(g,C.action),C=C.next;while(C!==_);zo(g,s.memoizedState)||(_i=!0),s.memoizedState=g,s.baseQueue===null&&(s.baseState=g),l.lastRenderedState=g}return[g,h]}function T5(){}function v5(o,s){var l=Vn,h=go(),_=s(),g=!zo(h.memoizedState,_);if(g&&(h.memoizedState=_,_i=!0),h=h.queue,E0(R5.bind(null,l,h,o),[o]),h.getSnapshot!==s||g||Sr!==null&&Sr.memoizedState.tag&1){if(l.flags|=2048,bp(9,C5.bind(null,l,h,_,s),void 0,null),Tr===null)throw Error(Ie(349));dd&30||y5(l,s,_)}return _}function y5(o,s,l){o.flags|=16384,o={getSnapshot:s,value:l},s=Vn.updateQueue,s===null?(s={lastEffect:null,stores:null},Vn.updateQueue=s,s.stores=[o]):(l=s.stores,l===null?s.stores=[o]:l.push(o))}function C5(o,s,l,h){s.value=l,s.getSnapshot=h,w5(s)&&I5(o)}function R5(o,s,l){return l(function(){w5(s)&&I5(o)})}function w5(o){var s=o.getSnapshot;o=o.value;try{var l=s();return!zo(o,l)}catch{return!0}}function I5(o){var s=Qs(o,1);s!==null&&Wo(s,o,1,-1)}function tU(o){var s=ys();return typeof o=="function"&&(o=o()),s.memoizedState=s.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ap,lastRenderedState:o},s.queue=o,o=o.dispatch=o$.bind(null,Vn,o),[s.memoizedState,o]}function bp(o,s,l,h){return o={tag:o,create:s,destroy:l,deps:h,next:null},s=Vn.updateQueue,s===null?(s={lastEffect:null,stores:null},Vn.updateQueue=s,s.lastEffect=o.next=o):(l=s.lastEffect,l===null?s.lastEffect=o.next=o:(h=l.next,l.next=o,o.next=h,s.lastEffect=o)),o}function A5(){return go().memoizedState}function X_(o,s,l,h){var _=ys();Vn.flags|=o,_.memoizedState=bp(1|s,l,void 0,h===void 0?null:h)}function KE(o,s,l,h){var _=go();h=h===void 0?null:h;var g=void 0;if(dr!==null){var C=dr.memoizedState;if(g=C.destroy,h!==null&&f0(h,C.deps)){_.memoizedState=bp(s,l,g,h);return}}Vn.flags|=o,_.memoizedState=bp(1|s,l,g,h)}function nU(o,s){return X_(8390656,8,o,s)}function E0(o,s){return KE(2048,8,o,s)}function b5(o,s){return KE(4,2,o,s)}function O5(o,s){return KE(4,4,o,s)}function N5(o,s){if(typeof s=="function")return o=o(),s(o),function(){s(null)};if(s!=null)return o=o(),s.current=o,function(){s.current=null}}function D5(o,s,l){return l=l!=null?l.concat([o]):null,KE(4,4,N5.bind(null,s,o),l)}function g0(){}function P5(o,s){var l=go();s=s===void 0?null:s;var h=l.memoizedState;return h!==null&&s!==null&&f0(s,h[1])?h[0]:(l.memoizedState=[o,s],o)}function L5(o,s){var l=go();s=s===void 0?null:s;var h=l.memoizedState;return h!==null&&s!==null&&f0(s,h[1])?h[0]:(o=o(),l.memoizedState=[o,s],o)}function k5(o,s,l){return dd&21?(zo(l,s)||(l=jV(),Vn.lanes|=l,ld|=l,o.baseState=!0),s):(o.baseState&&(o.baseState=!1,_i=!0),o.memoizedState=l)}function r$(o,s){var l=dn;dn=l!==0&&4>l?l:4,o(!0);var h=EC.transition;EC.transition={};try{o(!1),s()}finally{dn=l,EC.transition=h}}function M5(){return go().memoizedState}function i$(o,s,l){var h=tc(o);if(l={lane:h,action:l,hasEagerState:!1,eagerState:null,next:null},x5(o))U5(s,l);else if(l=E5(o,s,l,h),l!==null){var _=Qr();Wo(l,o,h,_),V5(l,s,h)}}function o$(o,s,l){var h=tc(o),_={lane:h,action:l,hasEagerState:!1,eagerState:null,next:null};if(x5(o))U5(s,_);else{var g=o.alternate;if(o.lanes===0&&(g===null||g.lanes===0)&&(g=s.lastRenderedReducer,g!==null))try{var C=s.lastRenderedState,b=g(C,l);if(_.hasEagerState=!0,_.eagerState=b,zo(b,C)){var D=s.interleaved;D===null?(_.next=_,d0(s)):(_.next=D.next,D.next=_),s.interleaved=_;return}}catch{}finally{}l=E5(o,s,_,h),l!==null&&(_=Qr(),Wo(l,o,h,_),V5(l,s,h))}}function x5(o){var s=o.alternate;return o===Vn||s!==null&&s===Vn}function U5(o,s){ap=yE=!0;var l=o.pending;l===null?s.next=s:(s.next=l.next,l.next=s),o.pending=s}function V5(o,s,l){if(l&4194240){var h=s.lanes;h&=o.pendingLanes,l|=h,s.lanes=l,JR(o,l)}}var CE={readContext:Eo,useCallback:Ur,useContext:Ur,useEffect:Ur,useImperativeHandle:Ur,useInsertionEffect:Ur,useLayoutEffect:Ur,useMemo:Ur,useReducer:Ur,useRef:Ur,useState:Ur,useDebugValue:Ur,useDeferredValue:Ur,useTransition:Ur,useMutableSource:Ur,useSyncExternalStore:Ur,useId:Ur,unstable_isNewReconciler:!1},s$={readContext:Eo,useCallback:function(o,s){return ys().memoizedState=[o,s===void 0?null:s],o},useContext:Eo,useEffect:nU,useImperativeHandle:function(o,s,l){return l=l!=null?l.concat([o]):null,X_(4194308,4,N5.bind(null,s,o),l)},useLayoutEffect:function(o,s){return X_(4194308,4,o,s)},useInsertionEffect:function(o,s){return X_(4,2,o,s)},useMemo:function(o,s){var l=ys();return s=s===void 0?null:s,o=o(),l.memoizedState=[o,s],o},useReducer:function(o,s,l){var h=ys();return s=l!==void 0?l(s):s,h.memoizedState=h.baseState=s,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:s},h.queue=o,o=o.dispatch=i$.bind(null,Vn,o),[h.memoizedState,o]},useRef:function(o){var s=ys();return o={current:o},s.memoizedState=o},useState:tU,useDebugValue:g0,useDeferredValue:function(o){return ys().memoizedState=o},useTransition:function(){var o=tU(!1),s=o[0];return o=r$.bind(null,o[1]),ys().memoizedState=o,[s,o]},useMutableSource:function(){},useSyncExternalStore:function(o,s,l){var h=Vn,_=ys();if(kn){if(l===void 0)throw Error(Ie(407));l=l()}else{if(l=s(),Tr===null)throw Error(Ie(349));dd&30||y5(h,s,l)}_.memoizedState=l;var g={value:l,getSnapshot:s};return _.queue=g,nU(R5.bind(null,h,g,o),[o]),h.flags|=2048,bp(9,C5.bind(null,h,g,l,s),void 0,null),l},useId:function(){var o=ys(),s=Tr.identifierPrefix;if(kn){var l=zs,h=Ks;l=(h&~(1<<32-Go(h)-1)).toString(32)+l,s=":"+s+"R"+l,l=Ip++,0<l&&(s+="H"+l.toString(32)),s+=":"}else l=n$++,s=":"+s+"r"+l.toString(32)+":";return o.memoizedState=s},unstable_isNewReconciler:!1},a$={readContext:Eo,useCallback:P5,useContext:Eo,useEffect:E0,useImperativeHandle:D5,useInsertionEffect:b5,useLayoutEffect:O5,useMemo:L5,useReducer:gC,useRef:A5,useState:function(){return gC(Ap)},useDebugValue:g0,useDeferredValue:function(o){var s=go();return k5(s,dr.memoizedState,o)},useTransition:function(){var o=gC(Ap)[0],s=go().memoizedState;return[o,s]},useMutableSource:T5,useSyncExternalStore:v5,useId:M5,unstable_isNewReconciler:!1},c$={readContext:Eo,useCallback:P5,useContext:Eo,useEffect:E0,useImperativeHandle:D5,useInsertionEffect:b5,useLayoutEffect:O5,useMemo:L5,useReducer:SC,useRef:A5,useState:function(){return SC(Ap)},useDebugValue:g0,useDeferredValue:function(o){var s=go();return dr===null?s.memoizedState=o:k5(s,dr.memoizedState,o)},useTransition:function(){var o=SC(Ap)[0],s=go().memoizedState;return[o,s]},useMutableSource:T5,useSyncExternalStore:v5,useId:M5,unstable_isNewReconciler:!1};function Vo(o,s){if(o&&o.defaultProps){s=Fn({},s),o=o.defaultProps;for(var l in o)s[l]===void 0&&(s[l]=o[l]);return s}return s}function oR(o,s,l,h){s=o.memoizedState,l=l(h,s),l=l==null?s:Fn({},s,l),o.memoizedState=l,o.lanes===0&&(o.updateQueue.baseState=l)}var zE={isMounted:function(o){return(o=o._reactInternals)?md(o)===o:!1},enqueueSetState:function(o,s,l){o=o._reactInternals;var h=Qr(),_=tc(o),g=qs(h,_);g.payload=s,l!=null&&(g.callback=l),s=$a(o,g,_),s!==null&&(Wo(s,o,_,h),q_(s,o,_))},enqueueReplaceState:function(o,s,l){o=o._reactInternals;var h=Qr(),_=tc(o),g=qs(h,_);g.tag=1,g.payload=s,l!=null&&(g.callback=l),s=$a(o,g,_),s!==null&&(Wo(s,o,_,h),q_(s,o,_))},enqueueForceUpdate:function(o,s){o=o._reactInternals;var l=Qr(),h=tc(o),_=qs(l,h);_.tag=2,s!=null&&(_.callback=s),s=$a(o,_,h),s!==null&&(Wo(s,o,h,l),q_(s,o,h))}};function rU(o,s,l,h,_,g,C){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(h,g,C):s.prototype&&s.prototype.isPureReactComponent?!Tp(l,h)||!Tp(_,g):!0}function j5(o,s,l){var h=!1,_=oc,g=s.contextType;return typeof g=="object"&&g!==null?g=Eo(g):(_=gi(s)?ad:Br.current,h=s.contextTypes,g=(h=h!=null)?tu(o,_):oc),s=new s(l,g),o.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=zE,o.stateNode=s,s._reactInternals=o,h&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=_,o.__reactInternalMemoizedMaskedChildContext=g),s}function iU(o,s,l,h){o=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(l,h),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(l,h),s.state!==o&&zE.enqueueReplaceState(s,s.state,null)}function sR(o,s,l,h){var _=o.stateNode;_.props=l,_.state=o.memoizedState,_.refs={},l0(o);var g=s.contextType;typeof g=="object"&&g!==null?_.context=Eo(g):(g=gi(s)?ad:Br.current,_.context=tu(o,g)),_.state=o.memoizedState,g=s.getDerivedStateFromProps,typeof g=="function"&&(oR(o,s,g,l),_.state=o.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(s=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),s!==_.state&&zE.enqueueReplaceState(_,_.state,null),TE(o,l,_,h),_.state=o.memoizedState),typeof _.componentDidMount=="function"&&(o.flags|=4194308)}function ou(o,s){try{var l="",h=s;do l+=xQ(h),h=h.return;while(h);var _=l}catch(g){_=`
Error generating stack: `+g.message+`
`+g.stack}return{value:o,source:s,stack:_,digest:null}}function TC(o,s,l){return{value:o,source:null,stack:l??null,digest:s??null}}function aR(o,s){try{console.error(s.value)}catch(l){setTimeout(function(){throw l})}}var d$=typeof WeakMap=="function"?WeakMap:Map;function F5(o,s,l){l=qs(-1,l),l.tag=3,l.payload={element:null};var h=s.value;return l.callback=function(){wE||(wE=!0,ER=h),aR(o,s)},l}function B5(o,s,l){l=qs(-1,l),l.tag=3;var h=o.type.getDerivedStateFromError;if(typeof h=="function"){var _=s.value;l.payload=function(){return h(_)},l.callback=function(){aR(o,s)}}var g=o.stateNode;return g!==null&&typeof g.componentDidCatch=="function"&&(l.callback=function(){aR(o,s),typeof h!="function"&&(ec===null?ec=new Set([this]):ec.add(this));var C=s.stack;this.componentDidCatch(s.value,{componentStack:C!==null?C:""})}),l}function oU(o,s,l){var h=o.pingCache;if(h===null){h=o.pingCache=new d$;var _=new Set;h.set(s,_)}else _=h.get(s),_===void 0&&(_=new Set,h.set(s,_));_.has(l)||(_.add(l),o=C$.bind(null,o,s,l),s.then(o,o))}function sU(o){do{var s;if((s=o.tag===13)&&(s=o.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return o;o=o.return}while(o!==null);return null}function aU(o,s,l,h,_){return o.mode&1?(o.flags|=65536,o.lanes=_,o):(o===s?o.flags|=65536:(o.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(s=qs(-1,1),s.tag=2,$a(l,s,1))),l.lanes|=1),o)}var l$=$s.ReactCurrentOwner,_i=!1;function Xr(o,s,l,h){s.child=o===null?_5(s,null,l,h):ru(s,o.child,l,h)}function cU(o,s,l,h,_){l=l.render;var g=s.ref;return Zl(s,_),h=m0(o,s,l,h,g,_),l=_0(),o!==null&&!_i?(s.updateQueue=o.updateQueue,s.flags&=-2053,o.lanes&=~_,Zs(o,s,_)):(kn&&l&&r0(s),s.flags|=1,Xr(o,s,h,_),s.child)}function dU(o,s,l,h,_){if(o===null){var g=l.type;return typeof g=="function"&&!I0(g)&&g.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(s.tag=15,s.type=g,G5(o,s,g,h,_)):(o=eE(l.type,null,h,s,s.mode,_),o.ref=s.ref,o.return=s,s.child=o)}if(g=o.child,!(o.lanes&_)){var C=g.memoizedProps;if(l=l.compare,l=l!==null?l:Tp,l(C,h)&&o.ref===s.ref)return Zs(o,s,_)}return s.flags|=1,o=nc(g,h),o.ref=s.ref,o.return=s,s.child=o}function G5(o,s,l,h,_){if(o!==null){var g=o.memoizedProps;if(Tp(g,h)&&o.ref===s.ref)if(_i=!1,s.pendingProps=h=g,(o.lanes&_)!==0)o.flags&131072&&(_i=!0);else return s.lanes=o.lanes,Zs(o,s,_)}return cR(o,s,l,h,_)}function W5(o,s,l){var h=s.pendingProps,_=h.children,g=o!==null?o.memoizedState:null;if(h.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},vn(Kl,ki),ki|=l;else{if(!(l&1073741824))return o=g!==null?g.baseLanes|l:l,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:o,cachePool:null,transitions:null},s.updateQueue=null,vn(Kl,ki),ki|=o,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},h=g!==null?g.baseLanes:l,vn(Kl,ki),ki|=h}else g!==null?(h=g.baseLanes|l,s.memoizedState=null):h=l,vn(Kl,ki),ki|=h;return Xr(o,s,_,l),s.child}function H5(o,s){var l=s.ref;(o===null&&l!==null||o!==null&&o.ref!==l)&&(s.flags|=512,s.flags|=2097152)}function cR(o,s,l,h,_){var g=gi(l)?ad:Br.current;return g=tu(s,g),Zl(s,_),l=m0(o,s,l,h,g,_),h=_0(),o!==null&&!_i?(s.updateQueue=o.updateQueue,s.flags&=-2053,o.lanes&=~_,Zs(o,s,_)):(kn&&h&&r0(s),s.flags|=1,Xr(o,s,l,_),s.child)}function lU(o,s,l,h,_){if(gi(l)){var g=!0;mE(s)}else g=!1;if(Zl(s,_),s.stateNode===null)Q_(o,s),j5(s,l,h),sR(s,l,h,_),h=!0;else if(o===null){var C=s.stateNode,b=s.memoizedProps;C.props=b;var D=C.context,M=l.contextType;typeof M=="object"&&M!==null?M=Eo(M):(M=gi(l)?ad:Br.current,M=tu(s,M));var j=l.getDerivedStateFromProps,x=typeof j=="function"||typeof C.getSnapshotBeforeUpdate=="function";x||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(b!==h||D!==M)&&iU(s,C,h,M),Ga=!1;var W=s.memoizedState;C.state=W,TE(s,h,C,_),D=s.memoizedState,b!==h||W!==D||Ei.current||Ga?(typeof j=="function"&&(oR(s,l,j,h),D=s.memoizedState),(b=Ga||rU(s,l,b,h,W,D,M))?(x||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(s.flags|=4194308)):(typeof C.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=h,s.memoizedState=D),C.props=h,C.state=D,C.context=M,h=b):(typeof C.componentDidMount=="function"&&(s.flags|=4194308),h=!1)}else{C=s.stateNode,g5(o,s),b=s.memoizedProps,M=s.type===s.elementType?b:Vo(s.type,b),C.props=M,x=s.pendingProps,W=C.context,D=l.contextType,typeof D=="object"&&D!==null?D=Eo(D):(D=gi(l)?ad:Br.current,D=tu(s,D));var te=l.getDerivedStateFromProps;(j=typeof te=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(b!==x||W!==D)&&iU(s,C,h,D),Ga=!1,W=s.memoizedState,C.state=W,TE(s,h,C,_);var X=s.memoizedState;b!==x||W!==X||Ei.current||Ga?(typeof te=="function"&&(oR(s,l,te,h),X=s.memoizedState),(M=Ga||rU(s,l,M,h,W,X,D)||!1)?(j||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(h,X,D),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(h,X,D)),typeof C.componentDidUpdate=="function"&&(s.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof C.componentDidUpdate!="function"||b===o.memoizedProps&&W===o.memoizedState||(s.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||b===o.memoizedProps&&W===o.memoizedState||(s.flags|=1024),s.memoizedProps=h,s.memoizedState=X),C.props=h,C.state=X,C.context=D,h=M):(typeof C.componentDidUpdate!="function"||b===o.memoizedProps&&W===o.memoizedState||(s.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||b===o.memoizedProps&&W===o.memoizedState||(s.flags|=1024),h=!1)}return dR(o,s,l,h,g,_)}function dR(o,s,l,h,_,g){H5(o,s);var C=(s.flags&128)!==0;if(!h&&!C)return _&&Jx(s,l,!1),Zs(o,s,g);h=s.stateNode,l$.current=s;var b=C&&typeof l.getDerivedStateFromError!="function"?null:h.render();return s.flags|=1,o!==null&&C?(s.child=ru(s,o.child,null,g),s.child=ru(s,null,b,g)):Xr(o,s,b,g),s.memoizedState=h.state,_&&Jx(s,l,!0),s.child}function K5(o){var s=o.stateNode;s.pendingContext?qx(o,s.pendingContext,s.pendingContext!==s.context):s.context&&qx(o,s.context,!1),u0(o,s.containerInfo)}function uU(o,s,l,h,_){return nu(),o0(_),s.flags|=256,Xr(o,s,l,h),s.child}var lR={dehydrated:null,treeContext:null,retryLane:0};function uR(o){return{baseLanes:o,cachePool:null,transitions:null}}function z5(o,s,l){var h=s.pendingProps,_=Un.current,g=!1,C=(s.flags&128)!==0,b;if((b=C)||(b=o!==null&&o.memoizedState===null?!1:(_&2)!==0),b?(g=!0,s.flags&=-129):(o===null||o.memoizedState!==null)&&(_|=1),vn(Un,_&1),o===null)return rR(s),o=s.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?(s.mode&1?o.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(C=h.children,o=h.fallback,g?(h=s.mode,g=s.child,C={mode:"hidden",children:C},!(h&1)&&g!==null?(g.childLanes=0,g.pendingProps=C):g=JE(C,h,0,null),o=rd(o,h,l,null),g.return=s,o.return=s,g.sibling=o,s.child=g,s.child.memoizedState=uR(l),s.memoizedState=lR,o):S0(s,C));if(_=o.memoizedState,_!==null&&(b=_.dehydrated,b!==null))return u$(o,s,C,h,b,_,l);if(g){g=h.fallback,C=s.mode,_=o.child,b=_.sibling;var D={mode:"hidden",children:h.children};return!(C&1)&&s.child!==_?(h=s.child,h.childLanes=0,h.pendingProps=D,s.deletions=null):(h=nc(_,D),h.subtreeFlags=_.subtreeFlags&14680064),b!==null?g=nc(b,g):(g=rd(g,C,l,null),g.flags|=2),g.return=s,h.return=s,h.sibling=g,s.child=h,h=g,g=s.child,C=o.child.memoizedState,C=C===null?uR(l):{baseLanes:C.baseLanes|l,cachePool:null,transitions:C.transitions},g.memoizedState=C,g.childLanes=o.childLanes&~l,s.memoizedState=lR,h}return g=o.child,o=g.sibling,h=nc(g,{mode:"visible",children:h.children}),!(s.mode&1)&&(h.lanes=l),h.return=s,h.sibling=null,o!==null&&(l=s.deletions,l===null?(s.deletions=[o],s.flags|=16):l.push(o)),s.child=h,s.memoizedState=null,h}function S0(o,s){return s=JE({mode:"visible",children:s},o.mode,0,null),s.return=o,o.child=s}function U_(o,s,l,h){return h!==null&&o0(h),ru(s,o.child,null,l),o=S0(s,s.pendingProps.children),o.flags|=2,s.memoizedState=null,o}function u$(o,s,l,h,_,g,C){if(l)return s.flags&256?(s.flags&=-257,h=TC(Error(Ie(422))),U_(o,s,C,h)):s.memoizedState!==null?(s.child=o.child,s.flags|=128,null):(g=h.fallback,_=s.mode,h=JE({mode:"visible",children:h.children},_,0,null),g=rd(g,_,C,null),g.flags|=2,h.return=s,g.return=s,h.sibling=g,s.child=h,s.mode&1&&ru(s,o.child,null,C),s.child.memoizedState=uR(C),s.memoizedState=lR,g);if(!(s.mode&1))return U_(o,s,C,null);if(_.data==="$!"){if(h=_.nextSibling&&_.nextSibling.dataset,h)var b=h.dgst;return h=b,g=Error(Ie(419)),h=TC(g,h,void 0),U_(o,s,C,h)}if(b=(C&o.childLanes)!==0,_i||b){if(h=Tr,h!==null){switch(C&-C){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(h.suspendedLanes|C)?0:_,_!==0&&_!==g.retryLane&&(g.retryLane=_,Qs(o,_),Wo(h,o,_,-1))}return w0(),h=TC(Error(Ie(421))),U_(o,s,C,h)}return _.data==="$?"?(s.flags|=128,s.child=o.child,s=R$.bind(null,o),_._reactRetry=s,null):(o=g.treeContext,Mi=Za(_.nextSibling),xi=s,kn=!0,Bo=null,o!==null&&(ho[po++]=Ks,ho[po++]=zs,ho[po++]=cd,Ks=o.id,zs=o.overflow,cd=s),s=S0(s,h.children),s.flags|=4096,s)}function hU(o,s,l){o.lanes|=s;var h=o.alternate;h!==null&&(h.lanes|=s),iR(o.return,s,l)}function vC(o,s,l,h,_){var g=o.memoizedState;g===null?o.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:h,tail:l,tailMode:_}:(g.isBackwards=s,g.rendering=null,g.renderingStartTime=0,g.last=h,g.tail=l,g.tailMode=_)}function Y5(o,s,l){var h=s.pendingProps,_=h.revealOrder,g=h.tail;if(Xr(o,s,h.children,l),h=Un.current,h&2)h=h&1|2,s.flags|=128;else{if(o!==null&&o.flags&128)e:for(o=s.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&hU(o,l,s);else if(o.tag===19)hU(o,l,s);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===s)break e;for(;o.sibling===null;){if(o.return===null||o.return===s)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}h&=1}if(vn(Un,h),!(s.mode&1))s.memoizedState=null;else switch(_){case"forwards":for(l=s.child,_=null;l!==null;)o=l.alternate,o!==null&&vE(o)===null&&(_=l),l=l.sibling;l=_,l===null?(_=s.child,s.child=null):(_=l.sibling,l.sibling=null),vC(s,!1,_,l,g);break;case"backwards":for(l=null,_=s.child,s.child=null;_!==null;){if(o=_.alternate,o!==null&&vE(o)===null){s.child=_;break}o=_.sibling,_.sibling=l,l=_,_=o}vC(s,!0,l,null,g);break;case"together":vC(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Q_(o,s){!(s.mode&1)&&o!==null&&(o.alternate=null,s.alternate=null,s.flags|=2)}function Zs(o,s,l){if(o!==null&&(s.dependencies=o.dependencies),ld|=s.lanes,!(l&s.childLanes))return null;if(o!==null&&s.child!==o.child)throw Error(Ie(153));if(s.child!==null){for(o=s.child,l=nc(o,o.pendingProps),s.child=l,l.return=s;o.sibling!==null;)o=o.sibling,l=l.sibling=nc(o,o.pendingProps),l.return=s;l.sibling=null}return s.child}function h$(o,s,l){switch(s.tag){case 3:K5(s),nu();break;case 5:S5(s);break;case 1:gi(s.type)&&mE(s);break;case 4:u0(s,s.stateNode.containerInfo);break;case 10:var h=s.type._context,_=s.memoizedProps.value;vn(gE,h._currentValue),h._currentValue=_;break;case 13:if(h=s.memoizedState,h!==null)return h.dehydrated!==null?(vn(Un,Un.current&1),s.flags|=128,null):l&s.child.childLanes?z5(o,s,l):(vn(Un,Un.current&1),o=Zs(o,s,l),o!==null?o.sibling:null);vn(Un,Un.current&1);break;case 19:if(h=(l&s.childLanes)!==0,o.flags&128){if(h)return Y5(o,s,l);s.flags|=128}if(_=s.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),vn(Un,Un.current),h)break;return null;case 22:case 23:return s.lanes=0,W5(o,s,l)}return Zs(o,s,l)}var q5,hR,J5,X5;q5=function(o,s){for(var l=s.child;l!==null;){if(l.tag===5||l.tag===6)o.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===s)break;for(;l.sibling===null;){if(l.return===null||l.return===s)return;l=l.return}l.sibling.return=l.return,l=l.sibling}};hR=function(){};J5=function(o,s,l,h){var _=o.memoizedProps;if(_!==h){o=s.stateNode,td(ws.current);var g=null;switch(l){case"input":_=kC(o,_),h=kC(o,h),g=[];break;case"select":_=Fn({},_,{value:void 0}),h=Fn({},h,{value:void 0}),g=[];break;case"textarea":_=UC(o,_),h=UC(o,h),g=[];break;default:typeof _.onClick!="function"&&typeof h.onClick=="function"&&(o.onclick=pE)}jC(l,h);var C;l=null;for(M in _)if(!h.hasOwnProperty(M)&&_.hasOwnProperty(M)&&_[M]!=null)if(M==="style"){var b=_[M];for(C in b)b.hasOwnProperty(C)&&(l||(l={}),l[C]="")}else M!=="dangerouslySetInnerHTML"&&M!=="children"&&M!=="suppressContentEditableWarning"&&M!=="suppressHydrationWarning"&&M!=="autoFocus"&&(pp.hasOwnProperty(M)?g||(g=[]):(g=g||[]).push(M,null));for(M in h){var D=h[M];if(b=_!=null?_[M]:void 0,h.hasOwnProperty(M)&&D!==b&&(D!=null||b!=null))if(M==="style")if(b){for(C in b)!b.hasOwnProperty(C)||D&&D.hasOwnProperty(C)||(l||(l={}),l[C]="");for(C in D)D.hasOwnProperty(C)&&b[C]!==D[C]&&(l||(l={}),l[C]=D[C])}else l||(g||(g=[]),g.push(M,l)),l=D;else M==="dangerouslySetInnerHTML"?(D=D?D.__html:void 0,b=b?b.__html:void 0,D!=null&&b!==D&&(g=g||[]).push(M,D)):M==="children"?typeof D!="string"&&typeof D!="number"||(g=g||[]).push(M,""+D):M!=="suppressContentEditableWarning"&&M!=="suppressHydrationWarning"&&(pp.hasOwnProperty(M)?(D!=null&&M==="onScroll"&&An("scroll",o),g||b===D||(g=[])):(g=g||[]).push(M,D))}l&&(g=g||[]).push("style",l);var M=g;(s.updateQueue=M)&&(s.flags|=4)}};X5=function(o,s,l,h){l!==h&&(s.flags|=4)};function Yh(o,s){if(!kn)switch(o.tailMode){case"hidden":s=o.tail;for(var l=null;s!==null;)s.alternate!==null&&(l=s),s=s.sibling;l===null?o.tail=null:l.sibling=null;break;case"collapsed":l=o.tail;for(var h=null;l!==null;)l.alternate!==null&&(h=l),l=l.sibling;h===null?s||o.tail===null?o.tail=null:o.tail.sibling=null:h.sibling=null}}function Vr(o){var s=o.alternate!==null&&o.alternate.child===o.child,l=0,h=0;if(s)for(var _=o.child;_!==null;)l|=_.lanes|_.childLanes,h|=_.subtreeFlags&14680064,h|=_.flags&14680064,_.return=o,_=_.sibling;else for(_=o.child;_!==null;)l|=_.lanes|_.childLanes,h|=_.subtreeFlags,h|=_.flags,_.return=o,_=_.sibling;return o.subtreeFlags|=h,o.childLanes=l,s}function p$(o,s,l){var h=s.pendingProps;switch(i0(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Vr(s),null;case 1:return gi(s.type)&&fE(),Vr(s),null;case 3:return h=s.stateNode,iu(),bn(Ei),bn(Br),p0(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(o===null||o.child===null)&&(M_(s)?s.flags|=4:o===null||o.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,Bo!==null&&(TR(Bo),Bo=null))),hR(o,s),Vr(s),null;case 5:h0(s);var _=td(wp.current);if(l=s.type,o!==null&&s.stateNode!=null)J5(o,s,l,h,_),o.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!h){if(s.stateNode===null)throw Error(Ie(166));return Vr(s),null}if(o=td(ws.current),M_(s)){h=s.stateNode,l=s.type;var g=s.memoizedProps;switch(h[Cs]=s,h[Cp]=g,o=(s.mode&1)!==0,l){case"dialog":An("cancel",h),An("close",h);break;case"iframe":case"object":case"embed":An("load",h);break;case"video":case"audio":for(_=0;_<$h.length;_++)An($h[_],h);break;case"source":An("error",h);break;case"img":case"image":case"link":An("error",h),An("load",h);break;case"details":An("toggle",h);break;case"input":vx(h,g),An("invalid",h);break;case"select":h._wrapperState={wasMultiple:!!g.multiple},An("invalid",h);break;case"textarea":Cx(h,g),An("invalid",h)}jC(l,g),_=null;for(var C in g)if(g.hasOwnProperty(C)){var b=g[C];C==="children"?typeof b=="string"?h.textContent!==b&&(g.suppressHydrationWarning!==!0&&k_(h.textContent,b,o),_=["children",b]):typeof b=="number"&&h.textContent!==""+b&&(g.suppressHydrationWarning!==!0&&k_(h.textContent,b,o),_=["children",""+b]):pp.hasOwnProperty(C)&&b!=null&&C==="onScroll"&&An("scroll",h)}switch(l){case"input":I_(h),yx(h,g,!0);break;case"textarea":I_(h),Rx(h);break;case"select":case"option":break;default:typeof g.onClick=="function"&&(h.onclick=pE)}h=_,s.updateQueue=h,h!==null&&(s.flags|=4)}else{C=_.nodeType===9?_:_.ownerDocument,o==="http://www.w3.org/1999/xhtml"&&(o=RV(l)),o==="http://www.w3.org/1999/xhtml"?l==="script"?(o=C.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)):typeof h.is=="string"?o=C.createElement(l,{is:h.is}):(o=C.createElement(l),l==="select"&&(C=o,h.multiple?C.multiple=!0:h.size&&(C.size=h.size))):o=C.createElementNS(o,l),o[Cs]=s,o[Cp]=h,q5(o,s,!1,!1),s.stateNode=o;e:{switch(C=FC(l,h),l){case"dialog":An("cancel",o),An("close",o),_=h;break;case"iframe":case"object":case"embed":An("load",o),_=h;break;case"video":case"audio":for(_=0;_<$h.length;_++)An($h[_],o);_=h;break;case"source":An("error",o),_=h;break;case"img":case"image":case"link":An("error",o),An("load",o),_=h;break;case"details":An("toggle",o),_=h;break;case"input":vx(o,h),_=kC(o,h),An("invalid",o);break;case"option":_=h;break;case"select":o._wrapperState={wasMultiple:!!h.multiple},_=Fn({},h,{value:void 0}),An("invalid",o);break;case"textarea":Cx(o,h),_=UC(o,h),An("invalid",o);break;default:_=h}jC(l,_),b=_;for(g in b)if(b.hasOwnProperty(g)){var D=b[g];g==="style"?AV(o,D):g==="dangerouslySetInnerHTML"?(D=D?D.__html:void 0,D!=null&&wV(o,D)):g==="children"?typeof D=="string"?(l!=="textarea"||D!=="")&&fp(o,D):typeof D=="number"&&fp(o,""+D):g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&g!=="autoFocus"&&(pp.hasOwnProperty(g)?D!=null&&g==="onScroll"&&An("scroll",o):D!=null&&WR(o,g,D,C))}switch(l){case"input":I_(o),yx(o,h,!1);break;case"textarea":I_(o),Rx(o);break;case"option":h.value!=null&&o.setAttribute("value",""+ic(h.value));break;case"select":o.multiple=!!h.multiple,g=h.value,g!=null?ql(o,!!h.multiple,g,!1):h.defaultValue!=null&&ql(o,!!h.multiple,h.defaultValue,!0);break;default:typeof _.onClick=="function"&&(o.onclick=pE)}switch(l){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}}h&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return Vr(s),null;case 6:if(o&&s.stateNode!=null)X5(o,s,o.memoizedProps,h);else{if(typeof h!="string"&&s.stateNode===null)throw Error(Ie(166));if(l=td(wp.current),td(ws.current),M_(s)){if(h=s.stateNode,l=s.memoizedProps,h[Cs]=s,(g=h.nodeValue!==l)&&(o=xi,o!==null))switch(o.tag){case 3:k_(h.nodeValue,l,(o.mode&1)!==0);break;case 5:o.memoizedProps.suppressHydrationWarning!==!0&&k_(h.nodeValue,l,(o.mode&1)!==0)}g&&(s.flags|=4)}else h=(l.nodeType===9?l:l.ownerDocument).createTextNode(h),h[Cs]=s,s.stateNode=h}return Vr(s),null;case 13:if(bn(Un),h=s.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(kn&&Mi!==null&&s.mode&1&&!(s.flags&128))f5(),nu(),s.flags|=98560,g=!1;else if(g=M_(s),h!==null&&h.dehydrated!==null){if(o===null){if(!g)throw Error(Ie(318));if(g=s.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(Ie(317));g[Cs]=s}else nu(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;Vr(s),g=!1}else Bo!==null&&(TR(Bo),Bo=null),g=!0;if(!g)return s.flags&65536?s:null}return s.flags&128?(s.lanes=l,s):(h=h!==null,h!==(o!==null&&o.memoizedState!==null)&&h&&(s.child.flags|=8192,s.mode&1&&(o===null||Un.current&1?lr===0&&(lr=3):w0())),s.updateQueue!==null&&(s.flags|=4),Vr(s),null);case 4:return iu(),hR(o,s),o===null&&vp(s.stateNode.containerInfo),Vr(s),null;case 10:return c0(s.type._context),Vr(s),null;case 17:return gi(s.type)&&fE(),Vr(s),null;case 19:if(bn(Un),g=s.memoizedState,g===null)return Vr(s),null;if(h=(s.flags&128)!==0,C=g.rendering,C===null)if(h)Yh(g,!1);else{if(lr!==0||o!==null&&o.flags&128)for(o=s.child;o!==null;){if(C=vE(o),C!==null){for(s.flags|=128,Yh(g,!1),h=C.updateQueue,h!==null&&(s.updateQueue=h,s.flags|=4),s.subtreeFlags=0,h=l,l=s.child;l!==null;)g=l,o=h,g.flags&=14680066,C=g.alternate,C===null?(g.childLanes=0,g.lanes=o,g.child=null,g.subtreeFlags=0,g.memoizedProps=null,g.memoizedState=null,g.updateQueue=null,g.dependencies=null,g.stateNode=null):(g.childLanes=C.childLanes,g.lanes=C.lanes,g.child=C.child,g.subtreeFlags=0,g.deletions=null,g.memoizedProps=C.memoizedProps,g.memoizedState=C.memoizedState,g.updateQueue=C.updateQueue,g.type=C.type,o=C.dependencies,g.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),l=l.sibling;return vn(Un,Un.current&1|2),s.child}o=o.sibling}g.tail!==null&&Zn()>su&&(s.flags|=128,h=!0,Yh(g,!1),s.lanes=4194304)}else{if(!h)if(o=vE(C),o!==null){if(s.flags|=128,h=!0,l=o.updateQueue,l!==null&&(s.updateQueue=l,s.flags|=4),Yh(g,!0),g.tail===null&&g.tailMode==="hidden"&&!C.alternate&&!kn)return Vr(s),null}else 2*Zn()-g.renderingStartTime>su&&l!==1073741824&&(s.flags|=128,h=!0,Yh(g,!1),s.lanes=4194304);g.isBackwards?(C.sibling=s.child,s.child=C):(l=g.last,l!==null?l.sibling=C:s.child=C,g.last=C)}return g.tail!==null?(s=g.tail,g.rendering=s,g.tail=s.sibling,g.renderingStartTime=Zn(),s.sibling=null,l=Un.current,vn(Un,h?l&1|2:l&1),s):(Vr(s),null);case 22:case 23:return R0(),h=s.memoizedState!==null,o!==null&&o.memoizedState!==null!==h&&(s.flags|=8192),h&&s.mode&1?ki&1073741824&&(Vr(s),s.subtreeFlags&6&&(s.flags|=8192)):Vr(s),null;case 24:return null;case 25:return null}throw Error(Ie(156,s.tag))}function f$(o,s){switch(i0(s),s.tag){case 1:return gi(s.type)&&fE(),o=s.flags,o&65536?(s.flags=o&-65537|128,s):null;case 3:return iu(),bn(Ei),bn(Br),p0(),o=s.flags,o&65536&&!(o&128)?(s.flags=o&-65537|128,s):null;case 5:return h0(s),null;case 13:if(bn(Un),o=s.memoizedState,o!==null&&o.dehydrated!==null){if(s.alternate===null)throw Error(Ie(340));nu()}return o=s.flags,o&65536?(s.flags=o&-65537|128,s):null;case 19:return bn(Un),null;case 4:return iu(),null;case 10:return c0(s.type._context),null;case 22:case 23:return R0(),null;case 24:return null;default:return null}}var V_=!1,Fr=!1,m$=typeof WeakSet=="function"?WeakSet:Set,je=null;function Hl(o,s){var l=o.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(h){zn(o,s,h)}else l.current=null}function pR(o,s,l){try{l()}catch(h){zn(o,s,h)}}var pU=!1;function _$(o,s){if(XC=lE,o=t5(),n0(o)){if("selectionStart"in o)var l={start:o.selectionStart,end:o.selectionEnd};else e:{l=(l=o.ownerDocument)&&l.defaultView||window;var h=l.getSelection&&l.getSelection();if(h&&h.rangeCount!==0){l=h.anchorNode;var _=h.anchorOffset,g=h.focusNode;h=h.focusOffset;try{l.nodeType,g.nodeType}catch{l=null;break e}var C=0,b=-1,D=-1,M=0,j=0,x=o,W=null;t:for(;;){for(var te;x!==l||_!==0&&x.nodeType!==3||(b=C+_),x!==g||h!==0&&x.nodeType!==3||(D=C+h),x.nodeType===3&&(C+=x.nodeValue.length),(te=x.firstChild)!==null;)W=x,x=te;for(;;){if(x===o)break t;if(W===l&&++M===_&&(b=C),W===g&&++j===h&&(D=C),(te=x.nextSibling)!==null)break;x=W,W=x.parentNode}x=te}l=b===-1||D===-1?null:{start:b,end:D}}else l=null}l=l||{start:0,end:0}}else l=null;for(QC={focusedElem:o,selectionRange:l},lE=!1,je=s;je!==null;)if(s=je,o=s.child,(s.subtreeFlags&1028)!==0&&o!==null)o.return=s,je=o;else for(;je!==null;){s=je;try{var X=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(X!==null){var ie=X.memoizedProps,ve=X.memoizedState,K=s.stateNode,H=K.getSnapshotBeforeUpdate(s.elementType===s.type?ie:Vo(s.type,ie),ve);K.__reactInternalSnapshotBeforeUpdate=H}break;case 3:var Y=s.stateNode.containerInfo;Y.nodeType===1?Y.textContent="":Y.nodeType===9&&Y.documentElement&&Y.removeChild(Y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ie(163))}}catch(pe){zn(s,s.return,pe)}if(o=s.sibling,o!==null){o.return=s.return,je=o;break}je=s.return}return X=pU,pU=!1,X}function cp(o,s,l){var h=s.updateQueue;if(h=h!==null?h.lastEffect:null,h!==null){var _=h=h.next;do{if((_.tag&o)===o){var g=_.destroy;_.destroy=void 0,g!==void 0&&pR(s,l,g)}_=_.next}while(_!==h)}}function YE(o,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var l=s=s.next;do{if((l.tag&o)===o){var h=l.create;l.destroy=h()}l=l.next}while(l!==s)}}function fR(o){var s=o.ref;if(s!==null){var l=o.stateNode;switch(o.tag){case 5:o=l;break;default:o=l}typeof s=="function"?s(o):s.current=o}}function Q5(o){var s=o.alternate;s!==null&&(o.alternate=null,Q5(s)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(s=o.stateNode,s!==null&&(delete s[Cs],delete s[Cp],delete s[eR],delete s[ZZ],delete s[$Z])),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function Z5(o){return o.tag===5||o.tag===3||o.tag===4}function fU(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||Z5(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function mR(o,s,l){var h=o.tag;if(h===5||h===6)o=o.stateNode,s?l.nodeType===8?l.parentNode.insertBefore(o,s):l.insertBefore(o,s):(l.nodeType===8?(s=l.parentNode,s.insertBefore(o,l)):(s=l,s.appendChild(o)),l=l._reactRootContainer,l!=null||s.onclick!==null||(s.onclick=pE));else if(h!==4&&(o=o.child,o!==null))for(mR(o,s,l),o=o.sibling;o!==null;)mR(o,s,l),o=o.sibling}function _R(o,s,l){var h=o.tag;if(h===5||h===6)o=o.stateNode,s?l.insertBefore(o,s):l.appendChild(o);else if(h!==4&&(o=o.child,o!==null))for(_R(o,s,l),o=o.sibling;o!==null;)_R(o,s,l),o=o.sibling}var Ir=null,Fo=!1;function ja(o,s,l){for(l=l.child;l!==null;)$5(o,s,l),l=l.sibling}function $5(o,s,l){if(Rs&&typeof Rs.onCommitFiberUnmount=="function")try{Rs.onCommitFiberUnmount(jE,l)}catch{}switch(l.tag){case 5:Fr||Hl(l,s);case 6:var h=Ir,_=Fo;Ir=null,ja(o,s,l),Ir=h,Fo=_,Ir!==null&&(Fo?(o=Ir,l=l.stateNode,o.nodeType===8?o.parentNode.removeChild(l):o.removeChild(l)):Ir.removeChild(l.stateNode));break;case 18:Ir!==null&&(Fo?(o=Ir,l=l.stateNode,o.nodeType===8?fC(o.parentNode,l):o.nodeType===1&&fC(o,l),gp(o)):fC(Ir,l.stateNode));break;case 4:h=Ir,_=Fo,Ir=l.stateNode.containerInfo,Fo=!0,ja(o,s,l),Ir=h,Fo=_;break;case 0:case 11:case 14:case 15:if(!Fr&&(h=l.updateQueue,h!==null&&(h=h.lastEffect,h!==null))){_=h=h.next;do{var g=_,C=g.destroy;g=g.tag,C!==void 0&&(g&2||g&4)&&pR(l,s,C),_=_.next}while(_!==h)}ja(o,s,l);break;case 1:if(!Fr&&(Hl(l,s),h=l.stateNode,typeof h.componentWillUnmount=="function"))try{h.props=l.memoizedProps,h.state=l.memoizedState,h.componentWillUnmount()}catch(b){zn(l,s,b)}ja(o,s,l);break;case 21:ja(o,s,l);break;case 22:l.mode&1?(Fr=(h=Fr)||l.memoizedState!==null,ja(o,s,l),Fr=h):ja(o,s,l);break;default:ja(o,s,l)}}function mU(o){var s=o.updateQueue;if(s!==null){o.updateQueue=null;var l=o.stateNode;l===null&&(l=o.stateNode=new m$),s.forEach(function(h){var _=w$.bind(null,o,h);l.has(h)||(l.add(h),h.then(_,_))})}}function Uo(o,s){var l=s.deletions;if(l!==null)for(var h=0;h<l.length;h++){var _=l[h];try{var g=o,C=s,b=C;e:for(;b!==null;){switch(b.tag){case 5:Ir=b.stateNode,Fo=!1;break e;case 3:Ir=b.stateNode.containerInfo,Fo=!0;break e;case 4:Ir=b.stateNode.containerInfo,Fo=!0;break e}b=b.return}if(Ir===null)throw Error(Ie(160));$5(g,C,_),Ir=null,Fo=!1;var D=_.alternate;D!==null&&(D.return=null),_.return=null}catch(M){zn(_,s,M)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)e4(s,o),s=s.sibling}function e4(o,s){var l=o.alternate,h=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(Uo(s,o),vs(o),h&4){try{cp(3,o,o.return),YE(3,o)}catch(ie){zn(o,o.return,ie)}try{cp(5,o,o.return)}catch(ie){zn(o,o.return,ie)}}break;case 1:Uo(s,o),vs(o),h&512&&l!==null&&Hl(l,l.return);break;case 5:if(Uo(s,o),vs(o),h&512&&l!==null&&Hl(l,l.return),o.flags&32){var _=o.stateNode;try{fp(_,"")}catch(ie){zn(o,o.return,ie)}}if(h&4&&(_=o.stateNode,_!=null)){var g=o.memoizedProps,C=l!==null?l.memoizedProps:g,b=o.type,D=o.updateQueue;if(o.updateQueue=null,D!==null)try{b==="input"&&g.type==="radio"&&g.name!=null&&yV(_,g),FC(b,C);var M=FC(b,g);for(C=0;C<D.length;C+=2){var j=D[C],x=D[C+1];j==="style"?AV(_,x):j==="dangerouslySetInnerHTML"?wV(_,x):j==="children"?fp(_,x):WR(_,j,x,M)}switch(b){case"input":MC(_,g);break;case"textarea":CV(_,g);break;case"select":var W=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!g.multiple;var te=g.value;te!=null?ql(_,!!g.multiple,te,!1):W!==!!g.multiple&&(g.defaultValue!=null?ql(_,!!g.multiple,g.defaultValue,!0):ql(_,!!g.multiple,g.multiple?[]:"",!1))}_[Cp]=g}catch(ie){zn(o,o.return,ie)}}break;case 6:if(Uo(s,o),vs(o),h&4){if(o.stateNode===null)throw Error(Ie(162));_=o.stateNode,g=o.memoizedProps;try{_.nodeValue=g}catch(ie){zn(o,o.return,ie)}}break;case 3:if(Uo(s,o),vs(o),h&4&&l!==null&&l.memoizedState.isDehydrated)try{gp(s.containerInfo)}catch(ie){zn(o,o.return,ie)}break;case 4:Uo(s,o),vs(o);break;case 13:Uo(s,o),vs(o),_=o.child,_.flags&8192&&(g=_.memoizedState!==null,_.stateNode.isHidden=g,!g||_.alternate!==null&&_.alternate.memoizedState!==null||(y0=Zn())),h&4&&mU(o);break;case 22:if(j=l!==null&&l.memoizedState!==null,o.mode&1?(Fr=(M=Fr)||j,Uo(s,o),Fr=M):Uo(s,o),vs(o),h&8192){if(M=o.memoizedState!==null,(o.stateNode.isHidden=M)&&!j&&o.mode&1)for(je=o,j=o.child;j!==null;){for(x=je=j;je!==null;){switch(W=je,te=W.child,W.tag){case 0:case 11:case 14:case 15:cp(4,W,W.return);break;case 1:Hl(W,W.return);var X=W.stateNode;if(typeof X.componentWillUnmount=="function"){h=W,l=W.return;try{s=h,X.props=s.memoizedProps,X.state=s.memoizedState,X.componentWillUnmount()}catch(ie){zn(h,l,ie)}}break;case 5:Hl(W,W.return);break;case 22:if(W.memoizedState!==null){EU(x);continue}}te!==null?(te.return=W,je=te):EU(x)}j=j.sibling}e:for(j=null,x=o;;){if(x.tag===5){if(j===null){j=x;try{_=x.stateNode,M?(g=_.style,typeof g.setProperty=="function"?g.setProperty("display","none","important"):g.display="none"):(b=x.stateNode,D=x.memoizedProps.style,C=D!=null&&D.hasOwnProperty("display")?D.display:null,b.style.display=IV("display",C))}catch(ie){zn(o,o.return,ie)}}}else if(x.tag===6){if(j===null)try{x.stateNode.nodeValue=M?"":x.memoizedProps}catch(ie){zn(o,o.return,ie)}}else if((x.tag!==22&&x.tag!==23||x.memoizedState===null||x===o)&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===o)break e;for(;x.sibling===null;){if(x.return===null||x.return===o)break e;j===x&&(j=null),x=x.return}j===x&&(j=null),x.sibling.return=x.return,x=x.sibling}}break;case 19:Uo(s,o),vs(o),h&4&&mU(o);break;case 21:break;default:Uo(s,o),vs(o)}}function vs(o){var s=o.flags;if(s&2){try{e:{for(var l=o.return;l!==null;){if(Z5(l)){var h=l;break e}l=l.return}throw Error(Ie(160))}switch(h.tag){case 5:var _=h.stateNode;h.flags&32&&(fp(_,""),h.flags&=-33);var g=fU(o);_R(o,g,_);break;case 3:case 4:var C=h.stateNode.containerInfo,b=fU(o);mR(o,b,C);break;default:throw Error(Ie(161))}}catch(D){zn(o,o.return,D)}o.flags&=-3}s&4096&&(o.flags&=-4097)}function E$(o,s,l){je=o,t4(o)}function t4(o,s,l){for(var h=(o.mode&1)!==0;je!==null;){var _=je,g=_.child;if(_.tag===22&&h){var C=_.memoizedState!==null||V_;if(!C){var b=_.alternate,D=b!==null&&b.memoizedState!==null||Fr;b=V_;var M=Fr;if(V_=C,(Fr=D)&&!M)for(je=_;je!==null;)C=je,D=C.child,C.tag===22&&C.memoizedState!==null?gU(_):D!==null?(D.return=C,je=D):gU(_);for(;g!==null;)je=g,t4(g),g=g.sibling;je=_,V_=b,Fr=M}_U(o)}else _.subtreeFlags&8772&&g!==null?(g.return=_,je=g):_U(o)}}function _U(o){for(;je!==null;){var s=je;if(s.flags&8772){var l=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:Fr||YE(5,s);break;case 1:var h=s.stateNode;if(s.flags&4&&!Fr)if(l===null)h.componentDidMount();else{var _=s.elementType===s.type?l.memoizedProps:Vo(s.type,l.memoizedProps);h.componentDidUpdate(_,l.memoizedState,h.__reactInternalSnapshotBeforeUpdate)}var g=s.updateQueue;g!==null&&eU(s,g,h);break;case 3:var C=s.updateQueue;if(C!==null){if(l=null,s.child!==null)switch(s.child.tag){case 5:l=s.child.stateNode;break;case 1:l=s.child.stateNode}eU(s,C,l)}break;case 5:var b=s.stateNode;if(l===null&&s.flags&4){l=b;var D=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":D.autoFocus&&l.focus();break;case"img":D.src&&(l.src=D.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var M=s.alternate;if(M!==null){var j=M.memoizedState;if(j!==null){var x=j.dehydrated;x!==null&&gp(x)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ie(163))}Fr||s.flags&512&&fR(s)}catch(W){zn(s,s.return,W)}}if(s===o){je=null;break}if(l=s.sibling,l!==null){l.return=s.return,je=l;break}je=s.return}}function EU(o){for(;je!==null;){var s=je;if(s===o){je=null;break}var l=s.sibling;if(l!==null){l.return=s.return,je=l;break}je=s.return}}function gU(o){for(;je!==null;){var s=je;try{switch(s.tag){case 0:case 11:case 15:var l=s.return;try{YE(4,s)}catch(D){zn(s,l,D)}break;case 1:var h=s.stateNode;if(typeof h.componentDidMount=="function"){var _=s.return;try{h.componentDidMount()}catch(D){zn(s,_,D)}}var g=s.return;try{fR(s)}catch(D){zn(s,g,D)}break;case 5:var C=s.return;try{fR(s)}catch(D){zn(s,C,D)}}}catch(D){zn(s,s.return,D)}if(s===o){je=null;break}var b=s.sibling;if(b!==null){b.return=s.return,je=b;break}je=s.return}}var g$=Math.ceil,RE=$s.ReactCurrentDispatcher,T0=$s.ReactCurrentOwner,mo=$s.ReactCurrentBatchConfig,Yt=0,Tr=null,nr=null,Ar=0,ki=0,Kl=ac(0),lr=0,Op=null,ld=0,qE=0,v0=0,dp=null,mi=null,y0=0,su=1/0,Ws=null,wE=!1,ER=null,ec=null,j_=!1,za=null,IE=0,lp=0,gR=null,Z_=-1,$_=0;function Qr(){return Yt&6?Zn():Z_!==-1?Z_:Z_=Zn()}function tc(o){return o.mode&1?Yt&2&&Ar!==0?Ar&-Ar:t$.transition!==null?($_===0&&($_=jV()),$_):(o=dn,o!==0||(o=window.event,o=o===void 0?16:zV(o.type)),o):1}function Wo(o,s,l,h){if(50<lp)throw lp=0,gR=null,Error(Ie(185));xp(o,l,h),(!(Yt&2)||o!==Tr)&&(o===Tr&&(!(Yt&2)&&(qE|=l),lr===4&&Ha(o,Ar)),Si(o,h),l===1&&Yt===0&&!(s.mode&1)&&(su=Zn()+500,HE&&cc()))}function Si(o,s){var l=o.callbackNode;tZ(o,s);var h=dE(o,o===Tr?Ar:0);if(h===0)l!==null&&Ax(l),o.callbackNode=null,o.callbackPriority=0;else if(s=h&-h,o.callbackPriority!==s){if(l!=null&&Ax(l),s===1)o.tag===0?e$(SU.bind(null,o)):u5(SU.bind(null,o)),XZ(function(){!(Yt&6)&&cc()}),l=null;else{switch(FV(h)){case 1:l=qR;break;case 4:l=UV;break;case 16:l=cE;break;case 536870912:l=VV;break;default:l=cE}l=d4(l,n4.bind(null,o))}o.callbackPriority=s,o.callbackNode=l}}function n4(o,s){if(Z_=-1,$_=0,Yt&6)throw Error(Ie(327));var l=o.callbackNode;if($l()&&o.callbackNode!==l)return null;var h=dE(o,o===Tr?Ar:0);if(h===0)return null;if(h&30||h&o.expiredLanes||s)s=AE(o,h);else{s=h;var _=Yt;Yt|=2;var g=i4();(Tr!==o||Ar!==s)&&(Ws=null,su=Zn()+500,nd(o,s));do try{v$();break}catch(b){r4(o,b)}while(!0);a0(),RE.current=g,Yt=_,nr!==null?s=0:(Tr=null,Ar=0,s=lr)}if(s!==0){if(s===2&&(_=KC(o),_!==0&&(h=_,s=SR(o,_))),s===1)throw l=Op,nd(o,0),Ha(o,h),Si(o,Zn()),l;if(s===6)Ha(o,h);else{if(_=o.current.alternate,!(h&30)&&!S$(_)&&(s=AE(o,h),s===2&&(g=KC(o),g!==0&&(h=g,s=SR(o,g))),s===1))throw l=Op,nd(o,0),Ha(o,h),Si(o,Zn()),l;switch(o.finishedWork=_,o.finishedLanes=h,s){case 0:case 1:throw Error(Ie(345));case 2:Qc(o,mi,Ws);break;case 3:if(Ha(o,h),(h&130023424)===h&&(s=y0+500-Zn(),10<s)){if(dE(o,0)!==0)break;if(_=o.suspendedLanes,(_&h)!==h){Qr(),o.pingedLanes|=o.suspendedLanes&_;break}o.timeoutHandle=$C(Qc.bind(null,o,mi,Ws),s);break}Qc(o,mi,Ws);break;case 4:if(Ha(o,h),(h&4194240)===h)break;for(s=o.eventTimes,_=-1;0<h;){var C=31-Go(h);g=1<<C,C=s[C],C>_&&(_=C),h&=~g}if(h=_,h=Zn()-h,h=(120>h?120:480>h?480:1080>h?1080:1920>h?1920:3e3>h?3e3:4320>h?4320:1960*g$(h/1960))-h,10<h){o.timeoutHandle=$C(Qc.bind(null,o,mi,Ws),h);break}Qc(o,mi,Ws);break;case 5:Qc(o,mi,Ws);break;default:throw Error(Ie(329))}}}return Si(o,Zn()),o.callbackNode===l?n4.bind(null,o):null}function SR(o,s){var l=dp;return o.current.memoizedState.isDehydrated&&(nd(o,s).flags|=256),o=AE(o,s),o!==2&&(s=mi,mi=l,s!==null&&TR(s)),o}function TR(o){mi===null?mi=o:mi.push.apply(mi,o)}function S$(o){for(var s=o;;){if(s.flags&16384){var l=s.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var h=0;h<l.length;h++){var _=l[h],g=_.getSnapshot;_=_.value;try{if(!zo(g(),_))return!1}catch{return!1}}}if(l=s.child,s.subtreeFlags&16384&&l!==null)l.return=s,s=l;else{if(s===o)break;for(;s.sibling===null;){if(s.return===null||s.return===o)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Ha(o,s){for(s&=~v0,s&=~qE,o.suspendedLanes|=s,o.pingedLanes&=~s,o=o.expirationTimes;0<s;){var l=31-Go(s),h=1<<l;o[l]=-1,s&=~h}}function SU(o){if(Yt&6)throw Error(Ie(327));$l();var s=dE(o,0);if(!(s&1))return Si(o,Zn()),null;var l=AE(o,s);if(o.tag!==0&&l===2){var h=KC(o);h!==0&&(s=h,l=SR(o,h))}if(l===1)throw l=Op,nd(o,0),Ha(o,s),Si(o,Zn()),l;if(l===6)throw Error(Ie(345));return o.finishedWork=o.current.alternate,o.finishedLanes=s,Qc(o,mi,Ws),Si(o,Zn()),null}function C0(o,s){var l=Yt;Yt|=1;try{return o(s)}finally{Yt=l,Yt===0&&(su=Zn()+500,HE&&cc())}}function ud(o){za!==null&&za.tag===0&&!(Yt&6)&&$l();var s=Yt;Yt|=1;var l=mo.transition,h=dn;try{if(mo.transition=null,dn=1,o)return o()}finally{dn=h,mo.transition=l,Yt=s,!(Yt&6)&&cc()}}function R0(){ki=Kl.current,bn(Kl)}function nd(o,s){o.finishedWork=null,o.finishedLanes=0;var l=o.timeoutHandle;if(l!==-1&&(o.timeoutHandle=-1,JZ(l)),nr!==null)for(l=nr.return;l!==null;){var h=l;switch(i0(h),h.tag){case 1:h=h.type.childContextTypes,h!=null&&fE();break;case 3:iu(),bn(Ei),bn(Br),p0();break;case 5:h0(h);break;case 4:iu();break;case 13:bn(Un);break;case 19:bn(Un);break;case 10:c0(h.type._context);break;case 22:case 23:R0()}l=l.return}if(Tr=o,nr=o=nc(o.current,null),Ar=ki=s,lr=0,Op=null,v0=qE=ld=0,mi=dp=null,ed!==null){for(s=0;s<ed.length;s++)if(l=ed[s],h=l.interleaved,h!==null){l.interleaved=null;var _=h.next,g=l.pending;if(g!==null){var C=g.next;g.next=_,h.next=C}l.pending=h}ed=null}return o}function r4(o,s){do{var l=nr;try{if(a0(),J_.current=CE,yE){for(var h=Vn.memoizedState;h!==null;){var _=h.queue;_!==null&&(_.pending=null),h=h.next}yE=!1}if(dd=0,Sr=dr=Vn=null,ap=!1,Ip=0,T0.current=null,l===null||l.return===null){lr=1,Op=s,nr=null;break}e:{var g=o,C=l.return,b=l,D=s;if(s=Ar,b.flags|=32768,D!==null&&typeof D=="object"&&typeof D.then=="function"){var M=D,j=b,x=j.tag;if(!(j.mode&1)&&(x===0||x===11||x===15)){var W=j.alternate;W?(j.updateQueue=W.updateQueue,j.memoizedState=W.memoizedState,j.lanes=W.lanes):(j.updateQueue=null,j.memoizedState=null)}var te=sU(C);if(te!==null){te.flags&=-257,aU(te,C,b,g,s),te.mode&1&&oU(g,M,s),s=te,D=M;var X=s.updateQueue;if(X===null){var ie=new Set;ie.add(D),s.updateQueue=ie}else X.add(D);break e}else{if(!(s&1)){oU(g,M,s),w0();break e}D=Error(Ie(426))}}else if(kn&&b.mode&1){var ve=sU(C);if(ve!==null){!(ve.flags&65536)&&(ve.flags|=256),aU(ve,C,b,g,s),o0(ou(D,b));break e}}g=D=ou(D,b),lr!==4&&(lr=2),dp===null?dp=[g]:dp.push(g),g=C;do{switch(g.tag){case 3:g.flags|=65536,s&=-s,g.lanes|=s;var K=F5(g,D,s);$x(g,K);break e;case 1:b=D;var H=g.type,Y=g.stateNode;if(!(g.flags&128)&&(typeof H.getDerivedStateFromError=="function"||Y!==null&&typeof Y.componentDidCatch=="function"&&(ec===null||!ec.has(Y)))){g.flags|=65536,s&=-s,g.lanes|=s;var pe=B5(g,b,s);$x(g,pe);break e}}g=g.return}while(g!==null)}s4(l)}catch(Ne){s=Ne,nr===l&&l!==null&&(nr=l=l.return);continue}break}while(!0)}function i4(){var o=RE.current;return RE.current=CE,o===null?CE:o}function w0(){(lr===0||lr===3||lr===2)&&(lr=4),Tr===null||!(ld&268435455)&&!(qE&268435455)||Ha(Tr,Ar)}function AE(o,s){var l=Yt;Yt|=2;var h=i4();(Tr!==o||Ar!==s)&&(Ws=null,nd(o,s));do try{T$();break}catch(_){r4(o,_)}while(!0);if(a0(),Yt=l,RE.current=h,nr!==null)throw Error(Ie(261));return Tr=null,Ar=0,lr}function T$(){for(;nr!==null;)o4(nr)}function v$(){for(;nr!==null&&!zQ();)o4(nr)}function o4(o){var s=c4(o.alternate,o,ki);o.memoizedProps=o.pendingProps,s===null?s4(o):nr=s,T0.current=null}function s4(o){var s=o;do{var l=s.alternate;if(o=s.return,s.flags&32768){if(l=f$(l,s),l!==null){l.flags&=32767,nr=l;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{lr=6,nr=null;return}}else if(l=p$(l,s,ki),l!==null){nr=l;return}if(s=s.sibling,s!==null){nr=s;return}nr=s=o}while(s!==null);lr===0&&(lr=5)}function Qc(o,s,l){var h=dn,_=mo.transition;try{mo.transition=null,dn=1,y$(o,s,l,h)}finally{mo.transition=_,dn=h}return null}function y$(o,s,l,h){do $l();while(za!==null);if(Yt&6)throw Error(Ie(327));l=o.finishedWork;var _=o.finishedLanes;if(l===null)return null;if(o.finishedWork=null,o.finishedLanes=0,l===o.current)throw Error(Ie(177));o.callbackNode=null,o.callbackPriority=0;var g=l.lanes|l.childLanes;if(nZ(o,g),o===Tr&&(nr=Tr=null,Ar=0),!(l.subtreeFlags&2064)&&!(l.flags&2064)||j_||(j_=!0,d4(cE,function(){return $l(),null})),g=(l.flags&15990)!==0,l.subtreeFlags&15990||g){g=mo.transition,mo.transition=null;var C=dn;dn=1;var b=Yt;Yt|=4,T0.current=null,_$(o,l),e4(l,o),GZ(QC),lE=!!XC,QC=XC=null,o.current=l,E$(l),YQ(),Yt=b,dn=C,mo.transition=g}else o.current=l;if(j_&&(j_=!1,za=o,IE=_),g=o.pendingLanes,g===0&&(ec=null),XQ(l.stateNode),Si(o,Zn()),s!==null)for(h=o.onRecoverableError,l=0;l<s.length;l++)_=s[l],h(_.value,{componentStack:_.stack,digest:_.digest});if(wE)throw wE=!1,o=ER,ER=null,o;return IE&1&&o.tag!==0&&$l(),g=o.pendingLanes,g&1?o===gR?lp++:(lp=0,gR=o):lp=0,cc(),null}function $l(){if(za!==null){var o=FV(IE),s=mo.transition,l=dn;try{if(mo.transition=null,dn=16>o?16:o,za===null)var h=!1;else{if(o=za,za=null,IE=0,Yt&6)throw Error(Ie(331));var _=Yt;for(Yt|=4,je=o.current;je!==null;){var g=je,C=g.child;if(je.flags&16){var b=g.deletions;if(b!==null){for(var D=0;D<b.length;D++){var M=b[D];for(je=M;je!==null;){var j=je;switch(j.tag){case 0:case 11:case 15:cp(8,j,g)}var x=j.child;if(x!==null)x.return=j,je=x;else for(;je!==null;){j=je;var W=j.sibling,te=j.return;if(Q5(j),j===M){je=null;break}if(W!==null){W.return=te,je=W;break}je=te}}}var X=g.alternate;if(X!==null){var ie=X.child;if(ie!==null){X.child=null;do{var ve=ie.sibling;ie.sibling=null,ie=ve}while(ie!==null)}}je=g}}if(g.subtreeFlags&2064&&C!==null)C.return=g,je=C;else e:for(;je!==null;){if(g=je,g.flags&2048)switch(g.tag){case 0:case 11:case 15:cp(9,g,g.return)}var K=g.sibling;if(K!==null){K.return=g.return,je=K;break e}je=g.return}}var H=o.current;for(je=H;je!==null;){C=je;var Y=C.child;if(C.subtreeFlags&2064&&Y!==null)Y.return=C,je=Y;else e:for(C=H;je!==null;){if(b=je,b.flags&2048)try{switch(b.tag){case 0:case 11:case 15:YE(9,b)}}catch(Ne){zn(b,b.return,Ne)}if(b===C){je=null;break e}var pe=b.sibling;if(pe!==null){pe.return=b.return,je=pe;break e}je=b.return}}if(Yt=_,cc(),Rs&&typeof Rs.onPostCommitFiberRoot=="function")try{Rs.onPostCommitFiberRoot(jE,o)}catch{}h=!0}return h}finally{dn=l,mo.transition=s}}return!1}function TU(o,s,l){s=ou(l,s),s=F5(o,s,1),o=$a(o,s,1),s=Qr(),o!==null&&(xp(o,1,s),Si(o,s))}function zn(o,s,l){if(o.tag===3)TU(o,o,l);else for(;s!==null;){if(s.tag===3){TU(s,o,l);break}else if(s.tag===1){var h=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(ec===null||!ec.has(h))){o=ou(l,o),o=B5(s,o,1),s=$a(s,o,1),o=Qr(),s!==null&&(xp(s,1,o),Si(s,o));break}}s=s.return}}function C$(o,s,l){var h=o.pingCache;h!==null&&h.delete(s),s=Qr(),o.pingedLanes|=o.suspendedLanes&l,Tr===o&&(Ar&l)===l&&(lr===4||lr===3&&(Ar&130023424)===Ar&&500>Zn()-y0?nd(o,0):v0|=l),Si(o,s)}function a4(o,s){s===0&&(o.mode&1?(s=O_,O_<<=1,!(O_&130023424)&&(O_=4194304)):s=1);var l=Qr();o=Qs(o,s),o!==null&&(xp(o,s,l),Si(o,l))}function R$(o){var s=o.memoizedState,l=0;s!==null&&(l=s.retryLane),a4(o,l)}function w$(o,s){var l=0;switch(o.tag){case 13:var h=o.stateNode,_=o.memoizedState;_!==null&&(l=_.retryLane);break;case 19:h=o.stateNode;break;default:throw Error(Ie(314))}h!==null&&h.delete(s),a4(o,l)}var c4;c4=function(o,s,l){if(o!==null)if(o.memoizedProps!==s.pendingProps||Ei.current)_i=!0;else{if(!(o.lanes&l)&&!(s.flags&128))return _i=!1,h$(o,s,l);_i=!!(o.flags&131072)}else _i=!1,kn&&s.flags&1048576&&h5(s,EE,s.index);switch(s.lanes=0,s.tag){case 2:var h=s.type;Q_(o,s),o=s.pendingProps;var _=tu(s,Br.current);Zl(s,l),_=m0(null,s,h,o,_,l);var g=_0();return s.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,gi(h)?(g=!0,mE(s)):g=!1,s.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,l0(s),_.updater=zE,s.stateNode=_,_._reactInternals=s,sR(s,h,o,l),s=dR(null,s,h,!0,g,l)):(s.tag=0,kn&&g&&r0(s),Xr(null,s,_,l),s=s.child),s;case 16:h=s.elementType;e:{switch(Q_(o,s),o=s.pendingProps,_=h._init,h=_(h._payload),s.type=h,_=s.tag=A$(h),o=Vo(h,o),_){case 0:s=cR(null,s,h,o,l);break e;case 1:s=lU(null,s,h,o,l);break e;case 11:s=cU(null,s,h,o,l);break e;case 14:s=dU(null,s,h,Vo(h.type,o),l);break e}throw Error(Ie(306,h,""))}return s;case 0:return h=s.type,_=s.pendingProps,_=s.elementType===h?_:Vo(h,_),cR(o,s,h,_,l);case 1:return h=s.type,_=s.pendingProps,_=s.elementType===h?_:Vo(h,_),lU(o,s,h,_,l);case 3:e:{if(K5(s),o===null)throw Error(Ie(387));h=s.pendingProps,g=s.memoizedState,_=g.element,g5(o,s),TE(s,h,null,l);var C=s.memoizedState;if(h=C.element,g.isDehydrated)if(g={element:h,isDehydrated:!1,cache:C.cache,pendingSuspenseBoundaries:C.pendingSuspenseBoundaries,transitions:C.transitions},s.updateQueue.baseState=g,s.memoizedState=g,s.flags&256){_=ou(Error(Ie(423)),s),s=uU(o,s,h,l,_);break e}else if(h!==_){_=ou(Error(Ie(424)),s),s=uU(o,s,h,l,_);break e}else for(Mi=Za(s.stateNode.containerInfo.firstChild),xi=s,kn=!0,Bo=null,l=_5(s,null,h,l),s.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(nu(),h===_){s=Zs(o,s,l);break e}Xr(o,s,h,l)}s=s.child}return s;case 5:return S5(s),o===null&&rR(s),h=s.type,_=s.pendingProps,g=o!==null?o.memoizedProps:null,C=_.children,ZC(h,_)?C=null:g!==null&&ZC(h,g)&&(s.flags|=32),H5(o,s),Xr(o,s,C,l),s.child;case 6:return o===null&&rR(s),null;case 13:return z5(o,s,l);case 4:return u0(s,s.stateNode.containerInfo),h=s.pendingProps,o===null?s.child=ru(s,null,h,l):Xr(o,s,h,l),s.child;case 11:return h=s.type,_=s.pendingProps,_=s.elementType===h?_:Vo(h,_),cU(o,s,h,_,l);case 7:return Xr(o,s,s.pendingProps,l),s.child;case 8:return Xr(o,s,s.pendingProps.children,l),s.child;case 12:return Xr(o,s,s.pendingProps.children,l),s.child;case 10:e:{if(h=s.type._context,_=s.pendingProps,g=s.memoizedProps,C=_.value,vn(gE,h._currentValue),h._currentValue=C,g!==null)if(zo(g.value,C)){if(g.children===_.children&&!Ei.current){s=Zs(o,s,l);break e}}else for(g=s.child,g!==null&&(g.return=s);g!==null;){var b=g.dependencies;if(b!==null){C=g.child;for(var D=b.firstContext;D!==null;){if(D.context===h){if(g.tag===1){D=qs(-1,l&-l),D.tag=2;var M=g.updateQueue;if(M!==null){M=M.shared;var j=M.pending;j===null?D.next=D:(D.next=j.next,j.next=D),M.pending=D}}g.lanes|=l,D=g.alternate,D!==null&&(D.lanes|=l),iR(g.return,l,s),b.lanes|=l;break}D=D.next}}else if(g.tag===10)C=g.type===s.type?null:g.child;else if(g.tag===18){if(C=g.return,C===null)throw Error(Ie(341));C.lanes|=l,b=C.alternate,b!==null&&(b.lanes|=l),iR(C,l,s),C=g.sibling}else C=g.child;if(C!==null)C.return=g;else for(C=g;C!==null;){if(C===s){C=null;break}if(g=C.sibling,g!==null){g.return=C.return,C=g;break}C=C.return}g=C}Xr(o,s,_.children,l),s=s.child}return s;case 9:return _=s.type,h=s.pendingProps.children,Zl(s,l),_=Eo(_),h=h(_),s.flags|=1,Xr(o,s,h,l),s.child;case 14:return h=s.type,_=Vo(h,s.pendingProps),_=Vo(h.type,_),dU(o,s,h,_,l);case 15:return G5(o,s,s.type,s.pendingProps,l);case 17:return h=s.type,_=s.pendingProps,_=s.elementType===h?_:Vo(h,_),Q_(o,s),s.tag=1,gi(h)?(o=!0,mE(s)):o=!1,Zl(s,l),j5(s,h,_),sR(s,h,_,l),dR(null,s,h,!0,o,l);case 19:return Y5(o,s,l);case 22:return W5(o,s,l)}throw Error(Ie(156,s.tag))};function d4(o,s){return xV(o,s)}function I$(o,s,l,h){this.tag=o,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fo(o,s,l,h){return new I$(o,s,l,h)}function I0(o){return o=o.prototype,!(!o||!o.isReactComponent)}function A$(o){if(typeof o=="function")return I0(o)?1:0;if(o!=null){if(o=o.$$typeof,o===KR)return 11;if(o===zR)return 14}return 2}function nc(o,s){var l=o.alternate;return l===null?(l=fo(o.tag,s,o.key,o.mode),l.elementType=o.elementType,l.type=o.type,l.stateNode=o.stateNode,l.alternate=o,o.alternate=l):(l.pendingProps=s,l.type=o.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=o.flags&14680064,l.childLanes=o.childLanes,l.lanes=o.lanes,l.child=o.child,l.memoizedProps=o.memoizedProps,l.memoizedState=o.memoizedState,l.updateQueue=o.updateQueue,s=o.dependencies,l.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},l.sibling=o.sibling,l.index=o.index,l.ref=o.ref,l}function eE(o,s,l,h,_,g){var C=2;if(h=o,typeof o=="function")I0(o)&&(C=1);else if(typeof o=="string")C=5;else e:switch(o){case Ml:return rd(l.children,_,g,s);case HR:C=8,_|=8;break;case NC:return o=fo(12,l,s,_|2),o.elementType=NC,o.lanes=g,o;case DC:return o=fo(13,l,s,_),o.elementType=DC,o.lanes=g,o;case PC:return o=fo(19,l,s,_),o.elementType=PC,o.lanes=g,o;case SV:return JE(l,_,g,s);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case EV:C=10;break e;case gV:C=9;break e;case KR:C=11;break e;case zR:C=14;break e;case Ba:C=16,h=null;break e}throw Error(Ie(130,o==null?o:typeof o,""))}return s=fo(C,l,s,_),s.elementType=o,s.type=h,s.lanes=g,s}function rd(o,s,l,h){return o=fo(7,o,h,s),o.lanes=l,o}function JE(o,s,l,h){return o=fo(22,o,h,s),o.elementType=SV,o.lanes=l,o.stateNode={isHidden:!1},o}function yC(o,s,l){return o=fo(6,o,null,s),o.lanes=l,o}function CC(o,s,l){return s=fo(4,o.children!==null?o.children:[],o.key,s),s.lanes=l,s.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},s}function b$(o,s,l,h,_){this.tag=s,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=rC(0),this.expirationTimes=rC(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rC(0),this.identifierPrefix=h,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function A0(o,s,l,h,_,g,C,b,D){return o=new b$(o,s,l,b,D),s===1?(s=1,g===!0&&(s|=8)):s=0,g=fo(3,null,null,s),o.current=g,g.stateNode=o,g.memoizedState={element:h,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},l0(g),o}function O$(o,s,l){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:kl,key:h==null?null:""+h,children:o,containerInfo:s,implementation:l}}function l4(o){if(!o)return oc;o=o._reactInternals;e:{if(md(o)!==o||o.tag!==1)throw Error(Ie(170));var s=o;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(gi(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(Ie(171))}if(o.tag===1){var l=o.type;if(gi(l))return l5(o,l,s)}return s}function u4(o,s,l,h,_,g,C,b,D){return o=A0(l,h,!0,o,_,g,C,b,D),o.context=l4(null),l=o.current,h=Qr(),_=tc(l),g=qs(h,_),g.callback=s??null,$a(l,g,_),o.current.lanes=_,xp(o,_,h),Si(o,h),o}function XE(o,s,l,h){var _=s.current,g=Qr(),C=tc(_);return l=l4(l),s.context===null?s.context=l:s.pendingContext=l,s=qs(g,C),s.payload={element:o},h=h===void 0?null:h,h!==null&&(s.callback=h),o=$a(_,s,C),o!==null&&(Wo(o,_,C,g),q_(o,_,C)),C}function bE(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return o.child.stateNode;default:return o.child.stateNode}}function vU(o,s){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var l=o.retryLane;o.retryLane=l!==0&&l<s?l:s}}function b0(o,s){vU(o,s),(o=o.alternate)&&vU(o,s)}function N$(){return null}var h4=typeof reportError=="function"?reportError:function(o){console.error(o)};function O0(o){this._internalRoot=o}QE.prototype.render=O0.prototype.render=function(o){var s=this._internalRoot;if(s===null)throw Error(Ie(409));XE(o,s,null,null)};QE.prototype.unmount=O0.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var s=o.containerInfo;ud(function(){XE(null,o,null,null)}),s[Xs]=null}};function QE(o){this._internalRoot=o}QE.prototype.unstable_scheduleHydration=function(o){if(o){var s=WV();o={blockedOn:null,target:o,priority:s};for(var l=0;l<Wa.length&&s!==0&&s<Wa[l].priority;l++);Wa.splice(l,0,o),l===0&&KV(o)}};function N0(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function ZE(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11&&(o.nodeType!==8||o.nodeValue!==" react-mount-point-unstable "))}function yU(){}function D$(o,s,l,h,_){if(_){if(typeof h=="function"){var g=h;h=function(){var M=bE(C);g.call(M)}}var C=u4(s,h,o,0,null,!1,!1,"",yU);return o._reactRootContainer=C,o[Xs]=C.current,vp(o.nodeType===8?o.parentNode:o),ud(),C}for(;_=o.lastChild;)o.removeChild(_);if(typeof h=="function"){var b=h;h=function(){var M=bE(D);b.call(M)}}var D=A0(o,0,!1,null,null,!1,!1,"",yU);return o._reactRootContainer=D,o[Xs]=D.current,vp(o.nodeType===8?o.parentNode:o),ud(function(){XE(s,D,l,h)}),D}function $E(o,s,l,h,_){var g=l._reactRootContainer;if(g){var C=g;if(typeof _=="function"){var b=_;_=function(){var D=bE(C);b.call(D)}}XE(s,C,o,_)}else C=D$(l,s,o,_,h);return bE(C)}BV=function(o){switch(o.tag){case 3:var s=o.stateNode;if(s.current.memoizedState.isDehydrated){var l=Zh(s.pendingLanes);l!==0&&(JR(s,l|1),Si(s,Zn()),!(Yt&6)&&(su=Zn()+500,cc()))}break;case 13:ud(function(){var h=Qs(o,1);if(h!==null){var _=Qr();Wo(h,o,1,_)}}),b0(o,1)}};XR=function(o){if(o.tag===13){var s=Qs(o,134217728);if(s!==null){var l=Qr();Wo(s,o,134217728,l)}b0(o,134217728)}};GV=function(o){if(o.tag===13){var s=tc(o),l=Qs(o,s);if(l!==null){var h=Qr();Wo(l,o,s,h)}b0(o,s)}};WV=function(){return dn};HV=function(o,s){var l=dn;try{return dn=o,s()}finally{dn=l}};GC=function(o,s,l){switch(s){case"input":if(MC(o,l),s=l.name,l.type==="radio"&&s!=null){for(l=o;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<l.length;s++){var h=l[s];if(h!==o&&h.form===o.form){var _=WE(h);if(!_)throw Error(Ie(90));vV(h),MC(h,_)}}}break;case"textarea":CV(o,l);break;case"select":s=l.value,s!=null&&ql(o,!!l.multiple,s,!1)}};NV=C0;DV=ud;var P$={usingClientEntryPoint:!1,Events:[Vp,jl,WE,bV,OV,C0]},qh={findFiberByHostInstance:$c,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},L$={bundleType:qh.bundleType,version:qh.version,rendererPackageName:qh.rendererPackageName,rendererConfig:qh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$s.ReactCurrentDispatcher,findHostInstanceByFiber:function(o){return o=kV(o),o===null?null:o.stateNode},findFiberByHostInstance:qh.findFiberByHostInstance||N$,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var F_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!F_.isDisabled&&F_.supportsFiber)try{jE=F_.inject(L$),Rs=F_}catch{}}Vi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P$;Vi.createPortal=function(o,s){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!N0(s))throw Error(Ie(200));return O$(o,s,null,l)};Vi.createRoot=function(o,s){if(!N0(o))throw Error(Ie(299));var l=!1,h="",_=h4;return s!=null&&(s.unstable_strictMode===!0&&(l=!0),s.identifierPrefix!==void 0&&(h=s.identifierPrefix),s.onRecoverableError!==void 0&&(_=s.onRecoverableError)),s=A0(o,1,!1,null,null,l,!1,h,_),o[Xs]=s.current,vp(o.nodeType===8?o.parentNode:o),new O0(s)};Vi.findDOMNode=function(o){if(o==null)return null;if(o.nodeType===1)return o;var s=o._reactInternals;if(s===void 0)throw typeof o.render=="function"?Error(Ie(188)):(o=Object.keys(o).join(","),Error(Ie(268,o)));return o=kV(s),o=o===null?null:o.stateNode,o};Vi.flushSync=function(o){return ud(o)};Vi.hydrate=function(o,s,l){if(!ZE(s))throw Error(Ie(200));return $E(null,o,s,!0,l)};Vi.hydrateRoot=function(o,s,l){if(!N0(o))throw Error(Ie(405));var h=l!=null&&l.hydratedSources||null,_=!1,g="",C=h4;if(l!=null&&(l.unstable_strictMode===!0&&(_=!0),l.identifierPrefix!==void 0&&(g=l.identifierPrefix),l.onRecoverableError!==void 0&&(C=l.onRecoverableError)),s=u4(s,null,o,1,l??null,_,!1,g,C),o[Xs]=s.current,vp(o),h)for(o=0;o<h.length;o++)l=h[o],_=l._getVersion,_=_(l._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[l,_]:s.mutableSourceEagerHydrationData.push(l,_);return new QE(s)};Vi.render=function(o,s,l){if(!ZE(s))throw Error(Ie(200));return $E(null,o,s,!1,l)};Vi.unmountComponentAtNode=function(o){if(!ZE(o))throw Error(Ie(40));return o._reactRootContainer?(ud(function(){$E(null,null,o,!1,function(){o._reactRootContainer=null,o[Xs]=null})}),!0):!1};Vi.unstable_batchedUpdates=C0;Vi.unstable_renderSubtreeIntoContainer=function(o,s,l,h){if(!ZE(l))throw Error(Ie(200));if(o==null||o._reactInternals===void 0)throw Error(Ie(38));return $E(o,s,l,!1,h)};Vi.version="18.3.1-next-f1338f8080-20240426";function p4(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(p4)}catch(o){console.error(o)}}p4(),pV.exports=Vi;var f4=pV.exports,m4,CU=f4;m4=CU.createRoot,CU.hydrateRoot;/**
 * @remix-run/router v1.17.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Np(){return Np=Object.assign?Object.assign.bind():function(o){for(var s=1;s<arguments.length;s++){var l=arguments[s];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(o[h]=l[h])}return o},Np.apply(this,arguments)}var Ya;(function(o){o.Pop="POP",o.Push="PUSH",o.Replace="REPLACE"})(Ya||(Ya={}));const RU="popstate";function k$(o){o===void 0&&(o={});function s(h,_){let{pathname:g,search:C,hash:b}=h.location;return vR("",{pathname:g,search:C,hash:b},_.state&&_.state.usr||null,_.state&&_.state.key||"default")}function l(h,_){return typeof _=="string"?_:OE(_)}return x$(s,l,null,o)}function rr(o,s){if(o===!1||o===null||typeof o>"u")throw new Error(s)}function _4(o,s){if(!o){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function M$(){return Math.random().toString(36).substr(2,8)}function wU(o,s){return{usr:o.state,key:o.key,idx:s}}function vR(o,s,l,h){return l===void 0&&(l=null),Np({pathname:typeof o=="string"?o:o.pathname,search:"",hash:""},typeof s=="string"?uu(s):s,{state:l,key:s&&s.key||h||M$()})}function OE(o){let{pathname:s="/",search:l="",hash:h=""}=o;return l&&l!=="?"&&(s+=l.charAt(0)==="?"?l:"?"+l),h&&h!=="#"&&(s+=h.charAt(0)==="#"?h:"#"+h),s}function uu(o){let s={};if(o){let l=o.indexOf("#");l>=0&&(s.hash=o.substr(l),o=o.substr(0,l));let h=o.indexOf("?");h>=0&&(s.search=o.substr(h),o=o.substr(0,h)),o&&(s.pathname=o)}return s}function x$(o,s,l,h){h===void 0&&(h={});let{window:_=document.defaultView,v5Compat:g=!1}=h,C=_.history,b=Ya.Pop,D=null,M=j();M==null&&(M=0,C.replaceState(Np({},C.state,{idx:M}),""));function j(){return(C.state||{idx:null}).idx}function x(){b=Ya.Pop;let ve=j(),K=ve==null?null:ve-M;M=ve,D&&D({action:b,location:ie.location,delta:K})}function W(ve,K){b=Ya.Push;let H=vR(ie.location,ve,K);M=j()+1;let Y=wU(H,M),pe=ie.createHref(H);try{C.pushState(Y,"",pe)}catch(Ne){if(Ne instanceof DOMException&&Ne.name==="DataCloneError")throw Ne;_.location.assign(pe)}g&&D&&D({action:b,location:ie.location,delta:1})}function te(ve,K){b=Ya.Replace;let H=vR(ie.location,ve,K);M=j();let Y=wU(H,M),pe=ie.createHref(H);C.replaceState(Y,"",pe),g&&D&&D({action:b,location:ie.location,delta:0})}function X(ve){let K=_.location.origin!=="null"?_.location.origin:_.location.href,H=typeof ve=="string"?ve:OE(ve);return H=H.replace(/ $/,"%20"),rr(K,"No window.location.(origin|href) available to create URL for href: "+H),new URL(H,K)}let ie={get action(){return b},get location(){return o(_,C)},listen(ve){if(D)throw new Error("A history only accepts one active listener");return _.addEventListener(RU,x),D=ve,()=>{_.removeEventListener(RU,x),D=null}},createHref(ve){return s(_,ve)},createURL:X,encodeLocation(ve){let K=X(ve);return{pathname:K.pathname,search:K.search,hash:K.hash}},push:W,replace:te,go(ve){return C.go(ve)}};return ie}var IU;(function(o){o.data="data",o.deferred="deferred",o.redirect="redirect",o.error="error"})(IU||(IU={}));function U$(o,s,l){return l===void 0&&(l="/"),V$(o,s,l,!1)}function V$(o,s,l,h){let _=typeof s=="string"?uu(s):s,g=D0(_.pathname||"/",l);if(g==null)return null;let C=E4(o);j$(C);let b=null;for(let D=0;b==null&&D<C.length;++D){let M=X$(g);b=q$(C[D],M,h)}return b}function E4(o,s,l,h){s===void 0&&(s=[]),l===void 0&&(l=[]),h===void 0&&(h="");let _=(g,C,b)=>{let D={relativePath:b===void 0?g.path||"":b,caseSensitive:g.caseSensitive===!0,childrenIndex:C,route:g};D.relativePath.startsWith("/")&&(rr(D.relativePath.startsWith(h),'Absolute route path "'+D.relativePath+'" nested under path '+('"'+h+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),D.relativePath=D.relativePath.slice(h.length));let M=rc([h,D.relativePath]),j=l.concat(D);g.children&&g.children.length>0&&(rr(g.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+M+'".')),E4(g.children,s,j,M)),!(g.path==null&&!g.index)&&s.push({path:M,score:z$(M,g.index),routesMeta:j})};return o.forEach((g,C)=>{var b;if(g.path===""||!((b=g.path)!=null&&b.includes("?")))_(g,C);else for(let D of g4(g.path))_(g,C,D)}),s}function g4(o){let s=o.split("/");if(s.length===0)return[];let[l,...h]=s,_=l.endsWith("?"),g=l.replace(/\?$/,"");if(h.length===0)return _?[g,""]:[g];let C=g4(h.join("/")),b=[];return b.push(...C.map(D=>D===""?g:[g,D].join("/"))),_&&b.push(...C),b.map(D=>o.startsWith("/")&&D===""?"/":D)}function j$(o){o.sort((s,l)=>s.score!==l.score?l.score-s.score:Y$(s.routesMeta.map(h=>h.childrenIndex),l.routesMeta.map(h=>h.childrenIndex)))}const F$=/^:[\w-]+$/,B$=3,G$=2,W$=1,H$=10,K$=-2,AU=o=>o==="*";function z$(o,s){let l=o.split("/"),h=l.length;return l.some(AU)&&(h+=K$),s&&(h+=G$),l.filter(_=>!AU(_)).reduce((_,g)=>_+(F$.test(g)?B$:g===""?W$:H$),h)}function Y$(o,s){return o.length===s.length&&o.slice(0,-1).every((h,_)=>h===s[_])?o[o.length-1]-s[s.length-1]:0}function q$(o,s,l){let{routesMeta:h}=o,_={},g="/",C=[];for(let b=0;b<h.length;++b){let D=h[b],M=b===h.length-1,j=g==="/"?s:s.slice(g.length)||"/",x=bU({path:D.relativePath,caseSensitive:D.caseSensitive,end:M},j),W=D.route;if(!x&&M&&l&&!h[h.length-1].route.index&&(x=bU({path:D.relativePath,caseSensitive:D.caseSensitive,end:!1},j)),!x)return null;Object.assign(_,x.params),C.push({params:_,pathname:rc([g,x.pathname]),pathnameBase:eee(rc([g,x.pathnameBase])),route:W}),x.pathnameBase!=="/"&&(g=rc([g,x.pathnameBase]))}return C}function bU(o,s){typeof o=="string"&&(o={path:o,caseSensitive:!1,end:!0});let[l,h]=J$(o.path,o.caseSensitive,o.end),_=s.match(l);if(!_)return null;let g=_[0],C=g.replace(/(.)\/+$/,"$1"),b=_.slice(1);return{params:h.reduce((M,j,x)=>{let{paramName:W,isOptional:te}=j;if(W==="*"){let ie=b[x]||"";C=g.slice(0,g.length-ie.length).replace(/(.)\/+$/,"$1")}const X=b[x];return te&&!X?M[W]=void 0:M[W]=(X||"").replace(/%2F/g,"/"),M},{}),pathname:g,pathnameBase:C,pattern:o}}function J$(o,s,l){s===void 0&&(s=!1),l===void 0&&(l=!0),_4(o==="*"||!o.endsWith("*")||o.endsWith("/*"),'Route path "'+o+'" will be treated as if it were '+('"'+o.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+o.replace(/\*$/,"/*")+'".'));let h=[],_="^"+o.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(C,b,D)=>(h.push({paramName:b,isOptional:D!=null}),D?"/?([^\\/]+)?":"/([^\\/]+)"));return o.endsWith("*")?(h.push({paramName:"*"}),_+=o==="*"||o==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):l?_+="\\/*$":o!==""&&o!=="/"&&(_+="(?:(?=\\/|$))"),[new RegExp(_,s?void 0:"i"),h]}function X$(o){try{return o.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return _4(!1,'The URL path "'+o+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+s+").")),o}}function D0(o,s){if(s==="/")return o;if(!o.toLowerCase().startsWith(s.toLowerCase()))return null;let l=s.endsWith("/")?s.length-1:s.length,h=o.charAt(l);return h&&h!=="/"?null:o.slice(l)||"/"}function Q$(o,s){s===void 0&&(s="/");let{pathname:l,search:h="",hash:_=""}=typeof o=="string"?uu(o):o;return{pathname:l?l.startsWith("/")?l:Z$(l,s):s,search:tee(h),hash:nee(_)}}function Z$(o,s){let l=s.replace(/\/+$/,"").split("/");return o.split("/").forEach(_=>{_===".."?l.length>1&&l.pop():_!=="."&&l.push(_)}),l.length>1?l.join("/"):"/"}function RC(o,s,l,h){return"Cannot include a '"+o+"' character in a manually specified "+("`to."+s+"` field ["+JSON.stringify(h)+"].  Please separate it out to the ")+("`to."+l+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function $$(o){return o.filter((s,l)=>l===0||s.route.path&&s.route.path.length>0)}function S4(o,s){let l=$$(o);return s?l.map((h,_)=>_===l.length-1?h.pathname:h.pathnameBase):l.map(h=>h.pathnameBase)}function T4(o,s,l,h){h===void 0&&(h=!1);let _;typeof o=="string"?_=uu(o):(_=Np({},o),rr(!_.pathname||!_.pathname.includes("?"),RC("?","pathname","search",_)),rr(!_.pathname||!_.pathname.includes("#"),RC("#","pathname","hash",_)),rr(!_.search||!_.search.includes("#"),RC("#","search","hash",_)));let g=o===""||_.pathname==="",C=g?"/":_.pathname,b;if(C==null)b=l;else{let x=s.length-1;if(!h&&C.startsWith("..")){let W=C.split("/");for(;W[0]==="..";)W.shift(),x-=1;_.pathname=W.join("/")}b=x>=0?s[x]:"/"}let D=Q$(_,b),M=C&&C!=="/"&&C.endsWith("/"),j=(g||C===".")&&l.endsWith("/");return!D.pathname.endsWith("/")&&(M||j)&&(D.pathname+="/"),D}const rc=o=>o.join("/").replace(/\/\/+/g,"/"),eee=o=>o.replace(/\/+$/,"").replace(/^\/*/,"/"),tee=o=>!o||o==="?"?"":o.startsWith("?")?o:"?"+o,nee=o=>!o||o==="#"?"":o.startsWith("#")?o:"#"+o;function ree(o){return o!=null&&typeof o.status=="number"&&typeof o.statusText=="string"&&typeof o.internal=="boolean"&&"data"in o}const v4=["post","put","patch","delete"];new Set(v4);const iee=["get",...v4];new Set(iee);/**
 * React Router v6.24.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Dp(){return Dp=Object.assign?Object.assign.bind():function(o){for(var s=1;s<arguments.length;s++){var l=arguments[s];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(o[h]=l[h])}return o},Dp.apply(this,arguments)}const P0=we.createContext(null),oee=we.createContext(null),_d=we.createContext(null),eg=we.createContext(null),dc=we.createContext({outlet:null,matches:[],isDataRoute:!1}),y4=we.createContext(null);function see(o,s){let{relative:l}=s===void 0?{}:s;Fp()||rr(!1);let{basename:h,navigator:_}=we.useContext(_d),{hash:g,pathname:C,search:b}=w4(o,{relative:l}),D=C;return h!=="/"&&(D=C==="/"?h:rc([h,C])),_.createHref({pathname:D,search:b,hash:g})}function Fp(){return we.useContext(eg)!=null}function hu(){return Fp()||rr(!1),we.useContext(eg).location}function C4(o){we.useContext(_d).static||we.useLayoutEffect(o)}function pu(){let{isDataRoute:o}=we.useContext(dc);return o?See():aee()}function aee(){Fp()||rr(!1);let o=we.useContext(P0),{basename:s,future:l,navigator:h}=we.useContext(_d),{matches:_}=we.useContext(dc),{pathname:g}=hu(),C=JSON.stringify(S4(_,l.v7_relativeSplatPath)),b=we.useRef(!1);return C4(()=>{b.current=!0}),we.useCallback(function(M,j){if(j===void 0&&(j={}),!b.current)return;if(typeof M=="number"){h.go(M);return}let x=T4(M,JSON.parse(C),g,j.relative==="path");o==null&&s!=="/"&&(x.pathname=x.pathname==="/"?s:rc([s,x.pathname])),(j.replace?h.replace:h.push)(x,j.state,j)},[s,h,C,g,o])}function R4(){let{matches:o}=we.useContext(dc),s=o[o.length-1];return s?s.params:{}}function w4(o,s){let{relative:l}=s===void 0?{}:s,{future:h}=we.useContext(_d),{matches:_}=we.useContext(dc),{pathname:g}=hu(),C=JSON.stringify(S4(_,h.v7_relativeSplatPath));return we.useMemo(()=>T4(o,JSON.parse(C),g,l==="path"),[o,C,g,l])}function cee(o,s){return dee(o,s)}function dee(o,s,l,h){Fp()||rr(!1);let{navigator:_}=we.useContext(_d),{matches:g}=we.useContext(dc),C=g[g.length-1],b=C?C.params:{};C&&C.pathname;let D=C?C.pathnameBase:"/";C&&C.route;let M=hu(),j;if(s){var x;let ve=typeof s=="string"?uu(s):s;D==="/"||(x=ve.pathname)!=null&&x.startsWith(D)||rr(!1),j=ve}else j=M;let W=j.pathname||"/",te=W;if(D!=="/"){let ve=D.replace(/^\//,"").split("/");te="/"+W.replace(/^\//,"").split("/").slice(ve.length).join("/")}let X=U$(o,{pathname:te}),ie=fee(X&&X.map(ve=>Object.assign({},ve,{params:Object.assign({},b,ve.params),pathname:rc([D,_.encodeLocation?_.encodeLocation(ve.pathname).pathname:ve.pathname]),pathnameBase:ve.pathnameBase==="/"?D:rc([D,_.encodeLocation?_.encodeLocation(ve.pathnameBase).pathname:ve.pathnameBase])})),g,l,h);return s&&ie?we.createElement(eg.Provider,{value:{location:Dp({pathname:"/",search:"",hash:"",state:null,key:"default"},j),navigationType:Ya.Pop}},ie):ie}function lee(){let o=gee(),s=ree(o)?o.status+" "+o.statusText:o instanceof Error?o.message:JSON.stringify(o),l=o instanceof Error?o.stack:null,_={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return we.createElement(we.Fragment,null,we.createElement("h2",null,"Unexpected Application Error!"),we.createElement("h3",{style:{fontStyle:"italic"}},s),l?we.createElement("pre",{style:_},l):null,null)}const uee=we.createElement(lee,null);class hee extends we.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,l){return l.location!==s.location||l.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:l.error,location:l.location,revalidation:s.revalidation||l.revalidation}}componentDidCatch(s,l){console.error("React Router caught the following error during render",s,l)}render(){return this.state.error!==void 0?we.createElement(dc.Provider,{value:this.props.routeContext},we.createElement(y4.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function pee(o){let{routeContext:s,match:l,children:h}=o,_=we.useContext(P0);return _&&_.static&&_.staticContext&&(l.route.errorElement||l.route.ErrorBoundary)&&(_.staticContext._deepestRenderedBoundaryId=l.route.id),we.createElement(dc.Provider,{value:s},h)}function fee(o,s,l,h){var _;if(s===void 0&&(s=[]),l===void 0&&(l=null),h===void 0&&(h=null),o==null){var g;if((g=l)!=null&&g.errors)o=l.matches;else return null}let C=o,b=(_=l)==null?void 0:_.errors;if(b!=null){let j=C.findIndex(x=>x.route.id&&(b==null?void 0:b[x.route.id])!==void 0);j>=0||rr(!1),C=C.slice(0,Math.min(C.length,j+1))}let D=!1,M=-1;if(l&&h&&h.v7_partialHydration)for(let j=0;j<C.length;j++){let x=C[j];if((x.route.HydrateFallback||x.route.hydrateFallbackElement)&&(M=j),x.route.id){let{loaderData:W,errors:te}=l,X=x.route.loader&&W[x.route.id]===void 0&&(!te||te[x.route.id]===void 0);if(x.route.lazy||X){D=!0,M>=0?C=C.slice(0,M+1):C=[C[0]];break}}}return C.reduceRight((j,x,W)=>{let te,X=!1,ie=null,ve=null;l&&(te=b&&x.route.id?b[x.route.id]:void 0,ie=x.route.errorElement||uee,D&&(M<0&&W===0?(X=!0,ve=null):M===W&&(X=!0,ve=x.route.hydrateFallbackElement||null)));let K=s.concat(C.slice(0,W+1)),H=()=>{let Y;return te?Y=ie:X?Y=ve:x.route.Component?Y=we.createElement(x.route.Component,null):x.route.element?Y=x.route.element:Y=j,we.createElement(pee,{match:x,routeContext:{outlet:j,matches:K,isDataRoute:l!=null},children:Y})};return l&&(x.route.ErrorBoundary||x.route.errorElement||W===0)?we.createElement(hee,{location:l.location,revalidation:l.revalidation,component:ie,error:te,children:H(),routeContext:{outlet:null,matches:K,isDataRoute:!0}}):H()},null)}var I4=function(o){return o.UseBlocker="useBlocker",o.UseRevalidator="useRevalidator",o.UseNavigateStable="useNavigate",o}(I4||{}),NE=function(o){return o.UseBlocker="useBlocker",o.UseLoaderData="useLoaderData",o.UseActionData="useActionData",o.UseRouteError="useRouteError",o.UseNavigation="useNavigation",o.UseRouteLoaderData="useRouteLoaderData",o.UseMatches="useMatches",o.UseRevalidator="useRevalidator",o.UseNavigateStable="useNavigate",o.UseRouteId="useRouteId",o}(NE||{});function mee(o){let s=we.useContext(P0);return s||rr(!1),s}function _ee(o){let s=we.useContext(oee);return s||rr(!1),s}function Eee(o){let s=we.useContext(dc);return s||rr(!1),s}function A4(o){let s=Eee(),l=s.matches[s.matches.length-1];return l.route.id||rr(!1),l.route.id}function gee(){var o;let s=we.useContext(y4),l=_ee(NE.UseRouteError),h=A4(NE.UseRouteError);return s!==void 0?s:(o=l.errors)==null?void 0:o[h]}function See(){let{router:o}=mee(I4.UseNavigateStable),s=A4(NE.UseNavigateStable),l=we.useRef(!1);return C4(()=>{l.current=!0}),we.useCallback(function(_,g){g===void 0&&(g={}),l.current&&(typeof _=="number"?o.navigate(_):o.navigate(_,Dp({fromRouteId:s},g)))},[o,s])}function Li(o){rr(!1)}function Tee(o){let{basename:s="/",children:l=null,location:h,navigationType:_=Ya.Pop,navigator:g,static:C=!1,future:b}=o;Fp()&&rr(!1);let D=s.replace(/^\/*/,"/"),M=we.useMemo(()=>({basename:D,navigator:g,static:C,future:Dp({v7_relativeSplatPath:!1},b)}),[D,b,g,C]);typeof h=="string"&&(h=uu(h));let{pathname:j="/",search:x="",hash:W="",state:te=null,key:X="default"}=h,ie=we.useMemo(()=>{let ve=D0(j,D);return ve==null?null:{location:{pathname:ve,search:x,hash:W,state:te,key:X},navigationType:_}},[D,j,x,W,te,X,_]);return ie==null?null:we.createElement(_d.Provider,{value:M},we.createElement(eg.Provider,{children:l,value:ie}))}function vee(o){let{children:s,location:l}=o;return cee(yR(s),l)}new Promise(()=>{});function yR(o,s){s===void 0&&(s=[]);let l=[];return we.Children.forEach(o,(h,_)=>{if(!we.isValidElement(h))return;let g=[...s,_];if(h.type===we.Fragment){l.push.apply(l,yR(h.props.children,g));return}h.type!==Li&&rr(!1),!h.props.index||!h.props.children||rr(!1);let C={id:h.props.id||g.join("-"),caseSensitive:h.props.caseSensitive,element:h.props.element,Component:h.props.Component,index:h.props.index,path:h.props.path,loader:h.props.loader,action:h.props.action,errorElement:h.props.errorElement,ErrorBoundary:h.props.ErrorBoundary,hasErrorBoundary:h.props.ErrorBoundary!=null||h.props.errorElement!=null,shouldRevalidate:h.props.shouldRevalidate,handle:h.props.handle,lazy:h.props.lazy};h.props.children&&(C.children=yR(h.props.children,g)),l.push(C)}),l}/**
 * React Router DOM v6.24.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function CR(){return CR=Object.assign?Object.assign.bind():function(o){for(var s=1;s<arguments.length;s++){var l=arguments[s];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(o[h]=l[h])}return o},CR.apply(this,arguments)}function yee(o,s){if(o==null)return{};var l={},h=Object.keys(o),_,g;for(g=0;g<h.length;g++)_=h[g],!(s.indexOf(_)>=0)&&(l[_]=o[_]);return l}function Cee(o){return!!(o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)}function Ree(o,s){return o.button===0&&(!s||s==="_self")&&!Cee(o)}const wee=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],Iee="6";try{window.__reactRouterVersion=Iee}catch{}const Aee="startTransition",OU=CQ[Aee];function bee(o){let{basename:s,children:l,future:h,window:_}=o,g=we.useRef();g.current==null&&(g.current=k$({window:_,v5Compat:!0}));let C=g.current,[b,D]=we.useState({action:C.action,location:C.location}),{v7_startTransition:M}=h||{},j=we.useCallback(x=>{M&&OU?OU(()=>D(x)):D(x)},[D,M]);return we.useLayoutEffect(()=>C.listen(j),[C,j]),we.createElement(Tee,{basename:s,children:l,location:b.location,navigationType:b.action,navigator:C,future:h})}const Oee=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Nee=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,id=we.forwardRef(function(s,l){let{onClick:h,relative:_,reloadDocument:g,replace:C,state:b,target:D,to:M,preventScrollReset:j,unstable_viewTransition:x}=s,W=yee(s,wee),{basename:te}=we.useContext(_d),X,ie=!1;if(typeof M=="string"&&Nee.test(M)&&(X=M,Oee))try{let Y=new URL(window.location.href),pe=M.startsWith("//")?new URL(Y.protocol+M):new URL(M),Ne=D0(pe.pathname,te);pe.origin===Y.origin&&Ne!=null?M=Ne+pe.search+pe.hash:ie=!0}catch{}let ve=see(M,{relative:_}),K=Dee(M,{replace:C,state:b,target:D,preventScrollReset:j,relative:_,unstable_viewTransition:x});function H(Y){h&&h(Y),Y.defaultPrevented||K(Y)}return we.createElement("a",CR({},W,{href:X||ve,onClick:ie||g?h:H,ref:l,target:D}))});var NU;(function(o){o.UseScrollRestoration="useScrollRestoration",o.UseSubmit="useSubmit",o.UseSubmitFetcher="useSubmitFetcher",o.UseFetcher="useFetcher",o.useViewTransitionState="useViewTransitionState"})(NU||(NU={}));var DU;(function(o){o.UseFetcher="useFetcher",o.UseFetchers="useFetchers",o.UseScrollRestoration="useScrollRestoration"})(DU||(DU={}));function Dee(o,s){let{target:l,replace:h,state:_,preventScrollReset:g,relative:C,unstable_viewTransition:b}=s===void 0?{}:s,D=pu(),M=hu(),j=w4(o,{relative:C});return we.useCallback(x=>{if(Ree(x,l)){x.preventDefault();let W=h!==void 0?h:OE(M)===OE(j);D(o,{replace:W,state:_,preventScrollReset:g,relative:C,unstable_viewTransition:b})}},[M,D,j,h,_,l,o,g,C,b])}function Pee(){return L.jsx("div",{className:"container mt-5",children:L.jsxs("div",{className:"text-center",children:[L.jsx("h1",{className:"display-4",children:"Welcome to Baymax"}),L.jsx("p",{className:"lead",children:"Monitor and manage your devices seamlessly."}),L.jsxs("div",{className:"d-flex justify-content-center mt-4",children:[L.jsx("a",{href:"/user",className:"btn btn-primary btn-lg text-white mx-2",children:"User Page"}),L.jsx("a",{href:"/camera",className:"btn btn-secondary text-black btn-lg mx-2",children:"Camera Page"}),L.jsx("a",{href:"/history",className:"btn btn-secondary text-black btn-lg mx-2",children:"History"}),L.jsx("a",{href:"/record",className:"btn btn-secondary text-black btn-lg mx-2",children:"Record"}),L.jsx("a",{href:"/histories",className:"btn btn-secondary text-black btn-lg mx-2",children:"Histories"})]})]})})}const Lee=({setShowLogin:o})=>{const s=pu(),[l,h]=we.useState(""),[_,g]=we.useState(""),[C,b]=we.useState(""),D=x=>{localStorage.setItem("user-data",JSON.stringify(x)),s("/user-home",{state:{userData:x}})},M=()=>{s("/")},j=async x=>{x.preventDefault(),b("");try{const W=await fetch("http://localhost:3000/api/v1/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,email:l,password:_})}),te=await W.json();console.log(te),W.ok?(console.log(te),D(te)):b(te.message)}catch{b("An error occurred. Please try again.")}};return L.jsxs("div",{className:"font-ubuntu bg-base-100 w-full max-w-md rounded-lg p-6 py-12 justify-center",children:[L.jsx("button",{"aria-label":"close",className:"text-left mb-4",onClick:M,children:L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:L.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),L.jsx("div",{className:"flex justify-center",children:L.jsx("img",{src:"/public/logo.png",alt:"Illustration",className:"w-64 h-64"})}),L.jsx("h2",{className:"text-3xl font-bold text-primary text-center mb-4",children:"Welcome Back"}),L.jsx("p",{className:"font-lato text-lg text-primary text-center mb-6",children:"Log in to your account"}),C&&L.jsx("p",{className:"text-red-500 text-center",children:C}),L.jsxs("form",{onSubmit:j,children:[L.jsxs("div",{className:"space-y-4 mx-8",children:[L.jsx("input",{type:"text",placeholder:"Username or Email",className:"bg-neutral w-full px-6 py-3 rounded-2xl focus:outline-none focus:ring-1 focus:ring-info",value:l,onChange:x=>h(x.target.value)}),L.jsx("input",{type:"password",placeholder:"Password",className:"bg-neutral w-full px-6 py-3 rounded-2xl focus:outline-none focus:ring-1 focus:ring-info",value:_,onChange:x=>g(x.target.value)})]}),L.jsxs("div",{className:"flex justify-between items-center mt-4 mx-8",children:[L.jsxs("label",{className:"flex items-center",children:[L.jsx("input",{type:"checkbox",className:"form-checkbox"}),L.jsx("span",{className:"ml-2",children:"Remember Me"})]}),L.jsx("a",{href:"#",className:"text-sm text-indigo-500 hover:underline",children:"Forget Password"})]}),L.jsx("div",{className:"space-y-4 mx-8 mt-2",children:L.jsx("button",{type:"submit",className:"w-full bg-info text-white py-2 px-4 rounded-full mt-6 hover:bg-info-600",children:"Login"})})]}),L.jsxs("div",{className:"space-y-4 mx-8 mt-6 text-center",children:["Don't have an account?","  ",L.jsx("button",{className:"text-blue-500",onClick:()=>o(!1),children:"Sign Up"})]})]})},kee=({setShowLogin:o})=>L.jsxs("div",{className:"font-ubuntu bg-base-100 w-full max-w-md rounded-lg p-6 py-6 justify-center",children:[L.jsx("button",{"aria-label":"close",className:"text-left mb-4",onClick:()=>o(!0),children:L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:L.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),L.jsx("div",{className:"flex justify-center mb-4",children:L.jsx("img",{src:"/public/others/crybaby.png",alt:"Illustration",className:"w-48 h-48"})}),L.jsx("h2",{className:"text-3xl font-bold text-primary text-center mb-3",children:"Sign Up"}),L.jsx("h3",{className:"text-md text-primary text-center mb-6",children:"Create an account"}),L.jsxs("div",{className:"space-y-4 mx-8",children:[L.jsx("input",{type:"text",placeholder:"Username",className:"bg-neutral w-full px-6 py-3 rounded-2xl focus:outline-none focus:ring-1 focus:ring-info"}),L.jsx("input",{type:"text",placeholder:"Email Address",className:"bg-neutral w-full px-6 py-3 rounded-2xl focus:outline-none focus:ring-1 focus:ring-info"}),L.jsx("input",{type:"password",placeholder:"Password",className:"bg-neutral w-full px-6 py-3 rounded-2xl focus:outline-none focus:ring-1 focus:ring-info"}),L.jsx("input",{type:"password",placeholder:"Confirm Password",className:"bg-neutral w-full px-6 py-3 rounded-2xl focus:outline-none focus:ring-1 focus:ring-info"})]}),L.jsx("div",{className:"space-y-4 mx-8 mt-2",children:L.jsx("button",{className:"w-full bg-info text-white py-2 px-4 rounded mt-6 hover:bg-info-600 rounded-full",children:"Create Account"})}),L.jsxs("p",{className:"mt-4 text-center",children:["Already a member?"," ",L.jsx("button",{className:"text-blue-500",onClick:()=>o(!0),children:"Log in"}),L.jsx("div",{className:"space-y-4 mx-8 mt-2",children:L.jsx("div",{className:"flex w-full flex-col border-opacity-50",children:L.jsx("div",{className:"divider",children:"OR"})})}),L.jsx("div",{className:"space-y-4 mx-8 mt-2",children:L.jsxs("button",{className:"w-full bg-blue-500 text-white text-center py-2 px-4 mb-4 btn no-animation",children:[L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"30",height:"30",viewBox:"0 0 30 30",children:L.jsx("path",{d:"M24,4H6C4.895,4,4,4.895,4,6v18c0,1.105,0.895,2,2,2h10v-9h-3v-3h3v-1.611C16,9.339,17.486,8,20.021,8 c1.214,0,1.856,0.09,2.16,0.131V11h-1.729C19.376,11,19,11.568,19,12.718V14h3.154l-0.428,3H19v9h5c1.105,0,2-0.895,2-2V6 C26,4.895,25.104,4,24,4z"})}),"Sign up with Facebook"]})})]})]}),PU=["Babies can swallow and breathe at the same time.","Babies are born with natural swimming abilities and can hold their breath.","A baby's head is 1/4th of its total length, but by the age of 25 will only be 1/8th of its total length.","Babies are born with 300 bones, but by adulthood the number is reduced to 206.","Babies are always born with blue eyes. The color of the eyes changes within a few weeks.","A baby's cry is unique to them, and can be identified by their mother","Babies are born with the ability to differentiate between different languages.","Babies can recognize the smell and voice of their mother at birth."],Mee=()=>{const o=pu(),s=()=>{o("/")},[l,h]=we.useState("");return we.useEffect(()=>{const _=PU[Math.floor(Math.random()*PU.length)];h(_)},[]),L.jsx("div",{className:"flex justify-center h-screen",children:L.jsxs("div",{className:"p-8 max-w-sm mx-auto",children:[L.jsx("button",{className:"text-left mb-4",onClick:()=>s(),children:L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"h-6 w-6 text-gray-700",children:L.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),L.jsx("div",{className:"my-40",children:L.jsxs("div",{className:"text-center items-center",children:[L.jsx("img",{src:"/public/others/crybaby.gif",alt:"Loading",className:"mx-auto mb-4"}),L.jsx("h2",{className:"text-2xl font-bold mt-6",children:"Loading..."}),L.jsx("p",{className:"text-gray-500 mt-2",children:l})]})}),L.jsx("div",{className:"loader"}),L.jsx("style",{jsx:!0,children:`
        .loader {
          border: 4px solid rgba(255, 255, 255, 0.3);
          width: 40px;
          height: 40px;
          border-radius: 50%;
          border-top-color: #3498db;
          animation: spin 1s ease-in-out infinite;
          margin: auto;
        }

        @keyframes spin {
          to {
            transform: rotate(360deg);
          }
        }
      `})]})})},xee=()=>{const[o,s]=we.useState(!0),[l,h]=we.useState(!0);return we.useEffect(()=>{const _=setTimeout(()=>{s(!1)},4e3);return()=>clearTimeout(_)},[]),L.jsx("div",{className:"flex items-center flex-col min-h-screen",children:o?L.jsx(Mee,{}):l?L.jsx(Lee,{setShowLogin:h}):L.jsx(kee,{setShowLogin:h})})};var b4={exports:{}};(function(o,s){(function(l,h){o.exports=h()})(C_,function(){function l(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in e)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(e)}var h=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof C_<"u"?C_:typeof self<"u"?self:{};function _(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var g=function(e){try{return!!e()}catch{return!0}},C=!g(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),b=C,D=Function.prototype,M=D.call,j=b&&D.bind.bind(M,M),x=b?j:function(e){return function(){return M.apply(e,arguments)}},W=x({}.isPrototypeOf),te=function(e){return e&&e.Math==Math&&e},X=te(typeof globalThis=="object"&&globalThis)||te(typeof window=="object"&&window)||te(typeof self=="object"&&self)||te(typeof h=="object"&&h)||function(){return this}()||h||Function("return this")(),ie=C,ve=Function.prototype,K=ve.apply,H=ve.call,Y=typeof Reflect=="object"&&Reflect.apply||(ie?H.bind(K):function(){return H.apply(K,arguments)}),pe=x,Ne=pe({}.toString),ke=pe("".slice),Pe=function(e){return ke(Ne(e),8,-1)},He=Pe,mn=x,mt=function(e){if(He(e)==="Function")return mn(e)},vr=typeof document=="object"&&document.all,Gr={all:vr,IS_HTMLDDA:vr===void 0&&vr!==void 0},So=Gr.all,Ve=Gr.IS_HTMLDDA?function(e){return typeof e=="function"||e===So}:function(e){return typeof e=="function"},nt={},Dt=!g(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),he=C,Ee=Function.prototype.call,De=he?Ee.bind(Ee):function(){return Ee.apply(Ee,arguments)},Ke={},_t={}.propertyIsEnumerable,nn=Object.getOwnPropertyDescriptor,ei=nn&&!_t.call({1:2},1);Ke.f=ei?function(e){var t=nn(this,e);return!!t&&t.enumerable}:_t;var Yn,Xo,ur=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},ea=g,mj=Pe,ag=Object,_j=x("".split),Kp=ea(function(){return!ag("z").propertyIsEnumerable(0)})?function(e){return mj(e)=="String"?_j(e,""):ag(e)}:ag,Ed=function(e){return e==null},Ej=Ed,gj=TypeError,gd=function(e){if(Ej(e))throw gj("Can't call method on "+e);return e},Sj=Kp,Tj=gd,ta=function(e){return Sj(Tj(e))},F0=Ve,vj=Gr.all,ti=Gr.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:F0(e)||e===vj}:function(e){return typeof e=="object"?e!==null:F0(e)},To={},cg=To,dg=X,yj=Ve,B0=function(e){return yj(e)?e:void 0},Wr=function(e,t){return arguments.length<2?B0(cg[e])||B0(dg[e]):cg[e]&&cg[e][t]||dg[e]&&dg[e][t]},lc=typeof navigator<"u"&&String(navigator.userAgent)||"",G0=X,lg=lc,W0=G0.process,H0=G0.Deno,K0=W0&&W0.versions||H0&&H0.version,z0=K0&&K0.v8;z0&&(Xo=(Yn=z0.split("."))[0]>0&&Yn[0]<4?1:+(Yn[0]+Yn[1])),!Xo&&lg&&(!(Yn=lg.match(/Edge\/(\d+)/))||Yn[1]>=74)&&(Yn=lg.match(/Chrome\/(\d+)/))&&(Xo=+Yn[1]);var uc=Xo,Y0=uc,Cj=g,Rj=X.String,Sd=!!Object.getOwnPropertySymbols&&!Cj(function(){var e=Symbol();return!Rj(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Y0&&Y0<41}),q0=Sd&&!Symbol.sham&&typeof Symbol.iterator=="symbol",wj=Wr,Ij=Ve,Aj=W,bj=Object,Tu=q0?function(e){return typeof e=="symbol"}:function(e){var t=wj("Symbol");return Ij(t)&&Aj(t.prototype,bj(e))},Oj=String,Td=function(e){try{return Oj(e)}catch{return"Object"}},Nj=Ve,Dj=Td,Pj=TypeError,Fi=function(e){if(Nj(e))return e;throw Pj(Dj(e)+" is not a function")},Lj=Fi,kj=Ed,zp=function(e,t){var n=e[t];return kj(n)?void 0:Lj(n)},J0=De,X0=Ve,Q0=ti,Mj=TypeError,Z0={exports:{}},$0=X,xj=Object.defineProperty,Uj=function(e,t){try{xj($0,e,{value:t,configurable:!0,writable:!0})}catch{$0[e]=t}return t},ew="__core-js_shared__",ug=X[ew]||Uj(ew,{}),tw=ug;(Z0.exports=function(e,t){return tw[e]||(tw[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var vd=Z0.exports,Vj=gd,jj=Object,Qo=function(e){return jj(Vj(e))},Fj=Qo,Bj=x({}.hasOwnProperty),qn=Object.hasOwn||function(e,t){return Bj(Fj(e),t)},Gj=x,Wj=0,Hj=Math.random(),Kj=Gj(1 .toString),hg=function(e){return"Symbol("+(e===void 0?"":e)+")_"+Kj(++Wj+Hj,36)},zj=vd,nw=qn,Yj=hg,qj=Sd,Jj=q0,yd=X.Symbol,pg=zj("wks"),Xj=Jj?yd.for||yd:yd&&yd.withoutSetter||Yj,rn=function(e){return nw(pg,e)||(pg[e]=qj&&nw(yd,e)?yd[e]:Xj("Symbol."+e)),pg[e]},Qj=De,rw=ti,iw=Tu,Zj=zp,$j=function(e,t){var n,r;if(X0(n=e.toString)&&!Q0(r=J0(n,e))||X0(n=e.valueOf)&&!Q0(r=J0(n,e)))return r;throw Mj("Can't convert object to primitive value")},e3=TypeError,t3=rn("toPrimitive"),n3=function(e,t){if(!rw(e)||iw(e))return e;var n,r=Zj(e,t3);if(r){if(n=Qj(r,e,t),!rw(n)||iw(n))return n;throw e3("Can't convert object to primitive value")}return $j(e)},r3=Tu,Yp=function(e){var t=n3(e,"string");return r3(t)?t:t+""},ow=ti,fg=X.document,i3=ow(fg)&&ow(fg.createElement),mg=function(e){return i3?fg.createElement(e):{}},o3=mg,sw=!Dt&&!g(function(){return Object.defineProperty(o3("div"),"a",{get:function(){return 7}}).a!=7}),s3=Dt,a3=De,c3=Ke,d3=ur,l3=ta,u3=Yp,h3=qn,p3=sw,aw=Object.getOwnPropertyDescriptor;nt.f=s3?aw:function(e,t){if(e=l3(e),t=u3(t),p3)try{return aw(e,t)}catch{}if(h3(e,t))return d3(!a3(c3.f,e,t),e[t])};var f3=g,m3=Ve,_3=/#|\.prototype\./,vu=function(e,t){var n=g3[E3(e)];return n==T3||n!=S3&&(m3(t)?f3(t):!!t)},E3=vu.normalize=function(e){return String(e).replace(_3,".").toLowerCase()},g3=vu.data={},S3=vu.NATIVE="N",T3=vu.POLYFILL="P",cw=vu,v3=Fi,y3=C,C3=mt(mt.bind),na=function(e,t){return v3(e),t===void 0?e:y3?C3(e,t):function(){return e.apply(t,arguments)}},Bi={},dw=Dt&&g(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),R3=ti,w3=String,I3=TypeError,Or=function(e){if(R3(e))return e;throw I3(w3(e)+" is not an object")},A3=Dt,b3=sw,O3=dw,qp=Or,lw=Yp,N3=TypeError,_g=Object.defineProperty,D3=Object.getOwnPropertyDescriptor,Eg="enumerable",gg="configurable",Sg="writable";Bi.f=A3?O3?function(e,t,n){if(qp(e),t=lw(t),qp(n),typeof e=="function"&&t==="prototype"&&"value"in n&&Sg in n&&!n[Sg]){var r=D3(e,t);r&&r[Sg]&&(e[t]=n.value,n={configurable:gg in n?n[gg]:r[gg],enumerable:Eg in n?n[Eg]:r[Eg],writable:!1})}return _g(e,t,n)}:_g:function(e,t,n){if(qp(e),t=lw(t),qp(n),b3)try{return _g(e,t,n)}catch{}if("get"in n||"set"in n)throw N3("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var P3=Bi,L3=ur,ra=Dt?function(e,t,n){return P3.f(e,t,L3(1,n))}:function(e,t,n){return e[t]=n,e},Jp=X,k3=Y,M3=mt,x3=Ve,U3=nt.f,V3=cw,Cd=To,j3=na,Rd=ra,uw=qn,F3=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return k3(e,this,arguments)};return t.prototype=e.prototype,t},At=function(e,t){var n,r,i,a,c,d,u,p,f,m=e.target,E=e.global,S=e.stat,I=e.proto,v=E?Jp:S?Jp[m]:(Jp[m]||{}).prototype,y=E?Cd:Cd[m]||Rd(Cd,m,{})[m],A=y.prototype;for(a in t)r=!(n=V3(E?a:m+(S?".":"#")+a,e.forced))&&v&&uw(v,a),d=y[a],r&&(u=e.dontCallGetSet?(f=U3(v,a))&&f.value:v[a]),c=r&&u?u:t[a],r&&typeof d==typeof c||(p=e.bind&&r?j3(c,Jp):e.wrap&&r?F3(c):I&&x3(c)?M3(c):c,(e.sham||c&&c.sham||d&&d.sham)&&Rd(p,"sham",!0),Rd(y,a,p),I&&(uw(Cd,i=m+"Prototype")||Rd(Cd,i,{}),Rd(Cd[i],a,c),e.real&&A&&(n||!A[a])&&Rd(A,a,c)))},B3=Math.ceil,G3=Math.floor,W3=Math.trunc||function(e){var t=+e;return(t>0?G3:B3)(t)},H3=W3,Tg=function(e){var t=+e;return t!=t||t===0?0:H3(t)},K3=Tg,z3=Math.max,Y3=Math.min,vg=function(e,t){var n=K3(e);return n<0?z3(n+t,0):Y3(n,t)},q3=Tg,J3=Math.min,hw=function(e){return e>0?J3(q3(e),9007199254740991):0},X3=hw,Is=function(e){return X3(e.length)},Q3=ta,Z3=vg,$3=Is,pw=function(e){return function(t,n,r){var i,a=Q3(t),c=$3(a),d=Z3(r,c);if(e&&n!=n){for(;c>d;)if((i=a[d++])!=i)return!0}else for(;c>d;d++)if((e||d in a)&&a[d]===n)return e||d||0;return!e&&-1}},yg={includes:pw(!0),indexOf:pw(!1)},eF=yg.includes;At({target:"Array",proto:!0,forced:g(function(){return!Array(1).includes()})},{includes:function(e){return eF(this,e,arguments.length>1?arguments[1]:void 0)}});var tF=To,Gi=function(e){return tF[e+"Prototype"]},nF=Gi("Array").includes,rF=ti,iF=Pe,oF=rn("match"),fw=function(e){var t;return rF(e)&&((t=e[oF])!==void 0?!!t:iF(e)=="RegExp")},sF=fw,aF=TypeError,mw={};mw[rn("toStringTag")]="z";var Cg=String(mw)==="[object z]",cF=Cg,dF=Ve,Xp=Pe,lF=rn("toStringTag"),uF=Object,hF=Xp(function(){return arguments}())=="Arguments",Zo=cF?Xp:function(e){var t,n,r;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(i,a){try{return i[a]}catch{}}(t=uF(e),lF))=="string"?n:hF?Xp(t):(r=Xp(t))=="Object"&&dF(t.callee)?"Arguments":r},pF=Zo,fF=String,vi=function(e){if(pF(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return fF(e)},mF=rn("match"),_F=At,EF=function(e){if(sF(e))throw aF("The method doesn't accept regular expressions");return e},gF=gd,_w=vi,SF=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[mF]=!1,"/./"[e](t)}catch{}}return!1},TF=x("".indexOf);_F({target:"String",proto:!0,forced:!SF("includes")},{includes:function(e){return!!~TF(_w(gF(this)),_w(EF(e)),arguments.length>1?arguments[1]:void 0)}});var vF=Gi("String").includes,Ew=W,yF=nF,CF=vF,Rg=Array.prototype,wg=String.prototype,RF=function(e){var t=e.includes;return e===Rg||Ew(Rg,e)&&t===Rg.includes?yF:typeof e=="string"||e===wg||Ew(wg,e)&&t===wg.includes?CF:t},le=_(RF),wF=Fi,IF=Qo,AF=Kp,bF=Is,OF=TypeError,gw=function(e){return function(t,n,r,i){wF(n);var a=IF(t),c=AF(a),d=bF(a),u=e?d-1:0,p=e?-1:1;if(r<2)for(;;){if(u in c){i=c[u],u+=p;break}if(u+=p,e?u<0:d<=u)throw OF("Reduce of empty array with no initial value")}for(;e?u>=0:d>u;u+=p)u in c&&(i=n(i,c[u],u,a));return i}},NF={left:gw(!1),right:gw(!0)},DF=g,Qp=function(e,t){var n=[][e];return!!n&&DF(function(){n.call(null,t||function(){return 1},1)})},yu=typeof process<"u"&&Pe(process)=="process",PF=NF.left;At({target:"Array",proto:!0,forced:!yu&&uc>79&&uc<83||!Qp("reduce")},{reduce:function(e){var t=arguments.length;return PF(this,e,t,t>1?arguments[1]:void 0)}});var LF=Gi("Array").reduce,kF=W,MF=LF,Ig=Array.prototype,xF=function(e){var t=e.reduce;return e===Ig||kF(Ig,e)&&t===Ig.reduce?MF:t},Sw=xF,vo=_(Sw);let Tw=!0,vw=!0;function Zp(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function hc(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(c,d){if(c!==t)return i.apply(this,arguments);const u=p=>{const f=n(p);f&&(d.handleEvent?d.handleEvent(f):d(f))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(d,u),i.apply(this,[c,u])};const a=r.removeEventListener;r.removeEventListener=function(c,d){if(c!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(d))return a.apply(this,arguments);const u=this._eventMap[t].get(d);return this._eventMap[t].delete(d),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[c,u])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(c){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),c&&this.addEventListener(t,this["_on"+t]=c)},enumerable:!0,configurable:!0})}function UF(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Tw=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function VF(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(vw=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function yw(){if(typeof window=="object"){if(Tw)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Ag(e,t){vw&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Cw(e){return Object.prototype.toString.call(e)==="[object Object]"}function Rw(e){var t;return Cw(e)?vo(t=Object.keys(e)).call(t,function(n,r){const i=Cw(e[r]),a=i?Rw(e[r]):e[r],c=i&&!Object.keys(a).length;return a===void 0||c?n:Object.assign(n,{[r]:a})},{}):e}function bg(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?bg(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(i=>{bg(e,e.get(i),n)})}))}function ww(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const a=[];return e.forEach(c=>{c.type==="track"&&c.trackIdentifier===t.id&&a.push(c)}),a.forEach(c=>{e.forEach(d=>{d.type===r&&d.trackId===c.id&&bg(e,d,i)})}),i}var jF=hg,Iw=vd("keys"),$p=function(e){return Iw[e]||(Iw[e]=jF(e))},FF=!g(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),BF=qn,GF=Ve,WF=Qo,HF=FF,Aw=$p("IE_PROTO"),Og=Object,KF=Og.prototype,Ng=HF?Og.getPrototypeOf:function(e){var t=WF(e);if(BF(t,Aw))return t[Aw];var n=t.constructor;return GF(n)&&t instanceof n?n.prototype:t instanceof Og?KF:null},zF=x,YF=Fi,qF=Ve,JF=String,XF=TypeError,QF=function(e,t,n){try{return zF(YF(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},ZF=Or,$F=function(e){if(typeof e=="object"||qF(e))return e;throw XF("Can't set "+JF(e)+" as a prototype")},eB=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=QF(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(r,i){return ZF(r),$F(i),t?e(r,i):r.__proto__=i,r}}():void 0),ef={},tf={},Dg=qn,tB=ta,nB=yg.indexOf,rB=tf,bw=x([].push),Ow=function(e,t){var n,r=tB(e),i=0,a=[];for(n in r)!Dg(rB,n)&&Dg(r,n)&&bw(a,n);for(;t.length>i;)Dg(r,n=t[i++])&&(~nB(a,n)||bw(a,n));return a},Pg=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],iB=Ow,oB=Pg.concat("length","prototype");ef.f=Object.getOwnPropertyNames||function(e){return iB(e,oB)};var Cu={};Cu.f=Object.getOwnPropertySymbols;var sB=Wr,aB=ef,cB=Cu,dB=Or,lB=x([].concat),uB=sB("Reflect","ownKeys")||function(e){var t=aB.f(dB(e)),n=cB.f;return n?lB(t,n(e)):t},Nw=qn,hB=uB,pB=nt,fB=Bi,Lg={},mB=Ow,_B=Pg,nf=Object.keys||function(e){return mB(e,_B)},EB=Dt,gB=dw,SB=Bi,TB=Or,vB=ta,yB=nf;Lg.f=EB&&!gB?Object.defineProperties:function(e,t){TB(e);for(var n,r=vB(t),i=yB(t),a=i.length,c=0;a>c;)SB.f(e,n=i[c++],r[n]);return e};var rf,Dw=Wr("document","documentElement"),CB=Or,RB=Lg,Pw=Pg,wB=tf,IB=Dw,AB=mg,kg="prototype",Mg="script",Lw=$p("IE_PROTO"),xg=function(){},kw=function(e){return"<"+Mg+">"+e+"</"+Mg+">"},Mw=function(e){e.write(kw("")),e.close();var t=e.parentWindow.Object;return e=null,t},of=function(){try{rf=new ActiveXObject("htmlfile")}catch{}var e,t,n;of=typeof document<"u"?document.domain&&rf?Mw(rf):(t=AB("iframe"),n="java"+Mg+":",t.style.display="none",IB.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(kw("document.F=Object")),e.close(),e.F):Mw(rf);for(var r=Pw.length;r--;)delete of[kg][Pw[r]];return of()};wB[Lw]=!0;var Ru=Object.create||function(e,t){var n;return e!==null?(xg[kg]=CB(e),n=new xg,xg[kg]=null,n[Lw]=e):n=of(),t===void 0?n:RB.f(n,t)},bB=ti,OB=ra,xw=Error,NB=x("".replace),DB=String(xw("zxcasd").stack),Uw=/\n\s*at [^:]*:[^\n]*/,PB=Uw.test(DB),LB=ur,kB=!g(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",LB(1,7)),e.stack!==7)}),MB=ra,xB=function(e,t){if(PB&&typeof e=="string"&&!xw.prepareStackTrace)for(;t--;)e=NB(e,Uw,"");return e},UB=kB,Vw=Error.captureStackTrace,pc={},VB=pc,jB=rn("iterator"),FB=Array.prototype,jw=function(e){return e!==void 0&&(VB.Array===e||FB[jB]===e)},BB=Zo,Fw=zp,GB=Ed,WB=pc,HB=rn("iterator"),sf=function(e){if(!GB(e))return Fw(e,HB)||Fw(e,"@@iterator")||WB[BB(e)]},KB=De,zB=Fi,YB=Or,qB=Td,JB=sf,XB=TypeError,Ug=function(e,t){var n=arguments.length<2?JB(e):t;if(zB(n))return YB(KB(n,e));throw XB(qB(e)+" is not iterable")},QB=De,Bw=Or,ZB=zp,Gw=function(e,t,n){var r,i;Bw(e);try{if(!(r=ZB(e,"return"))){if(t==="throw")throw n;return n}r=QB(r,e)}catch(a){i=!0,r=a}if(t==="throw")throw n;if(i)throw r;return Bw(r),n},$B=na,e6=De,t6=Or,n6=Td,r6=jw,i6=Is,Ww=W,o6=Ug,s6=sf,Hw=Gw,a6=TypeError,af=function(e,t){this.stopped=e,this.result=t},Kw=af.prototype,wu=function(e,t,n){var r,i,a,c,d,u,p,f=n&&n.that,m=!(!n||!n.AS_ENTRIES),E=!(!n||!n.IS_RECORD),S=!(!n||!n.IS_ITERATOR),I=!(!n||!n.INTERRUPTED),v=$B(t,f),y=function(N){return r&&Hw(r,"normal",N),new af(!0,N)},A=function(N){return m?(t6(N),I?v(N[0],N[1],y):v(N[0],N[1])):I?v(N,y):v(N)};if(E)r=e.iterator;else if(S)r=e;else{if(!(i=s6(e)))throw a6(n6(e)+" is not iterable");if(r6(i)){for(a=0,c=i6(e);c>a;a++)if((d=A(e[a]))&&Ww(Kw,d))return d;return new af(!1)}r=o6(e,i)}for(u=E?e.next:r.next;!(p=e6(u,r)).done;){try{d=A(p.value)}catch(N){Hw(r,"throw",N)}if(typeof d=="object"&&d&&Ww(Kw,d))return d}return new af(!1)},c6=vi,d6=At,l6=W,u6=Ng,cf=eB,h6=function(e,t,n){for(var r=hB(t),i=fB.f,a=pB.f,c=0;c<r.length;c++){var d=r[c];Nw(e,d)||n&&Nw(n,d)||i(e,d,a(t,d))}},zw=Ru,Vg=ra,jg=ur,p6=function(e,t){bB(t)&&"cause"in t&&OB(e,"cause",t.cause)},f6=function(e,t,n,r){UB&&(Vw?Vw(e,t):MB(e,"stack",xB(n,r)))},m6=wu,_6=function(e,t){return e===void 0?arguments.length<2?"":t:c6(e)},E6=rn("toStringTag"),df=Error,g6=[].push,wd=function(e,t){var n,r=l6(Fg,this);cf?n=cf(df(),r?u6(this):Fg):(n=r?this:zw(Fg),Vg(n,E6,"Error")),t!==void 0&&Vg(n,"message",_6(t)),f6(n,wd,n.stack,1),arguments.length>2&&p6(n,arguments[2]);var i=[];return m6(e,g6,{that:i}),Vg(n,"errors",i),n};cf?cf(wd,df):h6(wd,df,{name:!0});var Fg=wd.prototype=zw(df.prototype,{constructor:jg(1,wd),message:jg(1,""),name:jg(1,"AggregateError")});d6({global:!0,constructor:!0,arity:2},{AggregateError:wd});var lf,Iu,uf,S6=Ve,Yw=X.WeakMap,T6=S6(Yw)&&/native code/.test(String(Yw)),qw=X,v6=ti,y6=ra,Bg=qn,Gg=ug,C6=$p,R6=tf,Jw="Object already initialized",Wg=qw.TypeError,w6=qw.WeakMap;if(T6||Gg.state){var $o=Gg.state||(Gg.state=new w6);$o.get=$o.get,$o.has=$o.has,$o.set=$o.set,lf=function(e,t){if($o.has(e))throw Wg(Jw);return t.facade=e,$o.set(e,t),t},Iu=function(e){return $o.get(e)||{}},uf=function(e){return $o.has(e)}}else{var Id=C6("state");R6[Id]=!0,lf=function(e,t){if(Bg(e,Id))throw Wg(Jw);return t.facade=e,y6(e,Id,t),t},Iu=function(e){return Bg(e,Id)?e[Id]:{}},uf=function(e){return Bg(e,Id)}}var fc,Xw,Qw,mc={set:lf,get:Iu,has:uf,enforce:function(e){return uf(e)?Iu(e):lf(e,{})},getterFor:function(e){return function(t){var n;if(!v6(t)||(n=Iu(t)).type!==e)throw Wg("Incompatible receiver, "+e+" required");return n}}},Hg=Dt,I6=qn,Zw=Function.prototype,A6=Hg&&Object.getOwnPropertyDescriptor,Kg=I6(Zw,"name"),$w={EXISTS:Kg,PROPER:Kg&&(function(){}).name==="something",CONFIGURABLE:Kg&&(!Hg||Hg&&A6(Zw,"name").configurable)},b6=ra,ia=function(e,t,n,r){return r&&r.enumerable?e[t]=n:b6(e,t,n),e},O6=g,N6=Ve,D6=ti,P6=Ru,eI=Ng,L6=ia,zg=rn("iterator"),tI=!1;[].keys&&("next"in(Qw=[].keys())?(Xw=eI(eI(Qw)))!==Object.prototype&&(fc=Xw):tI=!0);var k6=!D6(fc)||O6(function(){var e={};return fc[zg].call(e)!==e});N6((fc=k6?{}:P6(fc))[zg])||L6(fc,zg,function(){return this});var nI={IteratorPrototype:fc,BUGGY_SAFARI_ITERATORS:tI},M6=Zo,x6=Cg?{}.toString:function(){return"[object "+M6(this)+"]"},U6=Cg,V6=Bi.f,j6=ra,F6=qn,B6=x6,rI=rn("toStringTag"),oa=function(e,t,n,r){if(e){var i=n?e:e.prototype;F6(i,rI)||V6(i,rI,{configurable:!0,value:t}),r&&!U6&&j6(i,"toString",B6)}},G6=nI.IteratorPrototype,W6=Ru,H6=ur,K6=oa,z6=pc,Y6=function(){return this},Yg=function(e,t,n,r){var i=t+" Iterator";return e.prototype=W6(G6,{next:H6(+!r,n)}),K6(e,i,!1,!0),z6[i]=Y6,e},q6=At,J6=De,X6=$w,Q6=Yg,Z6=Ng,$6=oa,iI=ia,oI=pc,e8=nI,t8=X6.PROPER,hf=e8.BUGGY_SAFARI_ITERATORS,qg=rn("iterator"),sI="keys",pf="values",aI="entries",n8=function(){return this},cI=function(e,t,n,r,i,a,c){Q6(n,t,r);var d,u,p,f=function(A){if(A===i&&v)return v;if(!hf&&A in S)return S[A];switch(A){case sI:case pf:case aI:return function(){return new n(this,A)}}return function(){return new n(this)}},m=t+" Iterator",E=!1,S=e.prototype,I=S[qg]||S["@@iterator"]||i&&S[i],v=!hf&&I||f(i),y=t=="Array"&&S.entries||I;if(y&&(d=Z6(y.call(new e)))!==Object.prototype&&d.next&&($6(d,m,!0,!0),oI[m]=n8),t8&&i==pf&&I&&I.name!==pf&&(E=!0,v=function(){return J6(I,this)}),i)if(u={values:f(pf),keys:a?v:f(sI),entries:f(aI)},c)for(p in u)(hf||E||!(p in S))&&iI(S,p,u[p]);else q6({target:t,proto:!0,forced:hf||E},u);return c&&S[qg]!==v&&iI(S,qg,v,{name:i}),oI[t]=v,u},Jg=function(e,t){return{value:e,done:t}},r8=ta,dI=pc,lI=mc;Bi.f;var i8=cI,uI=Jg,hI="Array Iterator",o8=lI.set,s8=lI.getterFor(hI);i8(Array,"Array",function(e,t){o8(this,{type:hI,target:r8(e),index:0,kind:t})},function(){var e=s8(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,uI(void 0,!0)):uI(n=="keys"?r:n=="values"?t[r]:[r,t[r]],!1)},"values"),dI.Arguments=dI.Array;var a8=Bi,ff=function(e,t,n){return a8.f(e,t,n)},c8=Wr,d8=ff,l8=Dt,pI=rn("species"),u8=W,h8=TypeError,Xg=function(e,t){if(u8(t,e))return e;throw h8("Incorrect invocation")},p8=Ve,Qg=ug,f8=x(Function.toString);p8(Qg.inspectSource)||(Qg.inspectSource=function(e){return f8(e)});var fI=Qg.inspectSource,m8=x,_8=g,mI=Ve,E8=Zo,g8=fI,_I=function(){},S8=[],EI=Wr("Reflect","construct"),Zg=/^\s*(?:class|function)\b/,T8=m8(Zg.exec),v8=!Zg.exec(_I),Au=function(e){if(!mI(e))return!1;try{return EI(_I,S8,e),!0}catch{return!1}},gI=function(e){if(!mI(e))return!1;switch(E8(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return v8||!!T8(Zg,g8(e))}catch{return!0}};gI.sham=!0;var bu,Ad,SI,$g,mf=!EI||_8(function(){var e;return Au(Au.call)||!Au(Object)||!Au(function(){e=!0})||e})?gI:Au,y8=mf,C8=Td,R8=TypeError,TI=Or,w8=function(e){if(y8(e))return e;throw R8(C8(e)+" is not a constructor")},I8=Ed,A8=rn("species"),eS=function(e,t){var n,r=TI(e).constructor;return r===void 0||I8(n=TI(r)[A8])?t:w8(n)},tS=x([].slice),b8=TypeError,_f=function(e,t){if(e<t)throw b8("Not enough arguments");return e},vI=/(?:ipad|iphone|ipod).*applewebkit/i.test(lc),yi=X,O8=Y,N8=na,yI=Ve,D8=qn,CI=g,RI=Dw,P8=tS,wI=mg,L8=_f,k8=vI,M8=yu,nS=yi.setImmediate,rS=yi.clearImmediate,x8=yi.process,iS=yi.Dispatch,U8=yi.Function,II=yi.MessageChannel,V8=yi.String,oS=0,Ou={},AI="onreadystatechange";CI(function(){bu=yi.location});var sS=function(e){if(D8(Ou,e)){var t=Ou[e];delete Ou[e],t()}},aS=function(e){return function(){sS(e)}},bI=function(e){sS(e.data)},OI=function(e){yi.postMessage(V8(e),bu.protocol+"//"+bu.host)};nS&&rS||(nS=function(e){L8(arguments.length,1);var t=yI(e)?e:U8(e),n=P8(arguments,1);return Ou[++oS]=function(){O8(t,void 0,n)},Ad(oS),oS},rS=function(e){delete Ou[e]},M8?Ad=function(e){x8.nextTick(aS(e))}:iS&&iS.now?Ad=function(e){iS.now(aS(e))}:II&&!k8?($g=(SI=new II).port2,SI.port1.onmessage=bI,Ad=N8($g.postMessage,$g)):yi.addEventListener&&yI(yi.postMessage)&&!yi.importScripts&&bu&&bu.protocol!=="file:"&&!CI(OI)?(Ad=OI,yi.addEventListener("message",bI,!1)):Ad=AI in wI("script")?function(e){RI.appendChild(wI("script"))[AI]=function(){RI.removeChild(this),sS(e)}}:function(e){setTimeout(aS(e),0)});var NI={set:nS,clear:rS},DI=function(){this.head=null,this.tail=null};DI.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var bd,cS,dS,lS,PI,LI=DI,j8=/ipad|iphone|ipod/i.test(lc)&&typeof Pebble<"u",F8=/web0s(?!.*chrome)/i.test(lc),_c=X,kI=na,B8=nt.f,uS=NI.set,G8=LI,W8=vI,H8=j8,K8=F8,hS=yu,MI=_c.MutationObserver||_c.WebKitMutationObserver,xI=_c.document,UI=_c.process,Ef=_c.Promise,VI=B8(_c,"queueMicrotask"),pS=VI&&VI.value;if(!pS){var gf=new G8,Sf=function(){var e,t;for(hS&&(e=UI.domain)&&e.exit();t=gf.get();)try{t()}catch(n){throw gf.head&&bd(),n}e&&e.enter()};W8||hS||K8||!MI||!xI?!H8&&Ef&&Ef.resolve?((lS=Ef.resolve(void 0)).constructor=Ef,PI=kI(lS.then,lS),bd=function(){PI(Sf)}):hS?bd=function(){UI.nextTick(Sf)}:(uS=kI(uS,_c),bd=function(){uS(Sf)}):(cS=!0,dS=xI.createTextNode(""),new MI(Sf).observe(dS,{characterData:!0}),bd=function(){dS.data=cS=!cS}),pS=function(e){gf.head||bd(),gf.add(e)}}var z8=pS,Od=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Ec=X.Promise,jI=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Y8=!jI&&!yu&&typeof window=="object"&&typeof document=="object",q8=X,Nu=Ec,J8=Ve,X8=cw,Q8=fI,Z8=rn,$8=Y8,eG=jI,fS=uc,FI=Nu&&Nu.prototype,tG=Z8("species"),BI=!1,GI=J8(q8.PromiseRejectionEvent),nG=X8("Promise",function(){var e=Q8(Nu),t=e!==String(Nu);if(!t&&fS===66||!FI.catch||!FI.finally)return!0;if(!fS||fS<51||!/native code/.test(e)){var n=new Nu(function(i){i(1)}),r=function(i){i(function(){},function(){})};if((n.constructor={})[tG]=r,!(BI=n.then(function(){})instanceof r))return!0}return!t&&($8||eG)&&!GI}),Du={CONSTRUCTOR:nG,REJECTION_EVENT:GI,SUBCLASSING:BI},es={},WI=Fi,rG=TypeError,iG=function(e){var t,n;this.promise=new e(function(r,i){if(t!==void 0||n!==void 0)throw rG("Bad Promise constructor");t=r,n=i}),this.resolve=WI(t),this.reject=WI(n)};es.f=function(e){return new iG(e)};var mS,HI,oG=At,Tf=yu,sa=X,Pu=De,sG=ia,aG=oa,cG=function(e){var t=c8(e);l8&&t&&!t[pI]&&d8(t,pI,{configurable:!0,get:function(){return this}})},dG=Fi,_S=Ve,lG=ti,uG=Xg,hG=eS,KI=NI.set,ES=z8,pG=function(e,t){try{arguments.length==1?console.error(e):console.error(e,t)}catch{}},fG=Od,mG=LI,zI=mc,gS=Ec,YI=Du,qI=es,vf="Promise",JI=YI.CONSTRUCTOR,_G=YI.REJECTION_EVENT,SS=zI.getterFor(vf),EG=zI.set,gG=gS&&gS.prototype,Lu=gS,TS=gG,XI=sa.TypeError,vS=sa.document,yS=sa.process,CS=qI.f,SG=CS,TG=!!(vS&&vS.createEvent&&sa.dispatchEvent),QI="unhandledrejection",ZI=function(e){var t;return!(!lG(e)||!_S(t=e.then))&&t},$I=function(e,t){var n,r,i,a=t.value,c=t.state==1,d=c?e.ok:e.fail,u=e.resolve,p=e.reject,f=e.domain;try{d?(c||(t.rejection===2&&yG(t),t.rejection=1),d===!0?n=a:(f&&f.enter(),n=d(a),f&&(f.exit(),i=!0)),n===e.promise?p(XI("Promise-chain cycle")):(r=ZI(n))?Pu(r,n,u,p):u(n)):p(a)}catch(m){f&&!i&&f.exit(),p(m)}},eA=function(e,t){e.notified||(e.notified=!0,ES(function(){for(var n,r=e.reactions;n=r.get();)$I(n,e);e.notified=!1,t&&!e.rejection&&vG(e)}))},tA=function(e,t,n){var r,i;TG?((r=vS.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),sa.dispatchEvent(r)):r={promise:t,reason:n},!_G&&(i=sa["on"+e])?i(r):e===QI&&pG("Unhandled promise rejection",n)},vG=function(e){Pu(KI,sa,function(){var t,n=e.facade,r=e.value;if(nA(e)&&(t=fG(function(){Tf?yS.emit("unhandledRejection",r,n):tA(QI,n,r)}),e.rejection=Tf||nA(e)?2:1,t.error))throw t.value})},nA=function(e){return e.rejection!==1&&!e.parent},yG=function(e){Pu(KI,sa,function(){var t=e.facade;Tf?yS.emit("rejectionHandled",t):tA("rejectionhandled",t,e.value)})},Nd=function(e,t,n){return function(r){e(t,r,n)}},Dd=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,eA(e,!0))},RS=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw XI("Promise can't be resolved itself");var r=ZI(t);r?ES(function(){var i={done:!1};try{Pu(r,t,Nd(RS,i,e),Nd(Dd,i,e))}catch(a){Dd(i,a,e)}}):(e.value=t,e.state=1,eA(e,!1))}catch(i){Dd({done:!1},i,e)}}};JI&&(TS=(Lu=function(e){uG(this,TS),dG(e),Pu(mS,this);var t=SS(this);try{e(Nd(RS,t),Nd(Dd,t))}catch(n){Dd(t,n)}}).prototype,(mS=function(e){EG(this,{type:vf,done:!1,notified:!1,parent:!1,reactions:new mG,rejection:!1,state:0,value:void 0})}).prototype=sG(TS,"then",function(e,t){var n=SS(this),r=CS(hG(this,Lu));return n.parent=!0,r.ok=!_S(e)||e,r.fail=_S(t)&&t,r.domain=Tf?yS.domain:void 0,n.state==0?n.reactions.add(r):ES(function(){$I(r,n)}),r.promise}),HI=function(){var e=new mS,t=SS(e);this.promise=e,this.resolve=Nd(RS,t),this.reject=Nd(Dd,t)},qI.f=CS=function(e){return e===Lu||e===void 0?new HI(e):SG(e)}),oG({global:!0,constructor:!0,wrap:!0,forced:JI},{Promise:Lu}),aG(Lu,vf,!1,!0),cG(vf);var rA=rn("iterator"),iA=!1;try{var CG=0,oA={next:function(){return{done:!!CG++}},return:function(){iA=!0}};oA[rA]=function(){return this},Array.from(oA,function(){throw 2})}catch{}var RG=Ec,wG=function(e,t){if(!iA)return!1;var n=!1;try{var r={};r[rA]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch{}return n},yf=Du.CONSTRUCTOR||!wG(function(e){RG.all(e).then(void 0,function(){})}),IG=De,AG=Fi,bG=es,OG=Od,NG=wu;At({target:"Promise",stat:!0,forced:yf},{all:function(e){var t=this,n=bG.f(t),r=n.resolve,i=n.reject,a=OG(function(){var c=AG(t.resolve),d=[],u=0,p=1;NG(e,function(f){var m=u++,E=!1;p++,IG(c,t,f).then(function(S){E||(E=!0,d[m]=S,--p||r(d))},i)}),--p||r(d)});return a.error&&i(a.value),n.promise}});var DG=At,PG=Du.CONSTRUCTOR;Ec&&Ec.prototype,DG({target:"Promise",proto:!0,forced:PG,real:!0},{catch:function(e){return this.then(void 0,e)}});var LG=De,kG=Fi,MG=es,xG=Od,UG=wu;At({target:"Promise",stat:!0,forced:yf},{race:function(e){var t=this,n=MG.f(t),r=n.reject,i=xG(function(){var a=kG(t.resolve);UG(e,function(c){LG(a,t,c).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}});var VG=De,jG=es;At({target:"Promise",stat:!0,forced:Du.CONSTRUCTOR},{reject:function(e){var t=jG.f(this);return VG(t.reject,void 0,e),t.promise}});var FG=Or,BG=ti,GG=es,sA=function(e,t){if(FG(e),BG(t)&&t.constructor===e)return t;var n=GG.f(e);return(0,n.resolve)(t),n.promise},WG=At,HG=Ec,KG=Du.CONSTRUCTOR,zG=sA,YG=Wr("Promise"),qG=!KG;WG({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return zG(qG&&this===YG?HG:this,e)}});var JG=De,XG=Fi,QG=es,ZG=Od,$G=wu;At({target:"Promise",stat:!0,forced:yf},{allSettled:function(e){var t=this,n=QG.f(t),r=n.resolve,i=n.reject,a=ZG(function(){var c=XG(t.resolve),d=[],u=0,p=1;$G(e,function(f){var m=u++,E=!1;p++,JG(c,t,f).then(function(S){E||(E=!0,d[m]={status:"fulfilled",value:S},--p||r(d))},function(S){E||(E=!0,d[m]={status:"rejected",reason:S},--p||r(d))})}),--p||r(d)});return a.error&&i(a.value),n.promise}});var eW=De,tW=Fi,nW=Wr,rW=es,iW=Od,oW=wu,aA="No one promise resolved";At({target:"Promise",stat:!0,forced:yf},{any:function(e){var t=this,n=nW("AggregateError"),r=rW.f(t),i=r.resolve,a=r.reject,c=iW(function(){var d=tW(t.resolve),u=[],p=0,f=1,m=!1;oW(e,function(E){var S=p++,I=!1;f++,eW(d,t,E).then(function(v){I||m||(m=!0,i(v))},function(v){I||m||(I=!0,u[S]=v,--f||a(new n(u,aA)))})}),--f||a(new n(u,aA))});return c.error&&a(c.value),r.promise}});var sW=At,wS=Ec,aW=g,cW=Wr,dW=Ve,lW=eS,cA=sA,uW=wS&&wS.prototype;sW({target:"Promise",proto:!0,real:!0,forced:!!wS&&aW(function(){uW.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=lW(this,cW("Promise")),n=dW(e);return this.then(n?function(r){return cA(t,e()).then(function(){return r})}:e,n?function(r){return cA(t,e()).then(function(){throw r})}:e)}});var IS=x,hW=Tg,pW=vi,fW=gd,mW=IS("".charAt),dA=IS("".charCodeAt),_W=IS("".slice),lA=function(e){return function(t,n){var r,i,a=pW(fW(t)),c=hW(n),d=a.length;return c<0||c>=d?e?"":void 0:(r=dA(a,c))<55296||r>56319||c+1===d||(i=dA(a,c+1))<56320||i>57343?e?mW(a,c):r:e?_W(a,c,c+2):i-56320+(r-55296<<10)+65536}},AS={codeAt:lA(!1),charAt:lA(!0)},EW=AS.charAt,gW=vi,uA=mc,SW=cI,hA=Jg,pA="String Iterator",TW=uA.set,vW=uA.getterFor(pA);SW(String,"String",function(e){TW(this,{type:pA,string:gW(e),index:0})},function(){var e,t=vW(this),n=t.string,r=t.index;return r>=n.length?hA(void 0,!0):(e=EW(n,r),t.index+=e.length,hA(e,!1))});var yW=To.Promise,CW={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},RW=X,wW=Zo,IW=ra,fA=pc,mA=rn("toStringTag");for(var bS in CW){var _A=RW[bS],OS=_A&&_A.prototype;OS&&wW(OS)!==mA&&IW(OS,mA,bS),fA[bS]=fA.Array}var EA=yW,ae=_(EA);const gA=yw;function SA(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const d={};return Object.keys(c).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const p=typeof c[u]=="object"?c[u]:{ideal:c[u]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const f=function(m,E){return m?m+E.charAt(0).toUpperCase()+E.slice(1):E==="deviceId"?"sourceId":E};if(p.ideal!==void 0){d.optional=d.optional||[];let m={};typeof p.ideal=="number"?(m[f("min",u)]=p.ideal,d.optional.push(m),m={},m[f("max",u)]=p.ideal,d.optional.push(m)):(m[f("",u)]=p.ideal,d.optional.push(m))}p.exact!==void 0&&typeof p.exact!="number"?(d.mandatory=d.mandatory||{},d.mandatory[f("",u)]=p.exact):["min","max"].forEach(m=>{p[m]!==void 0&&(d.mandatory=d.mandatory||{},d.mandatory[f(m,u)]=p[m])})}),c.advanced&&(d.optional=(d.optional||[]).concat(c.advanced)),d},i=function(c,d){if(t.version>=61)return d(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){const u=function(p,f,m){f in p&&!(m in p)&&(p[m]=p[f],delete p[f])};u((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),u(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=r(c.audio)}if(c&&typeof c.video=="object"){let u=c.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const p=t.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||p)){let f;if(delete c.video.facingMode,u.exact==="environment"||u.ideal==="environment"?f=["back","rear"]:u.exact!=="user"&&u.ideal!=="user"||(f=["front"]),f)return n.mediaDevices.enumerateDevices().then(m=>{let E=(m=m.filter(S=>S.kind==="videoinput")).find(S=>f.some(I=>{var v;return le(v=S.label.toLowerCase()).call(v,I)}));return!E&&m.length&&le(f).call(f,"back")&&(E=m[m.length-1]),E&&(c.video.deviceId=u.exact?{exact:E.deviceId}:{ideal:E.deviceId}),c.video=r(c.video),gA("chrome: "+JSON.stringify(c)),d(c)})}c.video=r(c.video)}return gA("chrome: "+JSON.stringify(c)),d(c)},a=function(c){return t.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(c,d,u){i(c,p=>{n.webkitGetUserMedia(p,d,f=>{u&&u(a(f))})})}).bind(n),n.mediaDevices.getUserMedia){const c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(d){return i(d,u=>c(u).then(p=>{if(u.audio&&!p.getAudioTracks().length||u.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return p},p=>ae.reject(a(p))))}}}function TA(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function vA(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===r.track.id):{track:r.track};const a=new Event("track");a.track=r.track,a.receiver=i,a.transceiver={receiver:i},a.streams=[n.stream],this.dispatchEvent(a)}),n.stream.getTracks().forEach(r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===r.id):{track:r};const a=new Event("track");a.track=r,a.receiver=i,a.transceiver={receiver:i},a.streams=[n.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else hc(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function yA(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=i.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,d){let u=i.apply(this,arguments);return u||(u=t(this,c),this._senders.push(u)),u};const a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){a.apply(this,arguments);const d=this._senders.indexOf(c);d!==-1&&this._senders.splice(d,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(a=>{this._senders.push(t(this,a))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(a=>{const c=this._senders.find(d=>d.track===a);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function CA(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,r,i]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const a=function(d){const u={};return d.result().forEach(p=>{const f={id:p.id,timestamp:p.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[p.type]||p.type};p.names().forEach(m=>{f[m]=p.stat(m)}),u[f.id]=f}),u},c=function(d){return new Map(Object.keys(d).map(u=>[u,d[u]]))};if(arguments.length>=2){const d=function(u){r(c(a(u)))};return t.apply(this,[d,n])}return new ae((d,u)=>{t.apply(this,[function(p){d(c(a(p)))},u])}).then(r,i)}}function RA(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(a=>a._pc=this),i});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(a=>ww(a,i.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(i=>i._pc=this),r}),hc(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(i=>ww(i,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let r,i,a;return this.getSenders().forEach(c=>{c.track===n&&(r?a=!0:r=c)}),this.getReceivers().forEach(c=>(c.track===n&&(i?a=!0:i=c),c.track===n)),a||r&&i?ae.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():ae.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function wA(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const d=t.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(d)===-1&&this._shimmedLocalStreams[c.id].push(d):this._shimmedLocalStreams[c.id]=[c,d],d};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(u=>{if(this.getSenders().find(f=>f.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();n.apply(this,arguments);const d=this.getSenders().filter(u=>c.indexOf(u)===-1);this._shimmedLocalStreams[a.id]=[a].concat(d)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const d=this._shimmedLocalStreams[c].indexOf(a);d!==-1&&this._shimmedLocalStreams[c].splice(d,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),i.apply(this,arguments)}}function IA(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return wA(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(p=>this._reverseStreams[p.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(p=>{if(this.getSenders().find(m=>m.track===p))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const p=new e.MediaStream(u.getTracks());this._streams[u.id]=p,this._reverseStreams[p.id]=u,u=p}r.apply(this,[u])};const i=e.RTCPeerConnection.prototype.removeStream;function a(u,p){let f=p.sdp;return Object.keys(u._reverseStreams||[]).forEach(m=>{const E=u._reverseStreams[m],S=u._streams[E.id];f=f.replace(new RegExp(S.id,"g"),E.id)}),new RTCSessionDescription({type:p.type,sdp:f})}e.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},e.RTCPeerConnection.prototype.addTrack=function(u,p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(S=>S===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(S=>S.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const E=this._streams[p.id];if(E)E.addTrack(u),ae.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const S=new e.MediaStream([u]);this._streams[p.id]=S,this._reverseStreams[S.id]=p,this.addStream(S)}return this.getSenders().find(S=>S.track===u)},["createOffer","createAnswer"].forEach(function(u){const p=e.RTCPeerConnection.prototype[u],f={[u](){const m=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[E=>{const S=a(this,E);m[0].apply(null,[S])},E=>{m[1]&&m[1].apply(null,E)},arguments[2]]):p.apply(this,arguments).then(E=>a(this,E))}};e.RTCPeerConnection.prototype[u]=f[u]});const c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(u,p){let f=p.sdp;return Object.keys(u._reverseStreams||[]).forEach(m=>{const E=u._reverseStreams[m],S=u._streams[E.id];f=f.replace(new RegExp(E.id,"g"),S.id)}),new RTCSessionDescription({type:p.type,sdp:f})}(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};const d=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const u=d.get.apply(this);return u.type===""?u:a(this,u)}}),e.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(u._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let p;this._streams=this._streams||{},Object.keys(this._streams).forEach(f=>{this._streams[f].getTracks().find(m=>u.track===m)&&(p=this._streams[f])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function NS(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=e.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=i[n]})}function AA(e,t){hc(e,"negotiationneeded",n=>{const r=n.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return n})}var bA=Object.freeze({__proto__:null,fixNegotiationNeeded:AA,shimAddTrackRemoveTrack:IA,shimAddTrackRemoveTrackWithNative:wA,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(r=>{const i=n.video&&n.video.width,a=n.video&&n.video.height,c=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:c||3}},i&&(n.video.mandatory.maxWidth=i),a&&(n.video.mandatory.maxHeight=a),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:yA,shimGetStats:CA,shimGetUserMedia:SA,shimMediaStream:TA,shimOnTrack:vA,shimPeerConnection:NS,shimSenderReceiverGetStats:RA});function OA(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(i,a,c){Ag("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(a,c)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(c,d,u){d in c&&!(u in c)&&(c[u]=c[d],delete c[d])},a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),i(c.audio,"autoGainControl","mozAutoGainControl"),i(c.audio,"noiseSuppression","mozNoiseSuppression")),a(c)},r&&r.prototype.getSettings){const c=r.prototype.getSettings;r.prototype.getSettings=function(){const d=c.apply(this,arguments);return i(d,"mozAutoGainControl","autoGainControl"),i(d,"mozNoiseSuppression","noiseSuppression"),d}}if(r&&r.prototype.applyConstraints){const c=r.prototype.applyConstraints;r.prototype.applyConstraints=function(d){return this.kind==="audio"&&typeof d=="object"&&(d=JSON.parse(JSON.stringify(d)),i(d,"autoGainControl","mozAutoGainControl"),i(d,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[d])}}}}function NA(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function DS(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const a=e.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=c[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,a,c]=arguments;return r.apply(this,[i||null]).then(d=>{if(t.version<53&&!a)try{d.forEach(u=>{u.type=n[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;d.forEach((p,f)=>{d.set(f,Object.assign({},p,{type:n[p.type]||p.type}))})}return d}).then(a,c)}}function DA(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ae.resolve(new Map)}}function PA(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n}),hc(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function LA(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){Ag("removeStream","removeTrack"),this.getSenders().forEach(n=>{var r;n.track&&le(r=t.getTracks()).call(r,n.track)&&this.removeTrack(n)})})}function kA(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function MA(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=t.apply(this,arguments);if(r){const{sender:a}=i,c=a.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n,a.sendEncodings=n,this.setParametersPromises.push(a.setParameters(c).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return i})}function xA(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function UA(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ae.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function VA(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ae.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var jA=Object.freeze({__proto__:null,shimAddTransceiver:MA,shimCreateAnswer:VA,shimCreateOffer:UA,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,ae.reject(r)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:xA,shimGetUserMedia:OA,shimOnTrack:NA,shimPeerConnection:DS,shimRTCDataChannel:kA,shimReceiverGetStats:PA,shimRemoveStream:LA,shimSenderGetStats:DA});function FA(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var r;this._localStreams||(this._localStreams=[]),le(r=this._localStreams).call(r,n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>t.call(this,i,n)),n.getVideoTracks().forEach(i=>t.call(this,i,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return i&&i.forEach(c=>{var d;this._localStreams?le(d=this._localStreams).call(d,c)||this._localStreams.push(c):this._localStreams=[c]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const r=t.getTracks();this.getSenders().forEach(i=>{le(r).call(r,i.track)&&this.removeTrack(i)})})}}function BA(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{var a;if(this._remoteStreams||(this._remoteStreams=[]),le(a=this._remoteStreams).call(a,i))return;this._remoteStreams.push(i);const c=new Event("addstream");c.stream=i,this.dispatchEvent(c)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(i=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(i)>=0)return;n._remoteStreams.push(i);const a=new Event("addstream");a.stream=i,n.dispatchEvent(a)})}),t.apply(n,arguments)}}}function GA(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(u,p){const f=arguments.length>=2?arguments[2]:arguments[0],m=n.apply(this,[f]);return p?(m.then(u,p),ae.resolve()):m},t.createAnswer=function(u,p){const f=arguments.length>=2?arguments[2]:arguments[0],m=r.apply(this,[f]);return p?(m.then(u,p),ae.resolve()):m};let d=function(u,p,f){const m=i.apply(this,[u]);return f?(m.then(p,f),ae.resolve()):m};t.setLocalDescription=d,d=function(u,p,f){const m=a.apply(this,[u]);return f?(m.then(p,f),ae.resolve()):m},t.setRemoteDescription=d,d=function(u,p,f){const m=c.apply(this,[u]);return f?(m.then(p,f),ae.resolve()):m},t.addIceCandidate=d}function WA(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=i=>r(HA(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,r,i){t.mediaDevices.getUserMedia(n).then(r,i)}).bind(t))}function HA(e){return e&&e.video!==void 0?Object.assign({},e,{video:Rw(e.video)}):e}function KA(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const i=[];for(let a=0;a<n.iceServers.length;a++){let c=n.iceServers[a];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(Ag("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,i.push(c)):i.push(n.iceServers[a])}n.iceServers=i}return new t(n,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function zA(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function YA(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const i=this.getTransceivers().find(a=>a.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function qA(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var JA=Object.freeze({__proto__:null,shimAudioContext:qA,shimCallbacksAPI:GA,shimConstraints:HA,shimCreateOfferLegacy:YA,shimGetUserMedia:WA,shimLocalStreamsAPI:FA,shimRTCIceServerUrls:KA,shimRemoteStreamsAPI:BA,shimTrackEventTransceiver:zA}),XA=`	
\v\f\r                　\u2028\u2029\uFEFF`,AW=gd,bW=vi,PS=XA,QA=x("".replace),OW=RegExp("^["+PS+"]+"),NW=RegExp("(^|[^"+PS+"])["+PS+"]+$"),LS=function(e){return function(t){var n=bW(AW(t));return 1&e&&(n=QA(n,OW,"")),2&e&&(n=QA(n,NW,"$1")),n}},DW={start:LS(1),end:LS(2),trim:LS(3)},PW=$w.PROPER,LW=g,ZA=XA,kW=DW.trim;At({target:"String",proto:!0,forced:function(e){return LW(function(){return!!ZA[e]()||"​᠎"[e]()!=="​᠎"||PW&&ZA[e].name!==e})}("trim")},{trim:function(){return kW(this)}});var MW=Gi("String").trim,xW=W,UW=MW,kS=String.prototype,VW=function(e){var t=e.trim;return typeof e=="string"||e===kS||xW(kS,e)&&t===kS.trim?UW:t},ir=_(VW),$A={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(n){return n.split(`
m=`).map((r,i)=>(i>0?"m="+r:r).trim()+`\r
`)},t.getDescription=function(n){const r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){const r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter(i=>i.indexOf(r)===0)},t.parseCandidate=function(n){let r;r=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let a=8;a<r.length;a+=2)switch(r[a]){case"raddr":i.relatedAddress=r[a+1];break;case"rport":i.relatedPort=parseInt(r[a+1],10);break;case"tcptype":i.tcpType=r[a+1];break;case"ufrag":i.ufrag=r[a+1],i.usernameFragment=r[a+1];break;default:i[r[a]]===void 0&&(i[r[a]]=r[a+1])}return i},t.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const a=n.type;return r.push("typ"),r.push(a),a!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const r={};let i;const a=n.substring(n.indexOf(" ")+1).split(";");for(let c=0;c<a.length;c++)i=a[c].trim().split("="),r[i[0].trim()]=i[1];return r},t.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const a=[];Object.keys(n.parameters).forEach(c=>{n.parameters[c]!==void 0?a.push(c+"="+n.parameters[c]):a.push(c)}),r+="a=fmtp:"+i+" "+a.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(a=>{r+="a=rtcp-fb:"+i+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},a=n.indexOf(":",r);return a>-1?(i.attribute=n.substring(r+1,a),i.value=n.substring(a+1)):i.attribute=n.substring(r+1),i},t.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},t.getMid=function(n){const r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(a=>{i+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),i},t.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){const i=t.matchPrefix(n+r,"a=ice-ufrag:")[0],a=t.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&a?{usernameFragment:i.substring(12),password:a.substring(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(n)[0].split(" ");r.profile=i[2];for(let c=3;c<i.length;c++){const d=i[c],u=t.matchPrefix(n,"a=rtpmap:"+d+" ")[0];if(u){const p=t.parseRtpMap(u),f=t.matchPrefix(n,"a=fmtp:"+d+" ");switch(p.parameters=f.length?t.parseFmtp(f[0]):{},p.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+d+" ").map(t.parseRtcpFb),r.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(p.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(c=>{r.headerExtensions.push(t.parseExtmap(c))});const a=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(c=>{a.forEach(d=>{c.rtcpFeedback.find(u=>u.type===d.type&&u.parameter===d.parameter)||c.rtcpFeedback.push(d)})}),r},t.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(c=>{i+=t.writeRtpMap(c),i+=t.writeFmtp(c),i+=t.writeRtcpFb(c)});let a=0;return r.codecs.forEach(c=>{c.maxptime>a&&(a=c.maxptime)}),a>0&&(i+="a=maxptime:"+a+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(c=>{i+=t.writeExtmap(c)}),i},t.parseRtpEncodingParameters=function(n){const r=[],i=t.parseRtpParameters(n),a=i.fecMechanisms.indexOf("RED")!==-1,c=i.fecMechanisms.indexOf("ULPFEC")!==-1,d=t.matchPrefix(n,"a=ssrc:").map(E=>t.parseSsrcMedia(E)).filter(E=>E.attribute==="cname"),u=d.length>0&&d[0].ssrc;let p;const f=t.matchPrefix(n,"a=ssrc-group:FID").map(E=>E.substring(17).split(" ").map(S=>parseInt(S,10)));f.length>0&&f[0].length>1&&f[0][0]===u&&(p=f[0][1]),i.codecs.forEach(E=>{if(E.name.toUpperCase()==="RTX"&&E.parameters.apt){let S={ssrc:u,codecPayloadType:parseInt(E.parameters.apt,10)};u&&p&&(S.rtx={ssrc:p}),r.push(S),a&&(S=JSON.parse(JSON.stringify(S)),S.fec={ssrc:u,mechanism:c?"red+ulpfec":"red"},r.push(S))}}),r.length===0&&u&&r.push({ssrc:u});let m=t.matchPrefix(n,"b=");return m.length&&(m=m[0].indexOf("b=TIAS:")===0?parseInt(m[0].substring(7),10):m[0].indexOf("b=AS:")===0?1e3*parseInt(m[0].substring(5),10)*.95-16e3:void 0,r.forEach(E=>{E.maxBitrate=m})),r},t.parseRtcpParameters=function(n){const r={},i=t.matchPrefix(n,"a=ssrc:").map(d=>t.parseSsrcMedia(d)).filter(d=>d.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const a=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=a.length>0,r.compound=a.length===0;const c=t.matchPrefix(n,"a=rtcp-mux");return r.mux=c.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r;const i=t.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const a=t.matchPrefix(n,"a=ssrc:").map(c=>t.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");return a.length>0?(r=a[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(n){const r=t.parseMLine(n),i=t.matchPrefix(n,"a=max-message-size:");let a;i.length>0&&(a=parseInt(i[0].substring(19),10)),isNaN(a)&&(a=65536);const c=t.matchPrefix(n,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:r.fmt,maxMessageSize:a};const d=t.matchPrefix(n,"a=sctpmap:");if(d.length>0){const u=d[0].substring(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:a}}},t.writeSctpDescription=function(n,r){let i=[];return i=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,r,i){let a;const c=r!==void 0?r:2;return a=n||t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+a+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){const i=t.splitLines(n);for(let a=0;a<i.length;a++)switch(i[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[a].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const r=t.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(n){const r=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=t.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},e.exports=t})($A);var eb=$A.exports,Pd=_(eb),jW=l({__proto__:null,default:Pd},[eb]);function Cf(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const r=new t(n),i=Pd.parseCandidate(n.candidate),a=Object.assign(r,i);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,hc(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function MS(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||hc(e,"icecandidate",t=>{if(t.candidate){const n=Pd.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function Rf(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(d){if(!d||!d.sdp)return!1;const u=Pd.splitSections(d.sdp);return u.shift(),u.some(p=>{const f=Pd.parseMLine(p);return f&&f.kind==="application"&&f.protocol.indexOf("SCTP")!==-1})},r=function(d){const u=d.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;const p=parseInt(u[1],10);return p!=p?-1:p},i=function(d){let u=65536;return t.browser==="firefox"&&(u=t.version<57?d===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),u},a=function(d,u){let p=65536;t.browser==="firefox"&&t.version===57&&(p=65535);const f=Pd.matchPrefix(d.sdp,"a=max-message-size:");return f.length>0?p=parseInt(f[0].substr(19),10):t.browser==="firefox"&&u!==-1&&(p=2147483637),p},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:d}=this.getConfiguration();d==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const d=r(arguments[0]),u=i(d),p=a(arguments[0],d);let f;f=u===0&&p===0?Number.POSITIVE_INFINITY:u===0||p===0?Math.max(u,p):Math.min(u,p);const m={};Object.defineProperty(m,"maxMessageSize",{get:()=>f}),this._sctp=m}return c.apply(this,arguments)}}function wf(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,i){const a=r.send;r.send=function(){const c=arguments[0],d=c.length||c.size||c.byteLength;if(r.readyState==="open"&&i.sctp&&d>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return a.apply(r,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return t(r,this),r},hc(e,"datachannel",r=>(t(r.channel,r.target),r))}function xS(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const a=i.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;const c=new Event("connectionstatechange",i);a.dispatchEvent(c)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function US(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=r.sdp.split(`
`).filter(a=>ir(a).call(a)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return n.apply(this,arguments)}}function If(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ae.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ae.resolve())})}function Af(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i=>n.apply(this,[i]))})}var FW=Object.freeze({__proto__:null,removeExtmapAllowMixed:US,shimAddIceCandidateNullOrEmpty:If,shimConnectionState:xS,shimMaxMessageSize:Rf,shimParameterlessSetLocalDescription:Af,shimRTCIceCandidate:Cf,shimRTCIceCandidateRelayProtocol:MS,shimSendThrowTypeError:wf});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=yw,r=function(a){const c={browser:null,version:null};if(a===void 0||!a.navigator)return c.browser="Not a browser.",c;const{navigator:d}=a;if(d.mozGetUserMedia)c.browser="firefox",c.version=Zp(d.userAgent,/Firefox\/(\d+)\./,1);else if(d.webkitGetUserMedia||a.isSecureContext===!1&&a.webkitRTCPeerConnection)c.browser="chrome",c.version=Zp(d.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!a.RTCPeerConnection||!d.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=Zp(d.userAgent,/AppleWebKit\/(\d+)\./,1),c.supportsUnifiedPlan=a.RTCRtpTransceiver&&"currentDirection"in a.RTCRtpTransceiver.prototype}return c}(e),i={browserDetails:r,commonShim:FW,extractVersion:Zp,disableLog:UF,disableWarnings:VF,sdp:jW};switch(r.browser){case"chrome":if(!bA||!NS||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=bA,If(e,r),Af(e),SA(e,r),TA(e),NS(e,r),vA(e),IA(e,r),yA(e),CA(e),RA(e),AA(e,r),Cf(e),MS(e),xS(e),Rf(e,r),wf(e),US(e,r);break;case"firefox":if(!jA||!DS||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=jA,If(e,r),Af(e),OA(e,r),DS(e,r),NA(e),LA(e),DA(e),PA(e),kA(e),MA(e),xA(e),UA(e),VA(e),Cf(e),xS(e),Rf(e,r),wf(e);break;case"safari":if(!JA||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=JA,If(e,r),Af(e),KA(e),YA(e),GA(e),FA(e),BA(e),zA(e),WA(e),qA(e),Cf(e),MS(e),Rf(e,r),wf(e),US(e,r);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var BW=Gi("Array").keys,GW=Zo,WW=qn,HW=W,KW=BW,VS=Array.prototype,zW={DOMTokenList:!0,NodeList:!0},YW=function(e){var t=e.keys;return e===VS||HW(VS,e)&&t===VS.keys||WW(zW,GW(e))?KW:t},ni=_(YW),tb=Td,qW=TypeError,JW=Yp,XW=Bi,QW=ur,bf=function(e,t,n){var r=JW(t);r in e?XW.f(e,r,QW(0,n)):e[r]=n},nb=vg,ZW=Is,$W=bf,e7=Array,t7=Math.max,jS=function(e,t,n){for(var r=ZW(e),i=nb(t,r),a=nb(n===void 0?r:n,r),c=e7(t7(a-i,0)),d=0;i<a;i++,d++)$W(c,d,e[i]);return c.length=d,c},rb=jS,n7=Math.floor,FS=function(e,t){var n=e.length,r=n7(n/2);return n<8?r7(e,t):i7(e,FS(rb(e,0,r),t),FS(rb(e,r),t),t)},r7=function(e,t){for(var n,r,i=e.length,a=1;a<i;){for(r=a,n=e[a];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==a++&&(e[r]=n)}return e},i7=function(e,t,n,r){for(var i=t.length,a=n.length,c=0,d=0;c<i||d<a;)e[c+d]=c<i&&d<a?r(t[c],n[d])<=0?t[c++]:n[d++]:c<i?t[c++]:n[d++];return e},ib=FS,ob=lc.match(/firefox\/(\d+)/i),o7=!!ob&&+ob[1],s7=/MSIE|Trident/.test(lc),sb=lc.match(/AppleWebKit\/(\d+)\./),a7=!!sb&&+sb[1],c7=At,ab=x,d7=Fi,l7=Qo,cb=Is,u7=function(e,t){if(!delete e[t])throw qW("Cannot delete property "+tb(t)+" of "+tb(e))},db=vi,BS=g,h7=ib,p7=Qp,lb=o7,f7=s7,ub=uc,hb=a7,aa=[],pb=ab(aa.sort),m7=ab(aa.push),_7=BS(function(){aa.sort(void 0)}),E7=BS(function(){aa.sort(null)}),g7=p7("sort"),fb=!BS(function(){if(ub)return ub<70;if(!(lb&&lb>3)){if(f7)return!0;if(hb)return hb<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)aa.push({k:t+r,v:n})}for(aa.sort(function(a,c){return c.v-a.v}),r=0;r<aa.length;r++)t=aa[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return i!=="DGBEFHACIJK"}});c7({target:"Array",proto:!0,forced:_7||!E7||!g7||!fb},{sort:function(e){e!==void 0&&d7(e);var t=l7(this);if(fb)return e===void 0?pb(t):pb(t,e);var n,r,i=[],a=cb(t);for(r=0;r<a;r++)r in t&&m7(i,t[r]);for(h7(i,function(c){return function(d,u){return u===void 0?-1:d===void 0?1:c!==void 0?+c(d,u)||0:db(d)>db(u)?1:-1}}(e)),n=cb(i),r=0;r<n;)t[r]=i[r++];for(;r<a;)u7(t,r++);return t}});var S7=Gi("Array").sort,T7=W,v7=S7,GS=Array.prototype,y7=function(e){var t=e.sort;return e===GS||T7(GS,e)&&t===GS.sort?v7:t},ku=_(y7),WS={exports:{}};(function(e,t){(function(n,r){var i="function",a="undefined",c="object",d="string",u="major",p="model",f="name",m="type",E="vendor",S="version",I="architecture",v="console",y="mobile",A="tablet",N="smarttv",V="wearable",F="embedded",G="Amazon",z="Apple",Q="ASUS",Z="BlackBerry",ee="Browser",me="Chrome",Qe="Firefox",ct="Google",Nt="Huawei",cn="LG",Wt="Microsoft",lo="Motorola",$="Opera",oe="Samsung",Se="Sharp",Me="Sony",st="Xiaomi",ce="Zebra",R="Facebook",k="Chromium OS",U="Mac OS",re=function(en){for(var fn={},Mt=0;Mt<en.length;Mt++)fn[en[Mt].toUpperCase()]=en[Mt];return fn},xe=function(en,fn){return typeof en===d&&gt(fn).indexOf(gt(en))!==-1},gt=function(en){return en.toLowerCase()},Tn=function(en,fn){if(typeof en===d)return en=en.replace(/^\s\s*/,""),typeof fn===a?en:en.substring(0,350)},Mr=function(en,fn){for(var Mt,Jr,Ts,tn,at,xr,Va=0;Va<fn.length&&!at;){var xo=fn[Va],fx=fn[Va+1];for(Mt=Jr=0;Mt<xo.length&&!at&&xo[Mt];)if(at=xo[Mt++].exec(en))for(Ts=0;Ts<fx.length;Ts++)xr=at[++Jr],typeof(tn=fx[Ts])===c&&tn.length>0?tn.length===2?typeof tn[1]==i?this[tn[0]]=tn[1].call(this,xr):this[tn[0]]=tn[1]:tn.length===3?typeof tn[1]!==i||tn[1].exec&&tn[1].test?this[tn[0]]=xr?xr.replace(tn[1],tn[2]):r:this[tn[0]]=xr?tn[1].call(this,xr,tn[2]):r:tn.length===4&&(this[tn[0]]=xr?tn[3].call(this,xr.replace(tn[1],tn[2])):r):this[tn]=xr||r;Va+=2}},Gs=function(en,fn){for(var Mt in fn)if(typeof fn[Mt]===c&&fn[Mt].length>0){for(var Jr=0;Jr<fn[Mt].length;Jr++)if(xe(fn[Mt][Jr],en))return Mt==="?"?r:Mt}else if(xe(fn[Mt],en))return Mt==="?"?r:Mt;return en},v_={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},y_={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[S,[f,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[S,[f,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[f,S],[/opios[\/ ]+([\w\.]+)/i],[S,[f,$+" Mini"]],[/\bopr\/([\w\.]+)/i],[S,[f,$]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[f,S],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[S,[f,"UC"+ee]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[S,[f,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[S,[f,"WeChat"]],[/konqueror\/([\w\.]+)/i],[S,[f,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[S,[f,"IE"]],[/yabrowser\/([\w\.]+)/i],[S,[f,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[f,/(.+)/,"$1 Secure "+ee],S],[/\bfocus\/([\w\.]+)/i],[S,[f,Qe+" Focus"]],[/\bopt\/([\w\.]+)/i],[S,[f,$+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[S,[f,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[S,[f,"Dolphin"]],[/coast\/([\w\.]+)/i],[S,[f,$+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[S,[f,"MIUI "+ee]],[/fxios\/([-\w\.]+)/i],[S,[f,Qe]],[/\bqihu|(qi?ho?o?|360)browser/i],[[f,"360 "+ee]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[f,/(.+)/,"$1 "+ee],S],[/(comodo_dragon)\/([\w\.]+)/i],[[f,/_/g," "],S],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[f,S],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[f],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[f,R],S],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[f,S],[/\bgsa\/([\w\.]+) .*safari\//i],[S,[f,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[S,[f,me+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[f,me+" WebView"],S],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[S,[f,"Android "+ee]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[f,S],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[S,[f,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[S,f],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[f,[S,Gs,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[f,S],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[f,"Netscape"],S],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[S,[f,Qe+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[f,S],[/(cobalt)\/([\w\.]+)/i],[f,[S,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[I,"amd64"]],[/(ia32(?=;))/i],[[I,gt]],[/((?:i[346]|x)86)[;\)]/i],[[I,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[I,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[I,"armhf"]],[/windows (ce|mobile); ppc;/i],[[I,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[I,/ower/,"",gt]],[/(sun4\w)[;\)]/i],[[I,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[I,gt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[p,[E,oe],[m,A]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[p,[E,oe],[m,y]],[/\((ip(?:hone|od)[\w ]*);/i],[p,[E,z],[m,y]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[E,z],[m,A]],[/(macintosh);/i],[p,[E,z]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[p,[E,Se],[m,y]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[p,[E,Nt],[m,A]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[p,[E,Nt],[m,y]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[p,/_/g," "],[E,st],[m,y]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[p,/_/g," "],[E,st],[m,A]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[p,[E,"OPPO"],[m,y]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[p,[E,"Vivo"],[m,y]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[p,[E,"Realme"],[m,y]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[p,[E,lo],[m,y]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[p,[E,lo],[m,A]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[p,[E,cn],[m,A]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[p,[E,cn],[m,y]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[p,[E,"Lenovo"],[m,A]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[p,/_/g," "],[E,"Nokia"],[m,y]],[/(pixel c)\b/i],[p,[E,ct],[m,A]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[p,[E,ct],[m,y]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[E,Me],[m,y]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[p,"Xperia Tablet"],[E,Me],[m,A]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[p,[E,"OnePlus"],[m,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[p,[E,G],[m,A]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[p,/(.+)/g,"Fire Phone $1"],[E,G],[m,y]],[/(playbook);[-\w\),; ]+(rim)/i],[p,E,[m,A]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[p,[E,Z],[m,y]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[p,[E,Q],[m,A]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[p,[E,Q],[m,y]],[/(nexus 9)/i],[p,[E,"HTC"],[m,A]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[E,[p,/_/g," "],[m,y]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[p,[E,"Acer"],[m,A]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[p,[E,"Meizu"],[m,y]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[E,p,[m,y]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[E,p,[m,A]],[/(surface duo)/i],[p,[E,Wt],[m,A]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[p,[E,"Fairphone"],[m,y]],[/(u304aa)/i],[p,[E,"AT&T"],[m,y]],[/\bsie-(\w*)/i],[p,[E,"Siemens"],[m,y]],[/\b(rct\w+) b/i],[p,[E,"RCA"],[m,A]],[/\b(venue[\d ]{2,7}) b/i],[p,[E,"Dell"],[m,A]],[/\b(q(?:mv|ta)\w+) b/i],[p,[E,"Verizon"],[m,A]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[p,[E,"Barnes & Noble"],[m,A]],[/\b(tm\d{3}\w+) b/i],[p,[E,"NuVision"],[m,A]],[/\b(k88) b/i],[p,[E,"ZTE"],[m,A]],[/\b(nx\d{3}j) b/i],[p,[E,"ZTE"],[m,y]],[/\b(gen\d{3}) b.+49h/i],[p,[E,"Swiss"],[m,y]],[/\b(zur\d{3}) b/i],[p,[E,"Swiss"],[m,A]],[/\b((zeki)?tb.*\b) b/i],[p,[E,"Zeki"],[m,A]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[E,"Dragon Touch"],p,[m,A]],[/\b(ns-?\w{0,9}) b/i],[p,[E,"Insignia"],[m,A]],[/\b((nxa|next)-?\w{0,9}) b/i],[p,[E,"NextBook"],[m,A]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[E,"Voice"],p,[m,y]],[/\b(lvtel\-)?(v1[12]) b/i],[[E,"LvTel"],p,[m,y]],[/\b(ph-1) /i],[p,[E,"Essential"],[m,y]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[p,[E,"Envizen"],[m,A]],[/\b(trio[-\w\. ]+) b/i],[p,[E,"MachSpeed"],[m,A]],[/\btu_(1491) b/i],[p,[E,"Rotor"],[m,A]],[/(shield[\w ]+) b/i],[p,[E,"Nvidia"],[m,A]],[/(sprint) (\w+)/i],[E,p,[m,y]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[E,Wt],[m,y]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[E,ce],[m,A]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[E,ce],[m,y]],[/smart-tv.+(samsung)/i],[E,[m,N]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[E,oe],[m,N]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[E,cn],[m,N]],[/(apple) ?tv/i],[E,[p,z+" TV"],[m,N]],[/crkey/i],[[p,me+"cast"],[E,ct],[m,N]],[/droid.+aft(\w)( bui|\))/i],[p,[E,G],[m,N]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[p,[E,Se],[m,N]],[/(bravia[\w ]+)( bui|\))/i],[p,[E,Me],[m,N]],[/(mitv-\w{5}) bui/i],[p,[E,st],[m,N]],[/Hbbtv.*(technisat) (.*);/i],[E,p,[m,N]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[E,Tn],[p,Tn],[m,N]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,N]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[E,p,[m,v]],[/droid.+; (shield) bui/i],[p,[E,"Nvidia"],[m,v]],[/(playstation [345portablevi]+)/i],[p,[E,Me],[m,v]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[p,[E,Wt],[m,v]],[/((pebble))app/i],[E,p,[m,V]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[p,[E,z],[m,V]],[/droid.+; (glass) \d/i],[p,[E,ct],[m,V]],[/droid.+; (wt63?0{2,3})\)/i],[p,[E,ce],[m,V]],[/(quest( 2| pro)?)/i],[p,[E,R],[m,V]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[E,[m,F]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[p,[m,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[p,[m,A]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,A]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[m,y]],[/(android[-\w\. ]{0,9});.+buil/i],[p,[E,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[S,[f,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[S,[f,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[f,S],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[S,f]],os:[[/microsoft (windows) (vista|xp)/i],[f,S],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[f,[S,Gs,v_]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[f,"Windows"],[S,Gs,v_]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[S,/_/g,"."],[f,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[f,U],[S,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[S,f],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[f,S],[/\(bb(10);/i],[S,[f,Z]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[S,[f,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[S,[f,Qe+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[S,[f,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[S,[f,"watchOS"]],[/crkey\/([\d\.]+)/i],[S,[f,me+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[f,k],S],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[f,S],[/(sunos) ?([\w\.\d]*)/i],[[f,"Solaris"],S],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[f,S]]},Pi=function(en,fn){if(typeof en===c&&(fn=en,en=r),!(this instanceof Pi))return new Pi(en,fn).getResult();var Mt=typeof n!==a&&n.navigator?n.navigator:r,Jr=en||(Mt&&Mt.userAgent?Mt.userAgent:""),Ts=Mt&&Mt.userAgentData?Mt.userAgentData:r,tn=fn?function(at,xr){var Va={};for(var xo in at)xr[xo]&&xr[xo].length%2==0?Va[xo]=xr[xo].concat(at[xo]):Va[xo]=at[xo];return Va}(y_,fn):y_;return this.getBrowser=function(){var at={};return at[f]=r,at[S]=r,Mr.call(at,Jr,tn.browser),at[u]=function(xr){return typeof xr===d?xr.replace(/[^\d\.]/g,"").split(".")[0]:r}(at[S]),Mt&&Mt.brave&&typeof Mt.brave.isBrave==i&&(at[f]="Brave"),at},this.getCPU=function(){var at={};return at[I]=r,Mr.call(at,Jr,tn.cpu),at},this.getDevice=function(){var at={};return at[E]=r,at[p]=r,at[m]=r,Mr.call(at,Jr,tn.device),!at[m]&&Ts&&Ts.mobile&&(at[m]=y),at[p]=="Macintosh"&&Mt&&typeof Mt.standalone!==a&&Mt.maxTouchPoints&&Mt.maxTouchPoints>2&&(at[p]="iPad",at[m]=A),at},this.getEngine=function(){var at={};return at[f]=r,at[S]=r,Mr.call(at,Jr,tn.engine),at},this.getOS=function(){var at={};return at[f]=r,at[S]=r,Mr.call(at,Jr,tn.os),!at[f]&&Ts&&Ts.platform!="Unknown"&&(at[f]=Ts.platform.replace(/chrome os/i,k).replace(/macos/i,U)),at},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Jr},this.setUA=function(at){return Jr=typeof at===d&&at.length>350?Tn(at,350):at,this},this.setUA(Jr),this};Pi.VERSION="0.7.34",Pi.BROWSER=re([f,S,u]),Pi.CPU=re([I]),Pi.DEVICE=re([p,E,m,v,y,N,A,V,F]),Pi.ENGINE=Pi.OS=re([f,S]),e.exports&&(t=e.exports=Pi),t.UAParser=Pi;var Ua=typeof n!==a&&(n.jQuery||n.Zepto);if(Ua&&!Ua.ua){var Dl=new Pi;Ua.ua=Dl.getResult(),Ua.ua.get=function(){return Dl.getUA()},Ua.ua.set=function(en){Dl.setUA(en);var fn=Dl.getResult();for(var Mt in fn)Ua.ua[Mt]=fn[Mt]}}})(typeof window=="object"?window:h)})(WS,WS.exports);var C7=_(WS.exports),R7=Zo,w7=qn,I7=Ed,A7=pc,b7=rn("iterator"),O7=Object,N7=function(e){if(I7(e))return!1;var t=O7(e);return t[b7]!==void 0||"@@iterator"in t||w7(A7,R7(t))},D7=_(N7),HS=X;At({global:!0,forced:HS.globalThis!==HS},{globalThis:HS});var mb=_(X);function _b(e,t){return function(){return e.apply(t,arguments)}}const{toString:P7}=Object.prototype,{getPrototypeOf:KS}=Object,Of=(zS=Object.create(null),e=>{const t=P7.call(e);return zS[t]||(zS[t]=t.slice(8,-1).toLowerCase())});var zS;const ts=e=>(e=e.toLowerCase(),t=>Of(t)===e),Nf=e=>t=>typeof t===e,{isArray:Ld}=Array,Mu=Nf("undefined"),Eb=ts("ArrayBuffer"),L7=Nf("string"),Wi=Nf("function"),gb=Nf("number"),Df=e=>e!==null&&typeof e=="object",Pf=e=>{if(Of(e)!=="object")return!1;const t=KS(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.toStringTag in e||D7(e))},k7=ts("Date"),M7=ts("File"),x7=ts("Blob"),U7=ts("FileList"),V7=ts("URLSearchParams");function xu(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Ld(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const a=i?Object.getOwnPropertyNames(e):Object.keys(e),c=a.length;let d;for(n=0;n<c;n++)d=a[n],t.call(null,e[d],d,e)}}function Sb(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const Tb=mb!==void 0?mb:typeof self<"u"?self:typeof window<"u"?window:C_,vb=e=>!Mu(e)&&e!==Tb,j7=(YS=typeof Uint8Array<"u"&&KS(Uint8Array),e=>YS&&e instanceof YS);var YS;const F7=ts("HTMLFormElement"),yb=(e=>{let{hasOwnProperty:t}=e;return(n,r)=>t.call(n,r)})(Object.prototype),B7=ts("RegExp"),Cb=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};xu(n,(i,a)=>{let c;(c=t(i,a,e))!==!1&&(r[a]=c||i)}),Object.defineProperties(e,r)},qS="abcdefghijklmnopqrstuvwxyz",Rb="0123456789",wb={DIGIT:Rb,ALPHA:qS,ALPHA_DIGIT:qS+qS.toUpperCase()+Rb},G7=ts("AsyncFunction");var ge={isArray:Ld,isArrayBuffer:Eb,isBuffer:function(e){return e!==null&&!Mu(e)&&e.constructor!==null&&!Mu(e.constructor)&&Wi(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Wi(e.append)&&((t=Of(e))==="formdata"||t==="object"&&Wi(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Eb(e.buffer),t},isString:L7,isNumber:gb,isBoolean:e=>e===!0||e===!1,isObject:Df,isPlainObject:Pf,isUndefined:Mu,isDate:k7,isFile:M7,isBlob:x7,isRegExp:B7,isFunction:Wi,isStream:e=>Df(e)&&Wi(e.pipe),isURLSearchParams:V7,isTypedArray:j7,isFileList:U7,forEach:xu,merge:function e(){const{caseless:t}=vb(this)&&this||{},n={},r=(i,a)=>{const c=t&&Sb(n,a)||a;Pf(n[c])&&Pf(i)?n[c]=e(n[c],i):Pf(i)?n[c]=e({},i):Ld(i)?n[c]=i.slice():n[c]=i};for(let i=0,a=arguments.length;i<a;i++)arguments[i]&&xu(arguments[i],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return xu(t,(i,a)=>{n&&Wi(i)?e[a]=_b(i,n):e[a]=i},{allOwnKeys:r}),e},trim:e=>ir(e)?ir(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,a,c;const d={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),a=i.length;a-- >0;)c=i[a],r&&!r(c,e,t)||d[c]||(t[c]=e[c],d[c]=!0);e=n!==!1&&KS(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Of,kindOfTest:ts,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return r!==-1&&r===n},toArray:e=>{if(!e)return null;if(Ld(e))return e;let t=e.length;if(!gb(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const i=r.value;t.call(e,i[0],i[1])}},matchAll:(e,t)=>{let n;const r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},isHTMLForm:F7,hasOwnProperty:yb,hasOwnProp:yb,reduceDescriptors:Cb,freezeMethods:e=>{Cb(e,(t,n)=>{if(Wi(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=e[n];Wi(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},r=i=>{i.forEach(a=>{n[a]=!0})};return Ld(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,r){return n.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:Sb,global:Tb,isContextDefined:vb,ALPHABET:wb,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:wb.ALPHA_DIGIT,n="";const{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&Wi(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(r,i)=>{if(Df(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[i]=r;const a=Ld(r)?[]:{};return xu(r,(c,d)=>{const u=n(c,i+1);!Mu(u)&&(a[d]=u)}),t[i]=void 0,a}}return r};return n(e,0)},isAsyncFn:G7,isThenable:e=>e&&(Df(e)||Wi(e))&&Wi(e.then)&&Wi(e.catch)};function Ft(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}ge.inherits(Ft,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ge.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Ib=Ft.prototype,Ab={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Ab[e]={value:e}}),Object.defineProperties(Ft,Ab),Object.defineProperty(Ib,"isAxiosError",{value:!0}),Ft.from=(e,t,n,r,i,a)=>{const c=Object.create(Ib);return ge.toFlatObject(e,c,function(d){return d!==Error.prototype},d=>d!=="isAxiosError"),Ft.call(c,e.message,t,n,r,i),c.cause=e,c.name=e.name,a&&Object.assign(c,a),c};function JS(e){return ge.isPlainObject(e)||ge.isArray(e)}function bb(e){return ge.endsWith(e,"[]")?e.slice(0,-2):e}function Ob(e,t,n){return e?e.concat(t).map(function(r,i){return r=bb(r),!n&&i?"["+r+"]":r}).join(n?".":""):t}const W7=ge.toFlatObject(ge,{},null,function(e){return/^is[A-Z]/.test(e)});function Lf(e,t,n){if(!ge.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=ge.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(E,S){return!ge.isUndefined(S[E])})).metaTokens,i=n.visitor||p,a=n.dots,c=n.indexes,d=(n.Blob||typeof Blob<"u"&&Blob)&&ge.isSpecCompliantForm(t);if(!ge.isFunction(i))throw new TypeError("visitor must be a function");function u(E){if(E===null)return"";if(ge.isDate(E))return E.toISOString();if(!d&&ge.isBlob(E))throw new Ft("Blob is not supported. Use a Buffer instead.");return ge.isArrayBuffer(E)||ge.isTypedArray(E)?d&&typeof Blob=="function"?new Blob([E]):Buffer.from(E):E}function p(E,S,I){let v=E;if(E&&!I&&typeof E=="object"){if(ge.endsWith(S,"{}"))S=r?S:S.slice(0,-2),E=JSON.stringify(E);else if(ge.isArray(E)&&function(y){return ge.isArray(y)&&!y.some(JS)}(E)||(ge.isFileList(E)||ge.endsWith(S,"[]"))&&(v=ge.toArray(E)))return S=bb(S),v.forEach(function(y,A){!ge.isUndefined(y)&&y!==null&&t.append(c===!0?Ob([S],A,a):c===null?S:S+"[]",u(y))}),!1}return!!JS(E)||(t.append(Ob(I,S,a),u(E)),!1)}const f=[],m=Object.assign(W7,{defaultVisitor:p,convertValue:u,isVisitable:JS});if(!ge.isObject(e))throw new TypeError("data must be an object");return function E(S,I){if(!ge.isUndefined(S)){if(f.indexOf(S)!==-1)throw Error("Circular reference detected in "+I.join("."));f.push(S),ge.forEach(S,function(v,y){(!(ge.isUndefined(v)||v===null)&&i.call(t,v,ge.isString(y)?ir(y).call(y):y,I,m))===!0&&E(v,I?I.concat(y):[y])}),f.pop()}}(e),t}function Nb(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function XS(e,t){this._pairs=[],e&&Lf(e,this,t)}const Db=XS.prototype;function H7(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Pb(e,t,n){if(!t)return e;const r=n&&n.encode||H7,i=n&&n.serialize;let a;if(a=i?i(t,n):ge.isURLSearchParams(t)?t.toString():new XS(t,n).toString(r),a){const c=e.indexOf("#");c!==-1&&(e=e.slice(0,c)),e+=(e.indexOf("?")===-1?"?":"&")+a}return e}Db.append=function(e,t){this._pairs.push([e,t])},Db.toString=function(e){const t=e?function(n){return e.call(this,n,Nb)}:Nb;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var Lb=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ge.forEach(this.handlers,function(t){t!==null&&e(t)})}},kb={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Mb={exports:{}},K7=At,z7=Dt,xb=Bi.f;K7({target:"Object",stat:!0,forced:Object.defineProperty!==xb,sham:!z7},{defineProperty:xb});var Ub=To.Object,Y7=Mb.exports=function(e,t,n){return Ub.defineProperty(e,t,n)};Ub.defineProperty.sham&&(Y7.sham=!0);var Vb=_(Mb.exports),q7=Pe,Uu=Array.isArray||function(e){return q7(e)=="Array"},J7=TypeError,jb=Uu,X7=mf,Q7=ti,Z7=rn("species"),Fb=Array,$7=function(e){var t;return jb(e)&&(t=e.constructor,(X7(t)&&(t===Fb||jb(t.prototype))||Q7(t)&&(t=t[Z7])===null)&&(t=void 0)),t===void 0?Fb:t},Bb=function(e,t){return new($7(e))(t===0?0:t)},e9=g,t9=uc,n9=rn("species"),Gb=function(e){return t9>=51||!e9(function(){var t=[];return(t.constructor={})[n9]=function(){return{foo:1}},t[e](Boolean).foo!==1})},r9=At,i9=g,o9=Uu,s9=ti,a9=Qo,c9=Is,Wb=function(e){if(e>9007199254740991)throw J7("Maximum allowed index exceeded");return e},Hb=bf,d9=Bb,l9=Gb,u9=uc,Kb=rn("isConcatSpreadable"),h9=u9>=51||!i9(function(){var e=[];return e[Kb]=!1,e.concat()[0]!==e}),p9=function(e){if(!s9(e))return!1;var t=e[Kb];return t!==void 0?!!t:o9(e)};r9({target:"Array",proto:!0,arity:1,forced:!h9||!l9("concat")},{concat:function(e){var t,n,r,i,a,c=a9(this),d=d9(c,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if(p9(a=t===-1?c:arguments[t]))for(i=c9(a),Wb(u+i),n=0;n<i;n++,u++)n in a&&Hb(d,u,a[n]);else Wb(u+1),Hb(d,u++,a);return d.length=u,d}});var zb={},f9=Pe,m9=ta,Yb=ef.f,_9=jS,qb=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];zb.f=function(e){return qb&&f9(e)=="Window"?function(t){try{return Yb(t)}catch{return _9(qb)}}(e):Yb(m9(e))};var kd={},E9=rn;kd.f=E9;var Jb=To,g9=qn,S9=kd,T9=Bi.f,Bn=function(e){var t=Jb.Symbol||(Jb.Symbol={});g9(t,e)||T9(t,e,{value:S9.f(e)})},v9=De,y9=Wr,C9=rn,R9=ia,Xb=function(){var e=y9("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=C9("toPrimitive");t&&!t[r]&&R9(t,r,function(i){return v9(n,this)},{arity:1})},w9=na,I9=Kp,A9=Qo,b9=Is,O9=Bb,Qb=x([].push),ca=function(e){var t=e==1,n=e==2,r=e==3,i=e==4,a=e==6,c=e==7,d=e==5||a;return function(u,p,f,m){for(var E,S,I=A9(u),v=I9(I),y=w9(p,f),A=b9(v),N=0,V=m||O9,F=t?V(u,A):n||c?V(u,0):void 0;A>N;N++)if((d||N in v)&&(S=y(E=v[N],N,I),e))if(t)F[N]=S;else if(S)switch(e){case 3:return!0;case 5:return E;case 6:return N;case 2:Qb(F,E)}else switch(e){case 4:return!1;case 7:Qb(F,E)}return a?-1:r||i?i:F}},Zb={forEach:ca(0),map:ca(1),filter:ca(2),some:ca(3),every:ca(4),find:ca(5),findIndex:ca(6),filterReject:ca(7)},kf=At,QS=X,ZS=De,N9=x,Md=Dt,xd=Sd,D9=g,hr=qn,P9=W,$S=Or,Mf=ta,eT=Yp,L9=vi,tT=ur,Vu=Ru,$b=nf,k9=ef,eO=zb,M9=Cu,tO=nt,nO=Bi,x9=Lg,rO=Ke,iO=ia,U9=ff,nT=vd,oO=tf,sO=hg,V9=rn,j9=kd,F9=Bn,B9=Xb,G9=oa,aO=mc,xf=Zb.forEach,ri=$p("hidden"),Uf="Symbol",ju="prototype",W9=aO.set,cO=aO.getterFor(Uf),yo=Object[ju],gc=QS.Symbol,Vf=gc&&gc[ju],H9=QS.TypeError,rT=QS.QObject,dO=tO.f,Sc=nO.f,lO=eO.f,K9=rO.f,uO=N9([].push),As=nT("symbols"),Fu=nT("op-symbols"),z9=nT("wks"),iT=!rT||!rT[ju]||!rT[ju].findChild,oT=Md&&D9(function(){return Vu(Sc({},"a",{get:function(){return Sc(this,"a",{value:7}).a}})).a!=7})?function(e,t,n){var r=dO(yo,t);r&&delete yo[t],Sc(e,t,n),r&&e!==yo&&Sc(yo,t,r)}:Sc,sT=function(e,t){var n=As[e]=Vu(Vf);return W9(n,{type:Uf,tag:e,description:t}),Md||(n.description=t),n},jf=function(e,t,n){e===yo&&jf(Fu,t,n),$S(e);var r=eT(t);return $S(n),hr(As,r)?(n.enumerable?(hr(e,ri)&&e[ri][r]&&(e[ri][r]=!1),n=Vu(n,{enumerable:tT(0,!1)})):(hr(e,ri)||Sc(e,ri,tT(1,{})),e[ri][r]=!0),oT(e,r,n)):Sc(e,r,n)},aT=function(e,t){$S(e);var n=Mf(t),r=$b(n).concat(mO(n));return xf(r,function(i){Md&&!ZS(hO,n,i)||jf(e,i,n[i])}),e},hO=function(e){var t=eT(e),n=ZS(K9,this,t);return!(this===yo&&hr(As,t)&&!hr(Fu,t))&&(!(n||!hr(this,t)||!hr(As,t)||hr(this,ri)&&this[ri][t])||n)},pO=function(e,t){var n=Mf(e),r=eT(t);if(n!==yo||!hr(As,r)||hr(Fu,r)){var i=dO(n,r);return!i||!hr(As,r)||hr(n,ri)&&n[ri][r]||(i.enumerable=!0),i}},fO=function(e){var t=lO(Mf(e)),n=[];return xf(t,function(r){hr(As,r)||hr(oO,r)||uO(n,r)}),n},mO=function(e){var t=e===yo,n=lO(t?Fu:Mf(e)),r=[];return xf(n,function(i){!hr(As,i)||t&&!hr(yo,i)||uO(r,As[i])}),r};xd||(gc=function(){if(P9(Vf,this))throw H9("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?L9(arguments[0]):void 0,t=sO(e),n=function(r){this===yo&&ZS(n,Fu,r),hr(this,ri)&&hr(this[ri],t)&&(this[ri][t]=!1),oT(this,t,tT(1,r))};return Md&&iT&&oT(yo,t,{configurable:!0,set:n}),sT(t,e)},iO(Vf=gc[ju],"toString",function(){return cO(this).tag}),iO(gc,"withoutSetter",function(e){return sT(sO(e),e)}),rO.f=hO,nO.f=jf,x9.f=aT,tO.f=pO,k9.f=eO.f=fO,M9.f=mO,j9.f=function(e){return sT(V9(e),e)},Md&&U9(Vf,"description",{configurable:!0,get:function(){return cO(this).description}})),kf({global:!0,constructor:!0,wrap:!0,forced:!xd,sham:!xd},{Symbol:gc}),xf($b(z9),function(e){F9(e)}),kf({target:Uf,stat:!0,forced:!xd},{useSetter:function(){iT=!0},useSimple:function(){iT=!1}}),kf({target:"Object",stat:!0,forced:!xd,sham:!Md},{create:function(e,t){return t===void 0?Vu(e):aT(Vu(e),t)},defineProperty:jf,defineProperties:aT,getOwnPropertyDescriptor:pO}),kf({target:"Object",stat:!0,forced:!xd},{getOwnPropertyNames:fO}),B9(),G9(gc,Uf),oO[ri]=!0;var _O=Sd&&!!Symbol.for&&!!Symbol.keyFor,Y9=At,q9=Wr,J9=qn,X9=vi,EO=vd,Q9=_O,cT=EO("string-to-symbol-registry"),Z9=EO("symbol-to-string-registry");Y9({target:"Symbol",stat:!0,forced:!Q9},{for:function(e){var t=X9(e);if(J9(cT,t))return cT[t];var n=q9("Symbol")(t);return cT[t]=n,Z9[n]=t,n}});var $9=At,eH=qn,tH=Tu,nH=Td,rH=_O,gO=vd("symbol-to-string-registry");$9({target:"Symbol",stat:!0,forced:!rH},{keyFor:function(e){if(!tH(e))throw TypeError(nH(e)+" is not a symbol");if(eH(gO,e))return gO[e]}});var SO=Uu,iH=Ve,TO=Pe,oH=vi,vO=x([].push),sH=At,yO=Wr,CO=Y,aH=De,Bu=x,RO=g,wO=Ve,IO=Tu,AO=tS,cH=function(e){if(iH(e))return e;if(SO(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];typeof i=="string"?vO(n,i):typeof i!="number"&&TO(i)!="Number"&&TO(i)!="String"||vO(n,oH(i))}var a=n.length,c=!0;return function(d,u){if(c)return c=!1,u;if(SO(this))return u;for(var p=0;p<a;p++)if(n[p]===d)return u}}},dH=Sd,lH=String,da=yO("JSON","stringify"),Ff=Bu(/./.exec),bO=Bu("".charAt),uH=Bu("".charCodeAt),hH=Bu("".replace),pH=Bu(1 .toString),fH=/[\uD800-\uDFFF]/g,OO=/^[\uD800-\uDBFF]$/,NO=/^[\uDC00-\uDFFF]$/,DO=!dH||RO(function(){var e=yO("Symbol")();return da([e])!="[null]"||da({a:e})!="{}"||da(Object(e))!="{}"}),PO=RO(function(){return da("\uDF06\uD834")!=='"\\udf06\\ud834"'||da("\uDEAD")!=='"\\udead"'}),mH=function(e,t){var n=AO(arguments),r=cH(t);if(wO(r)||e!==void 0&&!IO(e))return n[1]=function(i,a){if(wO(r)&&(a=aH(r,this,lH(i),a)),!IO(a))return a},CO(da,null,n)},_H=function(e,t,n){var r=bO(n,t-1),i=bO(n,t+1);return Ff(OO,e)&&!Ff(NO,i)||Ff(NO,e)&&!Ff(OO,r)?"\\u"+pH(uH(e,0),16):e};da&&sH({target:"JSON",stat:!0,arity:3,forced:DO||PO},{stringify:function(e,t,n){var r=AO(arguments),i=CO(DO?mH:da,null,r);return PO&&typeof i=="string"?hH(i,fH,_H):i}});var LO=Cu,EH=Qo;At({target:"Object",stat:!0,forced:!Sd||g(function(){LO.f(1)})},{getOwnPropertySymbols:function(e){var t=LO.f;return t?t(EH(e)):[]}}),Bn("asyncIterator"),Bn("hasInstance"),Bn("isConcatSpreadable"),Bn("iterator"),Bn("match"),Bn("matchAll"),Bn("replace"),Bn("search"),Bn("species"),Bn("split");var gH=Xb;Bn("toPrimitive"),gH();var SH=Wr,TH=oa;Bn("toStringTag"),TH(SH("Symbol"),"Symbol"),Bn("unscopables"),oa(X.JSON,"JSON",!0);var vH=To.Symbol,yH=rn,CH=Bi.f,kO=yH("metadata"),MO=Function.prototype;MO[kO]===void 0&&CH(MO,kO,{value:null}),Bn("dispose"),Bn("metadata");var RH=vH;Bn("asyncDispose");var wH=x,dT=Wr("Symbol"),IH=dT.keyFor,AH=wH(dT.prototype.valueOf),xO=dT.isRegisteredSymbol||function(e){try{return IH(AH(e))!==void 0}catch{return!1}};At({target:"Symbol",stat:!0},{isRegisteredSymbol:xO});for(var bH=vd,UO=Wr,OH=x,NH=Tu,DH=rn,Bf=UO("Symbol"),VO=Bf.isWellKnownSymbol,jO=UO("Object","getOwnPropertyNames"),PH=OH(Bf.prototype.valueOf),FO=bH("wks"),lT=0,BO=jO(Bf),LH=BO.length;lT<LH;lT++)try{var GO=BO[lT];NH(Bf[GO])&&DH(GO)}catch{}var WO=function(e){if(VO&&VO(e))return!0;try{for(var t=PH(e),n=0,r=jO(FO),i=r.length;n<i;n++)if(FO[r[n]]==t)return!0}catch{}return!1};At({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:WO}),Bn("matcher"),Bn("observable"),At({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:xO}),At({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:WO}),Bn("metadataKey"),Bn("patternMatch"),Bn("replaceAll");var Ud=_(RH),HO=_(kd.f("iterator"));function Gu(e){return Gu=typeof Ud=="function"&&typeof HO=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Ud=="function"&&t.constructor===Ud&&t!==Ud.prototype?"symbol":typeof t},Gu(e)}var kH=_(kd.f("toPrimitive"));function MH(e){var t=function(n,r){if(Gu(n)!=="object"||n===null)return n;var i=n[kH];if(i!==void 0){var a=i.call(n,r||"default");if(Gu(a)!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}(e,"string");return Gu(t)==="symbol"?t:String(t)}function w(e,t,n){return(t=MH(t))in e?Vb(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var xH=g,UH=rn("iterator"),uT=!xH(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2"),r="";return e.pathname="c%20d",t.forEach(function(i,a){t.delete("b"),r+=a+i}),n.delete("a",2),!e.toJSON||!n.has("a",1)||n.has("a",2)||!t.size&&!0||!t.sort||e.href!=="http://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[UH]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://тест").host!=="xn--e1aybc"||new URL("http://a#б").hash!=="#%D0%B1"||r!=="a1c3"||new URL("http://x",void 0).host!=="x"}),VH=ia,hT=At,Vd=X,Gf=De,ns=x,jd=Dt,KO=uT,zO=ia,jH=ff,FH=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:VH(e,r,t[r],n);return e},BH=oa,GH=Yg,pT=mc,YO=Xg,fT=Ve,WH=qn,HH=na,KH=Zo,zH=Or,qO=ti,Hr=vi,YH=Ru,JO=ur,mT=Ug,qH=sf,Fd=_f,JH=ib,XH=rn("iterator"),Wu="URLSearchParams",XO=Wu+"Iterator",QO=pT.set,Hi=pT.getterFor(Wu),QH=pT.getterFor(XO),ZH=Object.getOwnPropertyDescriptor,_T=function(e){if(!jd)return Vd[e];var t=ZH(Vd,e);return t&&t.value},ZO=_T("fetch"),Wf=_T("Request"),Hu=_T("Headers"),ET=Wf&&Wf.prototype,$O=Hu&&Hu.prototype,$H=Vd.RegExp,eK=Vd.TypeError,eN=Vd.decodeURIComponent,tK=Vd.encodeURIComponent,nK=ns("".charAt),tN=ns([].join),Tc=ns([].push),gT=ns("".replace),rK=ns([].shift),nN=ns([].splice),rN=ns("".split),iK=ns("".slice),oK=/\+/g,iN=Array(4),sK=function(e){return iN[e-1]||(iN[e-1]=$H("((?:%[\\da-f]{2}){"+e+"})","gi"))},aK=function(e){try{return eN(e)}catch{return e}},oN=function(e){var t=gT(e,oK," "),n=4;try{return eN(t)}catch{for(;n;)t=gT(t,sK(n--),aK);return t}},cK=/[!'()~]|%20/g,dK={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},lK=function(e){return dK[e]},sN=function(e){return gT(tK(e),cK,lK)},ST=GH(function(e,t){QO(this,{type:XO,iterator:mT(Hi(e).entries),kind:t})},"Iterator",function(){var e=QH(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value=t==="keys"?r.key:t==="values"?r.value:[r.key,r.value]),n},!0),aN=function(e){this.entries=[],this.url=null,e!==void 0&&(qO(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?nK(e,0)==="?"?iK(e,1):e:Hr(e)))};aN.prototype={type:Wu,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,a,c,d,u=qH(e);if(u)for(n=(t=mT(e,u)).next;!(r=Gf(n,t)).done;){if(a=(i=mT(zH(r.value))).next,(c=Gf(a,i)).done||(d=Gf(a,i)).done||!Gf(a,i).done)throw eK("Expected sequence with length 2");Tc(this.entries,{key:Hr(c.value),value:Hr(d.value)})}else for(var p in e)WH(e,p)&&Tc(this.entries,{key:p,value:Hr(e[p])})},parseQuery:function(e){if(e)for(var t,n,r=rN(e,"&"),i=0;i<r.length;)(t=r[i++]).length&&(n=rN(t,"="),Tc(this.entries,{key:oN(rK(n)),value:oN(tN(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],Tc(n,sN(e.key)+"="+sN(e.value));return tN(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Hf=function(){YO(this,Bd);var e=QO(this,new aN(arguments.length>0?arguments[0]:void 0));jd||(this.size=e.entries.length)},Bd=Hf.prototype;if(FH(Bd,{append:function(e,t){var n=Hi(this);Fd(arguments.length,2),Tc(n.entries,{key:Hr(e),value:Hr(t)}),jd||this.length++,n.updateURL()},delete:function(e){for(var t=Hi(this),n=Fd(arguments.length,1),r=t.entries,i=Hr(e),a=n<2?void 0:arguments[1],c=a===void 0?a:Hr(a),d=0;d<r.length;){var u=r[d];if(u.key!==i||c!==void 0&&u.value!==c)d++;else if(nN(r,d,1),c!==void 0)break}jd||(this.size=r.length),t.updateURL()},get:function(e){var t=Hi(this).entries;Fd(arguments.length,1);for(var n=Hr(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=Hi(this).entries;Fd(arguments.length,1);for(var n=Hr(e),r=[],i=0;i<t.length;i++)t[i].key===n&&Tc(r,t[i].value);return r},has:function(e){for(var t=Hi(this).entries,n=Fd(arguments.length,1),r=Hr(e),i=n<2?void 0:arguments[1],a=i===void 0?i:Hr(i),c=0;c<t.length;){var d=t[c++];if(d.key===r&&(a===void 0||d.value===a))return!0}return!1},set:function(e,t){var n=Hi(this);Fd(arguments.length,1);for(var r,i=n.entries,a=!1,c=Hr(e),d=Hr(t),u=0;u<i.length;u++)(r=i[u]).key===c&&(a?nN(i,u--,1):(a=!0,r.value=d));a||Tc(i,{key:c,value:d}),jd||(this.size=i.length),n.updateURL()},sort:function(){var e=Hi(this);JH(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=Hi(this).entries,r=HH(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new ST(this,"keys")},values:function(){return new ST(this,"values")},entries:function(){return new ST(this,"entries")}},{enumerable:!0}),zO(Bd,XH,Bd.entries,{name:"entries"}),zO(Bd,"toString",function(){return Hi(this).serialize()},{enumerable:!0}),jd&&jH(Bd,"size",{get:function(){return Hi(this).entries.length},configurable:!0,enumerable:!0}),BH(Hf,Wu),hT({global:!0,constructor:!0,forced:!KO},{URLSearchParams:Hf}),!KO&&fT(Hu)){var uK=ns($O.has),hK=ns($O.set),cN=function(e){if(qO(e)){var t,n=e.body;if(KH(n)===Wu)return t=e.headers?new Hu(e.headers):new Hu,uK(t,"content-type")||hK(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),YH(e,{body:JO(0,Hr(n)),headers:JO(0,t)})}return e};if(fT(ZO)&&hT({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return ZO(e,arguments.length>1?cN(arguments[1]):{})}}),fT(Wf)){var TT=function(e){return YO(this,ET),new Wf(e,arguments.length>1?cN(arguments[1]):{})};ET.constructor=TT,TT.prototype=ET,hT({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:TT})}}var pK={URLSearchParams:Hf,getState:Hi},dN=_(To.URLSearchParams),fK={isBrowser:!0,classes:{URLSearchParams:dN!==void 0?dN:XS,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const lN=typeof window<"u"&&typeof document<"u",mK=(uN=typeof navigator<"u"&&navigator.product,lN&&["ReactNative","NativeScript","NS"].indexOf(uN)<0);var uN;const _K=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function";function hN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function pN(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hN(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hN(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var rs=pN(pN({},Object.freeze({__proto__:null,hasBrowserEnv:lN,hasStandardBrowserEnv:mK,hasStandardBrowserWebWorkerEnv:_K})),fK),EK=Or,gK=De,SK=qn,TK=W,vK=function(){var e=EK(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},fN=RegExp.prototype,mN=function(e){var t=e.flags;return t!==void 0||"flags"in fN||SK(e,"flags")||!TK(fN,e)?t:gK(vK,e)},yK=AS.charAt,_N=De,CK=Or,RK=Ve,wK=Pe,IK=/./.exec,AK=TypeError,bK=At,EN=De,gN=mt,OK=Yg,Kf=Jg,SN=gd,TN=hw,Ku=vi,NK=Or,DK=Ed,PK=Pe,LK=fw,vN=mN,kK=zp,MK=g,xK=eS,UK=function(e,t,n){return t+(n?yK(e,t).length:1)},VK=function(e,t){var n=e.exec;if(RK(n)){var r=_N(n,e,t);return r!==null&&CK(r),r}if(wK(e)==="RegExp")return _N(IK,e,t);throw AK("RegExp#exec called on incompatible receiver")},yN=mc,jK=rn("matchAll"),CN="RegExp String",RN=CN+" Iterator",FK=yN.set,BK=yN.getterFor(RN),GK=TypeError,vT=gN("".indexOf),zf=gN("".matchAll),yT=!!zf&&!MK(function(){zf("a",/./)}),WK=OK(function(e,t,n,r){FK(this,{type:RN,regexp:e,string:t,global:n,unicode:r,done:!1})},CN,function(){var e=BK(this);if(e.done)return Kf(void 0,!0);var t=e.regexp,n=e.string,r=VK(t,n);return r===null?(e.done=!0,Kf(void 0,!0)):e.global?(Ku(r[0])===""&&(t.lastIndex=UK(n,TN(t.lastIndex),e.unicode)),Kf(r,!1)):(e.done=!0,Kf(r,!1))}),wN=function(e){var t,n,r,i=NK(this),a=Ku(e),c=xK(i,RegExp),d=Ku(vN(i));return t=new c(c===RegExp?i.source:i,d),n=!!~vT(d,"g"),r=!!~vT(d,"u"),t.lastIndex=TN(i.lastIndex),new WK(t,a,n,r)};bK({target:"String",proto:!0,forced:yT},{matchAll:function(e){var t,n,r,i,a=SN(this);if(DK(e)){if(yT)return zf(a,e)}else{if(LK(e)&&(t=Ku(SN(vN(e))),!~vT(t,"g")))throw GK("`.matchAll` does not allow non-global regexes");if(yT)return zf(a,e);if((r=kK(e,jK))===void 0&&PK(e)=="RegExp"&&(r=wN),r)return EN(r,e,a)}return n=Ku(a),i=new RegExp(e,"g"),EN(wN,i,n)}});var HK=Gi("String").matchAll,KK=W,zK=HK,CT=String.prototype,YK=function(e){var t=e.matchAll;return typeof e=="string"||e===CT||KK(CT,e)&&t===CT.matchAll?zK:t},qK=_(YK);function IN(e){function t(n,r,i,a){let c=n[a++];if(c==="__proto__")return!0;const d=Number.isFinite(+c),u=a>=n.length;return c=!c&&ge.isArray(i)?i.length:c,u?(ge.hasOwnProp(i,c)?i[c]=[i[c],r]:i[c]=r,!d):(i[c]&&ge.isObject(i[c])||(i[c]=[]),t(n,r,i[c],a)&&ge.isArray(i[c])&&(i[c]=function(p){const f={},m=Object.keys(p);let E;const S=m.length;let I;for(E=0;E<S;E++)I=m[E],f[I]=p[I];return f}(i[c])),!d)}if(ge.isFormData(e)&&ge.isFunction(e.entries)){const n={};return ge.forEachEntry(e,(r,i)=>{t(function(a){return qK(ge).call(ge,/\w+|\[(\w*)]/g,a).map(c=>c[0]==="[]"?"":c[1]||c[0])}(r),i,n,0)}),n}return null}const RT={transitional:kb,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=ge.isObject(e);if(i&&ge.isHTMLForm(e)&&(e=new FormData(e)),ge.isFormData(e))return r?JSON.stringify(IN(e)):e;if(ge.isArrayBuffer(e)||ge.isBuffer(e)||ge.isStream(e)||ge.isFile(e)||ge.isBlob(e))return e;if(ge.isArrayBufferView(e))return e.buffer;if(ge.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(c,d){return Lf(c,new rs.classes.URLSearchParams,Object.assign({visitor:function(u,p,f,m){return rs.isNode&&ge.isBuffer(u)?(this.append(p,u.toString("base64")),!1):m.defaultVisitor.apply(this,arguments)}},d))}(e,this.formSerializer).toString();if((a=ge.isFileList(e))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Lf(a?{"files[]":e}:e,c&&new c,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(c,d,u){if(ge.isString(c))try{return(d||JSON.parse)(c),ir(ge).call(ge,c)}catch(p){if(p.name!=="SyntaxError")throw p}return(0,JSON.stringify)(c)}(e)):e}],transformResponse:[function(e){const t=this.transitional||RT.transitional,n=t&&t.forcedJSONParsing,r=this.responseType==="json";if(e&&ge.isString(e)&&(n&&!this.responseType||r)){const i=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(a){if(i)throw a.name==="SyntaxError"?Ft.from(a,Ft.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:rs.classes.FormData,Blob:rs.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ge.forEach(["delete","get","head","post","put","patch"],e=>{RT.headers[e]={}});var wT=RT;const JK=ge.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),AN=Symbol("internals");function zu(e){var t;return e&&ir(t=String(e)).call(t).toLowerCase()}function Yf(e){return e===!1||e==null?e:ge.isArray(e)?e.map(Yf):String(e)}function IT(e,t,n,r,i){return ge.isFunction(r)?r.call(this,t,n):(i&&(t=n),ge.isString(t)?ge.isString(r)?t.indexOf(r)!==-1:ge.isRegExp(r)?r.test(t):void 0:void 0)}class qf{constructor(t){t&&this.set(t)}set(t,n,r){const i=this;function a(u,p,f){const m=zu(p);if(!m)throw new Error("header name must be a non-empty string");const E=ge.findKey(i,m);(!E||i[E]===void 0||f===!0||f===void 0&&i[E]!==!1)&&(i[E||p]=Yf(u))}const c=(u,p)=>ge.forEach(u,(f,m)=>a(f,m,p));var d;return ge.isPlainObject(t)||t instanceof this.constructor?c(t,n):ge.isString(t)&&(t=ir(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(ir(d=t).call(d))?c((u=>{const p={};let f,m,E;return u&&u.split(`
`).forEach(function(S){var I,v;E=S.indexOf(":"),f=ir(I=S.substring(0,E)).call(I).toLowerCase(),m=ir(v=S.substring(E+1)).call(v),!f||p[f]&&JK[f]||(f==="set-cookie"?p[f]?p[f].push(m):p[f]=[m]:p[f]=p[f]?p[f]+", "+m:m)}),p})(t),n):t!=null&&a(n,t,r),this}get(t,n){if(t=zu(t)){const r=ge.findKey(this,t);if(r){const i=this[r];if(!n)return i;if(n===!0)return function(a){const c=Object.create(null),d=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let u;for(;u=d.exec(a);)c[u[1]]=u[2];return c}(i);if(ge.isFunction(n))return n.call(this,i,r);if(ge.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=zu(t)){const r=ge.findKey(this,t);return!(!r||this[r]===void 0||n&&!IT(0,this[r],r,n))}return!1}delete(t,n){const r=this;let i=!1;function a(c){if(c=zu(c)){const d=ge.findKey(r,c);!d||n&&!IT(0,r[d],d,n)||(delete r[d],i=!0)}}return ge.isArray(t)?t.forEach(a):a(t),i}clear(t){const n=Object.keys(this);let r=n.length,i=!1;for(;r--;){const a=n[r];t&&!IT(0,this[a],a,t,!0)||(delete this[a],i=!0)}return i}normalize(t){const n=this,r={};return ge.forEach(this,(i,a)=>{var c;const d=ge.findKey(r,a);if(d)return n[d]=Yf(i),void delete n[a];const u=t?function(p){return ir(p).call(p).toLowerCase().replace(/([a-z\d])(\w*)/g,(f,m,E)=>m.toUpperCase()+E)}(a):ir(c=String(a)).call(c);u!==a&&delete n[a],n[u]=Yf(i),r[u]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return ge.forEach(this,(r,i)=>{r!=null&&r!==!1&&(n[i]=t&&ge.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,r]=t;return n+": "+r}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return i.forEach(c=>n.set(c)),n}static accessor(t){const n=(this[AN]=this[AN]={accessors:{}}).accessors,r=this.prototype;function i(a){const c=zu(a);n[c]||(function(d,u){const p=ge.toCamelCase(" "+u);["get","set","has"].forEach(f=>{Object.defineProperty(d,f+p,{value:function(m,E,S){return this[f].call(this,u,m,E,S)},configurable:!0})})}(r,a),n[c]=!0)}return ge.isArray(t)?t.forEach(i):i(t),this}}qf.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ge.reduceDescriptors(qf.prototype,(e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(i){this[r]=i}}}),ge.freezeMethods(qf);var bs=qf;function AT(e,t){const n=this||wT,r=t||n,i=bs.from(r.headers);let a=r.data;return ge.forEach(e,function(c){a=c.call(n,a,i.normalize(),t?t.status:void 0)}),i.normalize(),a}function bN(e){return!(!e||!e.__CANCEL__)}function Yu(e,t,n){Ft.call(this,e??"canceled",Ft.ERR_CANCELED,t,n),this.name="CanceledError"}ge.inherits(Yu,Ft,{__CANCEL__:!0});var XK=rs.hasStandardBrowserEnv?{write(e,t,n,r,i,a){const c=[e+"="+encodeURIComponent(t)];ge.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),ge.isString(r)&&c.push("path="+r),ge.isString(i)&&c.push("domain="+i),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function ON(e,t){return e&&!function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(t)?function(n,r){return r?n.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):n}(e,t):t}var QK=rs.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function r(i){let a=i;return e&&(t.setAttribute("href",a),a=t.href),t.setAttribute("href",a),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return n=r(window.location.href),function(i){const a=ge.isString(i)?r(i):i;return a.protocol===n.protocol&&a.host===n.host}}():function(){return!0};function NN(e,t){let n=0;const r=function(i,a){i=i||10;const c=new Array(i),d=new Array(i);let u,p=0,f=0;return a=a!==void 0?a:1e3,function(m){const E=Date.now(),S=d[f];u||(u=E),c[p]=m,d[p]=E;let I=f,v=0;for(;I!==p;)v+=c[I++],I%=i;if(p=(p+1)%i,p===f&&(f=(f+1)%i),E-u<a)return;const y=S&&E-S;return y?Math.round(1e3*v/y):void 0}}(50,250);return i=>{const a=i.loaded,c=i.lengthComputable?i.total:void 0,d=a-n,u=r(d);n=a;const p={loaded:a,total:c,progress:c?a/c:void 0,bytes:d,rate:u||void 0,estimated:u&&c&&a<=c?(c-a)/u:void 0,event:i};p[t?"download":"upload"]=!0,e(p)}}var ZK=typeof XMLHttpRequest<"u"&&function(e){return new ae(function(t,n){let r=e.data;const i=bs.from(e.headers).normalize();let a,c,{responseType:d,withXSRFToken:u}=e;function p(){e.cancelToken&&e.cancelToken.unsubscribe(a),e.signal&&e.signal.removeEventListener("abort",a)}if(ge.isFormData(r)){if(rs.hasStandardBrowserEnv||rs.hasStandardBrowserWebWorkerEnv)i.setContentType(!1);else if((c=i.getContentType())!==!1){const[I,...v]=c?c.split(";").map(y=>ir(y).call(y)).filter(Boolean):[];i.setContentType([I||"multipart/form-data",...v].join("; "))}}let f=new XMLHttpRequest;if(e.auth){const I=e.auth.username||"",v=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";i.set("Authorization","Basic "+btoa(I+":"+v))}const m=ON(e.baseURL,e.url);function E(){if(!f)return;const I=bs.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());(function(v,y,A){const N=A.config.validateStatus;A.status&&N&&!N(A.status)?y(new Ft("Request failed with status code "+A.status,[Ft.ERR_BAD_REQUEST,Ft.ERR_BAD_RESPONSE][Math.floor(A.status/100)-4],A.config,A.request,A)):v(A)})(function(v){t(v),p()},function(v){n(v),p()},{data:d&&d!=="text"&&d!=="json"?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:I,config:e,request:f}),f=null}if(f.open(e.method.toUpperCase(),Pb(m,e.params,e.paramsSerializer),!0),f.timeout=e.timeout,"onloadend"in f?f.onloadend=E:f.onreadystatechange=function(){f&&f.readyState===4&&(f.status!==0||f.responseURL&&f.responseURL.indexOf("file:")===0)&&setTimeout(E)},f.onabort=function(){f&&(n(new Ft("Request aborted",Ft.ECONNABORTED,e,f)),f=null)},f.onerror=function(){n(new Ft("Network Error",Ft.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let I=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const v=e.transitional||kb;e.timeoutErrorMessage&&(I=e.timeoutErrorMessage),n(new Ft(I,v.clarifyTimeoutError?Ft.ETIMEDOUT:Ft.ECONNABORTED,e,f)),f=null},rs.hasStandardBrowserEnv&&(u&&ge.isFunction(u)&&(u=u(e)),u||u!==!1&&QK(m))){const I=e.xsrfHeaderName&&e.xsrfCookieName&&XK.read(e.xsrfCookieName);I&&i.set(e.xsrfHeaderName,I)}r===void 0&&i.setContentType(null),"setRequestHeader"in f&&ge.forEach(i.toJSON(),function(I,v){f.setRequestHeader(v,I)}),ge.isUndefined(e.withCredentials)||(f.withCredentials=!!e.withCredentials),d&&d!=="json"&&(f.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&f.addEventListener("progress",NN(e.onDownloadProgress,!0)),typeof e.onUploadProgress=="function"&&f.upload&&f.upload.addEventListener("progress",NN(e.onUploadProgress)),(e.cancelToken||e.signal)&&(a=I=>{f&&(n(!I||I.type?new Yu(null,e,f):I),f.abort(),f=null)},e.cancelToken&&e.cancelToken.subscribe(a),e.signal&&(e.signal.aborted?a():e.signal.addEventListener("abort",a)));const S=function(I){const v=/^([-+\w]{1,25})(:?\/\/|:)/.exec(I);return v&&v[1]||""}(m);S&&rs.protocols.indexOf(S)===-1?n(new Ft("Unsupported protocol "+S+":",Ft.ERR_BAD_REQUEST,e)):f.send(r||null)})};const bT={http:null,xhr:ZK};ge.forEach(bT,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const DN=e=>"- ".concat(e),$K=e=>ge.isFunction(e)||e===null||e===!1;var PN={getAdapter:e=>{e=ge.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let a=0;a<t;a++){let c;if(n=e[a],r=n,!$K(n)&&(r=bT[(c=String(n)).toLowerCase()],r===void 0))throw new Ft("Unknown adapter '".concat(c,"'"));if(r)break;i[c||"#"+a]=r}if(!r){const a=Object.entries(i).map(c=>{let[d,u]=c;return"adapter ".concat(d," ")+(u===!1?"is not supported by the environment":"is not available in the build")});throw new Ft("There is no suitable adapter to dispatch the request "+(t?a.length>1?`since :
`+a.map(DN).join(`
`):" "+DN(a[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:bT};function OT(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Yu(null,e)}function LN(e){return OT(e),e.headers=bs.from(e.headers),e.data=AT.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),PN.getAdapter(e.adapter||wT.adapter)(e).then(function(t){return OT(e),t.data=AT.call(e,e.transformResponse,t),t.headers=bs.from(t.headers),t},function(t){return bN(t)||(OT(e),t&&t.response&&(t.response.data=AT.call(e,e.transformResponse,t.response),t.response.headers=bs.from(t.response.headers))),ae.reject(t)})}function kN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}const MN=e=>e instanceof bs?function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?kN(Object(r),!0).forEach(function(i){w(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):kN(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}({},e):e;function Gd(e,t){t=t||{};const n={};function r(p,f,m){return ge.isPlainObject(p)&&ge.isPlainObject(f)?ge.merge.call({caseless:m},p,f):ge.isPlainObject(f)?ge.merge({},f):ge.isArray(f)?f.slice():f}function i(p,f,m){return ge.isUndefined(f)?ge.isUndefined(p)?void 0:r(void 0,p,m):r(p,f,m)}function a(p,f){if(!ge.isUndefined(f))return r(void 0,f)}function c(p,f){return ge.isUndefined(f)?ge.isUndefined(p)?void 0:r(void 0,p):r(void 0,f)}function d(p,f,m){return m in t?r(p,f):m in e?r(void 0,p):void 0}const u={url:a,method:a,data:a,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:d,headers:(p,f)=>i(MN(p),MN(f),!0)};return ge.forEach(Object.keys(Object.assign({},e,t)),function(p){const f=u[p]||i,m=f(e[p],t[p],p);ge.isUndefined(m)&&f!==d||(n[p]=m)}),n}const xN="1.6.8",NT={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{NT[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const UN={};NT.transitional=function(e,t,n){function r(i,a){return"[Axios v"+xN+"] Transitional option '"+i+"'"+a+(n?". "+n:"")}return(i,a,c)=>{if(e===!1)throw new Ft(r(a," has been removed"+(t?" in "+t:"")),Ft.ERR_DEPRECATED);return t&&!UN[a]&&(UN[a]=!0,console.warn(r(a," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,a,c)}};var DT={assertOptions:function(e,t,n){if(typeof e!="object")throw new Ft("options must be an object",Ft.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const a=r[i],c=t[a];if(c){const d=e[a],u=d===void 0||c(d,a,e);if(u!==!0)throw new Ft("option "+a+" must be "+u,Ft.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new Ft("Unknown option "+a,Ft.ERR_BAD_OPTION)}},validators:NT};const la=DT.validators;let Jf=class{constructor(e){this.defaults=e,this.interceptors={request:new Lb,response:new Lb}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Gd(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;n!==void 0&&DT.assertOptions(n,{silentJSONParsing:la.transitional(la.boolean),forcedJSONParsing:la.transitional(la.boolean),clarifyTimeoutError:la.transitional(la.boolean)},!1),r!=null&&(ge.isFunction(r)?t.paramsSerializer={serialize:r}:DT.assertOptions(r,{encode:la.function,serialize:la.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=i&&ge.merge(i.common,i[t.method]);i&&ge.forEach(["delete","get","head","post","put","patch","common"],S=>{delete i[S]}),t.headers=bs.concat(a,i);const c=[];let d=!0;this.interceptors.request.forEach(function(S){typeof S.runWhen=="function"&&S.runWhen(t)===!1||(d=d&&S.synchronous,c.unshift(S.fulfilled,S.rejected))});const u=[];let p;this.interceptors.response.forEach(function(S){u.push(S.fulfilled,S.rejected)});let f,m=0;if(!d){const S=[LN.bind(this),void 0];for(S.unshift.apply(S,c),S.push.apply(S,u),f=S.length,p=ae.resolve(t);m<f;)p=p.then(S[m++],S[m++]);return p}f=c.length;let E=t;for(m=0;m<f;){const S=c[m++],I=c[m++];try{E=S(E)}catch(v){I.call(this,v);break}}try{p=LN.call(this,E)}catch(S){return ae.reject(S)}for(m=0,f=u.length;m<f;)p=p.then(u[m++],u[m++]);return p}getUri(e){return Pb(ON((e=Gd(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};ge.forEach(["delete","get","head","options"],function(e){Jf.prototype[e]=function(t,n){return this.request(Gd(n||{},{method:e,url:t,data:(n||{}).data}))}}),ge.forEach(["post","put","patch"],function(e){function t(n){return function(r,i,a){return this.request(Gd(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}Jf.prototype[e]=t(),Jf.prototype[e+"Form"]=t(!0)});var Xf=Jf;class PT{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new ae(function(i){n=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](i);r._listeners=null}),this.promise.then=i=>{let a;const c=new ae(d=>{r.subscribe(d),a=d}).then(i);return c.cancel=function(){r.unsubscribe(a)},c},t(function(i,a,c){r.reason||(r.reason=new Yu(i,a,c),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}static source(){let t;return{token:new PT(function(n){t=n}),cancel:t}}}var ez=PT;const LT={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(LT).forEach(e=>{let[t,n]=e;LT[n]=t});var tz=LT;const $n=function e(t){const n=new Xf(t),r=_b(Xf.prototype.request,n);return ge.extend(r,Xf.prototype,n,{allOwnKeys:!0}),ge.extend(r,n,null,{allOwnKeys:!0}),r.create=function(i){return e(Gd(t,i))},r}(wT);$n.Axios=Xf,$n.CanceledError=Yu,$n.CancelToken=ez,$n.isCancel=bN,$n.VERSION=xN,$n.toFormData=Lf,$n.AxiosError=Ft,$n.Cancel=$n.CanceledError,$n.all=function(e){return ae.all(e)},$n.spread=function(e){return function(t){return e.apply(null,t)}},$n.isAxiosError=function(e){return ge.isObject(e)&&e.isAxiosError===!0},$n.mergeConfig=Gd,$n.AxiosHeaders=bs,$n.formToJSON=e=>IN(ge.isHTMLForm(e)?new FormData(e):e),$n.getAdapter=PN.getAdapter,$n.HttpStatusCode=tz,$n.default=$n;var yr=$n;const nz=()=>{};function qu(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:nz};return e.promise=new ae((t,n)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=r=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(r))}}),e}const Qf=new Map,Zf=new Map,is=new Map;let yn=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),dt=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const VN=new C7;let Co=VN.getResult(),kT=null;function tt(e){if(!kT){Co=VN.getResult();const t=function(d){if(d.engine.name==="Blink"&&d.browser.name!=="WeChat")return dt.CHROME;switch(d.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return dt.CHROME;case"Safari":case"Mobile Safari":return dt.SAFARI;case"Edge":return dt.EDGE;case"Firefox":return dt.FIREFOX;case"QQ":case"QQBrowser":return dt.QQ;case"Opera":return dt.OPERA;case"WeChat":return dt.WECHAT;default:return d.browser.name||""}}(Co),n=jN(Co),r=function(d){return d.os.name==="Windows"?d.os.version?d.os.name+" "+d.os.version:d.os.name:d.os.name||""}(Co),i=Co.os.version,a=jN(Co,!1),c=Co.device.type;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i,browserVersion:a,deviceType:c};kT={name:t,version:n,os:r,osVersion:i,browserVersion:a,deviceType:c}}return kT}function jN(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function $f(){return tt().os}function FN(){const e=tt();return"".concat(e.os," ").concat(e.osVersion)}function em(){const e=tt();return!!(Co.engine.name==="WebKit"&&e.os===yn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==dt.SAFARI||Jn()&&e.name!==dt.SAFARI)}function ua(){return tt().name===dt.CHROME}function Cn(){return tt().name===dt.SAFARI}function BN(){return tt().name===dt.EDGE}function yt(){return tt().name===dt.FIREFOX}function Jn(){return tt().os===yn.IOS}function MT(e){const t=tt();return!(t.name!==dt.CHROME||!t.osVersion)&&Number(t.version)>=e}function GN(e){const t=tt();return!(t.name!==dt.EDGE||!t.osVersion)&&Number(t.version)>=e}function WN(e){const t=tt();return!(t.name!==dt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function HN(e,t,n){const r=tt();if(r.os!==yn.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e}function KN(e,t,n){const r=tt();if(r.name!==dt.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e}function zN(e){const t=tt();return!(t.name!==dt.OPERA||!t.osVersion)&&Number(t.version)>=e}function YN(){const e=tt();return!(e.name!==dt.CHROME||!e.osVersion)&&Number(e.version)<=90}function qN(){const e=tt();if(e.os!==yn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Wd(){const e=tt();if(e.os!==yn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function xT(){const e=tt();if(e.os!==yn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function JN(){const e=tt();if(e.os!==yn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Ki(){return Cn()&&navigator.maxTouchPoints>0}function XN(){return tt().name===dt.WECHAT}function QN(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function UT(){const e=$f();return function(){const{deviceType:t}=tt();return t==="mobile"||t==="tablet"}()||e===yn.ANDROID||e===yn.IOS||e===yn.HARMONY_OS}function ha(){const e=tt();return e.name!==dt.EDGE&&e.name!==dt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function tm(){return $f()===yn.ANDROID}function Ju(){const e=tt();return tm()&&(e.name===dt.CHROME||e.name===dt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function ZN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ce(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ZN(Object(n),!0).forEach(function(r){kt(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZN(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function kt(e,t,n){return(t=function(r){var i=function(a,c){if(typeof a!="object"||a===null)return a;var d=a[Symbol.toPrimitive];if(d!==void 0){var u=d.call(a,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(r);return typeof i=="symbol"?i:String(i)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let O=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({});class q extends Error{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(n),kt(this,"code",void 0),kt(this,"message",void 0),kt(this,"data",void 0),kt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=r}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",n=arguments.length>1?arguments[1]:void 0;return t==="error"&&(n||console).error(this.toString()),t==="warning"&&(n||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}}function Os(e,t){if(typeof e!="boolean")throw new q(O.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Sn(e,t,n){if(!le(n).call(n,e))throw new q(O.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function St(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(i){return typeof i=="number"&&i%1==0}(e))throw new q(O.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function VT(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new q(O.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&St(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&St(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&St(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&St(e.ideal,"".concat(t,".ideal"),1,1/0)}else St(e,t,1,1/0)}function Mn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new q(O.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!$N(e,n,r,i))throw new q(O.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function Ns(e,t){if(!Array.isArray(e))throw new q(O.INVALID_PARAMS,"".concat(t," should be an array"))}function Ht(e){return e==null}function $N(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!r||function(i){if(typeof i!="string")return!1;for(let a=0;a<i.length;a+=1){const c=i.charCodeAt(a);if(c<0||c>255)return!1}return!0}(e))}function e1(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);const r=e.getUint32(t,n),i=e.getUint32(t+4,n),a=+!!n,c=+!n;return BigInt(r*c+i*a)<<BigInt(32)|BigInt(r*a+i*c)}function t1(e,t,n,r){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,r);const i=Number(n>>BigInt(32)),a=Number(n&BigInt(4294967295));e.setUint32(t,i,r),e.setUint32(t+4,a,r)}var Xu=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(Xu||{}),jT=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(jT||{});const n1=new class{constructor(){kt(this,"_clientSize",null),kt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),kt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),kt(this,"getStyle",e=>window.getComputedStyle(e,null)),kt(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const r=this.getStyle(e),{display:i,visibility:a,opacity:c,filter:d}=r;return(i==="none"||le(t=["hidden","collapse"]).call(t,a)||Number(c)<.1)&&(n=!1),!!n&&(d&&d.split(" ").filter(u=>{var p;const f=u.split("(")[0];return le(p=["brightness","blur","opacity"]).call(p,f)}).map(u=>{const[p,f]=u.split(/\(|\)/);return[p,Number(f.match(/^[0-9\.]+/))]}).forEach(u=>{const[p,f]=u;switch(p){case"brightness":(f<.1||f>3)&&(n=!1);break;case"blur":f>3&&(n=!1);break;case"opacity":f<.1&&(n=!1)}}),n)}),kt(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,r=!0;const i=c=>t(c);let a=e;for(;a&&r;)i(a)||(n=!1,r=!1),a=a.parentElement,a||(r=!1);return n}),kt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),kt(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:r,right:i,top:a,bottom:c}=e.getBoundingClientRect(),d=this.getClientWidth(),u=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:a,bottom:c,clientWidth:d,clientHeight:u,clientMin:Math.min(d,u)}}),kt(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),kt(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),kt(this,"checkCoverForAPoint",(e,t,n)=>{const r=this.elementFromPoint(e,t);return r!==null&&r!==n}),kt(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,a=t/6,c=[],d=10**6;for(let u=0;u<5;u++)for(let p=0;p<5;p++){const f=(n*d+(u===0?.1:u===4?(i*u*d-1e5)/d:i*u)*d)/d,m=(r*d+(p===0?.1:p===4?(a*p*d-1e5)/d:a*p)*d)/d;c.push({x:f,y:m})}return[...c]}),kt(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),kt(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),kt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:i,clientWidth:a,clientMin:c}=this._clientSize;let d,u,p,f;if(e<0)d=0;else{if(!(e<a))return!1;d=e}if(t<0)return!1;if(u=t<a?t:a,n<0)p=0;else{if(!(n<i))return!1;p=n}if(r<0)return!1;f=r<i?r:i;const m=u-d,E=f-p;return this.checkSizeIsVisible(m,E,c)}),kt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),kt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Xu.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(Xu.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Xu.SIZE)}}return this.returnHiddenResult(Xu.STYLE)}return this.returnHiddenResult(jT.UNMOUNTED)}return this.returnHiddenResult(jT.INVALID_HTML_ELEMENT)}),kt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function FT(e){return new TextEncoder().encode(e)}const r1=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},BT=async e=>function(t,n){let r="";return new Uint8Array(t).forEach(i=>{r+=i.toString(n).padStart(2,"0")}),r}(await crypto.subtle.digest("SHA-256",FT(e)),16);let xt=class{constructor(){kt(this,"_events",{}),kt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],r=this._indexOfListener(n,t);r!==-1&&n.splice(r,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(a=>a);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(let a=0;a<t.length;a+=1){const c=t[a];c.once&&this.off(e,c.listener),c.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];[...this._events[e]||[]].forEach(i=>{i.once&&this.off(e,i.listener);try{i.listener.apply(this,n)}catch(a){console.error("safeEmit event:".concat(e," error ").concat(a==null?void 0:a.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},Qu=null;function i1(){if(Qu)return Qu;if(window.electron)return Qu=window.electron;if(!window.require)return null;try{return Qu=window.require("electron"),Qu}catch{return null}}let ln=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.DATACHANNEL_FAILBACK="Client._datachannelFailback",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e}({}),Kt=function(e){return e.TRACER="tracer",e}({});function o1(e){return St(e.timeout,"config.timeout",0,1e5),St(e.timeoutFactor,"config.timeoutFactor",0,100,!1),St(e.maxRetryCount,"config.maxRetryConfig",0,1/0),St(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let rz=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),qe=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.FALLBACK="FALLBACK",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function Hd(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function s1(e){return Mn(e.turnServerURL,"turnServerURL"),Mn(e.username,"username"),Mn(e.password,"password"),e.udpport&&St(e.udpport,"udpport",1,99999,!0),e.forceturn&&Os(e.forceturn,"forceturn"),e.security&&Os(e.security,"security"),e.tcpport&&St(e.tcpport,"tcpport",1,99999,!0),!0}function a1(e){return e.level!==void 0&&Sn(e.level,"level",[1,2,3]),e.delay!==void 0&&St(e.delay,"delay",0,3e3,!0),!0}let Je=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Gn=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),pr=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),vc=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function un(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return e.getListeners(t).length===0?ae.reject(new q(O.UNEXPECTED_ERROR,"can not emit promise")):new ae((a,c)=>{e.emit(t,...r,a,c)})}function Ct(e,t){if(e.getListeners(t).length===0)return ae.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return un(e,t,...r)}function Kr(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return yc(e,t,...r)}function yc(e,t){let n=null,r=null;for(var i=arguments.length,a=new Array(i>2?i-2:0),c=2;c<i;c++)a[c-2]=arguments[c];if(e.emit(t,...a,d=>{n=d},d=>{r=d}),r!==null)throw r;if(n===null)throw new q(O.UNEXPECTED_ERROR,"handler is not sync");return n}const zt=new class extends xt{set networkState(e){this.emit(vc.NETWORK_STATE_CHANGE,e,this._networkState),e===pr.ONLINE?this.emit(vc.ONLINE):e===pr.OFFLINE&&(this.onlineWaiter=new ae(t=>{this.once(vc.ONLINE,()=>{this.onlineWaiter=void 0,t(pr.ONLINE)})}),this.emit(vc.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===pr.ONLINE}constructor(){super(),kt(this,"_moduleName","network-indicator"),kt(this,"_networkState",pr.ONLINE),kt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=pr.ONLINE}),window.addEventListener("offline",()=>{this.networkState=pr.OFFLINE})}};function nm(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function Kd(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function rm(e){ae!==void 0?ae.resolve().then(e):setTimeout(e,0)}function bt(e){return JSON.parse(JSON.stringify(e))}function Cc(e){try{return bt(e)}catch{return e}}const c1={};function pa(e,t){c1[t]||(c1[t]=!0,e())}function Rc(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function fa(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function d1(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const r=new Uint8Array(t);r.set(n),n=r}return n}function l1(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=vo(t).call(t,(c,d)=>c+d.length,0),i=new Uint8Array(new ArrayBuffer(r));let a=0;return t.forEach(c=>{i.set(c,a),a+=c.length}),i}function os(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function u1(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?os(n):n.size}),t+138}function iz(e){const t=new q(O.TIMEOUT,"timeout");return new ae((n,r)=>{window.setTimeout(()=>r(t),e)})}function Rn(e){return new ae(t=>{window.setTimeout(t,e)})}function Rt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+Rt(e-n.length,"")}function Zu(){return Rt(32,"").toUpperCase()}const im=()=>{},h1=new class{constructor(){kt(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,a=new Array(i>4?i-4:0),c=4;c<i;c++)a[c-4]=arguments[c];if(this.fnMap.has(t)){const d=this.fnMap.get(t);if(d.threshold!==n){d.fn(...d.args),clearTimeout(d.timer);const u=window.setTimeout(()=>{const p=this.fnMap.get(t);p&&p.fn(...p.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:u,args:a,skipFn:r})}else d.skipFn&&d.skipFn(...d.args),this.fnMap.set(t,Ce(Ce({},d),{},{fn:e,args:a,skipFn:r}))}else{const d=window.setTimeout(()=>{const u=this.fnMap.get(t);u&&u.fn(...u.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:d,args:a,skipFn:r})}}},p1=h1.throttleByKey.bind(h1);function f1(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function GT(e,t){if(!f1(e)||!f1(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let r=0;r<t.length;r++)n[r]=GT(e[r],t[r]);return n}{const n=Ce({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=GT(e[r],t[r]):n[r]=t[r]);return n}}function m1(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,r!==t););return n}function WT(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function _1(e){const t="0123456789abcdef";function n(V){let F,G="";for(F=0;F<=3;F++)G+=t.charAt(V>>8*F+4&15)+t.charAt(V>>8*F&15);return G}function r(V,F){const G=(65535&V)+(65535&F);return(V>>16)+(F>>16)+(G>>16)<<16|65535&G}function i(V,F,G,z,Q,Z){return r(function(ee,me){return ee<<me|ee>>>32-me}(r(r(F,V),r(z,Z)),Q),G)}function a(V,F,G,z,Q,Z,ee){return i(F&G|~F&z,V,F,Q,Z,ee)}function c(V,F,G,z,Q,Z,ee){return i(F&z|G&~z,V,F,Q,Z,ee)}function d(V,F,G,z,Q,Z,ee){return i(F^G^z,V,F,Q,Z,ee)}function u(V,F,G,z,Q,Z,ee){return i(G^(F|~z),V,F,Q,Z,ee)}const p=function(V){let F;const G=1+(V.length+8>>6),z=new Array(16*G);for(F=0;F<16*G;F++)z[F]=0;for(F=0;F<V.length;F++)z[F>>2]|=V.charCodeAt(F)<<F%4*8;return z[F>>2]|=128<<F%4*8,z[16*G-2]=8*V.length,z}(e);let f,m,E,S,I,v=1732584193,y=-271733879,A=-1732584194,N=271733878;for(f=0;f<p.length;f+=16)m=v,E=y,S=A,I=N,v=a(v,y,A,N,p[f+0],7,-680876936),N=a(N,v,y,A,p[f+1],12,-389564586),A=a(A,N,v,y,p[f+2],17,606105819),y=a(y,A,N,v,p[f+3],22,-1044525330),v=a(v,y,A,N,p[f+4],7,-176418897),N=a(N,v,y,A,p[f+5],12,1200080426),A=a(A,N,v,y,p[f+6],17,-1473231341),y=a(y,A,N,v,p[f+7],22,-45705983),v=a(v,y,A,N,p[f+8],7,1770035416),N=a(N,v,y,A,p[f+9],12,-1958414417),A=a(A,N,v,y,p[f+10],17,-42063),y=a(y,A,N,v,p[f+11],22,-1990404162),v=a(v,y,A,N,p[f+12],7,1804603682),N=a(N,v,y,A,p[f+13],12,-40341101),A=a(A,N,v,y,p[f+14],17,-1502002290),y=a(y,A,N,v,p[f+15],22,1236535329),v=c(v,y,A,N,p[f+1],5,-165796510),N=c(N,v,y,A,p[f+6],9,-1069501632),A=c(A,N,v,y,p[f+11],14,643717713),y=c(y,A,N,v,p[f+0],20,-373897302),v=c(v,y,A,N,p[f+5],5,-701558691),N=c(N,v,y,A,p[f+10],9,38016083),A=c(A,N,v,y,p[f+15],14,-660478335),y=c(y,A,N,v,p[f+4],20,-405537848),v=c(v,y,A,N,p[f+9],5,568446438),N=c(N,v,y,A,p[f+14],9,-1019803690),A=c(A,N,v,y,p[f+3],14,-187363961),y=c(y,A,N,v,p[f+8],20,1163531501),v=c(v,y,A,N,p[f+13],5,-1444681467),N=c(N,v,y,A,p[f+2],9,-51403784),A=c(A,N,v,y,p[f+7],14,1735328473),y=c(y,A,N,v,p[f+12],20,-1926607734),v=d(v,y,A,N,p[f+5],4,-378558),N=d(N,v,y,A,p[f+8],11,-2022574463),A=d(A,N,v,y,p[f+11],16,1839030562),y=d(y,A,N,v,p[f+14],23,-35309556),v=d(v,y,A,N,p[f+1],4,-1530992060),N=d(N,v,y,A,p[f+4],11,1272893353),A=d(A,N,v,y,p[f+7],16,-155497632),y=d(y,A,N,v,p[f+10],23,-1094730640),v=d(v,y,A,N,p[f+13],4,681279174),N=d(N,v,y,A,p[f+0],11,-358537222),A=d(A,N,v,y,p[f+3],16,-722521979),y=d(y,A,N,v,p[f+6],23,76029189),v=d(v,y,A,N,p[f+9],4,-640364487),N=d(N,v,y,A,p[f+12],11,-421815835),A=d(A,N,v,y,p[f+15],16,530742520),y=d(y,A,N,v,p[f+2],23,-995338651),v=u(v,y,A,N,p[f+0],6,-198630844),N=u(N,v,y,A,p[f+7],10,1126891415),A=u(A,N,v,y,p[f+14],15,-1416354905),y=u(y,A,N,v,p[f+5],21,-57434055),v=u(v,y,A,N,p[f+12],6,1700485571),N=u(N,v,y,A,p[f+3],10,-1894986606),A=u(A,N,v,y,p[f+10],15,-1051523),y=u(y,A,N,v,p[f+1],21,-2054922799),v=u(v,y,A,N,p[f+8],6,1873313359),N=u(N,v,y,A,p[f+15],10,-30611744),A=u(A,N,v,y,p[f+6],15,-1560198380),y=u(y,A,N,v,p[f+13],21,1309151649),v=u(v,y,A,N,p[f+4],6,-145523070),N=u(N,v,y,A,p[f+11],10,-1120210379),A=u(A,N,v,y,p[f+2],15,718787259),y=u(y,A,N,v,p[f+9],21,-343485551),v=r(v,m),y=r(y,E),A=r(A,S),N=r(N,I);return n(v)+n(y)+n(A)+n(N)}let oz=1,om=console,On=class{static setLogger(e){om=e}constructor(e){kt(this,"lockingPromise",ae.resolve()),kt(this,"locks",0),kt(this,"name",""),kt(this,"lockId",void 0),this.lockId=oz++,e&&(this.name=e),om.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,om.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:""));const n=new ae(i=>{t=()=>{this.locks-=1,om.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:"")),i()}}),r=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),r}};function zd(e,t){return function(n,r,i){const a=i.value;if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this[t];if(!c)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const d=await c.lock("From ".concat(e,".").concat(r));try{for(var u=arguments.length,p=new Array(u),f=0;f<u;f++)p[f]=arguments[f];return await a.apply(this,p)}finally{d()}},i}}const on={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function sm(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Ro(e,t,n,r){const i=Object.assign({},on,r);let a=i.timeout;const c=async()=>{await function(p){return new ae(f=>{window.setTimeout(f,p)})}(a),a*=i.timeoutFactor,a=Math.min(i.maxRetryTimeout,a)};let d=!1;const u=new ae(async(p,f)=>{t=t||(()=>!1),n=n||(()=>!0);for(let m=0;m<i.maxRetryCount;m+=1){if(d)return f(new q(O.OPERATION_ABORTED));try{const E=await e();if(!t(E,m)||m+1===i.maxRetryCount)return p(E);await c()}catch(E){if(!n(E,m)||m+1===i.maxRetryCount)return f(E);await c()}}});return u.cancel=()=>d=!0,u}class HT{constructor(t){kt(this,"input",[]),kt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:vo(t=this.input).call(t,(n,r)=>n+r)/this.input.length}}let am,cm=0,KT=0;function zT(e,t,n,r){return new ae((i,a)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),cm+=os(t.data)):n&&(t.data.size?cm+=t.data.size:t.data instanceof FormData?cm+=u1(t.data):cm+=os(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,yr.request(t).then(c=>{typeof c.data=="string"?KT+=os(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?KT+=c.data.byteLength:KT+=os(JSON.stringify(c.data)),i(c.data)}).catch(c=>{yr.isCancel(c)?a(new q(O.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?a(new q(O.NETWORK_TIMEOUT,c.message)):c.response?a(new q(O.NETWORK_RESPONSE_ERROR,c.response.status)):a(new q(O.NETWORK_ERROR,c.message))})})}async function sz(e,t){const n=new Blob([t.data],{type:"buffer"});return await zT(e,Ce(Ce({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const E1=()=>window.isSecureContext!==void 0,Ci=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){const r=t[1],i=t[2];return"".concat(r,".").concat(i)}const n=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(n&&n[1]&&n[2]){const r=n[1],i=n[2];return"".concat(r,".").concat(100*(Number(i)+1))}return"4.0.0.999"}("4.21.0"),YT=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let wc=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const qT={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},JT="v4.21.0-0-g16fdae2c-dirty(6/3/2024, 2:55:18 PM)",_n={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:void 0,ENABLE_CC_FALLBACK:void 0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:qT,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0};function Tt(e,t,n){var r,i,a;le(r=Object.keys(_n)).call(r,e)&&(!n&&le(i=Object.keys(ma)).call(i,e)||(_n[e]=t,e==="ENABLE_VIDEO_SEI"&&t===!0&&(_n.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(a=!!t,_n.USE_NEW_NETWORK_CONFIG=a,a&&(_n.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],_n.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],_n.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],_n.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],_n.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",_n.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",_n.GATEWAY_DOMAINS=["edge.sd-rtn.com"]))))}function P(e){return _n[e]}const ma={};var ze=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(ze||{});class az{constructor(t,n,r,i){kt(this,"state",void 0),this.state={codec:t,audioCodec:n,mode:r,clientId:i,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1,p2pTransport:wc.Default}}dispatch(t){this.state=function(n,r){switch(r.type){case ze.SET_SESSION_ID:return Ce(Ce({},n),{},{sessionId:r.sessionId});case ze.SET_P2P_ID:return Ce(Ce({},n),{},{p2pId:r.p2pId});case ze.SET_UID:return Ce(Ce({},n),{},{uid:r.uid});case ze.SET_INT_UID:return Ce(Ce({},n),{},{intUid:r.intUid});case ze.SET_PUB_ID:return Ce(Ce({},n),{},{pubId:r.pubId});case ze.KEY_METRIC_CLIENT_CREATED:return Ce(Ce({},n),{},{keyMetrics:Ce(Ce({},n.keyMetrics),{},{clientCreated:r.metric})});case ze.KEY_METRIC_JOIN_START:return Ce(Ce({},n),{},{keyMetrics:Ce(Ce({},n.keyMetrics),{},{joinStart:r.metric})});case ze.AVOID_JOIN_START:return Ce(Ce({},n),{},{avoidJoinStart:r.avoidJoinStart});case ze.KEY_METRIC_JOIN_END:return Ce(Ce({},n),{},{keyMetrics:Ce(Ce({},n.keyMetrics),{},{joinEnd:r.metric})});case ze.KEY_METRIC_REQUEST_AP_START:return Ce(Ce({},n),{},{keyMetrics:Ce(Ce({},n.keyMetrics),{},{requestAPStart:r.metric})});case ze.KEY_METRIC_REQUEST_AP_END:return Ce(Ce({},n),{},{keyMetrics:Ce(Ce({},n.keyMetrics),{},{requestAPEnd:r.metric})});case ze.KEY_METRIC_JOIN_GATEWAY_START:return Ce(Ce({},n),{},{keyMetrics:Ce(Ce({},n.keyMetrics),{},{joinGatewayStart:r.metric})});case ze.KEY_METRIC_JOIN_GATEWAY_END:return Ce(Ce({},n),{},{keyMetrics:Ce(Ce({},n.keyMetrics),{},{joinGatewayEnd:r.metric})});case ze.KEY_METRIC_PEER_CONNECTION_START:return Ce(Ce({},n),{},{keyMetrics:Ce(Ce({},n.keyMetrics),{},{peerConnectionStart:r.metric})});case ze.KEY_METRIC_PEER_CONNECTION_END:return Ce(Ce({},n),{},{keyMetrics:Ce(Ce({},n.keyMetrics),{},{peerConnectionEnd:r.metric})});case ze.KEY_METRIC_DESCRIPTION_START:return Ce(Ce({},n),{},{keyMetrics:Ce(Ce({},n.keyMetrics),{},{descriptionStart:r.metric})});case ze.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Ce(Ce({},n),{},{keyMetrics:Ce(Ce({},n.keyMetrics),{},{signalChannelOpen:r.metric})});case ze.KEY_METRIC_ICE_CONNECTION_END:return Ce(Ce({},n),{},{keyMetrics:Ce(Ce({},n.keyMetrics),{},{iceConnectionEnd:r.metric})});case ze.KEY_METRIC_PUBLISH:{const i=n.keyMetrics.publish,a=i.findIndex(c=>c.trackId===r.metric.trackId);return a!==-1?(i[a]=Ce(Ce({},i[a]),r.metric),Ce(Ce({},n),{},{keyMetrics:Ce(Ce({},n.keyMetrics),{},{publish:[...i]})})):Ce(Ce({},n),{},{keyMetrics:Ce(Ce({},n.keyMetrics),{},{publish:[...n.keyMetrics.publish,r.metric]})})}case ze.KEY_METRIC_SUBSCRIBE:{const i=n.keyMetrics.subscribe,a=i.findIndex(c=>c.userId===r.metric.userId&&c.type===r.metric.type);return a!==-1?(i[a]=Ce(Ce({},i[a]),r.metric),Ce(Ce({},n),{},{keyMetrics:Ce(Ce({},n.keyMetrics),{},{subscribe:[...i]})})):Ce(Ce({},n),{},{keyMetrics:Ce(Ce({},n.keyMetrics),{},{subscribe:[...n.keyMetrics.subscribe,r.metric]})})}case ze.SET_CLOUD_PROXY_SERVER_MODE:return n.cloudProxyServerMode=r.mode,n;case ze.RECORD_JOIN_CHANNEL_SERVICE:return typeof r.index!="number"?n.joinChannelServiceRecords=[...n.joinChannelServiceRecords,r.record]:(n.joinChannelServiceRecords[r.index]=Ce(Ce({},n.joinChannelServiceRecords[r.index]),r.record),n.joinChannelServiceRecords=[...n.joinChannelServiceRecords]),n;case ze.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return n.joinChannelServiceRecords=[],n;case ze.RESET_KEY_METRICS:return n.keyMetrics={publish:[],subscribe:[]},n;case ze.SET_USE_DATACHANNEL:return Ce(Ce({},n),{},{useDataChannel:r.val});case ze.SET_USE_P2P:return Ce(Ce({},n),{},{useP2P:r.val});case ze.SET_TRANSPORT_TYPE:return Ce(Ce({},n),{},{p2pTransport:r.val});default:return n}}(this.state,t)}set sessionId(t){this.dispatch({type:ze.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.state.sessionId}set codec(t){this.state.codec=t}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t){this.dispatch({type:ze.SET_P2P_ID,p2pId:t})}get p2pId(){return this.state.p2pId}set dcId(t){this.dispatch({type:ze.SET_DC_ID,dcId:t})}get dcId(){return this.state.dcId}set uid(t){this.dispatch({type:ze.SET_UID,uid:t})}get uid(){return this.state.uid}set intUid(t){this.dispatch({type:ze.SET_INT_UID,intUid:t})}get intUid(){return this.state.intUid}set pubId(t){this.dispatch({type:ze.SET_PUB_ID,pubId:t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t){this.dispatch({type:ze.SET_CLOUD_PROXY_SERVER_MODE,mode:t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(t){this.dispatch({type:ze.SET_USE_DATACHANNEL,val:t})}get useDataChannel(){return this.state.useDataChannel}set useP2P(t){this.dispatch({type:ze.SET_USE_P2P,val:t})}get useP2P(){return this.state.useP2P}set p2pTransport(t){this.dispatch({type:ze.SET_TRANSPORT_TYPE,val:t})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:ze.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ze.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:ze.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ze.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ze.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ze.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ze.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ze.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ze.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:ze.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ze.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ze.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t,n,r,i){this.dispatch({type:ze.KEY_METRIC_PUBLISH,metric:Ce(Ce({trackId:t,type:n},r&&{publishStart:r}),i&&{publishEnd:i})})}subscribe(t,n,r,i,a,c,d){this.dispatch({type:ze.KEY_METRIC_SUBSCRIBE,metric:Ce(Ce(Ce(Ce(Ce({userId:t,type:n},r&&{subscribeStart:r}),i&&{subscribeEnd:i}),a&&{firstFrame:a}),c&&{streamAdded:c}),d&&{firstDecoded:d})})}massSubscribe(t,n,r,i){t.forEach(a=>{this.dispatch({type:ze.KEY_METRIC_SUBSCRIBE,metric:Ce(Ce(Ce({userId:a.userId,type:a.type},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),i&&{firstFrame:i})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t,n){t.service==="gateway"&&Array.isArray(t.urls)&&(t.urls=t.urls.map(r=>r.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof n!="number"?(this.dispatch({type:ze.RECORD_JOIN_CHANNEL_SERVICE,record:Ce(Ce({},t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(n<0||n>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ze.RECORD_JOIN_CHANNEL_SERVICE,record:t,index:n}),n)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ze.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ze.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t){this.dispatch({type:ze.AVOID_JOIN_START,avoidJoinStart:t})}}let Yd=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const g1=128,cz=96,S1=1e3,qd=10;let dz=0;function T1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Fe(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?T1(Object(n),!0).forEach(function(r){Xt(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T1(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Xt(e,t,n){return(t=function(r){var i=function(a,c){if(typeof a!="object"||a===null)return a;var d=a[Symbol.toPrimitive];if(d!==void 0){var u=d.call(a,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(r);return typeof i=="symbol"?i:String(i)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const v1=new class extends xt{constructor(){super(...arguments),Xt(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class lz{constructor(t){Xt(this,"logger",void 0),Xt(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function XT(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function y1(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Ri={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},dm=Date.now(),$u=e=>{for(const t in Ri)if(Object.prototype.hasOwnProperty.call(Ri,t)&&Ri[t]===e)return t;return"DEFAULT"},T=new class{constructor(){Xt(this,"proxyServerURL",void 0),Xt(this,"logLevel",Ri.DEBUG),Xt(this,"uploadState","collecting"),Xt(this,"uploadLogWaitingList",[]),Xt(this,"uploadLogUploadingList",[]),Xt(this,"uploadErrorCount",0),Xt(this,"currentLogID",0),Xt(this,"url",void 0),Xt(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Ri.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Ri.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Ri.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Ri.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Ri.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Tt("UPLOAD_LOG",!0)}disableLogUpload(){Tt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new lz(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-dm<100)return void setTimeout(()=>{this.log(...t)},Date.now()-dm);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=XT()+" Agora-SDK [".concat($u(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=XT()+" %cAgora-SDK [".concat($u(r),"]:");let a=[];if(!P("USE_NEW_LOG"))switch(r){case Ri.DEBUG:a=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,a);break;case Ri.INFO:a=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,a);break;case Ri.WARNING:a=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,a);break;case Ri.ERROR:a=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,a)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-dm<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-dm);const r=Math.max(0,Math.min(4,t[0]));t[0]=XT()+" Agora-SDK [".concat($u(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!P("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=y1()+" Agora-SDK [".concat($u(e),"]:"):n[0]=y1()+" Agora-SDK [".concat($u(e),"]:");let i="";n.forEach(a=>{typeof a=="object"&&(a=JSON.stringify(a)),i+="".concat(a," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:Ci,process_id:P("PROCESS_ID"),payload:JSON.stringify(e)};return Ro(async()=>{const n=await yr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(P("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(P("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const r=new Error("unexpected upload log response");throw r.response=n,r}},()=>(this.uploadLogUploadingList=[],!1),n=>{const r={status:-1,message:n.message,errorRange:e.map(i=>i.log_item_id)};return n.response?(r.status=n.response.status,r.data=n.response.data,r.headers=n.response.headers):n.request&&(r.status=n.request.status),v1.reportLogUploadError(r),!0},{timeout:P("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:P("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,P("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),P("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),P("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),P("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var C1;function uz(e){return Mn(e.reportId,"params.reportId",0,100,!1),Mn(e.category,"params.category",0,100,!1),Mn(e.event,"params.event",0,100,!1),Mn(e.label,"params.label",0,100,!1),St(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(C1={}).FREE="free",C1.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const hz={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Nn=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e}({}),Bt=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({}),function(e){e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}({});class eh{constructor(){Xt(this,"baseInfoMap",new Map),Xt(this,"proxyServer",void 0),Xt(this,"eventUploadTimer",void 0),Xt(this,"setSessionIdTimer",void 0),Xt(this,"url",void 0),Xt(this,"backupUrl",void 0),Xt(this,"_appId",void 0),Xt(this,"keyEventUploadPendingItems",[]),Xt(this,"normalEventUploadPendingItems",[]),Xt(this,"apiInvokeUploadPendingItems",[]),Xt(this,"apiInvokeCount",0),Xt(this,"ltsList",[]),Xt(this,"lastSendNormalEventTime",Date.now()),Xt(this,"customReportCounterTimer",void 0),Xt(this,"customReportCount",0),Xt(this,"extApiInvoke",async t=>{for(const n of t){const r=Fe(Fe({},n),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Kt.TRACER});this.sendApiInvoke(r)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),P("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),P("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}adjustSessionStartTime(t){if(!this.baseInfoMap.has(t)&&!this.baseInfoMap.get(t))return void T.error("adjust session ".concat(t," start time, sid is not exist or info is undefined"));const n=this.baseInfoMap.get(t),r=Date.now(),i=n.startTime;n.startTime=r,T.debug("rewrite session ".concat(t," startTime: ").concat(r," , ").concat(r-i,"ms")),this.baseInfoMap.set(t,n)}setAppId(t){this._appId=t}reportApiInvoke(t,n,r){n.timeout=n.timeout||6e4,n.reportResult=n.reportResult===void 0||n.reportResult;const i=Date.now();this.apiInvokeCount+=1;const a=this.apiInvokeCount,c=()=>({tag:n.tag,invokeId:a,sid:t,name:n.name,apiInvokeTime:i,options:n.options,states:n.states||null}),d=!!P("SHOW_REPORT_INVOKER_LOG");d&&T.info("".concat(n.name," start"),n.options);let u=!1;Rn(n.timeout).then(()=>{u||(this.sendApiInvoke(Fe(Fe({},c()),{},{error:O.API_INVOKE_TIMEOUT,success:!1})),T.debug("".concat(n.name," timeout")))});const p=new q(O.UNEXPECTED_ERROR,"".concat(n.name,": this api invoke is end"));return{onSuccess:f=>{const m=()=>{if(u)throw p;return u=!0,this.sendApiInvoke(Fe(Fe({},c()),{},{success:!0},n.reportResult&&{result:f})),d&&T.info("".concat(n.name," onSuccess")),f};return r?p1(m,n.name+"Success",r,()=>u=!0):m()},onError:f=>{const m=()=>{if(u)throw f;u=!0,this.sendApiInvoke(Fe(Fe({},c()),{},{success:!1,error:f})),d&&T.info("".concat(n.name," onFailure"),f.toString())};return r?p1(m,n.name+"Error",r,()=>u=!0):m()}}}sessionInit(t,n){if(this.baseInfoMap.has(t))return;const r=Date.now(),i=this.createBaseInfo(t,r);i.cname=n.cname;const a=Object.assign({},{willUploadConsoleLog:P("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:YT?"global":"oversea",areas:P("AREAS")&&P("AREAS").join(",")},n.extend),{stringUid:c,channelProfile:d,channelMode:u,isABTestSuccess:p,lsid:f,clientRole:m}=n,E=Date.now(),S=Fe(Fe({},i),{},{eventType:Nn.SESSION_INIT,appid:n.appid,browser:navigator.userAgent,buildFormat:n.buildFormat,build:JT,lts:E,elapse:E-r,extend:JSON.stringify(a),mode:n.mode,process:P("PROCESS_ID"),appType:P("APP_TYPE"),success:!0,version:Ci,stringUid:c,channelProfile:d,channelMode:u,isABTestSuccess:p,lsid:f,clientType:20,clientRole:m,serviceId:P("PROCESS_ID"),extensionID:P("PLUGIN_INFO").join(",")||"",preload:n.preload?1:0});this.send({type:Bt.SESSION,data:S},!0)}joinChooseServer(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe({},i),{},{eventType:Nn.JOIN_CHOOSE_SERVER,lts:a,eventElapse:n.elapse||a-n.lts,chooseServerAddr:n.csAddr,errorCode:n.ec,elapse:a-r.startTime,success:n.succ,chooseServerAddrList:JSON.stringify(n.serverList),uid:n.uid?parseInt(n.uid):null,cid:n.cid?parseInt(n.cid):null,chooseServerIp:n.csIp||"",opid:n.opid,unilbsServerIds:n.unilbsServerIds,extend:n.extend||void 0,isHttp3:n.isHttp3});this.send({type:Bt.JOIN_CHOOSE_SERVER,data:c},!0)}reqUserAccount(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe({},i),{},{eventType:Nn.REQ_USER_ACCOUNT,lts:a,success:n.success,serverAddress:n.serverAddr,stringUid:n.stringUid,uid:n.uid,errorCode:n.errorCode,elapse:n.elapse||a-r.startTime,eventElapse:a-n.lts,extend:JSON.stringify(n.extend)});this.send({type:Bt.REQ_USER_ACCOUNT,data:c},!0)}joinGateway(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info;n.vid&&(i.vid=n.vid),i.uid=n.uid,i.cid=n.cid;const a=Date.now(),{firstSuccess:c,avoidJoinStartTime:d,isProxy:u,addr:p}=n,f=a-(c&&d?d:r.startTime),m=Fe(Fe({},i),{},{eventType:Nn.JOIN_GATEWAY,lts:a,gatewayAddr:n.addr,success:n.succ,errorCode:n.ec,elapse:f,eventElapse:a-n.lts,firstSuccess:c,signalChannel:n.signalChannel}),E=m.success?1:0;if(n.succ&&(r.lastJoinSuccessTime=a),c)this.send({type:Bt.JOIN_GATEWAY,data:m},!0);else{let S;if(p)if(u){const v=p.match(/h=(\d{1,3}-){3}\d{1,3}/g),y=p.match(/p=[0-9]{1,6}/g);S={isSuccess:E,gatewayIp:v&&v.length?v[0].split("=")[1].replace(/-/g,"."):"",port:y&&y.length?y[0].split("=")[1]:"",isProxy:u?1:0}}else{const v=p.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),y=p.match(/(:|p=)[0-9]{1,6}/g);S={isSuccess:E,gatewayIp:v&&v.length?v[0].split("//")[1].replace(/-/g,"."):"",port:y&&y.length?y[0].split(/:|p=/g)[1]:"",isProxy:u?1:0}}else S={isSuccess:E,gatewayIp:"",port:"",isProxy:u?1:0};delete m.success,delete m.eventType,delete m.firstSuccess,m.vid=Number(m.vid);const I=Object.assign({},m,S,{eventType:Nn.REJOIN_GATEWAY});this.send({type:Bt.RE_JOIN_GATEWAY,data:I},!0)}}joinChannelTimeout(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=Date.now(),a=Fe(Fe({},r.info),{},{lts:i,timeout:n,elapse:i-r.startTime});this.send({type:Bt.JOIN_CHANNEL_TIMEOUT,data:a},!0)}publish(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe({},i),{},{eventType:Nn.PUBLISH,lts:a,eventElapse:n.eventElapse,elapse:a-r.startTime,success:n.succ,errorCode:n.ec,videoName:n.videoName,audioName:n.audioName,screenName:n.screenName,screenshare:n.screenshare,audio:n.audio,video:n.video,p2pid:n.p2pid,publishRequestid:n.publishRequestid});this.send({type:Bt.PUBLISH,data:c},!0)}subscribe(t,n,r){const i=this.baseInfoMap.get(t);if(!i)return;const a=i.info,c=Date.now(),d=Fe(Fe({},a),{},{eventType:Nn.SUBSCRIBE,lts:c,eventElapse:n.eventElapse,elapse:c-i.startTime,success:n.succ,errorCode:n.ec,video:n.video,audio:n.audio,subscribeRequestid:n.subscribeRequestid,p2pid:n.p2pid},r&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof n.peerid=="string"?d.peerSuid=n.peerid:d.peer=n.peerid,this.send({type:Bt.SUBSCRIBE,data:d},!0)}wsCompressorInit(t){var n;const r=[...ni(n=this.baseInfoMap).call(n)],i=r.length?r[0]:"UnableToGetSid",a=this.baseInfoMap.get(i);if(!a)return;const c=a.info,d=Date.now(),u=Fe(Fe({},c),{},{eventType:Nn.WS_COMPRESSOR_INIT,lts:d,eventElapse:t.eventElapse,elapse:d-a.startTime,status:t.status?1:2});this.send({type:Bt.WS_COMPRESSOR_INIT,data:u},!0)}firstRemoteVideoDecode(t,n,r,i){const a=this.baseInfoMap.get(t);if(!a)return;const c=a.info,d=Date.now(),u=Fe(Fe(Fe({},c),i),{},{elapse:d-a.startTime,eventType:n,lts:d,firstDecodeFrame:Math.max(d-a.startTime,0),apEnd:Math.max(i.apEnd-a.startTime,0),apStart:Math.max(i.apStart-a.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-a.startTime,0),joinGwStart:Math.max(i.joinGwStart-a.startTime,0),pcEnd:Math.max(i.pcEnd-a.startTime,0),pcStart:Math.max(i.pcStart-a.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-a.startTime,0),subscriberStart:Math.max(i.subscriberStart-a.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-a.startTime,0)});this.send({type:r,data:u},!0)}firstRemoteFrame(t,n,r,i){const a=this.baseInfoMap.get(t);if(!a)return;const c=a.info,d=Date.now(),u=Fe(Fe(Fe({},c),i),{},{elapse:d-a.startTime,eventType:n,lts:d});this.send({type:r,data:u},!0)}pcStats(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe(Fe({},i),n),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:a-r.startTime,eventType:Nn.PC_STATS,lts:a});this.send({type:Bt.PC_STATS,data:c},!0)}updateRemoteRTPCapabilities(t,n){if(t){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe(Fe({},i),n),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:Nn.UPDATE_REMOTE_RTPCAPABILITIES,lts:a});this.send({type:Bt.UPDATE_REMOTE_RTPCAPABILITIES,data:c},!0)}}onGatewayStream(t,n,r,i){const a=this.baseInfoMap.get(t);if(!a)return;const c=a.info,d=Date.now(),u=Fe(Fe(Fe({},c),i),{},{eventType:n,lts:d});this.send({type:r,data:u},!0)}streamSwitch(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe({},i),{},{eventType:Nn.STREAM_SWITCH,lts:a,isDual:n.isdual,elapse:a-r.startTime,success:n.succ});this.send({type:Bt.STREAM_SWITCH,data:c},!0)}requestProxyAppCenter(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe({},i),{},{eventType:Nn.REQUEST_PROXY_APPCENTER,lts:a,eventElapse:a-n.lts,elapse:a-r.startTime,APAddr:n.APAddr,workerManagerList:n.workerManagerList,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:Bt.REQUEST_PROXY_APPCENTER,data:c},!0)}requestProxyWorkerManager(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe({},i),{},{eventType:Nn.REQUEST_PROXY_WORKER_MANAGER,lts:a,eventElapse:a-n.lts,elapse:a-r.startTime,workerManagerAddr:n.workerManagerAddr,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:Bt.REQUEST_PROXY_WORKER_MANAGER,data:c},!0)}setProxyServer(t){this.proxyServer=t,t?T.debug("reportProxyServerurl: ".concat(t)):T.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe({},i),{},{subscribeElapse:n.subscribeElapse,peer:n.peer,peerPublishDuration:Math.max(n.audioPublishDuration,n.videoPublishDuration),audiotag:n.audioPublishDuration>0?1:-1,videotag:n.videoPublishDuration>0?1:-1,lts:a,elapse:a-r.startTime,joinChannelSuccessElapse:a-(r.lastJoinSuccessTime||a),peerPublishDurationVideo:n.videoPublishDuration,peerPublishDurationAudio:n.audioPublishDuration});this.send({type:Bt.PEER_PUBLISH_STATUS,data:c},!0)}workerEvent(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now();(function(c,d,u){const p=c[d];if(!p||typeof p!="string")return[c];c[d]="";const f=os(JSON.stringify(c));let m=0;const E=[];let S=0;for(let I=0;I<p.length;I++)S+=p.charCodeAt(I)<=127?1:3,S<=u-f||(E[E.length]=Ce(Ce({},c),{},{[d]:p.substring(m,I)}),m=I,S=p.charCodeAt(I)<=127?1:3);return m!==p.length-1&&(E[E.length]=Ce(Ce({},c),{},{[d]:p.substring(m)})),E})(Fe(Fe(Fe({},i),n),{},{elapse:a-r.startTime,lts:a,productType:"WebRTC"}),"payload",1300).forEach(c=>this.send({type:Bt.WORKER_EVENT,data:c},!0))}apworkerEvent(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe(Fe({},i),n),{},{elapse:a-r.startTime,lts:a});this.send({type:Bt.AP_WORKER_EVENT,data:c},!0)}joinWebProxyAP(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe(Fe({},i),n),{},{elapse:a-r.startTime,lts:a,extend:n.extend||void 0});this.send({type:Bt.JOIN_WEB_PROXY_AP,data:c},!0)}WebSocketQuit(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe(Fe({},i),n),{},{elapse:a-r.startTime,lts:a});this.send({type:Bt.WEBSOCKET_QUIT,data:c},!0)}async sendCustomReportMessage(t,n){if(this.customReportCount+=n.length,this.customReportCount>P("CUSTOM_REPORT_LIMIT"))throw new q(O.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const r=Date.now(),i=n.map(a=>({type:Bt.USER_ANALYTICS,data:Fe(Fe({sid:t},a),{},{lts:r})}));try{P("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(a){throw T.error("send custom report message failed",a.toString()),new q(O.CUSTOM_REPORT_SEND_FAILED,a.message)}}sendApiInvoke(t){const n=P("NOT_REPORT_EVENT");if(t.tag&&le(n)&&le(n).call(n,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const r=this.baseInfoMap.get(t.sid);if(!r)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:i,uid:a,cid:c}=r.info;let d;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof q){const{code:p,message:f}=t.error;d=p||f||t.error.toString()}else d=t.error.toString();const u={invokeId:t.invokeId,sid:t.sid,cname:i,cid:c,uid:a,lts:t.lts,success:t.success,elapse:t.lts-r.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?d:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Bt.API_INVOKE,data:u},!1),!0}appendSessionId(){eh.__CLIENT_LIST__.forEach(t=>{if(t._sessionId){const n=this.apiInvokeUploadPendingItems.length;for(let r=0;r<n;r++){const i=this.apiInvokeUploadPendingItems.shift();i&&(i.sid=t._sessionId,this.sendApiInvoke(Object.assign({},i)))}}})}send(t,n){if(n)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>P("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,n){const r=[],i=[];for(;t.length;){const c=t.shift();r.length<20?r.push(c):i.push(c)}t.push(...i);for(const c of[...r]){var a;this.ltsList.indexOf(c.data.lts)!==-1?(c.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(c.data.lts)):(this.ltsList.push(c.data.lts),ku(a=this.ltsList).call(a,(d,u)=>d-u))}return n||(this.lastSendNormalEventTime=Date.now()),P("ENABLE_EVENT_REPORT")&&r.length&&(P("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch((c=>d=>{P("EVENT_REPORT_RETRY")&&(n?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(c):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(c),this.normalEventUploadPendingItems.length>P("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-P("NORMAL_EVENT_QUEUE_CAPACITY")),T.warning("report: drop normal events"))))})(r)),t}async postDataToStatsCollector2(t){zt.networkState===pr.OFFLINE&&await ae.race([zt.onlineWaiter,Rn(2*on.maxRetryTimeout)]);const n=a=>{let c=new Uint8Array;return a.forEach(d=>{const u=FT(JSON.stringify(d.data)),p=new ArrayBuffer(5),f=(E=>{let S=0;return Object.entries(Bt).forEach(I=>{let[v,y]=I;y===E.type&&(S=EventNameToID[v])}),S})(d),m=new DataView(p);m.setUint16(0,u.byteLength,!0),m.setUint8(2,255&f),m.setUint8(3,f>>>8&255),m.setUint8(4,f>>>16&255),c=r1(c,new Uint8Array(p)),c=r1(c,u)}),c},r="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(P("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat(P("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r);for(let a=0;a<2;a+=1){a===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(P("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat(P("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r));try{await zT(i,{timeout:1e4,data:n(t),headers:Fe(Fe({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(c){if(a===1)throw c;continue}return}}async postDataToStatsCollector(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(c=>JSON.stringify(c)),vid:(c=>{const d=c&&c.data.sid&&this.baseInfoMap.get(c.data.sid);return d&&d.info.vid&&+d.info.vid||0})(t[0])};zt.networkState===pr.OFFLINE&&await ae.race([zt.onlineWaiter,Rn(2*on.maxRetryTimeout)]);const i=n?"/events/proto-raws":"/events/messages";let a=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(P("EVENT_REPORT_DOMAIN"),"&p=").concat(P("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(P("EVENT_REPORT_DOMAIN"),":").concat(P("STATS_COLLECTOR_PORT")).concat(i));for(let c=0;c<2;c+=1){c===1&&(a=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(P("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(P("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(P("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(P("STATS_COLLECTOR_PORT")).concat(i)));try{n?await sz(a,{timeout:1e4,data:r}):await zT(a,{timeout:1e4,data:r})}catch(d){if(c===1)throw d;continue}return}}createBaseInfo(t,n){const r=Object.assign({},hz);return r.sid=t,this.baseInfoMap.set(t,{info:r,startTime:n}),r}reportResourceTiming(t,n){const r=performance.getEntriesByName(t),i=r[r.length-1];i&&this.reportApiInvoke(n,{name:"Client.resourceTiming",options:i,tag:Kt.TRACER}).onSuccess()}}function be(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,r){const i=r.value;if(typeof i=="function"){const a=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var c=arguments.length,d=new Array(c),u=0;u<c;u++)d[u]=arguments[u];let p=d;if(e.argsMap)try{p=e.argsMap(this,...d)}catch(m){T.warning(m),p=[]}try{JSON.stringify(p)}catch{T.warning("arguments for method ".concat(a,".").concat(String(n)," not serializable for apiInvoke.")),p=[]}const f=(e.report||ye).reportApiInvoke(this._sessionId||null,{name:"".concat(a,".").concat(String(n)),options:p,tag:Kt.TRACER,reportResult:e.reportResult},e.throttleTime);try{const m=i.apply(this,d);return m instanceof ae?m.then(E=>(f.onSuccess(e.reportResult&&E),E)).catch(E=>{throw f.onError(E),E}):(f.onSuccess(e.reportResult&&m),m)}catch(m){throw f.onError(m),m}}}return r}}Xt(eh,"__CLIENT_LIST__",[]);const ye=new eh;v1.on("REPORT_LOG_UPLOAD",e=>{e.networkState=zt.networkState,ye.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Kt.TRACER}).onSuccess("logUploadError")});const pz=["CHINA","GLOBAL"],Wn=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let d=0;d<6;d++)i.push("1");const a=i.join(""),c={};return c[e]=r,c[t]=a,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Wn,YT||(_n.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],_n.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],_n.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],_n.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],_n.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],_n.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],_n.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",_n.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",_n.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",_n.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",_n.AREAS=["NORTH_AMERICA","OVERSEA"]);const R1=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],_a=[];function Ic(e,t){return!!t&&_a.some(n=>n.uid===e&&n.channelName===t)}eh.__CLIENT_LIST__=_a;var fz=Zb.forEach,w1=Qp("forEach")?[].forEach:function(e){return fz(this,e,arguments.length>1?arguments[1]:void 0)};At({target:"Array",proto:!0,forced:[].forEach!=w1},{forEach:w1});var mz=Gi("Array").forEach,_z=Zo,Ez=qn,gz=W,Sz=mz,QT=Array.prototype,Tz={DOMTokenList:!0,NodeList:!0},vz=function(e){var t=e.forEach;return e===QT||gz(QT,e)&&t===QT.forEach||Ez(Tz,_z(e))?Sz:t},yz=_(vz),Cz=Qo,I1=nf;At({target:"Object",stat:!0,forced:g(function(){I1(1)})},{keys:function(e){return I1(Cz(e))}});var A1=_(To.Object.keys),Rz=_(Sw),wz=At,Iz=Uu,Az=x([].reverse),b1=[1,2];wz({target:"Array",proto:!0,forced:String(b1)===String(b1.reverse())},{reverse:function(){return Iz(this)&&(this.length=this.length),Az(this)}});var bz=Gi("Array").reverse,Oz=W,Nz=bz,ZT=Array.prototype,Dz=function(e){var t=e.reverse;return e===ZT||Oz(ZT,e)&&t===ZT.reverse?Nz:t},O1=Dz,Pz=_(O1),Lz=At,N1=Uu,kz=mf,Mz=ti,D1=vg,xz=Is,Uz=ta,Vz=bf,jz=rn,Fz=tS,Bz=Gb("slice"),Gz=jz("species"),$T=Array,Wz=Math.max;Lz({target:"Array",proto:!0,forced:!Bz},{slice:function(e,t){var n,r,i,a=Uz(this),c=xz(a),d=D1(e,c),u=D1(t===void 0?c:t,c);if(N1(a)&&(n=a.constructor,(kz(n)&&(n===$T||N1(n.prototype))||Mz(n)&&(n=n[Gz])===null)&&(n=void 0),n===$T||n===void 0))return Fz(a,d,u);for(r=new(n===void 0?$T:n)(Wz(u-d,0)),i=0;d<u;d++,i++)d in a&&Vz(r,i,a[d]);return r.length=i,r}});var Hz=Gi("Array").slice,Kz=W,zz=Hz,ev=Array.prototype,Yz=function(e){var t=e.slice;return e===ev||Kz(ev,e)&&t===ev.slice?zz:t},qz=_(Yz);function se(e,t,n,r,i){var a,c,d,u={};return yz(a=A1(r)).call(a,function(p){u[p]=r[p]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=Rz(c=Pz(d=qz(n).call(n)).call(d)).call(c,function(p,f){return f(e,t,p)||p},u),i&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(i):void 0,u.initializer=void 0),u.initializer===void 0&&(Vb(e,t,u),u=null),u}var Jz=Gi("Array").values,Xz=Zo,Qz=qn,Zz=W,$z=Jz,tv=Array.prototype,eY={DOMTokenList:!0,NodeList:!0},tY=function(e){var t=e.values;return e===tv||Zz(tv,e)&&t===tv.values||Qz(eY,Xz(e))?$z:t},wo=_(tY);let nY=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),ii=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({}),lm=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),nv=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),zi=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),fr=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Ae=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Ye=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),_e=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e}({}),Re=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),Ac=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Ue=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),mr=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Le=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});class B extends q{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),w(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,T)}throw(){super.throw(T)}}function um(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw T.error("Invalid Channel Name ".concat(e)),new B(O.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function hm(e){if(!function(t){return typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295}(e)&&!$N(e,1,255))throw new B(O.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof e=="string"&&T.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Dn=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming",e}({}),Jd=function(e){return e[e.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",e[e.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",e[e.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",e[e.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",e[e.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",e[e.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",e[e.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",e[e.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",e[e.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN",e}({});const rY={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},rv={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function iv(e,t){Mn(e.url,"".concat(t,".url"),1,1e3,!1),Ht(e.x)||St(e.x,"".concat(t,".x"),0,1e4),Ht(e.y)||St(e.y,"".concat(t,".y"),0,1e4),Ht(e.width)||St(e.width,"".concat(t,".width"),0,1e4),Ht(e.height)||St(e.height,"".concat(t,".height"),0,1e4),Ht(e.zOrder)||St(e.zOrder,"".concat(t,".zOrder"),0,255),Ht(e.alpha)||St(e.alpha,"".concat(t,".alpha"),0,1,!1)}const iY={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},oY={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};let ss=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),pm=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),En=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function P1(e){if(!e.channelName)throw new B(O.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new B(O.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Mn(e.token,"info.token",1,2047),hm(e.uid),um(e.channelName),!0}let _r=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Ds=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Nr=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Xd=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),lt=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Qt=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_FAILBACK="datachannel_failback",e.RESET_SIGNAL="reset-signal",e}({}),th=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),wn=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),L1=function(e){return e[e.websocket=0]="websocket",e[e.datachannel=1]="datachannel",e}({}),ot=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const k1=[ot.AFRICA,ot.ASIA,ot.CHINA,ot.EUROPE,ot.GLOBAL,ot.INDIA,ot.JAPAN,ot.NORTH_AMERICA,ot.OCEANIA,ot.OVERSEA,ot.SOUTH_AMERICA];let Xn=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const fm={CHINA:{},ASIA:{CODE:Xn.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Xn.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Xn.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Xn.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Xn.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Xn.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Xn.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Xn.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Xn.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Xn.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Xn.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Xn.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Xn.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};YT&&(fm.CHINA={CODE:Xn.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let ov=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e}({});class M1 extends xt{constructor(t,n){super(),w(this,"onICEConnectionStateChange",void 0),w(this,"onConnectionStateChange",void 0),w(this,"onDTLSTransportStateChange",void 0),w(this,"onDTLSTransportError",void 0),w(this,"onICETransportStateChange",void 0),w(this,"onFirstAudioReceived",void 0),w(this,"onFirstVideoReceived",void 0),w(this,"onFirstAudioDecoded",void 0),w(this,"onFirstVideoDecoded",void 0),w(this,"onFirstVideoDecodedTimeout",void 0),w(this,"onSelectedLocalCandidateChanged",void 0),w(this,"onSelectedRemoteCandidateChanged",void 0),w(this,"getLocalVideoStats",void 0)}}class mm extends M1{constructor(t,n){super(t,n),w(this,"establishPromise",void 0)}}let Te=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),or=function(e){return e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY",e}({}),Ps=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),ne=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),ut=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Oe=function(e){return e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Yi=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),qi=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Pn=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Ea=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),hn=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e}({}),as=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),wi=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Io=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Qd=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Zt=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Zd=function(e){return e.ABORT="abort",e}({}),ga=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),sY=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const aY={[lm.ACCESS_POINT]:{[fr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[fr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[fr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[fr.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[fr.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[fr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[lm.UNILBS]:{[zi.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[zi.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[zi.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[zi.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[zi.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[zi.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[zi.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[zi.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[zi.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[zi.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[zi.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[zi.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[lm.STRING_UID_ALLOCATOR]:{[nv.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[nv.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[nv.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function $d(e){const t=aY[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===lm.ACCESS_POINT){const r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const cY={[Ae.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ae.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ae.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ae.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ae.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ae.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ae.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ae.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ae.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ae.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ae.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ae.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ae.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ae.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ae.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ae.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ae.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ae.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ae.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ae.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ae.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ae.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ae.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ae.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ae.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ae.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ae.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ae.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ae.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ae.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ae.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ae.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ae.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ae.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ae.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ae.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ae.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ae.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ae.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ae.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ae.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ae.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ae.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ae.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ae.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ae.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ae.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ae.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ae.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ae.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ae.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ae.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ae.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ae.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ae.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ae.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ae.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ae.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ae.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ae.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ae.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ae.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ae.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function bc(e){return cY[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function x1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function sv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?x1(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x1(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function U1(e){return e.every(t=>t.readyState===WebSocket.CLOSED||t.readyState===WebSocket.CLOSING)}function V1(e,t){if(typeof e=="string")return e;const{proxy:n,host:r,port:i}=e;if(t){const a=P("JOIN_GATEWAY_FALLBACK_PORT")||443;return a===443?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(a,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const dY=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,lY=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,uY=/wss:\/\/(.+):([0-9]+)\/?/,hY=/wss:\/\/(.[^\/]+)\/?/;let pY=0;class fY{constructor(t,n){w(this,"id",0),w(this,"store",void 0),w(this,"recordIndex",void 0),w(this,"websockets",[]),w(this,"try443PortDuration",2e3),w(this,"forceCloseWSDuration",5e3),w(this,"try443PortTimeout",null),w(this,"forceCloseTimeout",null),w(this,"isTry443PortFailed",!1),w(this,"isNormalPortFailed",!1),w(this,"useDoubleDomain",!1),w(this,"useProxy",!1),w(this,"startTime",Date.now()),this.id=++pY,this.try443PortDuration=P("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var t;const n=Date.now()-this.startTime;for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];T.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...i)}createWebSocket(t,n,r){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:r});const i=P("GATEWAY_DOMAINS"),a=Date.now(),c=[],d=i.find(f=>{var m;return le(m=t.host).call(m,f)});d||(this.useDoubleDomain=!1);const u=[];if(this.useDoubleDomain)i.forEach(f=>{u.push(V1(sv(sv({},t),{},{host:t.host.replace(d,f)}),n))});else{const f=sv({},t);if(n&&d){const m=i.find(E=>E!==d);m&&(f.host=f.host.replace(d,m))}u.push(V1(f,n))}try{u.forEach(f=>{const m=new WebSocket(f);m.binaryType="arraybuffer",c.push(m),this.logger("ws is connecting:",m.url)})}catch(f){if(this.logger("ws create failed"),c.forEach(m=>m.close()),c.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,r);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,r);throw new B(O.WS_ERR,"init websocket failed! Error: ".concat(f.toString()))}const p=qu();return this.store&&this.store.recordJoinChannelService({urls:c.map(f=>f.url),service:"gateway"},this.recordIndex),c.forEach(f=>{f.onopen=()=>{this.logger("onopen: ws ".concat(f.url," open cost ").concat(Date.now()-a,"ms")),this.websockets.forEach(m=>{m!==f&&(m.onopen=null,m.onclose=null,m.onmessage=null,m.close(),this.logger("close backup websocket: ".concat(m.url)))}),this.websockets.length=0,p.resolve(f)},f.onclose=m=>{this.logger("onclose: ws ".concat(f.url," closed cost ").concat(Date.now()-a,"ms state: ").concat(f.readyState)),n?this.isTry443PortFailed=U1(c):this.isNormalPortFailed=U1(c),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(n&&this.isTry443PortFailed||!n&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(m.reason)),p.reject({code:m.code,reason:th.A_ROUND_WS_FAILED}))},f.onmessage=m=>this.logger("".concat(f.url," onmessage: ").concat(m.data))}),this.websockets.push(...c),r||(()=>{const f=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",p.isResolved),this.websockets.forEach(m=>m.readyState!==WebSocket.OPEN&&m.close())};if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(f,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",p.isResolved),p.isResolved)return f();tt().os===yn.MAC_OS&&yt()&&f(),this.createWebSocket(t,!0,!0).then(m=>p.resolve(m)).catch(m=>{this.isNormalPortFailed&&p.reject(m),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(f,this.forceCloseWSDuration)},this.try443PortDuration)})(),p.promise}chooseBestWebsocket(t,n,r,i){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(a){let c,d,u;return[,c,d,u]=a.match(dY)||[],c||([,d,u]=a.match(lY)||[]),d&&u||([,d,u]=a.match(uY)||[]),d&&u||([,d]=a.match(hY)||[]),d||T.warning("un-destructible url: ",a),{proxy:c,host:d,port:u||"443"}}(t)),this.recordIndex=i,this.useProxy=!!t.proxy,r&&this.useProxy&&(T.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(t,!!r,!1).finally(()=>this.clearTimeout())}}function j1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class F1 extends xt{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;le(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Le.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Le.CONNECTED):this._state==="closed"?this.emit(Le.CLOSED):this._state==="failed"&&this.emit(Le.FAILED))}resetReconnectCount(t){T.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],a=arguments.length>4&&arguments[4]!==void 0&&arguments[4],c=arguments.length>5?arguments[5]:void 0;super(),w(this,"connectionID",0),w(this,"currentURLIndex",0),w(this,"urls",[]),w(this,"_reconnectMode","tryNext"),w(this,"reconnectReason",void 0),w(this,"_initMutex",new On("websocket")),w(this,"name",void 0),w(this,"_state","closed"),w(this,"reconnectInterrupter",void 0),w(this,"websocket",void 0),w(this,"retryConfig",void 0),w(this,"reconnectCount",0),w(this,"forceCloseTimeout",5e3),w(this,"onlineReconnectListener",void 0),w(this,"useCompress",void 0),w(this,"tryDoubleDomain",!1),w(this,"use443PortOnly",!1),w(this,"wsInflateLength",0),w(this,"wsDeflateLength",0),w(this,"closeEstablishingWs",()=>{}),w(this,"store",void 0),w(this,"joinGatewayRecordIndex",void 0),this.store=c,this.name=t,this.retryConfig=function(m){for(var E=1;E<arguments.length;E++){var S=arguments[E]!=null?arguments[E]:{};E%2?j1(Object(S),!0).forEach(function(I){w(m,I,S[I])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(S)):j1(Object(S)).forEach(function(I){Object.defineProperty(m,I,Object.getOwnPropertyDescriptor(S,I))})}return m}({},n),this.useCompress=r,this.tryDoubleDomain=i,this.use443PortOnly=a;const{timeout:d,timeoutFactor:u}=n,p=Math.max(300,Math.floor(3*d/5)),f=Math.max(1.2,Math.floor(8*u)/10);pr.ONLINE&&(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=f),zt.on(vc.NETWORK_STATE_CHANGE,(m,E)=>{m!==E&&(this.resetReconnectCount("network state change: ".concat(E," -> ").concat(m)),m===pr.ONLINE?(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=f):(this.retryConfig.timeout=d,this.retryConfig.timeoutFactor=u))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=await this._initMutex.lock();this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{const i=qu(),a=this.urls[this.currentURLIndex];this.createWebSocketConnection(a).then(i.resolve).catch(i.reject),this.once(Le.CLOSED,()=>{i.reject(new q(O.WS_DISCONNECT))}),this.once(Le.CONNECTED,i.resolve),await i.promise}catch{}finally{r()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r=this.websocket;n?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void T.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),T.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new q(O.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new q(O.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const r=qu();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i=f=>{var m;(m=this.store)===null||m===void 0||m.signalChannelOpen(),T.debug("[".concat(this.name,"] websocket opened:"),f),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},a=async f=>{var m;if(T.debug("[".concat(this.name,"] websocket close ").concat((m=this.websocket)===null||m===void 0?void 0:m.url,", code: ").concat(f.code,", reason: ").concat(f.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new q(O.WS_DISCONNECT,"websocket close: ".concat(f.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=f.reason,this.state="reconnecting");const E=Kr(this,Le.WILL_RECONNECT,this.reconnectMode,f.reason)||this.reconnectMode,S=await this.reconnectWithAction(E);if(this.state==="closed")return void T.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!S)return r.reject(new q(O.WS_DISCONNECT,"websocket reconnect failed: ".concat(f.code))),this.close(!0);r.resolve()}},c=f=>{this.emit(Le.ON_MESSAGE,f)},d=f=>{T.warn("[".concat(this.connectionID,"] ws open error ").concat(f))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),P("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=P("GATEWAY_WSS_ADDRESS")),T.debug("[".concat(this.name,"] start connect, url:"),t);const u=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var p;const f=await this.chooseBestWebsocketConnection(t);this.websocket=f,i&&i(this.websocket.url),this.websocket.onclose=a,this.websocket.onmessage=c,this.websocket.onerror=d,(p=this.store)===null||p===void 0||p.recordJoinChannelService({endTs:Date.now(),status:"success"},u),this.joinGatewayRecordIndex=u}catch(f){const m=this.state==="closed",E=f instanceof q,S=E&&f.code===O.WS_ABORT,I=E&&f.code===O.WS_ERR,v=E?f.message:f&&(f.reason||f.toString());T.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(v)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:S?"aborted":"error",errors:[f]},u),m||I?(r.reject(m?new q(O.WS_DISCONNECT,"websocket is closed: ".concat(v)):new q(O.WS_ERR,"init websocket failed: ".concat(v))),I&&T.error("[".concat(this.name,"] init websocket failed: ").concat(v))):a&&a(f)}return r.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;T.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||zt.isOnline||!zt.onlineWaiter||(this.onlineReconnectListener=zt.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,n){const c=sm(this.reconnectCount,this.retryConfig);T.debug("[".concat(this.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(t)),await ae.race([Rn(c),this.onlineReconnectListener||new ae(()=>{})])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;const i=async(c,d)=>{this.emit(Le.RECONNECT_CREATE_CONNECTION,d),await this.createWebSocketConnection(c)};try{if(t==="retry")this.emit(Le.RECONNECT_WAITTING_FINISH,t),await i(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);T.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(Le.RECONNECT_WAITTING_FINISH,t),await i(this.urls[this.currentURLIndex],t)}else t==="recover"&&(T.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Le.RECONNECT_WAITTING_FINISH,t),this.urls=await un(this,Le.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],t))}catch(c){var a;T.error("[".concat(this.name,"] reconnect failed ").concat(c&&c.toString()));const d=c==null||(a=c.data)===null||a===void 0?void 0:a.desc;return Array.isArray(d)&&le(d).call(d,"dynamic key expired")?(this.emit(Le.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,n)}return!0}}class nh extends F1{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const r=qu(),i=function(c,d){return new fY(c,d)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),r.reject(new q(O.WS_ABORT,"choose best websocket aborted"))};const a=P("GATEWAY_DOMAINS");return T.debug("[choose-best-ws] currentDomain: ",t,", domains: ",a,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class rh extends F1{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new ae((r,i)=>{let a=!1;const c=[];this.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),c.forEach(I=>{I.onclose=null,I.onopen=null,I.onmessage=null,I.close()}),i(new q(O.WS_ABORT,"choose best websocket aborted"))};const d=P("GATEWAY_DOMAINS");let u;const p=t.indexOf("?h="),f=d.find(I=>p!==-1?le(t).call(t,I,p):le(t).call(t,I));T.debug("[choose-best-ws] currentDomain: ",f,", domains: ",d);let m=!this.tryDoubleDomain||!f;if(!m&&f){var E;const I=Date.now();try{d.forEach(v=>{const y=p===-1?t.replace(f,v):t.substr(0,p)+t.substr(p).replace(f,v),A=new WebSocket(y);A.binaryType="arraybuffer",c.push(A),T.debug("[choose-best-ws] ws is connecting:",A.url)})}catch{for(T.debug("[choose-best-ws] ws create failed, fallback to single url"),c.forEach(y=>y.close());c.length;)c.pop();m=!0}(E=this.store)===null||E===void 0||E.recordJoinChannelService({urls:c.map(v=>v.url),service:"gateway"},n),c.forEach(v=>{v.onopen=()=>{if(a)return;const y=Date.now()-I;T.debug("[choose-best-ws] ws open cost ".concat(y,"ms")),c.filter(A=>A!==v).forEach(A=>{T.debug("[choose-best-ws]close backup websocket: ".concat(A.url)),A.close()}),a=!0,r(v)},v.onclose=y=>{u=y,!a&&(c.find(A=>!(A.readyState===WebSocket.CLOSED||A.readyState===WebSocket.CLOSING))||(T.debug("[choose-best-ws] all websocket is closed"),a=!0,i(u)))},v.onmessage=y=>{T.debug("[choose-best-ws]".concat(v.url," onmessage: ").concat(y.data))}}),Rn(this.forceCloseTimeout).then(()=>{c.forEach(v=>{v.readyState!==WebSocket.OPEN&&v.close()})})}if(m){var S;let I;T.debug("[choose-best-ws] use single url: ",t),(S=this.store)===null||S===void 0||S.recordJoinChannelService({urls:[t],service:"gateway"},n);try{I=new WebSocket(t),c.push(I),I.binaryType="arraybuffer"}catch(v){const y=new q(O.WS_ERR,"init websocket failed! Error: ".concat(v.toString()));return T.error("[".concat(this.name,"]").concat(y)),void i(y)}I.onopen=()=>{r(I)},I.onclose=v=>{i(v)},I.onmessage=v=>{T.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(v.data))},Rn(this.forceCloseTimeout).then(()=>{I&&I.readyState!==WebSocket.OPEN&&I.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})}}class B1 extends xt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Ye.CONNECTED?this.emit(_e.WS_CONNECTED):t===Ye.RECONNECTING?this.emit(_e.WS_RECONNECTING,this._websocketReconnectReason):t===Ye.CLOSED&&this.emit(_e.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),w(this,"_disconnectedReason",void 0),w(this,"_websocketReconnectReason",void 0),w(this,"_connectionState",Ye.CLOSED),w(this,"reconnectToken",void 0),w(this,"websocket",void 0),w(this,"openConnectionTime",void 0),w(this,"clientId",void 0),w(this,"lastMsgTime",Date.now()),w(this,"uploadCache",[]),w(this,"uploadCacheInterval",void 0),w(this,"rttRolling",new HT(5)),w(this,"pingpongTimer",void 0),w(this,"wsInflateDataTimer",void 0),w(this,"pingpongTimeoutCount",0),w(this,"joinResponse",void 0),w(this,"multiIpOption",void 0),w(this,"initError",void 0),w(this,"spec",void 0),w(this,"store",void 0),w(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(_e.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const a="res-@".concat(i._id);this.emit(a,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===Ue.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Ue.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(qe.UID_BANNED);break;case 15:this.close(qe.IP_BANNED);break;case 16:this.close(qe.CHANNEL_BANNED)}if(i._type===Ue.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case Ae.ERR_LICENSE_MISSING:this.close(qe.LICENSE_MISSING);break;case Ae.ERR_LICENSE_EXPIRED:this.close(qe.LICENSE_EXPIRED);break;case Ae.ERR_LICENSE_MINUTES_EXCEEDED:this.close(qe.LICENSE_MINUTES_EXCEEDED);break;case Ae.ERR_LICENSE_PERIOD_INVALID:this.close(qe.LICENSE_PERIOD_INVALID);break;case Ae.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(qe.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ae.ERR_LICENSE_ILLEGAL:this.close(qe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new nh("gateway-".concat(this.clientId),this.spec.retryConfig,!0,P("JOIN_GATEWAY_USE_DUAL_DOMAIN"),P("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ye.CONNECTED&&this.reconnect("retry",Gn.OFFLINE)})}async request(t,n,r,i){const a=Rt(6,""),c={_id:a,_type:t,_message:n},d=this.websocket.connectionID,u=()=>new ae((I,v)=>{if(this.connectionState===Ye.CONNECTED)return I();const y=()=>{this.off(_e.WS_CLOSED,A),I()},A=()=>{this.off(_e.WS_CONNECTED,y),v(new B(O.WS_ABORT))};this.once(_e.WS_CONNECTED,y),this.once(_e.WS_CLOSED,A),t!==Re.PUBLISH&&t!==Re.PUBLISH_DATASTREAM&&t!==Re.SUBSCRIBE&&t!==Re.SUBSCRIBE_DATASTREAM&&t!==Re.UNSUBSCRIBE&&t!==Re.UNSUBSCRIBE_DATASTREAM&&t!==Re.UNPUBLISH&&t!==Re.UNPUBLISH_DATASTREAM&&t!==Re.CONTROL&&t!==Re.RESTART_ICE||this.once(_e.DISCONNECT_P2P,()=>{v(new B(O.DISCONNECT_P2P))}),t!==Re.PUBLISH&&t!==Re.RESTART_ICE||this.once(_e.ABORT_P2P_EXECUTION,()=>{v(new B(O.DISCONNECT_P2P))})});if(this.connectionState!==Ye.CONNECTING&&this.connectionState!==Ye.RECONNECTING||t===Re.JOIN||t===Re.REJOIN||await u(),this.websocket.sendMessage(c,!0),i)return;const p=new ae((I,v)=>{let y=!1;const A=(V,F)=>{y=!0,I({isSuccess:V==="success",message:F||{}}),this.off(_e.WS_CLOSED,N),this.off(_e.WS_RECONNECTING,N),this.emit(_e.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(a),A);const N=()=>{v(new B(O.WS_ABORT,"type: ".concat(t))),this.off(_e.WS_CLOSED,N),this.off(_e.WS_RECONNECTING,N),this.off("res-@".concat(a),A)};this.once(_e.WS_CLOSED,N),this.once(_e.WS_RECONNECTING,N),Rn(P("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==d||y||(T.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(_e.REQUEST_TIMEOUT,t,n))})});let f=null;try{f=await p}catch(I){if(this.connectionState===Ye.CLOSED||t===Re.LEAVE)throw new B(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?I.throw():t===Re.JOIN||t===Re.REJOIN?null:(await u(),await this.request(t,n))}if(f.isSuccess)return f.message;const m=Number(f.message.error_code||f.message.code),E=bc(m),S=new B(O.UNEXPECTED_RESPONSE,"".concat(E.desc,": ").concat(f.message.error_str),{code:m,data:f.message});return E.action==="success"?f.message:(T.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(m,", message: ").concat(E.desc,", action: ").concat(E.action)),m===Ae.ERR_TOO_MANY_BROADCASTERS?((t===Re.JOIN||t===Re.REJOIN)&&(this.initError=S,this.close()),S.throw()):E.action==="failed"?S.throw():E.action==="quit"?(this.initError=S,this.close(),S.throw()):(m===Ae.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Gn.MULTI_IP)):this.reconnect(E.action,Gn.SERVER_ERROR),t===Re.JOIN||t===Re.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new ae(r=>{const i=a=>{(!n||n(a))&&(this.off(t,i),r(a))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Ac.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const a=P("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ye.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},P("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}init(t,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ae((r,i)=>{this.once(_e.WS_CONNECTED,()=>r(this.joinResponse)),this.once(_e.WS_CLOSED,()=>i(this.initError||new B(O.WS_ABORT))),this.connectionState=Ye.CONNECTING,this.websocket.init(t).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||qe.LEAVE,this.connectionState=Ye.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===qe.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new nh("gateway-".concat(this.clientId),this.spec.retryConfig,!0,P("JOIN_GATEWAY_USE_DUAL_DOMAIN"),P("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(_e.ABORT_P2P_EXECUTION);const t=await un(this,_e.REQUEST_JOIN_INFO),n=await this.request(Re.JOIN,t);if(!n)return this.emit(_e.REPORT_JOIN_GATEWAY,th.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(_e.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ye.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new B(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=yc(this,_e.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(Re.REJOIN,t);return!!n&&(this.connectionState=Ye.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(Ue.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Ue.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Ue.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Ue.MUTE_AUDIO,{uid:r.uid}):this.emit(Ue.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Ue.MUTE_VIDEO,{uid:r.uid}):this.emit(Ue.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Ue.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Ue.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Ue.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Ue.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Ue.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){T.debug("[".concat(this.clientId,"] receive notification: "),t);const n=bc(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(qe.UID_BANNED),void this.close()):void this.reconnect(n.action,Gn.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=P("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(T.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>P("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Gn.TIMEOUT):this.request(Re.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),P("REPORT_STATS")&&this.send(Re.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(Ac.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Le.RECONNECT_WAITTING_FINISH,t=>{this.emit(_e.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(Le.RECONNECT_CREATE_CONNECTION,t=>{this.emit(_e.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Le.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Le.CLOSED,()=>{this.connectionState=Ye.CLOSED}),this.websocket.on(Le.FAILED,()=>{this._disconnectedReason=qe.NETWORK_ERROR,this.connectionState=Ye.CLOSED}),this.websocket.on(Le.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Ye.CONNECTED?this.connectionState=Ye.RECONNECTING:this.connectionState=Ye.CONNECTING}),this.websocket.on(Le.WILL_RECONNECT,(t,n,r)=>{const i=yc(this,_e.IS_P2P_DISCONNECTED),a=i||t!=="retry";i&&t==="retry"&&(T.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=th.P2P_DISCONNECTED),a&&(T.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(_e.REPORT_JOIN_GATEWAY,n||th.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(_e.NEED_RENEW_SESSION,this.websocket.currentURLIndex>=this.websocket.urls.length-1?"recover":t),this.emit(_e.DISCONNECT_P2P)),r(t)}),this.websocket.on(Le.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{T.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Gn.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(_e.REPORT_JOIN_GATEWAY,t.message||t.code||th.UNKNOWN_REASON,this.url||""),t instanceof B){if(t.code===O.UNEXPECTED_RESPONSE&&t.data.code===Ae.ERR_NO_AUTHORIZED)return this.initError=new B(O.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Gn.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Gn.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(Le.REQUEST_NEW_URLS,(t,n)=>{un(this,_e.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Le.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}let sn=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function G1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function _m(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?G1(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G1(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Sa(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(P("TURN_DOMAIN")):(T.info("Unidentified as ip: ".concat(e,", use as host")),e)}function av(e,t){e.addresses||(e.addresses=[]);const n=function(a,c){if(P("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return a.map(p=>{let{ip:f,port:m}=p;return{address:"".concat(f,":").concat(m)}});const d=P("GATEWAY_DOMAINS");let u=d[1]&&le(c).call(c,d[1])?1:0;return a.map(p=>{let{domain_prefix:f,port:m,ip:E}=p;if(f)return{address:"".concat(f,".").concat(d[u++%d.length],":").concat(m)};const S=/^[\.\:\d]+$/.test(E),I=S?"".concat(E.replace(/[^\d]/g,"-"),".").concat(d[u++%d.length],":").concat(m):"".concat(E,":").concat(m);return S||T.info("Unidentified as ip: ".concat(E,", use as host")),{ip:E,port:m,address:I}})}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&typeof r=="string"){const a=r.split(";");for(let c=0;c<a.length;c++){var i;const d=ir(i=a[c]).call(i);n[c]&&d&&(n[c].ip6=d)}}return{gatewayAddrs:n,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Dr(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function W1(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(Dr(t.width),"x").concat(Dr(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function H1(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function ih(e,t){let n,r,i;switch(t){case sn.CHOOSE_SERVER:r=4096,i="choose server";break;case sn.CLOUD_PROXY:r=1048576,i="proxy";break;case sn.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case sn.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new B(O.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(a=>{a.buffer&&a.buffer.flag===r&&(n={code:a.buffer.code,addresses:(a.buffer.edges_services||[]).map(c=>_m(_m({},c),{},{ticket:a.buffer.cert})),server_ts:e.enter_ts,uid:a.buffer.uid,cid:a.buffer.cid,cname:a.buffer.cname,detail:_m(_m({},a.buffer.detail),e.detail),flag:a.buffer.flag,opid:e.opid,cert:a.buffer.cert})}),!n)throw new B(O.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function K1(e,t){return await ae.all(e.addresses.map(async n=>({address:Sa(n.ip),tcpport:n.port,udpport:n.port,username:t&&P("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Wn.username,password:t&&P("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await BT(t.toString()):Wn.password})))}function cv(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,i=t.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(Dr(e.height),Dr(e.width)),1):(T.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Ta(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:a,protocol:c}=e;return r==="local-candidate"?{candidateType:t,relayProtocol:n,protocol:c}:{candidateType:t,relayProtocol:n,address:i,port:a,protocol:c}}function z1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class mY extends xt{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;le(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(hn.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(hn.CONNECTED):this._state==="closed"?this.emit(hn.CLOSED):this._state==="failed"&&this.emit(hn.FAILED))}constructor(t,n,r,i){super(),w(this,"connectionID",0),w(this,"currentURLIndex",0),w(this,"reconnectReason",void 0),w(this,"_reconnectMode","tryNext"),w(this,"_initMutex",void 0),w(this,"_name",void 0),w(this,"_state","closed"),w(this,"_reconnectInterrupter",void 0),w(this,"_url",void 0),w(this,"_retryConfig",void 0),w(this,"_reconnectCount",0),w(this,"_forceCloseTimeout",5e3),w(this,"_onlineReconnectListener",void 0),w(this,"_closeEstablishingTransmitter",()=>{}),w(this,"_store",void 0),w(this,"_joinChannelServiceRecordIndex",void 0),w(this,"_transmitter",void 0),w(this,"_useCompress",void 0),w(this,"_inflateLength",0),w(this,"_deflateLength",0),this._store=i,this._name=t,this._retryConfig=function(a){for(var c=1;c<arguments.length;c++){var d=arguments[c]!=null?arguments[c]:{};c%2?z1(Object(d),!0).forEach(function(u){w(a,u,d[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(d)):z1(Object(d)).forEach(function(u){Object.defineProperty(a,u,Object.getOwnPropertyDescriptor(d,u))})}return a}({},n),this._useCompress=r}resetReconnectCount(t){T.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const r=this._transmitter;n?setTimeout(()=>r.close(),500):r.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,n){if(!this._transmitter)return void T.warning("[".concat(this._name,"] can not reconnect, no websocket"));var r;t!==void 0&&(this.reconnectMode=t),T.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((r=this._store)===null||r===void 0||r.recordJoinChannelService({status:"error",errors:[new Error(n)]},this._joinChannelServiceRecordIndex));const i=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),i&&i.bind(this._transmitter)({code:9999,reason:n})}getInflateData(){const t=this._inflateLength,n=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:n}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let Ao=function(e){return e[e.Default=0]="Default",e[e.Ack=1]="Ack",e}({});class _Y{constructor(t,n,r){w(this,"version",1),w(this,"initialRTO",void 0),w(this,"maxBatchAckCount",void 0),w(this,"maxRTO",void 0),w(this,"initialRTT",void 0),w(this,"ID",void 0),w(this,"rtt",void 0),w(this,"packetNumber",1),w(this,"rtoRatioMap",new Map),w(this,"timeoutMap",new Map),w(this,"unorderedPacketQueue",[]),w(this,"batchAckPacketQueue",[]),w(this,"lastOrderedPacketNumber",0),w(this,"batchAckTimer",void 0),w(this,"sendImpl",void 0),w(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=n,this.ID=Rt(7,"transmitter-"),this.initialRTO=(r==null?void 0:r.initialRTO)!==void 0?r.initialRTO:P("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(r==null?void 0:r.initialRTT)!==void 0?r.initialRTT:P("TRANSMITTER_INITIAL_RTT"),this.rtt=(r==null?void 0:r.initialRTT)!==void 0?r.initialRTT:P("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(r==null?void 0:r.maxBatchAckCount)!==void 0?r.maxBatchAckCount:P("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(r==null?void 0:r.maxRTO)!==void 0?r.maxRTO:P("TRANSMITTER_MAX_RTO")}packetize(t,n){return{type:Ao.Default,version:this.version,packetNumber:n,payload:t}}serialize(t){switch(t.type){case Ao.Default:{let n;typeof t.payload=="string"?n=new TextEncoder().encode(t.payload):n=t.payload;const r=new ArrayBuffer(n.length+15),i=new DataView(r);return i.setUint16(0,t.version),i.setUint8(2,t.type),i.setUint32(3,t.packetNumber),t1(i,7,BigInt(t.sendTs)),new Uint8Array(i.buffer).set(n,15),r}case Ao.Ack:{const n=new ArrayBuffer(16),r=new DataView(n);return r.setUint16(0,t.version),r.setUint8(2,t.type),r.setUint32(3,t.maxAckPacketNumber),r.setUint8(7,t.shift),t1(r,8,BigInt(t.ackSendTs)),n}}}deserialize(t){const n=new DataView(t),r=n.getUint16(0),i=n.getUint8(2);switch(i){case Ao.Default:{const a=n.getUint32(3),c=e1(n,7),d=t.slice(15),u=new TextDecoder().decode(d);return{version:r,type:i,packetNumber:a,sendTs:Number(c),payload:u}}case Ao.Ack:{const a=n.getUint32(3),c=n.getUint8(7),d=e1(n,8);return{version:r,type:i,maxAckPacketNumber:a,shift:c,ackSendTs:Number(d)}}default:throw T.error("[".concat(this.ID,"] Unrecognized packet type ").concat(i)),new Error("Unrecognized packet type ".concat(i))}}sendMessage(t){const n=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const r=this.calculateRTO(n),i=window.setTimeout(()=>{this.resendMessage(n)},r);this.timeoutMap.set(n.packetNumber,i),this.sendPacket(n)}onData(t){const n=this.deserialize(t);n.type===Ao.Default?this.ack(n):n.type===Ao.Ack&&(this.updateRTT(n,Math.round(performance.now())),this.clearRTO(n))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[n,r]=t;window.clearTimeout(r)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){const n=this.calculateRTO(t),r=window.setTimeout(()=>{this.resendMessage(t)},n);this.timeoutMap.set(t.packetNumber,r),this.sendPacket(t)}calculateRTO(t){const n=this.rtoRatioMap.get(t.packetNumber);if(n===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{const r=9*this.rtt/8*n;return this.rtoRatioMap.set(t.packetNumber,n+1),r>this.maxRTO?this.maxRTO:r}}updateRTT(t,n){const r=t.ackSendTs;this.rtt=this.rtt*(7/8)+(n-r-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){const n=this.unorderedPacketQueue[0];if(!n){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(n.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Ao.Ack,version:this.version};this.sendPacket(n)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Ao.Ack,version:this.version};this.sendPacket(n)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Ao.Ack,version:this.version};this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===Ao.Default&&(t.sendTs=Math.round(performance.now()));const n=this.serialize(t);this.sendImpl(n)}clearRTO(t){for(let n=t.maxAckPacketNumber-t.shift;n<=t.maxAckPacketNumber;n++){const r=this.timeoutMap.get(n);r!==void 0&&window.clearTimeout(r),this.timeoutMap.delete(n),this.rtoRatioMap.delete(n)}}}class Y1 extends mY{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),w(this,"_initMutex",void 0),w(this,"_reconnectInterrupter",void 0),w(this,"_url",void 0),w(this,"_transmitter",void 0),w(this,"_addresses",void 0),w(this,"_reliableTransmission",void 0),this._initMutex=new On("datachannel");const{timeout:r,timeoutFactor:i}=n,a=Math.max(300,Math.floor(3*r/5)),c=Math.max(1.2,Math.floor(8*i)/10);pr.ONLINE&&(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=c),zt.on(vc.NETWORK_STATE_CHANGE,(d,u)=>{d!==u&&(this.resetReconnectCount("network state change: ".concat(u," -> ").concat(d)),d===pr.ONLINE?(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=c):(this._retryConfig.timeout=r,this._retryConfig.timeoutFactor=i))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=n;const r=(i,a)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(d=>d.fingerprint||P("FINGERPRINT"));const c=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(c).then(i).catch(a),this.once(hn.CLOSED,()=>a(new B(O.WS_DISCONNECT))),this.once(hn.CONNECTED,()=>i())};return this._initMutex.lock().then(i=>new ae((a,c)=>{r(a,c)}).then(()=>{i()}).catch(()=>{i()}))}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new B(O.WS_ABORT,"datachannel is not ready");try{n||(t=JSON.stringify(t)),this._reliableTransmission.sendMessage(t)}catch(r){throw new B(O.WS_ERR,"send datachannel signal message error"+r.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){const n=JSON.stringify(t);return{compressed:n,compressedLength:n.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new ae((n,r)=>{var i;const a=()=>{T.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n()},c=async f=>{var m;if((m=this._closeEstablishingTransmitter)===null||m===void 0||m.call(this),T.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(f.code,", reason: ").concat(f.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=f.reason,this.state="reconnecting");const E=Kr(this,hn.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,S=await this.reconnectWithAction(E);if(this.state==="closed")return void T.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!S)return r(new B(O.WS_DISCONNECT,"datachannel reconnect failed: ".concat(f.code))),void this.close(!0);n()}else r(new B(O.WS_DISCONNECT,"datachannel close: ".concat(f.code))),this.close()},d=f=>{var m;(m=this._reliableTransmission)===null||m===void 0||m.onData(f.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),T.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));const u=(i=this._store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),p=Date.now();un(this,hn.TO_CONNECT_DATACHANNEL,t).then(f=>{var m,E;if(!f)throw new Error("transmissonInfo not exist yet");const{transmitter:S,close:I}=f;this._transmitter=S,(m=this._store)===null||m===void 0||m.signalChannelOpen();const v=Date.now()-p;T.debug("[choose dc] dc open cost ".concat(v,"ms")),this._reliableTransmission=new _Y(y=>{var A;this._transmitter&&this._transmitter.readyState==="open"&&((A=this._transmitter)===null||A===void 0||A.send(y))},y=>{typeof y=="string"&&this.emit(hn.ON_MESSAGE,y)}),this._closeEstablishingTransmitter=()=>{var y;(y=this._reliableTransmission)===null||y===void 0||y.close(),this._reliableTransmission=void 0,I()},a&&a(),S.onclose=c,S.onmessage=d,(E=this._store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:"success"},u),this._joinChannelServiceRecordIndex=u}).catch(f=>{var m;if((m=this._store)===null||m===void 0||m.recordJoinChannelService({endTs:Date.now(),status:f instanceof B&&f.code===O.WS_ABORT?"aborted":"error",errors:[f]},u),this.state!=="closed"){if(f instanceof B&&f.code===O.WS_ERR){const E=new B(O.WS_ERR,"init datachannel failed! Error: ".concat(f.toString()));return T.error("[".concat(this._name,"]").concat(E)),void r(E)}c&&c(f)}else r(new B(O.WS_DISCONNECT,"datachannel is closed: ".concat(f.toString())))})})}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||zt.networkState!==pr.OFFLINE||(this._onlineReconnectListener=zt.onlineWaiter&&zt.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let r=!0;if(this._reconnectInterrupter=()=>{r=!1},n){const d=sm(this._reconnectCount,this._retryConfig);T.debug("[".concat(this._name,"] wait ").concat(d,"ms to reconnect datachannel, mode: ").concat(t)),await ae.race([Rn(d),this._onlineReconnectListener||new ae(()=>{})])}if(this.state==="closed"||!r)return!1;this._reconnectCount+=1;const i=async(d,u)=>{this.emit(hn.RECONNECT_CREATE_CONNECTION,u),await this.createTransmitterConnection(d)};try{if(t==="retry"){const d=this._addresses[this.currentURLIndex];this.emit(hn.RECONNECT_WAITTING_FINISH,t),await i(d,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let u=this.currentURLIndex;u<this._addresses.length;u++){if(this._addresses[u].fingerprint||P("FINGERPRINT")){this.currentURLIndex=u;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return T.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);T.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const d=this._addresses[this.currentURLIndex];this.emit(hn.RECONNECT_WAITTING_FINISH,t),await i(d,t)}else t==="recover"&&(T.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(hn.RECONNECT_WAITTING_FINISH,t),this.emit(hn.FAILBACK));return!0}catch(d){var a,c;return T.error("[".concat(this._name,"] reconnect failed"),d.toString()),d!=null&&(a=d.data)!==null&&a!==void 0&&a.desc&&Array.isArray(d.data.desc)&&d.data.desc.length&&le(c=d.data.desc).call(c,"dynamic key expired")?(this.emit(hn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,n)}}}class Ls extends xt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Ye.CONNECTED?this.emit(_e.WS_CONNECTED):t===Ye.RECONNECTING?this.emit(_e.WS_RECONNECTING,this._websocketReconnectReason):t===Ye.CLOSED&&this.emit(_e.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),w(this,"_disconnectedReason",void 0),w(this,"_websocketReconnectReason",void 0),w(this,"_connectionState",Ye.CLOSED),w(this,"reconnectToken",void 0),w(this,"websocket",void 0),w(this,"openConnectionTime",void 0),w(this,"clientId",void 0),w(this,"lastMsgTime",Date.now()),w(this,"uploadCache",[]),w(this,"uploadCacheInterval",void 0),w(this,"rttRolling",new HT(5)),w(this,"pingpongTimer",void 0),w(this,"inflateDataTimer",void 0),w(this,"pingpongTimeoutCount",0),w(this,"joinResponse",void 0),w(this,"multiIpOption",void 0),w(this,"initError",void 0),w(this,"spec",void 0),w(this,"store",void 0),w(this,"onWebsocketMessage",r=>{if(r instanceof ArrayBuffer)return void this.emit(_e.ON_BINARY_DATA,r);const i=JSON.parse(r);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const a="res-@".concat(i._id);this.emit(a,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")&&(this.emit(i._type,i._message),i._type===Ue.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Ue.ON_USER_BANNED))switch(i._message.error_code){case 14:this.close(qe.UID_BANNED);break;case 15:this.close(qe.IP_BANNED);break;case 16:this.close(qe.CHANNEL_BANNED)}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new Y1("gateway-".concat(this.clientId),this.spec.retryConfig,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ye.CONNECTED&&this.reconnect("retry",Ea.OFFLINE)})}async request(t,n,r,i){const a=Rt(6,""),c={_id:a,_type:t,_message:n},d=this.websocket.connectionID,u=()=>new ae((I,v)=>{if(this.connectionState===Ye.CONNECTED)return I();const y=()=>{this.off(_e.WS_CLOSED,A),I()},A=()=>{this.off(_e.WS_CONNECTED,y),v(new B(O.WS_ABORT))};this.once(_e.WS_CONNECTED,y),this.once(_e.WS_CLOSED,A),t!==Re.PUBLISH&&t!==Re.SUBSCRIBE&&t!==Re.UNSUBSCRIBE&&t!==Re.UNPUBLISH&&t!==Re.CONTROL&&t!==Re.RESTART_ICE||this.once(_e.DISCONNECT_P2P,()=>{v(new B(O.DISCONNECT_P2P))}),t!==Re.PUBLISH&&t!==Re.RESTART_ICE||this.once(_e.ABORT_P2P_EXECUTION,()=>{v(new B(O.DISCONNECT_P2P))})});if(this.connectionState!==Ye.CONNECTING&&this.connectionState!==Ye.RECONNECTING||t===Re.JOIN||t===Re.REJOIN||await u(),t===Re.LEAVE&&(this.websocket.unbindDcCloseEventListener(),i=!0),this.websocket.sendMessage(c,!0,!1),i)return;const p=new ae((I,v)=>{let y=!1;const A=(V,F)=>{y=!0,I({isSuccess:V==="success",message:F||{}}),this.off(_e.WS_CLOSED,N),this.off(_e.WS_RECONNECTING,N),this.emit(_e.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(a),A);const N=()=>{v(new B(O.WS_ABORT,"type: ".concat(t))),this.off(_e.WS_CLOSED,N),this.off(_e.WS_RECONNECTING,N),this.off("res-@".concat(a),A)};this.once(_e.WS_CLOSED,N),this.once(_e.WS_RECONNECTING,N),Rn(P("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==d||y||(T.warning("dc request timeout, type: ".concat(t)),this.emit(_e.REQUEST_TIMEOUT,t,n))})});let f=null;try{f=await p}catch(I){if(this.connectionState===Ye.CLOSED||t===Re.LEAVE)throw new B(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?I.throw():t===Re.JOIN||t===Re.REJOIN?null:(await u(),await this.request(t,n))}if(f.isSuccess)return f.message;const m=Number(f.message.error_code||f.message.code),E=bc(m),S=new B(O.UNEXPECTED_RESPONSE,"".concat(E.desc,": ").concat(f.message.error_str),{code:m,data:f.message});return E.action==="success"?f.message:(T.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(m,", message: ").concat(E.desc,", action: ").concat(E.action)),m===Ae.ERR_TOO_MANY_BROADCASTERS?((t===Re.JOIN||t===Re.REJOIN)&&(this.initError=S,this.close()),S.throw()):E.action==="failed"?S.throw():E.action==="quit"?(this.initError=S,this.close(),S.throw()):(m===Ae.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ea.MULTI_IP)):this.reconnect(E.action,Ea.SERVER_ERROR),t===Re.JOIN||t===Re.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new ae(r=>{const i=a=>{(!n||n(a))&&(this.off(t,i),r(a))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Ac.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const a=P("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ye.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},P("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}init(t,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ae((r,i)=>{this.once(_e.WS_CONNECTED,()=>r(this.joinResponse)),this.once(_e.WS_CLOSED,()=>i(this.initError||new B(O.WS_ABORT))),this.connectionState=Ye.CONNECTING,this.websocket.init(t).catch(i),this.websocket.once(hn.FAILBACK,()=>{this.openConnectionTime===void 0&&i(new B(O.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{n&&this.openConnectionTime===void 0&&(T.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),i(new B(O.INIT_DATACHANNEL_TIMEOUT)))},P("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||qe.LEAVE,this.connectionState=Ye.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===qe.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Y1("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(_e.ABORT_P2P_EXECUTION);const t=await un(this,_e.DATACHANNEL_CONNECTING),n=await this.request(Re.JOIN,t);if(!n)return this.emit(_e.REPORT_JOIN_GATEWAY,O.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(_e.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ye.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new B(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=yc(this,_e.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(Re.REJOIN,t);return!!n&&(this.connectionState=Ye.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(Ue.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Ue.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Ue.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Ue.MUTE_AUDIO,{uid:r.uid}):this.emit(Ue.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Ue.MUTE_VIDEO,{uid:r.uid}):this.emit(Ue.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Ue.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Ue.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Ue.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Ue.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Ue.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){T.debug("[".concat(this.clientId,"] receive notification: "),t);const n=bc(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(qe.UID_BANNED),void this.close()):void this.reconnect(n.action,Ea.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=P("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(T.warning("PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>P("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ea.TIMEOUT):this.request(Re.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),P("REPORT_STATS")&&this.send(Re.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleInflateData(){const{inflateLength:t,deflateLength:n}=this.websocket.getInflateData();t!==0&&n!==0&&this.upload(Ac.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(hn.RECONNECT_WAITTING_FINISH,t=>{this.emit(_e.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(hn.RECONNECT_CREATE_CONNECTION,t=>{this.emit(_e.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(hn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(hn.CLOSED,()=>{this.connectionState=Ye.CLOSED}),this.websocket.on(hn.FAILED,()=>{this._disconnectedReason=qe.NETWORK_ERROR,this.connectionState=Ye.CLOSED}),this.websocket.on(hn.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Ye.CONNECTED?this.connectionState=Ye.RECONNECTING:this.connectionState=Ye.CONNECTING}),this.websocket.on(hn.WILL_RECONNECT,(t,n)=>{if(yc(this,_e.IS_P2P_DISCONNECTED)&&t==="retry")return T.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(_e.NEED_RENEW_SESSION),this.emit(_e.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(T.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(_e.NEED_RENEW_SESSION),this.emit(_e.DISCONNECT_P2P)),n(t)}),this.websocket.on(hn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{T.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Ea.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(_e.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof B&&t.code===O.UNEXPECTED_RESPONSE&&t.data.code===Ae.ERR_NO_AUTHORIZED)return T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Ea.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ea.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(hn.REQUEST_NEW_URLS,(t,n)=>{un(this,_e.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(hn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(hn.TO_CONNECT_DATACHANNEL,async(t,n,r)=>un(this,_e.DATACHANNEL_PRECONNECT,t).then(n).catch(r)),this.websocket.on(hn.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(_e.DATACHANNEL_FAILBACK)})}}class Oc extends xt{constructor(t,n){super(),w(this,"signal",void 0),w(this,"token",void 0),w(this,"tokenTimeout",void 0),w(this,"tokenInterval",void 0),w(this,"_sequence",0),w(this,"userMap",new Map),w(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const r=()=>{this.signal.connectionState===Ye.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*P("P2P_TOKEN_INTERVAL"))};r()}async send(t,n,r,i,a){var c,d,u;if(this.userMap.size===0)return;const p=Array.from(wo(c=this.userMap).call(c))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),i=(d=i)!==null&&d!==void 0?d:Rt(6,""),a=(u=a)!==null&&u!==void 0?u:this._sequence++;const f={_id:i,_type:t,_seq:a,_message:n,token:"".concat(this.token,"_").concat(p)};P("SHOW_P2P_LOG")&&T.debug("send message",f,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(f)).forEach(E=>{this.signal.request(Re.DATA_STREAM,{payload:fa(this.encoder.encode(E))})});const m=new ae((E,S)=>{const I=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),v),this.off("res-@".concat(i),A),this.off(Zd.ABORT,y),T.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(i)),this.userMap.size===0?S(new q(O.INVALID_REMOTE_USER)):S(new q(O.TIMEOUT))},P("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),v=()=>{I&&window.clearTimeout(I),this.off(Zd.ABORT,y),r&&E()},y=()=>{I&&window.clearTimeout(I),this.off("res-@".concat(i,"_ack"),v),this.off("res-@".concat(i),A),S(new q(O.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(i)))};this.once(Zd.ABORT,y),this.once("res-@".concat(i,"_ack"),v);const A=(V,F)=>{N=!0,I&&window.clearTimeout(I),this.off("res-@".concat(i,"_ack"),v),this.off(Zd.ABORT,y),V==="success"?E(F):S(new q(O.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(i)))};let N=!1;r||(this.once("res-@".concat(i),A),Rn(P("SIGNAL_REQUEST_TIMEOUT")).then(()=>{N||T.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(i,", ").concat(f))}))});try{return await m}catch(E){if(E.code===O.TIMEOUT)return await this.send(t,n,r,i,a);throw E}}onMessage(t){var n;const{_uid:r}=t;let i,a=this.userMap.get(r);if(a)i=a.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Zt.CHECK)return;const{token:p}=t;i=new Map,a={uid:r,isStart:!0,token:p,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,a),this.signal.emit(Ue.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in t&&"total"in t){var c;const{id:p,total:f}=t,m=(c=i.get(p))!==null&&c!==void 0?c:[];if(m.push(t),i.has(p)||i.set(p,m),m.length!==f)return;{const E=ku(m).call(m,(S,I)=>S.index-I.index).map(S=>S.payload).join("");i.delete(p),(t=JSON.parse(E))._uid=r}}const{_type:d,token:u}=t;if(le(n=[Zt.ACK,Zt.CHECK]).call(n,d))return d===Zt.CHECK&&this.handleCheckToken(a,u),void this.receiveMessage(t);u==="".concat(a.token,"_").concat(this.token)?this.handleReceivedMessage(t):T.debug('Receive unexpected message", '.concat(u,", cur_token: ").concat(a.token,"_").concat(this.token),t)}check(){const t={_id:Rt(6,""),token:this.token,_type:Zt.CHECK};P("SHOW_P2P_LOG")&&T.debug("send message",t),this.signal.request(Re.DATA_STREAM,{payload:fa(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:Zt.ACK,token:this.token};P("SHOW_P2P_LOG")&&T.debug("send message",n),this.signal.request(Re.DATA_STREAM,{payload:fa(this.encoder.encode(JSON.stringify(n)))})}response(t,n,r){this.send(Zt.RESPONSE,JSON.stringify({success:!r,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(p=>{const{receivedMessagesMap:f,nextExpectedSequenceNumber:m}=p;for(;f.has(m);){const E=f.get(m);f.delete(m),this.receiveMessage(E),p.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:r,_seq:i}=t,a=this.userMap.get(r),{receivedMessagesMap:c,isStart:d,nextExpectedSequenceNumber:u}=a;if(i<u)return this.ack(t._id),void T.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(t._message));c.set(i,t),d&&i===u&&(this.receiveMessage(t),c.delete(u),a.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:r,_message:i,_uid:a}=t;if(P("SHOW_P2P_LOG")&&T.debug("receive message",t),n){let c;switch(t._type!==Zt.ACK&&(i&&(c=JSON.parse(i)),this.ack(t._id)),t._type){case Zt.CANDIDATE:case Zt.CONTROL:this.signal.emit(r,c,a);break;case Zt.PUBLISH:case Zt.UNPUBLISH:case Zt.RESTART_ICE:case Zt.CALL:c.uid=a,un(this.signal,r,c).then(d=>{this.response(t._id,d)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Zt.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Zt.RESPONSE:{const{success:d,message:u}=c;this.emit("res-@".concat(n),d?"success":"failed",u);break}}}}splitMessage(t){if(t.length<Oc.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:r}=JSON.parse(t),i=Rt(6,"");let a=0,c=800;const d=Math.ceil(t.length/c);for(;t.length>0;){a++;const u={id:i,index:a,total:d,payload:t.slice(0,c),token:"".concat(this.token,"_").concat(r)};JSON.stringify(u).length>Oc.MAX_MESSAGE_SIZE?c-=50:(n.push(u),t=t.slice(c))}return n.map(u=>JSON.stringify(u))}handleCheckToken(t,n){return t.token!==n?(T.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{T.debug("token timeout, ".concat(n)),this.reset(t.uid)},P("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await un(this.signal,Zt.CALL,void 0),n=await this.send(Zt.CALL,t);this.signal.emit(_e.P2P_CONNECTION,n,!0)}async reset(t,n){const r=this.userMap.get(t);r&&(this.emit(Zd.ABORT),this.signal.emit(Ue.ON_USER_OFFLINE,{uid:r.uid,reason:sY.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(T.debug("change local token from ".concat(n," to ").concat(n)),this.token=Rt(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Zd.ABORT)}}w(Oc,"MAX_SIZE",1),w(Oc,"MAX_MESSAGE_SIZE",1024);class q1 extends xt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Ye.CONNECTED?this.emit(_e.WS_CONNECTED):t===Ye.RECONNECTING?this.emit(_e.WS_RECONNECTING,this._websocketReconnectReason):t===Ye.CLOSED&&this.emit(_e.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),w(this,"_disconnectedReason",void 0),w(this,"_websocketReconnectReason",void 0),w(this,"_connectionState",Ye.CLOSED),w(this,"reconnectToken",void 0),w(this,"p2pToken",void 0),w(this,"websocket",void 0),w(this,"openConnectionTime",void 0),w(this,"clientId",void 0),w(this,"lastMsgTime",Date.now()),w(this,"uploadCache",[]),w(this,"uploadCacheInterval",void 0),w(this,"rttRolling",new HT(5)),w(this,"pingpongTimer",void 0),w(this,"pingpongTimeoutCount",0),w(this,"joinResponse",void 0),w(this,"multiIpOption",void 0),w(this,"initError",void 0),w(this,"spec",void 0),w(this,"store",void 0),w(this,"_external_signal",void 0),w(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(_e.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const a="res-@".concat(i._id);this.emit(a,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case Ue.ON_DATA_STREAM:return void this.handleDataStream(i._message);case Ue.MUTE_AUDIO:case Ue.MUTE_VIDEO:case Ue.ON_P2P_LOST:case Ue.ON_USER_ONLINE:return;case Ue.ON_USER_OFFLINE:const{uid:a}=i._message;return T.debug("[".concat(this.clientId,"] user-offline uid: ").concat(a)),void this._external_signal.reset(a)}if(this.emit(i._type,i._message),i._type===Ue.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Ue.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(qe.UID_BANNED);break;case 15:this.close(qe.IP_BANNED);break;case 16:this.close(qe.CHANNEL_BANNED)}if(i._type===Ue.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case Ae.ERR_LICENSE_MISSING:this.close(qe.LICENSE_MISSING);break;case Ae.ERR_LICENSE_EXPIRED:this.close(qe.LICENSE_EXPIRED);break;case Ae.ERR_LICENSE_MINUTES_EXCEEDED:this.close(qe.LICENSE_MINUTES_EXCEEDED);break;case Ae.ERR_LICENSE_PERIOD_INVALID:this.close(qe.LICENSE_PERIOD_INVALID);break;case Ae.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(qe.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ae.ERR_LICENSE_ILLEGAL:this.close(qe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new nh("gateway-".concat(this.clientId),this.spec.retryConfig,!0,P("JOIN_GATEWAY_USE_DUAL_DOMAIN"),P("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ye.CONNECTED&&this.reconnect("retry",Gn.OFFLINE)}),this.p2pToken=Rt(6,""),this._external_signal=new Oc(this,this.p2pToken)}async request(t,n,r,i){const a=Rt(6,""),c={_id:a,_type:t,_message:n},d=this.websocket.connectionID,u=()=>new ae((I,v)=>{if(this.connectionState===Ye.CONNECTED)return I();const y=()=>{this.off(_e.WS_CLOSED,A),I()},A=()=>{this.off(_e.WS_CONNECTED,y),v(new q(O.WS_ABORT))};this.once(_e.WS_CONNECTED,y),this.once(_e.WS_CLOSED,A)});if(this.connectionState!==Ye.CONNECTING&&this.connectionState!==Ye.RECONNECTING||t===Re.JOIN||t===Re.REJOIN||await u(),this.websocket.sendMessage(c,!0),i)return;const p=new ae((I,v)=>{let y=!1;const A=(V,F)=>{y=!0,I({isSuccess:V==="success",message:F||{}}),this.off(_e.WS_CLOSED,N),this.off(_e.WS_RECONNECTING,N),this.emit(_e.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(a),A);const N=()=>{v(new q(O.WS_ABORT,"type: ".concat(t))),this.off(_e.WS_CLOSED,N),this.off(_e.WS_RECONNECTING,N),this.off("res-@".concat(a),A)};this.once(_e.WS_CLOSED,N),this.once(_e.WS_RECONNECTING,N),Rn(P("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==d||y||(T.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(_e.REQUEST_TIMEOUT,t,n))})});let f=null;try{f=await p}catch(I){if(this.connectionState===Ye.CLOSED||t===Re.LEAVE)throw new q(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?I.throw():t===Re.JOIN||t===Re.REJOIN?null:(await u(),await this.request(t,n))}if(f.isSuccess)return f.message;const m=Number(f.message.error_code||f.message.code),E=bc(m),S=new q(O.UNEXPECTED_RESPONSE,"".concat(E.desc,": ").concat(f.message.error_str),{code:m,data:f.message});return E.action==="success"?f.message:(T.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(m,", message: ").concat(E.desc,", action: ").concat(E.action)),m===Ae.ERR_TOO_MANY_BROADCASTERS?((t===Re.JOIN||t===Re.REJOIN)&&(this.initError=S,this.close()),S.throw()):E.action==="failed"?S.throw():E.action==="quit"?(this.initError=S,this.close(),S.throw()):(m===Ae.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Gn.MULTI_IP)):this.reconnect(E.action,Gn.SERVER_ERROR),t===Re.JOIN||t===Re.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new ae(r=>{const i=a=>{(!n||n(a))&&(this.off(t,i),r(a))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Ac.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const a=P("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ye.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},P("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}async sendExtensionMessage(t,n,r){return await this._external_signal.send(t,n,r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ae((n,r)=>{this.once(_e.WS_CONNECTED,()=>n(this.joinResponse)),this.once(_e.WS_CLOSED,()=>r(this.initError||new q(O.WS_ABORT))),this.connectionState=Ye.CONNECTING,this.websocket.init(t).catch(r)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||qe.LEAVE,this.connectionState=Ye.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===qe.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new nh("gateway-".concat(this.clientId),this.spec.retryConfig,!0,P("JOIN_GATEWAY_USE_DUAL_DOMAIN"),P("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents()),this.p2pToken=Rt(6,""),this._external_signal.clear(),this._external_signal=new Oc(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(_e.ABORT_P2P_EXECUTION);const t=await un(this,_e.REQUEST_JOIN_INFO),n=await this.request(Re.JOIN,t);if(!n)return this.emit(_e.REPORT_JOIN_GATEWAY,O.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(_e.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ye.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleDataStream(t){try{var n;const r=Rc(t.payload),i=new TextDecoder().decode(r),a=JSON.parse(i);"total"in a&&"id"in a||le(n=Object.values(Zt)).call(n,a._type)?(a._uid=t.uid,this._external_signal.onMessage(a)):this.emit(Ue.ON_DATA_STREAM,t)}catch{this.emit(Ue.ON_DATA_STREAM,t)}}handleNotification(t){T.debug("[".concat(this.clientId,"] receive notification: "),t);const n=bc(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(qe.UID_BANNED),void this.close()):void this.reconnect(n.action,Gn.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=P("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(T.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>P("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Gn.TIMEOUT):this.request(Re.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),P("REPORT_STATS")&&this.send(Re.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(Le.RECONNECT_WAITTING_FINISH,t=>{this.emit(_e.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(Le.RECONNECT_CREATE_CONNECTION,t=>{this.emit(_e.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Le.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Le.CLOSED,()=>{this.connectionState=Ye.CLOSED}),this.websocket.on(Le.FAILED,()=>{this._disconnectedReason=qe.NETWORK_ERROR,this.connectionState=Ye.CLOSED}),this.websocket.on(Le.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Ye.CONNECTED?this.connectionState=Ye.RECONNECTING:this.connectionState=Ye.CONNECTING}),this.websocket.on(Le.WILL_RECONNECT,(t,n,r)=>{t!=="retry"?(T.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(_e.NEED_RENEW_SESSION)):T.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(t)}),this.websocket.on(Le.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(_e.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof q&&t.code===O.UNEXPECTED_RESPONSE&&t.data.code===Ae.ERR_NO_AUTHORIZED)return T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Gn.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Gn.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Le.REQUEST_NEW_URLS,(t,n)=>{un(this,_e.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Le.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function J1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ji(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?J1(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J1(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const dv=new Map;class EY extends xt{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Qt.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(Qt.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){T.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){super(),w(this,"store",void 0),w(this,"joinInfo",void 0),w(this,"key",void 0),w(this,"ntpOffset",0),w(this,"signal",void 0),w(this,"role",void 0),w(this,"inChannelInfo",{joinAt:null,duration:0}),w(this,"spec",void 0),w(this,"_state","DISCONNECTED"),w(this,"_statsCollector",void 0),w(this,"_disconnectedReason",void 0),w(this,"isSignalRecover",!1),w(this,"hasChangeBGPAddress",!1),w(this,"trafficStatsInterval",void 0),w(this,"networkQualityInterval",void 0),w(this,"_joinGatewayStartTime",0),w(this,"_signalTimeout",!1),w(this,"_clientRoleOptions",void 0),w(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?new q1(Ji(Ji({},n),{},{retryConfig:n.websocketRetryConfig}),t):this.store.useDataChannel?new Ls(Ji(Ji({},n),{},{retryConfig:n.websocketRetryConfig}),t):new B1(Ji(Ji({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,r){if(this.signal instanceof Ls){let u=!1;t.cloudProxyServer!=="disabled"?(T.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),u=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(T.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),u=!0):t.apResponse.addresses.some(p=>p.fingerprint)||P("FINGERPRINT")||(T.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),u=!0),u&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const i=Date.now();let a=dv.get(t.cname);if(a||(a=new Map,dv.set(t.cname,a)),this._isProactiveJoin=!0,a.has(t.uid)){const u=new B(O.UID_CONFLICT);throw ye.joinGateway(t.sid,{lts:i,succ:!1,ec:u.message,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:this.signal instanceof Ls?"1":"0"}),this._isProactiveJoin=!1,u}a.set(t.uid,!0),this.joinInfo=t,this.key=n;let c=0;this.joinGatewayStartTime=i;const d=t.proxyServer;try{let u;if(T.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof Ls?"datachannel":"websocket"," join uid ").concat(c)),this.signal instanceof Ls)u=await this.signal.init(t.apResponse.addresses,r);else{const p=t.gatewayAddrs.map(f=>{let{address:m}=f;const[E,S]=m.split(":"),I={host:E,port:S};return t.proxyServer&&(I.proxy=t.proxyServer),I});u=await this.signal.init(p,r)}c=u.uid,T.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof Ls?"datachannel":"websocket"," join uid ").concat(c," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(u){throw u&&u.code===O.INIT_WEBSOCKET_TIMEOUT?(T.warning("[".concat(this.store.clientId,"] User join failed"),u.toString()),u):u&&u.code===O.INIT_DATACHANNEL_TIMEOUT?(T.warning("[".concat(this.store.clientId,"] User join datachannel failed"),u.toString()),this.resetSignal(),u):(T.error("[".concat(this.store.clientId,"] User join failed"),u.toString()),ye.joinGateway(t.sid,{lts:i,succ:!1,ec:u.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!d,signalChannel:this.signal instanceof Ls?"1":"0"}),this._isProactiveJoin=!1,a.delete(t.uid),this.signal.close(),u)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),T.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(u=>{T.warning("[".concat(this.store.clientId,"] get traffic stats error"),u.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Qt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Qt.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Qt.NETWORK_QUALITY,{uplinkNetworkQuality:H1(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:H1(this._statsCollector.trafficStats.B_dnq)}):this.emit(Qt.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),c}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==qe.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Ye.CONNECTED||await function(r,i){return i===1/0?r:ae.race([r,iz(i)])}(this.signal.request(Re.LEAVE,void 0,!0),3e3)}catch(r){T.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(n),n!==qe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:P("PUB_EXTEND"),twcc:!!P("PUBLISH_TWCC"),rtx:!!P("USE_PUB_RTX")};try{return(await this.signal.request(Re.PUBLISH,i,!0))._message}catch(a){if(r&&a.data&&a.data.code===Ae.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),a.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw a}}async publishDataChannel(t,n,r){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const a={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(i=n.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(Re.PUBLISH_DATASTREAM,a,!0)}catch(c){if(r&&c.data&&c.data.code===Ae.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),c.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw c}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Re.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(r){T.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ae.all(t.map(n=>this.signal.request(Re.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){T.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!P("SUBSCRIBE_TWCC"),rtx:!!P("USE_SUB_RTX")||void 0,extend:P("SUB_EXTEND"),svc:Array.isArray(P("SVC"))&&P("SVC").length!==0?P("SVC"):void 0};try{return await this.signal.request(Re.PRE_SUBSCRIBE,i,!0)}catch(a){if(r&&a.data&&a.data.code===Ae.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),a.toString()),this.presubscribe(t,n,!1);throw a}}async subscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!P("SUBSCRIBE_TWCC"),rtx:!!P("USE_SUB_RTX"),extend:P("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(P("SVC"))&&P("SVC").length!==0?P("SVC"):void 0};try{return(await this.signal.request(Re.SUBSCRIBE,i,!0))._message}catch(a){if(r&&a.data&&a.data.code===Ae.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),a.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw a}}async subscribeDataChannel(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(Re.SUBSCRIBE_DATASTREAM,i,!0)}catch(a){if(r&&a.data&&a.data.code===Ae.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),a.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw a}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!P("USE_SUB_RTX"),twcc:!!P("SUBSCRIBE_TWCC"),svc:Array.isArray(P("SVC"))&&P("SVC").length!==0?P("SVC"):void 0};try{return await this.signal.request(Re.SUBSCRIBE_STREAMS,r,!0)}catch(i){if(n&&i.data&&i.data.code===Ae.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw i}}async setVideoProfile(t){const n=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let i=r.frameRate,a=r.width,c=r.height,d=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(d=!1)),typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(d=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,i||(d=!1)),d?{stream_type:0,width:a,height:c,fps:i,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(t);if(n)return this.signal.request(Re.SET_VIDEO_PROFILE,n);T.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(Re.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(r){T.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ae.all(t.map(r=>this.signal.request(Re.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:n},!0)))}catch(r){T.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(t){try{await this.signal.request(Re.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){T.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=t;return{gatewayEstablishParams:await this.signal.request(Re.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Re.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Re.RENEW_TOKEN,t),this.key=t.token}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),this.state!=="CONNECTED")return void(this.role=t);let r,i=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0,await this.signal.request(Re.SET_CLIENT_ROLE,{role:t,level:i,delay:r,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(Re.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Re.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(Re.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(Re.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Re.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,r){if(this.signal instanceof q1)return this.signal.sendExtensionMessage(t,n,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Ji({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Re.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=dv.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let r;return r=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:Wn.username,password:Wn.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Ji(Ji({},Wn),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(Re.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{const r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i=>i.peer_uid===n.peer_uid);r&&r.B_st!==n.B_st&&rm(()=>{this.emit(Qt.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new B(O.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let r=P("REPORT_APP_SCENARIO");if(typeof r!="string")try{r=JSON.stringify(r)}catch{r=void 0}r&&r.length>128&&(r=void 0);const i=Ji({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Ci,browser:navigator.userAgent,process_id:P("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:P("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:r,attributes:{userAttributes:{enablePublishedUserList:P("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:P("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof P("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?P("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof P("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?P("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof P("ENABLE_USER_LICENSE_CHECK")=="boolean"?P("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:P("USE_PUB_RTX")===!0||P("USE_SUB_RTX")===!0||void 0,disableFEC:P("DISABLE_FEC"),enableNTPReport:!!P("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!P("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:typeof P("ENABLE_DATASTREAM_2")=="boolean"?P("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!P("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:typeof P("USE_XR")=="boolean"?P("USE_XR"):void 0,enableLossbasedBwe:typeof P("ENABLE_LOSSBASED_BWE")=="boolean"?P("ENABLE_LOSSBASED_BWE"):void 0,enableAutCC:typeof P("ENABLE_AUT_CC")=="boolean"?P("ENABLE_AUT_CC"):void 0,enableCCFallback:typeof P("ENABLE_CC_FALLBACK")=="boolean"?P("ENABLE_CC_FALLBACK"):void 0}},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(i.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(i.aes_mode=this.joinInfo.aesmode,P("ENCRYPT_AES")?(i.aes_secret=this.joinInfo.aespassword,i.aes_encrypt=!0):i.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(i.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(i.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(i.default_video_stream=this.joinInfo.defaultVideoStream),i}getRejoinMessage(){if(!this.joinInfo)throw new B(O.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(_e.WS_RECONNECT_WAITTING_FINISH,t=>{var n;le(n=["tryNext","recover"]).call(n,t)&&this.joinInfo&&ye.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(_e.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(_e.WS_RECONNECTING,t=>{this.joinInfo&&ye.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Gn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",ye.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(_e.WS_CLOSED,t=>{let n;switch(t){case qe.LEAVE:n=Gn.LEAVE;break;case qe.UID_BANNED:case qe.IP_BANNED:case qe.CHANNEL_BANNED:case qe.SERVER_ERROR:n=Gn.SERVER_ERROR;break;case qe.FALLBACK:n=Gn.FALLBACK;break;case qe.LICENSE_MISSING:case qe.LICENSE_EXPIRED:case qe.LICENSE_MINUTES_EXCEEDED:case qe.LICENSE_PERIOD_INVALID:case qe.LICENSE_MULTIPLE_SDK_SERVICE:case qe.LICENSE_ILLEGAL:case qe.TOKEN_EXPIRE:n=t;break;default:n=Gn.NETWORK_ERROR}T.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Gn.NETWORK_ERROR)),this.joinInfo&&ye.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===qe.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==qe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(_e.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(T.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),ye.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Ls?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void T.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));Tt("EVENT_REPORT_DOMAIN",t[1]),Tt("EVENT_REPORT_BACKUP_DOMAIN",t[1]),Tt("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}),this.signal.on(Ue.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(_e.REQUEST_RECOVER,(t,n,r)=>{if(!this.joinInfo)return r(new B(O.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,un(this,Qt.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)}),this.signal.on(_e.REQUEST_JOIN_INFO,async t=>{var n;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const{iceParameters:r,dtlsParameters:i,rtpCapabilities:a}=await un(this,Qt.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(n=this.joinInfo)===null||n===void 0?void 0:n.turnServer});t(this.getJoinMessage({ortc:{iceParameters:r,dtlsParameters:i,rtpCapabilities:a,version:"2"}}))}),this.signal.on(_e.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(_e.REPORT_JOIN_GATEWAY,(t,n)=>{this.joinInfo&&(ye.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:t,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Ls?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(_e.IS_P2P_DISCONNECTED,t=>{t(yc(this,Qt.IS_P2P_DISCONNECTED))}),this.signal.on(_e.DISCONNECT_P2P,()=>{this.emit(Qt.DISCONNECT_P2P)}),this.signal.on(_e.NEED_RENEW_SESSION,t=>{this.emit(Qt.NEED_RENEW_SESSION,t)}),this.signal.on(_e.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(_e.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(_e.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(Qt.JOIN_RESPONSE,t,n)}),this.signal.on(_e.DATACHANNEL_PRECONNECT,async(t,n,r)=>{this.updateTurnConfigFromSignal();const i=this.getCurrentGatewayAddress();return un(this,Qt.DATACHANNEL_PRECONNECT,t,i).then(n).catch(r)}),this.signal.on(_e.DATACHANNEL_CONNECTING,async t=>{const{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=await un(this,Qt.REQUEST_DC_CONNECTION_PARAMS);t(this.getJoinMessage({ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i,version:"2"}}))}),this.signal.on(_e.DATACHANNEL_FAILBACK,()=>{T.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Qt.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(Re.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(Re.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(r){throw T.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(Re.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(Re.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(r){throw T.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(t){const n={users:t.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(Re.UNSUBSCRIBE_STREAMS,n,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(t,n){const r={action:t.find(i=>i.stream_type===lt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Re.CONTROL,r,!0,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}}async unmuteLocal(t,n){const r={action:t.find(i=>i.stream_type===lt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Re.CONTROL,r,!0,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}}async muteRemote(t,n){const r={action:t===Te.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Re.CONTROL,r,!0,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}}async unmuteRemote(t,n){const r={action:t===Te.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Re.CONTROL,r,!0,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Re.RESTART_ICE,n,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,Gn.P2P_FAILED)}getCurrentGatewayAddress(){var t;if(!P("GATEWAY_WSS_ADDRESS"))return(t=this.joinInfo)!==null&&t!==void 0&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Re.SET_PARAMETER,{enablePublishAudioFilter:t})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(qe.FALLBACK)),this.store.useDataChannel=!1,this.signal=new B1(Ji(Ji({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Qt.RESET_SIGNAL,L1.websocket)}}let Em=0,lv=0;function bo(e,t,n,r){return new ae((i,a)=>{t.timeout=t.timeout||P("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),Em+=os(t.data)):n&&(t.data.size?Em+=t.data.size:t.data instanceof FormData?Em+=u1(t.data):Em+=os(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,yr.request(t).then(c=>{typeof c.data=="string"?lv+=os(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?lv+=c.data.byteLength:lv+=os(JSON.stringify(c.data)),r&&i({data:c.data,headers:c.headers}),i(c.data)}).catch(c=>{yr.isCancel(c)?a(new B(O.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?a(new B(O.NETWORK_TIMEOUT,c.message)):c.response?a(new B(O.NETWORK_RESPONSE_ERROR,c.response.status)):a(new B(O.NETWORK_ERROR,c.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t($){var oe=0;return function(){return oe<$.length?{done:!1,value:$[oe++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function($,oe,Se){return $==Array.prototype||$==Object.prototype||($[oe]=Se.value),$},r,i=function($){$=[typeof globalThis=="object"&&globalThis,$,typeof window=="object"&&window,typeof self=="object"&&self,typeof h=="object"&&h];for(var oe=0;oe<$.length;++oe){var Se=$[oe];if(Se&&Se.Math==Math)return Se}throw Error("Cannot find global object")}(this);function a($,oe){if(oe)e:{var Se=i;$=$.split(".");for(var Me=0;Me<$.length-1;Me++){var st=$[Me];if(!(st in Se))break e;Se=Se[st]}(oe=oe(Me=Se[$=$[$.length-1]]))!=Me&&oe!=null&&n(Se,$,{configurable:!0,writable:!0,value:oe})}}function c($){return($={next:$})[Symbol.iterator]=function(){return this},$}function d($){var oe=typeof Symbol<"u"&&Symbol.iterator&&$[Symbol.iterator];return oe?oe.call($):{next:t($)}}if(a("Symbol",function($){function oe(st,ce){this.A=st,n(this,"description",{configurable:!0,writable:!0,value:ce})}if($)return $;oe.prototype.toString=function(){return this.A};var Se="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Me=0;return function st(ce){if(this instanceof st)throw new TypeError("Symbol is not a constructor");return new oe(Se+(ce||"")+"_"+Me++,ce)}}),a("Symbol.iterator",function($){if($)return $;$=Symbol("Symbol.iterator");for(var oe="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Se=0;Se<oe.length;Se++){var Me=i[oe[Se]];typeof Me=="function"&&typeof Me.prototype[$]!="function"&&n(Me.prototype,$,{configurable:!0,writable:!0,value:function(){return c(t(this))}})}return $}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var u;e:{var p={};try{p.__proto__={a:!0},u=p.a;break e}catch{}u=!1}r=u?function($,oe){if($.__proto__=oe,$.__proto__!==oe)throw new TypeError($+" is not extensible");return $}:null}var f=r;function m(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function E($){if($.m)throw new TypeError("Generator is already running");$.m=!0}function S($,oe){return $.h=3,{value:oe}}function I($){this.g=new m,this.G=$}function v($,oe,Se,Me){try{var st=oe.call($.g.j,Se);if(!(st instanceof Object))throw new TypeError("Iterator result "+st+" is not an object");if(!st.done)return $.g.m=!1,st;var ce=st.value}catch(R){return $.g.j=null,$.g.s(R),y($)}return $.g.j=null,Me.call($.g,ce),y($)}function y($){for(;$.g.h;)try{var oe=$.G($.g);if(oe)return $.g.m=!1,{value:oe.value,done:!1}}catch(Se){$.g.v=void 0,$.g.s(Se)}if($.g.m=!1,$.g.l){if(oe=$.g.l,$.g.l=null,oe.F)throw oe.D;return{value:oe.return,done:!0}}return{value:void 0,done:!0}}function A($){this.next=function(oe){return $.o(oe)},this.throw=function(oe){return $.s(oe)},this.return=function(oe){return function(Se,Me){E(Se.g);var st=Se.g.j;return st?v(Se,"return"in st?st.return:function(ce){return{value:ce,done:!0}},Me,Se.g.return):(Se.g.return(Me),y(Se))}($,oe)},this[Symbol.iterator]=function(){return this}}function N($,oe){return oe=new A(new I(oe)),f&&$.prototype&&f(oe,$.prototype),oe}if(m.prototype.o=function($){this.v=$},m.prototype.s=function($){this.l={D:$,F:!0},this.h=this.C||this.u},m.prototype.return=function($){this.l={return:$},this.h=this.u},I.prototype.o=function($){return E(this.g),this.g.j?v(this,this.g.j.next,$,this.g.o):(this.g.o($),y(this))},I.prototype.s=function($){return E(this.g),this.g.j?v(this,this.g.j.throw,$,this.g.o):(this.g.s($),y(this))},a("Array.prototype.entries",function($){return $||function(){return function(oe,Se){oe instanceof String&&(oe+="");var Me=0,st=!1,ce={next:function(){if(!st&&Me<oe.length){var R=Me++;return{value:Se(R,oe[R]),done:!1}}return st=!0,{done:!0,value:void 0}}};return ce[Symbol.iterator]=function(){return ce},ce}(this,function(oe,Se){return[oe,Se]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var V=function($,oe){for(var Se=0;Se<$.length;Se++)oe($[Se])},F=function($){return $.replace(/\r?\n|\r/g,`\r
`)},G=function($,oe,Se){return oe instanceof Blob?(Se=Se!==void 0?Se+"":typeof oe.name=="string"?oe.name:"blob",oe.name===Se&&Object.prototype.toString.call(oe)!=="[object Blob]"||(oe=new File([oe],Se)),[String($),oe]):[String($),String(oe)]},z=function($,oe){if($.length<oe)throw new TypeError(oe+" argument required, but only "+$.length+" present.")},Q=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Z=Q.FormData,ee=Q.XMLHttpRequest&&Q.XMLHttpRequest.prototype.send,me=Q.Request&&Q.fetch,Qe=Q.navigator&&Q.navigator.sendBeacon,ct=Q.Element&&Q.Element.prototype,Nt=Q.Symbol&&Symbol.toStringTag;Nt&&(Blob.prototype[Nt]||(Blob.prototype[Nt]="Blob"),"File"in Q&&!File.prototype[Nt]&&(File.prototype[Nt]="File"));try{new File([],"")}catch{Q.File=function(oe,Se,Me){return oe=new Blob(oe,Me||{}),Object.defineProperties(oe,{name:{value:Se},lastModified:{value:+(Me&&Me.lastModified!==void 0?new Date(Me.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Nt&&Object.defineProperty(oe,Nt,{value:"File"}),oe}}var cn=function($){return $.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Wt=function($){this.i=[];var oe=this;$&&V($.elements,function(Se){if(Se.name&&!Se.disabled&&Se.type!=="submit"&&Se.type!=="button"&&!Se.matches("form fieldset[disabled] *"))if(Se.type==="file"){var Me=Se.files&&Se.files.length?Se.files:[new File([],"",{type:"application/octet-stream"})];V(Me,function(st){oe.append(Se.name,st)})}else Se.type==="select-multiple"||Se.type==="select-one"?V(Se.options,function(st){!st.disabled&&st.selected&&oe.append(Se.name,st.value)}):Se.type==="checkbox"||Se.type==="radio"?Se.checked&&oe.append(Se.name,Se.value):(Me=Se.type==="textarea"?F(Se.value):Se.value,oe.append(Se.name,Me))})};if((e=Wt.prototype).append=function($,oe,Se){z(arguments,2),this.i.push(G($,oe,Se))},e.delete=function($){z(arguments,1);var oe=[];$=String($),V(this.i,function(Se){Se[0]!==$&&oe.push(Se)}),this.i=oe},e.entries=function $(){var oe,Se=this;return N($,function(Me){if(Me.h==1&&(oe=0),Me.h!=3)return oe<Se.i.length?Me=S(Me,Se.i[oe]):(Me.h=0,Me=void 0),Me;oe++,Me.h=2})},e.forEach=function($,oe){z(arguments,1);for(var Se=d(this),Me=Se.next();!Me.done;Me=Se.next()){var st=d(Me.value);Me=st.next().value,st=st.next().value,$.call(oe,st,Me,this)}},e.get=function($){z(arguments,1);var oe=this.i;$=String($);for(var Se=0;Se<oe.length;Se++)if(oe[Se][0]===$)return oe[Se][1];return null},e.getAll=function($){z(arguments,1);var oe=[];return $=String($),V(this.i,function(Se){Se[0]===$&&oe.push(Se[1])}),oe},e.has=function($){z(arguments,1),$=String($);for(var oe=0;oe<this.i.length;oe++)if(this.i[oe][0]===$)return!0;return!1},e.keys=function $(){var oe,Se,Me,st,ce=this;return N($,function(R){if(R.h==1&&(oe=d(ce),Se=oe.next()),R.h!=3)return Se.done?void(R.h=0):(Me=Se.value,st=d(Me),S(R,st.next().value));Se=oe.next(),R.h=2})},e.set=function($,oe,Se){z(arguments,2),$=String($);var Me=[],st=G($,oe,Se),ce=!0;V(this.i,function(R){R[0]===$?ce&&(ce=!Me.push(st)):Me.push(R)}),ce&&Me.push(st),this.i=Me},e.values=function $(){var oe,Se,Me,st,ce=this;return N($,function(R){if(R.h==1&&(oe=d(ce),Se=oe.next()),R.h!=3)return Se.done?void(R.h=0):(Me=Se.value,(st=d(Me)).next(),S(R,st.next().value));Se=oe.next(),R.h=2})},Wt.prototype._asNative=function(){for(var $=new Z,oe=d(this),Se=oe.next();!Se.done;Se=oe.next()){var Me=d(Se.value);Se=Me.next().value,Me=Me.next().value,$.append(Se,Me)}return $},Wt.prototype._blob=function(){var $="----formdata-polyfill-"+Math.random(),oe=[],Se="--"+$+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Me,st){return typeof Me=="string"?oe.push(Se+cn(F(st))+`"\r
\r
`+F(Me)+`\r
`):oe.push(Se+cn(F(st))+'"; filename="'+cn(Me.name)+`"\r
Content-Type: `+(Me.type||"application/octet-stream")+`\r
\r
`,Me,`\r
`)}),oe.push("--"+$+"--"),new Blob(oe,{type:"multipart/form-data; boundary="+$})},Wt.prototype[Symbol.iterator]=function(){return this.entries()},Wt.prototype.toString=function(){return"[object FormData]"},ct&&!ct.matches&&(ct.matches=ct.matchesSelector||ct.mozMatchesSelector||ct.msMatchesSelector||ct.oMatchesSelector||ct.webkitMatchesSelector||function($){for(var oe=($=(this.document||this.ownerDocument).querySelectorAll($)).length;0<=--oe&&$.item(oe)!==this;);return-1<oe}),Nt&&(Wt.prototype[Nt]="FormData"),ee){var lo=Q.XMLHttpRequest.prototype.setRequestHeader;Q.XMLHttpRequest.prototype.setRequestHeader=function($,oe){lo.call(this,$,oe),$.toLowerCase()==="content-type"&&(this.B=!0)},Q.XMLHttpRequest.prototype.send=function($){$ instanceof Wt?($=$._blob(),this.B||this.setRequestHeader("Content-Type",$.type),ee.call(this,$)):ee.call(this,$)}}me&&(Q.fetch=function($,oe){return oe&&oe.body&&oe.body instanceof Wt&&(oe.body=oe.body._blob()),me.call(this,$,oe)}),Qe&&(Q.navigator.sendBeacon=function($,oe){return oe instanceof Wt&&(oe=oe._asNative()),Qe.call(this,$,oe)}),Q.FormData=Wt}})();const oh=()=>{const e=P("AREAS");return e.length===0&&e.push(ot.GLOBAL),vo(e).call(e,(t,n,r)=>{const i=X1(n);return i?r===0?i:"".concat(t,",").concat(i):t},"")},X1=e=>e===ot.OVERSEA?"".concat(Xn.ASIA,",").concat(Xn.EUROPE,",").concat(Xn.AFRICA,",").concat(Xn.NORTH_AMERICA,",").concat(Xn.SOUTH_AMERICA,",").concat(Xn.OCEANIA):Xn[e],gY=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const r=fm[n],i=Object.keys(r);i&&i.map(a=>{a!=="CODE"&&(t[a]=t[a].concat(r[a]))})}),t},gm={GLOBAL:{ASIA:[ot.CHINA,ot.JAPAN,ot.INDIA,ot.KOREA,ot.HKMC],EUROPE:[],NORTH_AMERICA:[ot.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Sm=Object.keys(gm[ot.GLOBAL]),uv=[ot.CHINA,ot.NORTH_AMERICA,ot.EUROPE,ot.ASIA,ot.JAPAN,ot.INDIA,ot.OCEANIA,ot.SOUTH_AMERICA,ot.AFRICA,ot.KOREA,ot.HKMC,ot.US],SY=function(e,t){let n=[];if(le(e).call(e,ot.GLOBAL)){const a=[ot.GLOBAL,ot.OVERSEA],c=Object.keys(fm);if(t===ot.GLOBAL)throw new B(O.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===ot.CHINA)n=[ot.OVERSEA];else if(i=t,le(Sm).call(Sm,i)){const d=(r=t,gm[ot.GLOBAL][r]||[]),u=[...a,t,...d];n=c.filter(p=>!le(u).call(u,p))}else if(function(d){let u=!1;return Sm.forEach(p=>{var f;le(f=gm[ot.GLOBAL][p]).call(f,d)&&(u=!0)}),u}(t)){const d=function(p){let f;return Sm.forEach(m=>{var E;le(E=gm[ot.GLOBAL][m]).call(E,p)&&(f=m)}),f}(t),u=[...a,d,t];n=c.filter(p=>!le(u).call(u,p))}else n=e;n=function(d){const u=[];return uv.forEach(p=>{le(d).call(d,p)&&u.push(p)}),u.concat(d.filter(p=>!le(uv).call(uv,p)))}(n)}else n=e;var r,i;return n};function Q1(e){var t,n;if(!e&&le(t=P("AREAS")).call(t,ot.EXTENSIONS))return T.debug("update area from ap : reset"),void hv(pz,!0);if(!le(n=P("AREAS")).call(n,ot.GLOBAL)||!e)return;let r=fm.EXTENSIONS;r&&(r={CODE:X1(ot.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},T.debug("update area from ap success: ".concat(e,",config is "),r),Tt("AREAS",[ot.EXTENSIONS],!0),Object.keys(r).map(i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?Tt(i,r[i][0]):Tt(i,r[i])}))}function hv(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=ye.reportApiInvoke(null,{name:ln.SET_AREA,options:e,tag:Kt.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach(a=>{if(!le(k1).call(k1,a))throw new B(O.INVALID_PARAMS,"invalid area code")}),r=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:a,excludedArea:c}=e;if(!a)throw new B(O.INVALID_PARAMS,"area code is needed");let d=a;typeof a=="string"&&(d=[a]),r=c?SY(d,c):d}if(!t){if(ma.AREAS){const a=new B(O.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(a),void T.warning("setArea is prohibited because of config-distribute")}if(le(r).call(r,ot.GLOBAL)&&P("AREAS")===ot.EXTENSIONS){const a=new B(O.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(a),void T.warning("setArea is prohibited because of ap extensions")}}Tt("AREAS",r,t);const i=gY(r);Object.keys(i).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?Tt(a,i[a][0]):Tt(a,i[a])}),T.debug("set area success:",r.join(","))}catch(r){throw n.onError(r),r}n.onSuccess()}function Z1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function pv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Z1(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z1(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let fv=1;function TY(e,t,n,r,i){fv+=1;const a={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:fv,requestId:fv,version:Ci,cname:n.cname},c={service_name:t,json_body:JSON.stringify(a)};let d,u,p=e[0];return Ro(async()=>{d=Date.now();const f=await bo(p,{data:c,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(u=Date.now()-d,f.code!==0){const S=new B(O.UNEXPECTED_RESPONSE,"live streaming ap error, code"+f.code,{retry:!0,responseTime:u});throw T.error(S.toString()),S}const m=JSON.parse(f.json_body);if(m.code!==200){const S=new B(O.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(m.code,", reason: ").concat(m.reason),{code:m.code,responseTime:u});throw T.error(S.toString()),S}if(!m.servers||m.servers.length===0){const S=new B(O.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:m.code,responseTime:u});throw T.error(S.toString()),S}const E=function(S,I){return{addressList:S.servers.map(v=>"wss://".concat(v.address.replace(/\./g,"-"),".").concat(P("WORKER_DOMAIN"),":").concat(v.wss,"?serviceName=").concat(encodeURIComponent(I))),workerToken:S.workerToken,vid:S.vid}}(m,t);return P("LIVE_STREAMING_ADDRESS")&&(E.addressList=P("LIVE_STREAMING_ADDRESS")instanceof Array?P("LIVE_STREAMING_ADDRESS"):[P("LIVE_STREAMING_ADDRESS")]),pv(pv({},E),{},{responseTime:u})},(f,m)=>(ye.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(f.addressList),firstSuccess:m===0,responseTime:u,serverIp:e[m%e.length]}),!1),(f,m)=>(ye.apworkerEvent(n.sid,{success:!1,sc:f.data&&f.data.code||200,serviceName:t,responseTime:u,serverIp:e[m%e.length]}),!!(f.code!==O.OPERATION_ABORTED&&f.code!==O.UNEXPECTED_RESPONSE||f.data&&f.data.retry)&&(p=e[(m+1)%e.length],!0)),i)}let mv=1;function $1(e,t,n,r){let{url:i,areaCode:a}=e;const{clientId:c,sid:d}=t,u=Date.now();let p;const[f,m]=Ev(t,a,[sn.CHOOSE_SERVER]);let E=zt.networkState;return Ro(async()=>{E&&zt.networkState===pr.OFFLINE&&zt.onlineWaiter&&await ae.race([zt.onlineWaiter,Rn(r&&r.maxRetryTimeout||on.maxRetryTimeout)]),E=zt.networkState;const{data:S,headers:I}=await bo(i,{data:f,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p=I.http3==="1"?1:-1,ye.reportResourceTiming(i,d),tD(S,i,t,u,[sn.CHOOSE_SERVER],p);const v=ih(S,sn.CHOOSE_SERVER);return _v(v),av(v,i)},S=>(S&&ye.joinChooseServer(d,{lts:u,succ:!0,csAddr:i,opid:m,serverList:S.gatewayAddrs.map(I=>I.address),ec:null,cid:S.cid.toString(),uid:S.uid.toString(),csIp:S.csIp,unilbsServerIds:[sn.CHOOSE_SERVER].toString(),isHttp3:p}),!1),S=>S.code!==O.OPERATION_ABORTED&&(S.code===O.CAN_NOT_GET_GATEWAY_SERVER?S.data.retry:(ye.joinChooseServer(d,{lts:u,succ:!1,csAddr:i,serverList:null,opid:m,ec:S.code,csIp:S.data&&S.data.csIp,unilbsServerIds:[sn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:E}),isHttp3:p}),T.warning("[".concat(c||"sid-".concat(d.slice(0,6)),"] Choose server network error, retry"),S),!0)),r)}function eD(e,t,n,r){let i,{url:a,areaCode:c,serviceIds:d}=e;const u=Date.now(),[p,f]=Ev(t,c,d);let m;return Ro(async()=>{m&&zt.networkState===pr.OFFLINE&&zt.onlineWaiter&&await ae.race([zt.onlineWaiter,Rn(r&&r.maxRetryTimeout||on.maxRetryTimeout)]),m=zt.networkState;const{data:E,headers:S}=await bo(a,{data:p,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=S.http3==="1"?1:-1,ye.reportResourceTiming(a,t.sid),tD(E,a,t,u,d,i);const I=ih(E,sn.CHOOSE_SERVER),v=ih(E,t.cloudProxyServer==="proxy5"?sn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?sn.CLOUD_PROXY:sn.CLOUD_PROXY_FALLBACK);return _v(I),{gatewayInfo:av(I,a),proxyInfo:v,url:a}},E=>(E.gatewayInfo&&ye.joinChooseServer(t.sid,{lts:u,succ:!0,csAddr:a,serverList:E.gatewayInfo.gatewayAddrs.map(S=>S.address),ec:null,opid:f,cid:E.gatewayInfo.cid.toString(),uid:E.gatewayInfo.uid.toString(),csIp:E.gatewayInfo.csIp,unilbsServerIds:d.toString(),isHttp3:i}),E.proxyInfo&&ye.joinWebProxyAP(t.sid,{lts:u,sucess:1,apServerAddr:a,turnServerAddrList:E.proxyInfo.addresses.map(S=>S.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:d.toString()}),!1),E=>E.code!==O.OPERATION_ABORTED&&(E.code===O.CAN_NOT_GET_GATEWAY_SERVER?E.data.retry:(ye.joinWebProxyAP(t.sid,{lts:u,sucess:0,apServerAddr:a,turnServerAddrList:null,errorCode:E.code,eventType:t.cloudProxyServer,unilbsServerIds:d.toString(),extend:JSON.stringify({networkState:m})}),T.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),E),!0)),r)}const tD=(e,t,n,r,i,a)=>{const{sid:c,clientId:d,cloudProxyServer:u}=n,p=[],f=m=>{m.flag===4096?ye.joinChooseServer(c,{lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:m.error.message,csIp:m.error.data&&m.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:a}):m.flag!==1048576&&m.flag!==4194304&&m.flag!==4194310||ye.joinWebProxyAP(c,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:m.error.code,eventType:u,unilbsServerIds:i.toString()})};if(e.response_body.forEach(m=>{const E=m.buffer.code;if(m.uri===23&&E===0&&!m.buffer.edges_services)if(m.buffer.flag===4194310)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),m.buffer.edges_services=[];else{const S={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:m.buffer.flag};p.push(S),f(S)}if(E!==0){const S=$d(E),I={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,S.desc,{desc:S.desc,retry:S.retry,csIp:e.detail[502]}),flag:m.buffer.flag};m.buffer.flag===4194310?T.warning(I.error.toString()):p.push(I),f(I)}}),p.length)throw T.warning("[".concat(d||"sid-".concat(c.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(p.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message,", retry: ").concat(m.error.data.retry)).join(" | "))),new B(O.CAN_NOT_GET_GATEWAY_SERVER,p.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message)).join(" | "),{retry:!!p.find(m=>m.error.data.retry),csIp:e.detail[502],desc:[...new Set(p.map(m=>{var E;return m==null||(E=m.error)===null||E===void 0||(E=E.data)===null||E===void 0?void 0:E.desc}).filter(m=>!!m))]})},_v=e=>{var t,n,r,i;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new B(O.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(P("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((i=e.detail)===null||i===void 0?void 0:i[23])=="string"?Q1(e.detail[23].toLowerCase()):Q1()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const c=e.detail[19],d=c==null?void 0:c.split(";");for(let u=0;u<d.length;u++){var a;const p=ir(a=d[u]).call(a);e.addresses[u]&&d&&(e.addresses[u].fingerprint=p)}}if(P("GATEWAY_ADDRESS")&&P("GATEWAY_ADDRESS").length>0){T.debug("assign gateway address to",P("GATEWAY_ADDRESS"));const c=P("GATEWAY_ADDRESS").map(d=>{var u,p;const f=(u=(p=e.addresses.find(m=>m.ip===d.ip&&m.port===d.port))===null||p===void 0?void 0:p.fingerprint)!==null&&u!==void 0?u:"";return{ip:d.ip,port:d.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:f}});e.addresses=c}},vY=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const r=$d(n.buffer.code);throw new B(O.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw T.debug("update ticket request received ap response without response body:",t),new B(O.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Ev=(e,t,n)=>{const r=Math.floor(Math.random()*1e12),i={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:pv({6:e.stringUid,11:t,12:P("USE_NEW_TOKEN")?"1":void 0,22:t},e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};i.request_bodies.forEach(c=>{e.multiIP&&e.multiIP.gateway_ip&&(c.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const a=new FormData;return a.append("request",JSON.stringify(i)),[a,r]},yY=(e,t)=>{const n=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(a=>({ip:a.ip,port:a.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let el=0;function tl(e){return ae.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const sh=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:a}=e,c=0;const d=t;let u,p=0;const f=async()=>{const m=(()=>{const E=c*d,S=E+d;return n.slice(E,S).map(r)})();a&&a.push(...m);try{u=await tl(m)}catch(E){if(p+=d,c++,!(p>=n.length))return void await f();i(E)}m.forEach(E=>E.cancel())};return await f(),u},nD=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:r}=e;const i=t.length;let a=0;const c=async()=>{const d=n(t.shift());try{return await d}catch(u){if(a++,a>=i||r!=null&&r(u))throw u;return c()}};return c()};async function gv(e,t,n,r){return{gatewayInfo:await async function(a,c,d,u){let p=null;const f=[],m=async()=>{const S=P("WEBCS_DOMAIN").slice(0,P("AJAX_REQUEST_CONCURRENT")).map(y=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"),areaCode:oh()})),I=u.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(y=>y.url)}),v=await sh({fragementLength:P("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:y=>(T.debug("[".concat(a.clientId,"] Connect to choose_server:"),y.url),$1(y,a,c,d)),allFailedhandler:y=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},I),y[0]},promisesCollector:f});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},I),v},E=async()=>{if(await Rn(1e3),p!==null)return p;const S=P("WEBCS_DOMAIN_BACKUP_LIST").map(y=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"),areaCode:oh()})),I=u.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(y=>y.url)}),v=await sh({fragementLength:P("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:y=>(T.debug("[".concat(a.clientId,"] Connect to backup choose_server:"),y.url),$1(y,a,c,d)),allFailedhandler:y=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},I),y[0]},promisesCollector:f});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},I),v};try{return p=await tl([m(),E()]),f.length&&f.forEach(S=>S.cancel&&typeof S.cancel=="function"&&S.cancel()),p}catch(S){throw S[0]}}(e,t,n,r)}}async function rD(e,t,n,r,i){const a=e.cloudProxyServer;if(a==="disabled"){if(e.useLocalAccessPoint)return await gv(e,t,n,i);if(P("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:E,proxyInfo:S}=await sD(e,t,n,i);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:E};const I=S.map(v=>({turnServerURL:v.address,tcpport:v.tcpport||Wn.tcpport,udpport:v.udpport||Wn.udpport,username:v.username||Wn.username,password:v.password||Wn.password,forceturn:!1,security:!0}));if(i.useP2P){var c;const v=(c=e.uid)!==null&&c!==void 0?c:E.uid,y="glb:".concat(v.toString()),A=await BT(y),N=S.map(V=>({turnServerURL:V.address,tcpport:V.tcpport||Wn.tcpport,udpport:V.udpport||Wn.udpport,username:y,password:A,forceturn:!1,security:!0}));I.push(...N)}return e.turnServer={mode:"manual",servers:I},{gatewayInfo:E}}return await gv(e,t,n,i)}const{proxyInfo:d,gatewayInfo:u}=await sD(e,t,n,i),p={gatewayInfo:u},f=d.map(E=>({turnServerURL:E.address,tcpport:a==="proxy3"?void 0:E.tcpport?E.tcpport:Wn.tcpport,udpport:a==="proxy4"?void 0:E.udpport?E.udpport:Wn.udpport,username:E.username||Wn.username,password:E.password||Wn.password,forceturn:a!=="proxy4",security:a==="proxy5"}));if(i.useP2P){var m;const E=(m=e.uid)!==null&&m!==void 0?m:u.uid,S="glb:".concat(E.toString()),I=await BT(S),v=d.map(y=>({turnServerURL:y.address,tcpport:a==="proxy3"?void 0:y.tcpport||Wn.tcpport,udpport:a==="proxy4"?void 0:y.udpport||Wn.udpport,username:S,password:I,forceturn:a!=="proxy4",security:a==="proxy5"}));f.push(...v)}return e.turnServer={mode:"manual",servers:f},T.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(a)),p}async function iD(e,t,n,r,i){const a=P("ACCOUNT_REGISTER").slice(0,P("AJAX_REQUEST_CONCURRENT"));let c=[];c=t.proxyServer?a.map(u=>"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1")):a.map(u=>"https://".concat(u,"/api/v1"));const d=i==null?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{const u=await async function(p,f,m,E,S){const I=Date.now(),v={sid:m.sid,opid:10,appid:m.appId,string_uid:f};let y=p[0];const A=await Ro(()=>bo(y+"".concat(y.indexOf("?")===-1?"?":"&","action=stringuid"),{data:v,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(N,V)=>{if(N.code===0){if(N.uid<=0||N.uid>=Math.pow(2,32))throw T.error("Invalid Uint Uid ".concat(f," => ").concat(N.uid),N),ye.reqUserAccount(v.sid,{lts:I,success:!1,serverAddr:y,stringUid:v.string_uid,uid:N.uid,errorCode:O.INVALID_UINT_UID_FROM_STRING_UID,extend:v}),new B(O.INVALID_UINT_UID_FROM_STRING_UID);return ye.reqUserAccount(v.sid,{lts:I,success:!0,serverAddr:y,stringUid:v.string_uid,uid:N.uid,errorCode:null,extend:v}),!1}const F=$d(N.code);return F.retry&&(y=p[(V+1)%p.length]),ye.reqUserAccount(v.sid,{lts:I,success:!1,serverAddr:y,stringUid:v.string_uid,uid:N.uid,errorCode:F.desc,extend:v}),F.retry},(N,V)=>N.code!==O.OPERATION_ABORTED&&(ye.reqUserAccount(v.sid,{lts:I,success:!1,serverAddr:y,stringUid:v.string_uid,uid:null,errorCode:N.code,extend:v}),y=p[(V+1)%p.length],!0),S);if(A.code!==0){const N=$d(A.code);throw new B(O.UNEXPECTED_RESPONSE,N.desc)}return A}(c,e,t,n,r);return i==null||i.recordJoinChannelService({status:"success",endTs:Date.now()},d),u.uid}catch(u){throw i==null||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[u]},d),u}}async function CY(e,t,n){const r=P("ACCOUNT_REGISTER");let i=[];i=t.proxyServer?r.map(a=>"https://".concat(t.proxyServer,"/ap/?url=").concat(a+"/api/v1")):r.map(a=>"https://".concat(a,"/api/v1"));try{return await nD({referenceList:i,asyncMapHandler:c=>async function(d,u,p,f){const m=Date.now(),E={sid:p.sid,opid:10,appid:p.appId,string_uid:u};try{const S=await bo(d+"".concat(d.indexOf("?")===-1?"?":"&","action=stringuid"),{data:E,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(S.code!==0){const I=$d(S.code);throw new B(O.UNEXPECTED_RESPONSE,"preload sua error:".concat(I.desc),I)}if(S.uid<=0||S.uid>=Math.pow(2,32))throw new B(O.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:m,url:d,req:E,uid:S.uid,elapse:Date.now()-m}}catch(S){throw S}}(c,e,t,n),closeFn:c=>c.code===O.OPERATION_ABORTED||c.code===O.UNEXPECTED_RESPONSE&&!c.data.retry})}catch(a){throw a}}async function RY(e,t,n){const r=P("CDS_AP").slice(0,P("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1"):"https://".concat(u,"/api/v1?action=config")),i=r.map(u=>function(p,f,m,E){const S=tt(),I={flag:64,cipher_method:0,features:{device:S.name,system:S.os,system_general:navigator.userAgent,vendor:f.appId,version:Ci,cname:f.cname,sid:f.sid,session_id:f.sid,detail:"",proxyServer:f.proxyServer}};return Ro(()=>bo(p,{data:I,timeout:1e3,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,v=>v.code!==O.OPERATION_ABORTED,E)}(u,e,t,n));let a=null,c=null,d={};try{a=await tl(i)}catch(u){if(u.code===O.OPERATION_ABORTED)throw u;c=u}if(i.forEach(u=>u.cancel()),ye.reportApiInvoke(e.sid,{name:ln.REQUEST_CONFIG_DISTRIBUTE,options:{error:c,res:a}}).onSuccess(),a&&a.test_tags)try{d=function(u){if(!u.test_tags)return{};const p=u.test_tags,f=Object.keys(p),m={};return f.forEach(E=>{var S;const I=ir(S=E.slice(4)).call(S),v=JSON.parse(p[E])[1];m[I]=v}),m}(a)}catch{}return d}async function oD(e,t){const n=P("WEBCS_DOMAIN").concat(P("WEBCS_DOMAIN_BACKUP_LIST")).map(r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:oh(),serviceIds:[sn.CHOOSE_SERVER,sn.CLOUD_PROXY_FALLBACK]}));try{return await nD({referenceList:n,asyncMapHandler:i=>async function(a,c,d){let u,{url:p,areaCode:f,serviceIds:m}=a;const E=Date.now(),[S,I]=Ev(c,f,m);let v=zt.networkState;try{v&&zt.networkState===pr.OFFLINE&&zt.onlineWaiter&&await ae.race([zt.onlineWaiter,Rn(on.maxRetryTimeout)]),v=zt.networkState;const{data:y,headers:A}=await bo(p,{data:S,cancelToken:d,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u=A.http3==="1"?1:-1,(G=>{const z=[];if(G.response_body.forEach(Q=>{const Z=Q.buffer.code;if(Q.uri===23&&Z===0&&!Q.buffer.edges_services)if(Q.buffer.flag===4194310)Q.buffer.edges_services=[];else{const ee={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:G.detail[502]}),flag:Q.buffer.flag};z.push(ee)}if(Z!==0){const ee=$d(Z),me={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,ee.desc,{desc:ee.desc,retry:ee.retry,csIp:G.detail[502]}),flag:Q.buffer.flag};Q.buffer.flag===4194310?T.warning(me.error.toString()):z.push(me)}}),z.length)throw new B(O.CAN_NOT_GET_GATEWAY_SERVER,z.map(Q=>"flag: ".concat(Q.flag,", message: ").concat(Q.error.message)).join(" | "),{retry:!!z.find(Q=>Q.error.data.retry),csIp:G.detail[502],desc:[...new Set(z.map(Q=>{var Z;return Q==null||(Z=Q.error)===null||Z===void 0||(Z=Z.data)===null||Z===void 0?void 0:Z.desc}).filter(Q=>!!Q))]})})(y);const V=ih(y,sn.CHOOSE_SERVER),F=ih(y,sn.CLOUD_PROXY_FALLBACK);return _v(V),{gatewayInfo:av(V,p),proxyInfo:F,opid:I,requestTime:E,url:p,isHttp3:u,elapse:Date.now()-E}}catch(y){throw y}}(i,e,t),closeFn:i=>i.code===O.OPERATION_ABORTED||i.code===O.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(r){throw r}}async function sD(e,t,n,r){const i=P("PROXY_SERVER_TYPE3"),a=(S,I,v)=>{let y=v||i;return Array.isArray(y)&&(y=I%2==0?i[1]:i[0]),"https://".concat(y,"/ap/?url=").concat(S)};let c=null;const d=[],u=async()=>{const S=P("WEBCS_DOMAIN").slice(0,P("AJAX_REQUEST_CONCURRENT")).map((y,A)=>{let N;return N=e.cloudProxyServer==="disabled"&&e.proxyServer?a("".concat(y,"/api/v2/transpond/webrtc?v=2"),A,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(y,"/api/v2/transpond/webrtc?v=2"):a("".concat(y,"/api/v2/transpond/webrtc?v=2"),A),{url:N,areaCode:oh(),serviceIds:[sn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?sn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?sn.CLOUD_PROXY:sn.CLOUD_PROXY_FALLBACK]}}),I=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(y=>y.url)}),v=await sh({fragementLength:P("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:y=>(T.debug("[".concat(e.clientId,"] Connect to choose_server:"),y.url),eD(y,e,t,n)),allFailedhandler:y=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},I),y[0]},promisesCollector:d});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},I),v},p=async()=>{if(await Rn(1e3),c!==null)return c;const S=P("WEBCS_DOMAIN_BACKUP_LIST").map((y,A)=>{let N;return N=e.cloudProxyServer==="disabled"&&e.proxyServer?a("".concat(y,"/api/v2/transpond/webrtc?v=2"),A,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(y,"/api/v2/transpond/webrtc?v=2"):a("".concat(y,"/api/v2/transpond/webrtc?v=2"),A),{url:N,areaCode:oh(),serviceIds:[sn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?sn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?sn.CLOUD_PROXY:sn.CLOUD_PROXY_FALLBACK]}}),I=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(y=>y.url)}),v=await sh({fragementLength:P("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:y=>(T.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),y.url),eD(y,e,t,n)),allFailedhandler:y=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},I),y[0]},promisesCollector:d});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},I),v};let f,m,E;try{({gatewayInfo:f,proxyInfo:m,url:E}=await tl([u(),p()]))}catch(S){throw S[0]}if(d.length&&d.forEach(S=>S.cancel&&typeof S.cancel=="function"&&S.cancel()),!f||!m)throw new B(O.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=E,e.cloudProxyServer!=="disabled"&&Array.isArray(i)&&E){const S=/^https?:\/\/(.+?)(\/.*)?$/.exec(E)[1];le(i).call(i,S)&&(e.proxyServer=S,T.setProxyServer(S),ye.setProxyServer(S))}return c={gatewayInfo:f,proxyInfo:await K1(m,f.uid)},c}async function aD(e,t,n,r){const i=P("UAP_AP").slice(0,P("AJAX_REQUEST_CONCURRENT")).map(a=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(a+"/api/v1?action=uap"):"https://".concat(a,"/api/v1?action=uap"));return await TY(i,e,t,n,r)}async function wY(e,t,n){const r=P("UAP_AP").slice(0,P("AJAX_REQUEST_CONCURRENT")).map(a=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(a+"/api/v1?action=uap"):"https://".concat(a,"/api/v1?action=uap")),i=r.map(a=>function(c,d,u,p){const f={command:"convergeAllocateEdge",sid:d.sid,appId:d.appId,token:d.token,ts:Date.now(),version:Ci,cname:d.cname,uid:d.uid.toString(),requestId:mv,seq:mv};mv+=1;const m={service_name:"tele_channel",json_body:JSON.stringify(f)};return Ro(async()=>{const E=await bo(c,{data:m,cancelToken:u,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(E.code!==0){const I=new B(O.UNEXPECTED_RESPONSE,"cross channel ap error, code"+E.code,{retry:!0});throw T.error(I.toString()),I}const S=JSON.parse(E.json_body);if(S.code!==200){const I=new B(O.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(S.code,", reason: ").concat(S.reason));throw T.error(I.toString()),I}if(!S.servers||S.servers.length===0){const I=new B(O.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw T.error(I.toString()),I}return{vid:S.vid,workerToken:S.workerToken,addressList:(P("CHANNEL_MEDIA_RELAY_SERVERS")||S.servers).map(I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(P("WORKER_DOMAIN"),":").concat(I.wss))}},void 0,E=>!!(E.code!==O.OPERATION_ABORTED&&E.code!==O.UNEXPECTED_RESPONSE||E.data&&E.data.retry),p)}(a,e,t,n));try{const a=await tl(i);return i.forEach(c=>c.cancel()),a}catch(a){throw a[0]}}async function IY(e,t,n){let r=null;const i=[],a=async c=>{const d=P(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v2/transpond/webrtc?v=2"):"https://".concat(u,"/api/v2/transpond/webrtc?v=2"));return c&&(await Rn(1e3),r!==null)?r:await sh({fragementLength:P("FRAGEMENT_LENGTH"),referenceList:d,asyncMapHandler:u=>(T.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),u),function(p,f,m,E){const[S]=yY(f,[sn.CHOOSE_SERVER]);let I=zt.networkState;return Ro(async()=>{I&&zt.networkState===pr.OFFLINE&&zt.onlineWaiter&&await ae.race([zt.onlineWaiter,Rn(E&&E.maxRetryTimeout||on.maxRetryTimeout)]),I=zt.networkState;const v=await bo(p,{data:S,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0);return vY(v,p)},()=>!1,v=>v.code!==O.OPERATION_ABORTED&&(v.code===O.UPDATE_TICKET_FAILED?v.data.retry:(T.warning("[".concat(f.clientId,"] update ticket network error, retry"),v),!0)),E)}(u,e,t,n)),allFailedhandler:u=>{throw u[0]},promisesCollector:i})};try{return r=await tl([a(!1),a(!0)]),i.length&&i.forEach(c=>c.cancel&&typeof c.cancel=="function"&&c.cancel()),r}catch(c){throw c[0]}}function cD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function dD(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?cD(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cD(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class AY extends xt{get isSuccess(){return!!this.configs}constructor(){super(),w(this,"configs",void 0),w(this,"joinInfo",void 0),w(this,"cancelToken",void 0),w(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),w(this,"interval",void 0),w(this,"mutex",new On("config-distribute")),w(this,"mutableParamsRead",!1)}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),P("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},P("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,ye.reportApiInvoke(null,{options:void 0,name:ln.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Kt.TRACER}).onSuccess(JSON.stringify(ma))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void T.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await RY(this.joinInfo,this.cancelToken,this.retryConfig),T.debug("[config-distribute] get config distribute",JSON.stringify(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t}catch(r){const i=new B(O.NETWORK_RESPONSE_ERROR,r);T.warning("[config-distribute] ".concat(i.toString()))}finally{n()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var n;(n=t)&&n.uplink&&n.id&&n.uplink.max_bitrate!==void 0&&n.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit(ov.UPDATE_BITRATE_LIMIT,t):this.emit(ov.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&dD({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var n;const r=ku(n=Object.keys(t).filter(a=>/^webrtc_ng_global_parameter/.test(a))).call(n);for(let a=0;a<r.length;a++)for(let c=r.length-1;c>a;c--){const d=r[c];if(typeof t[d].__priority=="number"){const u=t[d].__priority,p=r[c-1];if(typeof t[p].__priority=="number"){if(!(u>t[p].__priority))continue;{const f=d;r[c]=r[c-1],r[c-1]=f}}else{const f=d;r[c]=r[c-1],r[c-1]=f}}}const i={};r.forEach(a=>{const c=t[a],d=c.__expires;Object.keys(c).forEach(u=>{u==="__priority"||u==="__expires"||Object.prototype.hasOwnProperty.call(i,u)||(i[u]=dD({value:c[u]},d&&{expires:d}))})});try{(function(d){try{const u=Date.now();Object.keys(d).forEach(p=>{switch(p){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(_n,p)){const{value:f,expires:m}=d[p];if(m&&m<=u)return;ma[p]=f,_n[p]=f,T.debug("Update global parameters from config distribute",p,f)}}})}catch(u){T.error("Error update config immediately: ".concat(d),u.message)}})(i);const a=JSON.stringify(i),c=window.btoa(a);window.localStorage.setItem("websdk_ng_global_parameter",c),T.debug("Caching global parameters ".concat(a))}catch(a){T.error("Error caching global parameters:",a.message)}}}var Xi,bY=_(O1),lD=Dt,OY=x,NY=De,DY=g,Sv=nf,PY=Cu,LY=Ke,kY=Qo,MY=Kp,nl=Object.assign,uD=Object.defineProperty,xY=OY([].concat),UY=!nl||DY(function(){if(lD&&nl({b:1},nl(uD({},"a",{enumerable:!0,get:function(){uD(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(i){t[i]=i}),nl({},e)[n]!=7||Sv(nl({},t)).join("")!=r})?function(e,t){for(var n=kY(e),r=arguments.length,i=1,a=PY.f,c=LY.f;r>i;)for(var d,u=MY(arguments[i++]),p=a?xY(Sv(u),a(u)):Sv(u),f=p.length,m=0;f>m;)d=p[m++],lD&&!NY(c,u,d)||(n[d]=u[d]);return n}:nl,VY=Or,jY=Gw,FY=na,BY=De,GY=Qo,WY=function(e,t,n,r){try{return r?t(VY(n)[0],n[1]):t(n)}catch(i){jY(e,"throw",i)}},HY=jw,KY=mf,zY=Is,hD=bf,YY=Ug,qY=sf,pD=Array,Nc=x,Tv=2147483647,JY=/[^\0-\u007E]/,fD=/[.\u3002\uFF0E\uFF61]/g,mD="Overflow: input needs wider integers to process",_D=RangeError,XY=Nc(fD.exec),rl=Math.floor,vv=String.fromCharCode,ED=Nc("".charCodeAt),gD=Nc([].join),va=Nc([].push),QY=Nc("".replace),ZY=Nc("".split),$Y=Nc("".toLowerCase),SD=function(e){return e+22+75*(e<26)},eq=function(e,t,n){var r=0;for(e=n?rl(e/700):e>>1,e+=rl(e/t);e>455;)e=rl(e/35),r+=36;return rl(r+36*e/(e+38))},tq=function(e){var t=[];e=function(A){for(var N=[],V=0,F=A.length;V<F;){var G=ED(A,V++);if(G>=55296&&G<=56319&&V<F){var z=ED(A,V++);(64512&z)==56320?va(N,((1023&G)<<10)+(1023&z)+65536):(va(N,G),V--)}else va(N,G)}return N}(e);var n,r,i=e.length,a=128,c=0,d=72;for(n=0;n<e.length;n++)(r=e[n])<128&&va(t,vv(r));var u=t.length,p=u;for(u&&va(t,"-");p<i;){var f=Tv;for(n=0;n<e.length;n++)(r=e[n])>=a&&r<f&&(f=r);var m=p+1;if(f-a>rl((Tv-c)/m))throw _D(mD);for(c+=(f-a)*m,a=f,n=0;n<e.length;n++){if((r=e[n])<a&&++c>Tv)throw _D(mD);if(r==a){for(var E=c,S=36;;){var I=S<=d?1:S>=d+26?26:S-d;if(E<I)break;var v=E-I,y=36-I;va(t,vv(SD(I+v%y))),E=rl(v/y),S+=36}va(t,vv(SD(E))),d=eq(c,m,p==u),c=0,p++}}c++,a++}return gD(t,"")},nq=At,yv=Dt,rq=uT,Cv=X,TD=na,Qi=x,Tm=ia,Zi=ff,iq=Xg,Rv=qn,wv=UY,il=function(e){var t=GY(e),n=KY(this),r=arguments.length,i=r>1?arguments[1]:void 0,a=i!==void 0;a&&(i=FY(i,r>2?arguments[2]:void 0));var c,d,u,p,f,m,E=qY(t),S=0;if(!E||this===pD&&HY(E))for(c=zY(t),d=n?new this(c):pD(c);c>S;S++)m=a?i(t[S],S):t[S],hD(d,S,m);else for(f=(p=YY(t,E)).next,d=n?new this:[];!(u=BY(f,p)).done;S++)m=a?WY(p,i,[u.value,S],!0):u.value,hD(d,S,m);return d.length=S,d},Oo=jS,oq=AS.codeAt,sq=function(e){var t,n,r=[],i=ZY(QY($Y(e),fD,"."),".");for(t=0;t<i.length;t++)n=i[t],va(r,XY(JY,n)?"xn--"+tq(n):n);return gD(r,".")},ks=vi,aq=oa,cq=_f,vD=pK,yD=mc,dq=yD.set,vm=yD.getterFor("URL"),lq=vD.URLSearchParams,uq=vD.getState,ah=Cv.URL,Iv=Cv.TypeError,ym=Cv.parseInt,hq=Math.floor,CD=Math.pow,$i=Qi("".charAt),No=Qi(/./.exec),ch=Qi([].join),pq=Qi(1 .toString),fq=Qi([].pop),ol=Qi([].push),Av=Qi("".replace),mq=Qi([].shift),_q=Qi("".split),dh=Qi("".slice),Cm=Qi("".toLowerCase),Eq=Qi([].unshift),bv="Invalid scheme",Dc="Invalid host",RD="Invalid port",wD=/[a-z]/i,gq=/[\d+-.a-z]/i,Ov=/\d/,Sq=/^0x/i,Tq=/^[0-7]+$/,vq=/^\d+$/,ID=/^[\da-f]+$/i,yq=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Cq=/[\0\t\n\r #/:<>?@[\\\]^|]/,Rq=/^[\u0000-\u0020]+/,wq=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Iq=/[\t\n\r]/g,lh=function(e){var t,n,r,i;if(typeof e=="number"){for(t=[],n=0;n<4;n++)Eq(t,e%256),e=hq(e/256);return ch(t,".")}if(typeof e=="object"){for(t="",r=function(a){for(var c=null,d=1,u=null,p=0,f=0;f<8;f++)a[f]!==0?(p>d&&(c=u,d=p),u=null,p=0):(u===null&&(u=f),++p);return p>d&&(c=u,d=p),c}(e),n=0;n<8;n++)i&&e[n]===0||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=pq(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},Rm={},AD=wv({},Rm,{" ":1,'"':1,"<":1,">":1,"`":1}),bD=wv({},AD,{"#":1,"?":1,"{":1,"}":1}),Nv=wv({},bD,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),ya=function(e,t){var n=oq(e,0);return n>32&&n<127&&!Rv(t,e)?e:encodeURIComponent(e)},wm={ftp:21,file:null,http:80,https:443,ws:80,wss:443},uh=function(e,t){var n;return e.length==2&&No(wD,$i(e,0))&&((n=$i(e,1))==":"||!t&&n=="|")},OD=function(e){var t;return e.length>1&&uh(dh(e,0,2))&&(e.length==2||(t=$i(e,2))==="/"||t==="\\"||t==="?"||t==="#")},Aq=function(e){return e==="."||Cm(e)==="%2e"},Dv={},ND={},Pv={},DD={},PD={},Lv={},LD={},kD={},Im={},Am={},kv={},Mv={},xv={},Uv={},MD={},Vv={},sl={},cs={},xD={},Pc={},Ms={},jv=function(e,t,n){var r,i,a,c=ks(e);if(t){if(i=this.parse(c))throw Iv(i);this.searchParams=null}else{if(n!==void 0&&(r=new jv(n,!0)),i=this.parse(c,null,r))throw Iv(i);(a=uq(new lq)).bindURL(this),this.searchParams=a}};jv.prototype={type:"URL",parse:function(e,t,n){var r,i,a,c,d,u=this,p=t||Dv,f=0,m="",E=!1,S=!1,I=!1;for(e=ks(e),t||(u.scheme="",u.username="",u.password="",u.host=null,u.port=null,u.path=[],u.query=null,u.fragment=null,u.cannotBeABaseURL=!1,e=Av(e,Rq,""),e=Av(e,wq,"$1")),e=Av(e,Iq,""),r=il(e);f<=r.length;){switch(i=r[f],p){case Dv:if(!i||!No(wD,i)){if(t)return bv;p=Pv;continue}m+=Cm(i),p=ND;break;case ND:if(i&&(No(gq,i)||i=="+"||i=="-"||i=="."))m+=Cm(i);else{if(i!=":"){if(t)return bv;m="",p=Pv,f=0;continue}if(t&&(u.isSpecial()!=Rv(wm,m)||m=="file"&&(u.includesCredentials()||u.port!==null)||u.scheme=="file"&&!u.host))return;if(u.scheme=m,t)return void(u.isSpecial()&&wm[u.scheme]==u.port&&(u.port=null));m="",u.scheme=="file"?p=Uv:u.isSpecial()&&n&&n.scheme==u.scheme?p=DD:u.isSpecial()?p=kD:r[f+1]=="/"?(p=PD,f++):(u.cannotBeABaseURL=!0,ol(u.path,""),p=xD)}break;case Pv:if(!n||n.cannotBeABaseURL&&i!="#")return bv;if(n.cannotBeABaseURL&&i=="#"){u.scheme=n.scheme,u.path=Oo(n.path),u.query=n.query,u.fragment="",u.cannotBeABaseURL=!0,p=Ms;break}p=n.scheme=="file"?Uv:Lv;continue;case DD:if(i!="/"||r[f+1]!="/"){p=Lv;continue}p=Im,f++;break;case PD:if(i=="/"){p=Am;break}p=cs;continue;case Lv:if(u.scheme=n.scheme,i==Xi)u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=Oo(n.path),u.query=n.query;else if(i=="/"||i=="\\"&&u.isSpecial())p=LD;else if(i=="?")u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=Oo(n.path),u.query="",p=Pc;else{if(i!="#"){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=Oo(n.path),u.path.length--,p=cs;continue}u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=Oo(n.path),u.query=n.query,u.fragment="",p=Ms}break;case LD:if(!u.isSpecial()||i!="/"&&i!="\\"){if(i!="/"){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,p=cs;continue}p=Am}else p=Im;break;case kD:if(p=Im,i!="/"||$i(m,f+1)!="/")continue;f++;break;case Im:if(i!="/"&&i!="\\"){p=Am;continue}break;case Am:if(i=="@"){E&&(m="%40"+m),E=!0,a=il(m);for(var v=0;v<a.length;v++){var y=a[v];if(y!=":"||I){var A=ya(y,Nv);I?u.password+=A:u.username+=A}else I=!0}m=""}else if(i==Xi||i=="/"||i=="?"||i=="#"||i=="\\"&&u.isSpecial()){if(E&&m=="")return"Invalid authority";f-=il(m).length+1,m="",p=kv}else m+=i;break;case kv:case Mv:if(t&&u.scheme=="file"){p=Vv;continue}if(i!=":"||S){if(i==Xi||i=="/"||i=="?"||i=="#"||i=="\\"&&u.isSpecial()){if(u.isSpecial()&&m=="")return Dc;if(t&&m==""&&(u.includesCredentials()||u.port!==null))return;if(c=u.parseHost(m))return c;if(m="",p=sl,t)return;continue}i=="["?S=!0:i=="]"&&(S=!1),m+=i}else{if(m=="")return Dc;if(c=u.parseHost(m))return c;if(m="",p=xv,t==Mv)return}break;case xv:if(!No(Ov,i)){if(i==Xi||i=="/"||i=="?"||i=="#"||i=="\\"&&u.isSpecial()||t){if(m!=""){var N=ym(m,10);if(N>65535)return RD;u.port=u.isSpecial()&&N===wm[u.scheme]?null:N,m=""}if(t)return;p=sl;continue}return RD}m+=i;break;case Uv:if(u.scheme="file",i=="/"||i=="\\")p=MD;else{if(!n||n.scheme!="file"){p=cs;continue}if(i==Xi)u.host=n.host,u.path=Oo(n.path),u.query=n.query;else if(i=="?")u.host=n.host,u.path=Oo(n.path),u.query="",p=Pc;else{if(i!="#"){OD(ch(Oo(r,f),""))||(u.host=n.host,u.path=Oo(n.path),u.shortenPath()),p=cs;continue}u.host=n.host,u.path=Oo(n.path),u.query=n.query,u.fragment="",p=Ms}}break;case MD:if(i=="/"||i=="\\"){p=Vv;break}n&&n.scheme=="file"&&!OD(ch(Oo(r,f),""))&&(uh(n.path[0],!0)?ol(u.path,n.path[0]):u.host=n.host),p=cs;continue;case Vv:if(i==Xi||i=="/"||i=="\\"||i=="?"||i=="#"){if(!t&&uh(m))p=cs;else if(m==""){if(u.host="",t)return;p=sl}else{if(c=u.parseHost(m))return c;if(u.host=="localhost"&&(u.host=""),t)return;m="",p=sl}continue}m+=i;break;case sl:if(u.isSpecial()){if(p=cs,i!="/"&&i!="\\")continue}else if(t||i!="?")if(t||i!="#"){if(i!=Xi&&(p=cs,i!="/"))continue}else u.fragment="",p=Ms;else u.query="",p=Pc;break;case cs:if(i==Xi||i=="/"||i=="\\"&&u.isSpecial()||!t&&(i=="?"||i=="#")){if((d=Cm(d=m))===".."||d==="%2e."||d===".%2e"||d==="%2e%2e"?(u.shortenPath(),i=="/"||i=="\\"&&u.isSpecial()||ol(u.path,"")):Aq(m)?i=="/"||i=="\\"&&u.isSpecial()||ol(u.path,""):(u.scheme=="file"&&!u.path.length&&uh(m)&&(u.host&&(u.host=""),m=$i(m,0)+":"),ol(u.path,m)),m="",u.scheme=="file"&&(i==Xi||i=="?"||i=="#"))for(;u.path.length>1&&u.path[0]==="";)mq(u.path);i=="?"?(u.query="",p=Pc):i=="#"&&(u.fragment="",p=Ms)}else m+=ya(i,bD);break;case xD:i=="?"?(u.query="",p=Pc):i=="#"?(u.fragment="",p=Ms):i!=Xi&&(u.path[0]+=ya(i,Rm));break;case Pc:t||i!="#"?i!=Xi&&(i=="'"&&u.isSpecial()?u.query+="%27":u.query+=i=="#"?"%23":ya(i,Rm)):(u.fragment="",p=Ms);break;case Ms:i!=Xi&&(u.fragment+=ya(i,AD))}f++}},parseHost:function(e){var t,n,r;if($i(e,0)=="["){if($i(e,e.length-1)!="]"||(t=function(i){var a,c,d,u,p,f,m,E=[0,0,0,0,0,0,0,0],S=0,I=null,v=0,y=function(){return $i(i,v)};if(y()==":"){if($i(i,1)!=":")return;v+=2,I=++S}for(;y();){if(S==8)return;if(y()!=":"){for(a=c=0;c<4&&No(ID,y());)a=16*a+ym(y(),16),v++,c++;if(y()=="."){if(c==0||(v-=c,S>6))return;for(d=0;y();){if(u=null,d>0){if(!(y()=="."&&d<4))return;v++}if(!No(Ov,y()))return;for(;No(Ov,y());){if(p=ym(y(),10),u===null)u=p;else{if(u==0)return;u=10*u+p}if(u>255)return;v++}E[S]=256*E[S]+u,++d!=2&&d!=4||S++}if(d!=4)return;break}if(y()==":"){if(v++,!y())return}else if(y())return;E[S++]=a}else{if(I!==null)return;v++,I=++S}}if(I!==null)for(f=S-I,S=7;S!=0&&f>0;)m=E[S],E[S--]=E[I+f-1],E[I+--f]=m;else if(S!=8)return;return E}(dh(e,1,-1)),!t))return Dc;this.host=t}else if(this.isSpecial()){if(e=sq(e),No(yq,e)||(t=function(i){var a,c,d,u,p,f,m,E=_q(i,".");if(E.length&&E[E.length-1]==""&&E.length--,(a=E.length)>4)return i;for(c=[],d=0;d<a;d++){if((u=E[d])=="")return i;if(p=10,u.length>1&&$i(u,0)=="0"&&(p=No(Sq,u)?16:8,u=dh(u,p==8?1:2)),u==="")f=0;else{if(!No(p==10?vq:p==8?Tq:ID,u))return i;f=ym(u,p)}ol(c,f)}for(d=0;d<a;d++)if(f=c[d],d==a-1){if(f>=CD(256,5-a))return null}else if(f>255)return null;for(m=fq(c),d=0;d<c.length;d++)m+=c[d]*CD(256,3-d);return m}(e),t===null))return Dc;this.host=t}else{if(No(Cq,e))return Dc;for(t="",n=il(e),r=0;r<n.length;r++)t+=ya(n[r],Rm);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return Rv(wm,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme=="file"&&t==1&&uh(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,a=e.port,c=e.path,d=e.query,u=e.fragment,p=t+":";return i!==null?(p+="//",e.includesCredentials()&&(p+=n+(r?":"+r:"")+"@"),p+=lh(i),a!==null&&(p+=":"+a)):t=="file"&&(p+="//"),p+=e.cannotBeABaseURL?c[0]:c.length?"/"+ch(c,"/"):"",d!==null&&(p+="?"+d),u!==null&&(p+="#"+u),p},setHref:function(e){var t=this.parse(e);if(t)throw Iv(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e=="blob")try{return new al(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+lh(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(ks(e)+":",Dv)},getUsername:function(){return this.username},setUsername:function(e){var t=il(ks(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=ya(t[n],Nv)}},getPassword:function(){return this.password},setPassword:function(e){var t=il(ks(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=ya(t[n],Nv)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?lh(e):lh(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,kv)},getHostname:function(){var e=this.host;return e===null?"":lh(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Mv)},getPort:function(){var e=this.port;return e===null?"":ks(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=ks(e))==""?this.port=null:this.parse(e,xv))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+ch(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,sl))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=ks(e))==""?this.query=null:($i(e,0)=="?"&&(e=dh(e,1)),this.query="",this.parse(e,Pc)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=ks(e))!=""?($i(e,0)=="#"&&(e=dh(e,1)),this.fragment="",this.parse(e,Ms)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var al=function(e){var t=iq(this,zr),n=cq(arguments.length,1)>1?arguments[1]:void 0,r=dq(t,new jv(e,!1,n));yv||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},zr=al.prototype,eo=function(e,t){return{get:function(){return vm(this)[e]()},set:t&&function(n){return vm(this)[t](n)},configurable:!0,enumerable:!0}};if(yv&&(Zi(zr,"href",eo("serialize","setHref")),Zi(zr,"origin",eo("getOrigin")),Zi(zr,"protocol",eo("getProtocol","setProtocol")),Zi(zr,"username",eo("getUsername","setUsername")),Zi(zr,"password",eo("getPassword","setPassword")),Zi(zr,"host",eo("getHost","setHost")),Zi(zr,"hostname",eo("getHostname","setHostname")),Zi(zr,"port",eo("getPort","setPort")),Zi(zr,"pathname",eo("getPathname","setPathname")),Zi(zr,"search",eo("getSearch","setSearch")),Zi(zr,"searchParams",eo("getSearchParams")),Zi(zr,"hash",eo("getHash","setHash"))),Tm(zr,"toJSON",function(){return vm(this).serialize()},{enumerable:!0}),Tm(zr,"toString",function(){return vm(this).serialize()},{enumerable:!0}),ah){var UD=ah.createObjectURL,VD=ah.revokeObjectURL;UD&&Tm(al,"createObjectURL",TD(UD,ah)),VD&&Tm(al,"revokeObjectURL",TD(VD,ah))}aq(al,"URL"),nq({global:!0,constructor:!0,forced:!rq,sham:!yv},{URL:al});var bq=At,Oq=g,Nq=_f,jD=vi,Dq=uT,FD=Wr("URL");bq({target:"URL",stat:!0,forced:!(Dq&&Oq(function(){FD.canParse()}))},{canParse:function(e){var t=Nq(arguments.length,1),n=jD(e),r=t<2||arguments[1]===void 0?void 0:jD(arguments[1]);try{return!!new FD(n,r)}catch{return!1}}});var BD=_(To.URL),Pq=W,Lq=mN,GD=RegExp.prototype,kq=function(e){return e===GD||Pq(GD,e)?Lq(e):e.flags},sr=_(kq);function cl(e){let t=e.length;for(;--t>=0;)e[t]=0}const Fv=256,WD=286,hh=30,ph=15,Bv=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),bm=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Mq=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),HD=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),xs=new Array(576);cl(xs);const fh=new Array(60);cl(fh);const mh=new Array(512);cl(mh);const _h=new Array(256);cl(_h);const Gv=new Array(29);cl(Gv);const Om=new Array(hh);function Wv(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let KD,zD,YD;function Hv(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}cl(Om);const qD=e=>e<256?mh[e]:mh[256+(e>>>7)],Eh=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},oi=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,Eh(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},ds=(e,t,n)=>{oi(e,n[2*t],n[2*t+1])},JD=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},XD=(e,t,n)=>{const r=new Array(16);let i,a,c=0;for(i=1;i<=ph;i++)c=c+n[i-1]<<1,r[i]=c;for(a=0;a<=t;a++){let d=e[2*a+1];d!==0&&(e[2*a]=JD(r[d]++,d))}},QD=e=>{let t;for(t=0;t<WD;t++)e.dyn_ltree[2*t]=0;for(t=0;t<hh;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},ZD=e=>{e.bi_valid>8?Eh(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},$D=(e,t,n,r)=>{const i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]},Kv=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&$D(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!$D(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},eP=(e,t,n)=>{let r,i,a,c,d=0;if(e.sym_next!==0)do r=255&e.pending_buf[e.sym_buf+d++],r+=(255&e.pending_buf[e.sym_buf+d++])<<8,i=e.pending_buf[e.sym_buf+d++],r===0?ds(e,i,t):(a=_h[i],ds(e,a+Fv+1,t),c=Bv[a],c!==0&&(i-=Gv[a],oi(e,i,c)),r--,a=qD(r),ds(e,a,n),c=bm[a],c!==0&&(r-=Om[a],oi(e,r,c)));while(d<e.sym_next);ds(e,256,t)},zv=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,a=t.stat_desc.elems;let c,d,u,p=-1;for(e.heap_len=0,e.heap_max=573,c=0;c<a;c++)n[2*c]!==0?(e.heap[++e.heap_len]=p=c,e.depth[c]=0):n[2*c+1]=0;for(;e.heap_len<2;)u=e.heap[++e.heap_len]=p<2?++p:0,n[2*u]=1,e.depth[u]=0,e.opt_len--,i&&(e.static_len-=r[2*u+1]);for(t.max_code=p,c=e.heap_len>>1;c>=1;c--)Kv(e,n,c);u=a;do c=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Kv(e,n,1),d=e.heap[1],e.heap[--e.heap_max]=c,e.heap[--e.heap_max]=d,n[2*u]=n[2*c]+n[2*d],e.depth[u]=(e.depth[c]>=e.depth[d]?e.depth[c]:e.depth[d])+1,n[2*c+1]=n[2*d+1]=u,e.heap[1]=u++,Kv(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((f,m)=>{const E=m.dyn_tree,S=m.max_code,I=m.stat_desc.static_tree,v=m.stat_desc.has_stree,y=m.stat_desc.extra_bits,A=m.stat_desc.extra_base,N=m.stat_desc.max_length;let V,F,G,z,Q,Z,ee=0;for(z=0;z<=ph;z++)f.bl_count[z]=0;for(E[2*f.heap[f.heap_max]+1]=0,V=f.heap_max+1;V<573;V++)F=f.heap[V],z=E[2*E[2*F+1]+1]+1,z>N&&(z=N,ee++),E[2*F+1]=z,F>S||(f.bl_count[z]++,Q=0,F>=A&&(Q=y[F-A]),Z=E[2*F],f.opt_len+=Z*(z+Q),v&&(f.static_len+=Z*(I[2*F+1]+Q)));if(ee!==0){do{for(z=N-1;f.bl_count[z]===0;)z--;f.bl_count[z]--,f.bl_count[z+1]+=2,f.bl_count[N]--,ee-=2}while(ee>0);for(z=N;z!==0;z--)for(F=f.bl_count[z];F!==0;)G=f.heap[--V],G>S||(E[2*G+1]!==z&&(f.opt_len+=(z-E[2*G+1])*E[2*G],E[2*G+1]=z),F--)}})(e,t),XD(n,p,e.bl_count)},tP=(e,t,n)=>{let r,i,a=-1,c=t[1],d=0,u=7,p=4;for(c===0&&(u=138,p=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=c,c=t[2*(r+1)+1],++d<u&&i===c||(d<p?e.bl_tree[2*i]+=d:i!==0?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):d<=10?e.bl_tree[34]++:e.bl_tree[36]++,d=0,a=i,c===0?(u=138,p=3):i===c?(u=6,p=3):(u=7,p=4))},nP=(e,t,n)=>{let r,i,a=-1,c=t[1],d=0,u=7,p=4;for(c===0&&(u=138,p=3),r=0;r<=n;r++)if(i=c,c=t[2*(r+1)+1],!(++d<u&&i===c)){if(d<p)do ds(e,i,e.bl_tree);while(--d!=0);else i!==0?(i!==a&&(ds(e,i,e.bl_tree),d--),ds(e,16,e.bl_tree),oi(e,d-3,2)):d<=10?(ds(e,17,e.bl_tree),oi(e,d-3,3)):(ds(e,18,e.bl_tree),oi(e,d-11,7));d=0,a=i,c===0?(u=138,p=3):i===c?(u=6,p=3):(u=7,p=4)}};let rP=!1;const iP=(e,t,n,r)=>{oi(e,0+(r?1:0),3),ZD(e),Eh(e,n),Eh(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var xq=e=>{rP||((()=>{let t,n,r,i,a;const c=new Array(16);for(r=0,i=0;i<28;i++)for(Gv[i]=r,t=0;t<1<<Bv[i];t++)_h[r++]=i;for(_h[r-1]=i,a=0,i=0;i<16;i++)for(Om[i]=a,t=0;t<1<<bm[i];t++)mh[a++]=i;for(a>>=7;i<hh;i++)for(Om[i]=a<<7,t=0;t<1<<bm[i]-7;t++)mh[256+a++]=i;for(n=0;n<=ph;n++)c[n]=0;for(t=0;t<=143;)xs[2*t+1]=8,t++,c[8]++;for(;t<=255;)xs[2*t+1]=9,t++,c[9]++;for(;t<=279;)xs[2*t+1]=7,t++,c[7]++;for(;t<=287;)xs[2*t+1]=8,t++,c[8]++;for(XD(xs,287,c),t=0;t<hh;t++)fh[2*t+1]=5,fh[2*t]=JD(t,5);KD=new Wv(xs,Bv,257,WD,ph),zD=new Wv(fh,bm,0,hh,ph),YD=new Wv(new Array(0),Mq,0,19,7)})(),rP=!0),e.l_desc=new Hv(e.dyn_ltree,KD),e.d_desc=new Hv(e.dyn_dtree,zD),e.bl_desc=new Hv(e.bl_tree,YD),e.bi_buf=0,e.bi_valid=0,QD(e)},Uq=(e,t,n,r)=>{let i,a,c=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(d=>{let u,p=4093624447;for(u=0;u<=31;u++,p>>>=1)if(1&p&&d.dyn_ltree[2*u]!==0)return 0;if(d.dyn_ltree[18]!==0||d.dyn_ltree[20]!==0||d.dyn_ltree[26]!==0)return 1;for(u=32;u<Fv;u++)if(d.dyn_ltree[2*u]!==0)return 1;return 0})(e)),zv(e,e.l_desc),zv(e,e.d_desc),c=(d=>{let u;for(tP(d,d.dyn_ltree,d.l_desc.max_code),tP(d,d.dyn_dtree,d.d_desc.max_code),zv(d,d.bl_desc),u=18;u>=3&&d.bl_tree[2*HD[u]+1]===0;u--);return d.opt_len+=3*(u+1)+5+5+4,u})(e),i=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=i&&(i=a)):i=a=n+5,n+4<=i&&t!==-1?iP(e,t,n,r):e.strategy===4||a===i?(oi(e,2+(r?1:0),3),eP(e,xs,fh)):(oi(e,4+(r?1:0),3),((d,u,p,f)=>{let m;for(oi(d,u-257,5),oi(d,p-1,5),oi(d,f-4,4),m=0;m<f;m++)oi(d,d.bl_tree[2*HD[m]+1],3);nP(d,d.dyn_ltree,u-1),nP(d,d.dyn_dtree,p-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,c+1),eP(e,e.dyn_ltree,e.dyn_dtree)),QD(e),r&&ZD(e)},Vq=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(_h[n]+Fv+1)]++,e.dyn_dtree[2*qD(t)]++),e.sym_next===e.sym_end),jq=e=>{oi(e,2,3),ds(e,256,xs),(t=>{t.bi_valid===16?(Eh(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},Fq={_tr_init:xq,_tr_stored_block:iP,_tr_flush_block:Uq,_tr_tally:Vq,_tr_align:jq},gh=(e,t,n,r)=>{let i=65535&e|0,a=e>>>16&65535|0,c=0;for(;n!==0;){c=n>2e3?2e3:n,n-=c;do i=i+t[r++]|0,a=a+i|0;while(--c);i%=65521,a%=65521}return i|a<<16|0};const Bq=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var Er=(e,t,n,r)=>{const i=Bq,a=r+n;e^=-1;for(let c=r;c<a;c++)e=e>>>8^i[255&(e^t[c])];return-1^e},Lc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},dl={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Gq,_tr_stored_block:Yv,_tr_flush_block:Wq,_tr_tally:Ca,_tr_align:Hq}=Fq,{Z_NO_FLUSH:Ra,Z_PARTIAL_FLUSH:Kq,Z_FULL_FLUSH:zq,Z_FINISH:to,Z_BLOCK:oP,Z_OK:Cr,Z_STREAM_END:sP,Z_STREAM_ERROR:ls,Z_DATA_ERROR:Yq,Z_BUF_ERROR:qv,Z_DEFAULT_COMPRESSION:qq,Z_FILTERED:Jq,Z_HUFFMAN_ONLY:Nm,Z_RLE:Xq,Z_FIXED:Qq,Z_DEFAULT_STRATEGY:Zq,Z_UNKNOWN:$q,Z_DEFLATED:Dm}=dl,Jv=286,eJ=30,tJ=19,nJ=2*Jv+1,rJ=15,kc=258,us=262,ll=42,Mc=113,Sh=666,xc=(e,t)=>(e.msg=Lc[t],t),aP=e=>2*e-(e>4?9:0),wa=e=>{let t=e.length;for(;--t>=0;)e[t]=0},iJ=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do n=e.head[--r],e.head[r]=n>=i?n-i:0;while(--t);t=i,r=t;do n=e.prev[--r],e.prev[r]=n>=i?n-i:0;while(--t)};let Ia=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const Ii=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},Ai=(e,t)=>{Wq(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Ii(e.strm)},Jt=(e,t)=>{e.pending_buf[e.pending++]=t},Th=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Xv=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),i===0?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),e.state.wrap===1?e.adler=gh(e.adler,t,i,n):e.state.wrap===2&&(e.adler=Er(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},cP=(e,t)=>{let n,r,i=e.max_chain_length,a=e.strstart,c=e.prev_length,d=e.nice_match;const u=e.strstart>e.w_size-us?e.strstart-(e.w_size-us):0,p=e.window,f=e.w_mask,m=e.prev,E=e.strstart+kc;let S=p[a+c-1],I=p[a+c];e.prev_length>=e.good_match&&(i>>=2),d>e.lookahead&&(d=e.lookahead);do if(n=t,p[n+c]===I&&p[n+c-1]===S&&p[n]===p[a]&&p[++n]===p[a+1]){a+=2,n++;do;while(p[++a]===p[++n]&&p[++a]===p[++n]&&p[++a]===p[++n]&&p[++a]===p[++n]&&p[++a]===p[++n]&&p[++a]===p[++n]&&p[++a]===p[++n]&&p[++a]===p[++n]&&a<E);if(r=kc-(E-a),a=E-kc,r>c){if(e.match_start=t,c=r,r>=d)break;S=p[a+c-1],I=p[a+c]}}while((t=m[t&f])>u&&--i!=0);return c<=e.lookahead?c:e.lookahead},ul=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-us)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),iJ(e),r+=t),e.strm.avail_in===0)break;if(n=Xv(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Ia(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Ia(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<us&&e.strm.avail_in!==0)},dP=(e,t)=>{let n,r,i,a=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,c=0,d=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i||(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<a&&(n===0&&t!==to||t===Ra||n!==r+e.strm.avail_in)))break;c=t===to&&n===r+e.strm.avail_in?1:0,Yv(e,0,0,c),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,Ii(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(Xv(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(c===0);return d-=e.strm.avail_in,d&&(d>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=d&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-d,e.strm.next_in),e.strstart),e.strstart+=d,e.insert+=d>e.w_size-e.insert?e.w_size-e.insert:d),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),c?4:t!==Ra&&t!==to&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(Xv(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,a=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=a||(r||t===to)&&t!==Ra&&e.strm.avail_in===0&&r<=i)&&(n=r>i?i:r,c=t===to&&e.strm.avail_in===0&&n===r?1:0,Yv(e,e.block_start,n,c),e.block_start+=n,Ii(e.strm)),c?3:1)},Qv=(e,t)=>{let n,r;for(;;){if(e.lookahead<us){if(ul(e),e.lookahead<us&&t===Ra)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Ia(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-us&&(e.match_length=cP(e,n)),e.match_length>=3)if(r=Ca(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Ia(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Ia(e,e.ins_h,e.window[e.strstart+1]);else r=Ca(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(Ai(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===to?(Ai(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Ai(e,!1),e.strm.avail_out===0)?1:2},hl=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<us){if(ul(e),e.lookahead<us&&t===Ra)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Ia(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-us&&(e.match_length=cP(e,n),e.match_length<=5&&(e.strategy===Jq||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=Ca(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=Ia(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(Ai(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(r=Ca(e,0,e.window[e.strstart-1]),r&&Ai(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=Ca(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===to?(Ai(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Ai(e,!1),e.strm.avail_out===0)?1:2};function hs(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const vh=[new hs(0,0,0,0,dP),new hs(4,4,8,4,Qv),new hs(4,5,16,8,Qv),new hs(4,6,32,32,Qv),new hs(4,4,16,16,hl),new hs(8,16,32,32,hl),new hs(8,16,128,128,hl),new hs(8,32,128,256,hl),new hs(32,128,258,1024,hl),new hs(32,258,258,4096,hl)];function oJ(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Dm,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*nJ),this.dyn_dtree=new Uint16Array(2*(2*eJ+1)),this.bl_tree=new Uint16Array(2*(2*tJ+1)),wa(this.dyn_ltree),wa(this.dyn_dtree),wa(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(rJ+1),this.heap=new Uint16Array(2*Jv+1),wa(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Jv+1),wa(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const yh=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==ll&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Mc&&t.status!==Sh?1:0},lP=e=>{if(yh(e))return xc(e,ls);e.total_in=e.total_out=0,e.data_type=$q;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?ll:Mc,e.adler=t.wrap===2?0:1,t.last_flush=-2,Gq(t),Cr},uP=e=>{const t=lP(e);return t===Cr&&(n=>{n.window_size=2*n.w_size,wa(n.head),n.max_lazy_match=vh[n.level].max_lazy,n.good_match=vh[n.level].good_length,n.nice_match=vh[n.level].nice_length,n.max_chain_length=vh[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},hP=(e,t,n,r,i,a)=>{if(!e)return ls;let c=1;if(t===qq&&(t=6),r<0?(c=0,r=-r):r>15&&(c=2,r-=16),i<1||i>9||n!==Dm||r<8||r>15||t<0||t>9||a<0||a>Qq||r===8&&c!==1)return xc(e,ls);r===8&&(r=9);const d=new oJ;return e.state=d,d.strm=e,d.status=ll,d.wrap=c,d.gzhead=null,d.w_bits=r,d.w_size=1<<d.w_bits,d.w_mask=d.w_size-1,d.hash_bits=i+7,d.hash_size=1<<d.hash_bits,d.hash_mask=d.hash_size-1,d.hash_shift=~~((d.hash_bits+3-1)/3),d.window=new Uint8Array(2*d.w_size),d.head=new Uint16Array(d.hash_size),d.prev=new Uint16Array(d.w_size),d.lit_bufsize=1<<i+6,d.pending_buf_size=4*d.lit_bufsize,d.pending_buf=new Uint8Array(d.pending_buf_size),d.sym_buf=d.lit_bufsize,d.sym_end=3*(d.lit_bufsize-1),d.level=t,d.strategy=a,d.method=n,uP(e)};var sJ=(e,t)=>{if(yh(e)||t>oP||t<0)return e?xc(e,ls):ls;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===Sh&&t!==to)return xc(e,e.avail_out===0?qv:ls);const r=n.last_flush;if(n.last_flush=t,n.pending!==0){if(Ii(e),e.avail_out===0)return n.last_flush=-1,Cr}else if(e.avail_in===0&&aP(t)<=aP(r)&&t!==to)return xc(e,qv);if(n.status===Sh&&e.avail_in!==0)return xc(e,qv);if(n.status===ll&&n.wrap===0&&(n.status=Mc),n.status===ll){let i=Dm+(n.w_bits-8<<4)<<8,a=-1;if(a=n.strategy>=Nm||n.level<2?0:n.level<6?1:n.level===6?2:3,i|=a<<6,n.strstart!==0&&(i|=32),i+=31-i%31,Th(n,i),n.strstart!==0&&(Th(n,e.adler>>>16),Th(n,65535&e.adler)),e.adler=1,n.status=Mc,Ii(e),n.pending!==0)return n.last_flush=-1,Cr}if(n.status===57){if(e.adler=0,Jt(n,31),Jt(n,139),Jt(n,8),n.gzhead)Jt(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Jt(n,255&n.gzhead.time),Jt(n,n.gzhead.time>>8&255),Jt(n,n.gzhead.time>>16&255),Jt(n,n.gzhead.time>>24&255),Jt(n,n.level===9?2:n.strategy>=Nm||n.level<2?4:0),Jt(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Jt(n,255&n.gzhead.extra.length),Jt(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Er(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Jt(n,0),Jt(n,0),Jt(n,0),Jt(n,0),Jt(n,0),Jt(n,n.level===9?2:n.strategy>=Nm||n.level<2?4:0),Jt(n,3),n.status=Mc,Ii(e),n.pending!==0)return n.last_flush=-1,Cr}if(n.status===69){if(n.gzhead.extra){let i=n.pending,a=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+a>n.pending_buf_size;){let d=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+d),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(e.adler=Er(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=d,Ii(e),n.pending!==0)return n.last_flush=-1,Cr;i=0,a-=d}let c=new Uint8Array(n.gzhead.extra);n.pending_buf.set(c.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending+=a,n.gzhead.hcrc&&n.pending>i&&(e.adler=Er(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let i,a=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>a&&(e.adler=Er(e.adler,n.pending_buf,n.pending-a,a)),Ii(e),n.pending!==0)return n.last_flush=-1,Cr;a=0}i=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Jt(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>a&&(e.adler=Er(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let i,a=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>a&&(e.adler=Er(e.adler,n.pending_buf,n.pending-a,a)),Ii(e),n.pending!==0)return n.last_flush=-1,Cr;a=0}i=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Jt(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>a&&(e.adler=Er(e.adler,n.pending_buf,n.pending-a,a))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Ii(e),n.pending!==0))return n.last_flush=-1,Cr;Jt(n,255&e.adler),Jt(n,e.adler>>8&255),e.adler=0}if(n.status=Mc,Ii(e),n.pending!==0)return n.last_flush=-1,Cr}if(e.avail_in!==0||n.lookahead!==0||t!==Ra&&n.status!==Sh){let i=n.level===0?dP(n,t):n.strategy===Nm?((a,c)=>{let d;for(;;){if(a.lookahead===0&&(ul(a),a.lookahead===0)){if(c===Ra)return 1;break}if(a.match_length=0,d=Ca(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,d&&(Ai(a,!1),a.strm.avail_out===0))return 1}return a.insert=0,c===to?(Ai(a,!0),a.strm.avail_out===0?3:4):a.sym_next&&(Ai(a,!1),a.strm.avail_out===0)?1:2})(n,t):n.strategy===Xq?((a,c)=>{let d,u,p,f;const m=a.window;for(;;){if(a.lookahead<=kc){if(ul(a),a.lookahead<=kc&&c===Ra)return 1;if(a.lookahead===0)break}if(a.match_length=0,a.lookahead>=3&&a.strstart>0&&(p=a.strstart-1,u=m[p],u===m[++p]&&u===m[++p]&&u===m[++p])){f=a.strstart+kc;do;while(u===m[++p]&&u===m[++p]&&u===m[++p]&&u===m[++p]&&u===m[++p]&&u===m[++p]&&u===m[++p]&&u===m[++p]&&p<f);a.match_length=kc-(f-p),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=3?(d=Ca(a,1,a.match_length-3),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(d=Ca(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),d&&(Ai(a,!1),a.strm.avail_out===0))return 1}return a.insert=0,c===to?(Ai(a,!0),a.strm.avail_out===0?3:4):a.sym_next&&(Ai(a,!1),a.strm.avail_out===0)?1:2})(n,t):vh[n.level].func(n,t);if(i!==3&&i!==4||(n.status=Sh),i===1||i===3)return e.avail_out===0&&(n.last_flush=-1),Cr;if(i===2&&(t===Kq?Hq(n):t!==oP&&(Yv(n,0,0,!1),t===zq&&(wa(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),Ii(e),e.avail_out===0))return n.last_flush=-1,Cr}return t!==to?Cr:n.wrap<=0?sP:(n.wrap===2?(Jt(n,255&e.adler),Jt(n,e.adler>>8&255),Jt(n,e.adler>>16&255),Jt(n,e.adler>>24&255),Jt(n,255&e.total_in),Jt(n,e.total_in>>8&255),Jt(n,e.total_in>>16&255),Jt(n,e.total_in>>24&255)):(Th(n,e.adler>>>16),Th(n,65535&e.adler)),Ii(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Cr:sP)},aJ=(e,t)=>{let n=t.length;if(yh(e))return ls;const r=e.state,i=r.wrap;if(i===2||i===1&&r.status!==ll||r.lookahead)return ls;if(i===1&&(e.adler=gh(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){i===0&&(wa(r.head),r.strstart=0,r.block_start=0,r.insert=0);let u=new Uint8Array(r.w_size);u.set(t.subarray(n-r.w_size,n),0),t=u,n=r.w_size}const a=e.avail_in,c=e.next_in,d=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,ul(r);r.lookahead>=3;){let u=r.strstart,p=r.lookahead-2;do r.ins_h=Ia(r,r.ins_h,r.window[u+3-1]),r.prev[u&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=u,u++;while(--p);r.strstart=u,r.lookahead=2,ul(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=c,e.input=d,e.avail_in=a,r.wrap=i,Cr},Ch={deflateInit:(e,t)=>hP(e,t,Dm,15,8,Zq),deflateInit2:hP,deflateReset:uP,deflateResetKeep:lP,deflateSetHeader:(e,t)=>yh(e)||e.state.wrap!==2?ls:(e.state.gzhead=t,Cr),deflate:sJ,deflateEnd:e=>{if(yh(e))return ls;const t=e.state.status;return e.state=null,t===Mc?xc(e,Yq):Cr},deflateSetDictionary:aJ,deflateInfo:"pako deflate (from Nodeca project)"};const cJ=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Pm={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)cJ(n,r)&&(e[r]=n[r])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,i=0,a=e.length;r<a;r++){let c=e[r];n.set(c,i),i+=c.length}return n}};let pP=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{pP=!1}const Rh=new Uint8Array(256);for(let e=0;e<256;e++)Rh[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Rh[254]=Rh[254]=1;var wh={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,r,i,a,c=e.length,d=0;for(i=0;i<c;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<c&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),d+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(d),a=0,i=0;a<d;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<c&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,i;const a=new Array(2*n);for(i=0,r=0;r<n;){let c=e[r++];if(c<128){a[i++]=c;continue}let d=Rh[c];if(d>4)a[i++]=65533,r+=d-1;else{for(c&=d===2?31:d===3?15:7;d>1&&r<n;)c=c<<6|63&e[r++],d--;d>1?a[i++]=65533:c<65536?a[i++]=c:(c-=65536,a[i++]=55296|c>>10&1023,a[i++]=56320|1023&c)}}return((c,d)=>{if(d<65534&&c.subarray&&pP)return String.fromCharCode.apply(null,c.length===d?c:c.subarray(0,d));let u="";for(let p=0;p<d;p++)u+=String.fromCharCode(c[p]);return u})(a,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+Rh[e[n]]>t?n:t}},fP=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const mP=Object.prototype.toString,{Z_NO_FLUSH:dJ,Z_SYNC_FLUSH:lJ,Z_FULL_FLUSH:uJ,Z_FINISH:hJ,Z_OK:Lm,Z_STREAM_END:pJ,Z_DEFAULT_COMPRESSION:fJ,Z_DEFAULT_STRATEGY:mJ,Z_DEFLATED:_J}=dl;function Ih(e){this.options=Pm.assign({level:fJ,method:_J,chunkSize:16384,windowBits:15,memLevel:8,strategy:mJ},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new fP,this.strm.avail_out=0;let n=Ch.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Lm)throw new Error(Lc[n]);if(t.header&&Ch.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?wh.string2buf(t.dictionary):mP.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=Ch.deflateSetDictionary(this.strm,r),n!==Lm)throw new Error(Lc[n]);this._dict_set=!0}}function Zv(e,t){const n=new Ih(t);if(n.push(e,!0),n.err)throw n.msg||Lc[n.err];return n.result}Ih.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,a;if(this.ended)return!1;for(a=t===~~t?t:t===!0?hJ:dJ,typeof e=="string"?n.input=wh.string2buf(e):mP.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(a===lJ||a===uJ)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=Ch.deflate(n,a),i===pJ)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=Ch.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Lm;if(n.avail_out!==0){if(a>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},Ih.prototype.onData=function(e){this.chunks.push(e)},Ih.prototype.onEnd=function(e){e===Lm&&(this.result=Pm.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var EJ={Deflate:Ih,deflate:Zv,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Zv(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Zv(e,t)},constants:dl};const km=16209;var gJ=function(e,t){let n,r,i,a,c,d,u,p,f,m,E,S,I,v,y,A,N,V,F,G,z,Q,Z,ee;const me=e.state;n=e.next_in,Z=e.input,r=n+(e.avail_in-5),i=e.next_out,ee=e.output,a=i-(t-e.avail_out),c=i+(e.avail_out-257),d=me.dmax,u=me.wsize,p=me.whave,f=me.wnext,m=me.window,E=me.hold,S=me.bits,I=me.lencode,v=me.distcode,y=(1<<me.lenbits)-1,A=(1<<me.distbits)-1;e:do{S<15&&(E+=Z[n++]<<S,S+=8,E+=Z[n++]<<S,S+=8),N=I[E&y];t:for(;;){if(V=N>>>24,E>>>=V,S-=V,V=N>>>16&255,V===0)ee[i++]=65535&N;else{if(!(16&V)){if(!(64&V)){N=I[(65535&N)+(E&(1<<V)-1)];continue t}if(32&V){me.mode=16191;break e}e.msg="invalid literal/length code",me.mode=km;break e}F=65535&N,V&=15,V&&(S<V&&(E+=Z[n++]<<S,S+=8),F+=E&(1<<V)-1,E>>>=V,S-=V),S<15&&(E+=Z[n++]<<S,S+=8,E+=Z[n++]<<S,S+=8),N=v[E&A];n:for(;;){if(V=N>>>24,E>>>=V,S-=V,V=N>>>16&255,!(16&V)){if(!(64&V)){N=v[(65535&N)+(E&(1<<V)-1)];continue n}e.msg="invalid distance code",me.mode=km;break e}if(G=65535&N,V&=15,S<V&&(E+=Z[n++]<<S,S+=8,S<V&&(E+=Z[n++]<<S,S+=8)),G+=E&(1<<V)-1,G>d){e.msg="invalid distance too far back",me.mode=km;break e}if(E>>>=V,S-=V,V=i-a,G>V){if(V=G-V,V>p&&me.sane){e.msg="invalid distance too far back",me.mode=km;break e}if(z=0,Q=m,f===0){if(z+=u-V,V<F){F-=V;do ee[i++]=m[z++];while(--V);z=i-G,Q=ee}}else if(f<V){if(z+=u+f-V,V-=f,V<F){F-=V;do ee[i++]=m[z++];while(--V);if(z=0,f<F){V=f,F-=V;do ee[i++]=m[z++];while(--V);z=i-G,Q=ee}}}else if(z+=f-V,V<F){F-=V;do ee[i++]=m[z++];while(--V);z=i-G,Q=ee}for(;F>2;)ee[i++]=Q[z++],ee[i++]=Q[z++],ee[i++]=Q[z++],F-=3;F&&(ee[i++]=Q[z++],F>1&&(ee[i++]=Q[z++]))}else{z=i-G;do ee[i++]=ee[z++],ee[i++]=ee[z++],ee[i++]=ee[z++],F-=3;while(F>2);F&&(ee[i++]=ee[z++],F>1&&(ee[i++]=ee[z++]))}break}}break}}while(n<r&&i<c);F=S>>3,n-=F,S-=F<<3,E&=(1<<S)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<c?c-i+257:257-(i-c),me.hold=E,me.bits=S};const Mm=15,SJ=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),TJ=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),vJ=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),yJ=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Ah=(e,t,n,r,i,a,c,d)=>{const u=d.bits;let p,f,m,E,S,I,v=0,y=0,A=0,N=0,V=0,F=0,G=0,z=0,Q=0,Z=0,ee=null;const me=new Uint16Array(16),Qe=new Uint16Array(16);let ct,Nt,cn,Wt=null;for(v=0;v<=Mm;v++)me[v]=0;for(y=0;y<r;y++)me[t[n+y]]++;for(V=u,N=Mm;N>=1&&me[N]===0;N--);if(V>N&&(V=N),N===0)return i[a++]=20971520,i[a++]=20971520,d.bits=1,0;for(A=1;A<N&&me[A]===0;A++);for(V<A&&(V=A),z=1,v=1;v<=Mm;v++)if(z<<=1,z-=me[v],z<0)return-1;if(z>0&&(e===0||N!==1))return-1;for(Qe[1]=0,v=1;v<Mm;v++)Qe[v+1]=Qe[v]+me[v];for(y=0;y<r;y++)t[n+y]!==0&&(c[Qe[t[n+y]]++]=y);if(e===0?(ee=Wt=c,I=20):e===1?(ee=SJ,Wt=TJ,I=257):(ee=vJ,Wt=yJ,I=0),Z=0,y=0,v=A,S=a,F=V,G=0,m=-1,Q=1<<V,E=Q-1,e===1&&Q>852||e===2&&Q>592)return 1;for(;;){ct=v-G,c[y]+1<I?(Nt=0,cn=c[y]):c[y]>=I?(Nt=Wt[c[y]-I],cn=ee[c[y]-I]):(Nt=96,cn=0),p=1<<v-G,f=1<<F,A=f;do f-=p,i[S+(Z>>G)+f]=ct<<24|Nt<<16|cn|0;while(f!==0);for(p=1<<v-1;Z&p;)p>>=1;if(p!==0?(Z&=p-1,Z+=p):Z=0,y++,--me[v]==0){if(v===N)break;v=t[n+c[y]]}if(v>V&&(Z&E)!==m){for(G===0&&(G=V),S+=A,F=v-G,z=1<<F;F+G<N&&(z-=me[F+G],!(z<=0));)F++,z<<=1;if(Q+=1<<F,e===1&&Q>852||e===2&&Q>592)return 1;m=Z&E,i[m]=V<<24|F<<16|S-a|0}}return Z!==0&&(i[S+Z]=v-G<<24|64<<16|0),d.bits=V,0};const{Z_FINISH:_P,Z_BLOCK:CJ,Z_TREES:xm,Z_OK:Uc,Z_STREAM_END:RJ,Z_NEED_DICT:wJ,Z_STREAM_ERROR:no,Z_DATA_ERROR:EP,Z_MEM_ERROR:gP,Z_BUF_ERROR:IJ,Z_DEFLATED:SP}=dl,Um=16180,Vm=16190,Us=16191,$v=16192,ey=16194,jm=16199,Fm=16200,ty=16206,Ln=16209,TP=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function AJ(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Vc=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Um||t.mode>16211?1:0},vP=e=>{if(Vc(e))return no;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Um,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Uc},yP=e=>{if(Vc(e))return no;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,vP(e)},CP=(e,t)=>{let n;if(Vc(e))return no;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?no:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,yP(e))},RP=(e,t)=>{if(!e)return no;const n=new AJ;e.state=n,n.strm=e,n.window=null,n.mode=Um;const r=CP(e,t);return r!==Uc&&(e.state=null),r};let ny,ry,wP=!0;const bJ=e=>{if(wP){ny=new Int32Array(512),ry=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Ah(1,e.lens,0,288,ny,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Ah(2,e.lens,0,32,ry,0,e.work,{bits:5}),wP=!1}e.lencode=ny,e.lenbits=9,e.distcode=ry,e.distbits=5},IP=(e,t,n,r)=>{let i;const a=e.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(i=a.wsize-a.wnext,i>r&&(i=r),a.window.set(t.subarray(n-r,n-r+i),a.wnext),(r-=i)?(a.window.set(t.subarray(n-r,n),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0};var OJ=(e,t)=>{let n,r,i,a,c,d,u,p,f,m,E,S,I,v,y,A,N,V,F,G,z,Q,Z=0;const ee=new Uint8Array(4);let me,Qe;const ct=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Vc(e)||!e.output||!e.input&&e.avail_in!==0)return no;n=e.state,n.mode===Us&&(n.mode=$v),c=e.next_out,i=e.output,u=e.avail_out,a=e.next_in,r=e.input,d=e.avail_in,p=n.hold,f=n.bits,m=d,E=u,Q=Uc;e:for(;;)switch(n.mode){case Um:if(n.wrap===0){n.mode=$v;break}for(;f<16;){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}if(2&n.wrap&&p===35615){n.wbits===0&&(n.wbits=15),n.check=0,ee[0]=255&p,ee[1]=p>>>8&255,n.check=Er(n.check,ee,2,0),p=0,f=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&p)<<8)+(p>>8))%31){e.msg="incorrect header check",n.mode=Ln;break}if((15&p)!==SP){e.msg="unknown compression method",n.mode=Ln;break}if(p>>>=4,f-=4,z=8+(15&p),n.wbits===0&&(n.wbits=z),z>15||z>n.wbits){e.msg="invalid window size",n.mode=Ln;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&p?16189:Us,p=0,f=0;break;case 16181:for(;f<16;){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}if(n.flags=p,(255&sr(n))!==SP){e.msg="unknown compression method",n.mode=Ln;break}if(57344&sr(n)){e.msg="unknown header flags set",n.mode=Ln;break}n.head&&(n.head.text=p>>8&1),512&sr(n)&&4&n.wrap&&(ee[0]=255&p,ee[1]=p>>>8&255,n.check=Er(n.check,ee,2,0)),p=0,f=0,n.mode=16182;case 16182:for(;f<32;){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}n.head&&(n.head.time=p),512&sr(n)&&4&n.wrap&&(ee[0]=255&p,ee[1]=p>>>8&255,ee[2]=p>>>16&255,ee[3]=p>>>24&255,n.check=Er(n.check,ee,4,0)),p=0,f=0,n.mode=16183;case 16183:for(;f<16;){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}n.head&&(n.head.xflags=255&p,n.head.os=p>>8),512&sr(n)&&4&n.wrap&&(ee[0]=255&p,ee[1]=p>>>8&255,n.check=Er(n.check,ee,2,0)),p=0,f=0,n.mode=16184;case 16184:if(1024&sr(n)){for(;f<16;){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}n.length=p,n.head&&(n.head.extra_len=p),512&sr(n)&&4&n.wrap&&(ee[0]=255&p,ee[1]=p>>>8&255,n.check=Er(n.check,ee,2,0)),p=0,f=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&sr(n)&&(S=n.length,S>d&&(S=d),S&&(n.head&&(z=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(a,a+S),z)),512&sr(n)&&4&n.wrap&&(n.check=Er(n.check,r,S,a)),d-=S,a+=S,n.length-=S),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&sr(n)){if(d===0)break e;S=0;do z=r[a+S++],n.head&&z&&n.length<65536&&(n.head.name+=String.fromCharCode(z));while(z&&S<d);if(512&sr(n)&&4&n.wrap&&(n.check=Er(n.check,r,S,a)),d-=S,a+=S,z)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&sr(n)){if(d===0)break e;S=0;do z=r[a+S++],n.head&&z&&n.length<65536&&(n.head.comment+=String.fromCharCode(z));while(z&&S<d);if(512&sr(n)&&4&n.wrap&&(n.check=Er(n.check,r,S,a)),d-=S,a+=S,z)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&sr(n)){for(;f<16;){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}if(4&n.wrap&&p!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Ln;break}p=0,f=0}n.head&&(n.head.hcrc=sr(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Us;break;case 16189:for(;f<32;){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}e.adler=n.check=TP(p),p=0,f=0,n.mode=Vm;case Vm:if(n.havedict===0)return e.next_out=c,e.avail_out=u,e.next_in=a,e.avail_in=d,n.hold=p,n.bits=f,wJ;e.adler=n.check=1,n.mode=Us;case Us:if(t===CJ||t===xm)break e;case $v:if(n.last){p>>>=7&f,f-=7&f,n.mode=ty;break}for(;f<3;){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}switch(n.last=1&p,p>>>=1,f-=1,3&p){case 0:n.mode=16193;break;case 1:if(bJ(n),n.mode=jm,t===xm){p>>>=2,f-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Ln}p>>>=2,f-=2;break;case 16193:for(p>>>=7&f,f-=7&f;f<32;){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}if((65535&p)!=(p>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Ln;break}if(n.length=65535&p,p=0,f=0,n.mode=ey,t===xm)break e;case ey:n.mode=16195;case 16195:if(S=n.length,S){if(S>d&&(S=d),S>u&&(S=u),S===0)break e;i.set(r.subarray(a,a+S),c),d-=S,a+=S,u-=S,c+=S,n.length-=S;break}n.mode=Us;break;case 16196:for(;f<14;){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}if(n.nlen=257+(31&p),p>>>=5,f-=5,n.ndist=1+(31&p),p>>>=5,f-=5,n.ncode=4+(15&p),p>>>=4,f-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Ln;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;f<3;){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}n.lens[ct[n.have++]]=7&p,p>>>=3,f-=3}for(;n.have<19;)n.lens[ct[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,me={bits:n.lenbits},Q=Ah(0,n.lens,0,19,n.lencode,0,n.work,me),n.lenbits=me.bits,Q){e.msg="invalid code lengths set",n.mode=Ln;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;Z=n.lencode[p&(1<<n.lenbits)-1],y=Z>>>24,A=Z>>>16&255,N=65535&Z,!(y<=f);){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}if(N<16)p>>>=y,f-=y,n.lens[n.have++]=N;else{if(N===16){for(Qe=y+2;f<Qe;){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}if(p>>>=y,f-=y,n.have===0){e.msg="invalid bit length repeat",n.mode=Ln;break}z=n.lens[n.have-1],S=3+(3&p),p>>>=2,f-=2}else if(N===17){for(Qe=y+3;f<Qe;){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}p>>>=y,f-=y,z=0,S=3+(7&p),p>>>=3,f-=3}else{for(Qe=y+7;f<Qe;){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}p>>>=y,f-=y,z=0,S=11+(127&p),p>>>=7,f-=7}if(n.have+S>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Ln;break}for(;S--;)n.lens[n.have++]=z}}if(n.mode===Ln)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=Ln;break}if(n.lenbits=9,me={bits:n.lenbits},Q=Ah(1,n.lens,0,n.nlen,n.lencode,0,n.work,me),n.lenbits=me.bits,Q){e.msg="invalid literal/lengths set",n.mode=Ln;break}if(n.distbits=6,n.distcode=n.distdyn,me={bits:n.distbits},Q=Ah(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,me),n.distbits=me.bits,Q){e.msg="invalid distances set",n.mode=Ln;break}if(n.mode=jm,t===xm)break e;case jm:n.mode=Fm;case Fm:if(d>=6&&u>=258){e.next_out=c,e.avail_out=u,e.next_in=a,e.avail_in=d,n.hold=p,n.bits=f,gJ(e,E),c=e.next_out,i=e.output,u=e.avail_out,a=e.next_in,r=e.input,d=e.avail_in,p=n.hold,f=n.bits,n.mode===Us&&(n.back=-1);break}for(n.back=0;Z=n.lencode[p&(1<<n.lenbits)-1],y=Z>>>24,A=Z>>>16&255,N=65535&Z,!(y<=f);){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}if(A&&!(240&A)){for(V=y,F=A,G=N;Z=n.lencode[G+((p&(1<<V+F)-1)>>V)],y=Z>>>24,A=Z>>>16&255,N=65535&Z,!(V+y<=f);){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}p>>>=V,f-=V,n.back+=V}if(p>>>=y,f-=y,n.back+=y,n.length=N,A===0){n.mode=16205;break}if(32&A){n.back=-1,n.mode=Us;break}if(64&A){e.msg="invalid literal/length code",n.mode=Ln;break}n.extra=15&A,n.mode=16201;case 16201:if(n.extra){for(Qe=n.extra;f<Qe;){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}n.length+=p&(1<<n.extra)-1,p>>>=n.extra,f-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;Z=n.distcode[p&(1<<n.distbits)-1],y=Z>>>24,A=Z>>>16&255,N=65535&Z,!(y<=f);){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}if(!(240&A)){for(V=y,F=A,G=N;Z=n.distcode[G+((p&(1<<V+F)-1)>>V)],y=Z>>>24,A=Z>>>16&255,N=65535&Z,!(V+y<=f);){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}p>>>=V,f-=V,n.back+=V}if(p>>>=y,f-=y,n.back+=y,64&A){e.msg="invalid distance code",n.mode=Ln;break}n.offset=N,n.extra=15&A,n.mode=16203;case 16203:if(n.extra){for(Qe=n.extra;f<Qe;){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}n.offset+=p&(1<<n.extra)-1,p>>>=n.extra,f-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Ln;break}n.mode=16204;case 16204:if(u===0)break e;if(S=E-u,n.offset>S){if(S=n.offset-S,S>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Ln;break}S>n.wnext?(S-=n.wnext,I=n.wsize-S):I=n.wnext-S,S>n.length&&(S=n.length),v=n.window}else v=i,I=c-n.offset,S=n.length;S>u&&(S=u),u-=S,n.length-=S;do i[c++]=v[I++];while(--S);n.length===0&&(n.mode=Fm);break;case 16205:if(u===0)break e;i[c++]=n.length,u--,n.mode=Fm;break;case ty:if(n.wrap){for(;f<32;){if(d===0)break e;d--,p|=r[a++]<<f,f+=8}if(E-=u,e.total_out+=E,n.total+=E,4&n.wrap&&E&&(e.adler=n.check=sr(n)?Er(n.check,i,E,c-E):gh(n.check,i,E,c-E)),E=u,4&n.wrap&&(sr(n)?p:TP(p))!==n.check){e.msg="incorrect data check",n.mode=Ln;break}p=0,f=0}n.mode=16207;case 16207:if(n.wrap&&sr(n)){for(;f<32;){if(d===0)break e;d--,p+=r[a++]<<f,f+=8}if(4&n.wrap&&p!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Ln;break}p=0,f=0}n.mode=16208;case 16208:Q=RJ;break e;case Ln:Q=EP;break e;case 16210:return gP;default:return no}return e.next_out=c,e.avail_out=u,e.next_in=a,e.avail_in=d,n.hold=p,n.bits=f,(n.wsize||E!==e.avail_out&&n.mode<Ln&&(n.mode<ty||t!==_P))&&IP(e,e.output,e.next_out,E-e.avail_out),m-=e.avail_in,E-=e.avail_out,e.total_in+=m,e.total_out+=E,n.total+=E,4&n.wrap&&E&&(e.adler=n.check=sr(n)?Er(n.check,i,E,e.next_out-E):gh(n.check,i,E,e.next_out-E)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Us?128:0)+(n.mode===jm||n.mode===ey?256:0),(m===0&&E===0||t===_P)&&Q===Uc&&(Q=IJ),Q},Vs={inflateReset:yP,inflateReset2:CP,inflateResetKeep:vP,inflateInit:e=>RP(e,15),inflateInit2:RP,inflate:OJ,inflateEnd:e=>{if(Vc(e))return no;let t=e.state;return t.window&&(t.window=null),e.state=null,Uc},inflateGetHeader:(e,t)=>{if(Vc(e))return no;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,Uc):no},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,a;return Vc(e)?no:(r=e.state,r.wrap!==0&&r.mode!==Vm?no:r.mode===Vm&&(i=1,i=gh(i,t,n,0),i!==r.check)?EP:(a=IP(e,t,n,n),a?(r.mode=16210,gP):(r.havedict=1,Uc)))},inflateInfo:"pako inflate (from Nodeca project)"},NJ=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const AP=Object.prototype.toString,{Z_NO_FLUSH:DJ,Z_FINISH:PJ,Z_OK:bh,Z_STREAM_END:iy,Z_NEED_DICT:oy,Z_STREAM_ERROR:LJ,Z_DATA_ERROR:bP,Z_MEM_ERROR:kJ}=dl;function Oh(e){this.options=Pm.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new fP,this.strm.avail_out=0;let n=Vs.inflateInit2(this.strm,t.windowBits);if(n!==bh)throw new Error(Lc[n]);if(this.header=new NJ,Vs.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=wh.string2buf(t.dictionary):AP.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Vs.inflateSetDictionary(this.strm,t.dictionary),n!==bh)))throw new Error(Lc[n])}function sy(e,t){const n=new Oh(t);if(n.push(e),n.err)throw n.msg||Lc[n.err];return n.result}Oh.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let a,c,d;if(this.ended)return!1;for(c=t===~~t?t:t===!0?PJ:DJ,AP.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),a=Vs.inflate(n,c),a===oy&&i&&(a=Vs.inflateSetDictionary(n,i),a===bh?a=Vs.inflate(n,c):a===bP&&(a=oy));n.avail_in>0&&a===iy&&n.state.wrap>0&&e[n.next_in]!==0;)Vs.inflateReset(n),a=Vs.inflate(n,c);switch(a){case LJ:case bP:case oy:case kJ:return this.onEnd(a),this.ended=!0,!1}if(d=n.avail_out,n.next_out&&(n.avail_out===0||a===iy))if(this.options.to==="string"){let u=wh.utf8border(n.output,n.next_out),p=n.next_out-u,f=wh.buf2string(n.output,u);n.next_out=p,n.avail_out=r-p,p&&n.output.set(n.output.subarray(u,u+p),0),this.onData(f)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(a!==bh||d!==0){if(a===iy)return a=Vs.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},Oh.prototype.onData=function(e){this.chunks.push(e)},Oh.prototype.onEnd=function(e){e===bh&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Pm.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var MJ={Inflate:Oh,inflate:sy,inflateRaw:function(e,t){return(t=t||{}).raw=!0,sy(e,t)},ungzip:sy,constants:dl};const{Deflate:Qre,deflate:xJ,deflateRaw:Zre,gzip:$re}=EJ,{Inflate:eie,inflate:UJ,inflateRaw:tie,ungzip:nie}=MJ;var VJ=xJ,jJ=UJ;const Hn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Ze(){return Hn}function OP(){return"setSinkId"in HTMLAudioElement.prototype&&(!P("RESTRICTION_SET_PLAYBACK_DEVICE")||(ua()||BN())&&!UT())}let xn=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function pl(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function et(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function ro(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function ay(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const FJ={"90p":et(160,90),"90p_1":et(160,90),"120p":et(160,120,15,30,65),"120p_1":et(160,120,15,30,65),"120p_3":et(120,120,15,30,50),"120p_4":et(212,120),"180p":et(320,180,15,30,140),"180p_1":et(320,180,15,30,140),"180p_3":et(180,180,15,30,100),"180p_4":et(240,180,15,30,120),"240p":et(320,240,15,40,200),"240p_1":et(320,240,15,40,200),"240p_3":et(240,240,15,40,140),"240p_4":et(424,240,15,40,220),"360p":et(640,360,15,80,400),"360p_1":et(640,360,15,80,400),"360p_3":et(360,360,15,80,260),"360p_4":et(640,360,30,80,600),"360p_6":et(360,360,30,80,400),"360p_7":et(480,360,15,80,320),"360p_8":et(480,360,30,80,490),"360p_9":et(640,360,15,80,800),"360p_10":et(640,360,24,80,800),"360p_11":et(640,360,24,80,1e3),"480p":et(640,480,15,100,500),"480p_1":et(640,480,15,100,500),"480p_2":et(640,480,30,100,1e3),"480p_3":et(480,480,15,100,400),"480p_4":et(640,480,30,100,750),"480p_6":et(480,480,30,100,600),"480p_8":et(848,480,15,100,610),"480p_9":et(848,480,30,100,930),"480p_10":et(640,480,10,100,400),"720p":et(1280,720,15,120,1130),"720p_auto":et(1280,720,30,900,3e3),"720p_1":et(1280,720,15,120,1130),"720p_2":et(1280,720,30,120,2e3),"720p_3":et(1280,720,30,120,1710),"720p_5":et(960,720,15,120,910),"720p_6":et(960,720,30,120,1380),"1080p":et(1920,1080,15,120,2080),"1080p_1":et(1920,1080,15,120,2080),"1080p_2":et(1920,1080,30,120,3e3),"1080p_3":et(1920,1080,30,120,3150),"1080p_5":et(1920,1080,60,120,4780),"1440p":et(2560,1440,30,120,4850),"1440p_1":et(2560,1440,30,120,4850),"1440p_2":et(2560,1440,60,120,7350),"4k":et(3840,2160,30,120,8910),"4k_1":et(3840,2160,30,120,8910),"4k_3":et(3840,2160,60,120,13500)},Bm=[{scaleResolutionDownBy:2,width:1280,height:720,frameRate:30,bitrateMin:300,bitrateMax:900},{scaleResolutionDownBy:1.333333,width:1280,height:720,frameRate:30,bitrateMin:600,bitrateMax:2e3},{scaleResolutionDownBy:1,width:1280,height:720,frameRate:30,bitrateMin:900,bitrateMax:3e3}],BJ={"480p":ro(640,480,5),"480p_1":ro(640,480,5),"480p_2":ro(640,480,30),"480p_3":ro(640,480,15),"720p":ro(1280,720,5),"720p_auto":et(1280,720,30,900,3e3),"720p_1":ro(1280,720,5),"720p_2":ro(1280,720,30),"720p_3":ro(1280,720,15),"1080p":ro(1920,1080,5),"1080p_1":ro(1920,1080,5),"1080p_2":ro(1920,1080,30),"1080p_3":ro(1920,1080,15)},GJ={"1SL1TL":ay(1,1),"3SL3TL":ay(3,3),"2SL3TL":ay(2,3)};function ps(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},FJ[e]):e}function cy(e){return typeof e=="string"?Object.assign({},BJ[e]):e}function Gm(e){return typeof e=="string"?Object.assign({},GJ[e]):e}const WJ={speech_low_quality:pl(16e3,!1),speech_standard:pl(32e3,!1,18),music_standard:pl(48e3,!1),standard_stereo:pl(48e3,!0,56),high_quality:pl(48e3,!1,128),high_quality_stereo:pl(48e3,!0,192)};function Wm(e){return typeof e=="string"?Object.assign({},WJ[e]):e}const fl=[];function NP(e){return Sn(e,"mediaSource",["screen","window","application"]),!0}let fe=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Ot=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e}({}),ml=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),HJ=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),KJ=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e}({}),jc=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),_l=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),El=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),si=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const dy={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},ly={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},DP={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},zJ={uplinkNetworkQuality:0,downlinkNetworkQuality:0},PP={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let gr=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),ai=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Nh=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Fc=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),ar=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),fs=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const uy={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let Hm=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function LP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ut(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?LP(Object(n),!0).forEach(function(r){J(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):LP(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function J(e,t,n){return(t=function(r){var i=function(a,c){if(typeof a!="object"||a===null)return a;var d=a[Symbol.toPrimitive];if(d!==void 0){var u=d.call(a,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(r);return typeof i=="symbol"?i:String(i)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $e(e,t,n,r,i){var a,c,d={};return Object.keys(r).forEach(function(u){d[u]=r[u]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=vo(a=bY(c=n.slice()).call(c)).call(a,function(u,p){return p(e,t,u)||u},d),i&&d.initializer!==void 0&&(d.value=d.initializer?d.initializer.call(i):void 0,d.initializer=void 0),d.initializer===void 0&&(Object.defineProperty(e,t,d),d=null),d}class kP extends xt{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(jc.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),J(this,"trackMediaType",void 0),J(this,"_ID",void 0),J(this,"_rtpTransceiver",void 0),J(this,"_lowRtpTransceiver",void 0),J(this,"_hints",[]),J(this,"_isClosed",!1),J(this,"_originMediaStreamTrack",void 0),J(this,"mediaStreamTrack",void 0),J(this,"_external",{}),this._ID=n||Rt(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(r){le(fl).call(fl,r)||fl.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||pa(()=>{var n;ye.reportApiInvoke(null,{name:ln.GET_MEDIA_STREAM_TRACK,options:[],tag:Kt.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===ml.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=fl.indexOf(t);n!==-1&&fl.splice(n,1)}(this),this.emit(_l.CLOSED),this.removeAllListeners(jc.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===ml.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(jc.TRANSCEIVER_UPDATED,t,n)}}class gl extends kP{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),J(this,"_enabled",!0),J(this,"_muted",!1),J(this,"_isExternalTrack",!1),J(this,"_isClosed",!1),J(this,"_enabledMutex",void 0),J(this,"processor",void 0),J(this,"_processorContext",void 0),J(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new On("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,T.debug("[".concat(this.getTrackId(),"] close")),this.emit(fe.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ct(this,fe.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(_l.TRACK_ENDED)}stateCheck(t,n){if(T.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),Os(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new q(O.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",T);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new q(O.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",T)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ae.resolve([])}}const MP=window.AudioContext||window.webkitAudioContext;let ci=null;const Et=new class extends xt{constructor(){super(...arguments),J(this,"prevState",void 0),J(this,"curState",void 0),J(this,"currentTime",void 0),J(this,"currentTimeStuckAt",void 0),J(this,"interruptDetectorTrack",void 0),J(this,"onLocalAudioTrackMute",()=>{T.info("ios15-interruption-start"),this.emit(xn.IOS_15_16_INTERRUPTION_START)}),J(this,"onLocalAudioTrackUnmute",async()=>{T.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?T.info("ios15-interruption-end-canceled"):(ci&&await ci.suspend(),this.emit(xn.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){T.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){T.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Sl(){if(!ci){if(function(){if(!MP)return void T.error("your browser is not support web audio");T.info("create audio context");const e=Ut({},P("WEBAUDIO_INIT_OPTIONS"));T.debug("audio context init option:",JSON.stringify(e)),ci=new MP(e),Et.curState=ci.state,ci.onstatechange=()=>{Et.prevState=Et.curState,Et.curState=ci?ci.state:void 0;const{prevState:t,curState:n}=Et,r=n==="running",i=n==="interrupted",a=t==="running",c=t==="suspended",d=t==="interrupted",u=tt().osVersion;(Jn()||Ki())&&a&&i&&(T.info("ios".concat(u,"-interruption-start")),Et.emit(xn.IOS_INTERRUPTION_START)),(Jn()||Ki())&&(c||d)&&r&&(T.info("ios".concat(u,"-interruption-end")),Et.emit(xn.IOS_INTERRUPTION_END)),t!==n&&Et.emit(xn.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=(t=ci)===null||t===void 0?void 0:t.currentTime;Et.currentTime!==n?(Et.currentTimeStuckAt&&(T.debug("AudioContext current time resume at ".concat(n)),Et.currentTimeStuckAt=void 0),Et.currentTime=n):(n!==Et.currentTimeStuckAt&&(ye.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Kt.TRACER}).onSuccess(),T.warning("AudioContext current time stuck at ".concat(n))),Et.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,i=!1,a=!1,c=!1;function d(v){t.state==="running"?u(!1):Jn()||Ki()?t.state==="suspended"&&(u(!0),v&&t.resume().then(p,p)):t.state!=="closed"&&(u(!0),v&&t.resume().then(p,p))}function u(v){if(i!==v){i=v;for(let y=0,A=n;y<A.length;y+=1){const N=A[y];v?window.addEventListener(N,f,{capture:!0,passive:!0}):window.removeEventListener(N,f,{capture:!0,passive:!0})}}}function p(){d(!1)}function f(){d(!0)}function m(v){if(!c)if(r.paused)if(v){let y;E(!1),c=!0;try{y=r.play(),y?y.then(S,S):(r.addEventListener("playing",S),r.addEventListener("abort",S),r.addEventListener("error",S))}catch{S()}}else E(!0);else E(!1)}function E(v){if(a!==v){a=v;for(let y=0,A=n;y<A.length;y++){const N=A[y];v?window.addEventListener(N,I,{capture:!0,passive:!0}):window.removeEventListener(N,I,{capture:!0,passive:!0})}}}function S(){r.removeEventListener("playing",S),r.removeEventListener("abort",S),r.removeEventListener("error",S),c=!1,m(!1)}function I(){m(!0)}if(Jn()){const v=t.createMediaStreamDestination(),y=document.createElement("div");y.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=y.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=v.stream,m(!0)}Et.on(xn.STATE_CHANGE,function(){d(!0)}),d(!1)}(ci)}(),!ci)throw new q(O.NOT_SUPPORTED,"can not create audio context");return ci}return ci}function Bc(e){if(function(){if(hy!==null)return hy;const r=Sl(),i=r.createBufferSource(),a=r.createGain(),c=r.createGain();i.connect(a),i.connect(c),i.disconnect(a);let d=!1;try{i.disconnect(a)}catch{d=!0}return i.disconnect(),hy=d,d}())return;const t=e.connect,n=e.disconnect;e.connect=(r,i,a)=>{var c;return e._inputNodes||(e._inputNodes=[]),le(c=e._inputNodes).call(c,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,i,a)):t.call(e,r,i)),e},e.disconnect=(r,i,a)=>{n.call(e),r?nm(e._inputNodes,r):e._inputNodes=[];for(const c of e._inputNodes)t.call(e,c)}}let hy=null;function py(e,t){let n=!1;const r=1/t;if(P("DISABLE_WEBAUDIO")){const i=window.setInterval(()=>{n?window.clearInterval(i):e(performance.now()/1e3)},1e3*r)}else{const i=Sl();let a=i.createGain();a.gain.value=0,a.connect(i.destination);const c=()=>{if(n)return void(a=null);const d=i.createOscillator();d.onended=c,d.connect(a),d.start(0),d.stop(i.currentTime+r),e(i.currentTime)};c()}return()=>{n=!0}}class xP{constructor(){J(this,"context",void 0),J(this,"analyserNode",void 0),J(this,"sourceNode",void 0),this.context=Sl(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Jn()||Ki()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let i=0;i<t.length;++i)t[i]=r[i]/128-1}const n=vo(t).call(t,(r,i)=>r+i*i,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{T.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class UP extends xt{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),J(this,"outputNode",void 0),J(this,"outputTrack",void 0),J(this,"isPlayed",!1),J(this,"sourceNode",void 0),J(this,"context",void 0),J(this,"audioBufferNode",void 0),J(this,"destNode",void 0),J(this,"audioOutputLevel",0),J(this,"volumeLevelAnalyser",void 0),J(this,"_processedNode",void 0),J(this,"playNode",void 0),J(this,"isDestroyed",!1),J(this,"onNoAudioInput",void 0),J(this,"isNoAudioInput",!1),J(this,"_noAudioInputCount",0),this.context=Sl(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Bc(this.outputNode),this.volumeLevelAnalyser=new xP}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(si.ON_AUDIO_BUFFER,function(r){for(let i=0;i<r.outputBuffer.numberOfChannels;i+=1){const a=r.outputBuffer.getChannelData(i);for(let c=0;c<a.length;c+=1)a[c]=0}return r.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ze().webAudioMediaStreamDest)throw new q(O.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&rm(()=>{Et.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Jn()||Ki()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let r;n.getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r));let i=!1;for(let a=0;a<r.length;a++)r[a]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await Rn(200),await this.checkHasAudioInput(t?t+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class VP extends UP{get isFreeze(){return!1}constructor(t,n,r){var i;if(super(),J(this,"sourceNode",void 0),J(this,"track",void 0),J(this,"clonedTrack",void 0),J(this,"audioElement",void 0),J(this,"isCurrentTrackCloned",!1),J(this,"isRemoteTrack",!1),J(this,"originVolumeLevelAnalyser",void 0),J(this,"rebuildWebAudio",async()=>{if(T.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void T.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>T.info("resume success")),T.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const d=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?d.stop():this.isCurrentTrackCloned=!0;const u=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(u),Bc(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const p=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(p,this.context.currentTime),Bc(this.outputNode),this.emit(si.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=u,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new q(O.UNEXPECTED_ERROR);this.track=t;const a=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(a),Bc(this.sourceNode),r){const d=r.clone();d.enabled=!0,this.clonedTrack=d,T.debug("create an unmuted track ".concat(d.id," from the original track ").concat(r.id," to get the volume"));const u=this.context.createMediaStreamSource(new MediaStream([d]));Bc(u),this.originVolumeLevelAnalyser=new xP,this.originVolumeLevelAnalyser.updateSource(u)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=a;const c=tt();n&&c.os===yn.IOS&&Number((i=c.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(Et.on(xn.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(d=>{d||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),Bc(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(si.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Et.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),T.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const r=this.context.createMediaStreamSource(new MediaStream([n]));Bc(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function jP(e,t,n){const r=(a,c)=>a?typeof a!="number"?a.max||a.exact||a.ideal||a.min||c:a:c,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function YJ(e,t){const n=await FP(e.mediaSource),{sourceId:r,audio:i}=await function(a){let c=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ae((d,u)=>{const p=document.createElement("div");p.innerText="share screen",p.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const f=document.createElement("div");f.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const m=document.createElement("div");m.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",m.setAttribute("style","height: 12%;");const E=document.createElement("div");E.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const S=document.createElement("div");S.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const I=document.createElement("button");I.innerHTML="cancel",I.setAttribute("style","width: 85px;"),I.onclick=()=>{document.body.removeChild(A);const N=new Error("NotAllowedError");N.name="NotAllowedError",u(N)};let v=c;const y=document.createElement("div");if(c){const N=document.createElement("input");N.setAttribute("type","checkbox");const V=document.createElement("span");N.setAttribute("style","margin-right: 6px;"),V.innerText="Share audio",N.checked=v,N.onchange=()=>{v=N.checked},y.appendChild(N),y.appendChild(V)}S.appendChild(y),S.appendChild(I),f.appendChild(m),f.appendChild(E),f.appendChild(S);const A=document.createElement("div");A.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),A.appendChild(p),A.appendChild(f),document.body.appendChild(A),a.map(N=>{if(N.id){const V=document.createElement("div");V.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let F=N.thumbnail;try{const{width:G}=F.getSize();G>1920&&(F=F.resize({width:1920}))}catch(G){throw G&&G.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),G}V.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+F.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+N.name.replace(/[\u00A0-\u9999<>\&]/g,function(G){return"&#"+G.charCodeAt(0)+";"})+"</span>",V.onclick=()=>{document.body.removeChild(A),d({sourceId:N.id,audio:v})},E.appendChild(V)}})})}(n,t);return await jP(r,e,i)}async function FP(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=i1();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new q(O.ELECTRON_IS_NULL);let r=null;try{var i;r=((i=n.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new ae((a,c)=>{n.desktopCapturer.getSources({types:t},(d,u)=>{d?c(d):a(u)})}));try{return await r}catch(a){throw new q(O.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,a.toString())}}const fy=new On("safari");let BP=!1,GP=!1;async function di(e,t){let n=0,r=null;for(;n<2;)try{r=await qJ(e,t,n>0);break}catch(i){if(i instanceof q)throw T.error("[".concat(t,"] ").concat(i.toString())),i;const a=Km(i.name||i.code||i,i.message);if(a.code===O.MEDIA_OPTION_INVALID){T.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await Rn(500);continue}throw T.error("[".concat(t,"] ").concat(a.toString())),a}if(!r)throw new q(O.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function qJ(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new q(O.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=Ze(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return T.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(i1())e.screen.sourceId?Tl(i,await jP(e.screen.sourceId,e.screen,e.screenAudio)):Tl(i,await YJ(e.screen,e.screenAudio));else if(ua()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new q(O.NOT_SUPPORTED,"This browser does not support screen sharing");T.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const E=await(c=e.screen.extensionId,d=t,new ae((S,I)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},v=>{if(!v||!v.streamId)return T.error("[".concat(d,"] No response from Chrome Plugin. Plugin not installed properly"),v),void I(new q(O.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));S(v.streamId)})}catch(v){T.error("[".concat(d,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),v.toString()),I(new q(O.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=E,Tl(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var a;e.screen.mediaSource&&NP(e.screen.mediaSource);const E={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(a=e.screen.displaySurface)!==null&&a!==void 0?a:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:S,surfaceSwitching:I,systemAudio:v}=e.screen,y={selfBrowserSurface:S,surfaceSwitching:I,systemAudio:v};!S&&delete y.selfBrowserSurface,!I&&delete y.surfaceSwitching,!v&&delete y.systemAudio,T.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:E,audio:!!e.screenAudio,controls:y})),Tl(i,await navigator.mediaDevices.getDisplayMedia(Ut({video:E,audio:!!e.screenAudio},y)))}else{if(!yt())throw T.error("[".concat(t,"] This browser does not support screenSharing")),new q(O.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&NP(e.screen.mediaSource);const E={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};T.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(E))),Tl(i,await navigator.mediaDevices.getUserMedia(E))}}var c,d;if(!e.video&&!e.audio)return i;let u={video:e.video,audio:e.audio},p=P("MEDIA_DEVICE_CONSTRAINTS");if(p)try{typeof p=="string"&&(p=JSON.parse(p)),u=GT(u,p)}catch{}T.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(u)),tt();let f,m=null;(Cn()||Jn()||em())&&(m=await fy.lock());try{f=await navigator.mediaDevices.getUserMedia(u)}catch(E){throw m&&m(),E}return u.audio&&(BP=!0),u.video&&(GP=!0),Tl(i,f),m&&m(),i}function Km(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new q(O.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new q(O.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new q(O.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new q(O.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new q(O.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new q(O.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return T.error("getUserMedia unexpected error",e),new q(O.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Tl(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],a=t.getAudioTracks()[0];a&&(r&&e.removeTrack(r),e.addTrack(a)),i&&(n&&e.removeTrack(n),e.addTrack(i))}const li=new class extends xt{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Fc.STATE_CHANGE,e),this._state=e)}constructor(){super(),J(this,"_state",Nh.IDLE),J(this,"isAccessMicrophonePermission",!1),J(this,"isAccessCameraPermission",!1),J(this,"lastAccessMicrophonePermission",!1),J(this,"lastAccessCameraPermission",!1),J(this,"checkdeviceMatched",!1),J(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(P("ENUMERATE_DEVICES_INTERVAL")||(tm()||$f()===yn.HARMONY_OS)&&ha())&&this.updateDevicesInfo()},P("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>T.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new q(O.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let a=!this.isAccessMicrophonePermission&&e,c=!this.isAccessCameraPermission&&t;i.audio&&(a=!1),i.video&&(c=!1);let d=null,u=null,p=null;if(!n&&(a||c)){if(fy.isLocked&&(T.debug("[device manager] wait GUM lock"),(await fy.lock())(),T.debug("[device manager] GUM unlock")),BP&&(a=!1,this.isAccessMicrophonePermission=!0),GP&&(c=!1,this.isAccessCameraPermission=!0),T.debug("[device manager] check media device permissions",e,t,a,c),a&&c){try{p=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(f){const m=Km(f.name||f.code||f,f.message);if(m.code===O.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(a){try{d=await navigator.mediaDevices.getUserMedia({audio:e})}catch(f){const m=Km(f.name||f.code||f,f.message);if(m.code===O.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessMicrophonePermission=!0}else if(c){try{u=await navigator.mediaDevices.getUserMedia({video:t})}catch(f){const m=Km(f.name||f.code||f,f.message);if(m.code===O.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0}T.debug("[device manager] mic permission",e,"cam permission",t)}try{const f=await navigator.mediaDevices.enumerateDevices();return d&&d.getTracks().forEach(m=>m.stop()),u&&u.getTracks().forEach(m=>m.stop()),p&&p.getTracks().forEach(m=>m.stop()),d=null,u=null,p=null,f}catch(f){return d&&d.getTracks().forEach(m=>m.stop()),u&&u.getTracks().forEach(m=>m.stop()),p&&p.getTracks().forEach(m=>m.stop()),d=null,u=null,p=null,new q(O.ENUMERATE_DEVICES_FAILED,f.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new q(O.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Nh.INITING;try{await this.updateDevicesInfo(),this.state=Nh.INITEND}catch(e){throw T.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Nh.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new q(O.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const i=e.find(c=>c.kind==="audioinput"&&c.deviceId==="default"),a=e.find(c=>c.kind==="audiooutput"&&c.deviceId==="default");i&&a?a.groupId===i.groupId?T.debug("[device-check] default input ".concat(i.label," and output ").concat(a.label," is the same group")):T.warning("[device-check] default input ".concat(i.label," and output ").concat(a.label," is not the same group")):T.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(i=>{if(!i.deviceId)return;const a=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((a?a.state:"INACTIVE")!=="ACTIVE"){const c={initAt:t,updateAt:t,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),c),n.push(c)}a&&(a.updateAt=t)}),this.deviceInfoMap.forEach((i,a)=>{i.state==="ACTIVE"&&i.updateAt!==t&&(i.state="INACTIVE",n.push(i))}),this.state!==Nh.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Fc.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Fc.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Fc.PLAYOUT_DEVICE_CHANGED,i)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(i=>i.kind==="audioinput"),n=e.filter(i=>i.kind==="videoinput"),r={audio:!1,video:!1};for(const i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}};let my=!1;const ui=new class extends xt{constructor(){super(...arguments),J(this,"onAutoplayFailed",void 0),J(this,"onAudioAutoplayFailed",void 0)}};function WP(){if(tt(),!my){const e=t=>{t.preventDefault(),my=!1,Ju()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};my=!0,Ju()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),T.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),ui.onAutoplayFailed?ui.onAutoplayFailed():ui.onAudioAutoplayFailed?T.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):T.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),ui.emit("autoplay-failed")}}function HP(e,t,n,r){if(!e)return;const i=ye.getBaseInfoBySessionId(e);if(!i)return;const a=i.info,c=Date.now(),d=Ut(Ut({},a),{},{vid:a.vid===void 0?0:Number(a.vid),lts:c,elapse:c-i.startTime,cbRegistered:ui.onAutoplayFailed||ui.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});ye.send({type:Bt.AUTOPLAY_FAILED,data:d},!0)}const JJ=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Rr=new class{constructor(){J(this,"onAutoplayFailed",void 0),J(this,"elementMap",new Map),J(this,"elementStateMap",new Map),J(this,"elementsNeedToResume",[]),J(this,"sinkIdMap",new Map),J(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,r]=t;const i=this.elementStateMap.get(n),a=r.srcObject.getAudioTracks()[0],c=a&&a.readyState;if(T.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(c," ").concat(e)),c==="live"){if(e)return r.pause(),void r.play();if(Et.curState==="running")return Wd()?(r.pause(),void r.play()):void(i&&i==="paused"&&r.play())}})}),J(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(T.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),Et.on(xn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Et.on(xn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Et.on(xn.STATE_CHANGE,()=>{Jn()&&Et.prevState==="suspended"&&Et.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(r){throw new q(O.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,ar.INIT),this.setVolume(t,n);const a=this.sinkIdMap.get(t);if(a)try{i.setSinkId(a).catch(d=>{T.warning("[".concat(t,"] set sink id failed"),d.toString())})}catch(d){T.warning("[".concat(t,"] set sink id failed"),d.toString())}const c=i.play();c&&c.then&&c.catch(d=>{r&&HP(r,"audio",d.message,t),T.warning("audio element play warning",d.toString()),this.elementMap.has(t)&&d.name==="NotAllowedError"&&(T.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),rm(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),WP()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){JJ.forEach(n=>{t.addEventListener(n,r=>{const i=this.elementStateMap.get(e),a=r.type==="pause"?"paused":r.type;if(T.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(a)),r.type==="error"){const c=t==null?void 0:t.error;c&&T.error("[".concat(e,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(e,a)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{T.debug("Auto resume audio element success")}).catch(n=>{T.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new ae(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Ju()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function $t(){return function(e,t,n){const r=n.value;return typeof r=="function"&&(n.value=function(){this._isClosed&&new q(O.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",T);for(var i=arguments.length,a=new Array(i),c=0;c<i;c++)a[c]=arguments[c];const d=r.apply(this,a);return d instanceof ae?new ae((u,p)=>{d.then(u).catch(p)}):d}),n}}class KP extends xt{constructor(t){super(),J(this,"name","VideoProcessorDestination"),J(this,"ID","0"),J(this,"_source",void 0),J(this,"videoContext",void 0),J(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new q(O.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new q(O.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(gr.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(gr.ON_TRACK,void 0)}}class zP extends xt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),J(this,"constraintsMap",new Map),J(this,"statsRegistry",[]),J(this,"usageRegistry",[]),J(this,"trackId",void 0),J(this,"direction",void 0),J(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await un(this,ai.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var r;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Ct(this,ai.REQUEST_UPDATE_CONSTRAINTS,Array.from(wo(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return T.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),Ct(this,ai.REQUEST_UPDATE_CONSTRAINTS,Array.from(wo(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:i,cb:a}of this.statsRegistry)try{const c=a();t.push({processorID:n,processorName:r,type:i,stats:c})}catch(c){T.error(new q(O.UNEXPECTED_ERROR,c.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof ae&&(r=await r),t.push(Ut(Ut({},r),{},{direction:this.direction}))}catch(r){T.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class YP extends xt{constructor(t){super(),J(this,"name","AudioProcessorDestination"),J(this,"ID","0"),J(this,"inputTrack",void 0),J(this,"inputNode",void 0),J(this,"audioProcessorContext",void 0),J(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new q(O.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new q(O.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(gr.ON_TRACK,void 0),this.emit(gr.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(gr.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(gr.ON_NODE,this.inputNode))}}class qP extends xt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,r){super(),J(this,"constraintsMap",new Map),J(this,"statsRegistry",[]),J(this,"audioContext",void 0),J(this,"trackId",void 0),J(this,"direction",void 0),J(this,"usageRegistry",[]),J(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=r}async getConstraints(){return un(this,ai.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var r;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Ct(this,ai.REQUEST_UPDATE_CONSTRAINTS,Array.from(wo(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),Ct(this,ai.REQUEST_UPDATE_CONSTRAINTS,Array.from(wo(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:i,cb:a}of this.statsRegistry)try{const c=a();t.push({processorID:n,processorName:r,type:i,stats:c})}catch(c){T.error(new q(O.UNEXPECTED_ERROR,c.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof ae&&(r=await r),t.push(Ut(Ut({},r),{},{direction:this.direction}))}catch(r){T.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class _y extends xt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),J(this,"context",void 0),J(this,"processSourceNode",void 0),J(this,"outputTrack",void 0),J(this,"processedNode",void 0),J(this,"clonedTrack",void 0),J(this,"outputNode",void 0),this.outputNode=new XJ}setVolume(){}createOutputTrack(){throw new q(O.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class XJ{disconnect(){}connect(){}}function JP(e){return new ae((t,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const a=Jn()?"canplay":"playing";i.addEventListener(a,()=>{const c=i.videoWidth,d=i.videoHeight;!c&&yt()||(r=!0,i.srcObject=null,i.remove(),t([c,d]))}),i.srcObject=new MediaStream([e]),i.play().catch(im),setTimeout(()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))},4e3)})}function zm(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=ps(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!QN()&&n.frameRate&&(t.frameRate=n.frameRate),BN()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),yt()&&(t.frameRate={ideal:30,max:30}),t}function XP(e){const t={};if(QN()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,ua()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){const n=Wm(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),tm()&&(t.sampleRate=void 0),t}const QJ=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:r,height:i}=e.getMediaStreamTrackSettings();let{frameRate:a=n,width:c=r,height:d=i}=t;if(!a||!c||!d)return;c=WT(c),d=WT(d),a=WT(a);const{max:u,min:p}=function(S,I,v){const y=200*Math.pow(v/15,.6)*Math.pow(S*I/640/360,.75);return{min:Math.floor(y),max:Math.floor(4*y)}}(c,d,a),{bitrateMax:f,bitrateMin:m}=t||{};f||T.debug("calculate bitrate: [w: ".concat(c,", h: ").concat(d,", fps: ").concat(a,"] => [brMax: ").concat(f,", brMin: ").concat(m,"]"));const{maxFramerate:E}=P("ENCODER_CONFIG_LIMIT");return E&&typeof E=="number"&&(a=Math.min(a,E)),{frameRate:a,bitrateMax:f||u,bitrateMin:m||p,scaleResolutionDownBy:1,scale:0}},QP=async(e,t,n)=>await(async(r,i,a)=>{const c=function(p){const f=[];for(let m=0;m<p.length;m+=2)f.push(parseInt(p.slice(m,m+2),16));return Uint8Array.from(f)}(_1(""+i+a)).slice(0,16),d=c.slice(0,12),u=await window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:d},u,r))})(e.buffer,t,n),Ey=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new ae((n,r)=>{t.toBlob(async i=>{if(t.remove(),i){const a=await ZP(i);n({buffer:a,width:t.width,height:t.height})}else r(new q(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},ZP=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var $P,eL,tL,nL,rL,iL,oL,sL,aL,cL,dL,lL,uL,hL,pL,fL,mL,_L,Gt,EL,gL,SL,TL,vL,yL,ms,CL,RL,wL,IL,AL,bL,OL,NL,DL,PL,LL,kL,ML,Kn;let qt=($P=be({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),eL=be({argsMap:(e,t)=>[e.getTrackId(),t]}),tL=$t(),nL=zd("LocalAudioTrack","_enabledMutex"),rL=be({argsMap:(e,t)=>[e.getTrackId(),t]}),iL=$t(),oL=zd("LocalAudioTrack","_enabledMutex"),sL=be({argsMap:(e,t)=>[e.getTrackId(),t]}),aL=$t(),cL=$t(),dL=$t(),lL=be({argsMap:e=>[e.getTrackId()]}),uL=$t(),hL=be({argsMap:e=>[e.getTrackId()]}),pL=$t(),fL=be({argsMap:e=>[e.getTrackId()]}),mL=be({argsMap:(e,t)=>[e.getTrackId(),t.name]}),_L=be({argsMap:e=>[e.getTrackId()]}),$e((Gt=class extends gl{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Rr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),J(this,"trackMediaType","audio"),J(this,"_encoderConfig",void 0),J(this,"_trackSource",void 0),J(this,"_enabled",!0),J(this,"_volume",100),J(this,"_useAudioElement",!0),J(this,"_bypassWebAudio",!1),J(this,"processor",void 0),J(this,"_processorContext",void 0),J(this,"_processorDestination",void 0),J(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new _y,P("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),P("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Cn()&&!ci?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){St(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Rr.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void T.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,Ct(this,fe.NEED_REPLACE_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{T.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!OP())throw new q(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Rr.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Ct(this,fe.NEED_ENABLE_TRACK,this),T.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw n||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Ct(this,fe.NEED_DISABLE_TRACK,this)}catch(r){throw n||(this._enabled=!0),T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Ct(this,fe.NEED_MUTE_TRACK,this):await Ct(this,fe.NEED_UNMUTE_TRACK,this))}getStats(){return pa(()=>{T.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Kr(this,fe.GET_STATS)||Ut({},dy)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(si.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(si.ON_AUDIO_BUFFER),this._source.on(si.ON_AUDIO_BUFFER,n=>e(n))}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Rr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Rr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Rr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ct(this,fe.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return ae.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new q(O.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new q(O.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(gr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await Ct(this,fe.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ct(this,fe.NEED_REPLACE_TRACK,this))}),e.on(gr.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(gr.ON_TRACK),e.removeAllListeners(gr.ON_NODE)}bindProcessorContextEvents(e){e.on(ai.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(ai.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof _y&&(this._trackSource=new VP(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new qP(this._source.context,this.getTrackId(),"local"),t=new YP(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(si.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Rr.stop(this.getTrackId()),this._source.play()),Ct(this,fe.NEED_REPLACE_MIXING_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{T.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[$P],Object.getOwnPropertyDescriptor(Gt.prototype,"setVolume"),Gt.prototype),$e(Gt.prototype,"setPlaybackDevice",[eL,tL],Object.getOwnPropertyDescriptor(Gt.prototype,"setPlaybackDevice"),Gt.prototype),$e(Gt.prototype,"setEnabled",[nL,rL,iL],Object.getOwnPropertyDescriptor(Gt.prototype,"setEnabled"),Gt.prototype),$e(Gt.prototype,"setMuted",[oL,sL,aL],Object.getOwnPropertyDescriptor(Gt.prototype,"setMuted"),Gt.prototype),$e(Gt.prototype,"getStats",[cL],Object.getOwnPropertyDescriptor(Gt.prototype,"getStats"),Gt.prototype),$e(Gt.prototype,"setAudioFrameCallback",[dL],Object.getOwnPropertyDescriptor(Gt.prototype,"setAudioFrameCallback"),Gt.prototype),$e(Gt.prototype,"play",[lL,uL],Object.getOwnPropertyDescriptor(Gt.prototype,"play"),Gt.prototype),$e(Gt.prototype,"stop",[hL,pL],Object.getOwnPropertyDescriptor(Gt.prototype,"stop"),Gt.prototype),$e(Gt.prototype,"close",[fL],Object.getOwnPropertyDescriptor(Gt.prototype,"close"),Gt.prototype),$e(Gt.prototype,"pipe",[mL],Object.getOwnPropertyDescriptor(Gt.prototype,"pipe"),Gt.prototype),$e(Gt.prototype,"unpipe",[_L],Object.getOwnPropertyDescriptor(Gt.prototype,"unpipe"),Gt.prototype),Gt),Ym=(EL=be({argsMap:(e,t)=>[e.getTrackId(),t]}),gL=$t(),SL=zd("MicrophoneAudioTrack","_enabledMutex"),TL=be({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),vL=$t(),yL=be({argsMap:e=>[e.getTrackId()]}),$e((ms=class extends qt{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?Wm(t.encoderConfig):{},r,P("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),J(this,"_config",void 0),J(this,"_deviceName","default"),J(this,"_constraints",void 0),J(this,"_originalConstraints",void 0),J(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Wd()||xT())&&Et.bindInterruptDetectorTrack(this)}async setDevice(e){if(T.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await li.getDeviceById(e),n={};n.audio=Ut({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await di(n,this.getTrackId())}catch(i){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),i.toString()),r=await di({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await li.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}T.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return T.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),P("AUTO_RESET_AUDIO_ROUTE")&&(Jn()||Ki())){const c=navigator.audioSession;c&&(e||(c.type="playback"),c.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),n||(this._enabled=!1);try{await Ct(this,fe.NEED_DISABLE_TRACK,this)}catch(c){throw T.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}const i=Ut({},this._constraints),a=li.searchDeviceIdByName(this._deviceName);a&&!i.deviceId&&(i.deviceId=a);try{n||(this._enabled=!0);const c=await di({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await Ct(this,fe.NEED_ENABLE_TRACK,this)}catch(c){throw n||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}T.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Wd()||xT())&&Et.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Jn()||Ki())&&this._enabled&&!this._isClosed&&Et.duringInterruption){const e=async()=>{Et.off(xn.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Et.on(xn.IOS_INTERRUPTION_END,e)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(_l.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=li.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const r=await di({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(ai.REQUEST_UPDATE_CONSTRAINTS,async(t,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(ai.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[EL,gL],Object.getOwnPropertyDescriptor(ms.prototype,"setDevice"),ms.prototype),$e(ms.prototype,"setEnabled",[SL,TL,vL],Object.getOwnPropertyDescriptor(ms.prototype,"setEnabled"),ms.prototype),$e(ms.prototype,"close",[yL],Object.getOwnPropertyDescriptor(ms.prototype,"close"),ms.prototype),ms),ZJ=(CL=be({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),RL=$t(),wL=be({argsMap:e=>[e.getTrackId()]}),IL=$t(),AL=be({argsMap:e=>[e.getTrackId()]}),bL=$t(),OL=be({argsMap:e=>[e.getTrackId()]}),NL=$t(),DL=be({argsMap:e=>[e.getTrackId()]}),PL=$t(),LL=be({argsMap:e=>[e.getTrackId()]}),kL=be({argsMap:e=>[e.getTrackId()]}),ML=$t(),$e((Kn=class extends qt{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),J(this,"source",void 0),J(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(si.AUDIO_SOURCE_STATE_CHANGE,i=>{this.safeEmit(_l.SOURCE_STATE_CHANGE,i)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){St(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[CL,RL],Object.getOwnPropertyDescriptor(Kn.prototype,"startProcessAudioBuffer"),Kn.prototype),$e(Kn.prototype,"pauseProcessAudioBuffer",[wL,IL],Object.getOwnPropertyDescriptor(Kn.prototype,"pauseProcessAudioBuffer"),Kn.prototype),$e(Kn.prototype,"seekAudioBuffer",[AL,bL],Object.getOwnPropertyDescriptor(Kn.prototype,"seekAudioBuffer"),Kn.prototype),$e(Kn.prototype,"resumeProcessAudioBuffer",[OL,NL],Object.getOwnPropertyDescriptor(Kn.prototype,"resumeProcessAudioBuffer"),Kn.prototype),$e(Kn.prototype,"stopProcessAudioBuffer",[DL,PL],Object.getOwnPropertyDescriptor(Kn.prototype,"stopProcessAudioBuffer"),Kn.prototype),$e(Kn.prototype,"close",[LL],Object.getOwnPropertyDescriptor(Kn.prototype,"close"),Kn.prototype),$e(Kn.prototype,"setAudioBufferPlaybackSpeed",[kL,ML],Object.getOwnPropertyDescriptor(Kn.prototype,"setAudioBufferPlaybackSpeed"),Kn.prototype),Kn);class gn extends qt{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Sl().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Rt(8,"track-mix-")),J(this,"trackList",void 0),J(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(T.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):T.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){T.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}nm(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof gn?n.emit(jc.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class $J extends UP{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(si.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),J(this,"audioBuffer",void 0),J(this,"sourceNode",void 0),J(this,"startPlayTime",0),J(this,"startPlayOffset",0),J(this,"pausePlayTime",0),J(this,"options",void 0),J(this,"currentLoopCount",0),J(this,"currentPlaybackSpeed",100),J(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):T.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const xL=new Map;class gy{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const t=this.renderStats.curTs-this.renderStats.lastTs,n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/t;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(T.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){J(this,"trackId",void 0),J(this,"config",void 0),J(this,"onFirstVideoFrameDecoded",void 0),J(this,"onVideoStateChanged",void 0),J(this,"freezeTimeCounterList",[]),J(this,"renderFreezeAccTime",0),J(this,"isKeepLastFrame",!1),J(this,"timeUpdatedCount",0),J(this,"freezeTime",0),J(this,"playbackTime",0),J(this,"lastTimeUpdatedTime",0),J(this,"autoplayFailed",!1),J(this,"videoTrack",void 0),J(this,"videoElement",void 0),J(this,"cacheVideoElement",void 0),J(this,"renderStats",void 0),J(this,"_videoState",fs.VideoStateStopped),J(this,"videoElementCheckInterval",void 0),J(this,"videoElementFreezeTimeout",void 0),J(this,"_videoElementStatus",ar.NONE),J(this,"isGettingVideoDimensions",!1),J(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return T.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),J(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Et.curState==="running"&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(FN())),JN()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),J(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=ar.PLAYING;break;case"loadeddata":if(this.videoState=fs.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=ar.CANPLAY;break;case"stalled":this.videoElementStatus=ar.STALLED;break;case"suspend":this.videoElementStatus=ar.SUSPEND;break;case"pause":this.videoElementStatus=ar.PAUSED,Jn()||Ki()||Cn()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=ar.WAITING;break;case"abort":this.videoElementStatus=ar.ABORT;break;case"ended":this.videoElementStatus=ar.ENDED;break;case"emptied":this.videoElementStatus=ar.EMPTIED;break;case"error":{const r=this.videoElement.error;r?(this.videoElementStatus=ar.ERROR,T.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")"))):T.debug("[".concat(this.trackId,"] media not been an error."));break}case"timeupdate":{const r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);const i=r-this.lastTimeUpdatedTime,a=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,js.lastVisibleTime<js.lastHiddenTime||a<js.lastHiddenTime||a<js.lastVisibleTime)return;for(i>P("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;const c=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(c),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),J(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(FN())),JN()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Et.on(xn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Et.on(xn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(i=>{t&&HP(t,"video",i.message,this.trackId),i.name==="NotAllowedError"?(T.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):T.warning("[".concat(this.trackId,"] play warning: "),i)});const r=tt();if((r.name==="Safari"&&Number(r.version)===15||Wd())&&n&&n.then){const i=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(i).catch(i)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return T.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height);return t.remove(),r}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,r.width,r.height),new ae((a,c)=>{r.toBlob(async d=>{if(r.remove(),d){const u=await ZP(d);a({buffer:u,width:r.width,height:r.height})}else c(new q(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await Ey(t)}destroy(){this.renderStats=void 0,Et.off(xn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Et.off(xn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=fs.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=ar.INIT,!this.videoElementCheckInterval&&(UL.forEach(a=>{this.videoElement.addEventListener(a,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(a){return a!==document.body&&document.body.contains(a)})(this.videoElement)||(this.videoElementStatus=ar.DESTROYED)},1e3),P("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let a;const c=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",c),this.videoElementFreezeTimeout=window.setTimeout(d,P("VIDEO_FREEZE_DURATION")))},d=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===fs.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=fs.VideoStateFrozen:document.addEventListener("visibilitychange",c))},u=(p,f)=>{if(this.videoElementStatus===ar.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=f.mediaTime):this.renderStats={lastTs:f.mediaTime,curTs:f.mediaTime,lastRenderNum:0,renderNum:0},a){const S=f.presentationTime-a.presentationTime;this.videoState===fs.VideoStateStarting&&(this.videoState=fs.VideoStateDecoding),this.videoState===fs.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(d,P("VIDEO_FREEZE_DURATION"))),S<P("VIDEO_FREEZE_DURATION")&&this.videoState===fs.VideoStateFrozen&&(this.videoState=fs.VideoStateDecoding),S>P("VIDEO_FREEZE_DURATION")&&js.lastVisibleTime>=js.lastHiddenTime&&a.timestamp>js.lastVisibleTime&&a.timestamp>js.lastHiddenTime&&(this.renderFreezeAccTime+=S)}a=Ut(Ut({},f),{},{timestamp:p})}var m,E;P("ENABLE_VIDEO_FRAME_CALLBACK")&&((m=(E=this.videoElement).requestVideoFrameCallback)===null||m===void 0||m.call(E,u))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,u)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),tm()&&!P("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const r=tt();r.name==="Safari"&&Number(r.version)===15||Wd()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,yt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,yt()&&this.videoElement.load());const i=this.videoElement.play();i!==void 0&&i.catch(a=>{T.debug("[".concat(this.trackId,"] playback interrupted"),a.toString())})}resetVideoElement(){UL.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=ar.NONE}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{T.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{T.error(r)}),this.autoplayFailed=!1,Ju()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Ju()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),WP()}}const UL=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class VL extends gy{constructor(t){super(t),J(this,"container",void 0),J(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,r):await Ey(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",P("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var jL,FL,BL,GL,WL,HL,KL,zL,YL,qL,JL,XL,QL,ZL,$L,ek,tk,nk,rk,ik,ok,sk,ak,ck,dk,Xe,lk,uk,hk,pk,fk,mk,_k,Ek,hi;let wt=(jL=be({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),FL=$t(),BL=be({argsMap:e=>[e.getTrackId()]}),GL=zd("LocalVideoTrack","_enabledMutex"),WL=be({argsMap:(e,t)=>[e.getTrackId(),t]}),HL=$t(),KL=zd("LocalVideoTrack","_enabledMutex"),zL=be({argsMap:(e,t)=>[e.getTrackId(),t]}),YL=$t(),qL=be({argsMap:(e,t)=>[e.getTrackId(),t]}),JL=$t(),XL=$t(),QL=be({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),ZL=$t(),$L=$t(),ek=$t(),tk=$t(),nk=$t(),rk=$t(),ik=$t(),ok=be({argsMap:(e,t)=>[e.getTrackId(),t.name]}),sk=be({argsMap:e=>[e.getTrackId()]}),ak=be({argsMap:e=>[e.getTrackId()]}),ck=be({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),dk=be(),Xe=class O4 extends gl{get videoHeight(){if(Cn()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Cn()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ar.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,r,i,a,c){if(super(t,a),J(this,"trackMediaType","video"),J(this,"_player",void 0),J(this,"isUseScaleResolutionDownBy",!1),J(this,"_videoVisibleTimer",null),J(this,"_statsTimer",null),J(this,"_previousVideoVisibleStatus",void 0),J(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),J(this,"_encoderConfig",void 0),J(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),J(this,"_optimizationMode",void 0),J(this,"_videoHeight",void 0),J(this,"_videoWidth",void 0),J(this,"_forceBitrateLimit",void 0),J(this,"_enabled",!0),J(this,"_processorDestination",void 0),J(this,"_processorContext",void 0),Cn()){const{width:d,height:u}=t.getSettings();this._videoWidth=d,this._videoHeight=u}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=r,this._optimizationMode=i,this._hints=c||[],this._hints.indexOf(Ot.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(d,u,p){const f=tt();return!(f.name!==d||!f.osVersion)&&Number(f.version)===u}(dt.CHROME,115)&&$f().indexOf("Windows")!==-1){const d=function(u,p){if("VideoFrame"in window&&"TransformStream"in window&&Ze().supportWebRTCInsertableStream){const f=new MediaStreamTrackProcessor(u),m=new MediaStreamTrackGenerator({kind:"video"});let E,S,I=Date.now();const v=()=>{y&&(clearInterval(y),y=void 0),E&&(E.close(),E=void 0),u.stop(),S=void 0,m.removeEventListener("ended",v)};let y=window.setInterval(()=>{if(S&&E&&Date.now()-I>1e3)try{m.readyState==="live"?S.enqueue(E.clone()):v()}catch{v()}},1e3);const A=new TransformStream({transform:(N,V)=>{m.readyState==="live"?(S=V,I=Date.now(),E===void 0?(E=N,V.enqueue(N.clone())):(V.enqueue(E),E=N)):N.close()}});return m.addEventListener("ended",v),f.readable.pipeThrough(A).pipeTo(m.writable),m}}(t);d&&(T.info("local screen video track begin to inject frame"),this._mediaStreamTrack=d)}n&&this._hints.indexOf(Ot.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new zP(this.getTrackId(),"local"),this._processorDestination=new KP(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const r=Ut(Ut(Ut({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new gy(r):this._player=new VL(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(_l.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},P("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._statsTimer&&(this.isUseScaleResolutionDownBy=!1,window.clearInterval(this._statsTimer),this._statsTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await Ct(this,fe.NEED_DISABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return n||(this._enabled=!1),void T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Ct(this,fe.NEED_ENABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Ct(this,fe.NEED_MUTE_TRACK,this):await Ct(this,fe.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,n){if(!this._enabled)throw new q(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),t=ps(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const r=zm({encoderConfig:t});(Cn()||Jn()||Ki())&&(r.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(i){const a=new q(O.UNEXPECTED_ERROR,i.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}}this._encoderConfig=t,this._hints.indexOf(Ot.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Ct(this,fe.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(T)}}getStats(){return pa(()=>{T.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Kr(this,fe.GET_STATS)||Ut({},ly)}async setBeautyEffect(t){T.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await Ey(t)}async setBitrateLimit(t){if(T.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await Ct(this,fe.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(T)}}}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void T.error(O.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await Ct(this,fe.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=n,T.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}T.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return T.error(O.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,T.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){JP(this._originMediaStreamTrack).then(t=>{let[n,r]=t;this._videoHeight=r,this._videoWidth=n}).catch(im)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new q(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");T.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=ps(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Ot.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Ct(this,fe.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(T)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!n||!r)return;const{bitrateMax:i,bitrateMin:a}=this._encoderConfig;if(a==null||i==null){const{max:c,min:d}=function(u,p,f,m,E){const S=P("BITRATE_ADAPTER_TYPE");if(S==="DEFAULT_BITRATE")return{min:m,max:E};if(E===void 0){var I;const y=Math.floor(200*Math.pow(f/15,.6)*Math.pow(u*p/640/360,.75));E=S==="STANDARD_BITRATE"?4*y:2*y,m=(I=m)!==null&&I!==void 0?I:y}else{var v;m=(v=m)!==null&&v!==void 0?v:Math.floor(E/10)}return{min:m,max:E}}(t,n,r,a,i);this._encoderConfig.bitrateMin=d,this._encoderConfig.bitrateMax=c,T.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(c,", brMin: ").concat(d,"]"))}}getVideoElementVisibleStatus(){try{var t,n;const r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:a,slot:c}=i;if(this.isPlaying&&a instanceof HTMLVideoElement&&c instanceof HTMLElement){const d=n1.checkOneElementVisible(a),u=Object.assign({},d);if(u.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=u.visible;const p=ye.reportApiInvoke(null,{tag:Kt.TRACER,name:ln.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});u.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(u.reason))}return u}return}catch(r){throw new q(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new q(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=Ut(Ut({},r),ps(t))),r=Cc(r);const i=Rt(8,"track-video-cloned-"),a=new O4(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,Cc(this._scalabilityMode),this._optimizationMode,i,Cc(this._hints));return t&&r&&a.setEncoderConfiguration(r),T.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),a}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new q(O.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new q(O.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}startMonitorStats(){if(!Cn()&&!Jn())return;this._statsTimer&&window.clearInterval(this._statsTimer);let t=2,n=Bm[t],r=-1,i=Date.now();const a=c=>{c>2||c<0||(i=Date.now(),n=Bm[c],this.setSenderConfiguration(n))};this.isUseScaleResolutionDownBy=!0,this._statsTimer=window.setInterval(()=>{const c=this.getStats(),d=Kr(this,fe.GET_RTC_STATS);if(c.sendPackets>0&&d){r===-1&&(r=Date.now());const u=Date.now();if(u-r<1e3||u-i<P("PROFILE_SWITCH_INTERVAL"))return;const p=c.sendFrameRate,f=.6*n.frameRate,m=.9*n.frameRate;typeof p=="number"&&p>0&&p<f?t>0&&(t--,a(t),T.debug("[".concat(this.getTrackId(),"] step down for fps ").concat(p,", switchProfile to ").concat(t))):d.OutgoingAvailableBandwidth<n.bitrateMin?t>0&&(t--,a(t),T.debug("[".concat(this.getTrackId(),"] step down for OutgoingAvailableBandwidth ").concat(d.OutgoingAvailableBandwidth,", bitrateMin ").concat(n.bitrateMin,", switchProfile to ").concat(t))):typeof p=="number"&&p>m&&t<Bm.length-1&&d.OutgoingAvailableBandwidth>1.2*Bm[t+1].bitrateMin&&(t++,a(t),T.debug("[".concat(this.getTrackId(),"] step up for fps ").concat(p,", OutgoingAvailableBandwidth ").concat(d.OutgoingAvailableBandwidth,", switchProfile to ").concat(t)))}},P("CHECK_LOCAL_STATS_INTERVAL"))}sendSeiData(t){if(pa(()=>{ye.reportApiInvoke(null,{name:ln.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Kt.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!P("ENABLE_VIDEO_SEI")||!P("ENABLE_ENCODED_TRANSFORM"))return void T.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new q(O.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void T.warning("Video track is not published, SEI can not be send");const r=n.sender.getParameters();if(r.codecs.length===0)return;const i=r.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"?this.safeEmit("sei-to-send",t):T.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(gr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await Ct(this,fe.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ct(this,fe.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(gr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(ai.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(ai.REQUEST_CONSTRAINTS)}},$e(Xe.prototype,"play",[jL,FL],Object.getOwnPropertyDescriptor(Xe.prototype,"play"),Xe.prototype),$e(Xe.prototype,"stop",[BL],Object.getOwnPropertyDescriptor(Xe.prototype,"stop"),Xe.prototype),$e(Xe.prototype,"setEnabled",[GL,WL,HL],Object.getOwnPropertyDescriptor(Xe.prototype,"setEnabled"),Xe.prototype),$e(Xe.prototype,"setMuted",[KL,zL,YL],Object.getOwnPropertyDescriptor(Xe.prototype,"setMuted"),Xe.prototype),$e(Xe.prototype,"setEncoderConfiguration",[qL,JL],Object.getOwnPropertyDescriptor(Xe.prototype,"setEncoderConfiguration"),Xe.prototype),$e(Xe.prototype,"getStats",[XL],Object.getOwnPropertyDescriptor(Xe.prototype,"getStats"),Xe.prototype),$e(Xe.prototype,"setBeautyEffect",[QL,ZL],Object.getOwnPropertyDescriptor(Xe.prototype,"setBeautyEffect"),Xe.prototype),$e(Xe.prototype,"getCurrentFrameData",[$L],Object.getOwnPropertyDescriptor(Xe.prototype,"getCurrentFrameData"),Xe.prototype),$e(Xe.prototype,"getCurrentFrameImage",[ek],Object.getOwnPropertyDescriptor(Xe.prototype,"getCurrentFrameImage"),Xe.prototype),$e(Xe.prototype,"setBitrateLimit",[tk],Object.getOwnPropertyDescriptor(Xe.prototype,"setBitrateLimit"),Xe.prototype),$e(Xe.prototype,"setOptimizationMode",[nk],Object.getOwnPropertyDescriptor(Xe.prototype,"setOptimizationMode"),Xe.prototype),$e(Xe.prototype,"setScalabiltyMode",[rk],Object.getOwnPropertyDescriptor(Xe.prototype,"setScalabiltyMode"),Xe.prototype),$e(Xe.prototype,"updateMediaStreamTrackResolution",[ik],Object.getOwnPropertyDescriptor(Xe.prototype,"updateMediaStreamTrackResolution"),Xe.prototype),$e(Xe.prototype,"pipe",[ok],Object.getOwnPropertyDescriptor(Xe.prototype,"pipe"),Xe.prototype),$e(Xe.prototype,"unpipe",[sk],Object.getOwnPropertyDescriptor(Xe.prototype,"unpipe"),Xe.prototype),$e(Xe.prototype,"close",[ak],Object.getOwnPropertyDescriptor(Xe.prototype,"close"),Xe.prototype),$e(Xe.prototype,"replaceTrack",[ck],Object.getOwnPropertyDescriptor(Xe.prototype,"replaceTrack"),Xe.prototype),$e(Xe.prototype,"startMonitorStats",[dk],Object.getOwnPropertyDescriptor(Xe.prototype,"startMonitorStats"),Xe.prototype),Xe),Sy=(lk=be({argsMap:(e,t)=>[e.getTrackId(),t]}),uk=$t(),hk=zd("CameraVideoTrack","_enabledMutex"),pk=be({argsMap:(e,t)=>[e.getTrackId(),t]}),fk=$t(),mk=be({argsMap:(e,t)=>[e.getTrackId(),t]}),_k=$t(),Ek=be({argsMap:e=>[e.getTrackId()]}),hi=class N4 extends wt{get __className__(){return"CameraVideoTrack"}constructor(t,n,r,i,a,c){super(t,ps(n.encoderConfig),i,a,c),J(this,"_config",void 0),J(this,"_originalConstraints",void 0),J(this,"_constraints",void 0),J(this,"_enabled",!0),J(this,"_deviceName","default"),J(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Wd()||xT())&&!function(){const d=tt();if(d.os!==yn.IOS||!d.osVersion)return!1;const u=d.osVersion.split(".");return Number(u[0])===15&&Number(u[1])>=2}()&&XN()&&this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=r,this._constraints=r,this._deviceName=t.label,this._encoderConfig=ps(this._config.encoderConfig),Et.on(xn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Et.on(xn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(T.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await li.getDeviceById(t),r={};r.video=Ut({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await di(r,this.getTrackId())}catch(a){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),a.toString()),i=await di({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await li.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}T.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){T.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:Ut(Ut({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await di(n,this.getTrackId())}catch(i){throw T.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),r=await di({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Ut({},n.video),T.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const r=await di({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await Ct(this,fe.NEED_ENABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await Ct(this,fe.NEED_DISABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new q(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),t=ps(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const r=bt(this._config);r.encoderConfig=t;const i=zm(r);(Cn()||Jn()||Ki())&&(i.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(a){const c=new q(O.UNEXPECTED_ERROR,a.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=t,this._hints.indexOf(Ot.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Ct(this,fe.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(T)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Jn()||Ki())&&this._enabled&&!this._isClosed&&Et.duringInterruption){const t=async()=>{Et.off(xn.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Et.on(xn.IOS_INTERRUPTION_END,t)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(_l.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,r=li.searchDeviceIdByName(this._deviceName);if(r&&!n.deviceId&&(n.deviceId={exact:r}),this._enabled){const i=await di({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Et.off(xn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Et.off(xn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=Ut(Ut({},r),ps(t))),r=Cc(r);const i=Rt(8,"track-cam-cloned-"),a=new N4(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,Cc(Ut(Ut({},this._config),{},{encoderConfig:r})),Cc(this._constraints),Cc(this._scalabilityMode),this._optimizationMode,i);return t&&r&&a.setEncoderConfiguration(r),T.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),a}bindProcessorContextEvents(){this.processorContext.on(ai.REQUEST_UPDATE_CONSTRAINTS,async(t,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}}),this.processorContext.on(ai.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},$e(hi.prototype,"setDevice",[lk,uk],Object.getOwnPropertyDescriptor(hi.prototype,"setDevice"),hi.prototype),$e(hi.prototype,"setEnabled",[hk,pk,fk],Object.getOwnPropertyDescriptor(hi.prototype,"setEnabled"),hi.prototype),$e(hi.prototype,"setEncoderConfiguration",[mk,_k],Object.getOwnPropertyDescriptor(hi.prototype,"setEncoderConfiguration"),hi.prototype),$e(hi.prototype,"close",[Ek],Object.getOwnPropertyDescriptor(hi.prototype,"close"),hi.prototype),hi);function Ty(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=Ut(Ut({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?T.debug("[".concat(e,"] set content hint to"),n.optimizationMode):T.debug("[".concat(e,"] set content hint failed")))):T.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var gk,Sk,Tk,vk,bi,yk,Ck,Rk,wk,Ik,Ak,cr;class bk extends kP{getUserId(){return this._userId}constructor(t,n,r,i){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(i.clientId,"_").concat(Rt(5,""))),J(this,"_userId",void 0),J(this,"_uintId",void 0),J(this,"_isDestroyed",!1),J(this,"store",void 0),J(this,"processor",void 0),J(this,"processorContext",void 0),this._userId=n,this._uintId=r,this.store=i}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,T.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let vl=(gk=be({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Sk=be({argsMap:e=>[e.getTrackId()]}),Tk=be({argsMap:(e,t)=>[e.getTrackId(),t.name]}),vk=be({argsMap:e=>[e.getTrackId()]}),$e((bi=class extends bk{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ar.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r){super(e,t,n,r),J(this,"_videoVisibleTimer",null),J(this,"_previousVideoVisibleStatus",void 0),J(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),J(this,"trackMediaType","video"),J(this,"_videoWidth",void 0),J(this,"_videoHeight",void 0),J(this,"_player",void 0),J(this,"processorDestination",void 0),J(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new zP(this.getTrackId(),"remote"),this.processorDestination=new KP(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return pa(()=>{T.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Kr(this,fe.GET_STATS)||Ut({},PP)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const r=document.getElementById(e);r?e=r:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=Ut(Ut({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new gy(n):this._player=new VL(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(El.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=r=>{this.safeEmit(El.VIDEO_STATE_CHANGED,r)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(El.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},P("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){JP(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(im)}_updatePlayerSource(){T.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:i,slot:a}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&a instanceof HTMLElement){const c=n1.checkOneElementVisible(i),d=Object.assign({},c);if(d.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=d.visible;const u=ye.reportApiInvoke(null,{tag:Kt.TRACER,name:ln.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});d.visible?u.onSuccess("Video is visible"):u.onSuccess("Invisible because of ".concat(d.reason))}return d}return}catch(n){throw new q(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new q(O.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(gr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(gr.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(jc.SEI_RECEIVED,e)}}).prototype,"play",[gk],Object.getOwnPropertyDescriptor(bi.prototype,"play"),bi.prototype),$e(bi.prototype,"stop",[Sk],Object.getOwnPropertyDescriptor(bi.prototype,"stop"),bi.prototype),$e(bi.prototype,"pipe",[Tk],Object.getOwnPropertyDescriptor(bi.prototype,"pipe"),bi.prototype),$e(bi.prototype,"unpipe",[vk],Object.getOwnPropertyDescriptor(bi.prototype,"unpipe"),bi.prototype),bi),yl=(yk=be({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),Ck=be({argsMap:(e,t)=>[e.getTrackId(),t]}),Rk=be({argsMap:e=>[e.getTrackId()]}),wk=be({argsMap:e=>[e.getTrackId()]}),Ik=be({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Ak=be({argsMap:e=>[e.getTrackId()]}),$e((cr=class extends bk{get isPlaying(){return this._useAudioElement?Rr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),J(this,"trackMediaType","audio"),J(this,"_source",void 0),J(this,"_useAudioElement",!0),J(this,"_volume",100),J(this,"processorContext",void 0),J(this,"processorDestination",void 0),J(this,"_played",!1),J(this,"_bypassWebAudio",!1),P("DISABLE_WEBAUDIO")?(this._source=new _y,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new VP(e,!0),P("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(si.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(El.FIRST_FRAME_DECODED)}),this.processorContext=new qP(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new YP(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(si.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(si.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(si.ON_AUDIO_BUFFER),this._source.on(si.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?Rr.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!OP())throw new q(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Rr.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return pa(()=>{T.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Kr(this,fe.GET_STATS)||Ut({},DP)}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] use audio element to play")),Rr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Rr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Rr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new q(O.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new q(O.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new q(O.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(gr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(gr.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(gr.ON_TRACK),this.processorDestination.removeAllListeners(gr.ON_NODE)}}).prototype,"setVolume",[yk],Object.getOwnPropertyDescriptor(cr.prototype,"setVolume"),cr.prototype),$e(cr.prototype,"setPlaybackDevice",[Ck],Object.getOwnPropertyDescriptor(cr.prototype,"setPlaybackDevice"),cr.prototype),$e(cr.prototype,"play",[Rk],Object.getOwnPropertyDescriptor(cr.prototype,"play"),cr.prototype),$e(cr.prototype,"stop",[wk],Object.getOwnPropertyDescriptor(cr.prototype,"stop"),cr.prototype),$e(cr.prototype,"pipe",[Ik],Object.getOwnPropertyDescriptor(cr.prototype,"pipe"),cr.prototype),$e(cr.prototype,"unpipe",[Ak],Object.getOwnPropertyDescriptor(cr.prototype,"unpipe"),cr.prototype),cr);const js=new class extends xt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),J(this,"_lastHiddenTime",0),J(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),T.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};var Ok=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(Ok||{});class eX{constructor(){J(this,"_sequence",0),J(this,"_startTime",Date.now()),J(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const d=new Uint8Array(4);d.set([1,0,0,0]);const u={id:0,length:4,data:d.buffer},p={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[u]};n.commonPacketHeader.extension=1,n.extension=p,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;P("SHOW_DATASTREAM2_LOG")&&T.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const r=new ArrayBuffer(n.commonPacketHeader.length),i=new Uint8Array(r),a=new DataView(r);let c=0;if(a.setUint16(c,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),c+=2,a.setUint32(c,n.commonPacketHeader.sequence,!0),c+=4,a.setUint16(c,n.commonStreamHeader,!0),c+=2,n.extension){const d=this.serializeExtension(n.extension);i.set(new Uint8Array(d),c),c+=d.byteLength}if(i.set(new Uint8Array(n.payload),c),c+=n.payload.byteLength,c!==n.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let r=0;const i=n.getUint16(r,!0);r+=2;const a={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:n.getUint16(r+2,!0)<<16|n.getUint16(r,!0)};let c,d;if(r+=4,P("SHOW_DATASTREAM2_LOG")&&T.debug("receive data header: ".concat(JSON.stringify(a))),n.getUint16(r,!0),r+=2,a.extension){d=this.deserializeExtension(t.slice(r)),r+=2+d.length,c=t.slice(r);let u=!1;if(d.datas.length>0){const p=d.datas.find(f=>f.id===0);p&&(u=(1&new DataView(p.data).getUint32(0,!0))==1)}c=u?this.decompress(c):c}else c=t.slice(8);return c}serializeExtension(t){const{profile:n,length:r,datas:i}=t,a=new ArrayBuffer(r+2),c=new Uint8Array(a),d=new DataView(a);let u=0;if(d.setUint8(u++,n),d.setUint8(u++,r),i.forEach(p=>{n?(d.setUint8(u++,p.id),d.setUint8(u++,p.length),c.set(new Uint8Array(p.data),u),u+=p.data.byteLength):(d.setUint8(u++,p.id|p.length<<4),c.set(new Uint8Array(p.data),u),u+=p.data.byteLength)}),u!==r+2)throw Error("serialize extension error, is ".concat(u,"!==").concat(r+2));return a}deserializeExtension(t){const n=new DataView(t);let r=0;const i=n.getUint8(r);r++;const a=n.getUint8(r);r++;const c=i===Ok.TWO_BYTE,d=[],u=new DataView(t,2);let p=0;for(;p<a;){let f=0,m=0,E=new ArrayBuffer(0);c?(f=u.getUint8(p),p++,m=u.getUint8(p),p++):(f=15&u.getUint8(p),m=u.getUint8(p)>>4,p++),m>0&&(E=u.buffer.slice(p+2,p+2+m),p+=E.byteLength),d.push({id:f,length:m,data:E})}if(p!==a)throw Error("parse error");return{profile:i,length:a,datas:d}}decompress(t){return jJ(new Uint8Array(t))}compress(t){return VJ(new Uint8Array(t))}}class Nk extends xt{constructor(t,n){super(),J(this,"_version",1),J(this,"_type",3),J(this,"_config",void 0),J(this,"_originDataChannel",void 0),J(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),J(this,"_dataStreamPacketHandler",void 0),J(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader(),this._dataStreamPacketHandler=new eX}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return P("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ae((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const r=setTimeout(()=>{var i;n(new q(O.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new q(O.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new q(O.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[Hm.OPEN,Hm.CLOSE,Hm.ERROR].forEach(n=>{const r=()=>{this.emit(n)};this._datachannelEventMap.set(n,r),t.addEventListener(n,r)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[r,i]=n;t.removeEventListener(r,i)}),this._datachannelEventMap.clear()}}class tX extends Nk{constructor(t){super(t),J(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const r=n.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(r).getUint8(3);if(i!==this.id)return void(P("SHOW_DATASTREAM2_LOG")&&T.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let a=n.data.slice(this._dataStreamPacketHeader.byteLength);a=this._dataStreamPacketHandler.deserialize(a),this.emit(Hm.MESSAGE,a)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Dk extends Nk{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const r=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function qm(){const e=new Blob([atob("ZnVuY3Rpb24gZShlKXtjb25zdCB0PW5ldyBEYXRhVmlldyhlLmRhdGEpO2lmKDA9PT10LmdldFVpbnQ4KDApJiYwPT09dC5nZXRVaW50OCgxKSYmMD09PXQuZ2V0VWludDgoMikmJjE9PT10LmdldFVpbnQ4KDMpJiY2PT09dC5nZXRVaW50OCg0KSl7bGV0IG49NixyPTAsbz0wO2Zvcig7MjU1PT09KG89dC5nZXRVaW50OChuKyspKTspcis9MjU1O3IrPW87Y29uc3QgYT1mdW5jdGlvbihlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLG89W10sYT0wO2Zvcig7YTxuOylhKzM8biYmMD09PXJbYV0mJjA9PT1yW2ErMV0mJjM9PT1yW2ErMl0mJigwPT09clthKzNdfHwxPT09clthKzNdfHwyPT09clthKzNdfHwzPT09clthKzNdKT8oby5wdXNoKHJbYV0sclthKzFdLHJbYSszXSksYSs9NCk6KG8ucHVzaChyW2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShvKX0oZS5kYXRhLG4scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGEpfXJldHVybiBudWxsfWZ1bmN0aW9uIHQoZSx0KXtjb25zdCBuPWZ1bmN0aW9uKGUpe2NvbnN0IHQ9ZS5sZW5ndGg7bGV0IG49W10scj0wO2Zvcig7cjx0OylyKzI8dCYmMD09PWVbcl0mJjA9PT1lW3IrMV0mJigwPT09ZVtyKzJdfHwxPT09ZVtyKzJdfHwyPT09ZVtyKzJdfHwzPT09ZVtyKzJdKT8obi5wdXNoKGVbcl0sZVtyKzFdLDMsZVtyKzJdKSxyKz0zKToobi5wdXNoKGVbcl0pLHIrKyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KG4pfSh0KSxyPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihyLzI1NSksYT1yJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK3IrZS5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBpPTA7Zm9yKDtpPG87KXNbNitpXT0yNTUsaSsrO3JldHVybiBzWzYraV09YSxpKysscy5zZXQobiw2K2kpLHMuc2V0KG5ldyBVaW50OEFycmF5KGUpLDYraStyKSxzLmJ1ZmZlcn1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIlNhZmFyaSIpPi0xJiYtMT09PW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiQ2hyb21lIikmJihzZWxmLm9ucnRjdHJhbnNmb3JtPW49Pntjb25zdCByPW4udHJhbnNmb3JtZXI7bGV0IG89W107ci5vcHRpb25zLnBvcnQub25tZXNzYWdlPWU9PntlLmRhdGEuc2VpJiZvLnB1c2goZS5kYXRhLnNlaSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBhPXIucmVhZGFibGUuZ2V0UmVhZGVyKCkscz1yLndyaXRhYmxlLmdldFdyaXRlcigpOyJyeCI9PT1yLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2EucmVhZCgpLnRoZW4oKHI9PntpZighci5kb25lKXtpZihyLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7YS5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1vLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>BD.revokeObjectURL(e),0),new Worker(BD.createObjectURL(e))}const Jm=new Map,Xm=new Map,Qm=new Map;async function nX(e,t){if(!Ze().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(Qm.has(e)||!e.track)return;const n={track:e.track};if(ua()){if(!e.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(d){return void T.error("create video-encoded-streams error",d&&d.message)}let a=[];t.on("sei-to-send",d=>{a.push(d)});const c=new TransformStream({transform(d,u){n.controller||(n.controller=u),e.track&&e.track.id!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const p=a.shift();p&&(d.data=function(f,m){const E=function(N){const V=N.length;let F=[],G=0;for(;G<V;)G+2<V&&N[G]===0&&N[G+1]===0&&(N[G+2]===0||N[G+2]===1||N[G+2]===2||N[G+2]===3)?(F.push(N[G],N[G+1],3,N[G+2]),G+=3):(F.push(N[G]),G++);return new Uint8Array(F)}(m),S=E.length,I=Math.floor(S/255),v=S%255,y=new Uint8Array(6+I+1+S+f.byteLength);y[0]=0,y[1]=0,y[2]=0,y[3]=1,y[4]=6,y[5]=101;let A=0;for(;A<I;)y[6+A]=255,A++;return y[6+A]=v,A++,y.set(E,6+A),y.set(new Uint8Array(f),6+A+S),y.buffer}(d.data,p)),u.enqueue(d)}});i.readable.pipeThrough(c).pipeTo(i.writable)}else{if(!Cn())return;{if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const i=qm(),a=new MessageChannel;await new ae(d=>i.onmessage=u=>{u.data==="registered"&&d(void 0)});const c=new RTCRtpScriptTransform(i,{name:"tx",port:a.port2},[a.port2]);e.transform=c,await new ae(d=>i.onmessage=u=>{u.data==="started"&&d(void 0)}),t.on("sei-to-send",d=>{a.port1.postMessage({sei:d})}),a.port1.onmessage=d=>{var u;d.data.transformed&&e.track&&((u=e.track)===null||u===void 0?void 0:u.id)!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r))},n.worker=i}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=Qm.get(e);if(i){Qm.delete(e);try{var a,c;(a=i.controller)===null||a===void 0||a.terminate(),(c=i.worker)===null||c===void 0||c.terminate()}catch(d){T.warning(d&&d.message)}}}Qm.set(e,n),e.track.addEventListener("ended",r)}const Dh=new Map;async function rX(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ze().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(!e.track)return;if(Dh.has(e)){const i=Dh.get(e);return void(i&&(i.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(ua()){if(!e.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(c){return void T.error("create video-encoded-streams error",c&&c.message)}const a=new TransformStream({transform(c,d){n.controller||(n.controller=d),e.track&&e.track.id!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const u=function(p){const f=new DataView(p.data);if(f.getUint8(0)===0&&f.getUint8(1)===0&&f.getUint8(2)===0&&f.getUint8(3)===1&&f.getUint8(4)===6){let m=6,E=0,S=0;for(;(S=f.getUint8(m++))===255;)E+=255;E+=S;const I=function(v,y,A){let N=new Uint8Array(v,y,A),V=[],F=0;for(;F<A;)F+3<A&&N[F]===0&&N[F+1]===0&&N[F+2]===3&&(N[F+3]===0||N[F+3]===1||N[F+3]===2||N[F+3]===3)?(V.push(N[F],N[F+1],N[F+3]),F+=4):(V.push(N[F]),F++);return new Uint8Array(V)}(p.data,m,E);return new Uint8Array(I)}return null}(c);u&&n.onSei&&n.onSei(u),d.enqueue(c)}});i.readable.pipeThrough(a).pipeTo(i.writable)}else if(Cn()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const i=qm(),a=new MessageChannel;await new ae(d=>i.onmessage=u=>{u.data==="registered"&&d(void 0)});const c=new RTCRtpScriptTransform(i,{name:"rx",port:a.port2},[a.port2]);e.transform=c,await new ae(d=>i.onmessage=u=>{u.data==="started"&&d(void 0)}),a.port1.onmessage=d=>{var u;d.data.transformed&&e.track&&((u=e.track)===null||u===void 0?void 0:u.id)!==n.track.id?(T.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):d.data.sei&&n.onSei&&n.onSei(d.data.sei)},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}(function(i){const a=Dh.get(i);if(a){Dh.delete(i);try{var c,d;(c=a.controller)===null||c===void 0||c.terminate(),(d=a.worker)===null||d===void 0||d.terminate()}catch(u){T.warning(u&&u.message)}}})(e)}Dh.set(e,n),e.track.addEventListener("ended",r)}(function(){const e=tt();Hn.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Hn.getStreamFromExtension=e.name===dt.CHROME&&Number(e.version)>34,Hn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),Hn.supportMinBitrate=e.name===dt.CHROME||e.name===dt.EDGE,Hn.supportSetRtpSenderParameters=function(){const t=tt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!ha()||!(!Cn()&&!em())||t.name===dt.FIREFOX&&Number(t.version)>=64)}(),e.name===dt.SAFARI&&(Number(e.version)>=14?Hn.supportDualStream=!0:Hn.supportDualStream=!1),Hn.webAudioMediaStreamDest=function(){const t=tt();return!(t.name===dt.SAFARI&&Number(t.version)<12)}(),Hn.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Hn.supportWebGL=typeof WebGLRenderingContext<"u",Hn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,ha()||(Hn.webAudioWithAEC=!0),Hn.supportShareAudio=function(){const t=tt();return(t.os===yn.WIN_10||t.os===yn.WIN_81||t.os===yn.WIN_7||t.os===yn.LINUX||t.os===yn.MAC_OS||t.os===yn.CHROMIUM_OS)&&t.name===dt.CHROME&&Number(t.version)>=74}(),Hn.supportDataChannel=!!(MT(76)||function(t){const n=tt();return!(n.name!==dt.FIREFOX||!n.osVersion)&&Number(n.version)>=t}(68)||WN(14)),Hn.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!yt()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Hn.supportWebRTCEncodedTransform=function(){const t=tt();return t.name==="Chrome"&&Number(t.version)>=86||t.name==="Safari"&&Number(t.version)>=15}(),Hn.supportWebRTCInsertableStream=function(){const t=tt();return(t.name===dt.CHROME||t.name===dt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Hn.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Hn.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,rm(()=>{Hn.supportDualStreamEncoding=function(){const t=tt();return!!P("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&P("CHROME_DUAL_STREAM_USE_ENCODING"))}(),T.info("browser compatibility",JSON.stringify(Hn),JSON.stringify(e))})})();class iX extends xt{constructor(){super(...arguments),w(this,"resultStorage",new Map)}setLocalAudioStats(t,n,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,n))}setLocalVideoStats(t,n,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r))}setRemoteAudioStats(t,n){const r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(n))}record(t,n,r){if(P("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const i=this.resultStorage.get(t);if(i&&(i.result.push(r),i.result.length>=5)){var a;const c=le(a=i.result).call(a,!0);i.isPrevNormal&&!c&&this.emit("exception",Pk[t],t,n),!i.isPrevNormal&&c&&this.emit("exception",Pk[t]+2e3,t+"_RECOVER",n),i.isPrevNormal=c,i.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof gn&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let r=null;n._encoderConfig&&n._encoderConfig.frameRate&&(r=Dr(n._encoderConfig.frameRate));const i=t.captureFrameRate;return!r||!i||!(r>10&&i<5||r<10&&r>=5&&i<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof gn&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const Pk={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Qn=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function vy(e,t){this.v=e,this.k=t}function Be(e){return new vy(e,0)}var oX=EA,sX=es;At({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=sX.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var aX=es,cX=Od;At({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=aX.f(this),n=cX(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var yy=_(oX),Lk=kd.f("asyncIterator"),dX=_(Lk);function Ph(e){var t,n;function r(a,c){try{var d=e[a](c),u=d.value,p=u instanceof vy;yy.resolve(p?u.v:u).then(function(f){if(p){var m=a==="return"?"return":"next";if(!u.k||f.done)return r(m,f);f=e[m](f).value}i(d.done?"return":"normal",f)},function(f){r("throw",f)})}catch(f){i("throw",f)}}function i(a,c){switch(a){case"return":t.resolve({value:c,done:!0});break;case"throw":t.reject(c);break;default:t.resolve({value:c,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(a,c){return new yy(function(d,u){var p={key:a,arg:c,resolve:d,reject:u,next:null};n?n=n.next=p:(t=n=p,r(a,c))})},typeof e.return!="function"&&(this.return=void 0)}function Yr(e){return function(){return new Ph(e.apply(this,arguments))}}Ph.prototype[typeof Ud=="function"&&dX||"@@asyncIterator"]=function(){return this},Ph.prototype.next=function(e){return this._invoke("next",e)},Ph.prototype.throw=function(e){return this._invoke("throw",e)},Ph.prototype.return=function(e){return this._invoke("return",e)};var kk=_(To.Object.getOwnPropertySymbols),lX=At,uX=yg.indexOf,hX=Qp,Cy=mt([].indexOf),Mk=!!Cy&&1/Cy([1],1,-0)<0;lX({target:"Array",proto:!0,forced:Mk||!hX("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return Mk?Cy(this,e,t)||0:uX(this,e,t)}});var pX=Gi("Array").indexOf,fX=W,mX=pX,Ry=Array.prototype,_X=function(e){var t=e.indexOf;return e===Ry||fX(Ry,e)&&t===Ry.indexOf?mX:t},xk=_(_X);function EX(e,t){if(e==null)return{};var n,r,i=function(c,d){if(c==null)return{};var u,p,f={},m=A1(c);for(p=0;p<m.length;p++)u=m[p],xk(d).call(d,u)>=0||(f[u]=c[u]);return f}(e,t);if(kk){var a=kk(e);for(r=0;r<a.length;r++)n=a[r],xk(t).call(t,n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var Uk={exports:{}};(function(e,t){e.exports=(()=>{var n={8:(a,c,d)=>{d.r(c),d.d(c,{Parser:()=>Qe,Printer:()=>lo,parse:()=>Me,print:()=>st});const u=`
`,p="".concat("\r").concat(u),f=" ";let m;function E(ce){return ce>="0"&&ce<="9"}function S(ce){return ce>="!"&&ce<="~"}function I(ce){return S(ce)||ce>=""&&ce<="ÿ"}function v(ce){return ce==="!"||ce>="#"&&ce<="'"||ce>="*"&&ce<="+"||ce>="-"&&ce<="."||ce>="0"&&ce<="9"||ce>="A"&&ce<="Z"||ce>="^"&&ce<="~"}function y(ce){return ce>="1"&&ce<="9"}function A(ce){return ce>="A"&&ce<="Z"||ce>="a"&&ce<="z"}function N(ce){return ce==="d"||ce==="h"||ce==="m"||ce==="s"}function V(ce){return ce>""&&ce<"	"||ce>"\v"&&ce<"\f"||ce>""&&ce<"ÿ"}function F(ce){return A(ce)||E(ce)||ce==="+"||ce==="/"}function G(ce){return E(ce)||A(ce)||ce==="+"||ce==="/"||ce==="-"||ce==="_"}function z(ce){return A(ce)||E(ce)||ce==="+"||ce==="/"}function Q(ce,R){var k=Object.keys(ce);if(Object.getOwnPropertySymbols){var U=Object.getOwnPropertySymbols(ce);R&&(U=U.filter(function(re){return Object.getOwnPropertyDescriptor(ce,re).enumerable})),k.push.apply(k,U)}return k}function Z(ce){for(var R=1;R<arguments.length;R++){var k=arguments[R]!=null?arguments[R]:{};R%2?Q(Object(k),!0).forEach(function(U){ee(ce,U,k[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ce,Object.getOwnPropertyDescriptors(k)):Q(Object(k)).forEach(function(U){Object.defineProperty(ce,U,Object.getOwnPropertyDescriptor(k,U))})}return ce}function ee(ce,R,k){return R in ce?Object.defineProperty(ce,R,{value:k,enumerable:!0,configurable:!0,writable:!0}):ce[R]=k,ce}(function(ce){ce.VERSION="v",ce.ORIGIN="o",ce.SESSION_NAME="s",ce.INFORMATION="i",ce.URI="u",ce.EMAIL="e",ce.PHONE="p",ce.CONNECTION="c",ce.BANDWIDTH="b",ce.TIME="t",ce.REPEAT="r",ce.ZONE_ADJUSTMENTS="z",ce.KEY="k",ce.ATTRIBUTE="a",ce.MEDIA="m"})(m||(m={}));class me{consumeText(R,k){let U=k;for(;U<R.length;){const re=R[U];if(re==="\0"||re==="\r"||re===u)break;U+=1}if(U-k==0)throw new Error("Invalid text, at ".concat(R));return U}consumeUnicastAddress(R,k,U){return this.consumeTill(R,k,f)}consumeOneOrMore(R,k,U){let re=k;for(;U(R[re]);)re++;if(re-k==0)throw new Error("Invalid rule at ".concat(k,"."));return re}consumeSpace(R,k){if(R[k]===f)return k+1;throw new Error("Invalid space at ".concat(k,"."))}consumeIP4Address(R,k){let U=k;for(let re=0;re<4;re++)if(U=this.consumeDecimalUChar(R,U),re!==3){if(R[U]!==".")throw new Error("Invalid IP4 address.");U++}return U}consumeDecimalUChar(R,k){let U=k;for(let xe=0;xe<3&&E(R[U]);xe++,U++);if(U-k==0)throw new Error("Invalid decimal uchar.");const re=parseInt(R.slice(k,U));if(re>=0&&re<=255)return U;throw new Error("Invalid decimal uchar")}consumeIP6Address(R,k){let U=this.consumeHexpart(R,k);return R[U]===":"&&(U+=1,U=this.consumeIP4Address(R,U)),U}consumeHexpart(R,k){let U=k;if(R[U]===":"&&R[U+1]===":"){U+=2;try{U=this.consumeHexseq(R,U)}catch{}return U}if(U=this.consumeHexseq(R,U),R[U]===":"&&R[U+1]===":"){U+=2;try{U=this.consumeHexseq(R,U)}catch{}return U}return U}consumeHexseq(R,k){let U=k;for(;U=this.consumeHex4(R,U),R[U]===":"&&R[U+1]!==":";)U+=1;return U}consumeHex4(R,k){let U=0;for(;U<4;U++)if(!((re=R[k+U])>="0"&&re<="9"||re>="a"&&re<="f"||re>="A"&&re<="F")){if(U===0)throw new Error("Invalid hex 4");break}var re;return k+U}consumeFQDN(R,k){let U=k;for(;E(R[U])||A(R[U])||R[U]==="-"||R[U]===".";)U+=1;if(U-k<4)throw new Error("Invalid FQDN");return U}consumeExtnAddr(R,k){return this.consumeOneOrMore(R,k,I)}consumeMulticastAddress(R,k,U){switch(U){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(R,k);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(R,k);default:try{return this.consumeFQDN(R,k)}catch{return this.consumeExtnAddr(R,k)}}}consumeIP6MulticastAddress(R,k){const U=this.consumeHexpart(R,k);return R[U]==="/"?this.consumeInteger(R,U+1):U}consumeIP4MulticastAddress(R,k){let U=k+3;const re=R.slice(k,U),xe=parseInt(re);if(xe<224||xe>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let gt=0;gt<3;gt++){if(R[U]!==".")throw new Error("Invalid IP4 multicast address.");U+=1,U=this.consumeDecimalUChar(R,U)}return R[U]==="/"&&(U+=1),U=this.consumeTTL(R,U),R[U]==="/"&&(U=this.consumeInteger(R,U)),U}consumeInteger(R,k){if(!y(R[k]))throw new Error("Invalid integer.");for(k+=1;E(R[k]);)k+=1;return k}consumeTTL(R,k){if(R[k]==="0")return k+1;if(!y(R[k]))throw new Error("Invalid TTL.");k+=1;for(let U=0;U<2&&E(R[k]);U++)k+=1;return k}consumeToken(R,k){return this.consumeOneOrMore(R,k,v)}consumeTime(R,k){let U=k;if(R[U]==="0")return U+1;for(y(R[U])&&(U+=1);E(R[U]);)U++;if(U-k<10)throw new Error("Invalid time");return U}consumeAddress(R,k){return this.consumeTill(R,k,f)}consumeTypedTime(R,k){let U=k;return U=this.consumeOneOrMore(R,U,E),N(R[U])?U+1:U}consumeRepeatInterval(R,k){if(!y(R[k]))throw new Error("Invalid repeat interval");for(k+=1;E(R[k]);)k+=1;return N(R[k])&&(k+=1),k}consumePort(R,k){return this.consumeOneOrMore(R,k,E)}consume(R,k,U){for(let re=0;re<U.length;re++){if(k+re>=R.length)throw new Error("consume exceeding value length");if(R[k+re]!==U[re])throw new Error("consume ".concat(U," failed at ").concat(re))}return k+U.length}consumeTill(R,k,U){let re=k;for(;re<R.length&&(typeof U!="string"||R[re]!==U)&&(typeof U!="function"||!U(R[re]));)re++;return re}}class Qe extends me{constructor(){super(),ee(this,"records",[]),ee(this,"currentLine",0)}parse(R){const k=this.probeEOL(R);this.records=R.split(k).filter(fn=>!!ir(fn).call(fn)).map(this.parseLine),this.currentLine=0;const U=this.parseVersion(),re=this.parseOrigin(),xe=this.parseSessionName(),gt=this.parseInformation(),Tn=this.parseUri(),Mr=this.parseEmail(),Gs=this.parsePhone(),v_=this.parseConnection(),y_=this.parseBandWidth(),Pi=this.parseTimeFields(),Ua=this.parseKey(),Dl=this.parseSessionAttribute(),en=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:U,origin:re,sessionName:xe,information:gt,uri:Tn,emails:Mr,phones:Gs,connection:v_,bandwidths:y_,timeFields:Pi,key:Ua,attributes:Dl,mediaDescriptions:en}}getCurrentRecord(){const R=this.records[this.currentLine];if(!R)throw new Error("Record doesn't exit.");return R}probeEOL(R){for(let k=0;k<R.length;k++)if(R[k]===u)return R[k-1]==="\r"?p:u;throw new Error("Invalid newline character.")}parseLine(R,k){if(R.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const U=R[0];if(R[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:U,value:R.slice(2),line:k,cur:0}}parseSessionAttribute(){const R=new Nt;for(;this.currentLine<this.records.length;){const k=this.getCurrentRecord();if(k.type!==m.ATTRIBUTE)break;const U={attField:this.extractOneOrMore(k,re=>v(re)&&re!==":"),_cur:0};k.value[k.cur]===":"&&(k.cur+=1,U.attValue=this.extractOneOrMore(k,V)),R.parse(U),this.currentLine++}return R.digest()}parseMediaAttributes(R){const k=new cn(R);for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==m.ATTRIBUTE)break;const re={attField:this.extractOneOrMore(U,xe=>v(xe)&&xe!==":"),_cur:0};U.value[U.cur]===":"&&(U.cur+=1,re.attValue=this.extractOneOrMore(U,V)),k.parse(re),this.currentLine++}return k.digest()}parseKey(){const R=this.getCurrentRecord();if(R.type===m.KEY){if(R.value==="prompt"||R.value==="clear:"||R.value==="base64:"||R.value==="uri:")return R.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const R=this.getCurrentRecord();if(R.type===m.ZONE_ADJUSTMENTS){const k=[];for(;;)try{const U=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);let re=!1;R.value[R.cur]==="-"&&(re=!0,R.cur+=1);const xe=this.extract(R,this.consumeTypedTime);k.push({time:U,typedTime:xe,back:re})}catch{break}if(k.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,k}return[]}parseRepeat(){const R=[];for(;;){const k=this.getCurrentRecord();if(k.type!==m.REPEAT)break;{const U=this.extract(k,this.consumeRepeatInterval),re=this.parseTypedTime(k);R.push({repeatInterval:U,typedTimes:re}),this.currentLine++}}return R}parseTypedTime(R){const k=[];for(;;)try{this.consumeSpaceForRecord(R),k.push(this.extract(R,this.consumeTypedTime))}catch{break}if(k.length===0)throw new Error("Invalid typed time.");return k}parseTime(){const R=this.getCurrentRecord(),k=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);const U=this.extract(R,this.consumeTime);return this.currentLine++,{startTime:k,stopTime:U}}parseBandWidth(){const R=[];for(;this.currentLine<this.records.length;){const k=this.getCurrentRecord();if(k.type!==m.BANDWIDTH)break;{const U=this.extractOneOrMore(k,v);if(k.value[k.cur]!==":")throw new Error("Invalid bandwidth field.");k.cur++;const re=this.extractOneOrMore(k,E);R.push({bwtype:U,bandwidth:re}),this.currentLine++}}return R}parseVersion(){const R=this.getCurrentRecord();if(R.type!==m.VERSION)throw new Error("first sdp record must be version");const k=R.value.slice(0,this.consumeOneOrMore(R.value,0,E));if(k.length!==R.value.length)throw new Error('invalid proto version, "v='.concat(R.value,'"'));return this.currentLine++,k}parseOrigin(){const R=this.getCurrentRecord();if(R.type!==m.ORIGIN)throw new Error("second line of sdp must be origin");const k=this.extractOneOrMore(R,I);this.consumeSpaceForRecord(R);const U=this.extractOneOrMore(R,E);this.consumeSpaceForRecord(R);const re=this.extractOneOrMore(R,E);this.consumeSpaceForRecord(R);const xe=this.extractOneOrMore(R,v);this.consumeSpaceForRecord(R);const gt=this.extractOneOrMore(R,v);this.consumeSpaceForRecord(R);const Tn=this.extract(R,this.consumeUnicastAddress);return this.currentLine++,{username:k,sessId:U,sessVersion:re,nettype:xe,addrtype:gt,unicastAddress:Tn}}parseSessionName(){const R=this.getCurrentRecord();if(R.type===m.SESSION_NAME){const k=this.extract(R,this.consumeText);return this.currentLine++,k}}parseInformation(){const R=this.getCurrentRecord();if(R.type!==m.INFORMATION)return;const k=this.extract(R,this.consumeText);return this.currentLine++,k}parseUri(){const R=this.getCurrentRecord();if(R.type===m.URI)return this.currentLine++,R.value}parseEmail(){const R=[];for(;;){const k=this.getCurrentRecord();if(k.type!==m.EMAIL)break;R.push(k.value),this.currentLine++}return R}parsePhone(){const R=[];for(;;){const k=this.getCurrentRecord();if(k.type!==m.PHONE)break;R.push(k.value),this.currentLine++}return R}parseConnection(){const R=this.getCurrentRecord();if(R.type===m.CONNECTION){const k=this.extractOneOrMore(R,v);this.consumeSpaceForRecord(R);const U=this.extractOneOrMore(R,v);this.consumeSpaceForRecord(R);const re=this.extract(R,this.consumeAddress);return this.currentLine++,{nettype:k,addrtype:U,address:re}}}parseMedia(){const R=this.getCurrentRecord(),k=this.extract(R,this.consumeToken);this.consumeSpaceForRecord(R);let U=this.extract(R,this.consumePort);R.value[R.cur]==="/"&&(R.cur+=1,U+=this.extract(R,this.consumeInteger)),this.consumeSpaceForRecord(R);const re=[];for(re.push(this.extract(R,this.consumeToken));R.value[R.cur]==="/";)R.cur+=1,re.push(this.extract(R,this.consumeToken));if(re.length===0)throw new Error("Invalid proto");const xe=this.parseFmt(R);return this.currentLine++,{mediaType:k,port:U,protos:re,fmts:xe}}parseTimeFields(){const R=[];for(;this.getCurrentRecord().type===m.TIME;){const k=this.parseTime(),U=this.parseRepeat(),re=this.parseZone();R.push({time:k,repeats:U,zones:re})}return R}parseMediaDescription(){const R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===m.MEDIA;){const k=this.parseMedia(),U=this.parseInformation(),re=this.parseConnections(),xe=this.parseBandWidth(),gt=this.parseKey(),Tn=this.parseMediaAttributes(k);R.push({media:k,information:U,connections:re,bandwidths:xe,key:gt,attributes:Tn})}return R}parseConnections(){const R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===m.CONNECTION;)R.push(this.parseConnection());return R}parseFmt(R){const k=[];for(;;)try{this.consumeSpaceForRecord(R),k.push(this.extract(R,this.consumeToken))}catch{break}if(k.length===0)throw new Error("Invalid fmts");return k}extract(R,k){for(var U=arguments.length,re=new Array(U>2?U-2:0),xe=2;xe<U;xe++)re[xe-2]=arguments[xe];const gt=k.call(this,R.value,R.cur,...re),Tn=R.value.slice(R.cur,gt);return R.cur=gt,Tn}extractOneOrMore(R,k){const U=this.consumeOneOrMore(R.value,R.cur,k),re=R.value.slice(R.cur,U);return R.cur=U,re}consumeSpaceForRecord(R){if(R.value[R.cur]!==f)throw new Error("Invalid space at ".concat(R.cur,"."));R.cur+=1}}class ct extends me{constructor(){super(...arguments),ee(this,"attributes",void 0),ee(this,"digested",!1)}extractOneOrMore(R,k,U){const re=this.consumeOneOrMore(R.attValue,R._cur,k),xe=R.attValue.slice(R._cur,re),[gt,Tn]=U||[];if(typeof gt=="number"&&xe.length<gt)throw new Error("error in length, should be more or equal than ".concat(gt," characters."));if(typeof Tn=="number"&&xe.length>Tn)throw new Error("error in length, should be less or equal than ".concat(Tn," characters."));return R._cur=re,xe}consumeAttributeSpace(R){if(R.attValue[R._cur]!==f)throw new Error("Invalid space at ".concat(R._cur,"."));R._cur+=1}extract(R,k){if(!R.attValue)throw new Error("Nothing to extract from attValue.");for(var U=arguments.length,re=new Array(U>2?U-2:0),xe=2;xe<U;xe++)re[xe-2]=arguments[xe];const gt=k.call(this,R.attValue,R._cur,...re),Tn=R.attValue.slice(R._cur,gt);return R._cur=gt,Tn}atEnd(R){if(!R.attValue)throw new Error;return R._cur>=R.attValue.length}peekChar(R){if(!R.attValue)throw new Error;return R.attValue[R._cur]}peek(R,k){if(!R.attValue)throw new Error;for(let U=0;U<k.length;U++)if(k[U]!==R.attValue[R._cur+U])return!1;return!0}parseIceUfrag(R){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(R,F,[4,256])}parseIcePwd(R){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(R,F,[22,256])}parseIceOptions(R){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const k=[];for(;!this.atEnd(R);){k.push(this.extractOneOrMore(R,F));try{this.consumeAttributeSpace(R)}catch(U){if(this.atEnd(R))break;throw U}}this.attributes.iceOptions=k}parseFingerprint(R){const k=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const U=this.extract(R,this.consumeTill);this.attributes.fingerprints.push({hashFunction:k,fingerprint:U})}parseExtmap(R){const k=this.extractOneOrMore(R,E);let U;this.peekChar(R)==="/"&&(this.extract(R,this.consume,"/"),U=this.extract(R,this.consumeToken)),this.consumeAttributeSpace(R);const re=this.extract(R,this.consumeTill,f),xe=Z(Z({entry:parseInt(k,10)},U&&{direction:U}),{},{extensionName:re});this.peekChar(R)===f&&(this.consumeAttributeSpace(R),xe.extensionAttributes=this.extract(R,this.consumeTill)),this.attributes.extmaps.push(xe)}parseSetup(R){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const k=this.extract(R,this.consumeTill);if(k!=="active"&&k!=="passive"&&k!=="actpass"&&k!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=k}}class Nt extends ct{constructor(){super(...arguments),ee(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"group":this.parseGroup(R);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"fingerprint":this.parseFingerprint(R);break;case"setup":this.parseSetup(R);break;case"tls-id":this.parseTlsId(R);break;case"identity":this.parseIdentity(R);break;case"extmap":this.parseExtmap(R);break;case"msid-semantic":this.parseMsidSemantic(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(k){throw console.error("parsing session attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),k}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(R){const k=this.extract(R,this.consumeToken),U=[];for(;!this.atEnd(R)&&this.peekChar(R)===f;)this.consumeAttributeSpace(R),U.push(this.extract(R,this.consumeToken));this.attributes.groups.push({semantic:k,identificationTag:U})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(R){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(R,G)}parseIdentity(R){const k=this.extractOneOrMore(R,z),U=[];for(;!this.atEnd(R)&&this.peekChar(R)===f;){this.consumeAttributeSpace(R);const re=this.extract(R,this.consumeToken);this.extract(R,this.consume,"=");const xe=this.extractOneOrMore(R,gt=>gt!==f&&V(gt));U.push({name:re,value:xe})}this.attributes.identities.push({assertionValue:k,extensions:U})}parseMsidSemantic(R){this.peekChar(R)===f&&this.consumeAttributeSpace(R);const k={semantic:this.extract(R,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(R)}catch{break}if(this.peekChar(R)==="*"){this.extract(R,this.consume,"*"),k.applyForAll=!0;break}{const U=this.extract(R,this.consumeTill,f);k.identifierList.push(U)}}this.attributes.msidSemantic=k}}class cn extends ct{constructor(R){super(),ee(this,"attributes",void 0),R.protos.indexOf("RTP")!==-1||R.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"extmap":this.parseExtmap(R);break;case"setup":this.parseSetup(R);break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"candidate":this.parseCandidate(R);break;case"remote-candidate":this.parseRemoteCandidate(R);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(R);break;case"rtpmap":this.parseRtpmap(R);break;case"ptime":this.parsePtime(R);break;case"maxptime":this.parseMaxPtime(R);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(R);break;case"ssrc":this.parseSSRC(R);break;case"fmtp":this.parseFmtp(R);break;case"rtcp-fb":this.parseRtcpFb(R);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(R);break;case"mid":this.parseMid(R);break;case"msid":this.parseMsid(R);break;case"imageattr":this.parseImageAttr(R);break;case"rid":this.parseRid(R);break;case"simulcast":this.parseSimulcast(R);break;case"sctp-port":this.parseSctpPort(R);break;case"max-message-size":this.parseMaxMessageSize(R);break;case"ssrc-group":this.parseSSRCGroup(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(k){throw console.error("parsing media attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),k}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}parseCandidate(R){const k=this.extractOneOrMore(R,F,[1,32]);this.consumeAttributeSpace(R);const U=this.extractOneOrMore(R,E,[1,5]);this.consumeAttributeSpace(R);const re=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const xe=this.extractOneOrMore(R,E,[1,10]);this.consumeAttributeSpace(R);const gt=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);const Tn=this.extract(R,this.consumePort);this.consumeAttributeSpace(R),this.extract(R,this.consume,"typ"),this.consumeAttributeSpace(R);const Mr={foundation:k,componentId:U,transport:re,priority:xe,connectionAddress:gt,port:Tn,type:this.extract(R,this.consumeToken),extension:{}};for(this.peek(R," raddr")&&(this.extract(R,this.consume," raddr"),this.consumeAttributeSpace(R),Mr.relAddr=this.extract(R,this.consumeAddress)),this.peek(R," rport")&&(this.extract(R,this.consume," rport"),this.consumeAttributeSpace(R),Mr.relPort=this.extract(R,this.consumePort));this.peekChar(R)===f;){this.consumeAttributeSpace(R);const Gs=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R),Mr.extension[Gs]=this.extractOneOrMore(R,S)}this.attributes.candidates.push(Mr)}parseRemoteCandidate(R){const k=[];for(;;){const U=this.extractOneOrMore(R,E,[1,5]);this.consumeAttributeSpace(R);const re=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);const xe=this.extract(R,this.consumePort);k.push({componentId:U,connectionAddress:re,port:xe});try{this.consumeAttributeSpace(R)}catch{break}}this.attributes.remoteCandidatesList.push(k)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(R){const k=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const U=this.extract(R,this.consumeTill,"/");this.extract(R,this.consume,"/");const re={encodingName:U,clockRate:this.extractOneOrMore(R,E)};this.atEnd(R)||this.peekChar(R)!=="/"||(this.extract(R,this.consume,"/"),re.encodingParameters=parseInt(this.extract(R,this.consumeTill),10));const xe=this.attributes.payloads.find(gt=>gt.payloadType===parseInt(k,10));xe?xe.rtpMap=re:this.attributes.payloads.push({payloadType:parseInt(k,10),rtpMap:re,rtcpFeedbacks:[]})}parsePtime(R){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(R,this.consumeTill)}parseMaxPtime(R){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(R,this.consumeTill)}parseDirection(R){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=R.attField}parseSSRC(R){const k=this.extractOneOrMore(R,E);this.consumeAttributeSpace(R);const U=this.extract(R,this.consumeTill,":");let re;this.peekChar(R)===":"&&(this.extract(R,this.consume,":"),re=this.extract(R,this.consumeTill));const xe=this.attributes.ssrcs.find(gt=>gt.ssrcId===parseInt(k,10));xe?xe.attributes[U]=re:this.attributes.ssrcs.push({ssrcId:parseInt(k,10),attributes:{[U]:re}})}parseFmtp(R){const k=this.extract(R,this.consumeTill,f);this.consumeAttributeSpace(R);const U=this.extract(R,this.consumeTill),re={};U.split(";").forEach(gt=>{let[Tn,Mr]=gt.split("=");Tn=ir(Tn).call(Tn);const Gs=typeof Mr=="string"?ir(Mr).call(Mr):null;typeof Tn=="string"&&Tn.length>0&&(re[Tn]=Gs)});const xe=this.attributes.payloads.find(gt=>gt.payloadType===parseInt(k,10));xe?xe.fmtp={parameters:re}:this.attributes.payloads.push({payloadType:parseInt(k,10),rtcpFeedbacks:[],fmtp:{parameters:re}})}parseFmtParameters(R){const k={},U=this.extract(R,this.consumeTill,"=");R._cur++;const re=this.extract(R,this.consumeTill,";");for(k[U]=re;R.attValue[R._cur]===";";){const xe=this.extract(R,this.consumeTill,"=");R._cur++;const gt=this.extract(R,this.consumeTill,";");k[xe]=gt}return k}parseRtcpFb(R){let k="";k=this.peekChar(R)==="*"?this.extract(R,this.consume,"*"):this.extract(R,this.consumeTill,f),this.consumeAttributeSpace(R);const U=this.extract(R,this.consumeTill,f);let re;if(U==="trr-int")re={type:U,interval:this.extract(R,this.consumeTill)};else{const xe={type:U};this.peekChar(R)===f&&(this.consumeAttributeSpace(R),xe.parameter=this.extract(R,this.consumeToken),this.peekChar(R)===f&&(xe.additional=this.extract(R,this.consumeTill))),re=xe}if(k==="*")this.attributes.rtcpFeedbackWildcards.push(re);else{const xe=this.attributes.payloads.find(gt=>gt.payloadType===parseInt(k,10));xe?xe.rtcpFeedbacks.push(re):this.attributes.payloads.push({payloadType:parseInt(k,10),rtcpFeedbacks:[re]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(R){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const k={port:this.extract(R,this.consumePort)};this.peekChar(R)===f&&(this.consumeAttributeSpace(R),k.netType=this.extractOneOrMore(R,v),this.consumeAttributeSpace(R),k.addressType=this.extractOneOrMore(R,v),this.consumeAttributeSpace(R),k.address=this.extract(R,this.consumeAddress)),this.attributes.rtcp=k}parseMsid(R){const k={id:this.extractOneOrMore(R,v,[1,64])};this.peekChar(R)===f&&(this.consumeAttributeSpace(R),k.appdata=this.extractOneOrMore(R,v,[1,64])),this.attributes.msids.push(k)}parseImageAttr(R){this.attributes.imageattr.push(R.attValue)}parseRid(R){const k=this.extractOneOrMore(R,re=>A(re)||E(re)||re==="_"||re==="-");this.consumeAttributeSpace(R);const U={id:k,direction:this.extract(R,this.consumeToken),params:[]};if(this.peekChar(R)===f){if(this.consumeAttributeSpace(R),this.peek(R,"pt=")){this.extract(R,this.consume,"pt=");const re=[];for(;;){const xe=this.extract(R,this.consumeToken);re.push(xe);try{this.extract(R,this.consume,",")}catch{break}}U.payloads=re,this.peekChar(R)===f&&this.extract(R,this.consume,f)}for(;;){const re=this.extract(R,this.consumeToken);switch(re){case"depend":{const xe={type:re,rids:this.extract(R,this.consume,"=").split(",")};U.params.push(xe);break}default:{const xe={type:re};this.peekChar(R)==="="&&(this.extract(R,this.consume,"="),xe.val=this.extract(R,this.consumeTill,";")),U.params.push(xe)}}try{this.extract(R,this.consume,";")}catch{break}}}this.attributes.rids.push(U)}parseSimulcast(R){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=R.attValue,this.extract(R,this.consumeTill)}parseSctpPort(R){this.attributes.sctpPort=this.extractOneOrMore(R,E,[1,5])}parseMaxMessageSize(R){this.attributes.maxMessageSize=this.extractOneOrMore(R,E,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(R){this.attributes.mid=this.extract(R,this.consumeToken)}parseSSRCGroup(R){const k=this.extract(R,this.consumeToken),U=[];for(;;)try{this.consumeAttributeSpace(R);const re=this.extract(R,this.consumeInteger);U.push(parseInt(re,10))}catch{break}this.attributes.ssrcGroups.push({semantic:k,ssrcIds:U})}}function Wt(ce,R,k){return R in ce?Object.defineProperty(ce,R,{value:k,enumerable:!0,configurable:!0,writable:!0}):ce[R]=k,ce}class lo{constructor(){Wt(this,"eol",p)}print(R,k){let U="";return k&&(this.eol=k),U+=this.printVersion(R.version),U+=this.printOrigin(R.origin),U+=this.printSessionName(R.sessionName),U+=this.printInformation(R.information),U+=this.printUri(R.uri),U+=this.printEmail(R.emails),U+=this.printPhone(R.phones),U+=this.printConnection(R.connection),U+=this.printBandwidth(R.bandwidths),U+=this.printTimeFields(R.timeFields),U+=this.printKey(R.key),U+=this.printSessionAttributes(R.attributes),U+=this.printMediaDescription(R.mediaDescriptions),U}printVersion(R){return"v=".concat(R).concat(this.eol)}printOrigin(R){return"o=".concat(R.username," ").concat(R.sessId," ").concat(R.sessVersion," ").concat(R.nettype," ").concat(R.addrtype," ").concat(R.unicastAddress).concat(this.eol)}printSessionName(R){return R?"s=".concat(R).concat(this.eol):""}printInformation(R){return R?"i=".concat(R).concat(this.eol):""}printUri(R){return R?"u=".concat(R).concat(this.eol):""}printEmail(R){let k="";for(const U of R)k+="e=".concat(U).concat(this.eol);return k}printPhone(R){let k="";for(const U of R)k+="e=".concat(U).concat(this.eol);return k}printConnection(R){return R?"c=".concat(R.nettype," ").concat(R.addrtype," ").concat(R.address).concat(this.eol):""}printBandwidth(R){let k="";for(const U of R)k+="b=".concat(U.bwtype,":").concat(U.bandwidth).concat(this.eol);return k}printTimeFields(R){let k="";for(const U of R){k+="t=".concat(U.time.startTime," ").concat(U.time.startTime).concat(this.eol);for(const re of U.repeats)k+="r=".concat(re.repeatInterval," ").concat(re.typedTimes.join(" ")).concat(this.eol);U.zoneAdjustments&&(k+="z=",k+="z=".concat(U.zoneAdjustments.map(re=>"".concat(re.time," ").concat(re.back?"-":""," ").concat(re.typedTime)).join(" ")).concat(this.eol),k+=this.eol)}return k}printKey(R){return R?"k=".concat(R).concat(this.eol):""}printAttributes(R){let k="";for(const U of R)k+="a=".concat(U.attField).concat(U.attValue?":".concat(U.attValue):"").concat(this.eol);return k}printMediaDescription(R){let k="";for(const U of R)k+=this.printMedia(U.media),k+=this.printInformation(U.information),k+=this.printConnections(U.connections),k+=this.printBandwidth(U.bandwidths),k+=this.printKey(U.key),k+=this.printMediaAttributes(U);return k}printConnections(R){let k="";for(const U of R)k+=this.printConnection(U);return k}printMedia(R){return"m=".concat(R.mediaType," ").concat(R.port," ").concat(R.protos.join("/")," ").concat(R.fmts.join(" ")).concat(this.eol)}printSessionAttributes(R){return new oe(this.eol).print(R)}printMediaAttributes(R){return new Se(this.eol).print(R)}}class ${constructor(R){Wt(this,"eol",void 0),this.eol=R}printIceUfrag(R){return R===void 0?"":"a=ice-ufrag:".concat(R).concat(this.eol)}printIcePwd(R){return R===void 0?"":"a=ice-pwd:".concat(R).concat(this.eol)}printIceOptions(R){return R===void 0?"":"a=ice-options:".concat(R.join(f)).concat(this.eol)}printFingerprints(R){return R.length>0?R.map(k=>"a=fingerprint:".concat(k.hashFunction).concat(f).concat(k.fingerprint)).join(this.eol)+this.eol:""}printExtmap(R){return R.map(k=>"a=extmap:".concat(k.entry).concat(k.direction?"/".concat(k.direction):"").concat(f).concat(k.extensionName).concat(k.extensionAttributes?"".concat(f).concat(k.extensionAttributes):"").concat(this.eol)).join("")}printSetup(R){return R===void 0?"":"a=setup:".concat(R).concat(this.eol)}printUnrecognized(R){return R.map(k=>"a=".concat(k.attField).concat(k.attValue?":".concat(k.attValue):"").concat(this.eol)).join("")}}class oe extends ${print(R){let k="";return k+=this.printGroups(R.groups),k+=this.printMsidSemantic(R.msidSemantic),k+=this.printIceLite(R.iceLite),k+=this.printIceUfrag(R.iceUfrag),k+=this.printIcePwd(R.icePwd),k+=this.printIceOptions(R.iceOptions),k+=this.printFingerprints(R.fingerprints),k+=this.printSetup(R.setup),k+=this.printTlsId(R.tlsId),k+=this.printIdentity(R.identities),k+=this.printExtmap(R.extmaps),k+=this.printUnrecognized(R.unrecognized),k}printGroups(R){let k="";return R.length>0&&(k+=R.map(U=>"a=group:".concat(U.semantic).concat(U.identificationTag.map(re=>"".concat(f).concat(re)).join("")).concat(this.eol)).join("")),k}printIceLite(R){return R===void 0?"":"a=ice-lite"+this.eol}printTlsId(R){return R?"a=tls-id:".concat(R).concat(this.eol):""}printIdentity(R){return R.length===0?"":R.map(k=>"a=identity:".concat(k.assertionValue).concat(k.extensions.map(U=>"".concat(f).concat(U.name).concat(U.value?"=".concat(U.value):"")))).join(this.eol)+this.eol}printMsidSemantic(R){if(!R)return"";let k="a=msid-semantic:".concat(R.semantic);return R.applyForAll?k+="".concat(f,"*"):R.identifierList.length>0&&(k+=R.identifierList.map(U=>"".concat(f).concat(U))),k+this.eol}}class Se extends ${print(R){const k=R.attributes;let U="";return U+=this.printRTCP(k.rtcp),U+=this.printIceUfrag(k.iceUfrag),U+=this.printIcePwd(k.icePwd),U+=this.printIceOptions(k.iceOptions),U+=this.printCandidates(k.candidates),U+=this.printRemoteCandidatesList(k.remoteCandidatesList),U+=this.printEndOfCandidates(k.endOfCandidates),U+=this.printFingerprints(k.fingerprints),U+=this.printSetup(k.setup),U+=this.printMid(k.mid),U+=this.printExtmap(k.extmaps),U+=this.printRTPRelated(k),U+=this.printPtime(k.ptime),U+=this.printMaxPtime(k.maxPtime),U+=this.printDirection(k.direction),U+=this.printSSRCGroups(k.ssrcGroups),U+=this.printSSRC(k.ssrcs),U+=this.printRTCPMux(k.rtcpMux),U+=this.printRTCPMuxOnly(k.rtcpMuxOnly),U+=this.printRTCPRsize(k.rtcpRsize),U+=this.printMSId(k.msids),U+=this.printImageattr(k.imageattr),U+=this.printRid(k.rids),U+=this.printSimulcast(k.simulcast),U+=this.printSCTPPort(k.sctpPort),U+=this.printMaxMessageSize(k.maxMessageSize),U+=this.printUnrecognized(k.unrecognized),U}printCandidates(R){return R.map(k=>"a=candidate:".concat(k.foundation).concat(f).concat(k.componentId).concat(f).concat(k.transport).concat(f).concat(k.priority).concat(f).concat(k.connectionAddress).concat(f).concat(k.port).concat(f,"typ").concat(f).concat(k.type).concat(k.relAddr?"".concat(f,"raddr").concat(f).concat(k.relAddr):"").concat(k.relPort?"".concat(f,"rport").concat(f).concat(k.relPort):"").concat(Object.keys(k.extension).map(U=>"".concat(f).concat(U).concat(f).concat(k.extension[U])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(R){return R.map(k=>"a=remote-candidates:".concat(k.join(f)).concat(this.eol)).join("")}printEndOfCandidates(R){return R===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(R){if(!R.payloads)return"";const k=R.payloads;let U="";U+=R.rtcpFeedbackWildcards.map(re=>this.printRTCPFeedback("*",re)).join("");for(const re of k)U+=this.printRtpMap(re.payloadType,re.rtpMap),U+=this.printFmtp(re.payloadType,re.fmtp),U+=re.rtcpFeedbacks.map(xe=>this.printRTCPFeedback(re.payloadType,xe)).join("");return U}printFmtp(R,k){if(!k)return"";const U=Object.keys(k.parameters);return U.length===1&&k.parameters[U[0]]===null?"a=fmtp:".concat(R).concat(f).concat(U[0]).concat(this.eol):"a=fmtp:".concat(R).concat(f).concat(Object.keys(k.parameters).map(re=>"".concat(re,"=").concat(k.parameters[re])).join(";")).concat(this.eol)}printRtpMap(R,k){return k?"a=rtpmap:".concat(R).concat(f).concat(k.encodingName,"/").concat(k.clockRate).concat(k.encodingParameters?"/".concat(k.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(R,k){let U="a=rtcp-fb:".concat(R).concat(f),re=k;return re.type==="trr-int"?U+="ttr-int".concat(f).concat(re.interval):(U+="".concat(re.type),re.parameter&&(U+="".concat(f).concat(re.parameter),re.additional&&(U+="".concat(f).concat(re.additional)))),U+this.eol}printPtime(R){return R===void 0?"":"a=ptime:".concat(R).concat(this.eol)}printMaxPtime(R){return R===void 0?"":"a=maxptime:".concat(R).concat(this.eol)}printDirection(R){return R===void 0?"":"a=".concat(R).concat(this.eol)}printSSRC(R){return R.map(k=>Object.keys(k.attributes).map(U=>"a=ssrc:".concat(k.ssrcId.toString(10)).concat(f).concat(U).concat(k.attributes[U]?":".concat(k.attributes[U]):"").concat(this.eol)).join("")).join("")}printRTCPMux(R){return R===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(R){return R===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(R){return R===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(R){if(R===void 0)return"";let k="a=rtcp:".concat(R.port);return R.netType&&(k+="".concat(f).concat(R.netType)),R.addressType&&(k+="".concat(f).concat(R.addressType)),R.address&&(k+="".concat(f).concat(R.address)),k+this.eol}printMSId(R){return R.map(k=>"a=msid:".concat(k.id).concat(k.appdata?"".concat(f).concat(k.appdata):"").concat(this.eol)).join("")}printImageattr(R){return R.map(k=>"a=imageattr:".concat(k).concat(this.eol)).join("")}printRid(R){return R.map(k=>{let U="a=rid:".concat(k.id).concat(f).concat(k.direction);return k.payloads&&(U+="".concat(f,"pt=").concat(k.payloads.join(","))),k.params.length>0&&(U+="".concat(f).concat(k.params.map(re=>re.type==="depend"?"depend=".concat(re.rids.join(",")):"".concat(re.type,"=").concat(re.val)).join(";"))),U+this.eol}).join("")}printSimulcast(R){return R===void 0?"":"a=simulcast:".concat(R).concat(this.eol)}printSCTPPort(R){return R===void 0?"":"a=sctp-port:".concat(R).concat(this.eol)}printMaxMessageSize(R){return R===void 0?"":"a=max-message-size:".concat(R).concat(this.eol)}printMid(R){return R===void 0?"":"a=mid:".concat(R).concat(this.eol)}printSSRCGroups(R){return R.map(k=>"a=ssrc-group:".concat(k.semantic).concat(k.ssrcIds.map(U=>"".concat(f).concat(U.toString(10))).join("")).concat(this.eol)).join("")}}function Me(ce){return new Qe().parse(ce)}function st(ce,R){return new lo().print(ce,R)}}},r={};function i(a){if(r[a])return r[a].exports;var c=r[a]={exports:{}};return n[a](c,c.exports,i),c.exports}return i.d=(a,c)=>{for(var d in c)i.o(c,d)&&!i.o(a,d)&&Object.defineProperty(a,d,{enumerable:!0,get:c[d]})},i.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),i.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},i(8)})()})(Uk);var Vt=Uk.exports;function io(e){if(Array.isArray(e))return e.map(n=>n);if(!Vk(e))return e;const t={};for(const n in e){const r=e[n];Vk(r)||Array.isArray(r)?t[n]=io(r):t[n]=r}return t}function Vk(e){return!(typeof e!="object"||Array.isArray(e)||!e)}class wy{constructor(t){w(this,"input",[]),w(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const _s={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Lh={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:_s,remoteCandidate:_s}},jk={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},Fk={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},Bk={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},Gk={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function Wk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Hk(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Wk(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wk(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Iy{constructor(t,n){w(this,"onFirstVideoReceived",void 0),w(this,"onFirstVideoDecoded",void 0),w(this,"onFirstAudioReceived",void 0),w(this,"onFirstVideoDecodedTimeout",void 0),w(this,"onFirstAudioDecoded",void 0),w(this,"onSelectedLocalCandidateChanged",void 0),w(this,"onSelectedRemoteCandidateChanged",void 0),w(this,"videoIsReady",!1),w(this,"videoIsReady2",{}),w(this,"pc",void 0),w(this,"options",void 0),w(this,"intervalTimer",void 0),w(this,"stats",io(Lh)),w(this,"isFirstVideoReceived",{}),w(this,"isFirstVideoDecoded",{}),w(this,"isFirstAudioReceived",{}),w(this,"isFirstAudioDecoded",{}),w(this,"isFirstVideoDecodedTimeout",{}),w(this,"lossRateWindowStats",[]),this.pc=t,this.options=n,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ae(t=>{t({local:Hk({},_s),remote:Hk({},_s)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,n){this.videoIsReady2[t]=n}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,a=0,c=0,d=0;for(const u of r)t[u].forEach((p,f)=>{if(!this.lossRateWindowStats[n-1][u][f]||!this.lossRateWindowStats[0][u][f])return;const m=this.lossRateWindowStats[n-1][u][f].packets-this.lossRateWindowStats[0][u][f].packets,E=this.lossRateWindowStats[n-1][u][f].packetsLost-this.lossRateWindowStats[0][u][f].packetsLost;u==="videoSend"||u==="audioSend"?(i+=m,c+=E):(a+=m,d+=E),Number.isNaN(m)||Number.isNaN(m)?p.packetLostRate=0:p.packetLostRate=m<=0||E<=0?0:E/(m+E)});t.sendPacketLossRate=i<=0||c<=0?0:c/(i+c),t.recvPacketLossRate=a<=0||d<=0?0:d/(a+d)}}function Kk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function gX(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Kk(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kk(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class SX extends Iy{constructor(){super(...arguments),w(this,"_stats",Lh),w(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),n=this.statsResponsesToObjects(t);this._stats=io(Lh);const r=n.filter(a=>a.type==="ssrc");this.processSSRCStats(r);const i=n.find(a=>a.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(n=>{var r;const i=le(r=n.id).call(r,"send");switch("".concat(n.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const a=io(Fk);a.codec=n.googCodecName,a.adaptionChangeReason="none",n.googCpuLimitedResolution&&(a.adaptionChangeReason="cpu"),n.googBandwidthLimitedResolution&&(a.adaptionChangeReason="bandwidth"),a.avgEncodeMs=Number(n.googAvgEncodeMs),a.inputFrame={width:Number(n.googFrameWidthInput)||Number(n.googFrameWidthSent),height:Number(n.googFrameHeightInput)||Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},a.sentFrame={width:Number(n.googFrameWidthSent),height:Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},a.firsCount=Number(n.googFirReceived),a.nacksCount=Number(n.googNacksReceived),a.plisCount=Number(n.googPlisReceived),a.frameCount=Number(n.framesEncoded),a.bytes=Number(n.bytesSent),a.packets=Number(n.packetsSent),a.packetsLost=Number(n.packetsLost),a.ssrc=Number(n.ssrc),a.rttMs=Number(n.googRtt||0),this._stats.videoSend.push(a),this._stats.rtt=a.rttMs;break}case"video_recv":{const a=io(jk),c=this.lastDecodeVideoReceiverStats.get(Number(n.ssrc));if(a.codec=n.googCodecName,a.targetDelayMs=Number(n.googTargetDelayMs),a.renderDelayMs=Number(n.googRenderDelayMs),a.currentDelayMs=Number(n.googCurrentDelayMs),a.minPlayoutDelayMs=Number(n.googMinPlayoutDelayMs),a.decodeMs=Number(n.googDecodeMs),a.maxDecodeMs=Number(n.googMaxDecodeMs),a.receivedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateReceived)},a.decodedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateDecoded)},a.decodeFrameRate=Number(n.googFrameRateDecoded),a.outputFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateOutput)},a.jitterBufferMs=Number(n.googJitterBufferMs),a.firsCount=Number(n.googFirsSent),a.nacksCount=Number(n.googNacksSent),a.plisCount=Number(n.googPlisSent),a.framesDecodeCount=Number(n.framesDecoded),a.bytes=Number(n.bytesReceived),a.packets=Number(n.packetsReceived),a.packetsLost=Number(n.packetsLost),a.ssrc=Number(n.ssrc),a.packets>0&&!this.isFirstVideoReceived[a.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(a.ssrc),this.isFirstVideoReceived[a.ssrc]=!0),a.framesDecodeCount>0&&!this.isFirstVideoDecoded[a.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(a.ssrc,a.decodedFrame.width,a.decodedFrame.height),this.isFirstVideoDecoded[a.ssrc]=!0),c){const d=c.stats,u=Date.now()-c.lts;a.framesDecodeFreezeTime=d.framesDecodeFreezeTime,a.framesDecodeInterval=d.framesDecodeInterval,a.framesDecodeCount>d.framesDecodeCount&&this.isFirstVideoDecoded[a.ssrc]?(c.lts=Date.now(),a.framesDecodeInterval=u,a.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc,10))?a.framesDecodeFreezeTime+=a.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):a.framesDecodeCount<c.stats.framesDecodeCount&&(a.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(a.ssrc,{stats:gX({},a),lts:Date.now()}),this._stats.videoRecv.push(a);break}case"audio_recv":{const a=io(Gk);a.codec=n.googCodecName,a.outputLevel=Math.abs(Number(n.audioOutputLevel))/32767,a.decodingCNG=Number(n.googDecodingCNG),a.decodingCTN=Number(n.googDecodingCTN),a.decodingCTSG=Number(n.googDecodingCTSG),a.decodingNormal=Number(n.googDecodingNormal),a.decodingPLC=Number(n.googDecodingPLC),a.decodingPLCCNG=Number(n.googDecodingPLCCNG),a.expandRate=Number(n.googExpandRate),a.accelerateRate=Number(n.googAccelerateRate),a.preemptiveExpandRate=Number(n.googPreemptiveExpandRate),a.secondaryDecodedRate=Number(n.googSecondaryDecodedRate),a.speechExpandRate=Number(n.googSpeechExpandRate),a.preferredJitterBufferMs=Number(n.googPreferredJitterBufferMs),a.jitterBufferMs=Number(n.googJitterBufferMs),a.jitterMs=Number(n.googJitterReceived),a.bytes=Number(n.bytesReceived),a.packets=Number(n.packetsReceived),a.packetsLost=Number(n.packetsLost),a.ssrc=Number(n.ssrc),a.receivedFrames=Number(n.googDecodingCTN)||Number(n.packetsReceived),a.droppedFrames=Number(n.googDecodingPLC)+Number(n.googDecodingPLCCNG)||Number(n.packetsLost),a.receivedFrames>0&&!this.isFirstAudioReceived[a.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(a.ssrc),this.isFirstAudioReceived[a.ssrc]=!0),a.decodingNormal>0&&!this.isFirstAudioDecoded[a.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(a.ssrc),this.isFirstAudioDecoded[a.ssrc]=!0),this._stats.audioRecv.push(a);break}case"audio_send":{const a=io(Bk);a.codec=n.googCodecName,a.inputLevel=Math.abs(Number(n.audioInputLevel))/32767,a.aecReturnLoss=Number(n.googEchoCancellationReturnLoss||0),a.aecReturnLossEnhancement=Number(n.googEchoCancellationReturnLossEnhancement||0),a.residualEchoLikelihood=Number(n.googResidualEchoLikelihood||0),a.residualEchoLikelihoodRecentMax=Number(n.googResidualEchoLikelihoodRecentMax||0),a.bytes=Number(n.bytesSent),a.packets=Number(n.packetsSent),a.packetsLost=Number(n.packetsLost),a.ssrc=Number(n.ssrc),a.rttMs=Number(n.googRtt||0),this._stats.rtt=a.rttMs,this._stats.audioSend.push(a);break}}})}_getStats(){return new ae((t,n)=>{this.pc.getStats(t,n)})}statsResponsesToObjects(t){const n=[];return t.result().forEach(r=>{const i={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach(a=>{i[a]=r.stat(a)}),n.push(i)}),n}}function zk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Gc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?zk(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zk(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Yk extends Iy{constructor(){super(...arguments),w(this,"_stats",Lh),w(this,"report",void 0),w(this,"lastDecodeVideoReceiverStats",new Map),w(this,"lastVideoFramesRecv",new Map),w(this,"lastVideoFramesSent",new Map),w(this,"lastVideoFramesDecode",new Map),w(this,"lastVideoFramesOutput",new Map),w(this,"lastVideoJBDelay",new Map),w(this,"lastAudioJBDelay",new Map),w(this,"mediaBytesSent",new Map),w(this,"mediaBytesRetransmit",new Map),w(this,"mediaBytesTargetEncode",new Map),w(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=io(Lh),this.report.forEach(t=>{switch(t.type){case ii.OUTBOUND:case ii.INBOUND:{const n=t.mediaType||t.kind,r=!n&&"frameWidth"in t,i=!n&&!("frameWidth"in t);t.type===ii.OUTBOUND?n==="audio"||i?this.processAudioOutboundStats(t):(n==="video"||r)&&this.processVideoOutboundStats(t):t.type===ii.INBOUND&&(n==="audio"||i?this.processAudioInboundStats(t):(n==="video"||r)&&this.processVideoInboundStats(t));break}case ii.TRANSPORT:{const n=this.report.get(t.selectedCandidatePairId);n&&this.processCandidatePairStats(n);break}case ii.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),n={local:Gc({},_s),remote:Gc({},_s)};return t.forEach(r=>{let i;if(r.type===ii.TRANSPORT&&(i=t.get(r.selectedCandidatePairId)),r.type===ii.CANDIDATE_PAIR&&r.selected&&(i=r),i){const a=(c,d)=>{c.type=d.type,c.id=d.id,d.address&&(c.address=d.address),d.candidateType&&(c.candidateType=d.candidateType),d.port&&(c.port=d.port),d.priority&&(c.priority=d.priority),d.protocol&&(c.protocol=d.protocol),d.relayProtocol&&(c.relayProtocol=d.relayProtocol)};if(i.localCandidateId){const c=t.get(i.localCandidateId);c&&a(n.local,c)}if(i.remoteCandidateId){const c=t.get(i.remoteCandidateId);c&&a(n.remote,c)}}}),n}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(n=>{t.currentRoundTripTime&&(n.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(n=>{t.currentRoundTripTime&&(n.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const n=this.report.get(t.localCandidateId);n&&this.processCandidateStats(n)}if(t.remoteCandidateId){const n=this.report.get(t.remoteCandidateId);n&&this.processCandidateStats(n)}}processCandidateStats(t){let n;t.type===ii.LOCAL_CANDIDATE&&(n=this._stats.selectedCandidatePair.localCandidate),t.type===ii.REMOTE_CANDIDATE&&(n=this._stats.selectedCandidatePair.remoteCandidate),n&&(n.type=t.type,n.id=t.id,t.address&&(n.address=t.address),t.candidateType&&(n.candidateType=t.candidateType),t.port&&(n.port=t.port),t.priority&&(n.priority=t.priority),t.protocol&&(n.protocol=t.protocol),t.relayProtocol&&(n.relayProtocol=t.relayProtocol),t.type===ii.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Gc({},n),Gc({},this.stats.selectedCandidatePair.localCandidate)),t.type===ii.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Gc({},n),Gc({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let n=this._stats.audioRecv.find(r=>r.ssrc===t.ssrc);n||(n=io(Gk),this._stats.audioRecv.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsReceived,n.packetsLost=t.packetsLost,n.bytes=t.bytesReceived,n.jitterMs=1e3*t.jitter,this.processAudioTrackReceiverStats(t,t.trackId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),n.receivedFrames||(n.receivedFrames=t.packetsReceived),n.droppedFrames||(n.droppedFrames=t.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.outputLevel&&n.outputLevel>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),typeof t.concealedSamples=="number"&&(n.concealedSamples=t.concealedSamples)}processVideoInboundStats(t){let n=this._stats.videoRecv.find(d=>d.ssrc===t.ssrc);n||(n=io(jk),this._stats.videoRecv.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsReceived,n.packetsLost=t.packetsLost,n.bytes=t.bytesReceived,n.firsCount=t.firCount,n.nacksCount=t.nackCount,n.plisCount=t.pliCount,n.framesDecodeCount=t.framesDecoded,n.framesDroppedCount=t.framesDropped,n.totalInterFrameDelay=t.totalInterFrameDelay,n.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,n.totalFreezesDuration=t.totalFreezesDuration;const r=this.lastDecodeVideoReceiverStats.get(n.ssrc),i=this.lastVideoFramesDecode.get(n.ssrc),a=this.lastVideoFramesOutput.get(n.ssrc),c=Date.now();if(n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]){const d=n.decodedFrame?n.decodedFrame.width:0,u=n.decodedFrame?n.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,d,u),this.isFirstVideoDecoded[n.ssrc]=!0}if(r){const d=r.stats,u=c-r.lts;n.framesDecodeFreezeTime=d.framesDecodeFreezeTime,n.framesDecodeInterval=d.framesDecodeInterval,!this.isFirstVideoDecoded[n.ssrc]&&u>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n.ssrc),this.isFirstVideoDecodedTimeout[n.ssrc]=!0),n.framesDecodeCount>d.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(r.lts=Date.now(),n.framesDecodeInterval=u,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):n.framesDecodeCount<d.framesDecodeCount&&(n.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(r.stats.framesDecodeCount>t.framesDecoded?n.qpSumPerFrame=t.qpSum/t.framesDecoded:n.qpSumPerFrame=(t.qpSum-r.qpSum)/(t.framesDecoded-r.stats.framesDecodeCount))}i&&c-i.lts>=800?(n.decodeFrameRate=Math.round((n.framesDecodeCount-i.count)/((c-i.lts)/1e3)),this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:c,rate:n.decodeFrameRate})):i?n.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:c,rate:0}),n.framesDroppedCount&&t.framesReceived&&(a&&c-a.lts>=800?(n.outputFrameRate=Math.round((t.framesReceived-n.framesDroppedCount-a.count)/((c-a.lts)/1e3)),this.lastVideoFramesOutput.set(n.ssrc,{count:t.framesReceived-n.framesDroppedCount,lts:c,rate:Math.max(n.outputFrameRate,0)})):a?n.outputFrameRate=a.rate:this.lastVideoFramesOutput.set(n.ssrc,{count:t.framesReceived-n.framesDroppedCount,lts:c,rate:0})),t.totalDecodeTime&&(n.decodeMs=1e3*t.totalDecodeTime),this.processVideoTrackReceiverStats(t,t.trackId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(n.framesRateFirefox=t.framerateMean),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:Gc({},n),lts:r?r.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let n=this._stats.videoSend.find(i=>i.ssrc===t.ssrc);n||(n=io(Fk),this._stats.videoSend.push(n));const r=this.mediaBytesSent.get(t.ssrc);if(r)r.add(t.bytesSent);else{const i=new wy(10);i.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,i)}if(t.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(t.ssrc);if(i)i.add(t.retransmittedBytesSent);else{const a=new wy(10);a.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,a)}}if(t.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(t.ssrc);if(i)i.add(t.totalEncodedBytesTarget);else{const a=new wy(10);a.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,a)}}if(n.ssrc=t.ssrc,n.bytes=t.bytesSent,n.packets=t.packetsSent,n.firsCount=t.firCount,n.nacksCount=t.nackCount,n.plisCount=t.pliCount,n.frameCount=t.framesEncoded,n.adaptionChangeReason=t.qualityLimitationReason,n.scalabilityMode=t.scalabilityMode,t.totalEncodeTime&&t.framesEncoded){const i=this.lastEncoderMs.get(t.ssrc);if(!i||i.lastFrameCount>t.framesEncoded)n.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const a=t.framesEncoded-i.lastFrameCount,c=t.totalEncodeTime-i.lastEncoderTime;n.avgEncodeMs=1e3*c/a}}if(t.framesEncoded&&t.qpSum){const i=this.lastEncoderMs.get(t.ssrc);!i||i.lastFrameCount>t.framesEncoded?n.qpSumPerFrame=t.qpSum/t.framesEncoded:n.qpSumPerFrame=(t.qpSum-i.lastQpSum)/(t.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,n),this.processVideoTrackSenderStats(t,t.trackId,n),t.remoteId)this.processRemoteInboundStats(t.remoteId,n);else{const i=this.findRemoteStatsId(t.ssrc,ii.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,n)}}processAudioOutboundStats(t){let n=this._stats.audioSend.find(r=>r.ssrc===t.ssrc);if(n||(n=io(Bk),this._stats.audioSend.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsSent,n.bytes=t.bytesSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,n),t.remoteId)this.processRemoteInboundStats(t.remoteId,n);else{const r=this.findRemoteStatsId(t.ssrc,ii.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,n)}}findRemoteStatsId(t,n){var r;const i=Array.from(wo(r=this.report).call(r)).find(a=>a.type===n&&a.ssrc===t);return i?i.id:null}processVideoMediaSource(t,n){const r=this.report.get(t);r&&r.width&&r.height&&r.framesPerSecond&&(n.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(t,n){const r=this.report.get(t);r&&(n.inputLevel=r.audioLevel)}processVideoTrackSenderStats(t,n,r){var i,a,c,d;const u=n?this.report.get(n):void 0,p=(i=u==null?void 0:u.framesSent)!==null&&i!==void 0?i:t.framesSent;if(typeof p!="number")return;let f=(a=u==null?void 0:u.frameWidth)!==null&&a!==void 0?a:t.frameWidth,m=(c=u==null?void 0:u.frameHeight)!==null&&c!==void 0?c:t.frameHeight,E=(d=u==null?void 0:u.framesPerSecond)!==null&&d!==void 0?d:t.framesPerSecond;if(typeof f=="number"&&typeof m=="number"||(f=0,m=0),E==null){const S=Date.now(),I=this.lastVideoFramesSent.get(r.ssrc);I&&S-I.lts>=800?(E=Math.round((p-I.count)/((S-I.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:p,lts:S,rate:E})):I?E=I.rate:this.lastVideoFramesSent.set(r.ssrc,{count:p,lts:S,rate:0})}r.sentFrame={width:f,height:m,frameRate:Math.max(0,E)}}processVideoTrackReceiverStats(t,n,r){var i,a,c,d,u;const p=n?this.report.get(n):void 0,f=(i=p==null?void 0:p.framesReceived)!==null&&i!==void 0?i:t.framesReceived,m=(a=p==null?void 0:p.frameWidth)!==null&&a!==void 0?a:t.frameWidth,E=(c=p==null?void 0:p.frameHeight)!==null&&c!==void 0?c:t.frameHeight,S=(d=p==null?void 0:p.jitterBufferDelay)!==null&&d!==void 0?d:t.jitterBufferDelay,I=(u=p==null?void 0:p.jitterBufferEmittedCount)!==null&&u!==void 0?u:t.jitterBufferEmittedCount;if(typeof f=="number"){const v=this.lastVideoFramesRecv.get(r.ssrc),y=Date.now();r.framesReceivedCount=f;let A=0;v&&y-v.lts>=800?(A=Math.round((f-v.count)/((y-v.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:f,lts:y,rate:A})):v?A=v.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:f,lts:y,rate:0}),r.receivedFrame={width:m||0,height:E||0,frameRate:A||0},r.decodedFrame={width:m||0,height:E||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:m||0,height:E||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(S&&I){const v=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let y=v.jitterBufferMs;const A=I-v.jitterBufferEmittedCount;A>0&&(y=1e3*(S-v.jitterBufferDelay)/A),r.jitterBufferMs=y,r.currentDelayMs=Math.round(y),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:S,jitterBufferEmittedCount:I,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(t,n,r){var i,a,c,d;const u=n?this.report.get(n):void 0,p=(i=(a=u==null?void 0:u.echoReturnLoss)!==null&&a!==void 0?a:t.echoReturnLoss)!==null&&i!==void 0?i:0,f=(c=(d=u==null?void 0:u.echoReturnLossEnhancement)!==null&&d!==void 0?d:t.echoReturnLossEnhancement)!==null&&c!==void 0?c:0;r.aecReturnLoss=p,r.aecReturnLossEnhancement=f}processAudioTrackReceiverStats(t,n,r){var i,a,c,d,u,p,f;const m=n?this.report.get(n):void 0,E=(i=m==null?void 0:m.removedSamplesForAcceleration)!==null&&i!==void 0?i:t.removedSamplesForAcceleration,S=(a=m==null?void 0:m.totalSamplesReceived)!==null&&a!==void 0?a:t.totalSamplesReceived,I=(c=m==null?void 0:m.jitterBufferDelay)!==null&&c!==void 0?c:t.jitterBufferDelay,v=(d=m==null?void 0:m.jitterBufferEmittedCount)!==null&&d!==void 0?d:t.jitterBufferEmittedCount,y=(u=m==null?void 0:m.audioLevel)!==null&&u!==void 0?u:t==null?void 0:t.audioLevel,A=(p=m==null?void 0:m.totalSamplesDuration)!==null&&p!==void 0?p:t==null?void 0:t.totalSamplesDuration,N=(f=m==null?void 0:m.concealedSamples)!==null&&f!==void 0?f:t.concealedSamples;if(E&&S&&(r.accelerateRate=E/S),I&&v){const F=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let G=F.jitterBufferMs;const z=v-F.jitterBufferEmittedCount;z>0&&(G=1e3*(I-F.jitterBufferDelay)/z),r.jitterBufferMs=Math.round(G),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:I,jitterBufferEmittedCount:v,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=y;let V=1920;A&&S&&(V=S/A/50,r.receivedFrames=Math.round(S/V)),N&&(r.droppedFrames=Math.round(N/V))}processRemoteInboundStats(t,n){const r=this.report.get(t);r&&(n.packetsLost=r.packetsLost,r.roundTripTime&&(n.rttMs=1e3*r.roundTripTime),r.jitter&&(n.jitterMs=1e3*r.jitter),r.timestamp&&(n.timestamp=r.timestamp))}getCodecFromCodecStats(t){const n=this.report.get(t);if(!n)return"";const r=n.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let t=0,n=null,r=null;this.mediaBytesSent.forEach(a=>{t+=a.diffMean()}),this.mediaBytesRetransmit.forEach(a=>{n=n===null?a.diffMean():n+a.diffMean()}),this.mediaBytesTargetEncode.forEach(a=>{r=r===null?a.diffMean():r+a.diffMean()});const i=n!==null?t-n:t;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},n!==null&&(this._stats.bitrate.retransmit=8*n/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}}class TX extends Iy{updateStats(){return ae.resolve()}}function Zm(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const a=function(){const c=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return c&&c[0]?Number(c[0].split("/")[1]):null}();return a?a<76?new SX(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new Yk(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(c){return!!window.RTCStatsReport&&c.getStats()instanceof ae}(e)?new Yk(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new TX(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}function qk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Jk(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qk(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qk(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function kh(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:a,filterAudioFec:c,filterAudioCodec:d,filterVideoCodec:u}=t,{useXR:p}=n;let f=[],m=[],E=[],S=[],I=!1,v=!1;if(Vt.parse(e).mediaDescriptions.forEach(A=>{r&&r!==A.attributes.direction||(A.media.mediaType!=="video"||I||(m=A.attributes.payloads,S=A.attributes.extmaps,I=!0),A.media.mediaType!=="audio"||v||(f=A.attributes.payloads,E=A.attributes.extmaps,v=!0))}),!S||m.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!E||f.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(m.forEach(A=>{var N;(N=A.rtpMap)!==null&&N!==void 0&&N.clockRate&&(A.rtpMap.clockRate=parseInt(A.rtpMap.clockRate)),p&&A.rtcpFeedbacks.push({type:"rrtr"})}),f.forEach(A=>{var N;(N=A.rtpMap)!==null&&N!==void 0&&N.clockRate&&(A.rtpMap.clockRate=parseInt(A.rtpMap.clockRate)),p&&A.rtcpFeedbacks.push({type:"rrtr"})}),i&&(f=f.filter(A=>{var N;return((N=A.rtpMap)===null||N===void 0?void 0:N.encodingName.toLowerCase())!=="rtx"}),m=m.filter(A=>{var N;return((N=A.rtpMap)===null||N===void 0?void 0:N.encodingName.toLowerCase())!=="rtx"})),a&&(m=m.filter(A=>{var N;return!/(red)|(ulpfec)|(flexfec)/i.test(((N=A.rtpMap)===null||N===void 0?void 0:N.encodingName)||"")})),c&&(f=f.filter(A=>{var N;return!/(red)|(ulpfec)|(flexfec)/i.test(((N=A.rtpMap)===null||N===void 0?void 0:N.encodingName)||"")})),d&&(d==null?void 0:d.length)>0&&(f=f.filter(A=>{var N;return le(d).call(d,((N=A.rtpMap)===null||N===void 0?void 0:N.encodingName.toLowerCase())||"")})),u&&(u==null?void 0:u.length)>0){const A=m.filter(N=>{var V;return le(u).call(u,((V=N.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())||"")});m=A.concat(i?[]:Dy(A,m))}const y=P("UNSUPPORTED_VIDEO_CODEC");return y&&y.length>0&&(m=m.filter(A=>!(A.rtpMap&&le(y).call(y,A.rtpMap.encodingName.toLowerCase())))),{audioCodecs:f,videoCodecs:m,audioExtensions:E,videoExtensions:S}}function Do(e){const t=Vt.parse(e);let n,r;for(const i of t.mediaDescriptions){if(!n){const a=i.attributes.iceUfrag,c=i.attributes.icePwd;if(!a||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:a,icePwd:c}}if(!r){const a=i.attributes.fingerprints;a.length>0&&(r={fingerprints:a})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function Ay(e,t){const n=[],r=e.attributes.ssrcGroups.filter(c=>c.semantic==="FID"),i=e.attributes.ssrcGroups.find(c=>c.semantic==="SIM"),a=e.attributes.ssrcs;if(i)i.ssrcIds.forEach(c=>{var d;const u=(d=r.find(p=>p.ssrcIds[0]===c))===null||d===void 0?void 0:d.ssrcIds[1];n.push({ssrcId:c,rtx:t?u:void 0})});else if(r.length>0){const c=r[0].ssrcIds[0],d=r[0].ssrcIds[1];n.push({ssrcId:c,rtx:t?d:void 0})}else{if(a.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:a[0].ssrcId})}return n}function Xk(e,t){const{cname:n}=e;let r;t&&t.ip&&typeof t.port=="number"?(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],T.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),T.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):r=e.iceParameters.candidates.map(d=>({foundation:d.foundation,componentId:"1",transport:d.protocol,priority:d.priority.toString(),connectionAddress:d.ip,port:d.port.toString(),type:d.type,extension:{}}));const i={fingerprints:e.dtlsParameters.fingerprints.map(d=>({hashFunction:d.algorithm,fingerprint:d.fingerprint}))},a={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let c;switch(e.dtlsParameters.role){case"server":c="passive";break;case"client":c="active";break;case"auto":c="actpass"}return{dtlsParameters:i,iceParameters:a,candidates:r,rtpCapabilities:Rl(e.rtpCapabilities),setup:c,cname:n}}function pi(e,t,n){const r=[],i=[];return e.forEach(a=>{let{ssrcId:c,rtx:d}=a;const u=Rt(8,"track-"),p={ssrcId:c,attributes:Jk({label:u,mslabel:n=n||Rt(10,""),msid:"".concat(n," ").concat(u)},t&&{cname:t})};if(r.push(p),d!==void 0){const f={ssrcId:d,attributes:Jk({label:u,mslabel:n,msid:"".concat(n," ").concat(u)},t&&{cname:t})};r.push(f),i.push({semantic:"FID",ssrcIds:[c,d]})}}),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map(a=>{let{ssrcId:c}=a;return c})}),{ssrcs:r,ssrcGroups:i}}function Aa(e,t){t instanceof qt&&e.attributes.payloads.forEach(n=>{var r;const i=(r=n.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const a=t._encoderConfig;a&&i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(a.bitrate&&!yt()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*a.bitrate))),a.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(a.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(a.sampleRate)),a.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function $m(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function e_(e,t){var n;if(!(t instanceof wt&&t._encoderConfig&&t._hints.indexOf(Ot.SCREEN_TRACK)===-1))return;const r=t._encoderConfig;Ze().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach(i=>{var a,c;le(a=["h264","h265","vp8","vp9","av1"]).call(a,((c=i.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),Ze().supportMinBitrate&&!le(n=t._hints).call(n,Ot.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach(i=>{var a,c;le(a=["h264","h265","vp8","vp9","av1"]).call(a,((c=i.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(P("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function by(e){if(e.media.mediaType!=="video")return;const t=tt();if(t.name!==dt.SAFARI&&t.os!==yn.IOS)return;const n=e.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function Cl(e,t,n){if(!t)return;let r,i;if(e.media.mediaType==="video"?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),t.twcc===!0){const a=r.find(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a&&(e.attributes.extmaps.find(d=>d.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||e.attributes.extmaps.push({entry:a.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(d,u){return u.filter(p=>!!d.find(f=>f.payloadType===p.payloadType&&!!f.rtcpFeedbacks.find(m=>m.type==="transport-cc")))}(i,e.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(u=>u.type==="transport-cc")||d.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(t.twcc===!1){const a=e.attributes.extmaps.findIndex(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a!==-1&&e.attributes.extmaps.splice(a,1),e.attributes.payloads.forEach(c=>{const d=c.rtcpFeedbacks.findIndex(u=>u.type==="transport-cc");d!==-1&&c.rtcpFeedbacks.splice(d,1)})}if(t.remb===!0){const a=r.find(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");a&&(e.attributes.extmaps.find(d=>d.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||e.attributes.extmaps.push({entry:a.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(d,u){return u.filter(p=>!!d.find(f=>f.payloadType===p.payloadType&&!!f.rtcpFeedbacks.find(m=>m.type==="goog-remb")))}(i,e.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(u=>u.type==="goog-remb")||d.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(t.remb===!1){const a=e.attributes.extmaps.findIndex(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");a!==-1&&e.attributes.extmaps.splice(a,1),e.attributes.payloads.forEach(c=>{const d=c.rtcpFeedbacks.findIndex(u=>u.type==="goog-remb");d!==-1&&c.rtcpFeedbacks.splice(d,1)})}}function Oy(e,t,n){if(yt()||e.media.mediaType!=="video"||!(t instanceof wt)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!P("SIMULCAST")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const r=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],a=e.attributes.ssrcGroups.find(d=>d.semantic==="FID"&&d.ssrcIds[0]===i.ssrcId),c={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let d=1;d<r;d++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+d,attributes:bt(i.attributes)}),c.ssrcIds.push(i.ssrcId+d),a&&(e.attributes.ssrcs.push({ssrcId:a.ssrcIds[1]+d,attributes:bt(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+d,a.ssrcIds[1]+d]}));e.attributes.ssrcGroups.unshift(c)}async function Ny(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:i,recv:a,sendrecv:c}=function(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;const f=kh(p,d,u,"sendonly"),m=kh(p,d,u,"recvonly"),E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(oo(f,m,"videoExtensions",E,S,I),oo(f,m,"videoCodecs",E,S,I),oo(f,m,"audioExtensions",E,S,I),oo(f,m,"audioCodecs",E,S,I),P("RAISE_H264_BASELINE_PRIORITY")){const v=I.videoCodecs.findIndex(y=>{var A,N;return((A=y.rtpMap)===null||A===void 0?void 0:A.encodingName.toLocaleLowerCase())==="h264"&&((N=y.fmtp)===null||N===void 0?void 0:N.parameters["profile-level-id"])==="42001f"});if(v!==-1){const y=I.videoCodecs.findIndex(A=>{var N;return((N=A.rtpMap)===null||N===void 0?void 0:N.encodingName.toLocaleLowerCase())==="h264"});if(y<v){T.debug("raising H264 baseline profile priority");const A=I.videoCodecs[v];I.videoCodecs.splice(v,1),I.videoCodecs.splice(y,0,A)}y!==-1&&(S.videoCodecs=S.videoCodecs.filter(A=>{var N,V;return!(((N=A.rtpMap)===null||N===void 0?void 0:N.encodingName.toLocaleLowerCase())==="h264"&&((V=A.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"])!=="42001f")})),y!==-1&&P("FILTER_SEND_H264_BASELINE")&&(E.videoCodecs=E.videoCodecs.filter(A=>{var N,V;return!(((N=A.rtpMap)===null||N===void 0?void 0:N.encodingName.toLocaleLowerCase())==="h264"&&((V=A.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"])!=="42001f")}))}}return{send:E,recv:S,sendrecv:I}}(e,t,r);try{n.close()}catch{}return{send:i,recv:a,sendrecv:c}}function Qk(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=kh(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(oo(e,t,"videoExtensions",n,r,i),oo(e,t,"videoCodecs",n,r,i),oo(e,t,"audioExtensions",n,r,i),oo(e,t,"audioCodecs",n,r,i),P("RAISE_H264_BASELINE_PRIORITY")){const a=i.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]==="42001f");if(a!==-1){const c=i.videoCodecs.findIndex(d=>d.rtpMap&&d.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(c<a){T.debug("raising H264 baseline profile priority");const d=i.videoCodecs[a];i.videoCodecs.splice(a,1),i.videoCodecs.splice(c,0,d)}c!==-1&&(r.videoCodecs=r.videoCodecs.filter(d=>!(d.rtpMap&&d.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&d.fmtp&&d.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:r,sendrecv:i}}function oo(e,t,n,r,i,a){if(n==="videoExtensions"||n==="audioExtensions"){const c=[];return e[n].forEach(d=>{t[n].some((u,p)=>{if(d.entry===u.entry&&d.extensionName===u.extensionName)return c.push(p),!0})?a[n].push(d):r[n].push(d)}),void t[n].forEach((d,u)=>{c.indexOf(u)===-1&&i[n].push(d)})}if(n==="videoCodecs"||n==="audioCodecs"){const c=[];return e[n].forEach(d=>{t[n].some((u,p)=>{if(d.payloadType===u.payloadType&&JSON.stringify(d)===JSON.stringify(u))return c.push(p),!0})?a[n].push(d):r[n].push(d)}),void t[n].forEach((d,u)=>{c.indexOf(u)===-1&&i[n].push(d)})}}function Rl(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,a;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=r,n?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...n.audioCodecs,...r.audioCodecs],a.videoCodecs=[...n.videoCodecs,...r.videoCodecs],a.audioExtensions=[...n.audioExtensions,...r.audioExtensions],a.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):a=r,{send:i,recv:a}}function Po(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function t_(e){e.mediaDescriptions.forEach(t=>{t.media.mediaType!=="video"&&t.media.mediaType!=="audio"||t.attributes.payloads.forEach(n=>{n.rtcpFeedbacks.findIndex(r=>r.type==="rrtr")===-1&&n.rtcpFeedbacks.push({type:"rrtr"})})})}function Wc(e,t,n,r){let i=[];if(e===Te.VIDEO){if(P("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(i=t.videoCodecs.filter(a=>{var c;return le(c=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(c,r)&&a&&a.fmtp&&a.fmtp.parameters["profile-level-id"]===P("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||i.length===0){let a=[];const c=[],d=[],u=[];if(n.videoCodecs.forEach(p=>{const f=p.rtpMap&&p.rtpMap.encodingName.toLowerCase()||"";le(f).call(f,r)?a.push(p):le(f).call(f,"vp9")?c.push(p):le(f).call(f,"vp8")?d.push(p):le(f).call(f,"h264")&&u.push(p)}),a.length===0){let p="";c.length!==0?(a=c,p="vp9"):d.length!==0?(a=d,p="vp8"):u.length!==0&&(a=u,p="h264"),T.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(p))}a.length!==0&&(i=t.videoCodecs.filter(p=>a.some(f=>f.payloadType===p.payloadType)))}if(i.length===0&&(T.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),P("USE_PUB_RTX")||P("USE_SUB_RTX")){const a=Dy(i,t.videoCodecs);i=[...i,...a]}}else i=t.audioCodecs.filter(a=>{var c;return le(c=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(c,r)}),i.length===0&&(T.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter(a=>{var c;return le(c=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")}));return i}function Dy(e,t){const n=e.map(r=>r.payloadType.toString());return t.filter(r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&le(n).call(n,r.fmtp&&r.fmtp.parameters.apt))}let Zk=class{get localCapabilities(){return bt(this._localCapabilities)}get rtpCapabilities(){return bt(this._rtpCapabilities)}get candidates(){return bt(this._candidates)}get iceParameters(){return bt(this._iceParameters)}get dtlsParameters(){return bt(this._dtlsParameters)}constructor(e){w(this,"sessionDesc",void 0),w(this,"_localCapabilities",void 0),w(this,"_rtpCapabilities",void 0),w(this,"_candidates",void 0),w(this,"_iceParameters",void 0),w(this,"_dtlsParameters",void 0),w(this,"setup",void 0),w(this,"currentMidIndex",void 0),w(this,"cname","o/i14u9pJrxRKAsu"),w(this,"firefoxSsrcMidMap",new Map),e=bt(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,localCapabilities:a,direction:c,setup:d,videoCodec:u,audioCodec:p}=e;let f;this.setup=d,f=c===mr.RECEIVE_ONLY?Vt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Vt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=a;const m=c===mr.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,E=c===mr.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,S=c===mr.RECEIVE_ONLY?i.send.videoCodecs:Wc(Te.VIDEO,m,E,u),I=c===mr.RECEIVE_ONLY?i.send.audioCodecs:Wc(Te.AUDIO,m,E,p);for(const v of f.mediaDescriptions)v.attributes.iceUfrag=t.iceUfrag,v.attributes.icePwd=t.icePwd,v.attributes.fingerprints=n.fingerprints,v.attributes.candidates=r,v.attributes.setup=this.setup,v.media.mediaType==="application"&&(v.attributes.sctpPort="5000"),v.media.mediaType==="video"&&(v.media.fmts=S.map(y=>y.payloadType.toString(10)),v.attributes.payloads=S,v.attributes.extmaps=m.videoExtensions),v.media.mediaType==="audio"&&(v.media.fmts=I.map(y=>y.payloadType.toString(10)),v.attributes.payloads=I,v.attributes.extmaps=m.audioExtensions,Po(v));this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}toString(){return Vt.print(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,r,i){n=n.replace(/ /g,"-");const{ssrcs:a,ssrcGroups:c}=pi(t,this.cname,P("SYNC_GROUP")?n:void 0),d=this.findPreloadMediaDesc(a);if(d){if(yt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,d.attributes.mid),i&&(i.twcc||i.remb)){const u=this.sessionDesc.mediaDescriptions.indexOf(d);return this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(d,i),{mid:d.attributes.mid,needExchangeSDP:!0}}return{mid:d.attributes.mid,needExchangeSDP:!1}}{const u=this.findAvailableMediaIndex(e,a,r);let p;return u===-1?(p=this.createOrRecycleSendMedia(e,a,c,"sendonly",r,i),this.updateBundleMids()):(p=bt(this.sessionDesc.mediaDescriptions[u]),p.attributes.direction="sendonly",p.attributes.ssrcs=a,p.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(p,i)),yt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,p.attributes.mid),{needExchangeSDP:!0,mid:p.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const r=[];return e.forEach(i=>{const a=i._mediaStreamTrack.kind,c=this.findAvailableRecvMediaIndex(a);let d,u=!1;c===-1?(u=!0,d=this.createOrRecycleRecvMedia(i,[],"recvonly",t,n),this.updateBundleMids()):(d=bt(this.sessionDesc.mediaDescriptions[c]),d.attributes.direction="recvonly"),r.push({mid:d.attributes.mid,needCreateTransceiver:u})}),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:r,port:i,type:a,relatedAddress:c,relatedPort:d,priority:u}=new RTCIceCandidate(e),p={foundation:t??"",componentId:"1",transport:n??"",priority:u?u+"":"",connectionAddress:r??"",port:i?i+"":"",type:a?a+"":"",relAddr:c??"",relPort:d?d+"":"",extension:{}};this.candidates.some(f=>f.priority===p.priority&&f.connectionAddress===p.connectionAddress&&f.port===p.port)||(this._candidates.push(p),this.sessionDesc.mediaDescriptions.forEach(f=>{f.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,i){const a=e._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,d=Wc(a,c,this.localCapabilities.send,a===Te.AUDIO?i:r),u=a===Te.VIDEO?c.videoExtensions:c.audioExtensions,p="".concat(++this.currentMidIndex);let f={media:{mediaType:a,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};f=this.mungRecvMediaDsec(f,e);const m=this.findFirstClosedMedia(a);if(m){const E=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[E]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>le(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>le(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(yt()){if(i){const a=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(a||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!a||a!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=bt(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,r,i,a){const c=this.rtpCapabilities.send,d=e===Te.VIDEO?c.videoCodecs:c.audioCodecs,u=e===Te.VIDEO?c.videoExtensions:c.audioExtensions;yt()&&(i="".concat(++this.currentMidIndex));let p={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};p=this.mungSendMediaDesc(p,a);const f=this.findFirstClosedMedia(e);if(f){const m=this.sessionDesc.mediaDescriptions.indexOf(f);this.sessionDesc.mediaDescriptions[m]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}mungRecvMediaDsec(e,t,n){const r=bt(e);return $m(r),Aa(r,t),e_(r,t),by(r),Cl(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=bt(e);return Cl(n,t,this.localCapabilities.recv),Po(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(n!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>yt()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const vX=["sdp"];var Pt;function $k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function ba(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$k(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$k(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let e2=(Pt=class Ll extends M1{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),w(this,"direction",void 0),w(this,"name",void 0),w(this,"store",void 0),w(this,"spec",void 0),w(this,"peerConnection",void 0),w(this,"initialOffer",void 0),w(this,"transport",void 0),w(this,"statsFilter",void 0),w(this,"localCandidateCount",0),w(this,"_isInRestartIce",!1),w(this,"mutex",new On("P2PConnection-mutex")),w(this,"onLocalCandidate",void 0),w(this,"remoteSDP",void 0),w(this,"pendingCandidates",[]),w(this,"localCapabilities",void 0),w(this,"isReady",!1),w(this,"restartCnt",0),w(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.peerConnection=new RTCPeerConnection(Ll.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??mr.SEND_ONLY,this.name=this.direction===mr.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Zm(this.peerConnection,P("STATS_UPDATE_INTERVAL"),void 0,yt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await Ny();if(this.localCapabilities=Rl(n),t){const{sdp:r}=t,i=EX(t,vX),a=function(){const f={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},m=kh(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(oo(m,f,"videoExtensions",E,S,I),oo(m,f,"videoCodecs",E,S,I),oo(m,f,"audioExtensions",E,S,I),oo(m,f,"audioCodecs",E,S,I),P("RAISE_H264_BASELINE_PRIORITY")){const v=I.videoCodecs.findIndex(y=>y.rtpMap&&y.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&y.fmtp&&y.fmtp.parameters["profile-level-id"]==="42001f");if(v!==-1){const y=I.videoCodecs.findIndex(A=>A.rtpMap&&A.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(y<v){T.debug("raising H264 baseline profile priority");const A=I.videoCodecs[v];I.videoCodecs.splice(v,1),I.videoCodecs.splice(y,0,A)}y!==-1&&P("FILTER_SEND_H264_BASELINE")&&(E.videoCodecs=E.videoCodecs.filter(A=>!(A.rtpMap&&A.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&A.fmtp&&A.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:E,recv:S,sendrecv:I}}({},{},r);this.remoteSDP=new Zk({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:a,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const c=await this.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const d=Do(c.sdp);await this.peerConnection.setLocalDescription(c);const u=await Qk({},{},c.sdp);this.localCapabilities=Rl(u);const p=this.peerConnection.getTransceivers()[0];return p!=null&&p.receiver&&p.receiver.transport&&this.tryBindTransportEvents(p.receiver.transport),ba(ba({},d),{},{sdp:c.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Do(r.sdp);return this.initialOffer=r,ba(ba({},i),{},{sdp:r.sdp})}}catch(n){throw new q(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:r,dtlsParameters:i}=t,a=await Qk({},{},n);this.remoteSDP=new Zk({remoteIceParameters:r,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:a,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const c=this.peerConnection.getTransceivers()[0];c!=null&&c.sender&&c.sender.transport&&this.tryBindTransportEvents(c.sender.transport)}catch(n){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new q(O.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,r){var i=this;return Yr(function*(){const a=yield Be(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],d=i.remoteSDP.receive(t,n,r);t.forEach((y,A)=>{if(d[A].needCreateTransceiver){const N=i.peerConnection.addTransceiver(y._mediaStreamTrack,{direction:"sendonly"});c.push(N),y._updateRtpTransceiver(N)}else{const N=i.peerConnection.getTransceivers().find(V=>V.mid===d[A].mid);if(!N)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(d[A].mid));c.push(N),y._updateRtpTransceiver(N)}}),yt()&&P("SIMULCAST")===!0&&(yield Be(i.applySimulcastForFirefox(c,t)));const u=d.map(y=>y.mid),p=yield Be(i.peerConnection.createOffer()),f=i.mungSendOfferSDP(p.sdp,t,u),m=Vt.parse(f),E=u.map(y=>{const A=m.mediaDescriptions.find(N=>N.attributes.mid===y);if(!A)throw new Error("Cannot extract ssrc from mediaDescription.");return Ay(A,P("USE_PUB_RTX"))}),S=c.map((y,A)=>{const N=u[A];return{localSSRC:E[A],id:N}});yield Be(i.peerConnection.setLocalDescription({type:"offer",sdp:f}));try{yield S}catch(y){const A=i.remoteSDP.toString();throw yield Be(i.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Be(i.peerConnection.setRemoteDescription({type:"answer",sdp:A})),yield Be(i.stopSending(u,!0)),y}yield Be(i.applySimulcastEncodings(c,t)),yield Be(i.applySendEncodings(c,t));const I=i.remoteSDP.toString(),v=i.logSDPExchange(f,"offer","local","send");return v==null||v(I),yield Be(i.setRemoteDescription({type:"answer",sdp:I})),c.map((y,A)=>{const N=u[A];return{localSSRC:E[A],id:N}})}catch(c){throw c instanceof q?c:new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(u=>t.indexOf(u.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));i.map(u=>{var p;u.direction="inactive",(p=u.stop)===null||p===void 0||p.call(u)});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(t,n,r,i);if(c){const u=this.remoteSDP.toString(),p=this.logSDPExchange(u,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:u});const f=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(f.sdp,a,t);p==null||p(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const d=this.peerConnection.getTransceivers().find(u=>u.mid===a);if(!d||d.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,mid:d.mid,transceiver:d}}catch(a){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async mockReceive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(t,n,r,i);if(c){const d=this.remoteSDP.toString(),u=this.logSDPExchange(d,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:d});const p=await this.peerConnection.createAnswer(),f=this.mungReceiveAnswerSDP(p.sdp,a,t);u==null||u(f||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:f}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(a){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===wc.Auto&&(this.store.p2pTransport=wc.SdRtn,Ze().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Ll.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Ze().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Ll.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:r}=Do(n.sdp);return this.store.descriptionStart(),this.direction===mr.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===mr.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:r}=Do(n.sdp);return await this.peerConnection.setLocalDescription(n),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const a=this.remoteSDP.toString(),c=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),c==null||c(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(r){throw new q(O.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?yt()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:ba(ba({},_s),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:ba(ba({},_s),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;le(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i={iceServers:[]};var a;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Hd(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...Ll.turnServerConfigToIceServers(t.turnServer.servers,n,r)),P("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...Ll.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),le(a=[wc.Relay,wc.SdRtn]).call(a,n)&&(i.iceTransportPolicy="relay"),P("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(i.iceTransportPolicy="relay")}))),P("ENABLE_ENCODED_TRANSFORM")&&Ze().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),T.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=[],a=t.filter(d=>d.tcpport);T.debug("P2PConnection turnServers is ".concat(a,", current index is ").concat(r));const c=a.length>r?a[r]:a[0];switch(n){case wc.SdRtn:const d=t.filter(p=>{var f;return le(f=p.username).call(f,"glb:")&&p.turnServerURL==p.turnServerURL}),u=d.length>r?d[r]:d[0];u&&(i.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(Sa(u.turnServerURL),":").concat(u.tcpport,"?transport=udp")}),i.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(Sa(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}));break;case wc.Relay:c&&(i.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),i.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Sa(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;default:c&&(i.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),i.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Sa(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}),i.push({username:c.username,credential:c.password,credentialType:"password",urls:"stun:".concat(c.turnServerURL,":").concat(c.tcpport)}))}return i}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in r?r.error:r)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const r=t==null?void 0:t.iceTransport.state;var i;r&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,r))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:r,remote:i}=n.getSelectedCandidatePair();T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find(f=>f.track===t._mediaStreamTrack)),!n)return T.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ze().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},a={};switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(t._encoderConfig){var c;const{bitrateMax:f,frameRate:m,scaleResolutionDownBy:E}=t._encoderConfig;f&&(a.maxBitrate=1e3*f),le(c=t._hints).call(c,Ot.LOW_STREAM)&&(m&&(a.maxFramerate=Dr(m)),E&&E>=1&&(a.scaleResolutionDownBy=E))}if(P("DSCP_TYPE")&&ha()){var d;const f=P("DSCP_TYPE");le(d=["very-low","low","medium","high"]).call(d,f)&&(a.networkPriority=f)}const u=n.getParameters(),p=(r=u.encodings)===null||r===void 0?void 0:r[0];yt()&&!p&&(i.encodings=[a]),p&&Object.assign(p,a),Object.assign(u,i),T.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(u.encodings))),await n.setParameters(u)}async applySendEncodings(t,n){try{if(!Ze().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],a=n[r];a instanceof wt&&!this.isVP8Simulcast(a)&&await this.updateRtpSenderEncodings(a,i.sender)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const i=Vt.parse(t);return n.forEach((a,c)=>{const d=r[c],u=i.mediaDescriptions.find(p=>p.attributes.mid===d);u&&(Aa(u,a),Oy(u,a,this.store.codec))}),Vt.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let u=0;u<t.length;u++){var r,i,a,c,d;const p=t[u],f=n[u];if(f instanceof wt&&!le(r=f._hints).call(r,Ot.LOW_STREAM)&&(i=f._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((a=f._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(c=f._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((d=f._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1&&this.store.codec==="vp8"){const m={},E={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const S=p.sender.getParameters();await p.sender.setParameters(Object.assign(S,m))}}}async applySimulcastEncodings(t,n){if(!yt()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof wt&&this.isVP8Simulcast(i)){const a=t[r],c={},d={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:d.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:d.medium,scaleResolutionDownBy:4}];const u=a.sender.getParameters();await a.sender.setParameters(Object.assign(u,c))}}}isVP8Simulcast(t){var n,r,i,a,c;return!!(t instanceof wt&&P("SIMULCAST")&&this.store.codec==="vp8"&&!le(n=t._hints).call(n,Ot.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(a=t._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=t._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(P("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",r==="local"?"remote":"local",i)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const a=this.remoteSDP.toString();i==null||i(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async c=>{c.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const a=this.remoteSDP.toString();i==null||i(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var r,i;if(n=(r=n)!==null&&r!==void 0?r:(i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp){var a;const c=(a=Vt.parse(n).mediaDescriptions.find(d=>d.attributes.mid===t))===null||a===void 0?void 0:a.attributes.ssrcs;return c==null?void 0:c[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),le(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,r){const i=Vt.parse(t),a=i.mediaDescriptions.find(c=>c.attributes.mid===n);return a&&r===Te.AUDIO&&a.media.mediaType==="audio"&&Po(a),Vt.print(i)}},se(Pt.prototype,"establish",[so],Object.getOwnPropertyDescriptor(Pt.prototype,"establish"),Pt.prototype),se(Pt.prototype,"connect",[so],Object.getOwnPropertyDescriptor(Pt.prototype,"connect"),Pt.prototype),se(Pt.prototype,"receive",[so],Object.getOwnPropertyDescriptor(Pt.prototype,"receive"),Pt.prototype),se(Pt.prototype,"mockReceive",[so],Object.getOwnPropertyDescriptor(Pt.prototype,"mockReceive"),Pt.prototype),se(Pt.prototype,"stopReceiving",[so],Object.getOwnPropertyDescriptor(Pt.prototype,"stopReceiving"),Pt.prototype),se(Pt.prototype,"restartICE",[so],Object.getOwnPropertyDescriptor(Pt.prototype,"restartICE"),Pt.prototype),se(Pt.prototype,"close",[so],Object.getOwnPropertyDescriptor(Pt.prototype,"close"),Pt.prototype),se(Pt.prototype,"updateEncoderConfig",[so],Object.getOwnPropertyDescriptor(Pt.prototype,"updateEncoderConfig"),Pt.prototype),se(Pt.prototype,"updateSendParameters",[so],Object.getOwnPropertyDescriptor(Pt.prototype,"updateSendParameters"),Pt.prototype),se(Pt.prototype,"replaceTrack",[so],Object.getOwnPropertyDescriptor(Pt.prototype,"replaceTrack"),Pt.prototype),se(Pt.prototype,"muteLocal",[so],Object.getOwnPropertyDescriptor(Pt.prototype,"muteLocal"),Pt.prototype),se(Pt.prototype,"unmuteLocal",[so],Object.getOwnPropertyDescriptor(Pt.prototype,"unmuteLocal"),Pt.prototype),Pt);function so(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,a=await i.lock("From P2PConnection.".concat(t));try{for(var c=arguments.length,d=new Array(c),u=0;u<c;u++)d[u]=arguments[u];return await r.apply(this,d)}finally{a()}},n}function Py(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=Dr(t.width),r.height=Dr(t.height);const i=Dr(t.framerate||15);document.body.append(n),document.body.append(r);let a=e._mediaStreamTrack;n.srcObject=new MediaStream([a]),n.play();const c=r.getContext("2d");if(!c)throw new B(O.UNEXPECTED_ERROR,"can not get canvas context");const d=Ze(),u=r.captureStream(d.supportRequestFrame?0:i).getVideoTracks()[0];u.canvas||(u.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const f=n.videoWidth,m=n.videoHeight/f,E=r.width*m;Math.abs(E-r.height)>=2&&(T.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(E)),r.height=E)}c.drawImage(n,0,0,r.width,r.height),u.requestFrame&&u.requestFrame(),a!==e._mediaStreamTrack&&(a=e._mediaStreamTrack,n.srcObject=new MediaStream([a]))},r.stopCapture=py(()=>r.startCapture&&r.startCapture(),i);const p=u.stop;return u.stop=()=>{p.call(u),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),T.debug("clean low stream renderer")},u}var n_=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(n_||{}),In=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e}(In||{}),Hc=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(Hc||{}),er=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e}(er||{}),Kc=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(Kc||{}),t2=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(t2||{}),Oa=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e}(Oa||{}),ao=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e}(ao||{}),n2=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(n2||{}),Oi=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e}(Oi||{});const Fs=1e3,zc=3;function We(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function r2(e){const t={[Oi.CONN_TYPE]:0,[Oi.RTT]:e.rtt};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[Oi.CONN_TYPE]=1),n==="tcp"&&(t[Oi.CONN_TYPE]=3),n==="tls"&&(t[Oi.CONN_TYPE]=4);break}case"srflx":t[Oi.CONN_TYPE]=2}return t}function i2(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class o2 extends xt{constructor(t){super(),w(this,"store",void 0),w(this,"uploadWRTCStatsTimer",void 0),w(this,"uploadOutboundDenoiserStatsTimer",void 0),w(this,"uploadExtStatsTimer",void 0),w(this,"uploadExtUsageStatsTimer",void 0),w(this,"uploadInboundExtStatsTimer",void 0),w(this,"requestStats",void 0),w(this,"requestTransportStats",void 0),w(this,"requestLocalMedia",void 0),w(this,"requestRemoteMedia",void 0),w(this,"requestAllTracks",void 0),w(this,"requestVideoIsReady",void 0),w(this,"requestUploadStats",void 0),w(this,"requestUpload",void 0),w(this,"uploadOutboundStarted",!1),w(this,"uploadInboundStarted",!1),w(this,"uploadTransportStarted",!1),w(this,"uploadExtensionUsageStarted",!1),w(this,"lastRecvStats",void 0),w(this,"lastSendStats",void 0),w(this,"lastFullRecvStats",void 0),w(this,"lastFullSendStats",void 0),w(this,"needUploadRenderFreezeTime",!0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;let n,r;if(this.uploadTransportStarted&&(n=this.requestStats(),this.store.useP2P&&(r=this.requestStats(!0))),!n&&this.uploadOutboundStarted&&(n=this.requestStats()),!r&&this.uploadInboundStarted&&(r=this.requestStats(!0)),n||r){const i={};if(this.uploadTransportStarted&&n){const a=this.getTransportStats(n,r,t);a&&(i.misc=[a])}if(this.uploadOutboundStarted&&n){const a=this.getOutboundStats(n,t?this.lastSendStats:this.lastFullSendStats,t);a&&(i.outbound=[a])}if(this.uploadInboundStarted&&r){const a=this.getInboundStats(r,t?this.lastRecvStats:this.lastFullRecvStats,t);a&&(i.inbound=a)}this.requestUploadStats(i)}this.lastRecvStats=r,this.lastSendStats=n,t||(this.lastFullRecvStats=r,this.lastFullSendStats=n)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(t!==zc),++t===zc+1&&(t=1)},Fs)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(t,n,r){if(!this.requestStats)return;if(r)return t.rtt==null?void 0:{addition:{[Oi.RTT]:t.rtt,[Oi.CONN_TYPE]:void 0}};const i=r2(t);if(this.store.useP2P){if(n){const a=r2(n);i[Oi.CONN_TYPE]+=a[Oi.CONN_TYPE]<<3}i[Oi.CONN_TYPE]+=110}else i[Oi.CONN_TYPE]+=100;return{addition:i}}getOutboundStats(t,n,r){if(!this.requestUploadStats||!this.requestLocalMedia)return;const i=this.requestLocalMedia();if(!i||i.length===0)return;let a,c,d;return i.forEach(u=>{let[p,{track:f,ssrcs:m}]=u;switch(p){case ne.LocalVideoLowTrack:case ne.LocalVideoTrack:if(p===ne.LocalVideoTrack){const E=function(v,y,A,N,V){const F=y.videoSend.find(me=>me.ssrc===v);if(!F)return;const G={},{sentFrame:z,inputFrame:Q}=F;if(Q&&z){const me=Q.frameRate,Qe=z.frameRate;G[In.FREEZE]=function(ct,Nt){let cn=!0;return cn=!(ct<=5)&&(ct<=10?Nt<3:ct<=20?Nt<4:Nt<5),cn}(me,Qe)?1:0}if(We(G,In.QP_SUM,F.qpSumPerFrame),V)return G;switch(z&&(We(G,In.HEIGHT,z.height),We(G,In.WIDTH,z.width),We(G,In.FRAME_RATE,z.frameRate)),G[In.DISABLED]=N._originMediaStreamTrack&&!N._originMediaStreamTrack.enabled||N._mediaStreamTrack&&!N._mediaStreamTrack.enabled?1:0,F.adaptionChangeReason){case"none":G[In.ADAPTATION]=0;break;case"cpu":G[In.ADAPTATION]=1;break;case"bandwidth":G[In.ADAPTATION]=2;break;case"other":G[In.ADAPTATION]=3}let Z=0;F.adaptionChangeReason&&(Z+=i2(F.adaptionChangeReason)),y.qualityLimitationReason&&(Z+=i2(y.qualityLimitationReason)<<3),G[In.ADAPTATION]=Z,G[In.PLAYER_STATUS]=uy[N._player?N._player.videoElementStatus:"uninit"],We(G,In.NACKS,F.nacksCount),We(G,In.PLIS,F.plisCount),We(G,In.FIRS,F.firsCount),We(G,In.AVG_ENCODE,F.avgEncodeMs);const ee=A&&A.videoSend.find(me=>me.ssrc===v);if(ee){let me=V?Fs:Fs*zc;ee.timestamp&&F.timestamp&&(me=F.timestamp-ee.timestamp),ee.packets!=null&&F.packets!=null&&We(G,In.PACKAGE_RATE,1e3*(F.packets-ee.packets)/me),F.packetsLost!=null&&ee.packetsLost!=null&&We(G,In.PACKAGE_LOST,F.packetsLost-ee.packetsLost),ee.bytes!=null&&F.bytes!=null&&We(G,In.BITRATE,8*(F.bytes-ee.bytes)/me)}return G}(m[0].ssrcId,t,n,f,r),S=r?null:function(v,y,A){const N=y.videoSend.find(Z=>Z.ssrc===v);if(!N)return null;const V={},F=N.inputFrame,G=F&&F.height||A&&A.videoHeight||0,z=F&&F.width||A&&A.videoWidth||0,Q=F&&F.frameRate||0;return We(V,n_.HEIGHT,G),We(V,n_.WIDTH,z),We(V,n_.FRAME_RATE,Q),V}(m[0].ssrcId,t,f),I=r?null:function(v){const y={};return We(y,In.RETRANSMIT,v.bitrate.retransmit),We(y,In.TARGET_ENCODED,v.bitrate.targetEncoded),We(y,In.ACTUAL_ENCODED,v.bitrate.actualEncoded),We(y,In.TRANSMIT,v.bitrate.transmit),We(y,In.BANDWIDTH,v.sendBandwidth),y}(t);c=Object.assign({},E,S,I)}else d=r?void 0:function(E,S,I){const v=S.videoSend.find(N=>N.ssrc===E);if(!v)return;const y={},A=v.sentFrame;if(A&&(We(y,Hc.HEIGHT,A.height),We(y,Hc.WIDTH,A.width),We(y,Hc.FRAME_RATE,A.frameRate)),I){const N=I.videoSend.find(V=>V.ssrc===E);if(N){let V=Fs*zc;N.timestamp&&v.timestamp&&(V=v.timestamp-N.timestamp),N.packets!=null&&v.packets!=null&&We(y,Hc.PACKAGE_RATE,1e3*(v.packets-N.packets)/V),v.packetsLost!=null&&N.packetsLost!=null&&We(y,Hc.PACKAGE_LOST,v.packetsLost-N.packetsLost),N.bytes!=null&&v.bytes!=null&&We(y,Hc.BITRATE,8*(v.bytes-N.bytes)/V)}}return y}(m[0].ssrcId,t,n);break;case ne.LocalAudioTrack:a=r?void 0:function(E,S,I,v){const y=S.audioSend.find(G=>G.ssrc===E);if(!y)return;const A={};A[Oa.DISABLED]=v._originMediaStreamTrack&&!v._originMediaStreamTrack.enabled||v._mediaStreamTrack&&!v._mediaStreamTrack.enabled?1:0;const N=100*v._source.getAccurateVolumeLevel(),V=y.inputLevel;if(V!=null){const G=Math.ceil(50*Math.log10(100*V+1));We(A,Oa.LEVEL,G)}We(A,t2.PCM_LEVEL,N),We(A,Oa.AEC_RETURN_LOSS,y.aecReturnLoss),We(A,Oa.AEC_RETURN_LOSS_ENH,y.aecReturnLossEnhancement),A[Oa.FREEZE]=0;const F=I&&I.audioSend.find(G=>G.ssrc===E);if(F){let G=Fs*zc;F.timestamp&&y.timestamp&&(G=y.timestamp-F.timestamp),F.bytes!=null&&y.bytes!=null&&We(A,Oa.BITRATE,8*(y.bytes-F.bytes)/G),F.packets!=null&&y.packets!=null&&We(A,Oa.PACKAGE_RATE,1e3*(y.packets-F.packets)/G)}return A}(m[0].ssrcId,t,n,f)}}),{high:c,low:d,audio:a}}getInboundStats(t,n,r){if(!this.requestRemoteMedia)return;const i=this.requestRemoteMedia()||[],a=[];return i.forEach(c=>{let[d,u]=c;const p={peer:d.uid};if(u.has(Te.VIDEO)&&d.videoTrack){const f=d._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(d._videoSSRC)||!1,m=d.videoTrack?function(E,S,I,v,y,A,N){var V;const F=S.videoRecv.find(Qe=>Qe.ssrc===E);if(!F)return;const G={},{receivedFrame:z,outputFrame:Q,decodeFrameRate:Z}=F,ee=I&&I.videoRecv.find(Qe=>Qe.ssrc===E);if(G[er.FREEZE]=y&&Mh.isRemoteVideoFreeze(v,F,ee)?1:0,We(G,Kc.FRAME_RATE_DECODE,Z),We(G,er.QP_SUM,F.qpSumPerFrame),F.framesRateFirefox&&We(G,er.FRAME_RATE,F.framesRateFirefox),z&&We(G,er.FRAME_RATE,z.frameRate),ee){const Qe=S.timestamp-I.timestamp||(N?Fs:zc*Fs);F.packetsLost!=null&&ee.packetsLost!=null&&We(G,er.PACKAGE_LOST,F.packetsLost-ee.packetsLost),ee.bytes!=null&&F.bytes!=null&&We(G,er.BITRATE,8*(F.bytes-ee.bytes)/Qe),ee.packets!=null&&F.packets!=null&&We(G,er.PACKAGE_RATE,1e3*(F.packets-ee.packets)/Qe)}if(N)return G;z?(We(G,er.HEIGHT,z.height),We(G,er.WIDTH,z.width)):v&&(We(G,er.HEIGHT,v._videoHeight||0),We(G,er.WIDTH,v._videoWidth||0)),Q&&We(G,Kc.FRAME_RATE_OUTPUT,Q.frameRate);const me=(V=v._player)===null||V===void 0?void 0:V.rendFrameRate.toFixed(0);if(me&&We(G,Kc.FRAME_RATE_RENDER,+me),We(G,er.JITTER_BUFFER,F.jitterBufferMs),We(G,er.CURRENT_DELAY,F.currentDelayMs),We(G,er.FIRS,F.firsCount),We(G,er.NACKS,F.nacksCount),We(G,er.PLIS,F.plisCount),v){G[er.DISABLED]=v._originMediaStreamTrack.enabled&&v._mediaStreamTrack.enabled?0:1;const Qe=v._player;if(Qe){const{freezeTimeCounterList:ct,renderFreezeAccTime:Nt,videoElementStatus:cn}=Qe;if(ct&&ct.length>0&&We(G,Kc.FREEZE_TIME,ct.splice(0,1)[0]),A&&js.visibility==="visible"&&cn===ar.PLAYING&&Ze().supportRequestVideoFrameCallback){const Wt=Math.min(6e3,Nt);Qe.renderFreezeAccTime=Math.max(0,Nt-Wt),We(G,Kc.FREEZE_TIME_RENDER,Wt)}if(typeof F.totalFreezesDuration=="number"){const Wt=ee&&ee.totalFreezesDuration?F.totalFreezesDuration-ee.totalFreezesDuration:F.totalFreezesDuration;We(G,Kc.FREEZE_DURATION,1e3*Wt)}}}if(G[er.PLAYER_STATUS]=uy[v._player?v._player.videoElementStatus:"uninit"],ee&&F.totalInterFrameDelay!==void 0&&F.totalSquaredInterFrameDelay!==void 0&&ee.totalInterFrameDelay!==void 0&&ee.totalSquaredInterFrameDelay!==void 0){const Qe=F.totalInterFrameDelay-ee.totalInterFrameDelay,ct=F.totalSquaredInterFrameDelay-ee.totalSquaredInterFrameDelay,Nt=F.framesDecodeCount-ee.framesDecodeCount,cn=Qe/Nt*1e3,Wt=Math.round(1e3*Math.sqrt((ct-Math.pow(Qe,2)/Nt)/Nt));!isNaN(Wt)&&cn+Wt>Math.max(3*cn,cn+150)&&(G[er.I_FRAME_DELAY]=Wt)}return G}(d._videoSSRC,t,n,d.videoTrack,f===!0,this.needUploadRenderFreezeTime,r):void 0;m&&(p.video=m)}if(u.has(Te.AUDIO)&&d.audioTrack){const f=d.audioTrack?function(m,E,S,I,v){const y=E.audioRecv.find(ee=>ee.ssrc===m);if(!y)return;const A={},N=S&&S.audioRecv.find(ee=>ee.ssrc===m),{receivedFrames:V,droppedFrames:F}=y;var G,z;if(We(A,ao.JITTER,y.jitterMs),V!=null&&F!=null&&(A[ao.FREEZE]=(z=F,(G=V)===0||100*z/G>20?1:0)),N){const ee=E.timestamp-S.timestamp||(v?Fs:Fs*zc);y.packets!=null&&N.packets!=null&&We(A,ao.PACKAGE_RATE,1e3*(y.packets-N.packets)/ee),N.bytes!=null&&y.bytes!=null&&We(A,ao.BITRATE,8*(y.bytes-N.bytes)/ee),y.packetsLost!=null&&N.packetsLost!=null&&We(A,ao.PACKAGE_LOST,y.packetsLost-N.packetsLost)}if(v)return A;const Q=100*I._source.getAccurateVolumeLevel(),Z=y.outputLevel;if(Z!=null){const ee=Math.ceil(50*Math.log10(100*Z+1));We(A,n2.LEVEL,ee)}if(We(A,ao.PCM_LEVEL,Q),I&&(A[ao.DISABLED]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1),We(A,ao.JITTER_BUFFER,y.jitterBufferMs),We(A,ao.CURRENT_DELAY,y.jitterBufferMs),A[ao.PLAYER_STATUS]=uy[Rr.getPlayerState(I.getTrackId())],N){const ee=y.concealedSamples-N.concealedSamples;ee>0&&We(A,ao.CONCEALED_SAMPLES,ee)}return A}(d._audioSSRC,t,n,d.audioTrack,r):void 0;f&&(p.audio=f)}(p.video||p.audio)&&a.push(p)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,a}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof Ym);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(Ac.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,r]=t;r.has(Te.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}),r.has(Te.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),r={connectionInterval:P("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let i=[];const a=this.requestAllTracks&&this.requestAllTracks()||[];for(const p of a)!p.muted&&p.enabled&&(i=i.concat(await p.getProcessorUsage()));const c=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[p,f]of c)f.has(Te.VIDEO)&&p.videoTrack&&(i=i.concat(await p.videoTrack.getProcessorUsage())),f.has(Te.AUDIO)&&p.audioTrack&&(i=i.concat(await p.audioTrack.getProcessorUsage()));if(i.length===0)return;r.details=function(p,f){const m={};for(const{id:v,value:y,level:A,direction:N}of p){var E;const V=(E=f.get(v))!==null&&E!==void 0?E:0,F=y===2?V+P("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:V;var S,I;f.set(v,F),m[v]?(y===2&&(m[v].value=y),A>m[v].level&&(m[v].level=A),N==="remote"&&(m[v].remoteUidCount+=1),m[v].totalTs=(S=f.get(v))!==null&&S!==void 0?S:0):m[v]={value:y,level:A,remoteUidCount:N==="local"?0:1,totalTs:(I=f.get(v))!==null&&I!==void 0?I:0}}return Object.keys(m).map(v=>{const{level:y,value:A,totalTs:N}=m[v];return{id:v,level:y,value:A,totalTs:N}})}(i,t);const d=Date.now(),u=d>n?d:n+1;this.requestUpload&&this.requestUpload(Ac.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:u})},P("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class Na{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){w(this,"uid",void 0),w(this,"_uintid",void 0),w(this,"_trust_in_room_",!0),w(this,"_trust_audio_enabled_state_",!0),w(this,"_trust_video_enabled_state_",!0),w(this,"_trust_audio_mute_state_",!0),w(this,"_trust_video_mute_state_",!0),w(this,"_audio_muted_",!1),w(this,"_video_muted_",!1),w(this,"_audio_enabled_",!0),w(this,"_video_enabled_",!0),w(this,"_audio_added_",!1),w(this,"_video_added_",!1),w(this,"_is_pre_created",!1),w(this,"_video_pre_subscribed",!1),w(this,"_audio_pre_subscribed",!1),w(this,"_trust_video_stream_added_state_",!0),w(this,"_trust_audio_stream_added_state_",!0),w(this,"_audioTrack",void 0),w(this,"_videoTrack",void 0),w(this,"_dataChannels",[]),w(this,"_audioSSRC",void 0),w(this,"_videoSSRC",void 0),w(this,"_audioOrtc",void 0),w(this,"_videoOrtc",void 0),w(this,"_cname",void 0),w(this,"_rtxSsrcId",void 0),w(this,"_videoMid",void 0),w(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}let Lo=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});function yX(e,t){var n;let r;switch(t){case ne.LocalAudioTrack:r=lt.Audio;break;case ne.LocalVideoTrack:r=le(n=e._hints).call(n,Ot.SCREEN_TRACK)?lt.Screen:lt.High;break;case ne.LocalVideoLowTrack:r=lt.Low}return r}function Ly(e){const t=Ze();if(e.some(n=>n._bypassWebAudio))throw new q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new q(O.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function ky(e,t){Ly(e);const n=new gn;return e.forEach(r=>n.addAudioTrack(r)),n}var s2,a2,c2,d2,l2,u2,h2,p2,f2,m2,_2,jt;function E2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function r_(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?E2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let qr=(s2=ko(Lo.SEND_ONLY),a2=ko(Lo.SEND_ONLY),c2=ko(),d2=ko(Lo.RECEIVE_ONLY),l2=ko(Lo.RECEIVE_ONLY),u2=ko(Lo.RECEIVE_ONLY),h2=ko(Lo.RECEIVE_ONLY),p2=ko(Lo.RECEIVE_ONLY),f2=ko(Lo.RECEIVE_ONLY),m2=ko(),_2=ko(Lo.RECEIVE_ONLY),jt=class extends xt{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Oe.StateChange,t,this._state)}constructor(e,t){super(),w(this,"store",void 0),w(this,"statsUploader",void 0),w(this,"sendConnection",void 0),w(this,"recvConnection",void 0),w(this,"localTrackMap",new Map),w(this,"remoteUserMap",new Map),w(this,"localDataChannels",[]),w(this,"pendingLocalTracks",[]),w(this,"pendingRemoteTracks",[]),w(this,"statsCollector",void 0),w(this,"dtlsFailedCount",0),w(this,"sendMutex",new On("P2PChannel2-send-mutex")),w(this,"recvMutex",new On("P2PChannel2-recv-mutex")),w(this,"_state",ut.Disconnected),w(this,"_restartStates",["disconnected","failed"]),w(this,"reconnectInterval",void 0),w(this,"uploadUnplinkStarted",!1),w(this,"uploadDownlinkStarted",!1),w(this,"uplinkStateUploadInterval",void 0),w(this,"downlinkStatsUploadInterval",void 0),w(this,"handleMuteLocalTrack",async(n,r,i)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==ut.Connected)return void i(new q(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const u=this.filterTobeMutedTracks(n);if(u.length===0)return void r();const p=u.find(S=>S[0]==="videoLowTrack");p&&p[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(u.map(S=>{let[,{id:I}]=S;return I}));let f=!1;var c,d;n.trackMediaType==="video"?f=!((c=this.localTrackMap.get(ne.LocalAudioTrack))===null||c===void 0||!c.track._muted):f=((d=this.localTrackMap.get(ne.LocalVideoTrack))===null||d===void 0?void 0:d.id)===void 0;const m=this.createMuteMessage(u);await Ct(this,Oe.RequestMuteLocal,m);const E=n.trackMediaType==="video"?ga.MUTE_LOCAL_VIDEO:ga.MUTE_LOCAL_AUDIO;await Ct(this,Oe.RequestP2PMuteLocal,{action:E,message:m,isMuteAll:f}),r()}catch(u){i(u)}finally{a()}}),w(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==ut.Connected)return void i(new q(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void r();await this.sendConnection.unmuteLocal(c.map(p=>{let[,{id:f}]=p;return f}));const d=this.createUnmuteMessage(c),u=n.trackMediaType==="video"?ga.UNMUTE_LOCAL_VIDEO:ga.UNMUTE_LOCAL_AUDIO;await Ct(this,Oe.RequestP2PMuteLocal,{action:u,message:d}),r()}catch(c){i(c)}finally{a()}}),w(this,"handleUpdateVideoEncoder",async(n,r,i)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const c=this.localTrackMap.get(ne.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==n||this.state!==ut.Connected)return void r();const{id:d,track:u}=c;d&&(await this.sendConnection.updateSendParameters(d,u),await this.sendConnection.updateEncoderConfig(d,u),this.emit(Oe.UpdateVideoEncoder,u)),r()}catch(c){i(c)}finally{a()}}),w(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(ne.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==n||this.state!==ut.Connected)return void r();const{id:d,track:u}=c;d&&await this.sendConnection.updateSendParameters(d,u),r()}catch(c){i(c)}finally{a()}}),w(this,"handleReplaceTrack",async(n,r,i,a)=>{let c;T.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof a=="boolean"&&a||(c=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var d;const p=Array.from(this.localTrackMap.entries()).find(f=>{let[,{track:m}]=f;return n===m});if(!this.sendConnection||!p||p[1].id===void 0||this.state!==ut.Connected)return void r();if(await((d=this.sendConnection)===null||d===void 0?void 0:d.replaceTrack(n,p[1].id)),p[0]===ne.LocalVideoTrack&&Ze().supportDualStreamEncoding){const f=this.localTrackMap.get(ne.LocalVideoLowTrack);if(f){const m=n._mediaStreamTrack.clone();f.track._originMediaStreamTrack.stop(),f.track._mediaStreamTrack=m,f.track._originMediaStreamTrack=m,await new ae((E,S)=>{this.handleReplaceTrack(f.track,E,S,!0)})}}r()}catch(p){i(p)}finally{var u;(u=c)===null||u===void 0||u()}}),w(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),w(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),w(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),w(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new o2(e),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},P("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new q(O.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e,t,n,r,i,a){throw new q(O.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new e2(e,this.store,mr.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=ut.New,this.sendConnection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new e2(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new q(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ut.Connected}async addRemoteCandidate(e,t){if(t===mr.RECEIVE_ONLY){if(!this.sendConnection)throw new q(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new q(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var r=this;return Yr(function*(){const i=yield Be(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==ut.Connected){r.throwIfTrackTypeNotMatch(e);const p=e.filter(f=>r.pendingLocalTracks.indexOf(f)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(p))}r.store.pubId=r.store.pubId+1,Qn.markPublishStart(r.store.clientId,r.store.pubId);const a=r.filterTobePublishedTracks(e,t,n);if(a.length===0)return void(yield Be(r.tryToUnmuteAudio(e)));a.forEach(p=>{let{track:f,type:m}=p;const E=Date.now();r.store.publish(f.getTrackId(),m===ne.LocalAudioTrack?"audio":"video",E)}),r.bindLocalTrackEvents(a);const c=yield Be(r.sendConnection.send(a.map(p=>{let{track:f}=p;return f}),r.store.codec,r.store.audioCodec)),d=(yield Be(c.next())).value,u=r.createGatewayPublishMessage(a,d);try{yield u}catch(p){throw c.throw(p),(p==null?void 0:p.code)===O.WS_ABORT&&a.forEach(f=>{let{track:m}=f;r.pendingLocalTracks.indexOf(m)===-1&&r.pendingLocalTracks.push(m)}),r.unbindLocalTrackEvents(a),p}yield Be(c.next()),a.forEach(p=>{let{type:f}=p;r.statsCollector.addLocalStats(f)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(a,d),a.forEach(p=>{let{track:f,type:m}=p;const E=Date.now();r.store.publish(f.getTrackId(),m===ne.LocalAudioTrack?"audio":"video",void 0,E)}),r.startUploadUplinkState()}finally{i()}})()}async unpublish(e){if(!this.sendConnection||this.state!==ut.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i=>!le(e).call(e,i)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(i=>i[0]==="videoLowTrack");n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(i=>{let[,{id:a}]=i;return a})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[a,{track:c}]=i;return{type:a,track:c}})),t.forEach(i=>{let[a]=i;this.statsCollector.removeLocalStats(a)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===ut.Connected)return n&&n[1].track.close(),r;e.forEach(i=>{const a=this.pendingLocalTracks.indexOf(i);a!==-1&&this.pendingLocalTracks.splice(a,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[i,{track:a,ssrcs:c}]=r;const d={stream_type:yX(a,i),ssrcs:c};a._muted||!a._enabled?t.push(d):n.push(d)}),t.length>0&&t.forEach(r=>{Ct(this,Oe.RequestMuteLocal,[r])}),n.length>0&&n.forEach(r=>{Ct(this,Oe.RequestUnmuteLocal,[r])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Yr(function*(){throw new q(O.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(T.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await un(this,Oe.RequestRePublish,this.pendingLocalTracks),this.emit(Oe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new q(O.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,r){var i;if(!this.recvConnection)throw new q(O.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(e))!==null&&i!==void 0&&i.has(t))return;const{track:a,mid:c,transceiver:d}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===Te.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new yl(a,e.uid,e._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),d&&e._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new vl(a,e.uid,e._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),d&&e._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._videoTrack));const u=this.remoteUserMap.get(e);u?u.set(t,c):this.remoteUserMap.set(e,new Map([[t,c]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const p=this.pendingRemoteTracks.findIndex(f=>{let{user:m,kind:E}=f;return m.uid===e.uid&&t===E});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(Oe.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,r){if(!this.recvConnection)throw new q(O.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(a=>{let{user:c,kind:d}=a;return t!==void 0?c.uid===e.uid&&t===d:c.uid===e.uid});if(r.forEach(a=>{const c=this.pendingRemoteTracks.indexOf(a);this.pendingRemoteTracks.splice(c,1)}),this.recvConnection||n||r.forEach(a=>{let{kind:c}=a;var d;if(c===Te.AUDIO)(d=e._audioTrack)===null||d===void 0||d._destroy(),e._audioTrack=void 0;else if(c===Te.VIDEO){var u;(u=e._videoTrack)===null||u===void 0||u._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(e,t);i.length!==0&&(await this.recvConnection.stopReceiving(i.map(a=>{let[,{id:c}]=a;return c})),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(a=>{let[c,{kind:d}]=a;var u,p;if(d===Te.VIDEO&&c._videoSSRC&&((u=this.recvConnection)===null||u===void 0||u.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),d===Te.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),n||((p=c._videoTrack)===null||p===void 0||p._destroy(),c._videoTrack=void 0);else if(d===Te.AUDIO){var f;this.unbindRemoteTrackEvents(c._audioTrack),!n&&((f=c._audioTrack)===null||f===void 0||f._destroy(),c._audioTrack=void 0)}}),i.forEach(a=>{let[,{kind:c}]=a;Ct(this,Oe.RequestP2PMuteRemote,c)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[Te.VIDEO,Te.AUDIO].forEach(r=>{n.has(r)?Ct(this,Oe.RequestP2PUnmuteRemote,r):Ct(this,Oe.RequestP2PMuteRemote,r)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new q(O.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new q(O.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new q(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new q(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Te.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||T.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(ne.LocalAudioTrack);if((t==null?void 0:t.track)instanceof gn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==ne.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===ne.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===ne.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}reportPublishEvent(e,t,n,r,i){if(e){const c=this.localTrackMap.get(ne.LocalAudioTrack),d=r?this.localTrackMap.get(ne.LocalVideoLowTrack):this.localTrackMap.get(ne.LocalVideoTrack);ye.publish(this.store.sessionId,{eventElapse:Qn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:d==null?void 0:d.track.getTrackLabel(),screenshare:(d==null?void 0:d.track._hints.indexOf(Ot.SCREEN_TRACK))!==-1,audio:!!c,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var a;n||(n=[]);const c=n.find(u=>u instanceof qt),d=r?(a=this.localTrackMap.get(ne.LocalVideoTrack))===null||a===void 0?void 0:a.track:n.find(u=>u instanceof wt);ye.publish(this.store.sessionId,{eventElapse:Qn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.getTrackLabel(),videoName:d==null?void 0:d.getTrackLabel(),screenshare:(d==null?void 0:d._hints.indexOf(Ot.SCREEN_TRACK))!==-1,audio:!!c,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===Te.VIDEO?n._videoSSRC:n._audioSSRC;i&&ye.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Te.VIDEO,audio:r===Te.AUDIO,peerid:n.uid,subscribeRequestid:r===Te.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Qn.measureFromSubscribeStart(this.store.clientId,i)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new On("P2PChannel2-send-mutex"),this.sendMutex=new On("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ne.LocalAudioTrack);if((e==null?void 0:e.track)instanceof gn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=ut.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ne.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ne.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof wt||t&&t.track instanceof qt?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(ni(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ne.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=ku(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(T.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=ut.Reconnecting,P("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case ne.LocalVideoTrack:le(t=r._hints).call(t,Ot.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case ne.LocalAudioTrack:r instanceof gn?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case ne.LocalVideoLowTrack:}}),this.emit(Oe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(ni(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(Oe.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),T.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof Na?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,r;if(e===mr.SEND_ONLY){if(!this.sendConnection)throw new q(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new q(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const i=await r.restartICE(t);return r.isInRestartIce=!1,i}{const i=await r.restartICE();if(i){const a=await un(this,Oe.RequestP2PRestartICE,{direction:mr.RECEIVE_ONLY,iceParameter:i});await r.restartICE(a),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(ne.LocalVideoTrack),n=this.localTrackMap.get(ne.LocalAudioTrack),r=e.videoSend.find(S=>{var I;return S.ssrc===(t==null||(I=t.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)}),i=e.audioSend.find(S=>{var I;return S.ssrc===(n==null||(I=n.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)});if(!r||!i)return 1;const a=Kr(this,Oe.NeedSignalRTT),c=r?r.rttMs:void 0,d=i?i.rttMs:void 0,u=c&&d?(c+d)/2:c||d,p=(u&&a?(u+a)/2:u||a)||0,f=100*e.sendPacketLossRate*.7/50+.3*p/1500,m=f<.17?1:f<.36?2:f<.59?3:f<.1?4:5,E=t==null?void 0:t.track;if(E&&E._encoderConfig&&E._hints.indexOf(Ot.SCREEN_TRACK)===-1){const S=E._encoderConfig.bitrateMax,I=e.bitrate.actualEncoded;if(S&&I){const v=(1e3*S-I)/(1e3*S);return R1[v<.15?0:v<.3?1:v<.45?2:v<.6?3:4][m]}}return m}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,a=r._videoSSRC,c=e.audioRecv.find(I=>I.ssrc===i),d=e.videoRecv.find(I=>I.ssrc===a);if(!c&&!d)return void(t+=1);const u=Kr(this,Oe.NeedSignalRTT),p=e.rtt,f=(p&&u?(p+u)/2:p||u)||0,m=c?c.jitterMs:void 0,E=e.recvPacketLossRate;let S=.7*E*100/50+.3*f/1500;m&&(S=.6*E*100/50+.2*f/1500+.2*m/400),t+=S<.1?1:S<.17?2:S<.36?3:S<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ae((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const r=[],i=Ze(),a=this.getAllTracks();e=Kd(e=e.filter(u=>a.indexOf(u)===-1));let c=!1,d=!1;for(const u of e){if(u instanceof wt&&(this.localTrackMap.has(ne.LocalVideoTrack)||c?new q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:u,type:ne.LocalVideoTrack}),c=!0),t)){const p=this.getLowVideoTrack(u,n);r.push({track:p,type:ne.LocalVideoLowTrack})}if(u instanceof qt){const p=this.localTrackMap.get(ne.LocalAudioTrack);if(p){if(!(p.track instanceof gn))throw new q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0)}else if(d){const f=r.find(m=>{let{type:E}=m;return E===ne.LocalAudioTrack});if(!(f.track instanceof gn))throw new q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(u)}else{if(!i.webAudioMediaStreamDest||u instanceof gn||u._bypassWebAudio)r.push({track:u,type:ne.LocalAudioTrack});else{const f=new gn;f.addAudioTrack(u),r.push({track:f,type:ne.LocalAudioTrack})}d=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Kd(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof qt){const i=this.localTrackMap.get(ne.LocalAudioTrack);if(!i)continue;i.track instanceof gn?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([ne.LocalAudioTrack,i]),i.track.close())):t.push([ne.LocalAudioTrack,i])}if(r instanceof wt){const i=this.localTrackMap.get(ne.LocalVideoTrack);if(!i)continue;t.push([ne.LocalVideoTrack,i]);const a=this.localTrackMap.get(ne.LocalVideoLowTrack);a&&t.push([ne.LocalVideoLowTrack,a])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case ne.LocalVideoTrack:n.addListener(fe.GET_STATS,this.handleGetLocalVideoStats),n.addListener(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(fe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(fe.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ne.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof gn?e.trackList.forEach(n=>{n.addListener(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(fe.GET_STATS,this.handleGetLocalAudioStats),n.addListener(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(fe.GET_STATS,this.handleGetLocalAudioStats),e.addListener(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case ne.LocalVideoTrack:n.off(fe.GET_STATS,this.handleGetLocalVideoStats),n.off(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(fe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(fe.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ne.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof gn?e.trackList.forEach(t=>{t.off(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(fe.GET_STATS,this.handleGetLocalAudioStats),t.off(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(fe.GET_STATS,this.handleGetLocalAudioStats),e.off(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof vl&&t.addListener(fe.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof yl&&t.addListener(fe.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(fe.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Te.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Te.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var i;let a,{track:c,type:d}=n;switch(d){case ne.LocalAudioTrack:a=lt.Audio;break;case ne.LocalVideoTrack:a=le(i=c._hints).call(i,Ot.SCREEN_TRACK)?lt.Screen:lt.High;break;case ne.LocalVideoLowTrack:a=lt.Low}return{kind:d===ne.LocalAudioTrack?Te.AUDIO:Te.VIDEO,stream_type:a,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:c.muted||!c.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[i,{track:a,ssrcs:c,id:d}]=t;switch(i){case ne.LocalVideoTrack:r=le(n=a._hints).call(n,Ot.SCREEN_TRACK)?lt.Screen:lt.High;break;case ne.LocalAudioTrack:r=lt.Audio;break;case ne.LocalVideoLowTrack:r=lt.Low}return{stream_type:r,ssrcs:c,mid:d}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:i,type:a}=n;this.localTrackMap.set(a,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Oe.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),le(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Rn(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),ye.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Kt.TRACER}).onSuccess(),this.emit(Oe.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(ni(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(El.FIRST_FRAME_DECODED),ye.firstRemoteFrame(this.store.sessionId,Nn.FIRST_AUDIO_DECODE,Bt.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Qn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(ni(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===t);r&&ye.firstRemoteFrame(this.store.sessionId,Nn.FIRST_AUDIO_RECEIVED,Bt.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Qn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;const r=Array.from(ni(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&ye.firstRemoteFrame(this.store.sessionId,Nn.FIRST_VIDEO_RECEIVED,Bt.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Qn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(Oe.ConnectionTypeChange,r),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ta(n))," -> ").concat(JSON.stringify(Ta(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ta(n))," -> ").concat(JSON.stringify(Ta(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Oe.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===mr.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,T.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===mr.SEND_ONLY?this.restartICE(e):un(this,Oe.RequestP2PRestartICE,{direction:mr.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ne.LocalAudioTrack);if(e instanceof qt&&(n==null?void 0:n.track)instanceof gn)return n.track.isActive||t.push([ne.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:a}]=i;return e===a});if(r&&(t.push(r),r[0]===ne.LocalVideoTrack)){const i=this.localTrackMap.get(ne.LocalVideoLowTrack);i&&t.push([ne.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ne.LocalAudioTrack);if(e instanceof qt&&(n==null?void 0:n.track)instanceof gn)return n.track.isActive&&t.push([ne.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:a}]=i;return e===a});if(r)if(r[0]===ne.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(ne.LocalVideoLowTrack);i&&t.push([ne.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[i,{track:a,ssrcs:c,id:d}]=t;switch(i){case ne.LocalAudioTrack:r=lt.Audio;break;case ne.LocalVideoTrack:r=le(n=a._hints).call(n,Ot.SCREEN_TRACK)?lt.Screen:lt.High;break;case ne.LocalVideoLowTrack:r=lt.Low}return{stream_type:r,ssrcs:c,mid:d}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[i,{track:a,ssrcs:c,id:d}]=t;switch(i){case ne.LocalAudioTrack:r=lt.Audio;break;case ne.LocalVideoTrack:r=le(n=a._hints).call(n,Ot.SCREEN_TRACK)?lt.Screen:lt.High;break;case ne.LocalVideoLowTrack:r=lt.Low}return{stream_type:r,ssrcs:c,mid:d}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[a,c]=i;n.push([e,{kind:a,id:c}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:i,id:a}]=n;switch(i){case Te.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Te.VIDEO,ssrcId:r._videoSSRC}));case Te.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Te.AUDIO,ssrcId:r._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ne.LocalVideoTrack),n=this.localTrackMap.get(ne.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof qt){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const r=this.createUnmuteMessage(n);return void await Ct(this,Oe.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Oe.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Oe.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Rn(sm(this.dtlsFailedCount,on)),this.emit(Oe.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(ne.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof wt)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof wt).length>1)throw new q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof qt).length>1&&(e.some(t=>t instanceof qt&&t._bypassWebAudio)||!Ze().webAudioMediaStreamDest))throw new q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof wt&&this.pendingLocalTracks.some(n=>n instanceof wt))throw new q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof qt&&this.pendingLocalTracks.some(n=>n instanceof qt)&&(!Ze().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof qt&&n._bypassWebAudio)))throw new q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!P("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ze().supportDualStreamEncoding,r=r_(r_({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():Py(e,r);const a=Rt(8,"track-low-"),c=new wt(i,r_(r_({},n&&{scaleResolutionDownBy:cv(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,a);return c.on(jc.TRANSCEIVER_UPDATED,d=>{e._updateRtpTransceiver(d,ml.LOW_STREAM)}),c._hints.push(Ot.LOW_STREAM),e.addListener(fe.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var i;const a=Array.from(ni(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===e);if(a){r||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,d=c.subscribe.find(u=>u.userId===a.uid&&u.type==="video");ye.firstRemoteVideoDecode(this.store.sessionId,Nn.FIRST_VIDEO_DECODE,Bt.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:t,videoheight:n,subscribeElapse:Qn.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(d==null?void 0:d.subscribeEnd)||0,subscriberStart:(d==null?void 0:d.subscribeStart)||0,videoAddNotify:(d==null?void 0:d.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const a=await this.recvConnection.getRemoteSSRC(i);return a!==void 0&&a!==n}resetConnection(e){T.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(e)),this.state===ut.Connected?(T.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}async publishDataChannel(e){throw new q(O.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new q(O.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new q(O.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new q(O.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new q(O.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new q(O.NOT_SUPPORTED)}async preConnect(e,t,n,r,i,a){throw new q(O.NOT_SUPPORTED)}getEstablishParams(){throw new q(O.NOT_SUPPORTED)}async reSubscribe(e){throw new q(O.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new q(O.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ne.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,ml.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},se(jt.prototype,"p2pConnect",[s2],Object.getOwnPropertyDescriptor(jt.prototype,"p2pConnect"),jt.prototype),se(jt.prototype,"unpublish",[a2],Object.getOwnPropertyDescriptor(jt.prototype,"unpublish"),jt.prototype),se(jt.prototype,"unpublishLowStream",[c2],Object.getOwnPropertyDescriptor(jt.prototype,"unpublishLowStream"),jt.prototype),se(jt.prototype,"subscribe",[d2],Object.getOwnPropertyDescriptor(jt.prototype,"subscribe"),jt.prototype),se(jt.prototype,"mockSubscribe",[l2],Object.getOwnPropertyDescriptor(jt.prototype,"mockSubscribe"),jt.prototype),se(jt.prototype,"unsubscribe",[u2],Object.getOwnPropertyDescriptor(jt.prototype,"unsubscribe"),jt.prototype),se(jt.prototype,"muteRemote",[h2],Object.getOwnPropertyDescriptor(jt.prototype,"muteRemote"),jt.prototype),se(jt.prototype,"unmuteRemote",[p2],Object.getOwnPropertyDescriptor(jt.prototype,"unmuteRemote"),jt.prototype),se(jt.prototype,"hasRemoteMediaWithLock",[f2],Object.getOwnPropertyDescriptor(jt.prototype,"hasRemoteMediaWithLock"),jt.prototype),se(jt.prototype,"disconnectForReconnect",[m2],Object.getOwnPropertyDescriptor(jt.prototype,"disconnectForReconnect"),jt.prototype),se(jt.prototype,"remoteMediaSsrcChanged",[_2],Object.getOwnPropertyDescriptor(jt.prototype,"remoteMediaSsrcChanged"),jt.prototype),jt);function ko(e){return function(t,n,r){const i=t[n];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];switch(e){case Lo.SEND_ONLY:{const u=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,c)}finally{u()}}case Lo.RECEIVE_ONLY:{const u=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,c)}finally{u()}}default:{const u=await this.sendMutex.lock("From P2PChannel2.".concat(n)),p=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,c)}finally{u(),p()}}}},r}}function g2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Yc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?g2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Mh{constructor(t){w(this,"store",void 0),w(this,"onStatsException",void 0),w(this,"onUploadPublishDuration",void 0),w(this,"onStatsChanged",void 0),w(this,"localStats",new Map),w(this,"remoteStats",new Map),w(this,"updateStatsInterval",void 0),w(this,"trafficStats",void 0),w(this,"trafficStatsPeerList",[]),w(this,"uplinkStats",void 0),w(this,"exceptionMonitor",void 0),w(this,"p2pChannel",void 0),w(this,"scalabilityMode",nY.L1T1),w(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new iX,this.exceptionMonitor.on("exception",(n,r,i)=>{this.onStatsException&&this.onStatsException(n,r,i)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ne.LocalAudioTrack)||Yc({},dy)}getLocalVideoTrackStats(){return this.localStats.get(ne.LocalVideoTrack)||Yc({},ly)}getRemoteAudioTrackStats(t){const n=(a,c)=>{if(!this.trafficStats)return c;const d=this.trafficStats.peer_delay.find(u=>u.peer_uid===a);return d&&(c.publishDuration=d.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},r={};if(t){var i;const a=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.audioStats;a&&(r[t]=n(t,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[c,{audioStats:d}]=a;d&&(r[c]=n(c,d))});return r}getRemoteNetworkQualityStats(t){const n={};if(t){var r;const i=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;i&&(n[t]=i)}else Array.from(this.remoteStats.entries()).forEach(i=>{let[a,{networkStats:c}]=i;c&&(n[a]=c)});return n}getRemoteVideoTrackStats(t){const n=(a,c)=>{if(!this.trafficStats)return c;const d=this.trafficStats.peer_delay.find(u=>u.peer_uid===a);return d&&(c.publishDuration=d.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},r={};if(t){var i;const a=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.videoStats;a&&(r[t]=n(t,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[c,{videoStats:d}]=a;d&&(r[c]=n(c,d))});return r}getRTCStats(){let t=0,n=0,r=0,i=0;const a=this.localStats.get(ne.LocalAudioTrack);a&&(t+=a.sendBytes,n+=a.sendBitrate);const c=this.localStats.get(ne.LocalVideoTrack);c&&(t+=c.sendBytes,n+=c.sendBitrate);const d=this.localStats.get(ne.LocalVideoLowTrack);d&&(t+=d.sendBytes,n+=d.sendBitrate),this.remoteStats.forEach(p=>{let{audioStats:f,videoStats:m}=p;f&&(r+=f.receiveBytes,i+=f.receiveBitrate),m&&(r+=m.receiveBytes,i+=m.receiveBitrate)});let u=1;return this.trafficStats&&(u+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:u,SendBitrate:n,SendBytes:t,RecvBytes:r,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var r;const i=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(n.peer_uid),a=i!=null&&i.videoSSRC?Qn.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,c=i!=null&&i.audioSSRC?Qn.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,a>c?a:c),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&T.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,r){if(!t)return!1;const i=!!r&&n.framesDecodeFreezeTime>r.framesDecodeFreezeTime,a=!r||n.framesDecodeCount>r.framesDecodeCount;return i||!a}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[r,i]=n;switch(r){case ne.LocalVideoTrack:case ne.LocalVideoLowTrack:{const c=i,d=Yc({},ly),u=t.getStats(),p=t.getLocalMedia(r);if(u){const f=u.videoSend.find(m=>m.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(f){const m=t.getLocalVideoSize(),E=t.getEncoderConfig(ne.LocalVideoTrack);f.codec!=="H264"&&f.codec!=="H265"&&f.codec!=="VP8"&&f.codec!=="VP9"&&f.codec!=="AV1X"&&f.codec!=="AV1"||(d.codecType=f.codec),d.sendBytes=f.bytes,d.sendBitrate=c?8*Math.max(0,d.sendBytes-c.sendBytes):0,f.inputFrame?(d.captureFrameRate=f.inputFrame.frameRate,d.captureResolutionHeight=f.inputFrame.height,d.captureResolutionWidth=f.inputFrame.width):m&&(d.captureResolutionWidth=m.width,d.captureResolutionHeight=m.height),f.sentFrame?(d.sendFrameRate=f.sentFrame.frameRate,d.sendResolutionHeight=f.sentFrame.height,d.sendResolutionWidth=f.sentFrame.width):m&&(d.sendResolutionWidth=m.width,d.sendResolutionHeight=m.height),f.avgEncodeMs&&(d.encodeDelay=f.avgEncodeMs),E&&E.bitrateMax&&(d.targetSendBitrate=1e3*E.bitrateMax),d.sendPackets=f.packets,d.sendPacketsLost=f.packetsLost,d.sendJitterMs=f.jitterMs,d.sendRttMs=f.rttMs,d.totalDuration=c?c.totalDuration+1:1,d.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(f)&&(d.totalFreezeTime+=1),f.scalabilityMode&&this.scalabilityMode!==f.scalabilityMode&&(T.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(f.scalabilityMode)),this.scalabilityMode=f.scalabilityMode)}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var a;this.localStats.set(r,d),((c==null?void 0:c.sendResolutionWidth)!==d.sendResolutionWidth||(c==null?void 0:c.sendResolutionHeight)!==d.sendResolutionHeight)&&((a=this.onStatsChanged)===null||a===void 0||a.call(this,"resolution",{width:d.sendResolutionWidth,height:d.sendResolutionHeight})),d&&p&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,p.track,d);break}case ne.LocalAudioTrack:{const c=i,d=Yc({},dy),u=t.getStats(),p=t.getLocalMedia(r);if(u){const f=u.audioSend.find(m=>m.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(f){if(f.codec!=="opus"&&f.codec!=="aac"&&f.codec!=="PCMU"&&f.codec!=="PCMA"&&f.codec!=="G722"||(d.codecType=f.codec),f.inputLevel)d.sendVolumeLevel=Math.round(32767*f.inputLevel);else{const m=t.getLocalAudioVolume();m&&(d.sendVolumeLevel=Math.round(32767*m))}d.sendBytes=f.bytes,d.sendPackets=f.packets,d.sendPacketsLost=f.packetsLost,d.sendJitterMs=f.jitterMs,d.sendRttMs=f.rttMs,d.sendBitrate=c?8*Math.max(0,d.sendBytes-c.sendBytes):0}}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ne.LocalAudioTrack,d),d&&p&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,p.track,d);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var r,i;let[a,{videoStats:c,audioStats:d,videoPcStats:u}]=n;const p=d,f=c,m=u,E=Yc({},DP),S=Yc({},PP),I=Yc({},zJ),{audioTrack:v,videoTrack:y,audioSSRC:A,videoSSRC:N}=t.getRemoteMedia(a);let V;V=t instanceof qr?t.getStats(!0):t.getStats();const F=(r=V)===null||r===void 0?void 0:r.audioRecv.find(Q=>Q.ssrc===A),G=(i=V)===null||i===void 0?void 0:i.videoRecv.find(Q=>Q.ssrc===N),z=this.trafficStats&&this.trafficStats.peer_delay.find(Q=>Q.peer_uid===a);if(F&&(F.codec!=="opus"&&F.codec!=="aac"&&F.codec!=="PCMU"&&F.codec!=="PCMA"&&F.codec!=="G722"||(E.codecType=F.codec),F.outputLevel?E.receiveLevel=Math.round(32767*F.outputLevel):v&&(E.receiveLevel=Math.round(32767*v.getVolumeLevel())),E.receiveBytes=F.bytes,E.receivePackets=F.packets,E.receivePacketsLost=F.packetsLost,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.receiveBitrate=p?8*Math.max(0,E.receiveBytes-p.receiveBytes):0,E.totalDuration=p?p.totalDuration+1:1,E.totalFreezeTime=p?p.totalFreezeTime:0,E.freezeRate=E.totalFreezeTime/E.totalDuration,E.receiveDelay=F.jitterBufferMs,E.totalDuration>10&&Mh.isRemoteAudioFreeze(v)&&(E.totalFreezeTime+=1)),G){G.codec!=="H264"&&G.codec!=="H265"&&G.codec!=="VP8"&&G.codec!=="VP9"&&G.codec!=="AV1X"&&G.codec!=="AV1"||(S.codecType=G.codec),S.receiveBytes=G.bytes,S.receiveBitrate=f?8*Math.max(0,S.receiveBytes-f.receiveBytes):0,S.decodeFrameRate=G.decodeFrameRate<0?0:G.decodeFrameRate,S.renderFrameRate=G.decodeFrameRate<0?0:G.decodeFrameRate,G.outputFrame&&(S.renderFrameRate=G.outputFrame.frameRate),G.receivedFrame?(S.receiveFrameRate=G.receivedFrame.frameRate,S.receiveResolutionHeight=G.receivedFrame.height,S.receiveResolutionWidth=G.receivedFrame.width):y&&(S.receiveResolutionHeight=y._videoHeight||0,S.receiveResolutionWidth=y._videoWidth||0),G.framesRateFirefox!==void 0&&(S.receiveFrameRate=Math.round(G.framesRateFirefox)),S.receivePackets=G.packets,S.receivePacketsLost=G.packetsLost,S.packetLossRate=S.receivePacketsLost/(S.receivePackets+S.receivePacketsLost),S.totalDuration=f?f.totalDuration+1:1,S.totalFreezeTime=f?f.totalFreezeTime:0,S.receiveDelay=G.jitterBufferMs||0;const Q=!!N&&t.getRemoteVideoIsReady(N);y&&Q&&Mh.isRemoteVideoFreeze(y,G,m)&&(S.totalFreezeTime+=1),S.freezeRate=S.totalFreezeTime/S.totalDuration}z&&(E.end2EndDelay=z.B_ad,S.end2EndDelay=z.B_vd,E.transportDelay=z.B_ed,S.transportDelay=z.B_ed,E.currentPacketLossRate=z.B_ealr4/100,S.currentPacketLossRate=z.B_evlr4/100,I.uplinkNetworkQuality=z.B_punq?z.B_punq:0,I.downlinkNetworkQuality=z.B_pdnq?z.B_pdnq:0),this.remoteStats.set(a,{audioStats:E,videoStats:S,videoPcStats:G,networkStats:I}),v&&this.exceptionMonitor.setRemoteAudioStats(v,E),y&&this.exceptionMonitor.setRemoteVideoStats(y,S)})}}function S2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function xh(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?S2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class CX extends xt{constructor(t,n,r,i){super(),w(this,"spec",void 0),w(this,"token",void 0),w(this,"websocket",void 0),w(this,"pingpongTimer",void 0),w(this,"reconnectMode","retry"),w(this,"serviceMode",void 0),w(this,"reqId",0),w(this,"commandReqId",0),w(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),w(this,"handleWebSocketMessage",a=>{if(!a.data)return;const c=JSON.parse(a.data);c.requestId?this.emit("@".concat(c.requestId,"-").concat(c.sid),c):this.serviceMode===Dn.INJECT?this.emit(ss.INJECT_STREAM_STATUS,c):(ye.workerEvent(this.spec.sid,{actionType:"status",serverCode:c.code,workerType:this.serviceMode===Dn.TRANSCODE?1:2}),this.emit(ss.PUBLISH_STREAM_STATUS,c))}),this.spec=n,this.token=t,this.serviceMode=i,this.websocket=new rh("live-streaming",r),this.websocket.on(Le.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Le.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Le.REQUEST_NEW_URLS,(a,c)=>{un(this,ss.REQUEST_NEW_ADDRESS).then(a).catch(c)}),this.websocket.on(Le.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,r,i){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const a=this.commandReqId,c=this.reqId;if(!c||!this.websocket)throw new B(O.UNEXPECTED_ERROR);const d=xh({command:t,sdkVersion:Ci==="4.21.0"?"0.0.1":Ci,seq:c,requestId:c,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new B(O.WS_DISCONNECT);const u=()=>new ae((E,S)=>{this.websocket.once(Le.CLOSED,()=>S(new B(O.WS_ABORT))),this.websocket.once(Le.CONNECTED,E)});this.websocket.state!=="connected"&&await u(),d.clientRequest&&(d.clientRequest.workerToken=this.token);const p=new ae((E,S)=>{const I=()=>{S(new B(O.WS_ABORT))};this.websocket.once(Le.RECONNECTING,I),this.websocket.once(Le.CLOSED,I),this.once("@".concat(c,"-").concat(this.spec.sid),v=>{E(v)})});i&&ye.workerEvent(this.spec.sid,xh(xh({},i),{},{requestId:a,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const f=Date.now();this.websocket.sendMessage(d);let m=null;try{m=await p}catch(E){if(this.websocket.state==="closed")throw E;return await u(),await this.request(t,n,r)}return i&&ye.workerEvent(this.spec.sid,xh(xh({},i),{},{requestId:a,actionType:"response",payload:JSON.stringify(m.serverResponse),serverCode:m.code,success:m.code===200,responseTime:Date.now()-f})),m.code!==200&&this.handleResponseError(m),m}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=Ci==="4.21.0"?"0.0.1":Ci;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case En.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void T.warning("live stream response already exists stream");case En.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case En.LIVE_STREAM_RESPONSE_BAD_STREAM:case En.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new B(O.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case En.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case En.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new B(O.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case En.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new B(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(ss.WARNING,n,t.serverResponse.url)}case En.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new B(O.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(ss.WARNING,n,t.serverResponse.url)}case En.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case En.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new B(O.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case En.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new B(O.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(ss.WARNING,n,t.serverResponse.url)}case En.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case En.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case En.LIVE_STREAM_RESPONSE_WORKER_LOST:case En.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case En.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case En.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new B(O.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(im)},6e3)}}function T2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function wr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?T2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class RX extends xt{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:on,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:on;super(),w(this,"onLiveStreamWarning",void 0),w(this,"onLiveStreamError",void 0),w(this,"onInjectStatusChange",void 0),w(this,"spec",void 0),w(this,"retryTimeout",1e4),w(this,"connection",void 0),w(this,"httpRetryConfig",void 0),w(this,"wsRetryConfig",void 0),w(this,"streamingTasks",new Map),w(this,"isStartingStreamingTask",!1),w(this,"taskMutex",new On("live-streaming")),w(this,"cancelToken",yr.CancelToken.source()),w(this,"transcodingConfig",void 0),w(this,"injectConfig",wr({},oY)),w(this,"injectLoopTimes",0),w(this,"uapResponse",void 0),w(this,"lastTaskId",1),w(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=wr(wr({},iY),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(T.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(c=>wr(wr(wr({},rY),c),{},{zOrder:c.zOrder?c.zOrder+1:1}))),function(c){Ht(c.width)||St(c.width,"config.width",0,1e4),Ht(c.height)||St(c.height,"config.height",0,1e4),Ht(c.videoBitrate)||St(c.videoBitrate,"config.videoBitrate",1,1e6),Ht(c.videoFrameRate)||St(c.videoFrameRate,"config.videoFrameRate"),Ht(c.lowLatency)||Os(c.lowLatency,"config.lowLatency"),Ht(c.audioSampleRate)||Sn(c.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Ht(c.audioBitrate)||St(c.audioBitrate,"config.audioBitrate",1,128),Ht(c.audioChannels)||Sn(c.audioChannels,"config.audioChannels",[1,2,3,4,5]),Ht(c.videoGop)||St(c.videoGop,"config.videoGop"),Ht(c.videoCodecProfile)||Sn(c.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Ht(c.userCount)||St(c.userCount,"config.userCount",0,17),Ht(c.backgroundColor)||St(c.backgroundColor,"config.backgroundColor",0,16777215),Ht(c.userConfigExtraInfo)||Mn(c.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),c.transcodingUsers&&!Ht(c.transcodingUsers)&&(Ns(c.transcodingUsers,"config.transcodingUsers"),c.transcodingUsers.forEach((d,u)=>{hm(d.uid),Ht(d.x)||St(d.x,"transcodingUser[".concat(u,"].x"),0,1e4),Ht(d.y)||St(d.y,"transcodingUser[".concat(u,"].y"),0,1e4),Ht(d.width)||St(d.width,"transcodingUser[".concat(u,"].width"),0,1e4),Ht(d.height)||St(d.height,"transcodingUser[".concat(u,"].height"),0,1e4),Ht(d.zOrder)||St(d.zOrder-1,"transcodingUser[".concat(u,"].zOrder"),0,100),Ht(d.alpha)||St(d.alpha,"transcodingUser[".concat(u,"].alpha"),0,1,!1)})),Ht(c.watermark)||iv(c.watermark,"watermark"),Ht(c.backgroundImage)||iv(c.backgroundImage,"backgroundImage"),c.images&&!Ht(c.images)&&(Ns(c.images,"config.images"),c.images.forEach((d,u)=>{iv(d,"images[".concat(u,"]"))}))}(n);const r=[];n.images&&r.push(...n.images.map(c=>wr(wr(wr({},rv),c),{},{zOrder:255}))),n.backgroundImage&&(r.push(wr(wr(wr({},rv),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(wr(wr(wr({},rv),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(c=>wr({},c)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const i=(n.userConfigs||[]).map(c=>typeof c.uid=="number"?ae.resolve(c.uid):iD(c.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await ae.all(i)).forEach((c,d)=>{n.userConfigs&&n.userConfigs[d]&&(n.userConfigs[d].uid=c)}),this.transcodingConfig=n,this.connection)try{var a;const c=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(wo(a=this.streamingTasks).call(a)).map(d=>d.taskId).join("#")});T.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(c.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(c){if(!c.data||!c.data.retry)throw c;c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(d=>{T.warning("[".concat(this.spec.clientId,"] live streaming receive error"),c.toString(),"try to republish",d.url),this.startLiveStreamingTask(d.url,d.mode,c).then(()=>{T.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(d.url," success"))}).catch(u=>{T.error("[".concat(this.spec.clientId,"] live streaming republish failed"),d.url,u.toString()),this.onLiveStreamError&&this.onLiveStreamError(d.url,u)})})}}setInjectStreamConfig(t,n){this.injectConfig=Object.assign({},this.injectConfig,t),this.injectLoopTimes=n}async startLiveStreamingTask(t,n,r){var i;if(Array.from(wo(i=this.streamingTasks).call(i)).find(p=>p.mode===Dn.INJECT)&&n===Dn.INJECT)return new B(O.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&n===Dn.TRANSCODE)throw new B(O.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let c={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};T.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const d=await this.taskMutex.lock();if(!this.connection&&r)return void d();if(this.streamingTasks.get(t)&&!r)return d(),new B(O.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(p){throw d(),p}switch(n){case Dn.TRANSCODE:c.transcodingConfig=wr({},this.transcodingConfig);break;case Dn.RAW:break;case Dn.INJECT:c={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:t,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const u=this.lastTaskId++;try{const p=new ae((m,E)=>{Rn(this.retryTimeout).then(()=>{if(r)return E(r);const S=this.statusError.get(t);return S?(this.statusError.delete(t),E(S)):void 0})}),f=await ae.race([this.connection.request("request",{clientRequest:c},!0,{url:t,command:"PublishStream",workerType:n===Dn.TRANSCODE?1:2,requestByUser:!r,tid:u.toString()}),p]);this.isStartingStreamingTask=!1,T.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(f.code)),this.streamingTasks.set(t,{clientRequest:c,mode:n,url:t,taskId:u}),d()}catch(p){if(d(),this.isStartingStreamingTask=!1,!p.data||!p.data.retry||r)throw p;return p.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,p)):await this.startLiveStreamingTask(t,n,p)}}stopLiveStreamingTask(t){return new ae((n,r)=>{const i=this.streamingTasks.get(t);if(!i||!this.connection)return new B(O.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const a=i.mode;i.abortTask=()=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:a===Dn.INJECT?"UninjectStream":"UnpublishStream",url:i.url}},!1,{url:t,command:"UnPublishStream",workerType:a===Dn.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(c=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(c.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&a!==Dn.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),n(),a===Dn.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(Jd.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,t)}).catch(r)})}async controlInjectStream(t,n,r,i){const a=this.streamingTasks.get(t);if(!a||!this.connection||a.mode!==Dn.INJECT)throw new B(O.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:n,audioVolume:r,position:i}})).serverResponse}resetAllTask(){var t;const n=Array.from(wo(t=this.streamingTasks).call(t));this.terminate();for(const r of n)this.startLiveStreamingTask(r.url,r.mode).catch(i=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,i)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=yr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new B(O.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await un(this,pm.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new CX(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(ss.WARNING,(r,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,r)),this.connection.on(ss.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(ss.INJECT_STREAM_STATUS,r=>this.handleInjectStreamServerStatus(r)),this.connection.on(ss.REQUEST_NEW_ADDRESS,(r,i)=>{if(!this.connection)return i(new B(O.UNEXPECTED_ERROR,"can not get new live streaming address list"));un(this,pm.REQUEST_WORKER_MANAGER_LIST,t).then(a=>{this.uapResponse=a,r(a.addressList)}).catch(i)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),i=t.reason;switch(t.code){case En.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const c=new B(O.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return T.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,c);if(!this.isStartingStreamingTask)return;this.statusError.set(n,c)}case En.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const c=new B(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,c)}case En.LIVE_STREAM_RESPONSE_WORKER_LOST:case En.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var a;if(!this.connection)return;this.connection.tryNextAddress();const c=Array.from(wo(a=this.streamingTasks).call(a));for(const d of c)d.abortTask?d.abortTask():(T.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",d.url),this.startLiveStreamingTask(d.url,d.mode,new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{T.debug("[".concat(this.spec.clientId,"] republish live stream success"),d.url)}).catch(u=>{T.error(u.toString()),this.onLiveStreamError&&this.onLiveStreamError(d.url,u)}));return}}}handleInjectStreamServerStatus(t){const n=Number(t.uid),r=t.serverStatus&&t.serverStatus.url;switch(t.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(Jd.INJECT_STREAM_STATUS_START_SUCCESS,n,r));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(Jd.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,n,r),void this.streamingTasks.delete(r);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(Jd.INJECT_STREAM_STATUS_START_UNAUTHORIZED,n,r),void this.streamingTasks.delete(r);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(Jd.INJECT_STREAM_STATUS_BROKEN,n,r),void this.streamingTasks.delete(r);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(Jd.INJECT_STREAM_STATUS_START_TIMEOUT,n,r),void this.streamingTasks.delete(r);default:return void T.debug("inject stream server status",t)}}hasUrl(t){return this.streamingTasks.has(t)}}class v2{constructor(){w(this,"destChannelMediaInfos",new Map),w(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){P1(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){P1(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){um(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function y2(e){if(!(e instanceof v2))return new B(O.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new B(O.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new B(O.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class wX extends xt{constructor(t,n,r){super(),w(this,"ws",void 0),w(this,"requestId",1),w(this,"heartBeatTimer",void 0),w(this,"joinInfo",void 0),w(this,"clientId",void 0),w(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),w(this,"onClose",i=>{this.emit("close"),this.dispose()}),w(this,"onMessage",i=>{const a=JSON.parse(i.data);if(!a||a.command!=="serverResponse"||!a.requestId)return a&&a.command==="serverStatus"&&a.serverStatus&&a.serverStatus.command?(this.emit("status",a.serverStatus),void this.emit(a.serverStatus.command,a.serverStatus)):void 0;this.emit("req_".concat(a.requestId),a)}),this.joinInfo=t,this.clientId=n,this.ws=new rh("cross-channel-".concat(this.clientId),r),this.ws.on(Le.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Le.CONNECTED,this.onOpen),this.ws.on(Le.ON_MESSAGE,this.onMessage),this.ws.on(Le.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new ae((n,r)=>{const i=window.setTimeout(()=>{r(new B(O.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,a=>{window.clearTimeout(i),a.state&&a.state!==0?r(new B(O.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),r(new B(O.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new B(O.WS_DISCONNECT);const n=()=>new ae((c,d)=>{this.ws.once(Le.CLOSED,()=>d(new B(O.WS_ABORT))),this.ws.once(Le.CONNECTED,c)});this.ws.state!=="connected"&&await n();const r=this.sendMessage(t),i=new ae((c,d)=>{const u=()=>{d(new B(O.WS_ABORT))};this.ws.once(Le.RECONNECTING,u),this.ws.once(Le.CLOSED,u),this.once("req_".concat(r),c),Rn(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(Le.RECONNECTING,u),this.ws.off(Le.CLOSED,u),d(new B(O.TIMEOUT,"cross channel ws request timeout"))})}),a=await i;if(!a||a.code!==200)throw new B(O.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(a)));return a}async connect(t){this.ws.removeAllListeners(Le.REQUEST_NEW_URLS),this.ws.on(Le.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class IX extends xt{set state(t){t!==this._state&&(t!==Nr.RELAY_STATE_FAILURE&&(this.errorCode=Xd.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,r,i,a){super(),w(this,"joinInfo",void 0),w(this,"sid",void 0),w(this,"clientId",void 0),w(this,"cancelToken",yr.CancelToken.source()),w(this,"workerToken",void 0),w(this,"requestId",0),w(this,"signal",void 0),w(this,"prevChannelMediaConfig",void 0),w(this,"httpRetryConfig",void 0),w(this,"_resolution",void 0),w(this,"_state",Nr.RELAY_STATE_IDLE),w(this,"errorCode",Xd.RELAY_OK),w(this,"onStatus",c=>{T.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(c))),c&&c.command&&(c.command==="onAudioPacketReceived"&&this.emit("event",Ds.PACKET_RECEIVED_AUDIO_FROM_SRC),c.command==="onVideoPacketReceived"&&this.emit("event",Ds.PACKET_RECEIVED_VIDEO_FROM_SRC),c.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Xd.SRC_TOKEN_EXPIRED,this.state=Nr.RELAY_STATE_FAILURE),c.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Xd.DEST_TOKEN_EXPIRED,this.state=Nr.RELAY_STATE_FAILURE))}),w(this,"onReconnect",async()=>{T.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Ds.NETWORK_DISCONNECTED),this.state=Nr.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(c=>{this.state!==Nr.RELAY_STATE_IDLE&&(T.error("auto restart channel media relay failed",c.toString()),this.errorCode=Xd.SERVER_CONNECTION_LOST,this.state=Nr.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=Zu(),this.signal=new wX(this.joinInfo,this.clientId,r),this.httpRetryConfig=i,this._resolution=a}async startChannelMediaRelay(t){if(this.state!==Nr.RELAY_STATE_IDLE)throw new B(O.INVALID_OPERATION);this.state=Nr.RELAY_STATE_CONNECTING,await this.connect(),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new B(O.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new B(O.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new B(O.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Nr.RELAY_STATE_RUNNING)throw new B(O.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Nr.RELAY_STATE_RUNNING)throw new B(O.INVALID_OPERATION);const n=this.genMessage(_r.SetVideoProfile);await this.signal.request(n),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),T.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Nr.RELAY_STATE_IDLE,this.dispose()}dispose(){T.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=yr.CancelToken.source(),this.state=Nr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await wY(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Ds.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(_r.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const r=this.genMessage(_r.SetSdkProfile,t);await this.signal.request(r),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i=this.genMessage(_r.SetSourceChannel,t);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Ds.PACKET_JOINED_SRC_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const a=this.genMessage(_r.SetSourceUserId,t);await this.signal.request(a),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const c=this.genMessage(_r.SetDestChannel,t);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Ds.PACKET_JOINED_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const d=this.genMessage(_r.StartPacketTransfer,t);await this.signal.request(d),this.emit("event",Ds.PACKET_SENT_TO_DEST_CHANNEL),this.state=Nr.RELAY_STATE_RUNNING,T.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(_r.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",Ds.PACKET_UPDATE_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(_r.StopPacketTransfer);await this.signal.request(t),T.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const r=[],i=[],a=[];this.requestId+=1;const c={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Ci,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};c.sdkVersion==="4.21.0"&&(c.sdkVersion="0.0.1");let d=null,u=null;switch(t){case _r.SetSdkProfile:return c.clientRequest={command:"SetSdkProfile",type:"multi_channel"},c;case _r.SetSourceChannel:if(u=n&&n.getSrcChannelMediaInfo(),!u)throw new B(O.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceChannel",uid:"0",channelName:u.channelName,token:u.token||this.joinInfo.appId},c;case _r.SetSourceUserId:if(u=n&&n.getSrcChannelMediaInfo(),!u)throw new B(O.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceUserId",uid:u.uid+""},c;case _r.SetDestChannel:if(d=n&&n.getDestChannelMediaInfo(),!d)throw new B(O.UNEXPECTED_ERROR,"can not find dest config");return d.forEach(p=>{r.push(p.channelName),i.push(p.uid+""),a.push(p.token||this.joinInfo.appId)}),c.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:a},c;case _r.StartPacketTransfer:return c.clientRequest={command:"StartPacketTransfer"},c;case _r.Reconnect:return c.clientRequest={command:"Reconnect"},c;case _r.StopPacketTransfer:return c.clientRequest={command:"StopPacketTransfer"},c;case _r.UpdateDestChannel:if(d=n&&n.getDestChannelMediaInfo(),!d)throw new B(O.UNEXPECTED_ERROR,"can not find dest config");return d.forEach(p=>{r.push(p.channelName),i.push(p.uid+""),a.push(p.token||this.joinInfo.appId)}),c.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:a},c;case _r.SetVideoProfile:c.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return c}}function i_(e){var t={},n=!1;function r(i,a){return n=!0,{done:!1,value:new vy(a=new yy(function(c){c(e[i](a))}),1)}}return t[Ud!==void 0&&HO||"@@iterator"]=function(){return this},t.next=function(i){return n?(n=!1,i):r("next",i)},typeof e.throw=="function"&&(t.throw=function(i){if(n)throw n=!1,i;return r("throw",i)}),typeof e.return=="function"&&(t.return=function(i){return n?(n=!1,i):r("return",i)}),t}var C2=_(Lk);function R2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function w2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?R2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var It;function I2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function A2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?I2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let wl=(It=class ep extends mm{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return le(n=Object.keys(Yd)).call(n,t)}))]}constructor(t,n){super(t,n),w(this,"store",void 0),w(this,"peerConnection",void 0),w(this,"remoteSDP",void 0),w(this,"initialOffer",void 0),w(this,"statsFilter",void 0),w(this,"useRTX",!1),w(this,"localCapabilities",void 0),w(this,"localCandidateCount",0),w(this,"allCandidatesReceived",!1),w(this,"establishPromise",void 0),w(this,"mutex",new On("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(ep.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=Zm(this.peerConnection,P("STATS_UPDATE_INTERVAL"),void 0,yt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Do(t.sdp),r=kh(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:P("FILTER_VIDEO_FEC"),filterAudioFec:P("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=t,A2(A2({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new q(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,n,r,i,a,c){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(u){w(this,"sessionDesc",void 0),w(this,"localCapabilities",void 0),w(this,"rtpCapabilities",void 0),w(this,"candidates",void 0),w(this,"iceParameters",void 0),w(this,"dtlsParameters",void 0),w(this,"setup",void 0),w(this,"currentMidIndex",void 0),w(this,"cname",void 0),u=bt(u);const{remoteIceParameters:p,remoteDtlsParameters:f,candidates:m,remoteRTPCapabilities:E,remoteSetup:S,localCapabilities:I,sdkCodec:v,cname:y}=u,A=Vt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=E,this.candidates=m,this.iceParameters=p,this.dtlsParameters=f,this.setup=S,this.localCapabilities=I,this.cname=y;for(let N=0;N<A.mediaDescriptions.length;N++){const V=A.mediaDescriptions[N];if(V.attributes.iceUfrag=p.iceUfrag,V.attributes.icePwd=p.icePwd,V.attributes.fingerprints=f.fingerprints,V.attributes.candidates=m,V.attributes.setup=S,V.media.mediaType==="video"){V.media.fmts=E.videoCodecs.map(G=>G.payloadType.toString(10));let F=E.videoCodecs.filter(G=>{var z,Q;return(z=G.rtpMap)===null||z===void 0?void 0:le(Q=z.encodingName.toLowerCase()).call(Q,v)});F.length===0&&(F=E.videoCodecs),V.attributes.payloads=F,V.attributes.extmaps=E.videoExtensions}V.media.mediaType==="audio"&&(V.media.fmts=E.audioCodecs.map(F=>F.payloadType.toString(10)),V.attributes.payloads=E.audioCodecs,V.attributes.extmaps=E.audioExtensions),A.mediaDescriptions[N]=this.mungMediaDesc(V)}this.sessionDesc=A,this.currentMidIndex=A.mediaDescriptions.length-1}toString(){return Vt.print(this.sessionDesc)}send(u,p,f){const{ssrcs:m,ssrcGroups:E}=pi(p,this.cname),S=this.sessionDesc.mediaDescriptions.find(y=>u===Te.VIDEO?y.media.mediaType==="video":y.media.mediaType==="audio"),I=m[0].attributes.label,v=m[0].attributes.mslabel;return S.attributes.ssrcs=S.attributes.ssrcs.concat(m),S.attributes.ssrcGroups=S.attributes.ssrcGroups.concat(E),{id:I,mslabel:v}}batchSend(u){return u.map(p=>{let{kind:f,ssrcMsg:m}=p;return this.send(f,m,void 0)})}stopSending(u){this.sessionDesc.mediaDescriptions.forEach(p=>{const f=[],m=[],E=[];p.attributes.ssrcs.forEach(S=>{le(u).call(u,S.attributes.label||"")?E.push(S):f.push(S)}),p.attributes.ssrcGroups.forEach(S=>{var I;le(I=E.map(v=>v.ssrcId)).call(I,S.ssrcIds[0])||m.push(S)}),p.attributes.ssrcs=f,p.attributes.ssrcGroups=m})}mute(u){const p=this.sessionDesc.mediaDescriptions.find(f=>f.attributes.mid===u);if(!p)throw new Error("mediaDescription not found with ".concat(u," in remote SDP when calling RemoteSDP.mute."));p.attributes.direction="inactive"}unmute(u){const p=this.sessionDesc.mediaDescriptions.find(f=>f.attributes.mid===u);if(!p)throw new Error("mediaDescription not found with ".concat(u," in remote SDP when calling RemoteSDP.unmute."));p.attributes.direction="sendonly"}receive(u,p,f){u.forEach((m,E)=>{const S=m._mediaStreamTrack,I=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===S.kind),v=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[I],m);this.sessionDesc.mediaDescriptions[I]=v})}stopReceiving(u){}updateCandidates(u){u===or.TCP?this.candidates.forEach(p=>{this.candidates.findIndex(f=>f.transport==="tcp"&&f.connectionAddress===p.connectionAddress&&f.port===p.port)===-1&&this.candidates.push(w2(w2({},p),{},{foundation:"tcpcandidate",priority:Number(p.priority)-1+"",transport:"tcp",port:Number(p.port)+90+""}))}):this.candidates=this.candidates.filter(p=>p.transport!=="tcp");for(const p of this.sessionDesc.mediaDescriptions)p.attributes.candidates=this.candidates}restartICE(u){u=bt(u),this.iceParameters=u,this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.iceUfrag=u.iceUfrag,p.attributes.icePwd=u.icePwd})}predictReceivingMids(u){const p=[];for(let f=0;f<u;f++)p.push((this.currentMidIndex+f+1).toString(10));return p}mungRecvMediaDsec(u,p){const f=bt(u);return Aa(f,p),e_(f,p),f}updateRecvMedia(u,p){const f=this.sessionDesc.mediaDescriptions.findIndex(m=>m.attributes.mid===u);if(f!==-1){const m=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[f],p);this.sessionDesc.mediaDescriptions[f]=m}}bumpMid(u){this.currentMidIndex+=u}updateTrackLabel(u,p,f){const m=this.sessionDesc.mediaDescriptions.find(S=>u===Te.VIDEO?S.attributes.mid==="video":S.attributes.mid==="audio");if(m){const S=m.attributes.ssrcs.find(I=>I.attributes.label===p);var E;S&&(S.attributes.label=f,(E=S.attributes.msid)===null||E===void 0||E.replace(p,f))}}mungMediaDesc(u){const p=bt(u);return $m(p),function(f){const m=f.attributes.extmaps.find(E=>E.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");m&&f.attributes.extmaps.splice(f.attributes.extmaps.indexOf(m),1),f.attributes.payloads.forEach(E=>{const S=E.rtcpFeedbacks.findIndex(I=>I.type==="transport-cc");S!==-1&&E.rtcpFeedbacks.splice(S,1)})}(p),p}getSSRC(u){for(const p of this.sessionDesc.mediaDescriptions)for(const f of p.attributes.ssrcs)if(f.attributes.label===u)return[f]}}({remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i.send,remoteSetup:a,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:c});const d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(d){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(d.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new q(O.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}send(t,n){var r=this;return Yr(function*(){const i=yield Be(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const a=t.map(E=>r.peerConnection.addTrack(E._mediaStreamTrack)),c=yield Be(r.peerConnection.createOffer()),d=Vt.parse(c.sdp),u=t.map(E=>{const S=E._mediaStreamTrack,I=d.mediaDescriptions.find(v=>v.attributes.mid===S.kind);if(!I)throw new Error("Cannot extract ssrc from mediaDescription.");return function(v,y,A){const N=v.attributes.ssrcs.filter(F=>F.attributes.label===y),V=v.attributes.ssrcGroups;if(N.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(V&&N.length>1){const F=V.find(G=>G.ssrcIds.indexOf(N[0].ssrcId)!==-1);return F?[{ssrcId:F.ssrcIds[0],rtx:A?F.ssrcIds[1]:void 0}]:[{ssrcId:N[0].ssrcId}]}return[{ssrcId:N[0].ssrcId}]}(I,S.id,r.useRTX)});let p;try{p=yield u}catch(E){throw a.forEach(S=>{Cn()&&S.replaceTrack(null),r.peerConnection.removeTrack(S)}),E}const f=r.mungSendOfferSDP(c.sdp,t);r.remoteSDP.receive(t,n,p);const m=r.remoteSDP.toString();return yield Be(r.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Be(r.applySendEncodings(a,t)),yield Be(r.peerConnection.setRemoteDescription({type:"answer",sdp:m})),t.map((E,S)=>{const I=E._mediaStreamTrack.id;return{localSSRC:u[S],id:I}})}catch(a){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{i()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(a=>{var c;return t.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(a=>{Cn()&&a.replaceTrack(null),this.peerConnection.removeTrack(a)});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:a,mslabel:c}=this.remoteSDP.send(t,n,i),d=new ae((f,m)=>{const E=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(a)))},1e4),S=I=>{const v=tt();if((v.name==="Safari"&&Number(v.version)===11||Jn())&&I.track.id!==a&&I.streams[0].id===c){var y;const A=I.streams[0].getTracks()[0];return(y=this.remoteSDP)===null||y===void 0||y.updateTrackLabel(t,a,I.track.id),this.peerConnection.removeEventListener("track",S),clearTimeout(E),void f(A)}if(I.track.id===a)return this.peerConnection.removeEventListener("track",S),clearTimeout(E),void f(I.track)};this.peerConnection.addEventListener("track",S)}),u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const p=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(p),{track:await d,id:a}}catch(a){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(n){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(r=>{var i;return t.indexOf(((i=r.track)===null||i===void 0?void 0:i.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(r=>{if(Cn()&&r.track)r.track.enabled=!1;else{const i=r.getParameters();i.encodings.forEach(a=>a.active=!1),r.setParameters(i)}})}catch(n){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(a=>{var c;return t.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async a=>{if(Cn()&&a.track)a.track.enabled=!0;else{const c=a.getParameters();c.encodings.forEach(d=>d.active=!0),await a.setParameters(c)}});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Yr(function*(){const r=yield Be(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ze().supportPCSetConfiguration){const u=n.peerConnection.getConfiguration(),p=t===or.RELAY?"relay":"all";u.iceTransportPolicy!==p&&(T.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(u.iceTransportPolicy,"] to [").concat(p,"]")),u.iceTransportPolicy=p,n.peerConnection.setConfiguration(u))}else if(t===or.RELAY)return;t!==or.RELAY&&n.remoteSDP.updateCandidates(t);const i=yield Be(n.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=Do(i.sdp),{remoteIceParameters:c}=yield a.iceParameters;n.remoteSDP.restartICE(c);const d=n.remoteSDP.toString();yield Be(n.peerConnection.setLocalDescription(i)),yield Be(n.peerConnection.setRemoteDescription({type:"answer",sdp:d}))}catch(i){T.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const a=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(r){throw new q(O.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getSenders().filter(i=>{var a;return((a=i.track)===null||a===void 0?void 0:a.id)===t});r.length===1&&await this.applySendEncodings(r,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getSenders().find(i=>{var a;return((a=i.track)===null||a===void 0?void 0:a.id)===n});r&&await r.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new q(O.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new q(O.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},P("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Hd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...ep.turnServerConfigToIceServers(t.turnServer.servers)),P("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...ep.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find(p=>{var f;return((f=p.track)===null||f===void 0?void 0:f.id)===t._mediaStreamTrack.id})),!n)return T.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Ze().supportSetRtpSenderParameters)return T.warn("Browser not support set rtp-sender parameters");const i={},a={};if(t instanceof wt)switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(P("DSCP_TYPE")&&ha()){var c;const p=P("DSCP_TYPE");le(c=["very-low","low","medium","high"]).call(c,p)&&(a.networkPriority=p)}const d=n.getParameters(),u=(r=d.encodings)===null||r===void 0?void 0:r[0];u&&Object.assign(u,a),Object.assign(d,i),T.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(d.encodings))),await n.setParameters(d)}async applySendEncodings(t,n){try{if(!Ze().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],a=n[r];i&&a&&await this.updateRtpSenderEncodings(a,i)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const r=Vt.parse(t);return n.forEach((i,a)=>{const c=i._mediaStreamTrack,d=r.mediaDescriptions.find(u=>u.attributes.mid===c.kind);d&&Aa(d,i)}),Vt.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((a,c)=>{let{id:d,mslabel:u}=a;const{kind:p}=t[c];return new ae((f,m)=>{const E=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(d)))},1e4),S=I=>{const v=tt();if(v.name==="Safari"&&Number(v.version)===11&&I.track.id!==d&&I.streams[0].id===u){var y;const A=I.streams[0].getTracks()[0];return(y=this.remoteSDP)===null||y===void 0||y.updateTrackLabel(p,d,I.track.id),this.peerConnection.removeEventListener("track",S),clearTimeout(E),void f({track:A,id:d})}if(I.track.id===d)return this.peerConnection.removeEventListener("track",S),clearTimeout(E),void f({track:I.track,id:d})};this.peerConnection.addEventListener("track",S)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await ae.all(n)}catch(n){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Ze().supportPCSetConfiguration){const n=ep.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},se(It.prototype,"connect",[Ni],Object.getOwnPropertyDescriptor(It.prototype,"connect"),It.prototype),se(It.prototype,"stopSending",[Ni],Object.getOwnPropertyDescriptor(It.prototype,"stopSending"),It.prototype),se(It.prototype,"receive",[Ni],Object.getOwnPropertyDescriptor(It.prototype,"receive"),It.prototype),se(It.prototype,"stopReceiving",[Ni],Object.getOwnPropertyDescriptor(It.prototype,"stopReceiving"),It.prototype),se(It.prototype,"muteRemote",[Ni],Object.getOwnPropertyDescriptor(It.prototype,"muteRemote"),It.prototype),se(It.prototype,"unmuteRemote",[Ni],Object.getOwnPropertyDescriptor(It.prototype,"unmuteRemote"),It.prototype),se(It.prototype,"muteLocal",[Ni],Object.getOwnPropertyDescriptor(It.prototype,"muteLocal"),It.prototype),se(It.prototype,"unmuteLocal",[Ni],Object.getOwnPropertyDescriptor(It.prototype,"unmuteLocal"),It.prototype),se(It.prototype,"close",[Ni],Object.getOwnPropertyDescriptor(It.prototype,"close"),It.prototype),se(It.prototype,"updateEncoderConfig",[Ni],Object.getOwnPropertyDescriptor(It.prototype,"updateEncoderConfig"),It.prototype),se(It.prototype,"updateSendParameters",[Ni],Object.getOwnPropertyDescriptor(It.prototype,"updateSendParameters"),It.prototype),se(It.prototype,"replaceTrack",[Ni],Object.getOwnPropertyDescriptor(It.prototype,"replaceTrack"),It.prototype),se(It.prototype,"getRemoteSSRC",[Ni],Object.getOwnPropertyDescriptor(It.prototype,"getRemoteSSRC"),It.prototype),It);function Ni(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,a=await i.lock("Locking from P2PConnection.".concat(t));try{for(var c=arguments.length,d=new Array(c),u=0;u<c;u++)d[u]=arguments[u];return await r.apply(this,d)}finally{a()}},n}function b2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Da(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?b2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const Uh="9",O2=4e4;function N2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Bs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?N2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let o_=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({});var Il=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Il||{});const s_=new Map;function D2(e,t,n,r){let{scale:i}=e;if(i===0&&r===Il.UP||i>=t.length-1&&r===Il.DOWN)return e;let a=Bs(Bs({},e),{},{scale:r===Il.DOWN?++i:--i});switch(n){case"maintain-framerate":a=Bs(Bs({},a),t[i].motion);break;case"maintain-resolution":a=Bs(Bs({},a),t[i].detail);break;case"balanced":a=Bs(Bs({},a),t[i].balanced)}return a}function P2(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:L2(t)};s_.set(e,n)}else s_.delete(e)}function L2(e){const t=Bs({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:a}=t,{MIN_FRAME_RATE:c,MAX_THRESHOLD_FRAMERATE:d,MAX_SCALE:u,BITRATE_MIN_THRESHOLD:p,BITRATE_MAX_THRESHOLD:f,BWE_SCALE_UP_THRESHOLD:m,BWE_SCALE_DOWN_THRESHOLD:E,PERF_SCALE_DOWN_THRESHOLD:S,PERF_SCALE_UP_THRESHOLD:I,BALANCE_BITRATE_FACTOR:v,BALANCE_FRAMERATE_FACTOR:y,BALANCE_RESOLUTION_FACTOR:A,MOTION_RESOLUTION_FACTOR:N,MOTION_BITRATE_FACTOR:V,DETAIL_FRAMERATE_FACTOR:F,DETAIL_BITRATE_FACTOR:G}=qT,z=Math.min(t.frameRate,d),Q=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(E,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(S,1)*z),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:a},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:a},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:a}}];for(let Z=1;Z<=u;Z++){const ee={bwe_up:Math.round(Math.pow(m,Z)*n),bwe_down:Math.round(Math.pow(E,Z+1)*n),fps_up:Math.round(Math.pow(I,Z)*z),fps_down:Math.round(Math.pow(S,Z+1)*z)},me={scaleResolutionDownBy:i/Math.pow(A,Z),frameRate:Math.max(Math.round(Math.pow(y,Z)*r),c),bitrateMax:Math.max(Math.round(Math.pow(v,Z)*n),f),bitrateMin:Math.max(Math.round(Math.pow(v,Z)*a),p)},Qe={scaleResolutionDownBy:i/Math.pow(N,Z),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(V,Z)*n),f),bitrateMin:Math.max(Math.round(Math.pow(V,Z)*a),p)},ct={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(F,Z)*r),c),bitrateMax:Math.max(Math.round(Math.pow(G,Z)*n),f),bitrateMin:Math.max(Math.round(Math.pow(G,Z)*a),p)};Q.push({scale:Z,threshold:ee,balanced:me,motion:Qe,detail:ct})}return Q}function AX(e,t,n,r,i,a){const c=s_.get(e)||{overUse:0,underUse:0,adaptationList:L2(i)},{adaptationList:d}=c;s_.set(e,c);const{OVERUSE_TIMES_THRESHOLD:u,UNDERUSE_TIMES_THRESHOLD:p}=qT,{scale:f}=r;let m,E;return typeof t=="number"&&t>0&&function(S,I,v,y){if(I>=v.length)return!1;let{threshold:{fps_down:A}}=v[I];return P("FORCE_AG_HIGH_FRAMERATE")&&y==="maintain-framerate"&&(A=v[0].threshold.fps_down),S<A}(t,f,d,a)&&(c.overUse++,E=o_.CPU,c.overUse>u)||typeof n=="number"&&n>0&&function(S,I,v){if(I>=v.length)return!1;const{threshold:{bwe_down:y}}=v[I];return S<y}(n,f,d)&&(c.overUse++,E=o_.BANDWIDTH,c.overUse>u)?(c.overUse=0,c.underUse=0,m=D2(r,d,a,Il.DOWN),[m,E]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(S,I,v,y){if(I===0)return;let{threshold:{fps_up:A}}=v[I];return P("FORCE_AG_HIGH_FRAMERATE")&&y==="maintain-framerate"&&(A=v[1].threshold.fps_up),S>A}(t,f,d,a)&&function(S,I,v){if(I===0)return;const{threshold:{bwe_up:y}}=v[I];return S>y}(n,f,d)&&(c.underUse++,c.underUse>p&&(c.overUse=0,c.underUse=0,m=D2(r,d,a,Il.UP),m.scale===0&&(E=o_.NONE))),[m,E])}function k2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function My(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?k2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function bX(e){var t;return!!P("ENABLE_AG_ADAPTATION")&&!!(e instanceof Sy||le(t=e._hints).call(t,Ot.CUSTOM_TRACK))&&(!!P("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const r=tt();if(r.os!==yn.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return Number(i[0])>=n}(14)&&HN(17,4)||WN(14)&&KN(17,4)))}const a_=new Map;function c_(e){const t=a_.get(e);if(t){const{timer:n,adaptationFunc:r,originConfig:i}=t;window.clearTimeout(n),r(i),a_.delete(e)}P2(e)}var rt;function M2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Pa(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?M2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Mo=(rt=class tp extends mm{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return le(n=Object.keys(Yd)).call(n,t)}))]}constructor(t,n){super(t,n),w(this,"store",void 0),w(this,"peerConnection",void 0),w(this,"id",Rt(5,"connection-")),w(this,"remoteSDP",void 0),w(this,"initialOffer",void 0),w(this,"transportEventReceiver",void 0),w(this,"statsFilter",void 0),w(this,"useXR",P("USE_XR")),w(this,"localCapabilities",void 0),w(this,"remoteCodecs",void 0),w(this,"localCandidateCount",0),w(this,"allCandidatesReceived",!1),w(this,"dataStreamChannelMap",new Map),w(this,"establishPromise",void 0),w(this,"recoveredDataChannelIds",[]),w(this,"currentDataChannelId",1),w(this,"mutex",new On("P2PConnection-mutex")),w(this,"qualityLimitationReason",o_.NONE),this.store=n,this.peerConnection=new RTCPeerConnection(tp.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=Zm(this.peerConnection,P("STATS_UPDATE_INTERVAL"),void 0,yt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void T.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const a=this.remoteSDP.toString();i==null||i(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}else T.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Do(t.sdp),r=await Ny({filterRTX:!P("USE_PUB_RTX")&&!P("USE_SUB_RTX"),filterVideoFec:P("FILTER_VIDEO_FEC"),filterAudioFec:P("FILTER_AUDIO_FEC"),filterVideoCodec:P("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=Rl(r),this.initialOffer=t,Pa(Pa({},n),{},{rtpCapabilities:r,offerSDP:t.sdp})}catch(t){throw new q(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,n,r,i,a,c){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{get localCapabilities(){return bt(this._localCapabilities)}get rtpCapabilities(){return bt(this._rtpCapabilities)}get candidates(){return bt(this._candidates)}get iceParameters(){return bt(this._iceParameters)}get dtlsParameters(){return bt(this._dtlsParameters)}constructor(S){w(this,"sessionDesc",void 0),w(this,"_localCapabilities",void 0),w(this,"_rtpCapabilities",void 0),w(this,"_candidates",void 0),w(this,"_iceParameters",void 0),w(this,"_dtlsParameters",void 0),w(this,"setup",void 0),w(this,"currentMidIndex",void 0),w(this,"cname",void 0),w(this,"firefoxSsrcMidMap",new Map),S=bt(S);const{remoteIceParameters:I,remoteDtlsParameters:v,candidates:y,remoteRTPCapabilities:A,remoteSetup:N,localCapabilities:V,cname:F}=S,G=Vt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=A,this._candidates=y,this._iceParameters=I,this._dtlsParameters=v,this._localCapabilities=V,this.setup=N,this.cname=F;const z=this.rtpCapabilities.send;for(const Q of G.mediaDescriptions){if(Q.attributes.iceUfrag=I.iceUfrag,Q.attributes.icePwd=I.icePwd,Q.attributes.fingerprints=v.fingerprints,Q.attributes.candidates=y,Q.attributes.setup=N,Q.media.mediaType==="video"&&(Q.media.fmts=z.videoCodecs.map(Z=>Z.payloadType.toString(10)),Q.attributes.payloads=z.videoCodecs,Q.attributes.extmaps=z.videoExtensions,P("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:Z,ssrcGroups:ee}=pi([{ssrcId:O2,rtx:P("USE_SUB_RTX")?40001:void 0}],this.cname);Q.attributes.ssrcs=Z,Q.attributes.ssrcGroups=ee}if(Q.media.mediaType==="audio"&&(Q.media.fmts=z.audioCodecs.map(Z=>Z.payloadType.toString(10)),Q.attributes.payloads=z.audioCodecs,Q.attributes.extmaps=z.audioExtensions,Po(Q),P("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:Z,ssrcGroups:ee}=pi([{ssrcId:2e4}],this.cname);Q.attributes.ssrcs=Z,Q.attributes.ssrcGroups=ee}}this.sessionDesc=G,this.currentMidIndex=G.mediaDescriptions.length-1}preloadRemoteMedia(){const S=P("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const I=this.candidates,v=this.dtlsParameters,y=this.iceParameters,A=this.rtpCapabilities.send;for(let N=1;N<S;N++){const V=2*N+2e4,F=2*N+O2,{ssrcs:G,ssrcGroups:z}=pi([{ssrcId:V}],this.cname),{ssrcs:Q,ssrcGroups:Z}=pi([{ssrcId:F,rtx:P("USE_SUB_RTX")?F+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Uh,protos:["UDP","TLS","RTP","SAVPF"],fmts:A.videoCodecs.map(ee=>ee.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:y.iceUfrag,icePwd:y.icePwd,unrecognized:[],candidates:I,extmaps:A.videoExtensions,fingerprints:v.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Q,ssrcGroups:Z,rtcpFeedbackWildcards:[],payloads:A.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*N)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Uh,protos:["UDP","TLS","RTP","SAVPF"],fmts:A.audioCodecs.map(ee=>ee.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:y.iceUfrag,icePwd:y.icePwd,unrecognized:[],candidates:I,extmaps:A.audioExtensions,fingerprints:v.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:G,ssrcGroups:z,rtcpFeedbackWildcards:[],payloads:A.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*N+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Vt.print(this.sessionDesc)}send(S,I,v,y){const{ssrcs:A,ssrcGroups:N}=pi(I,this.cname,P("SYNC_GROUP")?v:void 0),V=this.findPreloadMediaDesc(A);if(V){if(yt()&&this.firefoxSsrcMidMap.set(A[0].ssrcId,V.attributes.mid),y&&(y.twcc||y.remb)){const F=this.sessionDesc.mediaDescriptions.indexOf(V);return this.sessionDesc.mediaDescriptions[F]=this.mungSendMediaDesc(V,y),{mid:V.attributes.mid,needExchangeSDP:!0}}return{mid:V.attributes.mid,needExchangeSDP:!1}}{const F=this.findAvailableMediaIndex(S,A);let G;return F===-1||F===1&&(Cn()||YN())||F===0&&P("USE_SUB_RTX")||qN()?(G=this.createOrRecycleSendMedia(S,A,N,"sendonly",y),this.updateBundleMids()):(G=bt(this.sessionDesc.mediaDescriptions[F]),G.attributes.direction="sendonly",G.attributes.ssrcs=A,G.attributes.ssrcGroups=N,this.sessionDesc.mediaDescriptions[F]=this.mungSendMediaDesc(G,y)),yt()&&this.firefoxSsrcMidMap.set(A[0].ssrcId,G.attributes.mid),{mid:G.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:S,needExchangeSDP:I}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:S.attributes.mid,needExchangeSDP:I}}batchSend(S){const I=S.map(A=>{let{kind:N,ssrcMsg:V,mslabel:F}=A;return this.send(N,V,F)}),v=[];let y=!1;return I.forEach(A=>{let{mid:N,needExchangeSDP:V}=A;V&&(y=!0),v.push(N)}),{mids:v,needExchangeSDP:y}}stopSending(S){const I=this.sessionDesc.mediaDescriptions.filter(v=>v.attributes.mid&&S.indexOf(v.attributes.mid)!==-1);if(I.length!==S.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");I.forEach(v=>{v.attributes.mid==="0"||yt()||qN()?v.attributes.ssrcs=[]:(v.attributes.ssrcs=[],v.attributes.direction="inactive",v.media.port="0")}),this.updateBundleMids()}mute(S){const I=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===S);if(!I)throw new Error("mediaDescription not found with ".concat(S," in remote SDP when calling RemoteSDP.mute."));I.attributes.direction="inactive"}unmute(S){const I=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===S);if(!I)throw new Error("mediaDescription not found with ".concat(S," in remote SDP when calling RemoteSDP.unmute."));I.attributes.direction="sendonly"}muteRemote(S){const I=this.sessionDesc.mediaDescriptions.filter(v=>le(S).call(S,v.attributes.mid||""));if(I.length!==S.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");I.forEach(v=>{v.attributes.direction="inactive"})}unmuteRemote(S){const I=this.sessionDesc.mediaDescriptions.filter(v=>le(S).call(S,v.attributes.mid||""));if(I.length!==S.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");I.forEach(v=>{v.attributes.direction="recvonly"})}receive(S,I,v,y){S.forEach((A,N)=>{this.createOrRecycleRecvMedia(A,[],"recvonly",I,v,y[N])}),this.updateBundleMids()}stopReceiving(S){const I=this.sessionDesc.mediaDescriptions.filter(v=>S.indexOf(v.attributes.mid)!==-1);if(I.length!==S.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");I.forEach(v=>{v.media.port="0",v.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(S){const I=this._candidates.filter(v=>v.transport==="udp");if(S===or.TCP){if(I.length===0)return;if(P("TCP_CANDIDATE_ONLY")){const v=this._candidates.filter(y=>y.transport==="tcp");I.forEach(y=>{v.findIndex(A=>A.connectionAddress===y.connectionAddress)===-1&&v.push(Da(Da({},y),{},{foundation:"tcpcandidate",priority:Number(y.priority)-1+"",transport:"tcp",port:Number(y.port)+90+""}))}),this._candidates=v}else{const v=[];I.forEach(y=>{v.push(Da(Da({},y),{},{foundation:"tcpcandidate",priority:Number(y.priority)-1+"",transport:"tcp",port:Number(y.port)+90+""}))}),this._candidates=[...I,...v]}}else if(S===or.RELAY){if(I.length!==0)return;{const v=this._candidates.filter(y=>y.transport==="tcp");v.forEach(y=>{I.push(Da(Da({},y),{},{foundation:"udpcandidate",priority:Number(y.priority)+1+"",transport:"udp",port:Number(y.port)-90+""}))}),this._candidates=[...I,...v]}}else I.length===0?(this._candidates.filter(v=>v.transport==="tcp").forEach(v=>{I.push(Da(Da({},v),{},{foundation:"udpcandidate",priority:Number(v.priority)+1+"",transport:"udp",port:Number(v.port)-90+""}))}),this._candidates=I):this._candidates=this._candidates.filter(v=>v.transport!=="tcp");for(const v of this.sessionDesc.mediaDescriptions)v.attributes.candidates=this.candidates}restartICE(S){S=bt(S),this._iceParameters=S,this.sessionDesc.mediaDescriptions.forEach(I=>{I.attributes.iceUfrag=S.iceUfrag,I.attributes.icePwd=S.icePwd})}predictReceivingMids(S){const I=[];for(let v=0;v<S;v++)I.push((this.currentMidIndex+v+1).toString(10));return I}findAvailableMediaIndex(S,I){return this.sessionDesc.mediaDescriptions.findIndex(v=>{const y=v.media.mediaType===S&&v.media.port!=="0"&&(v.attributes.direction==="sendonly"||v.attributes.direction==="sendrecv")&&v.attributes.ssrcs.length===0;if(yt()){if(y){const A=this.firefoxSsrcMidMap.get(I[0].ssrcId);return!(A||v.attributes.mid!=="0"&&v.attributes.mid!=="1")||!(!A||A!==v.attributes.mid)}return!1}return y})}createOrRecycleDataChannel(){for(const v of this.sessionDesc.mediaDescriptions)if(v.media.mediaType==="application")return{mediaDesc:v,needExchangeSDP:!1};this.currentMidIndex+=1;const S="".concat(this.currentMidIndex),I={media:{mediaType:"application",port:Uh,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(S),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(I),{mediaDesc:I,needExchangeSDP:!0}}createOrRecycleRecvMedia(S,I,v,y,A,N){const V=S._mediaStreamTrack.kind,F=this.rtpCapabilities.recv,G=Wc(V,F,this.localCapabilities.send,V===Te.VIDEO?y:A),z=V===Te.VIDEO?F.videoExtensions:F.audioExtensions;this.currentMidIndex+=1;const Q="".concat(this.currentMidIndex);let Z={media:{mediaType:V,port:Uh,protos:["UDP","TLS","RTP","SAVPF"],fmts:G.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:z,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:I,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:G,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:v,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Q)}};Z=this.mungRecvMediaDsec(Z,S,N);const ee=this.findFirstClosedMedia(V);if(ee){const me=this.sessionDesc.mediaDescriptions.indexOf(ee);this.sessionDesc.mediaDescriptions[me]=Z}else this.sessionDesc.mediaDescriptions.push(Z);return Z}updateRemoteCodec(S,I,v){const y=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(Z=>Z.rtpMap&&Z.rtpMap.encodingName.toLowerCase()||"").filter(Z=>{var ee;return le(ee=Object.keys(Yd)).call(ee,Z)}))],A=new Set(I);if(y.every(Z=>A.has(Z)))return T.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(I)),!1;const N=this._rtpCapabilities.recv.videoCodecs.filter(Z=>I.some(ee=>{var me;return le(me=Z.rtpMap&&Z.rtpMap.encodingName.toLowerCase()||"").call(me,ee)}));if(N.length===0)return T.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(y," codecs: ").concat(I)),!1;const V=[...new Set(N.map(Z=>Z.rtpMap&&Z.rtpMap.encodingName.toLowerCase()||""))];let F;if(T.debug("updateRemoteCodec, from ".concat(y," to ").concat(V)),S.length===0)F=this.sessionDesc.mediaDescriptions.filter(Z=>Z.media.mediaType==="video"&&Z.attributes.direction==="recvonly");else if(F=this.sessionDesc.mediaDescriptions.filter(Z=>Z.attributes.mid&&le(S).call(S,Z.attributes.mid)&&Z.attributes.direction==="recvonly"),F.length!==S.length)return T.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(S,", codecs: ").concat(I)),!1;if(P("USE_PUB_RTX")||P("USE_SUB_RTX")){const Z=Dy(N,this.rtpCapabilities.recv.videoCodecs);N.push(...Z)}this._rtpCapabilities.recv.videoCodecs=N;const G=this.localCapabilities.send,z=this.rtpCapabilities.recv,Q=Wc(Te.VIDEO,z,G,v);return F.forEach(Z=>{const ee=Q.map(me=>me.payloadType.toString(10));T.debug("updateRemoteCodec mid: ".concat(Z.attributes.mid,", from ").concat(Z.attributes.payloads," to ").concat(Q)),Z.attributes.payloads=Q,Z.media.fmts=ee}),!0}createOrRecycleSendMedia(S,I,v,y,A){const N=this.rtpCapabilities.send,V=S===Te.VIDEO?N.videoCodecs:N.audioCodecs,F=S===Te.VIDEO?N.videoExtensions:N.audioExtensions;this.currentMidIndex+=1;const G="".concat(this.currentMidIndex);let z={media:{mediaType:S,port:Uh,protos:["UDP","TLS","RTP","SAVPF"],fmts:V.map(Z=>Z.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:F,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:I,ssrcGroups:v,rtcpFeedbackWildcards:[],payloads:V,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:y,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(G)}};z=this.mungSendMediaDesc(z,A);const Q=this.findFirstClosedMedia(S);if(Q){const Z=this.sessionDesc.mediaDescriptions.indexOf(Q);this.sessionDesc.mediaDescriptions[Z]=z}else this.sessionDesc.mediaDescriptions.push(z);return z}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(S=>S.media.port!=="0").map(S=>S.attributes.mid)}mungRecvMediaDsec(S,I,v){const y=bt(S);return $m(y),Aa(y,I),e_(y,I),by(y),Cl(y,v,this.localCapabilities.send),y}mungSendMediaDesc(S,I){const v=bt(S);return Cl(v,I,this.localCapabilities.recv),Po(v),v}updateRecvMedia(S,I){const v=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===S);if(v!==-1){const y=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[v],I);this.sessionDesc.mediaDescriptions[v]=y}}bumpMid(S){this.currentMidIndex+=S}findFirstClosedMedia(S){return this.sessionDesc.mediaDescriptions.find(I=>yt()?I.media.port==="0"&&I.media.mediaType===S:I.media.port==="0")}findPreloadMediaDesc(S){return this.sessionDesc.mediaDescriptions.find(I=>{var v;return((v=I.attributes)===null||v===void 0||(v=v.ssrcs[0])===null||v===void 0?void 0:v.ssrcId)===S[0].ssrcId})}getSSRC(S){var I;return(I=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===S))===null||I===void 0?void 0:I.attributes.ssrcs}}({remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:a,localCapabilities:this.localCapabilities,cname:c}),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const d=this.remoteSDP.toString(),u=Vt.parse(this.initialOffer.sdp),p=u.mediaDescriptions.find(S=>S.media.mediaType==="audio");p&&Po(p),this.useXR&&t_(u);const f=Vt.print(u),m=this.logSDPExchange(f||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:f}),m==null||m(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d});const E=this.peerConnection.getTransceivers()[0];if(E!=null&&E.receiver&&this.tryBindTransportEvents(E.receiver),P("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const S=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:S});const I=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(I)}}catch(d){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(d.toString()))}}send(t,n,r){var i=this;return Yr(function*(){const a=yield Be(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[];t.forEach(v=>{const y=i.peerConnection.addTransceiver(v._mediaStreamTrack,{direction:"sendonly"});c.push(y),v._updateRtpTransceiver(y)}),yt()&&P("SIMULCAST")===!0&&(yield Be(i.applySimulcastForFirefox(c,t)));const d=yield Be(i.peerConnection.createOffer()),u=i.remoteSDP.predictReceivingMids(t.length),p=i.mungSendOfferSDP(d.sdp,t,u),f=Vt.parse(p),m=u.map(v=>{const y=f.mediaDescriptions.find(A=>A.attributes.mid===v);if(!y)throw new Error("Cannot extract ssrc from mediaDescription.");return Ay(y,P("USE_PUB_RTX"))});let E;try{E=yield m}catch(v){E=[],i.remoteSDP.receive(t,n,r,E);const y=i.remoteSDP.toString();throw yield Be(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Be(i.peerConnection.setRemoteDescription({type:"answer",sdp:y})),yield Be(i.stopSending(u,!0)),v}i.remoteSDP.receive(t,n,r,E);const S=i.remoteSDP.toString(),I=i.logSDPExchange(p,"offer","local","send");return yield Be(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Be(i.applySimulcastEncodings(c,t)),yield Be(i.applySendEncodings(c,t)),I==null||I(S),yield Be(i.peerConnection.setRemoteDescription({type:"answer",sdp:S})),c.map((v,y)=>{const A=u[y];return{localSSRC:m[y],id:A,transceiver:v}})}catch(c){throw c instanceof q?c:new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")T.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const a=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof a!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:a,negotiated:!0,ordered:!1,maxRetransmits:P("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}n.forEach(a=>{a._updateOriginDataChannel(r)});const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),T.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else T.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof q?r:new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof q?n:new q(O.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(u=>t.indexOf(u.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(u=>{var p;c_(this.id+u.mid),u.direction="inactive",(p=u.stop)===null||p===void 0||p.call(u)});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(t,n,r,i);if(c){const u=this.remoteSDP.toString(),p=this.logSDPExchange(u,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const f=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(f.sdp,a,t);p==null||p(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const d=this.peerConnection.getTransceivers().find(u=>u.mid===a);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:a,transceiver:d}}catch(a){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);if(r){const i=this.remoteSDP.toString(),a=this.logSDPExchange(i,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c),T.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return n.map(i=>{const a=this.peerConnection.getTransceivers().find(c=>c.mid===i);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:i,transceiver:a}})}catch(n){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const a=this.remoteSDP.toString();i==null||i(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,d)=>{c.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const a=this.remoteSDP.toString();i==null||i(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new q(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Yr(function*(){const r=yield Be(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ze().supportPCSetConfiguration){const p=n.peerConnection.getConfiguration(),f=t===or.RELAY?"relay":"all";p.iceTransportPolicy!==f&&(T.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(p.iceTransportPolicy,"] to [").concat(f,"]")),p.iceTransportPolicy=f,n.peerConnection.setConfiguration(p))}else if(t===or.RELAY)return;n.remoteSDP.updateCandidates(t);const i=yield Be(n.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=Do(i.sdp),{remoteIceParameters:c}=yield a.iceParameters;n.remoteSDP.restartICE(c);const d=n.remoteSDP.toString(),u=n.logSDPExchange(i.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Be(n.peerConnection.setLocalDescription(i)),u==null||u(d),yield Be(n.peerConnection.setRemoteDescription({type:"answer",sdp:d}))}catch(i){T.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{c_(this.id+n.mid)}),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Pa(Pa({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const a=this.remoteSDP.toString(),c=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),c==null||c(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(r){throw new q(O.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?yt()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:Pa(Pa({},_s),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Pa(Pa({},_s),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},P("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Hd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...tp.turnServerConfigToIceServers(t.turnServer.servers)),P("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...tp.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),P("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),P("ENABLE_ENCODED_TRANSFORM")&&Ze().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Sa(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!P("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var i;n!=null&&n.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,n.state))},n.onerror=i=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in i?i.error:i)};const r=n.iceTransport;r&&(r.onstatechange=()=>{const i=n==null?void 0:n.iceTransport.state;var a;i&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:i,remote:a}=r.getSelectedCandidatePair();T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r,i;if(n||(n=this.peerConnection.getSenders().find(y=>y.track===t._mediaStreamTrack)),!n)return T.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ze().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const a={},c={};switch(t._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;case"balanced":a.degradationPreference="balanced"}const d=function(v,y){return v.getTransceivers().find(A=>A.sender.track===y||A.receiver.track===y)}(this.peerConnection,t._mediaStreamTrack),u=QJ(t);if(bX(t)&&d&&n&&u&&this.getLocalVideoStats&&le(r=["vp8","vp9"]).call(r,this.store.codec)){var p;const v=a.degradationPreference||(le(p=t._hints).call(p,Ot.CUSTOM_TRACK)?P("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(y,A,N,V,F,G){if(c_(y),V!=="balanced"&&V!=="maintain-framerate"&&V!=="maintain-resolution")return;let z=-1;P2(y,A);const Q=window.setInterval(()=>{const ee=a_.get(y);if(!P("ENABLE_AG_ADAPTATION")||!ee)return void c_(y);const me=G();if(me.sendPackets>0&&me.OutgoingAvailableBandwidth>0){if(z===-1)return void(z=Date.now());if(Date.now()-z<1e3)return;const Qe=me.sendFrameRate,ct=me.OutgoingAvailableBandwidth,[Nt,cn]=AX(y,Qe,ct,ee.adaptationConfig,A,V);cn&&(N.qualityLimitationReason=cn),Nt&&ee.adaptationConfig.scale!==Nt.scale&&(T.debug("[".concat(y,"] applyAdaptation: ").concat(N.qualityLimitationReason,`
           sendFps `).concat(Qe,", bwe ").concat(ct,", switch from ").concat(ee.adaptationConfig.scale," to ").concat(Nt.scale," ")),ee.adaptationConfig=My(My({},ee.adaptationConfig),Nt),F(Nt))}},P("CHECK_LOCAL_STATS_INTERVAL")),Z=My({},A);a_.set(y,{timer:Q,adaptationConfig:Z,originConfig:A,adaptationFunc:F}),T.debug("[".concat(y,"] start adaptation, originConfig: ").concat(JSON.stringify(A),", degradationPreference: ").concat(V))})(this.id+d.mid,u,this,v,y=>{n&&this.updateAdaptation(n,y)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var f;const{bitrateMax:v,frameRate:y,scaleResolutionDownBy:A}=t._encoderConfig;v&&(c.maxBitrate=1e3*v),(le(f=t._hints).call(f,Ot.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(y&&(c.maxFramerate=Dr(y)),A&&A>=1&&(c.scaleResolutionDownBy=A))}const{maxFramerate:m}=P("ENCODER_CONFIG_LIMIT");if(m&&typeof m=="number"&&(c.maxFramerate=c.maxFramerate?Math.min(c.maxFramerate,m):m),P("DSCP_TYPE")&&ha()){var E;const v=P("DSCP_TYPE");le(E=["very-low","low","medium","high"]).call(E,v)&&(c.networkPriority=v)}const S=n.getParameters(),I=(i=S.encodings)===null||i===void 0?void 0:i[0];yt()&&!I&&(a.encodings=[c]),I&&Object.assign(I,c),Object.assign(S,a),T.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(S.encodings))),await n.setParameters(S)}async updateAdaptation(t,n){var r,i;if(!t)return T.debug("[updateAdaptation] no rtpSender found");if(!Ze().supportSetRtpSenderParameters)return T.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const a={},{bitrateMax:c,frameRate:d,scaleResolutionDownBy:u}=n;c&&(a.maxBitrate=1e3*c),d&&(a.maxFramerate=Dr(d)),u&&u>=1&&le(r=["vp8","vp9"]).call(r,this.store.codec)&&(a.scaleResolutionDownBy=u);const p=t.getParameters(),f=(i=p.encodings)===null||i===void 0?void 0:i[0];f&&Object.assign(f,a),Object.assign(p,{});try{await t.setParameters(p),T.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(p.encodings)))}catch(m){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?T.debug("[updateAdaptation] peerConnection not connected}"):T.debug("[updateAdaptation] updateRtpSenderEncodings failed",m):T.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!Ze().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],a=n[r];a instanceof wt&&!this.isVP8Simulcast(a)&&await this.updateRtpSenderEncodings(a,i.sender)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const i=Vt.parse(t);return n.forEach((a,c)=>{const d=r[c],u=i.mediaDescriptions.find(p=>p.attributes.mid===d);u&&(Aa(u,a),Oy(u,a,this.store.codec))}),Vt.print(i)}mungReceiveAnswerSDP(t,n,r){const i=Vt.parse(t),a=i.mediaDescriptions.find(c=>c.attributes.mid===n);return a&&(r===Te.AUDIO&&a.media.mediaType==="audio"&&Po(a),this.useXR&&t_(i)),Vt.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let u=0;u<t.length;u++){var r,i,a,c,d;const p=t[u],f=n[u];if(f instanceof wt&&!le(r=f._hints).call(r,Ot.LOW_STREAM)&&(i=f._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((a=f._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(c=f._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((d=f._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1&&this.store.codec==="vp8"){const m={},E={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const S=p.sender.getParameters();await p.sender.setParameters(Object.assign(S,m))}}}async applySimulcastEncodings(t,n){if(!yt()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof wt&&this.isVP8Simulcast(i)){const a=t[r],c={},d={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:d.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:d.medium,scaleResolutionDownBy:4}];const u=a.sender.getParameters();await a.sender.setParameters(Object.assign(u,c))}}}isVP8Simulcast(t){var n,r,i,a,c;return!!(t instanceof wt&&P("SIMULCAST")&&this.store.codec==="vp8"&&!le(n=t._hints).call(n,Ot.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(a=t._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=t._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(P("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",r==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Ze().supportPCSetConfiguration){const n=tp.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},se(rt.prototype,"updateRemoteRTPCapabilities",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"updateRemoteRTPCapabilities"),rt.prototype),se(rt.prototype,"connect",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"connect"),rt.prototype),se(rt.prototype,"createDataChannels",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"createDataChannels"),rt.prototype),se(rt.prototype,"receive",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"receive"),rt.prototype),se(rt.prototype,"batchReceive",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"batchReceive"),rt.prototype),se(rt.prototype,"stopReceiving",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"stopReceiving"),rt.prototype),se(rt.prototype,"muteRemote",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"muteRemote"),rt.prototype),se(rt.prototype,"unmuteRemote",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"unmuteRemote"),rt.prototype),se(rt.prototype,"muteLocal",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"muteLocal"),rt.prototype),se(rt.prototype,"unmuteLocal",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"unmuteLocal"),rt.prototype),se(rt.prototype,"close",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"close"),rt.prototype),se(rt.prototype,"updateEncoderConfig",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"updateEncoderConfig"),rt.prototype),se(rt.prototype,"updateSendParameters",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"updateSendParameters"),rt.prototype),se(rt.prototype,"replaceTrack",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"replaceTrack"),rt.prototype),se(rt.prototype,"updateAdaptation",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"updateAdaptation"),rt.prototype),se(rt.prototype,"getRemoteSSRC",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"getRemoteSSRC"),rt.prototype),rt);function Pr(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,a=await i.lock("From P2PConnection.".concat(t));try{for(var c=arguments.length,d=new Array(c),u=0;u<c;u++)d[u]=arguments[u];return await r.apply(this,d)}finally{a()}},n}function x2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function U2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?x2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const V2=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,d_="9",xy=2e4,Uy=4e4;class OX{get localCapabilities(){return bt(this._localCapabilities)}get rtpCapabilities(){return bt(this._rtpCapabilities)}get candidates(){return bt(this._candidates)}get iceParameters(){return bt(this._iceParameters)}get dtlsParameters(){return bt(this._dtlsParameters)}constructor(t){w(this,"sessionDesc",void 0),w(this,"_localCapabilities",void 0),w(this,"_rtpCapabilities",void 0),w(this,"_candidates",void 0),w(this,"_iceParameters",void 0),w(this,"_dtlsParameters",void 0),w(this,"setup",void 0),w(this,"currentMidIndex",void 0),w(this,"cname",void 0),w(this,"firefoxSsrcMidMap",new Map),t=bt(t);const{remoteIceParameters:n,remoteDtlsParameters:r,candidates:i,remoteRTPCapabilities:a,remoteSetup:c,localCapabilities:d,cname:u}=t,p=Vt.parse(V2);this._rtpCapabilities=a,this._candidates=i,this._iceParameters=n,this._dtlsParameters=r,this._localCapabilities=d,this.setup=c,this.cname=u;const f=this.rtpCapabilities.send;for(const m of p.mediaDescriptions){if(m.attributes.iceUfrag=n.iceUfrag,m.attributes.icePwd=n.icePwd,m.attributes.fingerprints=r.fingerprints,m.attributes.candidates=i,m.attributes.setup=c,m.media.mediaType==="application"&&(m.attributes.sctpPort="5000"),m.media.mediaType==="video"&&(m.media.fmts=f.videoCodecs.map(E=>E.payloadType.toString(10)),m.attributes.payloads=f.videoCodecs,m.attributes.extmaps=f.videoExtensions,P("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:E,ssrcGroups:S}=pi([{ssrcId:Uy,rtx:P("USE_SUB_RTX")?40001:void 0}],this.cname);m.attributes.ssrcs=E,m.attributes.ssrcGroups=S}if(m.media.mediaType==="audio"&&(m.media.fmts=f.audioCodecs.map(E=>E.payloadType.toString(10)),m.attributes.payloads=f.audioCodecs,m.attributes.extmaps=f.audioExtensions,Po(m),P("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:E,ssrcGroups:S}=pi([{ssrcId:xy}],this.cname);m.attributes.ssrcs=E,m.attributes.ssrcGroups=S}}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}updateRemoteRTPCapabilities(t){const n=Vt.parse(V2);this._rtpCapabilities=t;const r=this.rtpCapabilities.send;for(const i of n.mediaDescriptions){if(i.attributes.iceUfrag=this._iceParameters.iceUfrag,i.attributes.icePwd=this._iceParameters.icePwd,i.attributes.fingerprints=this._dtlsParameters.fingerprints,i.attributes.candidates=this._candidates,i.attributes.setup=this.setup,i.media.mediaType==="application"&&(i.attributes.sctpPort="5000"),i.media.mediaType==="video"&&(i.media.fmts=r.videoCodecs.map(a=>a.payloadType.toString(10)),i.attributes.payloads=r.videoCodecs,i.attributes.extmaps=r.videoExtensions,P("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:a,ssrcGroups:c}=pi([{ssrcId:Uy,rtx:P("USE_SUB_RTX")?40001:void 0}],this.cname);i.attributes.ssrcs=a,i.attributes.ssrcGroups=c}if(i.media.mediaType==="audio"&&(i.media.fmts=r.audioCodecs.map(a=>a.payloadType.toString(10)),i.attributes.payloads=r.audioCodecs,i.attributes.extmaps=r.audioExtensions,P("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:a,ssrcGroups:c}=pi([{ssrcId:xy}],this.cname);i.attributes.ssrcs=a,i.attributes.ssrcGroups=c}}this.sessionDesc=n,this.currentMidIndex=n.mediaDescriptions.length-1}preloadRemoteMedia(t){this.rtpCapabilities;const n=this.candidates,r=this.dtlsParameters,i=this.iceParameters,a=this.rtpCapabilities.send;for(let c=1;c<t;c++){const d=2*c+xy,u=2*c+Uy,{ssrcs:p,ssrcGroups:f}=pi([{ssrcId:d}],this.cname),{ssrcs:m,ssrcGroups:E}=pi([{ssrcId:u,rtx:P("USE_SUB_RTX")?u+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:d_,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.videoCodecs.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:n,extmaps:a.videoExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:m,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:a.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*c-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:d_,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.audioCodecs.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:n,extmaps:a.audioExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:f,rtcpFeedbackWildcards:[],payloads:a.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*c)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Vt.print(this.sessionDesc)}send(t,n,r,i){const{ssrcs:a,ssrcGroups:c}=pi(n,this.cname,P("SYNC_GROUP")?r:void 0),d=this.findPreloadMediaDesc(a);if(d){if(yt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,d.attributes.mid),i&&(i.twcc||i.remb)){const u=this.sessionDesc.mediaDescriptions.indexOf(d);return this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(d,i),{mid:d.attributes.mid,needExchangeSDP:!0}}return{mid:d.attributes.mid,needExchangeSDP:!1}}{const u=this.findAvailableMediaIndex(t,a);let p;return u===-1||Cn()||Jn()||YN()||u===0&&P("USE_SUB_RTX")?(p=this.createOrRecycleSendMedia(t,a,c,"sendonly",i),this.updateBundleMids()):(p=bt(this.sessionDesc.mediaDescriptions[u]),p.attributes.direction="sendonly",p.attributes.ssrcs=a,p.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(p,i)),yt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,p.attributes.mid),{mid:p.attributes.mid,needExchangeSDP:!0}}}batchSend(t){const n=t.map(a=>{let{kind:c,ssrcMsg:d,mslabel:u}=a;return this.send(c,d,u)}),r=[];let i=!1;return n.forEach(a=>{let{mid:c,needExchangeSDP:d}=a;d&&(i=!0),r.push(c)}),{mids:r,needExchangeSDP:i}}stopSending(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&t.indexOf(r.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(r=>{r.attributes.mid==="0"||yt()||Cn()||Jn()?r.attributes.ssrcs=[]:(r.attributes.ssrcs=[],r.attributes.direction="inactive",r.media.port="0")}),this.updateBundleMids()}mute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}muteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>le(t).call(t,r.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>le(t).call(t,r.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(r=>{r.attributes.direction="recvonly"})}receive(t,n,r,i){t.forEach((a,c)=>{this.createOrRecycleRecvMedia(a,[],"recvonly",n,r,i[c])}),this.updateBundleMids()}stopReceiving(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>t.indexOf(r.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(t){t===or.TCP?this._candidates.forEach(n=>{this._candidates.findIndex(r=>r.transport==="tcp"&&r.connectionAddress===n.connectionAddress&&r.port===n.port)===-1&&this._candidates.push(U2(U2({},n),{},{foundation:"tcpcandidate",priority:Number(n.priority)-1+"",transport:"tcp",port:Number(n.port)+90+""}))}):this._candidates=this._candidates.filter(n=>n.transport!=="tcp");for(const n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(t){t=bt(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let r=0;r<t;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}findAvailableMediaIndex(t,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(yt()){if(i){const a=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(a||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!a||a!==r.attributes.mid)}return!1}return i})}createOrRecycleRecvMedia(t,n,r,i,a,c){const d=t._mediaStreamTrack.kind,u=this.rtpCapabilities.recv,p=Wc(d,u,this.localCapabilities.send,d===Te.VIDEO?i:a),f=d===Te.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;const m="".concat(this.currentMidIndex);let E={media:{mediaType:d,port:d_,protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(I=>I.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:f,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};E=this.mungRecvMediaDsec(E,t,c);const S=this.findFirstClosedMedia(d);if(S){const I=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[I]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}updateRemoteCodec(t,n,r){const i=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(E=>E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"").filter(E=>{var S;return le(S=Object.keys(Yd)).call(S,E)}))],a=new Set(n);if(i.every(E=>a.has(E)))return T.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(n)),!1;const c=this._rtpCapabilities.recv.videoCodecs.filter(E=>n.some(S=>{var I;return le(I=E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"").call(I,S)}));if(c.length===0)return T.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(i," codecs: ").concat(n)),!1;const d=[...new Set(c.map(E=>E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||""))];let u;if(T.debug("updateRemoteCodec, from ".concat(i," to ").concat(d)),t.length===0)u=this.sessionDesc.mediaDescriptions.filter(E=>E.media.mediaType==="video"&&E.attributes.direction==="recvonly");else if(u=this.sessionDesc.mediaDescriptions.filter(E=>E.attributes.mid&&le(t).call(t,E.attributes.mid)&&E.attributes.direction==="recvonly"),u.length!==t.length)return T.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(t,", codecs: ").concat(n)),!1;this._rtpCapabilities.recv.videoCodecs=c;const p=this.localCapabilities.send,f=this.rtpCapabilities.recv,m=Wc(Te.VIDEO,f,p,r);return u.forEach(E=>{const S=m.map(I=>I.payloadType.toString(10));T.debug("updateRemoteCodec mid: ".concat(E.attributes.mid,", from ").concat(E.attributes.payloads," to ").concat(m)),E.attributes.payloads=m,E.media.fmts=S}),!0}createOrRecycleSendMedia(t,n,r,i,a){const c=this.rtpCapabilities.send,d=t===Te.VIDEO?c.videoCodecs:c.audioCodecs,u=t===Te.VIDEO?c.videoExtensions:c.audioExtensions;this.currentMidIndex+=1;const p="".concat(this.currentMidIndex);let f={media:{mediaType:t,port:d_,protos:["UDP","TLS","RTP","SAVPF"],fmts:d.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};f=this.mungSendMediaDesc(f,a);const m=this.findFirstClosedMedia(t);if(m){const E=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[E]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,n,r){const i=bt(t);return $m(i),Aa(i,n),e_(i,n),by(i),Cl(i,r,this.localCapabilities.send),i}mungSendMediaDesc(t,n){const r=bt(t);return Cl(r,n,this.localCapabilities.recv),Po(r),r}updateRecvMedia(t,n){const r=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(r!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=i}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(n=>yt()?n.media.port==="0"&&n.media.mediaType===t:n.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(n=>{var r;return((r=n.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===t[0].ssrcId})}getSSRC(t){var n;return(n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t))===null||n===void 0?void 0:n.attributes.ssrcs}}var it;function j2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function l_(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?j2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let NX=(it=class tE extends mm{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){let t;return this.localCapabilities&&(t=Rl(this.localCapabilities)),[...new Set(t&&t.send.videoCodecs.map(n=>n.rtpMap&&n.rtpMap.encodingName.toLowerCase()||"").filter(n=>{var r;return le(r=Object.keys(Yd)).call(r,n)}))]}constructor(t,n,r){super(t,n),w(this,"store",void 0),w(this,"peerConnection",void 0),w(this,"remoteSDP",void 0),w(this,"initialOffer",void 0),w(this,"transportEventReceiver",void 0),w(this,"statsFilter",void 0),w(this,"useXR",P("USE_XR")),w(this,"localCapabilities",void 0),w(this,"localCandidateCount",0),w(this,"allCandidatesReceived",!1),w(this,"remoteCodecs",void 0),w(this,"dataStreamChannelMap",new Map),w(this,"establishPromise",void 0),w(this,"mutex",new On("NVExtentionsConnection-mutex")),w(this,"rtcMedia",void 0),this.store=n,this.peerConnection=r,this.statsFilter=Zm(this.peerConnection,P("STATS_UPDATE_INTERVAL"),void 0,yt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(t){try{const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Do(n.sdp),i=await Ny({filterRTX:!P("USE_PUB_RTX")&&!P("USE_SUB_RTX"),filterVideoFec:P("FILTER_VIDEO_FEC"),filterAudioFec:P("FILTER_AUDIO_FEC"),filterVideoCodec:P("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=i,this.initialOffer=n,l_(l_({},r),{},{rtpCapabilities:i,offerSDP:n.sdp})}catch(n){throw new B(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t,n,r,i,a,c){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new OX({remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:a,localCapabilities:Rl(this.localCapabilities),cname:c});const d=this.remoteSDP.toString(),u=Vt.parse(this.initialOffer.sdp),p=u.mediaDescriptions.find(E=>E.media.mediaType==="audio");p&&Po(p),this.useXR&&t_(u);const f=Vt.print(u),m=this.logSDPExchange(f||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:f}),m==null||m(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(d){throw new B(O.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(d.toString()))}}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void T.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const a=this.remoteSDP.toString();i==null||i(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}else T.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async updateRemoteConnect(t){var n,r,i,a;(n=this.remoteSDP)===null||n===void 0||n.updateRemoteRTPCapabilities(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&((a=this.remoteSDP)===null||a===void 0||a.updateRemoteCodec([],this.remoteCodecs,this.store.codec)),(r=this.remoteSDP)===null||r===void 0||r.preloadRemoteMedia(2);const c=(i=this.remoteSDP)===null||i===void 0?void 0:i.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:c});const d=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(d),T.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(t,n,r){var i=this;return Yr(function*(){const a=yield Be(i.mutex.lock("From NVExtentionsConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const c=[];t.forEach(v=>{const y=i.peerConnection.addTransceiver(v._mediaStreamTrack,{direction:"sendonly"});c.push(y)}),yt()&&P("SIMULCAST")===!0&&(yield Be(i.applySimulcastForFirefox(c,t)));const d=yield Be(i.peerConnection.createOffer()),u=i.remoteSDP.predictReceivingMids(t.length),p=i.mungSendOfferSDP(d.sdp,t,u),f=Vt.parse(p),m=u.map(v=>{const y=f.mediaDescriptions.find(A=>A.attributes.mid===v);if(!y)throw new Error("Cannot extract ssrc from mediaDescription.");return Ay(y,P("USE_PUB_RTX"))});let E;try{E=yield m}catch(v){E=[],i.remoteSDP.receive(t,n,r,E);const y=i.remoteSDP.toString();throw yield Be(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Be(i.peerConnection.setRemoteDescription({type:"answer",sdp:y})),yield Be(i.stopSending(u,!0)),v}i.remoteSDP.receive(t,n,r,E);const S=i.remoteSDP.toString(),I=i.logSDPExchange(p,"offer","local","send");return yield Be(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Be(i.applySimulcastEncodings(c,t)),yield Be(i.applySendEncodings(c,t)),I==null||I(S),yield Be(i.peerConnection.setRemoteDescription({type:"answer",sdp:S})),c.map((v,y)=>{const A=u[y];return{localSSRC:m[y],id:A,transceiver:v}})}catch(c){throw c instanceof B?c:new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(u=>t.indexOf(u.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");i.map(u=>{var p;u.direction="inactive",(p=u.stop)===null||p===void 0||p.call(u)});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);return r&&r.readyState==="open"?T.debug("[P2PConnection] Channels are already available and can be reused directly."):(r=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:P("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)),void n.forEach(i=>{i._updateOriginDataChannel(r)})}catch(r){throw r instanceof B?r:new B(O.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n==null||n.close(),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof B?n:new B(O.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(n.toString()))}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(t,n,r,i);if(c){const u=this.remoteSDP.toString(),p=this.logSDPExchange(u,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const f=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(f.sdp,a,t);p==null||p(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),T.debug("[NVExtentionsConnection] receive ".concat(t," by exchanging SDP."))}else T.debug("[NVExtentionsConnection] receive ".concat(t," no need to exchange SDP."));const d=this.peerConnection.getTransceivers().find(u=>u.mid===a);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:a}}catch(a){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(a.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);if(r){const i=this.remoteSDP.toString(),a=this.logSDPExchange(i,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c),T.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else T.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return n.map(i=>{const a=this.peerConnection.getTransceivers().find(c=>c.mid===i);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:i}})}catch(n){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const a=this.remoteSDP.toString();i==null||i(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,d)=>{c.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const a=this.remoteSDP.toString();i==null||i(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Yr(function*(){const r=yield Be(n.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ze().supportPCSetConfiguration){const p=n.peerConnection.getConfiguration(),f=t===or.RELAY?"relay":"all";p.iceTransportPolicy!==f&&(T.debug("restartICE change iceTransportPolicy from [".concat(p.iceTransportPolicy,"] to [").concat(f,"]")),p.iceTransportPolicy=f,n.peerConnection.setConfiguration(p))}else if(t===or.RELAY)return;t!==or.RELAY&&n.remoteSDP.updateCandidates(t);const i=yield Be(n.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=Do(i.sdp),{remoteIceParameters:c}=yield a.iceParameters;n.remoteSDP.restartICE(c);const d=n.remoteSDP.toString(),u=n.logSDPExchange(i.sdp||"","offer","local","restartICE");yield Be(n.peerConnection.setLocalDescription(i)),u==null||u(d),yield Be(n.peerConnection.setRemoteDescription({type:"answer",sdp:d}))}catch(i){T.warning("restart ICE failed, abort operation",i)}finally{r()}})()}close(){var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const a=this.remoteSDP.toString(),c=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),c==null||c(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(r){throw new B(O.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?yt()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}getP2PConnectionParams(){var t;if((t=this.peerConnection.currentLocalDescription)===null||t===void 0||!t.sdp||!this.localCapabilities)throw new Error;return l_(l_({},Do(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},P("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Hd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...tE.turnServerConfigToIceServers(t.turnServer.servers)),P("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...tE.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),P("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Sa(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!P("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}async applySendEncodings(t,n){try{if(!Ze().supportSetRtpSenderParameters||t.length!==n.length)return;for(let m=0;m<t.length;m++){const E=t[m],S=n[m];if(S&&S instanceof wt){var r,i,a;if(this.isVP8Simulcast(S))continue;const I={},v={};switch(S._optimizationMode){case"motion":I.degradationPreference="maintain-framerate";break;case"detail":I.degradationPreference="maintain-resolution";break;default:I.degradationPreference="balanced"}var c,d,u,p;if((r=S._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&(v.maxBitrate=1e3*((c=S._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)),le(i=S._hints).call(i,Ot.LOW_STREAM)&&((d=S._encoderConfig)!==null&&d!==void 0&&d.frameRate&&(v.maxFramerate=Dr(S._encoderConfig.frameRate)),(u=S._encoderConfig)!==null&&u!==void 0&&u.scaleResolutionDownBy&&((p=S._encoderConfig)===null||p===void 0?void 0:p.scaleResolutionDownBy)>1&&(v.scaleResolutionDownBy=S._encoderConfig.scaleResolutionDownBy)),P("DSCP_TYPE")&&ha()){var f;const N=P("DSCP_TYPE");le(f=["very-low","low","medium","high"]).call(f,N)&&(v.networkPriority=N)}const y=E.sender.getParameters(),A=(a=y.encodings)===null||a===void 0?void 0:a[0];yt()&&!A&&(I.encodings=[v]),A&&Object.assign(A,v),Object.assign(y,I),await E.sender.setParameters(y)}}}catch{T.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,n,r){const i=Vt.parse(t);return n.forEach((a,c)=>{const d=r[c],u=i.mediaDescriptions.find(p=>p.attributes.mid===d);u&&(Aa(u,a),Oy(u,a,this.store.codec))}),Vt.print(i)}mungReceiveAnswerSDP(t,n,r){const i=Vt.parse(t),a=i.mediaDescriptions.find(c=>c.attributes.mid===n);return a&&r===Te.AUDIO&&a.media.mediaType==="audio"&&Po(a),this.useXR&&t_(i),Vt.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let u=0;u<t.length;u++){var r,i,a,c,d;const p=t[u],f=n[u];if(f instanceof wt&&!le(r=f._hints).call(r,Ot.LOW_STREAM)&&(i=f._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((a=f._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(c=f._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((d=f._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1&&this.store.codec==="vp8"){const m={},E={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const S=p.sender.getParameters();await p.sender.setParameters(Object.assign(S,m))}}}async applySimulcastEncodings(t,n){if(!yt()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof wt&&this.isVP8Simulcast(i)){const a=t[r],c={},d={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:d.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:d.medium,scaleResolutionDownBy:4}];const u=a.sender.getParameters();await a.sender.setParameters(Object.assign(u,c))}}}isVP8Simulcast(t){var n,r,i,a,c;return!!(t instanceof wt&&P("SIMULCAST")&&this.store.codec==="vp8"&&!le(n=t._hints).call(n,Ot.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(a=t._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=t._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(P("SDP_LOGGING"))return T.upload("exchanging ".concat(r," ").concat(n," SDP during NVExtentionsConnection.").concat(i,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",r==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Ze().supportPCSetConfiguration){const n=tE.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},se(it.prototype,"connect",[Lr],Object.getOwnPropertyDescriptor(it.prototype,"connect"),it.prototype),se(it.prototype,"updateRemoteRTPCapabilities",[Lr],Object.getOwnPropertyDescriptor(it.prototype,"updateRemoteRTPCapabilities"),it.prototype),se(it.prototype,"updateRemoteConnect",[Lr],Object.getOwnPropertyDescriptor(it.prototype,"updateRemoteConnect"),it.prototype),se(it.prototype,"createDataChannels",[Lr],Object.getOwnPropertyDescriptor(it.prototype,"createDataChannels"),it.prototype),se(it.prototype,"receive",[Lr],Object.getOwnPropertyDescriptor(it.prototype,"receive"),it.prototype),se(it.prototype,"batchReceive",[Lr],Object.getOwnPropertyDescriptor(it.prototype,"batchReceive"),it.prototype),se(it.prototype,"stopReceiving",[Lr],Object.getOwnPropertyDescriptor(it.prototype,"stopReceiving"),it.prototype),se(it.prototype,"muteRemote",[Lr],Object.getOwnPropertyDescriptor(it.prototype,"muteRemote"),it.prototype),se(it.prototype,"unmuteRemote",[Lr],Object.getOwnPropertyDescriptor(it.prototype,"unmuteRemote"),it.prototype),se(it.prototype,"muteLocal",[Lr],Object.getOwnPropertyDescriptor(it.prototype,"muteLocal"),it.prototype),se(it.prototype,"unmuteLocal",[Lr],Object.getOwnPropertyDescriptor(it.prototype,"unmuteLocal"),it.prototype),se(it.prototype,"close",[Lr],Object.getOwnPropertyDescriptor(it.prototype,"close"),it.prototype),se(it.prototype,"updateEncoderConfig",[Lr],Object.getOwnPropertyDescriptor(it.prototype,"updateEncoderConfig"),it.prototype),se(it.prototype,"updateSendParameters",[Lr],Object.getOwnPropertyDescriptor(it.prototype,"updateSendParameters"),it.prototype),se(it.prototype,"replaceTrack",[Lr],Object.getOwnPropertyDescriptor(it.prototype,"replaceTrack"),it.prototype),se(it.prototype,"getRemoteSSRC",[Lr],Object.getOwnPropertyDescriptor(it.prototype,"getRemoteSSRC"),it.prototype),it);function Lr(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,a=await i.lock("From NVExtentionsConnection.".concat(t));try{for(var c=arguments.length,d=new Array(c),u=0;u<c;u++)d[u]=arguments[u];return await r.apply(this,d)}finally{a()}},n}var ht;function F2(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=C2,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new u_(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function u_(e){function t(n){if(Object(n)!==n)return ae.reject(new TypeError(n+" is not an object."));var r=n.done;return ae.resolve(n.value).then(function(i){return{value:i,done:r}})}return u_=function(n){this.s=n,this.n=n.next},u_.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?ae.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?ae.reject(n):t(r.apply(this.s,arguments))}},new u_(e)}let La=(ht=class nE extends mm{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(t,n){super(t,n),w(this,"store",void 0),w(this,"peerConnection",void 0),w(this,"cname",void 0),w(this,"mutex",new On("DataChannelConnection-mutex")),w(this,"dataChannel",void 0),w(this,"_p2pConnection",void 0),w(this,"establishPromise",void 0),w(this,"_nvMedia",void 0),this.store=n,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(nE.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new NX(t,n,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var t;const n=(t=this._nvMedia)===null||t===void 0?void 0:t.getLocalRtpCapabilities();return await this._p2pConnection.establish(n)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(t,n,r,i,a,c){return this.cname=c,await this._p2pConnection.connect(t,n,r,i,a,c),await new ae((d,u)=>{const p=setTimeout(()=>{this.closeSignal(),u(new B(O.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(r))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(p),void d()},this.dataChannel.onerror=f=>{this.closeSignal(),u(f)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(t,n){return this._p2pConnection.updateRemoteRTPCapabilities(t,n)}send(t,n,r){var i=this;return Yr(function*(){const a=yield Be(i.mutex.lock("From DataChannelConnection.send"));try{return yield*i_(F2(i._p2pConnection.send(t,n,r)))}finally{a()}})()}async stopSending(t,n){return this._p2pConnection.stopSending(t,n)}async createDataChannels(t,n){return this._p2pConnection.createDataChannels(t,n)}async stopDataChannels(t){return this._p2pConnection.stopDataChannels(t)}async receive(t,n,r,i){return this._nvMedia?(T.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,n,this.cname)):(T.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,n,r,i))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var n=this;return Yr(function*(){return yield*i_(F2(n._p2pConnection.restartICE(t)))})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var n;(n=this._nvMedia)===null||n===void 0||n.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,n){return await this._p2pConnection.updateEncoderConfig(t,n)}async updateSendParameters(t,n){return await this._p2pConnection.updateSendParameters(t,n)}setStatsRemoteVideoIsReady(t,n){this._p2pConnection.setStatsRemoteVideoIsReady(t,n)}async replaceTrack(t,n){return await this._p2pConnection.replaceTrack(t,n)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,n,r,i){if(P("SDP_LOGGING"))return T.upload("exchanging ".concat(r," ").concat(n," SDP during DataChannelConnection.").concat(i,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",r==="local"?"remote":"local",i)}:void 0}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Hd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...nE.turnServerConfigToIceServers(t.turnServer.servers)),P("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...nE.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),P("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Sa(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!P("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var n;return(n=this.onICEConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var n;return(n=this.onConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var n;return(n=this.onDTLSTransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var n;return(n=this.onDTLSTransportError)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var n;return(n=this.onICETransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var n;return(n=this.onFirstAudioReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var n;return(n=this.onFirstVideoReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var n;return(n=this.onFirstAudioDecoded)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,n,r)=>{var i;return(i=this.onFirstVideoDecoded)===null||i===void 0?void 0:i.call(this,t,n,r)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var n;return(n=this.onFirstVideoDecodedTimeout)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,n)=>{var r;return(r=this.onSelectedLocalCandidateChanged)===null||r===void 0?void 0:r.call(this,t,n)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,n)=>{var r;return(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0?void 0:r.call(this,t,n)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}},se(ht.prototype,"connect",[fi],Object.getOwnPropertyDescriptor(ht.prototype,"connect"),ht.prototype),se(ht.prototype,"updateRemoteRTPCapabilities",[fi],Object.getOwnPropertyDescriptor(ht.prototype,"updateRemoteRTPCapabilities"),ht.prototype),se(ht.prototype,"createDataChannels",[fi],Object.getOwnPropertyDescriptor(ht.prototype,"createDataChannels"),ht.prototype),se(ht.prototype,"receive",[fi],Object.getOwnPropertyDescriptor(ht.prototype,"receive"),ht.prototype),se(ht.prototype,"stopReceiving",[fi],Object.getOwnPropertyDescriptor(ht.prototype,"stopReceiving"),ht.prototype),se(ht.prototype,"muteRemote",[fi],Object.getOwnPropertyDescriptor(ht.prototype,"muteRemote"),ht.prototype),se(ht.prototype,"unmuteRemote",[fi],Object.getOwnPropertyDescriptor(ht.prototype,"unmuteRemote"),ht.prototype),se(ht.prototype,"muteLocal",[fi],Object.getOwnPropertyDescriptor(ht.prototype,"muteLocal"),ht.prototype),se(ht.prototype,"unmuteLocal",[fi],Object.getOwnPropertyDescriptor(ht.prototype,"unmuteLocal"),ht.prototype),se(ht.prototype,"close",[fi],Object.getOwnPropertyDescriptor(ht.prototype,"close"),ht.prototype),se(ht.prototype,"updateEncoderConfig",[fi],Object.getOwnPropertyDescriptor(ht.prototype,"updateEncoderConfig"),ht.prototype),se(ht.prototype,"updateSendParameters",[fi],Object.getOwnPropertyDescriptor(ht.prototype,"updateSendParameters"),ht.prototype),se(ht.prototype,"replaceTrack",[fi],Object.getOwnPropertyDescriptor(ht.prototype,"replaceTrack"),ht.prototype),se(ht.prototype,"getRemoteSSRC",[fi],Object.getOwnPropertyDescriptor(ht.prototype,"getRemoteSSRC"),ht.prototype),ht);function fi(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,a=await i.lock("From DataChannelConnection.".concat(t));try{for(var c=arguments.length,d=new Array(c),u=0;u<c;u++)d[u]=arguments[u];return await r.apply(this,d)}finally{a()}},n}var Ge;function B2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Es(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?B2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function G2(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=C2,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new h_(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function h_(e){function t(n){if(Object(n)!==n)return ae.reject(new TypeError(n+" is not an object."));var r=n.done;return ae.resolve(n.value).then(function(i){return{value:i,done:r}})}return h_=function(n){this.s=n,this.n=n.next},h_.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?ae.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?ae.reject(n):t(r.apply(this.s,arguments))}},new h_(e)}let p_=(Ge=class extends xt{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Oe.StateChange,t,this._state)}constructor(e,t){super(),w(this,"store",void 0),w(this,"statsUploader",void 0),w(this,"connection",void 0),w(this,"localTrackMap",new Map),w(this,"remoteUserMap",new Map),w(this,"localDataChannels",[]),w(this,"remoteDataChannelMap",new Map),w(this,"pendingLocalTracks",[]),w(this,"pendingRemoteTracks",[]),w(this,"pendingLocalDataChannels",[]),w(this,"pendingRemoteDataChannels",[]),w(this,"statsCollector",void 0),w(this,"isPlanB",!1),w(this,"shouldForwardP2PCreation",void 0),w(this,"iceFailedCount",0),w(this,"dtlsFailedCount",0),w(this,"mutex",new On("P2PChannel-mutex")),w(this,"_state",ut.Disconnected),w(this,"_pcStatsUploadType",P("NEW_ICE_RESTART")?Ps.FIRST_CONNECTION:Ps.OLD_FIRST_CONNECTION),w(this,"_isInRestartIce",!1),w(this,"_isStartRestartIce",!1),w(this,"_restartStates",["disconnected","failed"]),w(this,"_restartTimer",void 0),w(this,"_isFirstConnected",!0),w(this,"handleMuteLocalTrack",async(n,r,i)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==ut.Connected)return void i(new q(O.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const c=this.filterTobeMutedTracks(n);if(c.length===0)return void r();const d=c.find(p=>p[0]==="videoLowTrack");d&&d[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(c.map(p=>{let[,{id:f}]=p;return f}));const u=this.createMuteMessage(c);await Ct(this,Oe.RequestMuteLocal,u),r()}catch(c){i(c)}finally{a()}}),w(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==ut.Connected)return void i(new q(O.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void r();const d=c.find(p=>p[0]==="videoLowTrack");if(d){const p=d[1];if(p.track._originMediaStreamTrack.stop(),!P("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ze().supportDualStreamEncoding){const f=n._mediaStreamTrack.clone();p.track._mediaStreamTrack=f,p.track._originMediaStreamTrack=f}else{const f=Py(n,yc(this,Oe.RequestLowStreamParameter));p.track._mediaStreamTrack=f,p.track._originMediaStreamTrack=f}await new ae((f,m)=>{this.handleReplaceTrack(p.track,f,m,!0)})}await this.connection.unmuteLocal(c.map(p=>{let[,{id:f}]=p;return f}));const u=this.createUnmuteMessage(c);await Ct(this,Oe.RequestUnmuteLocal,u),r()}catch(c){i(c)}finally{a()}}),w(this,"handleUpdateVideoEncoder",async(n,r,i)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const c=this.localTrackMap.get(ne.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==ut.Connected)return void r();const{id:d,track:u}=c;await this.connection.updateSendParameters(d,u),await this.connection.updateEncoderConfig(d,u),this.emit(Oe.UpdateVideoEncoder,u),r()}catch(c){i(c)}finally{a()}}),w(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(ne.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==ut.Connected)return void r();const{id:d,track:u}=c;await this.connection.updateSendParameters(d,u),r()}catch(c){i(c)}finally{a()}}),w(this,"handleReplaceMixingTrack",async(n,r,i,a)=>{if(!this.connection||this.state!==ut.Connected)return void r();const c=ky([n]);let d;T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(c.getTrackId(),"]")),typeof a=="boolean"&&a||(d=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,c),r()}catch(p){i(p)}finally{var u;(u=d)===null||u===void 0||u()}}),w(this,"handleReplaceTrack",async(n,r,i,a)=>{let c;T.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof a=="boolean"&&a||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var d;const p=Array.from(this.localTrackMap.entries()).find(f=>{let[,{track:m}]=f;return n===m});if(!this.connection||!p||this.state!==ut.Connected)return void r();if(await((d=this.connection)===null||d===void 0?void 0:d.replaceTrack(n,p[1].id)),this.isPlanB){const f=p[1];f.id=n._mediaStreamTrack.id,this.localTrackMap.set(p[0],f)}if(p[0]===ne.LocalVideoTrack&&!P("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ze().supportDualStreamEncoding){const f=this.localTrackMap.get(ne.LocalVideoLowTrack);if(f){const m=n._mediaStreamTrack.clone();f.track._originMediaStreamTrack.stop(),f.track._mediaStreamTrack=m,f.track._originMediaStreamTrack=m,await new ae((E,S)=>{this.handleReplaceTrack(f.track,E,S,!0)})}}r()}catch(p){i(p)}finally{var u;(u=c)===null||u===void 0||u()}}),w(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),w(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),w(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),w(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),w(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new o2(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!Ze().supportUnifiedPlan||P("CHROME_FORCE_PLAN_B")&&ha(),this.shouldForwardP2PCreation=P("FORWARD_P2P_CREATION")&&Ze().supportPCSetConfiguration&&UT(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new La({},this.store):this.isPlanB?new wl({},this.store):new Mo({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=ut.New;const r=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new La(e,this.store):this.isPlanB?new wl(e,this.store):new Mo(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new q(O.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=P("NEW_ICE_RESTART")?Ps.FIRST_CONNECTION:Ps.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e,t,n,r,i,a){if(!this.connection)throw new q(O.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof La?this.connection.updateRemoteConnect(r):(this.store.peerConnectionStart(),await this.connection.connect(e,t,n,r,i,a),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ut.Connected)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(i=>{var a;let[c]=i;return le(a=[ne.LocalVideoLowTrack,ne.LocalVideoTrack]).call(a,c)}),n=t.map(i=>{let[,{id:a}]=i;return a}),r=t.map(i=>{let[a]=i;return a});if(this.connection instanceof Mo){if(ye.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!le(e).call(e,this.store.codec)){const i=["vp9","vp8","h264"].find(a=>le(e).call(e,a));i&&(this.store.codec=i,T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async preConnect(e,t,n,r,i,a){if(!this.connection)throw new q(O.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const c=await this.connection.connect(e,t,n,r,i,a);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ut.Connected,c}getEstablishParams(){if(this.connection instanceof La)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}async publishDataChannel(e){if(!this.connection||this.state!==ut.Connected){if(this.state===ut.Disconnected)throw new q(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return void e.forEach(n=>{var r;le(r=this.pendingLocalDataChannels).call(r,n)||this.pendingLocalDataChannels.push(n)})}const t=this.filterTobePublishedDataChannels(e);t.length!==0&&(t.forEach(n=>{const r=Date.now();this.store.publish(n.id.toString(),"datachannel",r)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);const r=Date.now();this.store.publish(n.id+"","datachannel",void 0,r)}))}publish(e,t,n){var r=this;return Yr(function*(){const i=yield Be(r.mutex.lock("From P2PChannel.publish"));try{if(!r.connection||r.state!==ut.Connected){if(r.state===ut.Disconnected)throw new q(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const c=e.filter(d=>r.pendingLocalTracks.indexOf(d)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(c))}r.store.pubId=r.store.pubId+1,Qn.markPublishStart(r.store.clientId,r.store.pubId);const a=r.filterTobePublishedTracks(e,t,n);if(a.length===0)return void(yield Be(r.tryToUnmuteAudio(e)));yield*i_(G2(r.doPublish(r.connection,a)))}finally{i()}})()}doPublish(e,t){var n=this;return Yr(function*(){t.forEach(m=>{let{track:E,type:S}=m;const I=Date.now();n.store.publish(E.getTrackId(),S===ne.LocalAudioTrack?"audio":"video",I)}),n.bindLocalTrackEvents(t);const r=t.map(m=>{let{track:E}=m;return E}),i=yield Be(e.send(t.map(m=>{let{track:E}=m;return E}),n.store.codec,n.store.audioCodec)),a=(yield Be(i.next())).value,c=n.createGatewayPublishMessage(t,a);let d;try{d=yield c}catch(m){throw i.throw(m),(m==null?void 0:m.code)===O.WS_ABORT&&t.forEach(E=>{let{track:S}=E;n.pendingLocalTracks.indexOf(S)===-1&&n.pendingLocalTracks.push(S)}),n.unbindLocalTrackEvents(t),m}const u=n.mapPubResToRemoteConfig(c,d),p=(yield Be(i.next(u))).value,f=P("ENABLE_VIDEO_SEI");r.forEach(async m=>{const E=m.getRTCRtpTransceiver();E&&f&&(m.trackMediaType===Te.VIDEO?await nX(E.sender,m):m.trackMediaType===Te.AUDIO&&await async function(S){if(!Ze().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(Jm.has(S)||!S.track)return;const I={track:S.track};if(ua()){if(!S.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let y=null;try{y=S.createEncodedStreams()}catch(N){return void T.error("create audio-encoded-streams error",N&&N.message)}const A=new TransformStream({transform(N,V){I.controller||(I.controller=V),S.track&&S.track.id!==I.track.id&&(T.debug("audio track changed: ".concat(I.track.id," => ").concat(S.track.id)),I.track.removeEventListener("ended",v),I.track=S.track,I.track.addEventListener("ended",v)),V.enqueue(N)}});y.readable.pipeThrough(A).pipeTo(y.writable)}else if(Cn()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const y=qm(),A=new MessageChannel;await new ae(V=>y.onmessage=F=>{F.data==="registered"&&V(void 0)});const N=new RTCRtpScriptTransform(y,{name:"tx",port:A.port2},[A.port2]);S.transform=N,await new ae(V=>y.onmessage=F=>{F.data==="started"&&V(void 0)}),A.port1.onmessage=V=>{var F;V.data.transformed&&S.track&&((F=S.track)===null||F===void 0?void 0:F.id)!==I.track.id&&(T.debug("audio track changed: ".concat(I.track.id," => ").concat(S.track.id)),I.track.removeEventListener("ended",v),I.track=S.track,I.track.addEventListener("ended",v))},I.worker=y}function v(){if(S.track){if(this.id!==S.track.id)return;S.track.removeEventListener("ended",v)}const y=Jm.get(S);if(y){Jm.delete(S);try{var A,N;(A=y.controller)===null||A===void 0||A.terminate(),(N=y.worker)===null||N===void 0||N.terminate()}catch(V){T.warning(V&&V.message)}}}Jm.set(S,I),S.track.addEventListener("ended",v)}(E.sender))}),t.forEach(m=>{let{type:E}=m;n.statsCollector.addLocalStats(E)}),n.assignLocalTracks(t,p),n.statsUploader.startUploadOutboundStats(),t.forEach(m=>{let{track:E,type:S}=m;const I=Date.now();n.store.publish(E.getTrackId(),S===ne.LocalAudioTrack?"audio":"video",void 0,I)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n)return;if(!(n.track instanceof wt))return T.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof Mo||this.connection instanceof wl))return T.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:r}=n,i=function(a,c){const d={};return a.height&&a.width&&(d.scaleResolutionDownBy=cv(a,c)),d.maxFramerate=a.framerate?Dr(a.framerate):void 0,d.maxBitrate=a.bitrate?1e3*a.bitrate:void 0,d}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==ne.LocalVideoLowTrack||!P("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ze().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const a=r._originMediaStreamTrack;if(!a.canvas)return T.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(c,d){const u=c.canvas;d.width&&(u.width=Dr(d.width)),d.height&&(u.height=Dr(d.height)),d.framerate&&(u.stopCapture&&u.stopCapture(),u.stopCapture=py(()=>{!u.startCapture&&u.stopCapture&&u.stopCapture(),u.startCapture&&u.startCapture()},Dr(d.framerate)))})(a,e)}i.maxBitrate!=null&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),T.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return Yr(function*(){if(!t.connection||t.state!==ut.Connected)return;const n=yield Be(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const i=t.localTrackMap.get(ne.LocalVideoTrack);if(!i)throw new q(O.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(ne.LocalVideoLowTrack))throw new q(O.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const a=[{track:t.getLowVideoTrack(i.track,e),type:ne.LocalVideoLowTrack}];if(yield*i_(G2(t.doPublish(t.connection,a))),i.track.muted||!i.track.enabled){var r;const c=(r=t.localTrackMap.get(ne.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;c!==void 0&&(yield Be(t.connection.muteLocal([c])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(T.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await un(this,Oe.RequestRePublish,this.pendingLocalTracks),this.emit(Oe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(T.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await un(this,Oe.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:r}=this.pendingRemoteTracks[t];(r!==Te.AUDIO||n._audio_added_&&n._audioSSRC)&&(r!==Te.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await un(this,Oe.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===Te.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(Oe.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==ut.Connected)return void e.forEach(r=>{const i=this.pendingLocalTracks.indexOf(r);i!==-1&&this.pendingLocalTracks.splice(i,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(r=>r[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==ut.Connected)return void e.forEach(n=>{const r=this.pendingLocalDataChannels.indexOf(n);r!==-1&&this.pendingLocalDataChannels.splice(r,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{const r=this.localDataChannels.indexOf(n);r!==-1&&this.localDataChannels.splice(r,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==ut.Connected)return;const e=this.localTrackMap.get(ne.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[ne.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(r=>{let[,{id:i}]=r;return i})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[i,{track:a}]=r;return{type:i,track:a}})),t.forEach(r=>{let[i]=r;this.statsCollector.removeLocalStats(i)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==ut.Connected)throw new q(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(r=>{var i;return!((i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.get(r.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(r=>{var i;this.remoteDataChannelMap.has(e)?(i=this.remoteDataChannelMap.get(e))===null||i===void 0||i.set(r.id,r):this.remoteDataChannelMap.set(e,new Map([[r.id,r]]));const a=this.pendingRemoteDataChannels.findIndex(c=>{let{user:d,id:u}=c;return d.uid===e.uid&&u===r.id});a!==-1&&this.pendingRemoteDataChannels.splice(a,1)}),n.map(r=>r.id)}async subscribe(e,t,n,r,i){var a;if(!this.connection||this.state!==ut.Connected)throw new q(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((a=this.remoteUserMap.get(e))!==null&&a!==void 0&&a.has(t))return;let c,d,u;if(i){const m=i.find(S=>{let{stream_type:I}=S;return I===t});if(!m)throw new q(O.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const E=await this.connection.receive(t,m.ssrcs,String(e._uintid),m.attributes);this.connection instanceof Mo&&(u=E.transceiver),c=E.track,d=E.id}else{const m=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof Mo&&(u=m.transceiver),c=m.track,d=m.id}t===Te.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(c):(e._audioTrack=new yl(c,e.uid,e._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),u&&e._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(c):(e._videoTrack=new vl(c,e.uid,e._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),u&&e._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._videoTrack)),P("ENABLE_VIDEO_SEI")&&u&&(t==Te.VIDEO?await rX(u.receiver,{onSei:m=>{var E;(E=e._videoTrack)===null||E===void 0||E._onSei(m)}}):t==Te.AUDIO&&await async function(m){if(!Ze().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(Xm.has(m))return;const E={track:m.track};if(ua()){if(!m.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let I=null;try{I=m.createEncodedStreams()}catch(y){return void T.error("create audio-encoded-streams error",y&&y.message)}const v=new TransformStream({transform(y,A){E.controller||(E.controller=A),m.track&&m.track.id!==E.track.id&&(T.debug("audio track changed: ".concat(E.track.id," => ").concat(m.track.id)),E.track.removeEventListener("ended",S),E.track=m.track,E.track.addEventListener("ended",S)),A.enqueue(y)}});I.readable.pipeThrough(v).pipeTo(I.writable)}else if(Cn()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const I=qm(),v=new MessageChannel;await new ae(A=>I.onmessage=N=>{N.data==="registered"&&A(void 0)});const y=new RTCRtpScriptTransform(I,{name:"rx",port:v.port2},[v.port2]);m.transform=y,await new ae(A=>I.onmessage=N=>{N.data==="started"&&A(void 0)}),v.port1.onmessage=A=>{var N;A.data.transformed&&m.track&&((N=m.track)===null||N===void 0?void 0:N.id)!==E.track.id&&(T.debug("audio track changed: ".concat(E.track.id," => ").concat(m.track.id)),E.track.removeEventListener("ended",S),E.track=m.track,E.track.addEventListener("ended",S))},E.worker=I}function S(){m.track.removeEventListener("ended",S),function(I){const v=Xm.get(I);if(v){Xm.delete(I);try{var y,A;(y=v.controller)===null||y===void 0||y.terminate(),(A=v.worker)===null||A===void 0||A.terminate()}catch(N){T.warning(N&&N.message)}}}(m)}Xm.set(m,E),m.track.addEventListener("ended",S)}(u.receiver));const p=this.remoteUserMap.get(e);p?p.set(t,d):this.remoteUserMap.set(e,new Map([[t,d]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const f=this.pendingRemoteTracks.findIndex(m=>{let{user:E,kind:S}=m;return E.uid===e.uid&&t===S});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(Oe.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==ut.Connected)throw new q(O.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(n=>{var r;let{user:i,mediaType:a}=n;return!((r=this.remoteUserMap.get(i))!==null&&r!==void 0&&r.has(a))});const t=await this.connection.batchReceive(e.map(n=>{let{user:r,mediaType:i,ssrcId:a,rtxSsrcId:c}=n;return{kind:i,ssrcMsg:[{ssrcId:a,rtx:c}],mslabel:String(r._uintid)}}));e.forEach((n,r)=>{let{user:i,mediaType:a}=n;const{track:c,id:d,transceiver:u}=t[r];a===Te.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(c):(i._audioTrack=new yl(c,i.uid,i._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),u&&i._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(c):(i._videoTrack=new vl(c,i.uid,i._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),u&&i._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(i,i._videoTrack));const p=this.remoteUserMap.get(i);p?p.set(a,d):this.remoteUserMap.set(i,new Map([[a,d]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();const f=this.pendingRemoteTracks.findIndex(m=>{let{user:E,kind:S}=m;return E.uid===i.uid&&a===S});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(Oe.MediaReconnectEnd,i.uid))})}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(c=>{let{user:d,kind:u}=c;return t!==void 0?d.uid===e.uid&&t===u:d.uid===e.uid});if(r.forEach(c=>{const d=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(d,1)}),this.connection&&this.state===ut.Connected||n||r.forEach(c=>{let{kind:d}=c;var u;if(d===Te.AUDIO)(u=e._audioTrack)===null||u===void 0||u._destroy(),e._audioTrack=void 0;else if(d===Te.VIDEO){var p;(p=e._videoTrack)===null||p===void 0||p._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==ut.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(i.length===0)return;await this.connection.stopReceiving(i.map(c=>{let[,{id:d}]=c;return d}));const a=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(c=>{let[d,{kind:u}]=c;var p,f;if(u===Te.VIDEO&&d._videoSSRC&&((p=this.connection)===null||p===void 0||p.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),u===Te.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),n||((f=d._videoTrack)===null||f===void 0||f._destroy(),d._videoTrack=void 0);else if(u===Te.AUDIO){var m;this.unbindRemoteTrackEvents(d._audioTrack),!n&&((m=d._audioTrack)===null||m===void 0||m._destroy(),d._audioTrack=void 0)}}),a}async unsubscribeDataChannel(e,t){if(t.forEach(i=>{const a=this.pendingRemoteDataChannels.findIndex(c=>c.id===i.id);a!==-1&&this.pendingRemoteDataChannels.splice(a,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(i=>{i._close()});const r=this.remoteDataChannelMap.get(e);return n.forEach(i=>{r&&r.delete(i.id)}),r&&r.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(i=>i.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:i,mediaType:a}of e){const c=this.pendingRemoteTracks.filter(d=>{let{user:u,kind:p}=d;return a!==void 0?u.uid===i.uid&&a===p:u.uid===i.uid});c.forEach(d=>{const u=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(u,1)}),t=t.concat(c)}if(!this.connection||this.state!==ut.Connected)return void t.forEach(i=>{let{user:a,kind:c}=i;var d;if(c===Te.AUDIO)(d=a._audioTrack)===null||d===void 0||d._destroy(),a._audioTrack=void 0;else if(c===Te.VIDEO){var u;(u=a._videoTrack)===null||u===void 0||u._destroy(),a._videoTrack=void 0}});const n=vo(e).call(e,(i,a)=>{let{user:c,mediaType:d}=a;const u=this.filterTobeUnSubscribedTracks(c,d);return i.concat(u)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(i=>{let[,{id:a}]=i;return a}));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(i=>{let[a,{kind:c}]=i;var d,u;if(c===Te.VIDEO&&a._videoSSRC&&((d=this.connection)===null||d===void 0||d.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),c===Te.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),(u=a._videoTrack)===null||u===void 0||u._destroy(),a._videoTrack=void 0;else if(c===Te.AUDIO){var p;this.unbindRemoteTrackEvents(a._audioTrack),(p=a._audioTrack)===null||p===void 0||p._destroy(),a._audioTrack=void 0}}),r}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void T.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Te.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||T.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(ne.LocalAudioTrack);if((t==null?void 0:t.track)instanceof gn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==ne.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===ne.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===ne.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,i){if(e){const c=this.localTrackMap.get(ne.LocalAudioTrack),d=r?this.localTrackMap.get(ne.LocalVideoLowTrack):this.localTrackMap.get(ne.LocalVideoTrack);ye.publish(this.store.sessionId,{eventElapse:Qn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:d==null?void 0:d.track.getTrackLabel(),screenshare:(d==null?void 0:d.track._hints.indexOf(Ot.SCREEN_TRACK))!==-1,audio:!!c,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var a;n||(n=[]);const c=n.find(u=>u instanceof qt),d=r?(a=this.localTrackMap.get(ne.LocalVideoTrack))===null||a===void 0?void 0:a.track:n.find(u=>u instanceof wt);ye.publish(this.store.sessionId,{eventElapse:Qn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.getTrackLabel(),videoName:d==null?void 0:d.getTrackLabel(),screenshare:(d==null?void 0:d._hints.indexOf(Ot.SCREEN_TRACK))!==-1,audio:!!c,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===Te.VIDEO?n._videoSSRC:n._audioSSRC;i&&ye.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Te.VIDEO,audio:r===Te.AUDIO,peerid:n.uid,subscribeRequestid:r===Te.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Qn.measureFromSubscribeStart(this.store.clientId,i)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new On("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new La({},this.store):this.isPlanB?new wl({},this.store):new Mo({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ne.LocalAudioTrack);if((e==null?void 0:e.track)instanceof gn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=ut.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ne.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ne.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof wt||t&&t.track instanceof qt?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(ni(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ne.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=ku(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.connection&&(T.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=ut.Reconnecting,P("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new La({},this.store):this.isPlanB?new wl({},this.store):new Mo({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case ne.LocalVideoTrack:le(t=r._hints).call(t,Ot.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case ne.LocalAudioTrack:r instanceof gn?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case ne.LocalVideoLowTrack:}}),this.emit(Oe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(ni(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(Oe.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(ni(n).call(n)).forEach(r=>{this.setPendingRemoteDataChannel(t,r)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),T.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:r,id:i}=n;if((e instanceof Na?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof Na?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Yr(function*(){if(!t.connection||t.state!==ut.Connected||t.connection instanceof La)return;const n=yield Be(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield Be(t.connection.restartICE(e));const a=yield Be(r.next());if(a.done)return;const c=a.value,d=yield c;switch(t.reportPCDisconnectedOrFailed(e),e){case or.TCP:t._pcStatsUploadType=Ps.TCP_RESTART;break;case or.RELAY:t._pcStatsUploadType=Ps.RELAY_RESTART;break;default:t._pcStatsUploadType=Ps.OLD_RESTART}t._isInRestartIce=!0,r.next(d)}catch(a){var i;(i=r)===null||i===void 0||i.throw(a)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(ne.LocalVideoTrack),n=this.localTrackMap.get(ne.LocalAudioTrack),r=e.videoSend.find(S=>S.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),i=e.audioSend.find(S=>S.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!r||!i)return 1;const a=Kr(this,Oe.NeedSignalRTT),c=r?r.rttMs:void 0,d=i?i.rttMs:void 0,u=c&&d?(c+d)/2:c||d,p=(u&&a?(u+a)/2:u||a)||0,f=100*e.sendPacketLossRate*.7/50+.3*p/1500,m=f<.17?1:f<.36?2:f<.59?3:f<.1?4:5,E=t==null?void 0:t.track;if(E&&E._encoderConfig&&E._hints.indexOf(Ot.SCREEN_TRACK)===-1){const S=E._encoderConfig.bitrateMax,I=e.bitrate.actualEncoded;if(S&&I){const v=(1e3*S-I)/(1e3*S);return R1[v<.15?0:v<.3?1:v<.45?2:v<.6?3:4][m]}}return m}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,a=r._videoSSRC,c=e.audioRecv.find(I=>I.ssrc===i),d=e.videoRecv.find(I=>I.ssrc===a);if(!c&&!d)return void(t+=1);const u=Kr(this,Oe.NeedSignalRTT),p=e.rtt,f=(p&&u?(p+u)/2:p||u)||0,m=c?c.jitterMs:void 0,E=e.recvPacketLossRate;let S=.7*E*100/50+.3*f/1500;m&&(S=.6*E*100/50+.2*f/1500+.2*m/400),t+=S<.1?1:S<.17?2:S<.36?3:S<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ae((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(T.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==ut.Connected)return;const r=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:c}]=a;return e===c});if(!r)return;const i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,r[1].id)),this.isPlanB){const a=r[1];a.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,a)}if(i===ne.LocalVideoTrack&&!P("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ze().supportDualStreamEncoding){const a=this.localTrackMap.get(ne.LocalVideoLowTrack);if(a){const c=e._mediaStreamTrack.clone();a.track._originMediaStreamTrack.stop(),a.track._mediaStreamTrack=c,a.track._originMediaStreamTrack=c,await new ae((d,u)=>{this.handleReplaceTrack(a.track,d,u,!0)})}}}filterTobePublishedTracks(e,t,n){const r=[],i=this.getAllTracks();e=Kd(e=e.filter(u=>i.indexOf(u)===-1));let a,c=!1;const d=this.localTrackMap.get(ne.LocalAudioTrack);for(const u of e){if(u instanceof wt&&(this.localTrackMap.has(ne.LocalVideoTrack)||c?new q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:u,type:ne.LocalVideoTrack}),c=!0),t)){const p=this.getLowVideoTrack(u,n);r.push({track:p,type:ne.LocalVideoLowTrack})}if(u instanceof qt)if(d){const p=d.track;if(p instanceof gn)Ly([u]),p.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0);else{const f=ky([p,u]);T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(f.getTrackId(),"]")),this.replaceTrack(p,f)}}else a instanceof gn?(Ly([u]),a.addAudioTrack(u)):a||!u._useAudioElement&&Ze().webAudioMediaStreamDest&&!u._bypassWebAudio?a=ky(a?[u,a]:[u]):a=u}return a&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(a.getTrackId(),"]")),r.push({track:a,type:ne.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Kd(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof qt){const i=this.localTrackMap.get(ne.LocalAudioTrack);if(!i)continue;i.track instanceof gn?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([ne.LocalAudioTrack,i]),i.track.close())):t.push([ne.LocalAudioTrack,i])}if(r instanceof wt){const i=this.localTrackMap.get(ne.LocalVideoTrack);if(!i)continue;t.push([ne.LocalVideoTrack,i]);const a=this.localTrackMap.get(ne.LocalVideoLowTrack);a&&t.push([ne.LocalVideoLowTrack,a])}}return t}filterTobePublishedDataChannels(e){return e=(e=Kd(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Kd(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case ne.LocalVideoTrack:n.addListener(fe.GET_STATS,this.handleGetLocalVideoStats),n.addListener(fe.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(fe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(fe.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ne.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof gn?e.trackList.forEach(n=>{n.addListener(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(fe.GET_STATS,this.handleGetLocalAudioStats),n.addListener(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(fe.GET_STATS,this.handleGetLocalAudioStats),e.addListener(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(fe.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case ne.LocalVideoTrack:n.off(fe.GET_STATS,this.handleGetLocalVideoStats),n.off(fe.GET_RTC_STATS,this.handleGetRTCStats),n.off(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(fe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(fe.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ne.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof gn?e.trackList.forEach(t=>{t.off(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(fe.GET_STATS,this.handleGetLocalAudioStats),t.off(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(fe.GET_STATS,this.handleGetLocalAudioStats),e.off(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(fe.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof vl&&t.addListener(fe.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof yl&&t.addListener(fe.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(fe.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Te.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Te.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var i;let a,c,{track:d,type:u}=n;switch(u){case ne.LocalAudioTrack:a=lt.Audio,c={dtx:d instanceof Ym&&d._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ne.LocalVideoTrack:a=le(i=d._hints).call(i,Ot.SCREEN_TRACK)?lt.Screen:lt.High,c=Es(Es({},W1(d)),{},{codec:this.store.codec});break;case ne.LocalVideoLowTrack:a=lt.Low,c=Es(Es({},W1(d)),{},{codec:this.store.codec})}return{stream_type:a,attributes:c,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[i,{track:a,ssrcs:c,id:d}]=t;switch(i){case ne.LocalVideoTrack:r=le(n=a._hints).call(n,Ot.SCREEN_TRACK)?lt.Screen:lt.High;break;case ne.LocalAudioTrack:r=lt.Audio;break;case ne.LocalVideoLowTrack:r=lt.Low}return{stream_type:r,ssrcs:c,mid:d}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:i,type:a}=n;this.localTrackMap.set(a,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Oe.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),P("NEW_ICE_RESTART")){var n;if(le(n=this._restartStates).call(n,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const r=c=>{(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")&&(T.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(c)),Kr(this,Oe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Oe.RequestRestartICE,c))},i=()=>{e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="checking"&&e.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),T.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Oe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},a=P("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(P("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ze().supportPCSetConfiguration)r(or.RELAY),this._restartTimer=window.setTimeout(i,a);else if(yt())r(or.UDP),this._restartTimer=window.setTimeout(i,4e3);else{if(r(or.TCP),Ze().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{r(or.RELAY),this._restartTimer=window.setTimeout(i,a)},a));this._restartTimer=window.setTimeout(i,a)}},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&P("ICE_RESTART")&&Kr(this,Oe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Oe.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(Oe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(Oe.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),ye.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Kt.TRACER}).onSuccess(),this.emit(Oe.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(ni(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(El.FIRST_FRAME_DECODED),ye.firstRemoteFrame(this.store.sessionId,Nn.FIRST_AUDIO_DECODE,Bt.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Qn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(ni(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===t);r&&ye.firstRemoteFrame(this.store.sessionId,Nn.FIRST_AUDIO_RECEIVED,Bt.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Qn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;const r=Array.from(ni(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&ye.firstRemoteFrame(this.store.sessionId,Nn.FIRST_VIDEO_RECEIVED,Bt.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Qn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(Oe.ConnectionTypeChange,r),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ta(n))," -> ").concat(JSON.stringify(Ta(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ta(n))," -> ").concat(JSON.stringify(Ta(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return Es(Es({},t),n)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ne.LocalAudioTrack);if(e instanceof qt&&(n==null?void 0:n.track)instanceof gn)return n.track.isActive||t.push([ne.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:a}]=i;return e===a});if(r&&(t.push(r),r[0]===ne.LocalVideoTrack)){const i=this.localTrackMap.get(ne.LocalVideoLowTrack);i&&t.push([ne.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ne.LocalAudioTrack);if(e instanceof qt&&(n==null?void 0:n.track)instanceof gn)return n.track.isActive&&t.push([ne.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:a}]=i;return e===a});if(r)if(r[0]===ne.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(ne.LocalVideoLowTrack);i&&t.push([ne.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[i,{track:a,ssrcs:c,id:d}]=t;switch(i){case ne.LocalAudioTrack:r=lt.Audio;break;case ne.LocalVideoTrack:r=le(n=a._hints).call(n,Ot.SCREEN_TRACK)?lt.Screen:lt.High;break;case ne.LocalVideoLowTrack:r=lt.Low}return{stream_type:r,ssrcs:c,mid:d}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[i,{track:a,ssrcs:c,id:d}]=t;switch(i){case ne.LocalAudioTrack:r=lt.Audio;break;case ne.LocalVideoTrack:r=le(n=a._hints).call(n,Ot.SCREEN_TRACK)?lt.Screen:lt.High;break;case ne.LocalVideoLowTrack:r=lt.Low}return{stream_type:r,ssrcs:c,mid:d}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[a,c]=i;n.push([e,{kind:a,id:c}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(r=>{var i;(i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.has(r.id)&&n.push(r)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:i,id:a}]=n;switch(i){case Te.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Te.VIDEO,ssrcId:r._videoSSRC}));case Te.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Te.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[r,{kind:i}]=n;if(t.has(r)){let a=t.get(r);i===Te.VIDEO?a|=wn.Video:a|=wn.Audio,t.set(r,a)}else i===Te.VIDEO?t.set(r,wn.Video):t.set(r,wn.Audio)}),{users:Array.from(t.entries()).map(n=>{let[r,i]=n;return{stream_id:r.uid,stream_type:i}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ne.LocalVideoTrack),n=this.localTrackMap.get(ne.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t){return e.map((n,r)=>{var i;let{stream_type:a}=n;return(i=t.find(c=>{let{stream_type:d}=c;return a===d}))===null||i===void 0?void 0:i.attributes})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof qt){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(r.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map(a=>{let[,{id:c}]=a;return c})));const i=this.createUnmuteMessage(r);return void await Ct(this,Oe.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Oe.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Oe.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Rn(sm(this.dtlsFailedCount,on)),this.emit(Oe.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await un(this,Oe.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Oe.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ne.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof wt)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof wt).length>1)throw new q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof qt).length>1&&(e.some(t=>t instanceof qt&&t._bypassWebAudio)||!Ze().webAudioMediaStreamDest))throw new q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof wt&&this.pendingLocalTracks.some(n=>n instanceof wt))throw new q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof qt&&this.pendingLocalTracks.some(n=>n instanceof qt)&&(!Ze().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof qt&&n._bypassWebAudio)))throw new q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!P("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ze().supportDualStreamEncoding,r=Es(Es({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():Py(e,r);const a=Rt(8,"track-low-"),c=new wt(i,Es(Es({},n&&{scaleResolutionDownBy:cv(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,a);return c.on(jc.TRANSCEIVER_UPDATED,d=>{e._updateRtpTransceiver(d,ml.LOW_STREAM)}),c._hints.push(Ot.LOW_STREAM),e.on("sei-to-send",d=>{c.emit("sei-to-send",d)}),e.addListener(fe.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Mo){var i,a,c,d;const u=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:p,dtlsTransportState:f,peerConnectionState:m}=this.connection,{local:E,remote:S}=await this.connection.getSelectedCandidatePair();ye.pcStats(this.store.sessionId,{startTime:u,eventElapse:e-u||0,iceconnectionsate:p,dtlsstate:f,connectionstate:m,intSucc:t?1:2,error:r,selectedLocalCandidateProtocol:(i=E==null?void 0:E.protocol)!==null&&i!==void 0?i:"",selectedLocalCandidateType:(a=E.candidateType)!==null&&a!==void 0?a:"",selectedLocalCandidateAddress:"".concat(E.address,":").concat(E.port),selectedRemoteCandidateProtocol:(c=S.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(d=S.candidateType)!==null&&d!==void 0?d:"",selectedRemoteCandidateAddress:"".concat(S.address,":").concat(S.port),restartCnt:n})}}reportVideoFirstFrameDecoded(e,t,n,r){var i;const a=Array.from(ni(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===e);if(a){r||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,d=c.subscribe.find(u=>u.userId===a.uid&&u.type==="video");ye.firstRemoteVideoDecode(this.store.sessionId,Nn.FIRST_VIDEO_DECODE,Bt.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:t,videoheight:n,subscribeElapse:Qn.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(d==null?void 0:d.subscribeEnd)||0,subscriberStart:(d==null?void 0:d.subscribeStart)||0,videoAddNotify:(d==null?void 0:d.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const a=await this.connection.getRemoteSSRC(i);return a!==void 0&&a!==n}resetConnection(e){T.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(e)),this.state===ut.Connected?(T.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=e===L1.datachannel?new La({},this.store):this.isPlanB?new wl({},this.store):new Mo({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ne.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,ml.LOW_STREAM):n._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof Mo&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===Ps.TCP_RESTART&&e===or.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,Ps.DISCONNECTED_OR_FAILED)))}},se(Ge.prototype,"startP2PConnection",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"startP2PConnection"),Ge.prototype),se(Ge.prototype,"connect",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"connect"),Ge.prototype),se(Ge.prototype,"updateRemoteRTPCapabilities",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"updateRemoteRTPCapabilities"),Ge.prototype),se(Ge.prototype,"preConnect",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"preConnect"),Ge.prototype),se(Ge.prototype,"publishDataChannel",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"publishDataChannel"),Ge.prototype),se(Ge.prototype,"unpublish",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"unpublish"),Ge.prototype),se(Ge.prototype,"unpublishDataChannel",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"unpublishDataChannel"),Ge.prototype),se(Ge.prototype,"unpublishLowStream",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"unpublishLowStream"),Ge.prototype),se(Ge.prototype,"subscribeDataChannel",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"subscribeDataChannel"),Ge.prototype),se(Ge.prototype,"subscribe",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"subscribe"),Ge.prototype),se(Ge.prototype,"massSubscribe",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"massSubscribe"),Ge.prototype),se(Ge.prototype,"unsubscribe",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"unsubscribe"),Ge.prototype),se(Ge.prototype,"unsubscribeDataChannel",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"unsubscribeDataChannel"),Ge.prototype),se(Ge.prototype,"massUnsubscribe",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"massUnsubscribe"),Ge.prototype),se(Ge.prototype,"muteRemote",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"muteRemote"),Ge.prototype),se(Ge.prototype,"unmuteRemote",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"unmuteRemote"),Ge.prototype),se(Ge.prototype,"hasRemoteMediaWithLock",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"hasRemoteMediaWithLock"),Ge.prototype),se(Ge.prototype,"disconnectForReconnect",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"disconnectForReconnect"),Ge.prototype),se(Ge.prototype,"updateBitrateLimit",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"updateBitrateLimit"),Ge.prototype),se(Ge.prototype,"remoteMediaSsrcChanged",[tr],Object.getOwnPropertyDescriptor(Ge.prototype,"remoteMediaSsrcChanged"),Ge.prototype),Ge);function tr(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,a=await i.lock("From P2PChannel.".concat(t));try{for(var c=arguments.length,d=new Array(c),u=0;u<c;u++)d[u]=arguments[u];return await r.apply(this,d)}finally{a()}},n}function DX(e){let t=K2();return function(n,r){let i=n.appId;i!==void 0&&(pt(r,10),gs(r,i));let a=n.cid;a!==void 0&&(pt(r,16),pt(r,a));let c=n.cname;c!==void 0&&(pt(r,26),gs(r,c));let d=n.deviceId;d!==void 0&&(pt(r,34),gs(r,d));let u=n.elapse;u!==void 0&&(pt(r,40),ka(r,u));let p=n.fileSize;p!==void 0&&(pt(r,48),ka(r,Al(p)));let f=n.height;f!==void 0&&(pt(r,56),ka(r,Al(f)));let m=n.jpg;m!==void 0&&(pt(r,66),pt(r,m.length),function(lo,$){let oe=bl(lo,$.length);lo.bytes.set($,oe)}(r,m));let E=n.networkType;E!==void 0&&(pt(r,72),ka(r,Al(E)));let S=n.osType;S!==void 0&&(pt(r,80),ka(r,Al(S)));let I=n.requestId;I!==void 0&&(pt(r,90),gs(r,I));let v=n.sdkVersion;v!==void 0&&(pt(r,98),gs(r,v));let y=n.sequence;y!==void 0&&(pt(r,104),ka(r,Al(y)));let A=n.sid;A!==void 0&&(pt(r,114),gs(r,A));let N=n.timestamp;N!==void 0&&(pt(r,120),ka(r,N));let V=n.uid;V!==void 0&&(pt(r,128),pt(r,V));let F=n.vid;F!==void 0&&(pt(r,136),pt(r,F));let G=n.width;G!==void 0&&(pt(r,144),ka(r,Al(G)));let z=n.service;z!==void 0&&(pt(r,152),pt(r,z));let Q=n.callbackData;Q!==void 0&&(pt(r,162),gs(r,Q));let Z=n.jpgEncryption;Z!==void 0&&(pt(r,168),pt(r,Z));let ee=n.requestType;ee!==void 0&&(pt(r,176),pt(r,ee));let me=n.scorePorn;me!==void 0&&(pt(r,185),Gy(r,me));let Qe=n.scoreSexy;Qe!==void 0&&(pt(r,193),Gy(r,Qe));let ct=n.scoreNeutral;ct!==void 0&&(pt(r,201),Gy(r,ct));let Nt=n.scene;Nt!==void 0&&(pt(r,208),pt(r,Nt));let cn=n.ossFilePrefix;cn!==void 0&&(pt(r,218),gs(r,cn));let Wt=n.serviceVendor;if(Wt!==void 0)for(let lo of Wt){pt(r,226);let $=K2();kX(lo,$),pt(r,$.limit),VX(r,$),UX($)}}(e,t),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(t)}function PX(e){return function(n){let r={};e:for(;!z2(n);){let i=Ss(n);switch(i>>>3){case 0:break e;case 1:r.code=Ss(n);break;case 2:r.msg=Y2(n,Ss(n));break;case 3:{let a=MX(n);r.data=LX(n),n.limit=a;break}default:W2(n,7&i)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function LX(e){let t={};e:for(;!z2(e);){let n=Ss(e);switch(n>>>3){case 0:break e;case 1:t.requestId=Y2(e,Ss(e));break;case 2:t.requestType=Ss(e)>>>0;break;case 3:t.scorePorn=By(e);break;case 4:t.scoreSexy=By(e);break;case 5:t.scoreNeutral=By(e);break;case 6:t.requestScene=Ss(e)>>>0;break;case 7:t.scene=Ss(e)>>>0;break;default:W2(e,7&n)}}return t}function kX(e,t){let n=e.service;n!==void 0&&(pt(t,8),pt(t,n));let r=e.vendor;r!==void 0&&(pt(t,16),pt(t,r));let i=e.token;i!==void 0&&(pt(t,26),gs(t,i));let a=e.callbackUrl;a!==void 0&&(pt(t,34),gs(t,a))}function MX(e){let t=Ss(e),n=e.limit;return e.limit=e.offset+t,n}function W2(e,t){switch(t){case 0:for(;128&q2(e););break;case 2:jy(e,Ss(e));break;case 5:jy(e,4);break;case 1:jy(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let xX=new Float32Array(1);new Uint8Array(xX.buffer);let Vy=new Float64Array(1),kr=new Uint8Array(Vy.buffer);function Al(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let H2=[];function K2(){const e=H2.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function UX(e){H2.push(e)}function jy(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function z2(e){return e.offset>=e.limit}function bl(e,t){let n=e.bytes,r=e.offset,i=e.limit,a=r+t;if(a>n.length){let c=new Uint8Array(2*a);c.set(n),e.bytes=c}return e.offset=a,a>i&&(e.limit=a),r}function Fy(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function Y2(e,t){let n=Fy(e,t),r=String.fromCharCode,i=e.bytes,a="�",c="";for(let d=0;d<t;d++){let u,p,f,m,E=i[d+n];128&E?(224&E)==192?d+1>=t?c+=a:(u=i[d+n+1],(192&u)!=128?c+=a:(m=(31&E)<<6|63&u,m<128?c+=a:(c+=r(m),d++))):(240&E)==224?d+2>=t?c+=a:(u=i[d+n+1],p=i[d+n+2],(49344&(u|p<<8))!=32896?c+=a:(m=(15&E)<<12|(63&u)<<6|63&p,m<2048||m>=55296&&m<=57343?c+=a:(c+=r(m),d+=2))):(248&E)==240?d+3>=t?c+=a:(u=i[d+n+1],p=i[d+n+2],f=i[d+n+3],(12632256&(u|p<<8|f<<16))!=8421504?c+=a:(m=(7&E)<<18|(63&u)<<12|(63&p)<<6|63&f,m<65536||m>1114111?c+=a:(m-=65536,c+=r(55296+(m>>10),56320+(1023&m)),d+=3))):c+=a:c+=r(E)}return c}function gs(e,t){let n=t.length,r=0;for(let c=0;c<n;c++){let d=t.charCodeAt(c);d>=55296&&d<=56319&&c+1<n&&(d=(d<<10)+t.charCodeAt(++c)-56613888),r+=d<128?1:d<2048?2:d<65536?3:4}pt(e,r);let i=bl(e,r),a=e.bytes;for(let c=0;c<n;c++){let d=t.charCodeAt(c);d>=55296&&d<=56319&&c+1<n&&(d=(d<<10)+t.charCodeAt(++c)-56613888),d<128?a[i++]=d:(d<2048?a[i++]=d>>6&31|192:(d<65536?a[i++]=d>>12&15|224:(a[i++]=d>>18&7|240,a[i++]=d>>12&63|128),a[i++]=d>>6&63|128),a[i++]=63&d|128)}}function VX(e,t){let n=bl(e,t.limit),r=e.bytes,i=t.bytes;for(let a=0,c=t.limit;a<c;a++)r[a+n]=i[a]}function q2(e){return e.bytes[Fy(e,1)]}function J2(e,t){let n=bl(e,1);e.bytes[n]=t}function By(e){let t=Fy(e,8),n=e.bytes;return kr[0]=n[t++],kr[1]=n[t++],kr[2]=n[t++],kr[3]=n[t++],kr[4]=n[t++],kr[5]=n[t++],kr[6]=n[t++],kr[7]=n[t++],Vy[0]}function Gy(e,t){let n=bl(e,8),r=e.bytes;Vy[0]=t,r[n++]=kr[0],r[n++]=kr[1],r[n++]=kr[2],r[n++]=kr[3],r[n++]=kr[4],r[n++]=kr[5],r[n++]=kr[6],r[n++]=kr[7]}function Ss(e){let t,n=0,r=0;do t=q2(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function pt(e,t){for(t>>>=0;t>=128;)J2(e,127&t|128),t>>>=7;J2(e,t)}function ka(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,a=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,c=bl(e,a),d=e.bytes;switch(a){case 10:d[c+9]=i>>>7&1;case 9:d[c+8]=a!==9?128|i:127&i;case 8:d[c+7]=a!==8?r>>>21|128:r>>>21&127;case 7:d[c+6]=a!==7?r>>>14|128:r>>>14&127;case 6:d[c+5]=a!==6?r>>>7|128:r>>>7&127;case 5:d[c+4]=a!==5?128|r:127&r;case 4:d[c+3]=a!==4?n>>>21|128:n>>>21&127;case 3:d[c+2]=a!==3?n>>>14|128:n>>>14&127;case 2:d[c+1]=a!==2?n>>>7|128:n>>>7&127;case 1:d[c]=a!==1?128|n:127&n}}function X2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}const jX=new Map([["moderation",1],["supervise",2]]);class f_ extends xt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Pn.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=vo(n=t.map(r=>jX.get(r)||0)).call(n,(r,i)=>r+i),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),w(this,"name","AgoraRTCVideoContentInspect"),w(this,"_connectionState",Yi.CONNECTING),w(this,"_innerConnectionState",void 0),w(this,"sequence",0),w(this,"inspectStartTime",void 0),w(this,"workerManagerConnection",void 0),w(this,"workerConnection",void 0),w(this,"workerMessageLengthLimit",void 0),w(this,"inspectIntervalMinimum",void 0),w(this,"qualityRatio",void 0),w(this,"_connectInfo",void 0),w(this,"_cancelTokenSource",yr.CancelToken.source()),w(this,"_retryConfig",void 0),w(this,"wmSequence",0),w(this,"inspectInterval",void 0),w(this,"inspectTimer",null),w(this,"ossFilePrefix",void 0),w(this,"extraInfo",void 0),w(this,"_inspectType",void 0),w(this,"_inspectMode",void 0),w(this,"_quality",1),w(this,"qualityTimer",null),w(this,"_inspectId",void 0),w(this,"_needWorkUrlOnly",!1),w(this,"inspectImage",()=>{if(this.connectionState!==Yi.CONNECTED)throw new B(O.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Yi.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Rt(5,"inspect-"),this.workerMessageLengthLimit=P("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=P("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=P("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new rh("worker-manager-"+this._inspectId,on),this.on(Pn.STATE_CHANGE,(n,r)=>{this._innerConnectionState=n,T.debug("[".concat(this._inspectId,"] Inspect operation :").concat(qi[n]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new rh("worker-"+this._inspectId,on),this.handleWorkerEvents()}async init(t,n){this.emit(Pn.STATE_CHANGE,qi.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new ae((i,a)=>{this.on(Pn.CONNECTION_STATE_CHANGE,(c,d)=>{d===Yi.CONNECTED&&i()}),this.requestAP(t,r,n).then(c=>{this.connectWorkerManager(c)}).catch(c=>{a(c)})})}async requestAP(t,n,r){const i=P("WEBCS_DOMAIN").map(d=>"https://".concat(d,"/api/v1")),a=await function(d,u,p,f){let{appId:m,areaCode:E,cname:S,sid:I,token:v,uid:y}=u;el++;const A="image_moderation_api",N={service_name:A,json_body:JSON.stringify({appId:m,areaCode:E,cname:S,command:"allocateEdge",requestId:el,seq:el,sid:I,token:v,ts:Date.now(),uid:y+""})};let V,F,G=d[0];return Ro(async()=>{V=Date.now();const z=await bo(G,{data:N,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(F=Date.now()-V,z.code!==0){const me=new B(O.UNEXPECTED_RESPONSE,"image inspect ap error, code"+z.code,{retry:!0,responseTime:F});throw T.error(me.toString()),me}const Q=JSON.parse(z.json_body);if(Q.code!==200){const me=new B(O.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Q.code,", reason: ").concat(Q.reason),{code:Q.code,responseTime:F});throw T.error(me.toString()),me}if(!Q.servers||!Array.isArray(Q.servers)||Q.servers.length===0){const me=new B(O.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Q.code,responseTime:F});throw T.error(me.toString()),me}const Z=P("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ee=P("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Q.servers.map(me=>{let{address:Qe,wss:ct}=me;if(Qe&&ct)return"wss://".concat(Qe.replace(/\./g,"-"),".").concat(Z,":").concat(ee||ct)}).filter(me=>!!me),workerToken:Q.workerToken,vid:Q.vid,responseTime:F}},(z,Q)=>(ye.apworkerEvent(I,{success:!0,sc:200,serviceName:A,responseDetail:JSON.stringify(z.addressList),firstSuccess:Q===0,responseTime:F,serverIp:d[Q%d.length]}),!1),(z,Q)=>(ye.apworkerEvent(I,{success:!1,sc:z.data&&z.data.code||200,serviceName:A,responseTime:F,serverIp:d[Q%d.length]}),!!(z.code!==O.OPERATION_ABORTED&&z.code!==O.UNEXPECTED_RESPONSE||z.data&&z.data.retry)&&(G=d[(Q+1)%d.length],!0)),f)}(i,t,n,r);this.emit(Pn.STATE_CHANGE,qi.AP_CONNECTED);const{addressList:c}=a;return this.wmSequence++,c}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Pn.STATE_CHANGE,qi.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Le.CONNECTED,async()=>{this.emit(Pn.STATE_CHANGE,qi.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.21.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Le.CLOSED,()=>{this._innerConnectionState<qi.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Le.FAILED,()=>{this._innerConnectionState<qi.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Le.RECONNECTING,()=>{this._innerConnectionState<qi.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Le.ON_MESSAGE,async t=>{this.emit(Pn.STATE_CHANGE,qi.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const r=JSON.parse(t.data);if(r.code!==200)throw T.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new B(O.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&n))throw T.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new B(O.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{const i=P("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,a=n.replace(/:\d+\/?$/,":".concat(i));this.emit(Pn.STATE_CHANGE,qi.CONNECT_WORKER,a),this._needWorkUrlOnly?this.emit(Pn.REQUEST_NEW_WORKER_URL,a):await this.connectWorker(a)}}),this.workerManagerConnection.on(Le.WILL_RECONNECT,(t,n,r)=>{r(t)}),this.workerManagerConnection.on(Le.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(Le.CONNECTED,async()=>{this.emit(Pn.STATE_CHANGE,qi.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Yi.CONNECTED}),this.workerConnection.on(Le.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const r=PX(new Uint8Array(t.data));if(P("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&T.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Pn.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var n;const i={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},a=vo(n=Object.keys(i)).call(n,(d,u)=>i[d]>i[u]?d:u,"porn"),c=Object.keys(i).find(d=>d===a);this.emit(Pn.INSPECT_RESULT,c)}else this.emit(Pn.INSPECT_RESULT,void 0,new B(O.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(Pn.INSPECT_RESULT,void 0,new B(O.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else T.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Pn.INSPECT_RESULT,void 0,new B(O.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Le.CLOSED,()=>{this.connectionState=Yi.CLOSED}),this.workerConnection.on(Le.FAILED,()=>{this.connectionState=Yi.CLOSED}),this.workerConnection.on(Le.RECONNECTING,()=>{this.connectionState=this.connectionState===Yi.CONNECTED?Yi.RECONNECTING:Yi.CONNECTING}),this.workerConnection.on(Le.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this.workerConnection.on(Le.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(Pn.REQUEST_NEW_WORKER_URL,r=>{t([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{n(r)})})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){this.sequence++;const t=Kr(this,Pn.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Pn.INSPECT_RESULT,void 0,new B(O.INVALID_OPERATION,"Only the track being played can be inspected"));const r=await this.generateRequestData(t,n);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(Pn.INSPECT_RESULT,void 0,new B(O.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:r,cname:i,cid:a,vid:c,sid:d,uid:u}=n;const p=Date.now(),f=await t.getCurrentFrameImage("image/jpeg",this.quality),m=await QP(f,r,i),E=this.sequence+"-"+a+"-"+u+"-"+p+"-"+Rt(12,""),S={appId:r,cid:a,cname:i,deviceId:"",elapse:f_.intToLong(Number(p-this.inspectStartTime)),fileSize:m.byteLength,jpgEncryption:2,height:f.height,width:f.width,jpg:m,networkType:6,osType:7,requestId:E,sdkVersion:"4.21.0",sequence:this.sequence,sid:d,timestamp:f_.intToLong(p),uid:u,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete S.callbackData,this.ossFilePrefix===void 0&&delete S.ossFilePrefix;const I=DX(S);if(I.byteLength<this.workerMessageLengthLimit){if(P("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const v=function(y){for(var A=1;A<arguments.length;A++){var N=arguments[A]!=null?arguments[A]:{};A%2?X2(Object(N),!0).forEach(function(V){w(y,V,N[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(N)):X2(Object(N)).forEach(function(V){Object.defineProperty(y,V,Object.getOwnPropertyDescriptor(N,V))})}return y}({},S);delete v.jpg,T.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(v))}return I}{const v=this.quality*this.qualityRatio;return this.quality=v,await this.generateRequestData(t,{appId:r,cname:i,cid:a,vid:c,sid:d,uid:u})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=yr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Yi.CLOSED,this.emit(Pn.STATE_CHANGE,qi.CLOSED)}}function FX(e){let t=function(){const n=WX.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,r){let i=n.appId;i!==void 0&&(an(r,10),Ma(r,i));let a=n.cid;a!==void 0&&(an(r,16),an(r,a));let c=n.cname;c!==void 0&&(an(r,26),Ma(r,c));let d=n.deviceId;d!==void 0&&(an(r,34),Ma(r,d));let u=n.elapse;u!==void 0&&(an(r,40),xa(r,u));let p=n.fileSize;p!==void 0&&(an(r,48),xa(r,Ol(p)));let f=n.height;f!==void 0&&(an(r,56),xa(r,Ol(f)));let m=n.jpg;m!==void 0&&(an(r,66),an(r,m.length),Z2(r,m));let E=n.networkType;E!==void 0&&(an(r,72),xa(r,Ol(E)));let S=n.osType;S!==void 0&&(an(r,80),xa(r,Ol(S)));let I=n.requestId;I!==void 0&&(an(r,90),Ma(r,I));let v=n.sdkVersion;v!==void 0&&(an(r,98),Ma(r,v));let y=n.sequence;y!==void 0&&(an(r,104),xa(r,Ol(y)));let A=n.sid;A!==void 0&&(an(r,114),Ma(r,A));let N=n.timestamp;N!==void 0&&(an(r,120),xa(r,N));let V=n.uid;V!==void 0&&(an(r,128),an(r,V));let F=n.vid;F!==void 0&&(an(r,136),an(r,F));let G=n.width;G!==void 0&&(an(r,144),xa(r,Ol(G)));let z=n.service;z!==void 0&&(an(r,152),an(r,z));let Q=n.callbackData;Q!==void 0&&(an(r,162),an(r,Q.length),Z2(r,Q));let Z=n.ticket;Z!==void 0&&(an(r,170),Ma(r,Z));let ee=n.vendorConfigs;ee!==void 0&&(an(r,178),Ma(r,ee))}(e,t),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(t)}function BX(e){return function(n){let r={};e:for(;!HX(n);){let i=Vh(n);switch(i>>>3){case 0:break e;case 1:r.code=Vh(n);break;case 2:r.msg=$2(n,Vh(n));break;case 3:r.requestId=$2(n,Vh(n));break;case 4:r.timestamp=KX(n,!1);break;default:GX(n,7&i)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function GX(e,t){switch(t){case 0:for(;128&co(e););break;case 2:Wy(e,Vh(e));break;case 5:Wy(e,4);break;case 1:Wy(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Ol(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let WX=[];function Wy(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function HX(e){return e.offset>=e.limit}function m_(e,t){let n=e.bytes,r=e.offset,i=e.limit,a=r+t;if(a>n.length){let c=new Uint8Array(2*a);c.set(n),e.bytes=c}return e.offset=a,a>i&&(e.limit=a),r}function Q2(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function Z2(e,t){let n=m_(e,t.length);e.bytes.set(t,n)}function $2(e,t){let n=Q2(e,t),r=String.fromCharCode,i=e.bytes,a="�",c="";for(let d=0;d<t;d++){let u,p,f,m,E=i[d+n];128&E?(224&E)==192?d+1>=t?c+=a:(u=i[d+n+1],(192&u)!=128?c+=a:(m=(31&E)<<6|63&u,m<128?c+=a:(c+=r(m),d++))):(240&E)==224?d+2>=t?c+=a:(u=i[d+n+1],p=i[d+n+2],(49344&(u|p<<8))!=32896?c+=a:(m=(15&E)<<12|(63&u)<<6|63&p,m<2048||m>=55296&&m<=57343?c+=a:(c+=r(m),d+=2))):(248&E)==240?d+3>=t?c+=a:(u=i[d+n+1],p=i[d+n+2],f=i[d+n+3],(12632256&(u|p<<8|f<<16))!=8421504?c+=a:(m=(7&E)<<18|(63&u)<<12|(63&p)<<6|63&f,m<65536||m>1114111?c+=a:(m-=65536,c+=r(55296+(m>>10),56320+(1023&m)),d+=3))):c+=a:c+=r(E)}return c}function Ma(e,t){let n=t.length,r=0;for(let c=0;c<n;c++){let d=t.charCodeAt(c);d>=55296&&d<=56319&&c+1<n&&(d=(d<<10)+t.charCodeAt(++c)-56613888),r+=d<128?1:d<2048?2:d<65536?3:4}an(e,r);let i=m_(e,r),a=e.bytes;for(let c=0;c<n;c++){let d=t.charCodeAt(c);d>=55296&&d<=56319&&c+1<n&&(d=(d<<10)+t.charCodeAt(++c)-56613888),d<128?a[i++]=d:(d<2048?a[i++]=d>>6&31|192:(d<65536?a[i++]=d>>12&15|224:(a[i++]=d>>18&7|240,a[i++]=d>>12&63|128),a[i++]=d>>6&63|128),a[i++]=63&d|128)}}function co(e){return e.bytes[Q2(e,1)]}function eM(e,t){let n=m_(e,1);e.bytes[n]=t}function Vh(e){let t,n=0,r=0;do t=co(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function an(e,t){for(t>>>=0;t>=128;)eM(e,127&t|128),t>>>=7;eM(e,t)}function KX(e,t){let n,r=0,i=0,a=0;return n=co(e),r=127&n,128&n&&(n=co(e),r|=(127&n)<<7,128&n&&(n=co(e),r|=(127&n)<<14,128&n&&(n=co(e),r|=(127&n)<<21,128&n&&(n=co(e),i=127&n,128&n&&(n=co(e),i|=(127&n)<<7,128&n&&(n=co(e),i|=(127&n)<<14,128&n&&(n=co(e),i|=(127&n)<<21,128&n&&(n=co(e),a=127&n,128&n&&(n=co(e),a|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|a<<24,unsigned:t}}function xa(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,a=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,c=m_(e,a),d=e.bytes;switch(a){case 10:d[c+9]=i>>>7&1;case 9:d[c+8]=a!==9?128|i:127&i;case 8:d[c+7]=a!==8?r>>>21|128:r>>>21&127;case 7:d[c+6]=a!==7?r>>>14|128:r>>>14&127;case 6:d[c+5]=a!==6?r>>>7|128:r>>>7&127;case 5:d[c+4]=a!==5?128|r:127&r;case 4:d[c+3]=a!==4?n>>>21|128:n>>>21&127;case 3:d[c+2]=a!==3?n>>>14|128:n>>>14&127;case 2:d[c+1]=a!==2?n>>>7|128:n>>>7&127;case 1:d[c]=a!==1?128|n:127&n}}const tM={},nM={},__=4294967296,zX=__*__,rM=zX/2;oM(0,!0);const iM=oM(0),YX=jh(0,-2147483648,!1),qX=jh(-1,2147483647,!1);function oM(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=nM[e],r)?r:(n=jh(e,0,!0),i&&(nM[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=tM[e],r)?r:(n=jh(e,e<0?-1:0,!1),i&&(tM[e]=n),n)}function jh(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function JX(e,t){if(isNaN(e))return iM;{if(e<=-rM)return YX;if(e+1>=rM)return qX}return e<0?iM:jh(e%__|0,e/__|0,t)}function sM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class Hy extends xt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Io.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),w(this,"name","AgoraRTCImageModeration"),w(this,"_connectionState",wi.CONNECTING),w(this,"_sequence",0),w(this,"_moderationStartTime",void 0),w(this,"_workerConnection",void 0),w(this,"_workerMessageLengthLimit",void 0),w(this,"_qualityRatio",void 0),w(this,"_connectInfo",void 0),w(this,"_cancelTokenSource",yr.CancelToken.source()),w(this,"_retryConfig",void 0),w(this,"_moderationInterval",void 0),w(this,"_moderationTimer",null),w(this,"_moderationMode",1),w(this,"_quality",1),w(this,"_qualityTimer",null),w(this,"_ticket",void 0),w(this,"_moderationIntervalMinimum",void 0),w(this,"_uploadFailedNum",0),w(this,"_uploadNum",0),w(this,"_uploadTimer",null),w(this,"_extraInfo",void 0),w(this,"_vendor",""),w(this,"_encoder",new TextEncoder),w(this,"_moderationId",void 0),w(this,"inspectImage",()=>{if(this.connectionState!==wi.CONNECTED)throw new B(O.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===wi.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Rt(5,"image-moderation-"),this._workerMessageLengthLimit=P("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=P("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=P("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new rh("worker-"+this._moderationId,on),this.on(Io.STATE_CHANGE,(r,i)=>{T.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Qd[r]," ").concat(i||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(Io.STATE_CHANGE,Qd.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new ae((i,a)=>{this.on(Io.CONNECTION_STATE_CHANGE,(c,d)=>{c===wi.CONNECTED&&i()}),this.requestAP(t,r,n).then(c=>{this.connectWorker(c)}).catch(c=>{a(c)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),T.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===wi.CONNECTED&&this.inspectImage()}async requestAP(t,n,r){const i=P("WEBCS_DOMAIN").map(u=>"https://".concat(u,"/api/v1")),a=await function(u,p,f,m){let{appId:E,areaCode:S,cname:I,sid:v,token:y,uid:A}=p;el++;const N="moderation_plugin",V={service_name:N,json_body:JSON.stringify({appId:E,areaCode:S,cname:I,command:"allocateEdge",requestId:el,seq:el,sid:v,appToken:y,ts:Date.now(),uid:A+""})};let F,G,z=u[0];return Ro(async()=>{F=Date.now();const Q=await bo(z,{data:V,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(G=Date.now()-F,Q.code!==0){const me=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Q.code,{retry:!0,responseTime:G});throw T.error(me.toString()),me}const Z=JSON.parse(Q.json_body);if(Z.code!==200){const me=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Z.code,", reason: ").concat(Z.reason),{code:Z.code,responseTime:G});throw T.error(me.toString()),me}if(!Z.servers||!Array.isArray(Z.servers)||Z.servers.length===0){const me=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Z.code,responseTime:G});throw T.error(me.toString()),me}if(!Z.servers.some(me=>!!me.wss)){const me=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Z.code,responseTime:G});throw T.error(me.toString()),me}const ee=P("IMAGE_MODERATION_WORKER_HOST");return{addressList:Z.servers.map(me=>{let{address:Qe,wss:ct}=me;if(Qe&&ct)return"wss://".concat(Qe.replace(/\./g,"-"),".").concat(ee,":").concat(ct,"/moderation")}).filter(me=>!!me),workerToken:Z.workerToken,vid:Z.vid,ticket:Z.appTicket,responseTime:G}},(Q,Z)=>(ye.apworkerEvent(v,{success:!0,sc:200,serviceName:N,responseDetail:JSON.stringify(Q.addressList),firstSuccess:Z===0,responseTime:G,serverIp:u[Z%u.length]}),!1),(Q,Z)=>(ye.apworkerEvent(v,{success:!1,sc:Q.data&&Q.data.code||200,serviceName:N,responseTime:G,serverIp:u[Z%u.length]}),!!(Q.code!==O.OPERATION_ABORTED&&Q.code!==O.UNEXPECTED_RESPONSE||Q.data&&Q.data.retry)&&(z=u[(Z+1)%u.length],!0)),m)}(i,t,n,r);this.emit(Io.STATE_CHANGE,Qd.AP_CONNECTED);const{addressList:c,ticket:d}=a;return this._ticket=d,c}async connectWorker(t){this.emit(Io.STATE_CHANGE,Qd.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Le.CONNECTED,async()=>{this.emit(Io.STATE_CHANGE,Qd.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=wi.CONNECTED}),this._workerConnection.on(Le.CLOSED,()=>{this.connectionState=wi.CLOSED}),this._workerConnection.on(Le.FAILED,()=>{this.connectionState=wi.CLOSED}),this._workerConnection.on(Le.RECONNECTING,()=>{this.connectionState=this.connectionState===wi.CONNECTED?wi.RECONNECTING:wi.CONNECTING}),this._workerConnection.on(Le.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=BX(new Uint8Array(t.data));P("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,T.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{ye.reportApiInvoke(this._connectInfo.sid||null,{name:ln.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:Kt.TRACER}).onError(new B(O.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},P("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else T.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Le.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this._workerConnection.on(Le.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Kr(this,Io.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(P("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being played can be inspected"));this._sequence++;const r=await this.generateRequestData(t,n);this._workerConnection.sendMessage(r,!0,!0)}else P("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:r,cname:i,cid:a,vid:c,sid:d,uid:u}=n;const p=Date.now(),f=await t.getCurrentFrameImage("image/jpeg",this.quality),m=await QP(f,r,i),E=this._sequence+"-"+a+"-"+u+"-"+p+"-"+Rt(12,""),S={appId:r,cid:a,cname:i,deviceId:"",elapse:Hy.intToLong(Number(p-this._moderationStartTime)),fileSize:f.buffer.byteLength,height:f.height,width:f.width,jpg:m,networkType:6,osType:7,requestId:E,sdkVersion:"4.21.0",sequence:this._sequence,sid:d,timestamp:JX(p),uid:u,vid:c,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete S.callbackData;const I=FX(S);if(I.byteLength<this._workerMessageLengthLimit){if(P("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const v=function(y){for(var A=1;A<arguments.length;A++){var N=arguments[A]!=null?arguments[A]:{};A%2?sM(Object(N),!0).forEach(function(V){w(y,V,N[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(N)):sM(Object(N)).forEach(function(V){Object.defineProperty(y,V,Object.getOwnPropertyDescriptor(N,V))})}return y}({},S);delete v.jpg,T.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(v))}return I}{const v=this.quality*this._qualityRatio;return this.quality=v,await this.generateRequestData(t,{appId:r,cname:i,cid:a,vid:c,sid:d,uid:u})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=yr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=wi.CLOSED,this.emit(Io.STATE_CHANGE,Qd.CLOSED)}}function aM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function cM(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?aM(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aM(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const XX=Date.now(),QX=20,Ky=new Map,E_=new Map;async function dM(e){const t=Ky.get(e),n=Array.isArray(t)&&t[t.length-1],r=E_.get(e);if(!n)return void(r.isSyncing=!1);const i={uid:n.uid,payload:n.payload};r.firstRecvTs===0&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const a=n.sendTs-r.firstSendTs,c=a-(Date.now()-r.firstRecvTs);c>0&&(r.firstRecvTs=Date.now()-a);let d=n.mediaDelay+c;d<=0?(t.pop(),lM(n.context,i),d=0):d=Math.min(d,QX),setTimeout(()=>t.length&&dM(e),d)}function lM(e,t){e.safeEmit(Je.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function ZX(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return lM(n,{uid:e.uid,payload:e.payload});const r="".concat(n.id,"-").concat(e.uid),i=Ky.get(r)||[],a=i.findIndex(p=>e.sendTs>=p.sendTs),c=cM(cM({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});a===-1?i.push(c):i.splice(a,0,c),Ky.set(r,i);let d=!1;var u;E_.has(r)?d=!((u=E_.get(r))===null||u===void 0||!u.isSyncing):E_.set(r,{isSyncing:d,firstRecvTs:0,firstSendTs:0}),d||dM(r)}const $X=tt().name;function uM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function hM(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?uM(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uM(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const Nl="websdk_ng_cache_parameter",eQ=P("MAX_PRELOAD_ASYNC_LENGTH"),tQ=1e4,qc=new Map,Jc=[];let zy=null,Yy=0,qy=0;const g_=new Map,nQ=function(e,t){const n=[];let r=0;const i=async()=>{const a=n.shift();a&&await a(),n.length>0&&r<t?i():r--};return async function(){for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];return new ae(async(u,p)=>{n.push(async()=>{try{const f=await e(...c);u(f)}catch(f){p(f)}}),r<t&&(r++,i())})}}(pM,eQ),Jy=yr.CancelToken.source();async function pM(e,t,n,r,i){try{if(!P("ENABLE_PRELOAD"))return;if(!Ze().supportWebCrypto)return void pa(()=>{T.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new q(O.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Mn(n,"token",1,2047),Mn(e,"appid",1,2047),um(t),r&&hm(r);const a=Zu();T.debug("preload channel ".concat(t,", uid is ").concat(r));const c={appId:e,cname:t,token:n||e,uid:typeof r!="string"?r:null,sid:a,proxyServer:i};let d,u;typeof r=="string"?(c.stringUid=r,[u,d]=await ae.all([CY(r,{sid:a,appId:e},Jy.token),oD(hM(hM({},c),{},{token:n||e,uid:0}),Jy.token)]),c.uid=u.uid,d.gatewayInfo.uid=c.uid,d.gatewayInfo.res.uid=c.uid):d=await oD(c,Jy.token);const p={sid:a,appId:e,cname:t,token:n||e,uid:c.stringUid||r,intUid:c.uid||d.gatewayInfo.uid,stringUid:c.stringUid,ts:Date.now(),sua:u,ap:d};await async function(f){let m;try{f.uid&&mM({appId:f.appId,cname:f.cname,token:f.token,uid:f.uid,stringUid:f.stringUid});const E=SM(f),S=await async function(v,y){try{const A=await window.crypto.subtle.importKey("raw",d1(y),"AES-GCM",!1,["encrypt"]),N=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},A,Rc(window.btoa(JSON.stringify(v))));return fa(new Uint8Array(N))}catch{return}}(f,f.token||f.appId);if(!S)return;m=gM(Nl);const I=m?JSON.parse(m):[];I.push({[E]:S}),I.length>P("AP_CACHE_NUM")&&I.shift(),S_(Nl,JSON.stringify(I))}catch(E){T.warn("Error caching server parameters:",E.message),S_(Nl,"")}}(p),Yy++}catch(a){throw qy++,function(c){zy||(zy=window.setTimeout(()=>{let u="";g_.forEach((p,f)=>{u+="".concat(f,": ").concat(p," ;")}),ye.reportApiInvoke(null,{name:ln.PRELOAD,options:{success:Yy,failed:qy,err:u}}).onError(c),Yy=0,qy=0,g_.clear(),zy=null},tQ));const d=g_.get(c.code)||0;g_.set(c.code,d+1)}(a),a}}async function fM(e){try{const t=mM(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await async function(r,i){try{const a=await window.crypto.subtle.importKey("raw",d1(i),"AES-GCM",!1,["decrypt"]),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},a,Rc(r));return JSON.parse(window.atob(fa(new Uint8Array(c))))}catch{return}}(t,e.token||e.appId);if(!n||!function(r,i){return r.cname===i.cname&&r.appId===i.appId&&r.token===i.token?i.stringUid?r.stringUid===i.stringUid:typeof i.uid=="number"?r.uid===i.uid:r.uid==i.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<P("AP_CACHE_LIFETIME"))return n}catch(t){T.warn("Error get preloadInfo",t.message)}}function mM(e){let t;try{if(t=gM(Nl),!t)return;const n=JSON.parse(t),r=SM(e),i=function(c,d){for(let u=c.length-1;u>=0;u--)if(d(c[u]))return u;return-1}(n,c=>r in c);if(i===-1)return;const a=n.splice(i,1)[0];return S_(Nl,JSON.stringify(n)),a[r]}catch(n){T.warn("Error delete preload info: ".concat(t),n.message),S_(Nl,"")}}function Xy(e){if(e){let t=qc.get(e);t&&(window.clearTimeout(t),t=null,qc.delete(e)),le(Jc).call(Jc,e)||e.cloudProxyServer!=="disabled"||Jc.push(e)}if(qc.size<P("AP_CACHE_NUM")&&Jc.length>0){const t=Jc.shift();qc.set(t,window.setTimeout(async()=>{const{appId:n,cname:r,token:i,uid:a,proxyServer:c}=t;try{await nQ(n,r,i,a,c),qc.has(t)&&Xy(t)}catch(d){T.warn("update preload failed",d.message),_M(t)}},P("AP_UPDATE_INTERVAL")))}}function _M(e){const t=Jc.indexOf(e);t!==-1&&Jc.splice(t,1);let n=qc.get(e);n&&(window.clearTimeout(n),n=null,qc.delete(e),Xy())}function EM(e,t){const n=e.sua,r=e.ap;t&&n&&ye.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),ye.reportResourceTiming(e.ap.url,e.sid),ye.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(i=>i.ip).join(","),eventType:"disabled",unilbsServerIds:[sn.CHOOSE_SERVER,sn.CLOUD_PROXY_FALLBACK].toString()}),ye.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(i=>i.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[sn.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function gM(e){return window.atob(window.localStorage.getItem(e)||"")}function S_(e,t){window.localStorage.setItem(e,window.btoa(t))}function SM(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),_1(t)}var TM,vM,yM,CM,RM,wM,IM,AM,bM,OM,NM,DM,PM,LM,kM,MM,xM,UM,VM,jM,FM,BM,GM,WM,HM,KM,zM,YM,qM,JM,XM,QM,ZM,$M,ex,tx,nx,rx,ix,ox,sx,ax,ue;function cx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Di(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?cx(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cx(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}On.setLogger(T);let rQ=(TM=be(),vM=be({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof gl))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),yM=be({argsMap:(e,t)=>(t||(t=[]),t instanceof Dk?[t.getChannelId()]:(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())))}),CM=be({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),RM=be({argsMap:(e,t,n)=>[t,n]}),wM=be({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:i}=n;return[r==null?void 0:r.uid,i]})}),IM=be({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),AM=be({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:i}=n;return{uid:r==null?void 0:r.uid,mediaType:i}})}),bM=be(),OM=be(),NM=be(),DM=be(),PM=be(),LM=be(),kM=be(),MM=be(),xM=be(),UM=be(),VM=be(),jM=be(),FM=be(),BM=be(),GM=be({argsMap:(e,t)=>[t]}),WM=be(),HM=be(),KM=be(),zM=be(),YM=be(),qM=be(),JM=be(),XM=be(),QM=be(),ZM=be(),$M=be({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),ex=be(),tx=be(),nx=be(),rx=be(),ix=be(),ox=be(),sx=be({reportResult:!0}),ax=be(),ue=class extends xt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),w(this,"store",void 0),w(this,"_uid",void 0),w(this,"_channelName",void 0),w(this,"_uintUid",void 0),w(this,"_users",[]),w(this,"_config",void 0),w(this,"_clientId",void 0),w(this,"_appId",void 0),w(this,"_sessionId",null),w(this,"_key",void 0),w(this,"_rtmConfig",{}),w(this,"_joinInfo",void 0),w(this,"_gateway",void 0),w(this,"_statsCollector",void 0),w(this,"_configDistribute",void 0),w(this,"_leaveMutex",new On("client-leave")),w(this,"_publishMutex",new On("client-publish")),w(this,"_renewTokenMutex",new On("client-renewtoken")),w(this,"_subscribeMutex",new On("client-subscribe")),w(this,"_encryptionMode","none"),w(this,"_encryptionSecret",null),w(this,"_encryptionSalt",null),w(this,"_encryptDataStream",!1),w(this,"_encryptDataStreamKey",null),w(this,"_encryptDataStreamIv",null),w(this,"_proxyServer",void 0),w(this,"_turnServer",{servers:[],mode:"auto"}),w(this,"_cloudProxyServerMode","disabled"),w(this,"_isDualStreamEnabled",!1),w(this,"_defaultStreamFallbackType",void 0),w(this,"_lowStreamParameter",void 0),w(this,"_streamFallbackTypeCacheMap",new Map),w(this,"_remoteStreamTypeCacheMap",new Map),w(this,"_axiosCancelSource",yr.CancelToken.source()),w(this,"_audioVolumeIndicationInterval",void 0),w(this,"_networkQualityInterval",void 0),w(this,"_userOfflineTimeout",void 0),w(this,"_streamRemovedTimeout",void 0),w(this,"_injectStreamingClient",void 0),w(this,"_liveTranscodeStreamingClient",void 0),w(this,"_liveRawStreamingClient",void 0),w(this,"_channelMediaRelayClient",void 0),w(this,"_networkQualitySensitivity","normal"),w(this,"_p2pChannel",void 0),w(this,"_useLocalAccessPoint",!1),w(this,"_setLocalAPVersion",void 0),w(this,"_joinAndNotLeaveYet",!1),w(this,"_numberOfJoinCount",0),w(this,"_remoteDefaultVideoStreamType",void 0),w(this,"_inspect",void 0),w(this,"_moderation",void 0),w(this,"_license",void 0),w(this,"_pendingPublishedUsers",[]),w(this,"ntpAlignErrorCount",0),w(this,"remoteInboundOffset",0),w(this,"_handleLocalTrackEnable",(n,r,i)=>{this.publish(n,!1).then(r).catch(i)}),w(this,"_handleLocalTrackDisable",(n,r,i)=>{this.unpublish(n).then(r).catch(i)}),w(this,"_handleUserOnline",n=>{if(P("BLOCK_LOCAL_CLIENT")&&Ic(n.uid,this.channelName))return void T.debug("[".concat(n.uid,"] will be ignored in local"));this.isStringUID&&typeof n.uid!="string"&&T.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const r=this._users.find(i=>i.uid===n.uid);if(r)r._trust_in_room_=!0,r._is_pre_created&&(r._is_pre_created=!1,this.safeEmit(Je.USER_JOINED,r));else{const i=new Na(n.uid,n.uint_id||n.uid);this._users.push(i),T.debug("[".concat(this._clientId,"] user online"),n.uid),this.safeEmit(Je.USER_JOINED,i)}}),w(this,"_handleUserOffline",n=>{if(P("BLOCK_LOCAL_CLIENT")&&Ic(n.uid,this.channelName))return;const r=this._users.find(i=>i.uid===n.uid);r&&(this._handleRemoveStream(n),this._handleRemoveDataChannels(n),r._audio_pre_subscribed||r._video_pre_subscribed?r._is_pre_created=!0:nm(this._users,r),this._remoteStreamTypeCacheMap.delete(r.uid),this._streamFallbackTypeCacheMap.delete(r.uid),T.debug("[".concat(this._clientId,"] user offline"),n.uid,"reason:",n.reason),this.safeEmit(Je.USER_LEAVED,r,n.reason))}),w(this,"_handleAddAudioOrVideoStream",(n,r,i,a,c,d,u)=>{if(P("BLOCK_LOCAL_CLIENT")&&Ic(r,this.channelName))return;const p=this._users.find(m=>m.uid===r);if(!p)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(n)),this.store.subscribe(p.uid,n,void 0,void 0,void 0,Date.now());const f=n==="audio"?p.hasAudio:p.hasVideo;p._uintid||(p._uintid=c||r),n==="audio"?p._trust_audio_stream_added_state_=!0:p._trust_video_stream_added_state_=!0,n==="audio"?(p._audio_added_=!0,i!==void 0&&(p._audioSSRC=i),a!==void 0&&(p._cname=a),d&&(p._audioOrtc=d)):(p._video_added_=!0,i!==void 0&&(p._videoSSRC=i),a!==void 0&&(p._cname=a),u!==void 0&&(p._rtxSsrcId=u),d&&(p._videoOrtc=d)),(n==="audio"?p.hasAudio:p.hasVideo)&&!f&&(T.info("[".concat(this._clientId,"] remote user ").concat(p.uid," published ").concat(n)),this.safeEmit(Je.USER_PUBLISHED,p,n)),n==="video"?ye.onGatewayStream(this._sessionId,Nn.ON_ADD_VIDEO_STREAM,Bt.ON_ADD_VIDEO_STREAM,{peer:c||r,ssrc:p._videoSSRC}):ye.onGatewayStream(this._sessionId,Nn.ON_ADD_AUDIO_STREAM,Bt.ON_ADD_AUDIO_STREAM,{peer:c||r,ssrc:p._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(p,n,i).then(m=>{if(m&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(p.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof p_))return this._p2pChannel.unsubscribe(p,n,!0).then(()=>this._subscribe(p,n,!0).catch(E=>{T.error("[".concat(this._clientId,"] resubscribe error"),E.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(p,n)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(p.uid," after reconnect.")),this._subscribe(p,n,!0).catch(m=>{T.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),w(this,"_handleRemoveStream",n=>{if(P("BLOCK_LOCAL_CLIENT")&&Ic(n.uid,this.channelName))return;const r=this._users.find(a=>a.uid===n.uid);if(!r)return void T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));T.debug("[".concat(this._clientId,"] stream removed with uid ").concat(n.uid));let i=()=>{};r.hasAudio&&r.hasVideo?i=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(Je.USER_UNPUBLISHED,r,"audio"),T.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(Je.USER_UNPUBLISHED,r,"video")}:r.hasVideo?i=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(Je.USER_UNPUBLISHED,r,"video")}:r.hasAudio&&(i=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(Je.USER_UNPUBLISHED,r,"audio")}),r._video_pre_subscribed||r._audio_pre_subscribed||(r._trust_audio_stream_added_state_=!0,r._trust_video_stream_added_state_=!0,r._audio_added_=!1,r._video_added_=!1,this._p2pChannel instanceof p_&&this._p2pChannel.unsubscribe(r).then(a=>{if(a)return this._gateway.unsubscribe(a,r.uid)}),r._audioSSRC=void 0,r._videoSSRC=void 0,r._audioOrtc=void 0,r._videoOrtc=void 0,r._rtxSsrcId=void 0),ye.onGatewayStream(this._sessionId,Nn.ON_REMOVE_STREAM,Bt.ON_REMOVE_STREAM,{peer:n.uint_id||n.uid}),i()}),w(this,"_handleSetStreamLocalEnable",(n,r,i)=>{if(P("BLOCK_LOCAL_CLIENT")&&Ic(r,this.channelName))return;const a=this._users.find(u=>u.uid===r);if(!a)return void T.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));T.debug("[".concat(this._clientId,"] local ").concat(n," ").concat(i?"enabled":"disabled"," with uid ").concat(r));const c=n==="audio"?a.hasAudio:a.hasVideo;if(n==="audio"){a._trust_audio_enabled_state_=!0;const u=a._audio_enabled_;if(a._audio_enabled_=i,a._audio_enabled_===u)return;{const p=a._audio_enabled_?"enable-local-audio":"disable-local-audio";T.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(r,", msg: ").concat(p)),this.safeEmit(Je.USER_INFO_UPDATED,r,p)}}else{a._trust_video_enabled_state_=!0;const u=a._video_enabled_;if(a._video_enabled_=i,a._video_enabled_===u)return;{const p=a._video_enabled_?"enable-local-video":"disable-local-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(p)),this.safeEmit(Je.USER_INFO_UPDATED,r,p)}}const d=n==="audio"?a.hasAudio:a.hasVideo;return c!==d?!c&&d?(T.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(n)),void this.safeEmit(Je.USER_PUBLISHED,a,n)):(n==="video"&&a._videoTrack&&a._videoTrack._destroy(),n==="audio"&&a._audioTrack,this._p2pChannel.muteRemote(a,n),T.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(n)),void this.safeEmit(Je.USER_UNPUBLISHED,a,n)):void 0}),w(this,"_handleMuteStream",(n,r,i)=>{if(P("BLOCK_LOCAL_CLIENT")&&Ic(n,this.channelName))return;T.debug("[".concat(this._clientId,"] receive mute message"),n,r,i);const a=this._users.find(u=>u.uid===n);if(!a)return void T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(n));const c=r==="audio"?a.hasAudio:a.hasVideo;if(r==="audio"){a._trust_audio_mute_state_=!0;const u=a._audio_muted_;if(a._audio_muted_=i,a._audio_muted_===u)return;{const p=a._audio_muted_?"mute-audio":"unmute-audio";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(p)),this.safeEmit(Je.USER_INFO_UPDATED,n,p)}}else{a._trust_video_mute_state_=!0;const u=a._video_muted_;if(a._video_muted_=i,a._video_muted_===u)return;{const p=a._video_muted_?"mute-video":"unmute-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(p)),this.safeEmit(Je.USER_INFO_UPDATED,n,p)}}const d=r==="audio"?a.hasAudio:a.hasVideo;if(c!==d){if(!c&&d)return(r==="audio"?a._audioSSRC:a._videoSSRC)?(T.info("[".concat(this._clientId,"] remote user ").concat(n," published ").concat(r)),void this.safeEmit(Je.USER_PUBLISHED,a,r)):void T.warning("[".concat(this._clientId,"] remote user ").concat(n," receive ").concat(r," unmute message  before add stream message, ").concat(r," SSRC doesn't exist yet."));r==="video"&&a._videoTrack&&!a._video_pre_subscribed&&a._videoTrack._destroy(),r==="audio"&&a._audioTrack,this._p2pChannel.muteRemote(a,r),T.info("[".concat(this._clientId,"] remote user ").concat(n," unpublished ").concat(r)),this.safeEmit(Je.USER_UNPUBLISHED,a,r)}}),w(this,"_handleP2PLost",async n=>{T.debug("[".concat(this._clientId,"] receive p2p lost"),n),parseInt(n.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():T.warning("[".concat(this._clientId,"] P2PLost stream not found"),n)}),w(this,"_handleTokenWillExpire",()=>{T.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Je.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),w(this,"_handleBeforeUnload",n=>{n.type==="beforeunload"&&n.returnValue!==void 0&&n.returnValue!==""||(this.leave(),T.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),w(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Je.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const n={downlinkNetworkQuality:0,uplinkNetworkQuality:0};n.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),n.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Je.NETWORK_QUALITY,n)}),w(this,"_handleP2PAddAudioOrVideoStream",(n,r,i,a)=>{const c=this._users.find(u=>u.uid===r);if(!c)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(n)),this.store.subscribe(c.uid,n,void 0,void 0,void 0,Date.now());const d=n==="audio"?c.hasAudio:c.hasVideo;n==="audio"?c._trust_audio_stream_added_state_=!0:c._trust_video_stream_added_state_=!0,n==="audio"?(c._audio_added_=!0,i!==void 0&&(c._audioSSRC=i),a!==void 0&&(c._audioMid=a)):(c._video_added_=!0,i!==void 0&&(c._videoSSRC=i),a!==void 0&&(c._videoMid=a)),(n==="audio"?c.hasAudio:c.hasVideo)&&!d&&(T.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published ").concat(n)),this.safeEmit(Je.USER_PUBLISHED,c,n)),this._p2pChannel.hasPendingRemoteMedia(c,n)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(c.uid," after reconnect.")),this._subscribe(c,n,!0).catch(u=>{T.error("[".concat(this._clientId,"] resubscribe error"),u.toString())}))}),this._config=e,this._clientId=Rt(5,"client-"),this.store=new az(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),T.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Ci," build: ").concat(JT,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{a1(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(n){T.warning("[".concat(this._clientId,"] ").concat(n.toString()))}this._statsCollector=new Mh(this.store),this._statsCollector.onStatsException=(n,r,i)=>{T.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(n,", msg: ").concat(r,", uid: ").concat(i)),this.safeEmit(Je.EXCEPTION,{code:n,msg:r,uid:i})},this._statsCollector.onUploadPublishDuration=(n,r,i,a)=>{const c=this._users.find(d=>d.uid===n);c&&ye.peerPublishStatus(this._sessionId,{subscribeElapse:a,audioPublishDuration:r,videoPublishDuration:i,peer:c._uintid})},this.store.useDataChannel=Ze().supportDataChannel&&P("SIGNAL_CHANNEL"),this.store.useP2P=e.mode==="p2p",this._gateway=new EY(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||on,httpRetryConfig:e.httpRetryConfig||on,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new AY,this.store.useP2P?(this._p2pChannel=new qr(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new p_(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,i){let a=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],c=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Tt("JOIN_GATEWAY_USE_443PORT_ONLY",a),Tt("JOIN_GATEWAY_USE_DUAL_DOMAIN",c);const d=this._gateway.signal.websocket;return d instanceof nh&&(d.use443PortOnly=a,d.tryDoubleDomain=c),async function(u,p,f){Qf.get(u)||Qf.set(u,[]),Zf.get(u)||Zf.set(u,p),is.get(u)||is.set(u,0);const m=Qf.get(u),E=Zf.get(u);if(!m||!E)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(is.get(u)===E){const A=qu();m.push(A),await A.promise}is.set(u,is.get(u)+1);for(var S=arguments.length,I=new Array(S>3?S-3:0),v=3;v<S;v++)I[v-3]=arguments[v];const y=await f(...I);return is.set(u,is.get(u)-1),is.get(u)===E-1&&m.length>0&&(m[0].resolve(),m.shift()),is.get(u)===0&&(Qf.set(u,[]),Zf.set(u,0),is.set(u,0)),y}("client.join",P("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,i)}async join(e,t,n,r,i){const a=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const c=(am||am||(am=(window.location.protocol.split(":")[0]||"").toUpperCase(),am))==="HTTPS",d=E1()?window.isSecureContext:"Browser Not Support";(!E1()&&!c||!window.isSecureContext)&&T.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),T.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),ye.setAppId(e);try{if(!n&&n!==null)throw new B(O.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Mn(n,"token",1,2047),Mn(e,"appid",1,2047),um(t),r&&hm(r),i&&Mn(i,"optionalInfo",1,2047)}catch(v){throw ye.reportApiInvoke(Zu(),{name:ln.JOIN,options:[e,t,n,r],states:{isHttps:c,isSecureContext:d},tag:Kt.TRACER}).onError(v),v}const u=await fM({appId:e,cname:t,uid:r,stringUid:typeof r=="string"?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode}),p=(u==null?void 0:u.sid)||Zu(),f=ye.reportApiInvoke(p,{name:ln.JOIN,options:[e,t,n,r],states:{isHttps:c,isSecureContext:d},tag:Kt.TRACER});if(T.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(a)),this._leaveMutex.isLocked&&(T.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),T.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const v=new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw f.onError(v),v}this._sessionId||(this._sessionId=p,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const m=Di(Di({},this._rtmConfig),{},{clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!u},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(m.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(m.stringUid=r,this._uintUid?(m.uid=this._uintUid,this._uintUid=void 0):m.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(m.aesmode=this._encryptionMode,m.aespassword=await(async v=>{const y=function(F){const G=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),z=new Uint8Array(new ArrayBuffer(G.length));for(let Q=0;Q<G.length;Q+=1)z[Q]=G.charCodeAt(Q);return z}(),A=await window.crypto.subtle.importKey("spki",y,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),N=FT(v),V=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},A,N);return function(F){let G="";for(let z=0;z<F.length;z+=1)G+=String.fromCharCode(F[z]);return window.btoa(G)}(new Uint8Array(V))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(m.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const v=new TextEncoder,y=P("USE_PURE_ENCRYPTION_MASTER_KEY")?v.encode(m.appId+this._encryptionSecret+this._encryptionSecret):v.encode(m.appId+m.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(A,N,V){const F=await window.crypto.subtle.importKey("raw",N,"PBKDF2",!1,["deriveBits","deriveKey"]),G=A==="aes-128-gcm2"?128:256,z=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:S1,hash:"SHA-256",salt:V},F,G+cz);return new Uint8Array(z).subarray(G/8)}(this._encryptionMode,y,Rc(this._encryptionSalt)),this._encryptDataStreamKey=await async function(A,N,V){const F=await window.crypto.subtle.importKey("raw",N,"PBKDF2",!1,["deriveBits","deriveKey"]),G=A==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:S1,hash:"SHA-256",salt:V},F,{name:"AES-GCM",length:G},!0,["encrypt","decrypt"])}(this._encryptionMode,y,Rc(this._encryptionSalt))}else d?T.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):T.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,T.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:m.stringUid,preload:m.preload});const E=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&E===this._sessionId&&ye.joinChannelTimeout(this._sessionId,5)},5e3);try{var S;let v;const y=m.cloudProxyServer;if(le(S=["proxy3","proxy4","proxy5"]).call(S,y)){const G=P("PROXY_SERVER_TYPE3");Array.isArray(G)?m.proxyServer=G[0]:m.proxyServer=G}if(ye.setProxyServer(m.proxyServer),T.setProxyServer(m.proxyServer),this.store.requestAPStart(),u){if(T.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(m.stringUid?", ".concat(m.stringUid," => ").concat(u.intUid):""," ")),m.stringUid&&!m.uid&&(m.uid=u.intUid),v={gatewayInfo:u.ap.gatewayInfo},P("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&m.turnServer.mode==="auto")if(u.ap.proxyInfo.addresses.length===0)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const G=(await K1(u.ap.proxyInfo,u.ap.gatewayInfo.uid)).map(z=>({turnServerURL:z.address,tcpport:z.tcpport||Wn.tcpport,udpport:z.udpport||Wn.udpport,username:z.username||Wn.username,password:z.password||Wn.password,forceturn:!1,security:!0}));m.turnServer={mode:"manual",servers:G}}EM(u,m.stringUid)}else{if(m.stringUid&&!m.uid){let G;[G,v]=await ae.all([iD(m.stringUid,m,this._axiosCancelSource.token,this._config.httpRetryConfig||on,this.store),rD(m,this._axiosCancelSource.token,this._config.httpRetryConfig||on,!0,this.store)]),T.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(m.stringUid," => ").concat(G)),m.uid=G,v.gatewayInfo.uid=G,v.gatewayInfo.res.uid=G}else v=await rD(m,this._axiosCancelSource.token,this._config.httpRetryConfig||on,!0,this.store);if(!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(m,this._axiosCancelSource.token),this._configDistribute.on(ov.UPDATE_BITRATE_LIMIT,G=>{this._p2pChannel.updateBitrateLimit(G)})},0),this._key=n||e;const A=v.gatewayInfo,N=m.uid?m.uid:A.uid;this._joinInfo=Di(Di({},m),{},{cid:A.cid,uid:N,vid:A.vid,apResponse:A.res,uni_lbs_ip:A.uni_lbs_ip,gatewayAddrs:A.gatewayAddrs}),this.store.intUid=N;const V=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));f.onSuccess(V),this._appId=e,this._channelName=m.cname,this._uid=V,this.store.uid=V,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Cn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const F=m.stringUid?"string uid: ".concat(m.stringUid,",uid: ").concat(m.uid):"uid: ".concat(this._uid);return T.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(F)),setTimeout(()=>{T.startUpload()},5e3),this.store.joinEnd(),I=this,le(_a).call(_a,I)||_a.push(I),this._cloudProxyServerMode==="disabled"&&Ze().supportWebCrypto&&P("ENABLE_PRELOAD")&&Xy(this._joinInfo),V}catch(v){const y=Array.isArray(v)?v[0]:v;throw y&&y.code===O.OPERATION_ABORTED?T.warning("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),y):T.error("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),y),y.code!==O.OPERATION_ABORTED&&this._numberOfJoinCount===a&&(this._gateway.state="DISCONNECTED",this._reset()),f.onError(y),y}var I}_joinGateway(){if(!this._joinInfo||!this._key)throw new B(O.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!P("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(e=>e).catch(e=>{if(e.code===O.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,qe.FALLBACK),e;if(e.code===O.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,qe.FALLBACK),e;throw e}).then(e=>{if(e instanceof B){if(e.code===O.INIT_WEBSOCKET_TIMEOUT){if(T.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new B(O.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const t=P("PROXY_SERVER_TYPE3");if(Array.isArray(t))if(this._joinInfo.apUrl){const r=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),i=r.slice(r.length-2).join(".");t.forEach(a=>{this._joinInfo&&le(a).call(a,i)&&(this._joinInfo.proxyServer=a)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=t[0])}else this._joinInfo.proxyServer=t[0];else this._joinInfo.proxyServer=t;const n=P("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return n&&n[1]&&n[1]!=="443"&&T.setProxyServer(this._joinInfo.proxyServer),P("STATS_COLLECTOR_PORT").toString()!=="443"&&ye.setProxyServer(this._joinInfo.proxyServer),ye.reportApiInvoke(this._sessionId,{name:ln.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:Kt.TRACER}).onSuccess(),this.safeEmit(Je.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),P("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(r=>{"forceturn"in r&&(r.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(T.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new B(O.INVALID_OPERATION);return ye.reportApiInvoke(this._sessionId,{name:ln.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:Kt.TRACER}).onSuccess(),this._joinGateway()}return e}).then(e=>e)}async leave(){T.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Cn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const n=_a.indexOf(t);n!==-1&&_a.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return T.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED"),T.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof gl))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new B(O.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new B(O.INVALID_OPERATION,"audience can not publish stream");for(const i of n){if(!(i instanceof gl))throw new B(O.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new B(O.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}T.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(i=>{const a=this._configDistribute.getBitrateLimit();i instanceof wt&&a&&i.setBitrateLimit(a.uplink)});try{await this._publishHighStream(n),T.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw T.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{r()}}async _publishDataChannel(e){St(e.id,"id",0,65535,!0),Os(e.ordered,"ordered"),Mn(e.metadata,"metadata",0,512),T.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(r=>r.id===e.id)!==-1)throw new B(O.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&P("FORCE_TURN")&&!P("TURN_ENABLE_TCP")&&!P("TURN_ENABLE_UDP"))throw new B(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=new Dk(e);if(await this._p2pChannel.publishDataChannel([n]),!this._p2pChannel.isP2PDisconnected()){if(typeof n._originDataChannelId!="number")throw T.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new B(O.CREATE_DATACHANNEL_ERROR);try{const r={streamId:e.id,ordered:e.ordered,maxRetransmits:P("DATASTREAM_MAX_RETRANSMITS"),metadata:e.metadata,channelId:n._originDataChannelId};await this._gateway.publishDataChannel(this._uid,r,!0),await n._waitTillOpen()}catch(r){if(r.code!==O.DISCONNECT_P2P)throw r}}return T.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw T.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof gl))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);T.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(r=>"".concat(r.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this._p2pChannel instanceof qr){const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.sendExtensionMessage(Zt.UNPUBLISH,{unpubMsg:r},!0)}else{const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.unpublish(r,this._uid),T.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(i=>"".concat(i.getTrackId()))))}}catch(r){throw T.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),T.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),T.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(r=>"".concat(r.id))))}catch(n){throw T.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof Na)){const r=this.remoteUsers.find(i=>i.uid===e);if(!r)throw new B(O.INVALID_REMOTE_USER,"user is not in the channel");e=r}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(Sn(t,"mediaType",["audio","video"]),this._p2pChannel instanceof qr)throw new B(O.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===Te.AUDIO,r=t===Te.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:a,ortc:c,rtxSsrcId:d,cname:u,uint_id:p}=await this._gateway.presubscribe(e,t,!0);if(a==null)throw new B(O.UNEXPECTED_RESPONSE,"no ssrc id");let f=this._users.find(E=>E.uid===e);f||(f=new Na(e,p||e),f._is_pre_created=!0,this._users.push(f)),u&&(f._cname=u),f._uintid||(f._uintid=p||e),n&&(f._audioSSRC=a,f._audio_pre_subscribed=!0,c&&(f._audioOrtc=c)),r&&(f._videoSSRC=a,f._video_pre_subscribed=!0,c&&(f._videoOrtc=c),d!=null&&(f._rtxSsrcId=d)),T.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(a)),await this._p2pChannel.subscribe(f,t,a,d,c);const m=n?f._audioTrack:f._videoTrack;if(!m)throw new B(O.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(f._trust_audio_stream_added_state_=!0,f._audio_added_=!0),r&&(f._trust_video_stream_added_state_=!0,f._video_added_=!0),m}catch(a){throw T.error("[".concat(this._clientId,"] presub user ").concat(e," error"),a),a}finally{i()}}async _subscribeDataChannel(e,t){var n;if(St(t,"channelId",0,65535,!0),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===e))throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new B(O.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new B(O.INVALID_REMOTE_USER,"user is not published");const i=(n=e._dataChannels)===null||n===void 0?void 0:n.find(d=>d.id===t);if(!i)throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new B(O.REMOTE_USER_IS_NOT_PUBLISHED);const a=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const d=await this._p2pChannel.subscribeDataChannel(e,[i]);if(d&&le(d).call(d,i.id))try{var c;if(typeof i._originDataChannelId!="number")throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new B(O.CREATE_DATACHANNEL_ERROR);const u={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(c=i.metadata)!==null&&c!==void 0?c:""};await this._gateway.subscribeDataChannel(e.uid,u,!0),await i._waitTillOpen()}catch(u){if((u==null?void 0:u.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),u;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return T.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{a()}}async _p2pSubscribe(e,t,n){if(Sn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(a=>a===e)){const a=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),a}if(!e.hasAudio&&!e.hasVideo){const a=new B(O.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),a}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const a=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),a}const i=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const c=t==="audio"?e._audioSSRC:e._videoSSRC,d=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this._p2pChannel instanceof qr&&await this._p2pChannel.subscribe(e,t,c,d)}catch(c){throw c}T.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(c=>{T.warning("[".concat(this._clientId,"] auto set fallback failed"),c)});const a=t==="audio"?e._audioTrack:e._videoTrack;if(!a)throw new B(O.UNEXPECTED_ERROR,"can not find remote track in user object");return a}catch(a){throw T.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),a),a}finally{i()}}async _subscribe(e,t,n){if(this._p2pChannel instanceof qr)return this._p2pSubscribe(e,t);if(Sn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(p=>p===e)){const p=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),p}if(!e.hasAudio&&!e.hasVideo){const p=new B(O.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),p}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const p=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),p}let i=t==="audio"?e._audioSSRC:e._videoSSRC,a=t==="audio"?e._audioOrtc:e._videoOrtc,c=t==="video"?e._rtxSsrcId:void 0,d={stream_type:t==="audio"?Te.AUDIO:Te.VIDEO,ssrcId:i};const u=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const f=t==="audio"?e._audioSSRC:e._videoSSRC;f!==void 0&&f!==i&&(i=f,a=t==="audio"?e._audioOrtc:e._videoOrtc,c=t==="video"?e._rtxSsrcId:void 0,d={stream_type:t==="audio"?Te.AUDIO:Te.VIDEO,ssrcId:i}),Qn.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,c,a);try{await this._gateway.subscribe(e.uid,d,!0)}catch(m){if((m==null?void 0:m.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),m;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(f){throw this._p2pChannel.reportSubscribeEvent(!1,f==null?void 0:f.code,e,t),f}T.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(f=>{T.warning("[".concat(this._clientId,"] auto set fallback failed"),f)});const p=t==="audio"?e._audioTrack:e._videoTrack;if(!p)throw new B(O.UNEXPECTED_ERROR,"can not find remote track in user object");return p}catch(p){throw T.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),p),p}finally{u()}}async massSubscribe(e){if(Ns(e,"subscribeList"),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(d=>{let{user:u,mediaType:p}=d;return"user: ".concat(u==null?void 0:u.uid,", mediaType: ").concat(p)}).join("; ")));const i=(e=[...e]).map(d=>{let{user:u,mediaType:p}=d;return{user:u,mediaType:p}}),a=await this._p2pChannel.globalLock();try{var c;for(let u=e.length-1;u>=0;u--){const p=e[u],{user:f,mediaType:m}=p;if(Sn(m,"mediaType",["audio","video"]),!f){const v=new B(O.INVALID_PARAMS,"user property does not exist in subscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),v}if(!this._users.find(v=>v===f)){const v=new B(O.INVALID_REMOTE_USER,"user is not in the channel");T.error("[".concat(this._clientId,"] can not massSubscribe ").concat(f.uid,", this user is not in the channel")),i[u].error=v,e.splice(u,1);continue}if(m==="audio"&&(!f.hasAudio||f._audioSSRC===void 0)||m==="video"&&(!f.hasVideo||f._videoSSRC===void 0)){const v=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);T.error("[".concat(this._clientId,"] can not subscribe ").concat(f.uid," with mediaType ").concat(m,", remote user is not published")),i[u].error=v,e.splice(u,1);continue}const S=wn.Video|wn.LwoVideo,I=n.get(f);if(I){if(m==="video"?I&S:I&wn.Audio){e.splice(u,1),T.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(f.uid,", mediaType:").concat(m," twice"));continue}n.set(f,I|(m==="video"?S:wn.Audio))}else n.set(f,m==="video"?S:wn.Audio)}for(let u=e.length-1;u>=0;u--){const p=e[u],{user:f,mediaType:m}=p,E=wn.Video|wn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(f,m)){await this._p2pChannel.unmuteRemoteNoLock(f,m);const S=n.get(f);n.set(f,m==="video"?S^E:S^wn.Audio),e.splice(u,1)}}this.store.massSubscribe(e.map(u=>({userId:u.user.uid,type:u.mediaType})),t);const d=vo(c=Array.from(n.entries())).call(c,(u,p)=>{let[f,m]=p;if(m===0)return u;const E={stream_id:f.uid,stream_type:m};return m&wn.Audio&&(E.audio_ssrc=f._audioSSRC),m&wn.Video&&(E.video_ssrc=f._videoSSRC),u.push(E),u},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(p=>{let{user:f,mediaType:m}=p;return{user:f,mediaType:m,ssrcId:m===Te.VIDEO?f._videoSSRC:f._audioSSRC,rtxSsrcId:m===Te.VIDEO?f._rtxSsrcId:void 0}}));const u=new Map;if(d.length>0){const p=await this._gateway.subscribeAll(d,!0);((p==null?void 0:p.users)||[]).forEach(f=>{let{stream_id:m,video_error_code:E,audio_error_code:S,error_code:I}=f;(E||S||I)&&u.set(m,{video_error_code:E,audio_error_code:S,error_code:I})})}if(Array.from(u.entries()).length>0){const p=[];Array.from(u.entries()).forEach(f=>{let[m,E]=f;const S=this.remoteUsers.find(I=>I.uid===m);if(S){let I;E.error_code||E.video_error_code&&E.audio_error_code?I=void 0:E.video_error_code?I=Te.VIDEO:E.audio_error_code&&(I=Te.AUDIO),p.push({user:S,mediaType:I})}}),p.length>0&&await this._p2pChannel.massUnsubscribeNoLock(p)}for(const p of i){const f=u.get(p.user.uid);if(f){const m=f.error_code||p.mediaType==="audio"&&f.audio_error_code||p.mediaType==="video"&&f.video_error_code;if(m){const E=bc(m);T.error("user:".concat(p.user.uid," mediaType:").concat(p.mediaType," has massSubscribe error ").concat(E.desc)),p.error=new B(O.SUBSCRIBE_FAILED,"code ".concat(m,": ").concat(E.desc))}}p.error||(p.mediaType==="video"?p.track=p.user.videoTrack:p.track=p.user.audioTrack)}return this.store.massSubscribe(i.filter(p=>!p.error).map(p=>({userId:p.user.uid,type:p.mediaType})),void 0,Date.now()),i.forEach(p=>{var f;ye.subscribe(this.store.sessionId,{succ:!!p.error,ec:((f=p.error)===null||f===void 0?void 0:f.code)||null,video:p.mediaType===Te.VIDEO,audio:p.mediaType===Te.AUDIO,peerid:p.user.uid,subscribeRequestid:p.mediaType===Te.VIDEO?p.user._videoSSRC:p.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t)},!0)}),T.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(p=>{let{user:f,mediaType:m}=p;return"user: ".concat(f==null?void 0:f.uid,", mediaType: ").concat(m)}).join("; "))),i}catch(u){throw await this._p2pChannel.massUnsubscribeNoLock(e),u}}finally{a(),r()}}async unsubscribe(e,t,n){if(!(e instanceof Na)){const a=this.remoteUsers.find(c=>c.uid===e);if(!a)throw new B(O.INVALID_REMOTE_USER,"user is not in the channel");e=a}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&Sn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(a=>a===e)){const a=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),a}T.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const i=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof qr)await this._p2pChannel.unsubscribe(e,t);else{const a=await this._p2pChannel.unsubscribe(e,t);a&&await this._gateway.unsubscribe(a,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&nm(this._users,e),T.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(a){if(a.code===O.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),a.toString()),a}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&St(t,"id",0,65535,!0),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i=>i===e)){const i=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),i}let r;if(typeof t=="number"){const i=e._dataChannels.find(a=>a.id===t);i&&(r=[i])}else r=e._dataChannels;if(r===void 0){const i=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),i}T.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(i=>i.id)));try{const i=await this._p2pChannel.unsubscribeDataChannel(e,r);i&&await this._gateway.unsubscribeDataChannel(i,e.uid),T.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===O.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}}async massUnsubscribe(e){if(Ns(e,"unsubscribeList"),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");T.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:r,mediaType:i}=n;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(i,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:i}=e[n];if(!r){const d=new B(O.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),d}if(Sn(i,"mediaType",["video","audio",void 0]),!this._users.find(d=>d===r)){T.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const c=wn.Video|wn.LwoVideo;if(t.has(r)){const d=t.get(r);let u;switch(i){case"video":u=d&c;break;case"audio":u=d&wn.Audio;break;default:u=d&(wn.Audio|c)}if(u){T.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?i==="audio"?t.set(r,d|wn.Audio):i==="video"&&t.set(r,d|c):t.set(r,d|wn.Audio|c)}else i?i==="audio"?t.set(r,wn.Audio):i==="video"&&t.set(r,c):t.set(r,wn.Audio|c)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),T.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(r=>{let{user:i,mediaType:a}=r;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(a,";")}).join()))}catch(n){if(n.code===O.DISCONNECT_P2P)return void T.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw T.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new q(O.INVALID_PARAMS);Ht(n.width)||VT(n.width,"streamParameter.width"),Ht(n.height)||VT(n.height,"streamParameter.height"),Ht(n.framerate)||VT(n.framerate,"streamParameter.framerate"),Ht(n.bitrate)||St(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&T.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),T.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,ne.LocalVideoLowTrack)}async enableDualStream(){if(!Ze().supportDualStream)throw ye.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new B(O.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new B(O.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw ye.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,ye.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),T.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(ne.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw ye.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,ye.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),T.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(n){Sn(n,"role",["audience","host"])}(e),t&&a1(t),this.mode==="rtc"||this.mode==="p2p")throw T.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new B(O.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new B(O.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new B(O.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,T.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Mn(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new B(O.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,ye.setProxyServer(this._proxyServer),T.setProxyServer(this._proxyServer),T.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new B(O.INVALID_OPERATION,"You have already set the proxy")}if(Hd(e))return this._turnServer={servers:e,mode:"original-manual"},void T.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>s1(n)),this._turnServer={servers:e,mode:"manual"},T.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"you should set license before join channel");if(Mn(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new B(O.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,T.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new B(O.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new B(O.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new B(O.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Stop proxy server after leave channel");ye.setProxyServer(),T.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new B(O.INVALID_PARAMS,"accessPoints is required.");Ns(e.accessPoints.serverList,"accessPoints.serverList"),Mn(e.accessPoints.domain,"accessPoints.domain");const t=(E,S)=>{St(E,S,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new B(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");P("CLOSE_AFB_FOR_LOCAL_AP")&&(Tt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Tt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,a=e.accessPoints.serverList.map(E=>r.test(E)?"".concat(E.replace(/\./g,"-"),".").concat(i):E),c=a.map(E=>"".concat(E,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Tt("WEBCS_DOMAIN",c),Tt("WEBCS_DOMAIN_BACKUP_LIST",c),Tt("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Ns(e.report.hostname,"report.hostname"),Tt("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Tt("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Tt("EVENT_REPORT_DOMAIN",a[0]),Tt("EVENT_REPORT_BACKUP_DOMAIN",a[1]||a[0]));let d=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),d=e.report.port),Tt("STATS_COLLECTOR_PORT",d),e.report?Tt("ENABLE_EVENT_REPORT",!0):Tt("ENABLE_EVENT_REPORT",!1);let u="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Ns(e.log.hostname,"log.hostname"),u=e.log.hostname[0]):u=a[0];let p=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),p=e.log.port),Tt("LOG_UPLOAD_SERVER","".concat(u,":").concat(p));let f=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Ns(e.cds.hostname,"cds.hostname"),f=e.cds.hostname):f=a;let m=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),m=e.cds.port),Tt("CDS_AP",f.map(E=>"".concat(E,":").concat(m))),e.cds?Tt("ENABLE_CONFIG_DISTRIBUTE",!0):Tt("ENABLE_CONFIG_DISTRIBUTE",!1),T.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Ns(e,"serverList"),Mn(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new B(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(r=>n.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Tt("WEBCS_DOMAIN",e),Tt("WEBCS_DOMAIN_BACKUP_LIST",e),Tt("GATEWAY_DOMAINS",[t]),Tt("EVENT_REPORT_DOMAIN",e[0]),Tt("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Tt("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),T.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Sn(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw T.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else T.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Sn(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(r=>r.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw T.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Sn(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw T.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,r){(function(a){Sn(a,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Mn(t,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(le(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new B(O.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new B(O.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(Os(r,"encryptDataStream"),!le(i).call(i,e))throw new B(O.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||T.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=fa(n))}async renewToken(e){if(Mn(e,"token",1,2047),!this._key||!this._joinInfo)throw new B(O.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(P("USE_NEW_TOKEN")){T.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r=await IY(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||on);T.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:r})}else T.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});T.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,T.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?T.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Je.VOLUME_INDICATOR,e)},P("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new B(O.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new B(O.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new B(O.LIVE_STREAMING_TASK_CONFLICT);const n=t?Dn.TRANSCODE:Dn.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(Dn.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new B(O.INVALID_PARAMS,"can not find live streaming url to stop");await ae.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async addInjectStreamUrl(e,t){if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const n=this._createLiveStreamingClient(Dn.INJECT);n.setInjectStreamConfig(t,0),await n.startLiveStreamingTask(e,Dn.INJECT)}async removeInjectStreamUrl(){var e;const t=this._createLiveStreamingClient(Dn.INJECT),n=Array.from(wo(e=t.streamingTasks).call(e)).find(r=>r.mode===Dn.INJECT);if(!this._joinInfo||!n)throw new B(O.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await t.stopLiveStreamingTask(n.url)}async startChannelMediaRelay(e){y2(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){y2(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const i=new TextEncoder;e.payload=i.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&le(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(i,a,c){var d;const u=vo(d=Array.from(c)).call(d,(v,y)=>v+y,0),p={serverTs:0,seq:dz++,length:c.length,checkSum:u},f=new Uint8Array(m1(u,2)),m=new ArrayBuffer(qd),E=new DataView(m);E.setUint32(0,p.serverTs),E.setUint16(4,p.seq),E.setUint16(6,p.length),E.setUint16(8,p.checkSum);const S=16-c.length%16;c=l1(c,new Uint8Array(S));const I=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:g1,additionalData:f},a,c);return l1(new Uint8Array(m),new Uint8Array(I))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new B(O.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Re.DATA_STREAM,{payload:fa(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-XX},!n)}sendMetadata(e){if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new B(O.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Re.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:fa(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(uz),!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not send custom report, not joined");await ye.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){Sn(t.spatialLayer,"spatialLayer",[0,1,2,3]),Sn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw T.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(Os(t,"apRTM"),St(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,T.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(T.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=yr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&_M(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new On("client-publish"),this._subscribeMutex=new On("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const r=e||Zu();e?T.debug("[".concat(this._clientId,"] new Session ").concat(r)):T.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r;const a={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1};t?ye.sessionInit(this._sessionId,Di({cname:t.channel,appid:t.appId,preload:t.preload},a)):this._joinInfo?ye.sessionInit(this._sessionId,Di({cname:this._joinInfo.cname,appid:this._joinInfo.appId,preload:!!this._joinInfo.recoverPreloadCache},a)):this._gateway.joinInfo&&ye.sessionInit(this._sessionId,Di({cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId},a)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&P("FORCE_TURN")&&!P("TURN_ENABLE_TCP")&&!P("TURN_ENABLE_UDP"))throw new B(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");T.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof qr){const r=(await n.next()).value;if(r){try{await this._gateway.sendExtensionMessage(Zt.PUBLISH,r,!0)}catch(i){throw n.throw(i),i}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(a){if(a.code!==O.DISCONNECT_P2P)throw n.throw(a),a}await n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const i of e)i instanceof wt&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig),!i.muted&&i.enabled||await this._p2pChannel.muteLocalTrack(i)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===O.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));T.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(a){if(a.code!==O.DISCONNECT_P2P)throw n.throw(a),a}n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===O.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new B(O.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const t=()=>new RX(this._joinInfo,this._config.websocketRetryConfig||on,this._config.httpRetryConfig||on),n=r=>{r.onLiveStreamError=(i,a)=>{ye.reportApiInvoke(this._sessionId,{name:ln.ON_LIVE_STREAM_ERROR,options:[i,a],tag:Kt.TRACER}).onSuccess(),this.safeEmit(Je.LIVE_STREAMING_ERROR,i,a)},r.onLiveStreamWarning=(i,a)=>{ye.reportApiInvoke(this._sessionId,{name:ln.ON_LIVE_STREAM_WARNING,options:[i,a],tag:Kt.TRACER}).onSuccess(),this.safeEmit(Je.LIVE_STREAMING_WARNING,i,a)},r.on(pm.REQUEST_WORKER_MANAGER_LIST,(i,a,c)=>{if(!this._joinInfo)return c(new B(O.INVALID_OPERATION,"can not find join info to get worker manager"));aD(i,this._joinInfo,this._axiosCancelSource.token,on).then(a).catch(c)})};switch(e){case Dn.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=t(),n(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Dn.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=t(),n(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Dn.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=t(),this._injectStreamingClient.on(pm.REQUEST_WORKER_MANAGER_LIST,(r,i,a)=>{if(!this._joinInfo)return a(new B(O.INVALID_OPERATION,"can not find join info to get worker manager"));aD(r,this._joinInfo,this._axiosCancelSource.token,on).then(i).catch(a)}),this._injectStreamingClient.onInjectStatusChange=(r,i,a)=>{this.safeEmit(Je.INJECT_STREAM_STATUS,r,i,a)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new B(O.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:t}=this.getLocalVideoStats(),n={width:e,height:t};this._channelMediaRelayClient=new IX(this._joinInfo,this._clientId,this._config.websocketRetryConfig||on,this._config.httpRetryConfig||on,n),this._channelMediaRelayClient.on("state",r=>{r===Nr.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(Je.CHANNEL_MEDIA_RELAY_STATE,r)}),this._channelMediaRelayClient.on("event",r=>{this.safeEmit(Je.CHANNEL_MEDIA_RELAY_EVENT,r)}),this._statsCollector.onStatsChanged=(r,i)=>{var a;r==="resolution"&&((a=this._channelMediaRelayClient)===null||a===void 0||a.setVideoProfile(i))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:r}=e,i=[];Array.isArray(n)&&n.length>0&&n.forEach(a=>{const{uid:c,stream_id:d,ordered:u,max_retrans_times:p,metadata:f}=a,m=this._users.find(E=>E._uintid===c);if(!m)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(T.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(c)),le(i).call(i,m)||i.push(m),m._uintid||(m._uintid=c),m._dataChannels.findIndex(E=>E.id===a.stream_id)===-1){const E={id:d,ordered:!!u,maxRetransmits:p,metadata:f},S=new tX(E);m._dataChannels.push(S),T.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published datachannel")),t||this.safeEmit(Je.USER_PUBLISHED,m,"datachannel",E)}this._p2pChannel.hasPendingRemoteDataChannel(m,a.stream_id)&&(T.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(m.uid," after reconnect.")),this._subscribeDataChannel(m,a.stream_id).catch(E=>{T.error("[".concat(this._clientId,"] resubscribe datachannel error"),E.toString())}))}),t&&(this.safeEmit(Je.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(a=>{const{uid:c,stream_id:d}=a,u=this._users.find(f=>f._uintid===c);if(!u)return void T.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const p=u._dataChannels.find(f=>f.id===a.stream_id);p&&(T.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(c)),this._p2pChannel.unsubscribeDataChannel(u,[p]).then(f=>{if(u._dataChannels=u._dataChannels.filter(m=>m!==p),f)return this._gateway.unsubscribeDataChannel(f,u.uid)}),T.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished datachannel ,id:").concat(p.id)),this.safeEmit(Je.USER_UNPUBLISHED,u,"datachannel",p._config))})}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){T.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(r=>{this.safeEmit(Je.USER_UNPUBLISHED,t,"datachannel",r._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(r=>{if(r)return this._gateway.unsubscribeDataChannel(r,t.uid)}),n()}}else T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Qt.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Qt.CONNECTION_STATE_CHANGE,(e,t,n)=>{var r;if(n===qe.FALLBACK)return;const i=()=>{this.safeEmit(Je.CONNECTION_STATE_CHANGE,e,t,n)};if(ye.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:ln.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:Kt.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),T.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void i();if(e==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._is_pre_created||(c._audio_pre_subscribed||(c._audioSSRC=void 0,c._audioOrtc=void 0),c._video_pre_subscribed||(c._videoSSRC=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),c._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var a;this._streamFallbackTypeCacheMap.forEach((c,d)=>{this._gateway.setStreamFallbackOption(d,c).catch(u=>{T.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),u)})}),this._remoteStreamTypeCacheMap.forEach((c,d)=>{this._gateway.setRemoteVideoStreamType(d,c).catch(u=>{T.warning("[".concat(this._clientId,"] auto set remote stream type failed"),u)})}),this._remoteDefaultVideoStreamType!==void 0&&((a=this._joinInfo)===null||a===void 0?void 0:a.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{T.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{T.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{T.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,Te.AUDIO,!1)),c._trust_video_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,Te.VIDEO,!1)),c._trust_audio_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(T.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3))}i()}),this._gateway.on(Qt.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new B(O.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;this._joinInfo.recoverPreloadCache?(n=this._joinInfo.recoverPreloadCache.ap,EM(this._joinInfo.recoverPreloadCache),this._joinInfo.recoverPreloadCache=void 0):n=await gv(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||on,this.store),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const r=[];n.gatewayInfo.gatewayAddrs.forEach(i=>{let{address:a}=i;const[c,d]=a.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:c,port:d}):r.push({host:c,port:d})}),e(r)}catch(n){t(n)}}),this._gateway.on(Qt.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Je.NETWORK_QUALITY,e)}),this._gateway.on(Qt.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Je.STREAM_TYPE_CHANGED,e,t),ye.reportApiInvoke(this._sessionId,{name:ln.STREAM_TYPE_CHANGE,options:[e,t],tag:Kt.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(Qt.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Qt.NEED_RENEW_SESSION,async e=>{if(e==="recover"&&this._joinInfo){const t=await fM(Di(Di({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));this._joinInfo.recoverPreloadCache=t,this._startSession(t==null?void 0:t.sid)}else this._startSession()}),this._gateway.on(Qt.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{t(await this._p2pChannel.startP2PConnection(e))}catch(r){n(r)}}),this._gateway.on(Qt.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;const{dtlsParameters:n,iceParameters:r,candidates:i,rtpCapabilities:a,setup:c,cname:d}=Xk(e.ortc,t);this._p2pChannel.connect(r,n,i,a,c,d)}),this._gateway.on(Qt.REQUEST_DC_CONNECTION_PARAMS,e=>{e(this._p2pChannel.getEstablishParams())}),this._gateway.on(Qt.RESET_SIGNAL,e=>{this._p2pChannel.resetConnection(e),this._handleGatewaySignalEvents()}),this._gateway.on(Qt.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(Qt.DATACHANNEL_PRECONNECT,async(e,t,n,r)=>{var i,a,c,d,u,p;await this._p2pChannel.startP2PConnection({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},!0);const f=function(m,E){let S;return E&&E.ip&&typeof E.port=="number"?(S=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:E.ip,port:E.port.toString(),type:"host",extension:{}}],T.debug("Using remote candidate from AP ".concat(E.ip,":").concat(E.port)),E.ip6&&(S.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:E.ip6,port:E.port.toString(),type:"host",extension:{}}),T.debug("Using IPV6 remote candidate from AP ".concat(E.ip6,":").concat(E.port)))):S=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:m.ip,port:m.port.toString(),type:"host",extension:{}}],S}(e,t);return this._p2pChannel.preConnect({iceUfrag:"".concat((a=this._joinInfo)===null||a===void 0?void 0:a.apResponse.cid,"_").concat((c=this._joinInfo)===null||c===void 0?void 0:c.apResponse.cert),icePwd:"".concat((d=this._joinInfo)===null||d===void 0?void 0:d.apResponse.cid,"_").concat((u=this._joinInfo)===null||u===void 0?void 0:u.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(p=P("FINGERPRINT"))!==null&&p!==void 0?p:e.fingerprint}]},f,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(n).catch(r)})}_handleGatewaySignalEvents(){this._gateway.signal.on(Ue.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Ue.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Ue.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(Ue.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Ue.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Ue.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams,deleted:[]},!0)}),this._gateway.signal.on(Ue.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Ue.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Ue.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Te.AUDIO,!0)),this._gateway.signal.on(Ue.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Te.AUDIO,!1)),this._gateway.signal.on(Ue.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Te.VIDEO,!0)),this._gateway.signal.on(Ue.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Te.VIDEO,!1)),this._gateway.signal.on(Ue.RECEIVE_METADATA,e=>{const t=Rc(e.metadata);this.safeEmit(Je.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Ue.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=Rc(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&le(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<qd)throw new B(O.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(qd));n=await async function(a,c,d){const u=d.subarray(0,qd),p=u.slice(8,qd),f=(p[0]<<8)+p[1],m=(u[6]<<8)+u[7],E=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:a,tagLength:g1,additionalData:new Uint8Array(m1(f,2))},c,d.subarray(qd));return new Uint8Array(E).subarray(0,m)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let r=0;if(e.ordered||e.syncWithAudio){const i=this._p2pChannel.getStats(),a=this.remoteUsers.find(d=>d.uid===e.uid),c=i==null?void 0:i.audioRecv.find(d=>d.ssrc===(a==null?void 0:a._audioSSRC));r=c==null?void 0:c.jitterBufferMs}r==null&&(r=0),ZX(Di(Di({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Ue.ON_CRYPT_ERROR,()=>{pa(()=>{T.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Je.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Ue.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{T.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,qe.TOKEN_EXPIRE),this.safeEmit(Je.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Ue.ON_STREAM_FALLBACK_UPDATE,e=>{T.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Je.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Ue.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),T.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Ue.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Ue.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(_e.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Re.PUBLISH:{if(!t)return;const i=t.ortc;if(i){var n,r;const a=i.some(u=>{let{stream_type:p}=u;return p===lt.Audio}),c=i.some(u=>{let{stream_type:p}=u;return p!==lt.Audio}),d=i.some(u=>{let{stream_type:p}=u;return p===lt.Screen||p===lt.ScreenLow});t.state==="offer"&&ye.publish(this._joinInfo.sid,{eventElapse:Qn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:O.TIMEOUT,audio:a,video:c,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:d,audioName:a?(n=i.find(u=>{let{stream_type:p}=u;return p===lt.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:c?(r=i.find(u=>{let{stream_type:p}=u;return p!==lt.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case Re.SUBSCRIBE:t&&ye.subscribe(this._joinInfo.sid,{succ:!1,ec:O.TIMEOUT,audio:t.stream_type===Te.AUDIO,video:t.stream_type===Te.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Qn.measureFromSubscribeStart(this.store.clientId,t.ssrcId)})}}),this._gateway.signal.on(Ue.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Ue.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;P("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(r=>!Ic(r.string_id||r.stream_id,this.channelName)));const t=[],n=[];for(const r of e.users){let i=this._users.find(f=>f._uintid===r.stream_id);i?i._trust_in_room_=!0:(i=new Na(r.string_id||r.stream_id,r.stream_id),this._users.push(i),this.getListeners(Je.PUBLISHED_USER_LIST).length===0&&(T.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Je.USER_JOINED,i)));const a=wn.Audio&r.stream_type,c=(wn.Video|wn.LwoVideo)&r.stream_type,d=(65280&r.stream_type)!=0,u=a&&i.hasAudio,p=c&&i.hasVideo;c&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=r.video_ssrc,i._rtxSsrcId=r.video_rtx),a&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=r.audio_ssrc),a&&!u&&this.getListeners(Je.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(Je.USER_PUBLISHED,i,"audio")),c&&!p&&this.getListeners(Je.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(Je.USER_PUBLISHED,i,"video")),(a&&!u||c&&!p||d)&&t.push(i),c&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&n.push({user:i,mediaType:"video"}),a&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&n.push({user:i,mediaType:"audio"})}n.length>0&&(T.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(r=>{T.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(Je.PUBLISHED_USER_LIST).length>0?P("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(T.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(r=>r.uid).join(", "))),this.safeEmit(Je.PUBLISHED_USER_LIST,t)):T.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(Ue.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof p_&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var r;return le(r=Object.keys(Yd)).call(r,n)}))})}_handleP2PEvents(){this._gateway.signal.on(Ue.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Zt.PUBLISH,(e,t,n)=>{const{uid:r}=e;e.forEach(i=>{const{kind:a,ssrcs:c,mid:d,isMuted:u}=i;this._handleP2PAddAudioOrVideoStream(a,r,c[0].ssrcId,d);const p=this._users.find(f=>f.uid===r);return p&&this._p2pChannel instanceof qr?this._p2pChannel.mockSubscribe(p,a,c[0].ssrcId,d).then(()=>{t()}).catch(n):t(),this._handleMuteStream(r,a,!!u)})}),this._gateway.signal.on(Zt.CALL,async(e,t,n)=>{if(this._p2pChannel instanceof qr)try{var r;t(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},e))}catch(i){n(i)}}),this._gateway.signal.on(_e.P2P_CONNECTION,async e=>{this._p2pChannel instanceof qr&&await this._p2pChannel.p2pConnect(e)}),this._gateway.signal.on(Zt.UNPUBLISH,async(e,t,n)=>{if(this._p2pChannel instanceof qr){const{unpubMsg:r,uid:i}=e,a=this._users.find(c=>c.uid===i);if(!a)return T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{r.forEach(async c=>{let{stream_type:d}=c;const u=d===lt.Audio?Te.AUDIO:Te.VIDEO;await this._p2pChannel.unsubscribe(a,u),this._handleMuteStream(i,u,!0)}),t()}catch(c){n(c)}}}),this._gateway.signal.on(Zt.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case ga.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Te.VIDEO,!0);break;case ga.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Te.AUDIO,!0);break;case ga.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Te.VIDEO,!1);break;case ga.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Te.AUDIO,!1)}}),this._gateway.signal.on(Zt.RESTART_ICE,async(e,t,n)=>{if(this._p2pChannel instanceof qr)try{const{direction:r,iceParameter:i}=e;r!==mr.SEND_ONLY||i?t(await this._p2pChannel.restartICE(r,i)):(this._p2pChannel.handleDisconnect(r),t())}catch(r){n(r)}}),this._gateway.signal.on(Zt.CANDIDATE,e=>{if(this._p2pChannel instanceof qr){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(Oe.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:r}=e;t(await this._gateway.sendExtensionMessage(Zt.RESTART_ICE,e,r===mr.SEND_ONLY))}catch(r){n(r)}}),this._p2pChannel.on(Oe.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Zt.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Oe.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(Zt.CONTROL,e,!0),t()}catch(r){n(r)}}),this._p2pChannel.on(Oe.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===O.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Oe.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===O.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Oe.StateChange,(e,t)=>{t===ut.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Oe.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===O.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Oe.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===O.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Oe.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(Oe.RequestRePublishDataChannel,(e,t,n)=>{ae.all(e.map(async r=>{await this._p2pChannel.publishDataChannel([r]);const i={streamId:r.id,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:r.metadata,channelId:r._originDataChannelId};try{await this._gateway.publishDataChannel(this._uid,i,!0)}catch(a){if(a.code!==O.DISCONNECT_P2P)throw a}})).then(t).catch(n)}),this._p2pChannel.on(Oe.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:r,kind:i}of e)i===Te.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");t()}catch(r){n(r)}}),this._p2pChannel.on(Oe.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Oe.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Oe.MediaReconnectStart,e=>{this.safeEmit(Je.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Oe.MediaReconnectEnd,e=>{this.safeEmit(Je.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Oe.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Oe.RequestRestartICE,async e=>{if(this._p2pChannel instanceof qr)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(c){return void t.throw(c)}const{iceParameters:a}=function(c){const d=c.iceParameters;return{iceParameters:{iceUfrag:d.iceUfrag,icePwd:d.icePwd}}}(i);await t.next({remoteIceParameters:a})}),this._p2pChannel.on(Oe.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Oe.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:a}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),{dtlsParameters:c,iceParameters:d,candidates:u,rtpCapabilities:p,setup:f,cname:m}=Xk(i,a);await this._p2pChannel.connect(d,c,u,p,f,m),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Oe.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(Oe.P2PLost,()=>{this.safeEmit(Je.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Oe.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Oe.ConnectionTypeChange,e=>{this.safeEmit(Je.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Oe.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Oe.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!e)throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!e.inspectType||!Array.isArray(e.inspectType))throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const t=[...new Set(e.inspectType)];t.forEach(n=>{var r;if(!le(r=["supervise","moderation"]).call(r,n))throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(n," is not a valid inspect type."))}),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const t=new f_(e);this._inspect=t,this.handleVideoInspectEvents(this._inspect),await t.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},on)}catch(t){throw Array.isArray(t)?t[0]:t}}async disableContentInspect(){if(!this._inspect)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Os(e,"enabled"),e){if(!t)throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(St(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] config.extraInfo length cannot exceed 1024 bytes"));if(t&&t.vendor&&t.vendor.length>1024)throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] config.vendor length cannot exceed 1024 bytes"));if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(t);const n=new Hy(t);this._moderation=n,this.handleImageModerationEvents(this._moderation),await n.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},on)}catch(n){throw Array.isArray(n)?n[0]:n}}else{if(!this._moderation)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(n){throw Array.isArray(n)?n[0]:n}}}setP2PTransport(e){if(function(t){Sn(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new B(O.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,T.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}handleImageModerationEvents(e){e.on(Io.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Je.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===wi.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new B(O.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Io.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}handleVideoInspectEvents(e){e.on(Pn.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Je.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===Yi.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Je.CONTENT_INSPECT_ERROR,new B(O.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Pn.INSPECT_RESULT,(t,n)=>{var r;if((n==null?void 0:n.code)===O.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return T.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(Je.CONTENT_INSPECT_RESULT,t,n)}),e.on(Pn.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return T.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Os(e,"enabled"),Tt("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},se(ue.prototype,"leave",[TM],Object.getOwnPropertyDescriptor(ue.prototype,"leave"),ue.prototype),se(ue.prototype,"publish",[vM],Object.getOwnPropertyDescriptor(ue.prototype,"publish"),ue.prototype),se(ue.prototype,"unpublish",[yM],Object.getOwnPropertyDescriptor(ue.prototype,"unpublish"),ue.prototype),se(ue.prototype,"subscribe",[CM],Object.getOwnPropertyDescriptor(ue.prototype,"subscribe"),ue.prototype),se(ue.prototype,"presubscribe",[RM],Object.getOwnPropertyDescriptor(ue.prototype,"presubscribe"),ue.prototype),se(ue.prototype,"massSubscribe",[wM],Object.getOwnPropertyDescriptor(ue.prototype,"massSubscribe"),ue.prototype),se(ue.prototype,"unsubscribe",[IM],Object.getOwnPropertyDescriptor(ue.prototype,"unsubscribe"),ue.prototype),se(ue.prototype,"massUnsubscribe",[AM],Object.getOwnPropertyDescriptor(ue.prototype,"massUnsubscribe"),ue.prototype),se(ue.prototype,"setLowStreamParameter",[bM],Object.getOwnPropertyDescriptor(ue.prototype,"setLowStreamParameter"),ue.prototype),se(ue.prototype,"enableDualStream",[OM],Object.getOwnPropertyDescriptor(ue.prototype,"enableDualStream"),ue.prototype),se(ue.prototype,"disableDualStream",[NM],Object.getOwnPropertyDescriptor(ue.prototype,"disableDualStream"),ue.prototype),se(ue.prototype,"setClientRole",[DM],Object.getOwnPropertyDescriptor(ue.prototype,"setClientRole"),ue.prototype),se(ue.prototype,"setProxyServer",[PM],Object.getOwnPropertyDescriptor(ue.prototype,"setProxyServer"),ue.prototype),se(ue.prototype,"setTurnServer",[LM],Object.getOwnPropertyDescriptor(ue.prototype,"setTurnServer"),ue.prototype),se(ue.prototype,"setLicense",[kM],Object.getOwnPropertyDescriptor(ue.prototype,"setLicense"),ue.prototype),se(ue.prototype,"startProxyServer",[MM],Object.getOwnPropertyDescriptor(ue.prototype,"startProxyServer"),ue.prototype),se(ue.prototype,"stopProxyServer",[xM],Object.getOwnPropertyDescriptor(ue.prototype,"stopProxyServer"),ue.prototype),se(ue.prototype,"setLocalAccessPointsV2",[UM],Object.getOwnPropertyDescriptor(ue.prototype,"setLocalAccessPointsV2"),ue.prototype),se(ue.prototype,"setLocalAccessPoints",[VM],Object.getOwnPropertyDescriptor(ue.prototype,"setLocalAccessPoints"),ue.prototype),se(ue.prototype,"setRemoteDefaultVideoStreamType",[jM],Object.getOwnPropertyDescriptor(ue.prototype,"setRemoteDefaultVideoStreamType"),ue.prototype),se(ue.prototype,"setRemoteVideoStreamType",[FM],Object.getOwnPropertyDescriptor(ue.prototype,"setRemoteVideoStreamType"),ue.prototype),se(ue.prototype,"setStreamFallbackOption",[BM],Object.getOwnPropertyDescriptor(ue.prototype,"setStreamFallbackOption"),ue.prototype),se(ue.prototype,"setEncryptionConfig",[GM],Object.getOwnPropertyDescriptor(ue.prototype,"setEncryptionConfig"),ue.prototype),se(ue.prototype,"renewToken",[WM],Object.getOwnPropertyDescriptor(ue.prototype,"renewToken"),ue.prototype),se(ue.prototype,"enableAudioVolumeIndicator",[HM],Object.getOwnPropertyDescriptor(ue.prototype,"enableAudioVolumeIndicator"),ue.prototype),se(ue.prototype,"startLiveStreaming",[KM],Object.getOwnPropertyDescriptor(ue.prototype,"startLiveStreaming"),ue.prototype),se(ue.prototype,"setLiveTranscoding",[zM],Object.getOwnPropertyDescriptor(ue.prototype,"setLiveTranscoding"),ue.prototype),se(ue.prototype,"stopLiveStreaming",[YM],Object.getOwnPropertyDescriptor(ue.prototype,"stopLiveStreaming"),ue.prototype),se(ue.prototype,"addInjectStreamUrl",[qM],Object.getOwnPropertyDescriptor(ue.prototype,"addInjectStreamUrl"),ue.prototype),se(ue.prototype,"removeInjectStreamUrl",[JM],Object.getOwnPropertyDescriptor(ue.prototype,"removeInjectStreamUrl"),ue.prototype),se(ue.prototype,"startChannelMediaRelay",[XM],Object.getOwnPropertyDescriptor(ue.prototype,"startChannelMediaRelay"),ue.prototype),se(ue.prototype,"updateChannelMediaRelay",[QM],Object.getOwnPropertyDescriptor(ue.prototype,"updateChannelMediaRelay"),ue.prototype),se(ue.prototype,"stopChannelMediaRelay",[ZM],Object.getOwnPropertyDescriptor(ue.prototype,"stopChannelMediaRelay"),ue.prototype),se(ue.prototype,"sendCustomReportMessage",[$M],Object.getOwnPropertyDescriptor(ue.prototype,"sendCustomReportMessage"),ue.prototype),se(ue.prototype,"pickSVCLayer",[ex],Object.getOwnPropertyDescriptor(ue.prototype,"pickSVCLayer"),ue.prototype),se(ue.prototype,"setRTMConfig",[tx],Object.getOwnPropertyDescriptor(ue.prototype,"setRTMConfig"),ue.prototype),se(ue.prototype,"enableContentInspect",[nx],Object.getOwnPropertyDescriptor(ue.prototype,"enableContentInspect"),ue.prototype),se(ue.prototype,"disableContentInspect",[rx],Object.getOwnPropertyDescriptor(ue.prototype,"disableContentInspect"),ue.prototype),se(ue.prototype,"setImageModeration",[ix],Object.getOwnPropertyDescriptor(ue.prototype,"setImageModeration"),ue.prototype),se(ue.prototype,"setP2PTransport",[ox],Object.getOwnPropertyDescriptor(ue.prototype,"setP2PTransport"),ue.prototype),se(ue.prototype,"getJoinChannelServiceRecords",[sx],Object.getOwnPropertyDescriptor(ue.prototype,"getJoinChannelServiceRecords"),ue.prototype),se(ue.prototype,"setPublishAudioFilterEnabled",[ax],Object.getOwnPropertyDescriptor(ue.prototype,"setPublishAudioFilterEnabled"),ue.prototype),ue);class Fh{constructor(t,n){w(this,"id",0),w(this,"element",void 0),w(this,"peerPair",void 0),w(this,"context",void 0),w(this,"audioPlayerElement",void 0),w(this,"audioTrack",void 0),Fh.count+=1,this.id=Fh.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(r,i)=>{const a=i==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(a),r.iceGatheringState==="complete"?r.localDescription:new ae(c=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&c(r.localDescription)}})},n=async(r,i)=>await r.setRemoteDescription(i);try{const r=await t(this.peerPair[0],"offer");await n(this.peerPair[1],r);const i=await t(this.peerPair[1],"answer");await n(this.peerPair[0],i)}catch(r){throw new B(O.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(i){throw new B(O.LOCAL_AEC_ERROR,i.toString()).print()}if(!n)throw new B(O.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=n.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){T.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var dx,T_;w(Fh,"count",0);const iQ=window.AudioContext||window.webkitAudioContext,oQ=new(dx=be({report:ye}),se((T_=class{constructor(){w(this,"units",[]),w(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return T.debug("the system does not need to process local aec"),-1;this.context||(this.context=new iQ);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new Fh(e,this.context),this.units.push(t)),t.startEchoCancellation(),T.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return tt().name!==dt.SAFARI}}).prototype,"processExternalMediaAEC",[dx],Object.getOwnPropertyDescriptor(T_.prototype,"processExternalMediaAEC"),T_.prototype),T_);function lx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function ux(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?lx(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lx(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const Qy=window||document;function hx(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!Qy)return;const n=pn._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=i=>{if(!(i&&i.blockedURI&&(pn.onSecurityPolicyViolation||pn.getListeners(as.SECURITY_POLICY_VIOLATION).length>0)))return;const a=i.blockedURI;P("CSP_DETECTED_HOSTNAME_LIST").some(c=>le(a).call(a,c))&&(pn.onSecurityPolicyViolation&&typeof pn.onSecurityPolicyViolation=="function"&&pn.onSecurityPolicyViolation(i),pn.getListeners(as.SECURITY_POLICY_VIOLATION).length>0&&pn.safeEmit(as.SECURITY_POLICY_VIOLATION,i))};n&&Qy.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||pn.getListeners(as.SECURITY_POLICY_VIOLATION).length>0)&&Qy.addEventListener("securitypolicyviolation",r),pn._cspEventHandlerPointer=r}Tt("PROCESS_ID","process-".concat(Rt(8,""),"-").concat(Rt(4,""),"-").concat(Rt(4,""),"-").concat(Rt(4,""),"-").concat(Rt(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void T.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();T.debug("Loading global parameters from cache",t),Object.keys(t).forEach(r=>{if(Object.prototype.hasOwnProperty.call(_n,r)){const{value:i,expires:a}=t[r];if(a&&a<=n)return;ma[r]=i,_n[r]=i}})}catch(t){T.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(ma.AREAS)&&ma.AREAS.length>0&&hv(ma.AREAS,!0);const px=(e,t,n)=>{T.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Tt(e,t,n)},pn=function(e){const t=new xt,n=e,r={getListeners:t.getListeners.bind(t),on:(i,a)=>(function(c,d){c===as.SECURITY_POLICY_VIOLATION&&hx(d,!0)}(i,a),t.on.bind(t)(i,a)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return ux(ux({},n),r)}({__TRACK_LIST__:fl,VERSION:Ci,BUILD:JT,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:px,getParameter:P,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(r){let i;return Ze().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),i=(await r.createOffer()).sdp):i=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i}(t);if(!n)return e;t.close(),t=null,e=function(r){const i={video:[],audio:[]};return r.match(/ VP8/i)&&i.video.push("VP8"),r.match(/ VP9/i)&&i.video.push("VP9"),r.match(/ AV1/i)&&i.video.push("AV1"),r.match(/ H264/i)&&i.video.push("H264"),r.match(/ H265/i)&&i.video.push("H265"),r.match(/ opus/i)&&i.audio.push("OPUS"),r.match(/ PCMU/i)&&i.audio.push("PCMU"),r.match(/ PCMA/i)&&i.audio.push("PCMA"),r.match(/ G722/i)&&i.audio.push("G722"),i}(n)}catch(t){throw new B(O.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=ye.reportApiInvoke(null,{name:ln.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Kt.TRACER});let t=!1;try{const a=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,d=window.WebSocket;t=!!(a&&c&&d),t&&UT()&&function(u){const p=tt();return!(p.name!==dt.CHROME||!p.osVersion)&&Number(p.version)<u}(75)&&new a().close()}catch(a){return T.error("check system requirement failed: ",a),!1}let n=!1;const r=tt();r.name===dt.CHROME&&Number(r.version)>=58&&(Co.engine.name!=="WebKit"||function(){const a=tt();if(em()){if(a.os===yn.MAC_OS)return!0;if(a.os===yn.IOS){const c=Co.os.version&&Co.os.version.split(".");if(c&&Number(c[0])===14&&c[1]&&Number(c[1])>=3||c&&Number(c[0])>14)return!0}}return!1}())&&(n=!0),(r.name===dt.FIREFOX&&Number(r.version)>=56||r.name===dt.OPERA&&Number(r.version)>=45||r.name===dt.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(Jn()||Ki())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||XN()||tt().name===dt.QQ)&&(n=!0),T.debug("checkSystemRequirements, api:",t,"browser",n);const i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return li.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return li.getRecordingDevices(e)},getCameras:function(e){return li.getCamerasDevices(e)},getElectronScreenSources:FP,getPlaybackDevices:function(e){return li.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=ye.reportApiInvoke(null,{name:ln.CREATE_CLIENT,options:[t],tag:Kt.TRACER});try{(function(r){Sn(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Sn(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&Sn(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&Mn(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&s1(r.turnServer),r.httpRetryConfig!==void 0&&o1(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&o1(r.websocketRetryConfig)})(t)}catch(r){throw n.onError(r),r}return(HN(16,0)||KN(16,0))&&(t.codec==="vp9"&&(t.codec="vp8",T.debug("browser not support vp9, force use vp8")),Tt("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),n.onSuccess(),new rQ(Di(Di({forceWaitGatewayResponse:!0},t),{},{role:le(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=P("CAMERA_CAPTURE_CONFIG"),n=ye.reportApiInvoke(null,{tag:Kt.TRACER,name:ln.CREATE_CAM_VIDEO_TRACK,options:[Ut({},e),t]});t&&(e.encoderConfig=t);const r=zm(e),i=Rt(8,"track-cam-");let a=null;const c=e.encoderConfig==="720p_auto";T.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{a=(await di({video:r},i)).getVideoTracks()[0]||null}catch(u){throw n.onError(u),u}if(!a){const u=new q(O.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(u),u.throw(T)}e.optimizationMode&&Ty(i,a,e,ps(e.encoderConfig));const d=new Sy(a,e,r,e.scalabiltyMode?Gm(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return c&&d.startMonitorStats(),n.onSuccess(d.getTrackId()),T.info("create camera video success, trackId:",i),d},createCustomVideoTrack:function(e){const t=ye.reportApiInvoke(null,{tag:Kt.TRACER,name:ln.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new wt(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Gm(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,Rt(8,"track-cus-"),[Ot.CUSTOM_TRACK]);return t.onSuccess(n.getTrackId()),T.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=ye.reportApiInvoke(null,{tag:Kt.TRACER,name:ln.CREATE_SCREEN_VIDEO_TRACK,options:[Ut({},e),t]}),r=e.encoderConfig==="720p_auto";e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const i=function(m){const E={};m.screenSourceType&&(E.mediaSource=m.screenSourceType),m.extensionId&&ua()&&(E.extensionId=m.extensionId);const{displaySurface:S,selfBrowserSurface:I,surfaceSwitching:v,systemAudio:y}=m;(MT(107)||GN(107)||zN(93))&&(S&&(Sn(S,"displaySurface",["browser","window","monitor"]),E.displaySurface=S),I?(Sn(I,"selfBrowserSurface",["exclude","include"]),E.selfBrowserSurface=I):E.selfBrowserSurface="include",v&&(Sn(v,"surfaceSwitching",["exclude","include"]),E.surfaceSwitching=v)),(MT(105)||GN(105)||zN(91))&&y&&(Sn(y,"systemAudio",["exclude","include"]),E.systemAudio=y),m.electronScreenSourceId&&(E.sourceId=m.electronScreenSourceId);const A=m.encoderConfig?cy(m.encoderConfig):null;return E.mandatory={chromeMediaSource:"desktop",maxWidth:A?A.width:void 0,maxHeight:A?A.height:void 0},A&&(A.frameRate&&(typeof A.frameRate=="number"?(E.mandatory.maxFrameRate=A.frameRate,E.mandatory.minFrameRate=A.frameRate):(E.mandatory.maxFrameRate=A.frameRate.max||A.frameRate.ideal||A.frameRate.exact||void 0,E.mandatory.minFrameRate=A.frameRate.min||A.frameRate.ideal||A.frameRate.exact||void 0),E.frameRate=A.frameRate),A.width&&(E.width=A.width),A.height&&(E.height=A.height)),E}(e),a=Rt(8,"track-scr-v-");let c=null,d=null;const u=Ze();if(!u.supportShareAudio&&t==="enable"){const m=new q(O.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(m),m.throw(T)}T.info("start create screen video track with config",e,"withAudio",t,"trackId",a);try{const m=await di({screen:i,screenAudio:t==="auto"?u.supportShareAudio:t==="enable"},a);c=m.getVideoTracks()[0]||null,d=m.getAudioTracks()[0]||null}catch(m){throw n.onError(m),m}if(!c){const m=new q(O.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(m),m.throw(T)}if(!d&&t==="enable"){c&&c.stop();const m=new q(O.SHARE_AUDIO_NOT_ALLOWED);return n.onError(m),m.throw(T)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(Ty(a,c,e,e.encoderConfig&&cy(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const p=new wt(c,e.encoderConfig?cy(e.encoderConfig):{},e.scalabiltyMode?Gm(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,a,[Ot.SCREEN_TRACK]);if(r&&p.startMonitorStats(),!d)return n.onSuccess(p.getTrackId()),T.info("create screen video track success","video:",p.getTrackId()),p;const f=new qt(d,void 0,Rt(8,"track-scr-a-"),!1);return n.onSuccess([p.getTrackId(),f.getTrackId()]),T.info("create screen video track success","video:",p.getTrackId(),"audio:",f.getTrackId()),[p,f]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=P("CAMERA_CAPTURE_CONFIG"),r=ye.reportApiInvoke(null,{tag:Kt.TRACER,name:ln.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const i=t.encoderConfig==="720p_auto",a=zm(t),c=XP(e),d=Rt(8,"track-mic-"),u=Rt(8,"track-cam-");let p=null,f=null;T.info("start create camera video track(".concat(u,") and microphone audio track(").concat(d,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const S=await di({audio:c,video:a},"".concat(d,"-").concat(u));p=S.getAudioTracks()[0],f=S.getVideoTracks()[0]}catch(S){throw r.onError(S),S}if(!p||!f){const S=new q(O.UNEXPECTED_ERROR,"can not find tracks in media stream");return r.onError(S),S.throw(T)}t.optimizationMode&&Ty(u,f,t,ps(t.encoderConfig));const m=new Ym(p,e,c,d),E=new Sy(f,t,a,t.scalabiltyMode?Gm(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,u);return i&&E.startMonitorStats(),r.onSuccess([m.getTrackId(),E.getTrackId()]),T.info("create camera video track(".concat(u,") and microphone audio track(").concat(d,") success")),[m,E]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=ye.reportApiInvoke(null,{tag:Kt.TRACER,name:ln.CREATE_MIC_AUDIO_TRACK,options:[e]}),n=XP(e),r=Rt(8,"track-mic-");let i=null;T.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{i=(await di({audio:n},r)).getAudioTracks()[0]||null}catch(c){throw t.onError(c),c}if(!i){const c=new q(O.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(c),c.throw(T)}const a=new Ym(i,e,n,r);return t.onSuccess(a.getTrackId()),T.info("create microphone audio track success, trackId:",r),a},createCustomAudioTrack:function(e){const t=ye.reportApiInvoke(null,{tag:Kt.TRACER,name:ln.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new qt(e.mediaStreamTrack,e.encoderConfig?Wm(e.encoderConfig):{},Rt(8,"track-cus-"),!1);return T.info("create custom audio track success with config",e,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:r}=e;let{source:i}=e;const a={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":i,cacheOnlineFile:n,encoderConfig:r},c=ye.reportApiInvoke(null,{tag:Kt.TRACER,name:ln.CREATE_BUFFER_AUDIO_TRACK,options:[a]});if(P("DISABLE_WEBAUDIO"))throw new q(O.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const d=Rt(8,"track-buf-");T.info("start create buffer source audio track with config",JSON.stringify(a),"trackId",d);const u=i;if(!(i instanceof AudioBuffer))try{i=await async function(m,E){let S=null;if(typeof m=="string"){const v=xL.get(m);if(v)return T.debug("use cached audio resource: ",m),v;try{S=(await Ro(()=>yr.get(m,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(y){throw new q(O.FETCH_AUDIO_FILE_FAILED,y.toString())}}else S=await new ae((y,A)=>{const N=new FileReader;N.onload=V=>{V.target?y(V.target.result):A(new q(O.READ_LOCAL_AUDIO_FILE_ERROR))},N.onerror=()=>{A(new q(O.READ_LOCAL_AUDIO_FILE_ERROR))},N.readAsArrayBuffer(m)});const I=await function(v){const y=Sl();return new ae((A,N)=>{y.decodeAudioData(v,V=>{A(V)},V=>{N(new q(O.DECODE_AUDIO_FILE_FAILED,V.toString()))})})}(S);return typeof m=="string"&&E&&xL.set(m,I),I}(i,n)}catch(m){return c.onError(m),m.throw(T)}const p=new $J(i),f=new ZJ(u,p,r?Wm(r):{},d);return T.info("create buffer source audio track success, trackId:",d),c.onSuccess(f.getTrackId()),f},setAppType:function(e){if(T.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw T.debug("Invalid appType"),new B(O.INVALID_PARAMS,"invalid app type",e);Tt("APP_TYPE",Math.floor(e))},setLogLevel:function(e){T.setLogLevel(e)},enableLogUpload:function(){P("USE_NEW_LOG")?Tt("UPLOAD_LOG",!0):T.enableLogUpload()},disableLogUpload:function(){P("USE_NEW_LOG")?Tt("UPLOAD_LOG",!1):T.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new v2},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=ye.reportApiInvoke(null,{tag:Kt.TRACER,name:ln.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof qt||e instanceof yl)){const u=new B(O.INVALID_TRACK,"the parameter is not a audio track");return n.onError(u),u.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof qt?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let a=i,c=i;const d=Date.now();return new ae(u=>{const p=setInterval(()=>{const f=e.getVolumeLevel();a=f>a?f:a,c=f<c?f:c;const m=a-c>1e-4,E=Date.now()-d;if(m||E>t){clearInterval(p);const S=m,I={duration:E,deviceLabel:r,maxVolumeLevel:a,result:S};T.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(I))),n.onSuccess(I),u(S)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=ye.reportApiInvoke(null,{tag:Kt.TRACER,name:ln.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof wt||e instanceof vl)){const m=new B(O.INVALID_TRACK,"the parameter is not a video track");return n.onError(m),m.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof wt?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),a=document.createElement("video");a.style.width="1px",a.style.height="1px",a.setAttribute("muted",""),a.muted=!0,a.setAttribute("playsinline",""),a.controls=!1,(Cn()||em())&&(a.style.opacity="0.01",a.style.position="fixed",a.style.left="0",a.style.top="0",document.body.appendChild(a)),a.srcObject=new MediaStream([i]),a.play();const c=document.createElement("canvas");c.width=160,c.height=120;let d=0,u=0;try{const m=Date.now();d=await function(E,S,I,v){let y,A=0,N=null;return new ae((V,F)=>{function G(){A>v&&y&&(y(),V(A));const z=I.getContext("2d");if(!z){const ee=new B(O.UNEXPECTED_ERROR,"can not get canvas 2d context.");return T.error(ee.toString()),void F(ee)}z.drawImage(E,0,0,160,120);const Q=z.getImageData(0,0,I.width,I.height),Z=Math.floor(Q.data.length/3);if(N){for(let ee=0;ee<Z;ee+=3)if(Q.data[ee]!==N[ee])return A+=1,void(N=Q.data);N=Q.data}else N=Q.data}setTimeout(()=>{y&&(y(),V(A))},S),y=py(()=>{G()},30)})}(a,t,c,4),u=Date.now()-m}catch(m){throw n.onError(m),m}$X===dt.SAFARI&&(a.pause(),a.remove()),a.srcObject=null;const p=d>4,f={duration:u,changedPicNum:d,deviceLabel:r,result:p};return T.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(f))),n.onSuccess(f),p},setArea:hv,audioElementPlayCenter:Rr,resumeAudioContext:function(){Rr.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){oQ.processExternalMediaAEC(e)},registerExtensions:function(e){const t=P("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!le(t).call(t,n.name)&&t.push(n.name);const r=n;r.__registered__=!0,r.logger.hookLog=T.extLog,r.reporter.hookApiInvoke=ye.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(i=>{r.parameters[i]=P(i)})}),px("PLUGIN_INFO",t)},ChannelMediaRelayError:Xd,ChannelMediaRelayEvent:Ds,ChannelMediaRelayState:Nr,RemoteStreamFallbackType:KJ,RemoteStreamType:HJ,ConnectionDisconnectedReason:qe,AudienceLatencyLevelType:rz,AREAS:ot,preload:async function(e,t,n,r){return pM(e,t,n,r)}});return Object.defineProperties(pn,{onAudioAutoplayFailed:{get:()=>ui.onAudioAutoplayFailed,set:e=>{ui.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>ui.onAutoplayFailed,set:e=>{ui.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>pn._onSecurityPolicyViolation,set(e){pn._onSecurityPolicyViolation=e,hx(e)}},__CLIENT_LIST__:{get:()=>P("SHOW_GLOBAL_CLIENT_LIST")?_a:[]}}),li.on(Fc.CAMERA_DEVICE_CHANGED,e=>{T.info("camera device changed",JSON.stringify(e)),pn.onCameraChanged&&pn.onCameraChanged(e),pn.safeEmit(as.CAMERA_CHANGED,e)}),li.on(Fc.RECORDING_DEVICE_CHANGED,e=>{T.info("microphone device changed",JSON.stringify(e)),pn.onMicrophoneChanged&&pn.onMicrophoneChanged(e),pn.safeEmit(as.MICROPHONE_CHANGED,e)}),li.on(Fc.PLAYOUT_DEVICE_CHANGED,e=>{T.debug("playout device changed",JSON.stringify(e)),pn.onPlaybackDeviceChanged&&pn.onPlaybackDeviceChanged(e),pn.safeEmit(as.PLAYBACK_DEVICE_CHANGED,e)}),Rr.onAutoplayFailed=()=>{T.info("detect audio element autoplay failed"),ui.onAudioAutoplayFailed&&ui.onAudioAutoplayFailed()},Et.on("autoplay-failed",()=>{T.info("detect webaudio autoplay failed"),ui.onAudioAutoplayFailed&&ui.onAudioAutoplayFailed(),pn.safeEmit(as.AUTOPLAY_FAILED)}),Et.on(xn.STATE_CHANGE,(e,t)=>{T.info("audio context state changed: ".concat(t," => ").concat(e)),pn.onAudioContextStateChanged&&pn.onAudioContextStateChanged(e,t),pn.safeEmit(as.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),zt.on(vc.NETWORK_STATE_CHANGE,(e,t)=>{T.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=pn),pn})})(b4);var D4=b4.exports;const zl=xR(D4),Uee=()=>{const[o,s]=we.useState({localAudioTrack:null,localVideoTrack:null,client:null}),l="fa3a10495b62421c8f7179b868b65feb",h="007eJxTYNAyvby/T2n2nseXrlQyrolY+Tnx7N3qX4zBiwJOsnuGihsoMKQlGicaGphYmiaZGZkYGSZbpJkbmlsmWZhZJJmZpqUmeb6aktYQyMiwP8CCkZEBAkF8NoakxMrcxAoGBgDC9yCW",_="baymax",g=()=>{let D=localStorage.getItem("uid");if(!D){let M=localStorage.getItem("lastUID");M=M?parseInt(M)+1:1,D=M.toString().padStart(5,"0"),localStorage.setItem("uid",D),localStorage.setItem("lastUID",M)}return D},C=async()=>{const D=g(),M=zl.createClient({mode:"live",codec:"vp8",clientRoleOptions:{level:zl.AudienceLatencyLevelType.AUDIENCE_LEVEL_LOW_LATENCY}});try{M.setClientRole("host"),console.log("APP_ID",l,"CHANNEL",_),await M.join(l,_,h,D);const j=await zl.createMicrophoneAudioTrack(),x=await zl.createCameraVideoTrack();await M.publish([j,x]);const W=document.createElement("div");W.id=D,W.textContent="Local user "+D,W.style.width="640px",W.style.height="480px",document.body.append(W),x.play(W),console.log("Host joined successfully with UID:",D),s({client:M,localAudioTrack:j,localVideoTrack:x})}catch(j){console.error("Failed to join as host:",j)}},b=async()=>{const{client:D,localAudioTrack:M,localVideoTrack:j}=o;try{M&&M.close(),j&&j.close();const x=document.getElementById(g());x&&x.remove(),D&&D.remoteUsers&&D.remoteUsers.forEach(W=>{const te=document.getElementById(W.uid);te&&te.remove()}),D&&await D.leave(),console.log("Stream ended successfully!")}catch(x){console.error("Failed to end the stream:",x)}finally{window.location.href="/"}};return L.jsx("div",{className:"container mt-5",children:L.jsxs("div",{className:"text-center",children:[L.jsx("h1",{className:"display-4 mb-4",children:"Camera Page"}),L.jsx("p",{children:"This page is the UI page for the camera at home."}),L.jsxs("div",{className:"btn-group",role:"group",children:[L.jsx("button",{className:"btn btn-primary",onClick:C,children:"Join as Host"}),L.jsx("button",{className:"btn btn-danger",onClick:b,children:"Leave"})]})]})})};var P4={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},LU=Ys.createContext&&Ys.createContext(P4),Vee=["attr","size","title"];function jee(o,s){if(o==null)return{};var l=Fee(o,s),h,_;if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);for(_=0;_<g.length;_++)h=g[_],!(s.indexOf(h)>=0)&&Object.prototype.propertyIsEnumerable.call(o,h)&&(l[h]=o[h])}return l}function Fee(o,s){if(o==null)return{};var l={};for(var h in o)if(Object.prototype.hasOwnProperty.call(o,h)){if(s.indexOf(h)>=0)continue;l[h]=o[h]}return l}function DE(){return DE=Object.assign?Object.assign.bind():function(o){for(var s=1;s<arguments.length;s++){var l=arguments[s];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(o[h]=l[h])}return o},DE.apply(this,arguments)}function kU(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(o);s&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,h)}return l}function PE(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?kU(Object(l),!0).forEach(function(h){Bee(o,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):kU(Object(l)).forEach(function(h){Object.defineProperty(o,h,Object.getOwnPropertyDescriptor(l,h))})}return o}function Bee(o,s,l){return s=Gee(s),s in o?Object.defineProperty(o,s,{value:l,enumerable:!0,configurable:!0,writable:!0}):o[s]=l,o}function Gee(o){var s=Wee(o,"string");return typeof s=="symbol"?s:s+""}function Wee(o,s){if(typeof o!="object"||!o)return o;var l=o[Symbol.toPrimitive];if(l!==void 0){var h=l.call(o,s||"default");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(o)}function L4(o){return o&&o.map((s,l)=>Ys.createElement(s.tag,PE({key:l},s.attr),L4(s.child)))}function fu(o){return s=>Ys.createElement(Hee,DE({attr:PE({},o.attr)},s),L4(o.child))}function Hee(o){var s=l=>{var{attr:h,size:_,title:g}=o,C=jee(o,Vee),b=_||l.size||"1em",D;return l.className&&(D=l.className),o.className&&(D=(D?D+" ":"")+o.className),Ys.createElement("svg",DE({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},l.attr,h,C,{className:D,style:PE(PE({color:o.color||l.color},l.style),o.style),height:b,width:b,xmlns:"http://www.w3.org/2000/svg"}),g&&Ys.createElement("title",null,g),o.children)};return LU!==void 0?Ys.createElement(LU.Consumer,null,l=>s(l)):s(P4)}function Kee(o){return fu({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M332.8 320h38.4c6.4 0 12.8-6.4 12.8-12.8V172.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v134.4c0 6.4 6.4 12.8 12.8 12.8zm96 0h38.4c6.4 0 12.8-6.4 12.8-12.8V76.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v230.4c0 6.4 6.4 12.8 12.8 12.8zm-288 0h38.4c6.4 0 12.8-6.4 12.8-12.8v-70.4c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v70.4c0 6.4 6.4 12.8 12.8 12.8zm96 0h38.4c6.4 0 12.8-6.4 12.8-12.8V108.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v198.4c0 6.4 6.4 12.8 12.8 12.8zM496 384H64V80c0-8.84-7.16-16-16-16H16C7.16 64 0 71.16 0 80v336c0 17.67 14.33 32 32 32h464c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16z"},child:[]}]})(o)}function zee(o){return fu({tag:"svg",attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"},child:[]}]})(o)}function Yee(o){return fu({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(o)}function qee(o){return fu({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 255.531c.253 136.64-111.18 248.372-247.82 248.468-59.015.042-113.223-20.53-155.822-54.911-11.077-8.94-11.905-25.541-1.839-35.607l11.267-11.267c8.609-8.609 22.353-9.551 31.891-1.984C173.062 425.135 212.781 440 256 440c101.705 0 184-82.311 184-184 0-101.705-82.311-184-184-184-48.814 0-93.149 18.969-126.068 49.932l50.754 50.754c10.08 10.08 2.941 27.314-11.313 27.314H24c-8.837 0-16-7.163-16-16V38.627c0-14.254 17.234-21.393 27.314-11.314l49.372 49.372C129.209 34.136 189.552 8 256 8c136.81 0 247.747 110.78 248 247.531zm-180.912 78.784l9.823-12.63c8.138-10.463 6.253-25.542-4.21-33.679L288 256.349V152c0-13.255-10.745-24-24-24h-16c-13.255 0-24 10.745-24 24v135.651l65.409 50.874c10.463 8.137 25.541 6.253 33.679-4.21z"},child:[]}]})(o)}function Jee(o){return fu({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"},child:[]}]})(o)}function Xee(o){return fu({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(o)}const mu=()=>L.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-base-100 shadow-lg p-4 flex justify-around items-center rounded-t-lg",children:[L.jsx(B_,{icon:L.jsx(Jee,{}),label:"Home",to:"/user-home"}),L.jsx(B_,{icon:L.jsx(qee,{}),label:"History",to:"/histories"}),L.jsx(B_,{icon:L.jsx(Kee,{}),label:"Statistics"}),L.jsx(B_,{icon:L.jsx(Xee,{}),label:"Profile",to:"/profile"})]}),B_=({icon:o,label:s,to:l})=>L.jsxs(id,{to:l,className:"flex flex-col items-center",children:[L.jsx("div",{className:"text-2xl text-primary mb-1",children:o}),L.jsx("span",{className:" font-lato text-primary font-bold text-xs",children:s})]}),Qee=({title:o,count:s})=>{const l=h=>h===0?"bg-neutral text-primary":"bg-accent text-white";return L.jsx("div",{children:L.jsxs("div",{className:"absolute inset-0 flex p-8 text-black",children:[L.jsx("div",{className:"text-left",children:L.jsx("h3",{className:"text-lg font-bold",children:o})}),L.jsx("div",{className:`absolute right-10 top-7 text-right w-10 h-10 rounded-full ${l(s)}`,children:L.jsx("div",{className:" absolute right-3.5 top-1",children:L.jsxs("h3",{className:"font-bold text-xl",children:[s," "]})})})]})})};function Zee(){var M,j;const o=hu(),s=pu(),[l,h]=we.useState(((M=o.state)==null?void 0:M.userData)||JSON.parse(localStorage.getItem("user-data")));console.log(l);const _=((j=l==null?void 0:l.user)==null?void 0:j.cameras)||[],g=_.filter(x=>x.status==="Live").length,[C,b]=we.useState("");we.useEffect(()=>{const x=new Date().getHours();x<12?b("Good Morning"):x<18?b("Good Afternoon"):b("Good Evening")},[]);const D=x=>{s(`/camera/${x.id}`,{state:{cameraData:x}})};return L.jsxs("div",{className:"font-ubuntu p-8 py-16",children:[L.jsx("h1",{className:"text-2xl text-primary font-bold mb-4",children:C}),L.jsxs("p",{className:"text-lg text-gray-600 mb-6",children:[g," Active Device"]}),L.jsx("div",{children:["Live","Not Live"].map(x=>L.jsxs("div",{className:"mb-8",children:[L.jsx("h2",{className:"text-xl font-semibold mb-4",children:x}),L.jsx("div",{className:"grid grid-cols-1 gap-4",children:_.filter(W=>W.status===x).map(W=>L.jsx("div",{onClick:()=>D(W),className:"relative rounded-3xl overflow-hidden shadow-lg cursor-pointer",style:{height:"200px",backgroundImage:`url(${W.image})`,backgroundSize:"cover",backgroundPosition:"center"},children:L.jsx(Qee,{title:W.camera_name,count:W.notifCount})},W.id))})]},x))}),L.jsx(mu,{})]})}const $ee=()=>L.jsxs("div",{className:"font-ubuntu p-4 py-8 flex flex-col h-screen",children:[L.jsxs("div",{className:"flex-grow overflow-auto p-4",children:[L.jsxs("div",{className:"flex flex-row justify-between",children:[L.jsx("h1",{className:"text-2xl text-primary font-bold mb-4",children:"Edit Your Particulars"}),L.jsx(id,{to:"/profile",children:L.jsx("h1",{className:"text-2xl text-primary font-medium mb-4",children:"Done"})})]}),L.jsx("div",{className:"flex justify-center avatar",children:L.jsx("div",{className:"ring-primary ring-offset-base-100 w-24 rounded-full w-36 h-36",children:L.jsx("img",{src:"https://img.daisyui.com/images/stock/photo-1534528741775-53994a69daeb.jpg"})})}),L.jsxs("label",{htmlFor:"doc",className:"flex justify-center p-5",children:[L.jsx("span",{className:"text-2xl text-primary-content cursor-pointer",children:"Set New Photo"}),L.jsx("input",{type:"file",id:"doc",name:"doc",accept:"image/png, image/jpeg",hidden:!0})]}),L.jsx("div",{className:"flex justify-center py-4",children:L.jsxs("div",{class:"card w-96 h-24 rounded-xl bg-white shadow rounded-badge",children:[L.jsxs("div",{class:"card h-12 px-4 flex flex-row items-center",children:[L.jsx("input",{type:"text",placeholder:"First Name",className:`input input-ghost w-full bg-transparent
                                focus:outline-none focus:border-none 
                                font-lato font-semibold text-xl`}),L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:L.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]}),L.jsx("div",{class:"divider divider-start text-white m-0 h-0",children:":P"}),L.jsxs("div",{class:"card h-12 px-4 flex flex-row items-center",children:[L.jsx("input",{type:"text",placeholder:"Last Name",className:`input input-ghost w-full bg-transparent
                                focus:outline-none focus:border-none 
                                font-lato font-semibold text-xl`}),L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:L.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]}),L.jsx("a",{className:"font-lato text-info text-sm px-4 py-1",children:"Enter your name and add an optional profile picture"})]})}),L.jsx("div",{className:"flex justify-center py-8",children:L.jsxs("div",{class:"card w-96 h-24 rounded-xl bg-white shadow rounded-badge",children:[L.jsxs("div",{class:"card h-full px-4 flex flex-row items-center",children:[L.jsx("div",{className:"flex-1 px-4 text-xl font-lato text-primary font-semibold",children:"Change Email"}),L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:L.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]}),L.jsx("div",{class:"divider divider-start text-white m-0 h-0",children:":P"}),L.jsxs("div",{class:"card h-full px-4 flex flex-row items-center",children:[L.jsx("div",{className:"flex-1 px-4 text-xl font-lato text-primary font-semibold",children:"Change Number"}),L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:L.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]})]})})]}),L.jsx(mu,{})]}),ete=()=>{const[o,s]=we.useState(!1),l=()=>{s(!o)};return L.jsxs("div",{className:"font-ubuntu p-4 py-8 flex flex-col h-screen",children:[L.jsxs("div",{className:"flex-grow overflow-auto p-4",children:[L.jsxs("div",{className:"flex flex-row justify-between",children:[L.jsx("h1",{className:"text-2xl text-primary font-bold mb-4",children:"Edit Your Account Settings"}),L.jsx(id,{to:"/profile",children:L.jsx("h1",{className:"text-2xl text-primary font-medium mb-4",children:"Done"})})]}),L.jsx("div",{className:"flex justify-center py-4",children:L.jsxs("div",{className:"card w-96 h-24 rounded-xl bg-white shadow rounded-badge",children:[L.jsxs("div",{className:"card h-12 px-4 flex flex-row items-center",children:[L.jsx("input",{type:"text",placeholder:"Username",className:"input input-ghost w-full bg-transparent focus:outline-none focus:border-none font-lato font-regular text-xl placeholder-primary"}),L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:L.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]}),L.jsx("div",{className:"divider divider-start text-white m-0 h-0",children:":P"}),L.jsxs("div",{className:"card h-12 px-4 flex flex-row justify-between items-center",children:[L.jsx("input",{type:o?"text":"password",placeholder:"Password",className:"input input-ghost w-full bg-transparent focus:outline-none focus:border-none font-lato font-regular text-xl placeholder-primary"}),L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"19",height:"13",viewBox:"0 0 19 13",fill:"none",onClick:l,className:"cursor-pointer",children:L.jsx("path",{fill:"#C3C6CF",d:o?"M10 2C6.13 2 2.73 4.11 1 7.5C2.73 10.89 6.13 13 10 13C13.87 13 17.27 10.89 19 7.5C17.27 4.11 13.87 2 10 2ZM10 11C8.34 11 7 9.66 7 8C7 6.34 8.34 5 10 5C11.66 5 13 6.34 13 8C13 9.66 11.66 11 10 11ZM10 6.5C9.17 6.5 8.5 7.17 8.5 8C8.5 8.83 9.17 9.5 10 9.5C10.83 9.5 11.5 8.83 11.5 8C11.5 7.17 10.83 6.5 10 6.5Z":"M19.71 18.29L15.3 13.88C14.57 14.39 13.81 14.82 13 15.17V17H7V15.17C4.88 14.39 2.88 12.88 1.3 11.12L0 12.42L1.41 13.83C3.21 15.61 6.4 18.5 10 18.5C13.6 18.5 16.79 15.61 18.59 13.83L20 12.42L19.71 12.12L19.71 18.29ZM12.83 10.5H7.17L12.83 15.5H12.83V10.5ZM19.41 8.41L18 7C16.2 5.21 13.01 2.32 9.41 2.32C5.81 2.32 2.62 5.21 0.82 7L0 7.82L1.41 9.23C3.21 11.02 6.4 13.91 10 13.91C13.6 13.91 16.79 11.02 18.59 9.23L20 7.82L19.41 8.41Z"})}),L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:L.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]}),L.jsx("a",{className:"font-lato text-info text-sm px-4 py-1",children:"Change your username and view your current password"})]})}),L.jsx("div",{className:"flex flex-col items-center py-8",children:L.jsxs("div",{className:"w-96",children:[L.jsx("h1",{className:"text-2xl text-primary font-bold mb-4 px-4 text-left",children:"Change your Password"}),L.jsx("input",{type:"text",placeholder:"Current Password",class:`input w-full max-w shadow focus:shadow shadow-neutral focus:shadow-neutral font-lato text-lg font-normal gap-4
                        bg-white focus:outline-none border-secondary-content focus:border-secondary-content`}),L.jsx("div",{className:"py-2"}),L.jsx("input",{type:"text",placeholder:"New Password",class:`input w-full max-w shadow focus:shadow shadow-neutral focus:shadow-neutral font-lato text-lg font-normal
                        bg-white focus:outline-none border-secondary-content focus:border-secondary-content`}),L.jsx("div",{className:"py-2"}),L.jsx("input",{type:"text",placeholder:"Retype Password",class:`input w-full max-w shadow focus:shadow shadow-neutral focus:shadow-neutral font-lato text-lg font-normal
                        bg-white focus:outline-none border-secondary-content focus:border-secondary-content`}),L.jsx("div",{className:"py-4"}),L.jsx("button",{type:"submit",className:"w-full bg-primary text-white py-2 rounded-full hover:bg-primary font-ubunut font-bold text-xl",children:"Change Password"}),L.jsx("div",{className:"py-10"}),L.jsx("button",{type:"submit",className:"w-full bg-error text-white py-2 rounded-full hover:bg-error font-ubunut font-bold text-xl",children:"Delete Account"})]})})]}),L.jsx(mu,{})]})},tte=()=>L.jsxs("div",{className:"font-ubuntu p-4 py-8 flex flex-col h-screen",children:[L.jsxs("div",{className:"flex-grow overflow-auto p-4",children:[L.jsxs("div",{className:"flex flex-row justify-between",children:[L.jsx("h1",{className:"text-2xl text-primary font-bold mb-4",children:"Edit Camera's"}),L.jsx(id,{to:"/profile",children:L.jsx("h1",{className:"text-2xl text-primary font-medium mb-4",children:"Done"})})]}),L.jsx("div",{className:"flex justify-center py-4",children:L.jsxs("div",{className:"card w-96 h-12 rounded-xl shadow rounded-badge flex flex-row items-center justify-between bg-white outline outline-secondary-content font-lato font-semibold text-lg text-primary",children:[L.jsx("span",{className:"px-4",children:"Bedroom"}),L.jsx("div",{className:"px-4",children:L.jsx("button",{className:"btn btn-circle btn-outline btn-error btn-xs",children:L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:L.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})})]})}),L.jsx("div",{className:"flex justify-center py-4",children:L.jsxs("div",{className:"card w-96 h-12 rounded-xl shadow rounded-badge flex flex-row items-center justify-between bg-white outline outline-secondary-content font-lato font-semibold text-lg text-primary",children:[L.jsx("span",{className:"px-4",children:"Living Room"}),L.jsx("div",{className:"px-4",children:L.jsx("button",{className:"btn btn-circle btn-outline btn-error btn-xs",children:L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:L.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})})]})}),L.jsx("div",{className:"flex justify-center py-4",children:L.jsxs("div",{className:"card w-96 h-12 rounded-xl shadow rounded-badge flex flex-row items-center justify-between bg-white outline outline-secondary-content font-lato font-semibold text-lg text-primary",children:[L.jsx("span",{className:"px-4",children:"Child Room"}),L.jsx("div",{className:"px-4",children:L.jsx("button",{className:"btn btn-circle btn-outline btn-error btn-xs",children:L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:L.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})})]})}),L.jsx("div",{className:"flex justify-center py-4 flex flex-col items-center",children:L.jsx("button",{class:"btn rounded-xl btn-active btn-outline w-96 bg-white outline-neutral font-lato text-lg",children:"+ Add New Camera"})})]}),L.jsx(mu,{})]}),nte=()=>L.jsxs("div",{className:"font-ubuntu p-4 py-8 flex flex-col h-screen",children:[L.jsxs("div",{className:"flex-grow overflow-auto p-4",children:[L.jsx("h1",{className:"text-2xl text-primary font-bold mb-4",children:"Profile Page"}),L.jsx("div",{className:"flex justify-center avatar",children:L.jsx("div",{className:"ring-primary ring-offset-base-100 w-24 rounded-full w-36 h-36",children:L.jsx("img",{src:"https://img.daisyui.com/images/stock/photo-1534528741775-53994a69daeb.jpg"})})}),L.jsx("h2",{className:"text-2xl text-primary font-bold flex justify-center p-5",children:"Username"}),L.jsx("div",{className:"flex justify-center py-2",children:L.jsxs("div",{class:"card w-96 h-24 rounded-xl bg-white shadow rounded-badge",children:[L.jsx(id,{to:"/profile/particulars",children:L.jsxs("div",{class:"card h-12 px-4 flex flex-row items-center",children:[L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 25 25",fill:"none",children:L.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",fill:"#254777",d:"M12.5 2.5C10.751 2.49968 9.03241 2.95811 7.5159 3.82953C5.99939 4.70096 4.73797 5.95489 3.85753 7.46619C2.97709 8.97748 2.50844 10.6933 2.49834 12.4423C2.48825 14.1913 2.93707 15.9124 3.80001 17.4337C4.38327 16.6757 5.13305 16.062 5.99136 15.64C6.84968 15.218 7.79355 14.999 8.75 15H16.25C17.2064 14.999 18.1503 15.218 19.0086 15.64C19.867 16.062 20.6167 16.6757 21.2 17.4337C22.0629 15.9124 22.5117 14.1913 22.5017 12.4423C22.4916 10.6933 22.0229 8.97748 21.1425 7.46619C20.262 5.95489 19.0006 4.70096 17.4841 3.82953C15.9676 2.95811 14.249 2.49968 12.5 2.5ZM22.4287 20.095C24.1 17.9162 25.004 15.2459 25 12.5C25 5.59625 19.4037 0 12.5 0C5.59626 0 1.40665e-05 5.59625 1.40665e-05 12.5C-0.00411273 15.246 0.899895 17.9162 2.57126 20.095L2.56501 20.1175L3.00876 20.6337C4.18112 22.0044 5.63674 23.1045 7.2753 23.8583C8.91385 24.6121 10.6964 25.0016 12.5 25C15.0342 25.0046 17.5092 24.2349 19.5937 22.7937C20.4824 22.1797 21.2882 21.4538 21.9912 20.6337L22.435 20.1175L22.4287 20.095ZM12.5 5C11.5054 5 10.5516 5.39508 9.84835 6.09834C9.14509 6.80161 8.75 7.75543 8.75 8.74999C8.75 9.74455 9.14509 10.6984 9.84835 11.4016C10.5516 12.1049 11.5054 12.5 12.5 12.5C13.4946 12.5 14.4484 12.1049 15.1516 11.4016C15.8549 10.6984 16.25 9.74455 16.25 8.74999C16.25 7.75543 15.8549 6.80161 15.1516 6.09834C14.4484 5.39508 13.4946 5 12.5 5Z"})}),L.jsx("div",{className:"flex-1 px-4 text-xl font-lato text-primary font-semibold",children:"Edit Your Particulars"}),L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:L.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]})}),L.jsx("div",{class:"divider divider-start text-white m-0 h-0",children:"boo"}),L.jsx(id,{to:"/profile/accsettings",children:L.jsxs("div",{class:"card h-12 px-4 flex flex-row items-center",children:[L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 25 25",fill:"none",children:L.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",fill:"#254777",d:"M14.8408 0.19C14.354 -5.58794e-08 13.7356 0 12.5001 0C11.2646 0 10.6475 -5.58794e-08 10.1593 0.19C9.51128 0.442764 8.99541 0.929707 8.72518 1.54375C8.60149 1.8225 8.55413 2.14875 8.53439 2.6225C8.52562 2.96575 8.42483 3.30121 8.24157 3.59715C8.0583 3.89309 7.79861 4.13973 7.48705 4.31375C7.16962 4.48138 6.81279 4.57018 6.44962 4.57193C6.08644 4.57368 5.72868 4.48831 5.40948 4.32375C4.96475 4.10125 4.64239 3.97875 4.32398 3.93875C3.62736 3.85185 2.9228 4.02975 2.36351 4.43375C1.9451 4.73625 1.6359 5.24125 1.01881 6.25C0.400404 7.25875 0.0925179 7.7625 0.022783 8.25625C-0.0693198 8.91375 0.120149 9.57875 0.549084 10.105C0.743816 10.345 1.01881 10.5463 1.4438 10.7987C2.07141 11.17 2.47403 11.8025 2.47403 12.5C2.47403 13.1975 2.07141 13.83 1.44511 14.2C1.01881 14.4537 0.743816 14.655 0.547768 14.895C0.336041 15.1549 0.180633 15.4521 0.0905237 15.7695C0.000414319 16.0868 -0.0226095 16.4179 0.022783 16.7438C0.0925179 17.2362 0.400404 17.7412 1.01881 18.75C1.63721 19.7588 1.9451 20.2625 2.36351 20.5662C2.92139 20.97 3.62663 21.1475 4.32398 21.0613C4.64239 21.0213 4.96475 20.8988 5.40948 20.6763C5.72884 20.5115 6.08685 20.426 6.45027 20.4277C6.8137 20.4295 7.17077 20.5184 7.48837 20.6862C8.12782 21.0362 8.50676 21.68 8.53439 22.3775C8.55413 22.8525 8.60149 23.1775 8.72518 23.4562C8.99359 24.0687 9.50937 24.5562 10.1593 24.81C10.6462 25 11.2646 25 12.5001 25C13.7356 25 14.354 25 14.8408 24.81C15.4889 24.5572 16.0047 24.0703 16.275 23.4562C16.3987 23.1775 16.446 22.8525 16.4658 22.3775C16.4921 21.68 16.8723 21.035 17.5131 20.6862C17.8305 20.5186 18.1874 20.4298 18.5505 20.4281C18.9137 20.4263 19.2715 20.5117 19.5907 20.6763C20.0354 20.8988 20.3578 21.0213 20.6762 21.0613C21.3735 21.1488 22.0788 20.97 22.6366 20.5662C23.055 20.2637 23.3642 19.7588 23.9813 18.75C24.5997 17.7412 24.9076 17.2375 24.9774 16.7438C25.0226 16.4178 24.9993 16.0867 24.909 15.7693C24.8187 15.452 24.663 15.1548 24.4511 14.895C24.2563 14.655 23.9813 14.4537 23.5563 14.2013C22.9287 13.83 22.5261 13.1975 22.5261 12.5C22.5261 11.8025 22.9287 11.17 23.555 10.8C23.9813 10.5463 24.2563 10.345 24.4524 10.105C24.6641 9.84507 24.8195 9.54786 24.9096 9.23054C24.9997 8.91322 25.0228 8.58208 24.9774 8.25625C24.9076 7.76375 24.5997 7.25875 23.9813 6.25C23.3629 5.24125 23.055 4.7375 22.6366 4.43375C22.0773 4.02975 21.3728 3.85185 20.6762 3.93875C20.3578 3.97875 20.0354 4.10125 19.5907 4.32375C19.2713 4.48854 18.9133 4.57402 18.5499 4.57227C18.1864 4.57052 17.8294 4.4816 17.5118 4.31375C17.2005 4.13958 16.941 3.89287 16.758 3.59694C16.575 3.30101 16.4744 2.96563 16.4658 2.6225C16.446 2.1475 16.3987 1.8225 16.275 1.54375C16.1412 1.23967 15.9457 0.963603 15.6997 0.731322C15.4536 0.499041 15.1617 0.315097 14.8408 0.19ZM12.5001 16.25C14.6974 16.25 16.4776 14.5712 16.4776 12.5C16.4776 10.4288 14.6961 8.75 12.5001 8.75C10.3028 8.75 8.52255 10.4288 8.52255 12.5C8.52255 14.5712 10.3041 16.25 12.5001 16.25Z"})}),L.jsx("div",{className:"flex-1 px-4 text-xl font-lato text-primary font-semibold",children:"Edit Account Settings"}),L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:L.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]})})]})}),L.jsx("div",{className:"flex justify-center py-2",children:L.jsxs("div",{class:"card w-96 h-24 rounded-xl bg-white shadow rounded-badge",children:[L.jsxs("div",{class:"card h-full px-4 flex flex-row items-center",children:[L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 25 25",fill:"none",children:L.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",fill:"#254777",d:"M12.5 0C5.6 0 0 5.6 0 12.5C0 19.4 5.6 25 12.5 25C19.4 25 25 19.4 25 12.5C25 5.6 19.4 0 12.5 0ZM18.3 8.5C18.1125 10.475 17.3 15.275 16.8875 17.4875C16.7125 18.425 16.3625 18.7375 16.0375 18.775C15.3125 18.8375 14.7625 18.3 14.0625 17.8375C12.9625 17.1125 12.3375 16.6625 11.275 15.9625C10.0375 15.15 10.8375 14.7 11.55 13.975C11.7375 13.7875 14.9375 10.875 15 10.6125C15.0087 10.5727 15.0075 10.5315 14.9966 10.4923C14.9857 10.453 14.9654 10.4171 14.9375 10.3875C14.8625 10.325 14.7625 10.35 14.675 10.3625C14.5625 10.3875 12.8125 11.55 9.4 13.85C8.9 14.1875 8.45 14.3625 8.05 14.35C7.6 14.3375 6.75 14.1 6.1125 13.8875C5.325 13.6375 4.7125 13.5 4.7625 13.0625C4.7875 12.8375 5.1 12.6125 5.6875 12.375C9.3375 10.7875 11.7625 9.7375 12.975 9.2375C16.45 7.7875 17.1625 7.5375 17.6375 7.5375C17.7375 7.5375 17.975 7.5625 18.125 7.6875C18.25 7.7875 18.2875 7.925 18.3 8.025C18.2875 8.1 18.3125 8.325 18.3 8.5Z"})}),L.jsx("div",{className:"flex-1 px-4 text-xl font-lato text-primary font-semibold",children:"Enable Telegram"}),L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:L.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]}),L.jsx("div",{class:"divider divider-start text-white m-0 h-0",children:"boo"}),L.jsxs("div",{class:"card h-full px-4 flex flex-row items-center",children:[L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 25 25",fill:"none",children:L.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",fill:"#254777",d:"M3.925 19.4625C3.925 18.125 5.4 15.625 6.9625 13.5125C8.525 15.625 10 18.125 10 19.4625C10 19.8614 9.92143 20.2564 9.76878 20.6249C9.61613 20.9934 9.39239 21.3283 9.11034 21.6103C8.82828 21.8924 8.49343 22.1161 8.1249 22.2688C7.75637 22.4214 7.36139 22.5 6.9625 22.5C5.2875 22.5 3.925 21.1375 3.925 19.4625ZM25 12.5C25 15.8152 23.683 18.9946 21.3388 21.3388C18.9946 23.683 15.8152 25 12.5 25C11.35 25 10.225 24.825 9.1625 24.5375C10.1538 24.1101 10.9981 23.4017 11.5912 22.4998C12.1844 21.5979 12.5003 20.542 12.5 19.4625C12.5 18.9 12.3625 18.25 12.1125 17.5H12.5C14.0625 17.5 15.4 18.125 15.9625 19.0375L17.7375 17.2625C16.6125 15.9 14.6875 15 12.5 15C11.9875 15 11.4875 15.05 11.0125 15.15C10.475 14.2 9.8125 13.1625 8.9875 12.0375L8.3875 11.25C9.275 11.0875 10 10.2875 10 9.375C10 8.375 9.125 7.5 8.125 7.5C7.125 7.5 6.25 8.375 6.25 9.375C6.25 9.6125 6.3 9.8375 6.3875 10.05L4.95 12.0375C3 14.6875 1.875 16.875 1.5375 18.5125C0.5625 16.725 0 14.675 0 12.5C0 9.18479 1.31696 6.00537 3.66117 3.66117C6.00537 1.31696 9.18479 0 12.5 0C14.1415 0 15.767 0.323322 17.2835 0.951506C18.8001 1.57969 20.1781 2.50043 21.3388 3.66117C22.4996 4.8219 23.4203 6.19989 24.0485 7.71646C24.6767 9.23303 25 10.8585 25 12.5ZM18.75 9.375C18.75 8.375 17.875 7.5 16.875 7.5C15.875 7.5 15 8.375 15 9.375C15 10.375 15.875 11.25 16.875 11.25C17.875 11.25 18.75 10.375 18.75 9.375Z"})}),L.jsx("div",{className:"flex-1 px-4 text-xl font-lato text-primary font-semibold",children:"Edit Cry Detection Settings"}),L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:L.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]})]})}),L.jsx("div",{className:"flex justify-center py-2",children:L.jsxs("div",{class:"card w-96 h-24 rounded-xl bg-white shadow rounded-badge",children:[L.jsx(id,{to:"/profile/editcams",children:L.jsxs("div",{class:"card h-12 px-4 flex flex-row items-center",children:[L.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"21",viewBox:"0 0 25 21",fill:"none",children:[L.jsx("path",{d:"M16.4062 11.2846C16.4062 12.4357 15.9947 13.5397 15.2621 14.3537C14.5296 15.1676 13.536 15.6249 12.5 15.6249C11.464 15.6249 10.4704 15.1676 9.73786 14.3537C9.0053 13.5397 8.59375 12.4357 8.59375 11.2846C8.59375 10.1335 9.0053 9.02953 9.73786 8.21557C10.4704 7.40161 11.464 6.94434 12.5 6.94434C13.536 6.94434 14.5296 7.40161 15.2621 8.21557C15.9947 9.02953 16.4062 10.1335 16.4062 11.2846Z",fill:"#254777"}),L.jsx("path",{d:"M3.125 3.47222C2.2962 3.47222 1.50134 3.83804 0.915291 4.48921C0.32924 5.14038 0 6.02355 0 6.94444L0 17.3611C0 18.282 0.32924 19.1652 0.915291 19.8163C1.50134 20.4675 2.2962 20.8333 3.125 20.8333H21.875C22.7038 20.8333 23.4987 20.4675 24.0847 19.8163C24.6708 19.1652 25 18.282 25 17.3611V6.94444C25 6.02355 24.6708 5.14038 24.0847 4.48921C23.4987 3.83804 22.7038 3.47222 21.875 3.47222H20.0438C19.215 3.47203 18.4203 3.10607 17.8344 2.45486L16.5406 1.01736C15.9547 0.366148 15.16 0.000196658 14.3313 0H10.6687C9.84002 0.000196658 9.04529 0.366148 8.45938 1.01736L7.16563 2.45486C6.57971 3.10607 5.78498 3.47203 4.95625 3.47222H3.125ZM3.90625 6.94444C3.69905 6.94444 3.50034 6.85299 3.35382 6.6902C3.20731 6.5274 3.125 6.30661 3.125 6.07639C3.125 5.84617 3.20731 5.62537 3.35382 5.46258C3.50034 5.29979 3.69905 5.20833 3.90625 5.20833C4.11345 5.20833 4.31216 5.29979 4.45868 5.46258C4.60519 5.62537 4.6875 5.84617 4.6875 6.07639C4.6875 6.30661 4.60519 6.5274 4.45868 6.6902C4.31216 6.85299 4.11345 6.94444 3.90625 6.94444ZM17.9688 11.2847C17.9688 12.8963 17.3926 14.4418 16.367 15.5814C15.3414 16.7209 13.9504 17.3611 12.5 17.3611C11.0496 17.3611 9.6586 16.7209 8.63301 15.5814C7.60742 14.4418 7.03125 12.8963 7.03125 11.2847C7.03125 9.67316 7.60742 8.12761 8.63301 6.98807C9.6586 5.84852 11.0496 5.20833 12.5 5.20833C13.9504 5.20833 15.3414 5.84852 16.367 6.98807C17.3926 8.12761 17.9688 9.67316 17.9688 11.2847Z",fill:"#254777"})]}),L.jsx("div",{className:"flex-1 px-4 text-xl font-lato text-primary font-semibold",children:"Add/Delete Camera"}),L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:L.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]})}),L.jsx("div",{class:"divider divider-start text-white m-0 h-0",children:"boo"}),L.jsxs("div",{class:"card h-12 px-4 flex flex-row items-center",children:[L.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"29",height:"24",viewBox:"0 0 29 24",fill:"none",children:[L.jsx("path",{d:"M5.75 8.875C5.75 8.875 2.53562 10.125 2 14.5M23.25 8.875C23.25 8.875 26.4644 10.125 27 14.5M10.75 8.875C10.75 8.875 13.75 9.60437 14.5 13.25C15.25 9.60437 18.25 8.875 18.25 8.875M12 18.25C12 18.25 9.375 18.7188 8.25 22M17 18.25C17 18.25 19.625 18.7188 20.75 22",stroke:"#254777","stroke-width":"3","stroke-linecap":"round"}),L.jsx("path",{d:"M14.5 19.5C16.2259 19.5 17.625 18.1009 17.625 16.375C17.625 14.6491 16.2259 13.25 14.5 13.25C12.7741 13.25 11.375 14.6491 11.375 16.375C11.375 18.1009 12.7741 19.5 14.5 19.5Z",stroke:"#254777","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"}),L.jsx("path",{d:"M20.75 9.5C22.8211 9.5 24.5 7.82107 24.5 5.75C24.5 3.67893 22.8211 2 20.75 2C18.6789 2 17 3.67893 17 5.75C17 7.82107 18.6789 9.5 20.75 9.5Z",stroke:"#254777","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"}),L.jsx("path",{d:"M8.25 9.5C10.3211 9.5 12 7.82107 12 5.75C12 3.67893 10.3211 2 8.25 2C6.17893 2 4.5 3.67893 4.5 5.75C4.5 7.82107 6.17893 9.5 8.25 9.5Z",stroke:"#254777","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"})]}),L.jsx("div",{className:"flex-1 px-4 text-xl font-lato text-primary font-semibold",children:"Trusted Members"}),L.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:L.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]})]})})]}),L.jsx(mu,{})]}),rte=()=>{R4();const o=hu(),{cameraData:s}=o.state||{},l=pu(),[h,_]=we.useState({localAudioTrack:null,localVideoTrack:null,client:null,remoteUsers:{},mediaRecorder:null,recordedChunks:[]}),g=we.useRef(null),C=()=>{const M=new MediaStream;for(let x in h.remoteUsers){const W=h.remoteUsers[x];if(W.videoTrack){const te=W.videoTrack.getMediaStreamTrack();M.addTrack(te)}if(W.audioTrack){const te=W.audioTrack.getMediaStreamTrack();M.addTrack(te)}}const j=new MediaRecorder(M,{mimeType:"video/webm;codecs=vp9,opus"});j.ondataavailable=x=>{x.data.size>0&&_(W=>({...W,recordedChunks:[...W.recordedChunks,x.data]}))},j.onstop=()=>{const x=new Blob(h.recordedChunks,{type:"video/webm"}),W=URL.createObjectURL(x),te=document.getElementById("download-link"),X=new Date,ie=X.toISOString().split("T")[0],ve=X.toTimeString().split(" ")[0].replace(/:/g,"-"),K=`recording_${ie}_${ve}.webm`;te.href=W,te.download=K,te.style.display="block",te.click(),setTimeout(()=>{window.location.reload()},1e4)},j.start(),_(x=>({...x,mediaRecorder:j})),document.getElementById("start-recording").disabled=!0,document.getElementById("stop-recording").disabled=!1},b=()=>{h.mediaRecorder&&(h.mediaRecorder.stop(),document.getElementById("start-recording").disabled=!1,document.getElementById("stop-recording").disabled=!0)},D=()=>{l("/user-home")};return we.useEffect(()=>{const M=s==null?void 0:s.app_id,j=s==null?void 0:s.token,x=s==null?void 0:s.channel,W=async()=>{const X=zl.createClient({mode:"live",codec:"vp8"});try{X.setClientRole("audience",{level:D4.AudienceLatencyLevelType.AUDIENCE_LEVEL_LOW_LATENCY}),console.log("APP_ID",M,"CHANNEL",x);const ie=Math.floor(Math.random()*1e6);console.log("new_id",ie),await X.join(M,x,j,ie),X.on("user-published",async(ve,K)=>{if(console.log("user-published",ve,K),await X.subscribe(ve,K),console.log("subscribe success"),K==="video"){const H=ve.videoTrack;g.current&&(g.current.innerHTML=""),H.play(g.current)}K==="audio"&&ve.audioTrack.play(),_(H=>({...H,remoteUsers:{...H.remoteUsers,[ve.uid]:ve}}))}),X.on("user-unpublished",ve=>{console.log("user-unpublished",ve),g.current&&g.current.id===ve.uid.toString()&&(g.current.innerHTML="Video Player Here"),_(K=>{const H={...K.remoteUsers};return delete H[ve.uid],{...K,remoteUsers:H}})}),_(ve=>({...ve,client:X}))}catch(ie){console.error("Failed to join as audience:",ie)}},te=async()=>{h.client&&(await h.client.leave(),h.client.removeAllListeners(),g.current&&(g.current.innerHTML="Video Player Here"),_(X=>({...X,client:null})),console.log("Left the channel successfully"))};return window.joinChannel=W,window.leaveChannel=te,document.getElementById("start-recording").addEventListener("click",C),document.getElementById("stop-recording").addEventListener("click",b),()=>{const X=document.getElementById("start-recording"),ie=document.getElementById("stop-recording");X&&X.removeEventListener("click",C),ie&&ie.removeEventListener("click",b)}},[h,s]),L.jsx("div",{className:"flex flex-col items-center",children:L.jsxs("div",{className:"items-center rounded-lg w-96 p-6",children:[L.jsxs("header",{className:"flex items-center mb-6",children:[L.jsx("button",{className:"btn btn-ghost btn-sm mr-4",onClick:D,children:"<"}),L.jsx("h1",{className:"text-xl font-semibold",children:s.camera_name})]}),L.jsx("div",{className:"bg-gray-200 h-48 rounded-lg flex items-center justify-center mb-6",ref:g,children:L.jsx("span",{className:"text-gray-500",children:"Video Player Here"})}),L.jsxs("div",{className:"flex justify-around mb-6 p-4 rounded-lg border border-gray-300 shadow-lg",children:[L.jsx("button",{className:"btn btn-outline btn-primary",children:"📸"}),L.jsx("button",{className:"btn btn-outline btn-primary",children:"🔊"}),L.jsx("button",{className:"btn btn-outline btn-primary",children:"🎥"})]}),L.jsxs("div",{className:"flex justify-center pb-4",children:[L.jsx("button",{onClick:()=>window.joinChannel(),className:"btn btn-accent px-4 mx-4",children:"Watch "}),L.jsx("button",{onClick:()=>window.leaveChannel(),className:"btn btn-accent px-4 mx-4",children:"Leave"})]}),L.jsxs("div",{className:"mb-6",children:[L.jsx("p",{className:"font-medium",children:"Currently:"}),L.jsxs("p",{className:"text-gray-600",children:["Status: ",s.status]}),L.jsx("p",{className:"text-gray-600",children:"Noise Level: xxx db"})]}),L.jsxs("div",{className:"flex justify-center pb-4",children:[L.jsx("button",{id:"start-recording",className:"btn btn-success",children:"Start Recording"}),L.jsx("button",{id:"stop-recording",className:"btn btn-danger",disabled:!0,children:"Stop Recording"}),L.jsx("a",{id:"download-link",className:"btn btn-primary",style:{display:"none"},children:"Download Recording"})]}),L.jsxs("div",{children:[L.jsx("h2",{className:"text-lg font-semibold mb-2",children:"History:"}),L.jsxs("div",{className:"flex items-center mb-4",children:[L.jsx("img",{src:"./images/crybaby.png",alt:"cry icon",className:"w-10 h-10 mr-4"}),L.jsxs("div",{children:[L.jsx("p",{className:"font-medium",children:"Cry Detected at 7pm!"}),L.jsx("p",{className:"text-gray-600 text-sm",children:"Duration: 5mins"}),L.jsx("p",{className:"text-gray-600 text-sm",children:"Probability: 90%"})]})]})]})]})})};function k4(o,s){return function(){return o.apply(s,arguments)}}const{toString:ite}=Object.prototype,{getPrototypeOf:L0}=Object,tg=(o=>s=>{const l=ite.call(s);return o[l]||(o[l]=l.slice(8,-1).toLowerCase())})(Object.create(null)),Yo=o=>(o=o.toLowerCase(),s=>tg(s)===o),ng=o=>s=>typeof s===o,{isArray:_u}=Array,Pp=ng("undefined");function ote(o){return o!==null&&!Pp(o)&&o.constructor!==null&&!Pp(o.constructor)&&_o(o.constructor.isBuffer)&&o.constructor.isBuffer(o)}const M4=Yo("ArrayBuffer");function ste(o){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(o):s=o&&o.buffer&&M4(o.buffer),s}const ate=ng("string"),_o=ng("function"),x4=ng("number"),rg=o=>o!==null&&typeof o=="object",cte=o=>o===!0||o===!1,rE=o=>{if(tg(o)!=="object")return!1;const s=L0(o);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in o)&&!(Symbol.iterator in o)},dte=Yo("Date"),lte=Yo("File"),ute=Yo("Blob"),hte=Yo("FileList"),pte=o=>rg(o)&&_o(o.pipe),fte=o=>{let s;return o&&(typeof FormData=="function"&&o instanceof FormData||_o(o.append)&&((s=tg(o))==="formdata"||s==="object"&&_o(o.toString)&&o.toString()==="[object FormData]"))},mte=Yo("URLSearchParams"),[_te,Ete,gte,Ste]=["ReadableStream","Request","Response","Headers"].map(Yo),Tte=o=>o.trim?o.trim():o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Bp(o,s,{allOwnKeys:l=!1}={}){if(o===null||typeof o>"u")return;let h,_;if(typeof o!="object"&&(o=[o]),_u(o))for(h=0,_=o.length;h<_;h++)s.call(null,o[h],h,o);else{const g=l?Object.getOwnPropertyNames(o):Object.keys(o),C=g.length;let b;for(h=0;h<C;h++)b=g[h],s.call(null,o[b],b,o)}}function U4(o,s){s=s.toLowerCase();const l=Object.keys(o);let h=l.length,_;for(;h-- >0;)if(_=l[h],s===_.toLowerCase())return _;return null}const V4=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,j4=o=>!Pp(o)&&o!==V4;function RR(){const{caseless:o}=j4(this)&&this||{},s={},l=(h,_)=>{const g=o&&U4(s,_)||_;rE(s[g])&&rE(h)?s[g]=RR(s[g],h):rE(h)?s[g]=RR({},h):_u(h)?s[g]=h.slice():s[g]=h};for(let h=0,_=arguments.length;h<_;h++)arguments[h]&&Bp(arguments[h],l);return s}const vte=(o,s,l,{allOwnKeys:h}={})=>(Bp(s,(_,g)=>{l&&_o(_)?o[g]=k4(_,l):o[g]=_},{allOwnKeys:h}),o),yte=o=>(o.charCodeAt(0)===65279&&(o=o.slice(1)),o),Cte=(o,s,l,h)=>{o.prototype=Object.create(s.prototype,h),o.prototype.constructor=o,Object.defineProperty(o,"super",{value:s.prototype}),l&&Object.assign(o.prototype,l)},Rte=(o,s,l,h)=>{let _,g,C;const b={};if(s=s||{},o==null)return s;do{for(_=Object.getOwnPropertyNames(o),g=_.length;g-- >0;)C=_[g],(!h||h(C,o,s))&&!b[C]&&(s[C]=o[C],b[C]=!0);o=l!==!1&&L0(o)}while(o&&(!l||l(o,s))&&o!==Object.prototype);return s},wte=(o,s,l)=>{o=String(o),(l===void 0||l>o.length)&&(l=o.length),l-=s.length;const h=o.indexOf(s,l);return h!==-1&&h===l},Ite=o=>{if(!o)return null;if(_u(o))return o;let s=o.length;if(!x4(s))return null;const l=new Array(s);for(;s-- >0;)l[s]=o[s];return l},Ate=(o=>s=>o&&s instanceof o)(typeof Uint8Array<"u"&&L0(Uint8Array)),bte=(o,s)=>{const h=(o&&o[Symbol.iterator]).call(o);let _;for(;(_=h.next())&&!_.done;){const g=_.value;s.call(o,g[0],g[1])}},Ote=(o,s)=>{let l;const h=[];for(;(l=o.exec(s))!==null;)h.push(l);return h},Nte=Yo("HTMLFormElement"),Dte=o=>o.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(l,h,_){return h.toUpperCase()+_}),MU=(({hasOwnProperty:o})=>(s,l)=>o.call(s,l))(Object.prototype),Pte=Yo("RegExp"),F4=(o,s)=>{const l=Object.getOwnPropertyDescriptors(o),h={};Bp(l,(_,g)=>{let C;(C=s(_,g,o))!==!1&&(h[g]=C||_)}),Object.defineProperties(o,h)},Lte=o=>{F4(o,(s,l)=>{if(_o(o)&&["arguments","caller","callee"].indexOf(l)!==-1)return!1;const h=o[l];if(_o(h)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+l+"'")})}})},kte=(o,s)=>{const l={},h=_=>{_.forEach(g=>{l[g]=!0})};return _u(o)?h(o):h(String(o).split(s)),l},Mte=()=>{},xte=(o,s)=>o!=null&&Number.isFinite(o=+o)?o:s,wC="abcdefghijklmnopqrstuvwxyz",xU="0123456789",B4={DIGIT:xU,ALPHA:wC,ALPHA_DIGIT:wC+wC.toUpperCase()+xU},Ute=(o=16,s=B4.ALPHA_DIGIT)=>{let l="";const{length:h}=s;for(;o--;)l+=s[Math.random()*h|0];return l};function Vte(o){return!!(o&&_o(o.append)&&o[Symbol.toStringTag]==="FormData"&&o[Symbol.iterator])}const jte=o=>{const s=new Array(10),l=(h,_)=>{if(rg(h)){if(s.indexOf(h)>=0)return;if(!("toJSON"in h)){s[_]=h;const g=_u(h)?[]:{};return Bp(h,(C,b)=>{const D=l(C,_+1);!Pp(D)&&(g[b]=D)}),s[_]=void 0,g}}return h};return l(o,0)},Fte=Yo("AsyncFunction"),Bte=o=>o&&(rg(o)||_o(o))&&_o(o.then)&&_o(o.catch),de={isArray:_u,isArrayBuffer:M4,isBuffer:ote,isFormData:fte,isArrayBufferView:ste,isString:ate,isNumber:x4,isBoolean:cte,isObject:rg,isPlainObject:rE,isReadableStream:_te,isRequest:Ete,isResponse:gte,isHeaders:Ste,isUndefined:Pp,isDate:dte,isFile:lte,isBlob:ute,isRegExp:Pte,isFunction:_o,isStream:pte,isURLSearchParams:mte,isTypedArray:Ate,isFileList:hte,forEach:Bp,merge:RR,extend:vte,trim:Tte,stripBOM:yte,inherits:Cte,toFlatObject:Rte,kindOf:tg,kindOfTest:Yo,endsWith:wte,toArray:Ite,forEachEntry:bte,matchAll:Ote,isHTMLForm:Nte,hasOwnProperty:MU,hasOwnProp:MU,reduceDescriptors:F4,freezeMethods:Lte,toObjectSet:kte,toCamelCase:Dte,noop:Mte,toFiniteNumber:xte,findKey:U4,global:V4,isContextDefined:j4,ALPHABET:B4,generateString:Ute,isSpecCompliantForm:Vte,toJSONObject:jte,isAsyncFn:Fte,isThenable:Bte};function vt(o,s,l,h,_){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=o,this.name="AxiosError",s&&(this.code=s),l&&(this.config=l),h&&(this.request=h),_&&(this.response=_)}de.inherits(vt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:de.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const G4=vt.prototype,W4={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(o=>{W4[o]={value:o}});Object.defineProperties(vt,W4);Object.defineProperty(G4,"isAxiosError",{value:!0});vt.from=(o,s,l,h,_,g)=>{const C=Object.create(G4);return de.toFlatObject(o,C,function(D){return D!==Error.prototype},b=>b!=="isAxiosError"),vt.call(C,o.message,s,l,h,_),C.cause=o,C.name=o.name,g&&Object.assign(C,g),C};const Gte=null;function wR(o){return de.isPlainObject(o)||de.isArray(o)}function H4(o){return de.endsWith(o,"[]")?o.slice(0,-2):o}function UU(o,s,l){return o?o.concat(s).map(function(_,g){return _=H4(_),!l&&g?"["+_+"]":_}).join(l?".":""):s}function Wte(o){return de.isArray(o)&&!o.some(wR)}const Hte=de.toFlatObject(de,{},null,function(s){return/^is[A-Z]/.test(s)});function ig(o,s,l){if(!de.isObject(o))throw new TypeError("target must be an object");s=s||new FormData,l=de.toFlatObject(l,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ie,ve){return!de.isUndefined(ve[ie])});const h=l.metaTokens,_=l.visitor||j,g=l.dots,C=l.indexes,D=(l.Blob||typeof Blob<"u"&&Blob)&&de.isSpecCompliantForm(s);if(!de.isFunction(_))throw new TypeError("visitor must be a function");function M(X){if(X===null)return"";if(de.isDate(X))return X.toISOString();if(!D&&de.isBlob(X))throw new vt("Blob is not supported. Use a Buffer instead.");return de.isArrayBuffer(X)||de.isTypedArray(X)?D&&typeof Blob=="function"?new Blob([X]):Buffer.from(X):X}function j(X,ie,ve){let K=X;if(X&&!ve&&typeof X=="object"){if(de.endsWith(ie,"{}"))ie=h?ie:ie.slice(0,-2),X=JSON.stringify(X);else if(de.isArray(X)&&Wte(X)||(de.isFileList(X)||de.endsWith(ie,"[]"))&&(K=de.toArray(X)))return ie=H4(ie),K.forEach(function(Y,pe){!(de.isUndefined(Y)||Y===null)&&s.append(C===!0?UU([ie],pe,g):C===null?ie:ie+"[]",M(Y))}),!1}return wR(X)?!0:(s.append(UU(ve,ie,g),M(X)),!1)}const x=[],W=Object.assign(Hte,{defaultVisitor:j,convertValue:M,isVisitable:wR});function te(X,ie){if(!de.isUndefined(X)){if(x.indexOf(X)!==-1)throw Error("Circular reference detected in "+ie.join("."));x.push(X),de.forEach(X,function(K,H){(!(de.isUndefined(K)||K===null)&&_.call(s,K,de.isString(H)?H.trim():H,ie,W))===!0&&te(K,ie?ie.concat(H):[H])}),x.pop()}}if(!de.isObject(o))throw new TypeError("data must be an object");return te(o),s}function VU(o){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(o).replace(/[!'()~]|%20|%00/g,function(h){return s[h]})}function k0(o,s){this._pairs=[],o&&ig(o,this,s)}const K4=k0.prototype;K4.append=function(s,l){this._pairs.push([s,l])};K4.toString=function(s){const l=s?function(h){return s.call(this,h,VU)}:VU;return this._pairs.map(function(_){return l(_[0])+"="+l(_[1])},"").join("&")};function Kte(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function z4(o,s,l){if(!s)return o;const h=l&&l.encode||Kte,_=l&&l.serialize;let g;if(_?g=_(s,l):g=de.isURLSearchParams(s)?s.toString():new k0(s,l).toString(h),g){const C=o.indexOf("#");C!==-1&&(o=o.slice(0,C)),o+=(o.indexOf("?")===-1?"?":"&")+g}return o}class jU{constructor(){this.handlers=[]}use(s,l,h){return this.handlers.push({fulfilled:s,rejected:l,synchronous:h?h.synchronous:!1,runWhen:h?h.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){de.forEach(this.handlers,function(h){h!==null&&s(h)})}}const Y4={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},zte=typeof URLSearchParams<"u"?URLSearchParams:k0,Yte=typeof FormData<"u"?FormData:null,qte=typeof Blob<"u"?Blob:null,Jte={isBrowser:!0,classes:{URLSearchParams:zte,FormData:Yte,Blob:qte},protocols:["http","https","file","blob","url","data"]},M0=typeof window<"u"&&typeof document<"u",Xte=(o=>M0&&["ReactNative","NativeScript","NS"].indexOf(o)<0)(typeof navigator<"u"&&navigator.product),Qte=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Zte=M0&&window.location.href||"http://localhost",$te=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:M0,hasStandardBrowserEnv:Xte,hasStandardBrowserWebWorkerEnv:Qte,origin:Zte},Symbol.toStringTag,{value:"Module"})),Ho={...$te,...Jte};function ene(o,s){return ig(o,new Ho.classes.URLSearchParams,Object.assign({visitor:function(l,h,_,g){return Ho.isNode&&de.isBuffer(l)?(this.append(h,l.toString("base64")),!1):g.defaultVisitor.apply(this,arguments)}},s))}function tne(o){return de.matchAll(/\w+|\[(\w*)]/g,o).map(s=>s[0]==="[]"?"":s[1]||s[0])}function nne(o){const s={},l=Object.keys(o);let h;const _=l.length;let g;for(h=0;h<_;h++)g=l[h],s[g]=o[g];return s}function q4(o){function s(l,h,_,g){let C=l[g++];if(C==="__proto__")return!0;const b=Number.isFinite(+C),D=g>=l.length;return C=!C&&de.isArray(_)?_.length:C,D?(de.hasOwnProp(_,C)?_[C]=[_[C],h]:_[C]=h,!b):((!_[C]||!de.isObject(_[C]))&&(_[C]=[]),s(l,h,_[C],g)&&de.isArray(_[C])&&(_[C]=nne(_[C])),!b)}if(de.isFormData(o)&&de.isFunction(o.entries)){const l={};return de.forEachEntry(o,(h,_)=>{s(tne(h),_,l,0)}),l}return null}function rne(o,s,l){if(de.isString(o))try{return(s||JSON.parse)(o),de.trim(o)}catch(h){if(h.name!=="SyntaxError")throw h}return(l||JSON.stringify)(o)}const Gp={transitional:Y4,adapter:["xhr","http","fetch"],transformRequest:[function(s,l){const h=l.getContentType()||"",_=h.indexOf("application/json")>-1,g=de.isObject(s);if(g&&de.isHTMLForm(s)&&(s=new FormData(s)),de.isFormData(s))return _?JSON.stringify(q4(s)):s;if(de.isArrayBuffer(s)||de.isBuffer(s)||de.isStream(s)||de.isFile(s)||de.isBlob(s)||de.isReadableStream(s))return s;if(de.isArrayBufferView(s))return s.buffer;if(de.isURLSearchParams(s))return l.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let b;if(g){if(h.indexOf("application/x-www-form-urlencoded")>-1)return ene(s,this.formSerializer).toString();if((b=de.isFileList(s))||h.indexOf("multipart/form-data")>-1){const D=this.env&&this.env.FormData;return ig(b?{"files[]":s}:s,D&&new D,this.formSerializer)}}return g||_?(l.setContentType("application/json",!1),rne(s)):s}],transformResponse:[function(s){const l=this.transitional||Gp.transitional,h=l&&l.forcedJSONParsing,_=this.responseType==="json";if(de.isResponse(s)||de.isReadableStream(s))return s;if(s&&de.isString(s)&&(h&&!this.responseType||_)){const C=!(l&&l.silentJSONParsing)&&_;try{return JSON.parse(s)}catch(b){if(C)throw b.name==="SyntaxError"?vt.from(b,vt.ERR_BAD_RESPONSE,this,null,this.response):b}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ho.classes.FormData,Blob:Ho.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};de.forEach(["delete","get","head","post","put","patch"],o=>{Gp.headers[o]={}});const ine=de.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),one=o=>{const s={};let l,h,_;return o&&o.split(`
`).forEach(function(C){_=C.indexOf(":"),l=C.substring(0,_).trim().toLowerCase(),h=C.substring(_+1).trim(),!(!l||s[l]&&ine[l])&&(l==="set-cookie"?s[l]?s[l].push(h):s[l]=[h]:s[l]=s[l]?s[l]+", "+h:h)}),s},FU=Symbol("internals");function Jh(o){return o&&String(o).trim().toLowerCase()}function iE(o){return o===!1||o==null?o:de.isArray(o)?o.map(iE):String(o)}function sne(o){const s=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let h;for(;h=l.exec(o);)s[h[1]]=h[2];return s}const ane=o=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(o.trim());function IC(o,s,l,h,_){if(de.isFunction(h))return h.call(this,s,l);if(_&&(s=l),!!de.isString(s)){if(de.isString(h))return s.indexOf(h)!==-1;if(de.isRegExp(h))return h.test(s)}}function cne(o){return o.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,l,h)=>l.toUpperCase()+h)}function dne(o,s){const l=de.toCamelCase(" "+s);["get","set","has"].forEach(h=>{Object.defineProperty(o,h+l,{value:function(_,g,C){return this[h].call(this,s,_,g,C)},configurable:!0})})}class Ti{constructor(s){s&&this.set(s)}set(s,l,h){const _=this;function g(b,D,M){const j=Jh(D);if(!j)throw new Error("header name must be a non-empty string");const x=de.findKey(_,j);(!x||_[x]===void 0||M===!0||M===void 0&&_[x]!==!1)&&(_[x||D]=iE(b))}const C=(b,D)=>de.forEach(b,(M,j)=>g(M,j,D));if(de.isPlainObject(s)||s instanceof this.constructor)C(s,l);else if(de.isString(s)&&(s=s.trim())&&!ane(s))C(one(s),l);else if(de.isHeaders(s))for(const[b,D]of s.entries())g(D,b,h);else s!=null&&g(l,s,h);return this}get(s,l){if(s=Jh(s),s){const h=de.findKey(this,s);if(h){const _=this[h];if(!l)return _;if(l===!0)return sne(_);if(de.isFunction(l))return l.call(this,_,h);if(de.isRegExp(l))return l.exec(_);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,l){if(s=Jh(s),s){const h=de.findKey(this,s);return!!(h&&this[h]!==void 0&&(!l||IC(this,this[h],h,l)))}return!1}delete(s,l){const h=this;let _=!1;function g(C){if(C=Jh(C),C){const b=de.findKey(h,C);b&&(!l||IC(h,h[b],b,l))&&(delete h[b],_=!0)}}return de.isArray(s)?s.forEach(g):g(s),_}clear(s){const l=Object.keys(this);let h=l.length,_=!1;for(;h--;){const g=l[h];(!s||IC(this,this[g],g,s,!0))&&(delete this[g],_=!0)}return _}normalize(s){const l=this,h={};return de.forEach(this,(_,g)=>{const C=de.findKey(h,g);if(C){l[C]=iE(_),delete l[g];return}const b=s?cne(g):String(g).trim();b!==g&&delete l[g],l[b]=iE(_),h[b]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const l=Object.create(null);return de.forEach(this,(h,_)=>{h!=null&&h!==!1&&(l[_]=s&&de.isArray(h)?h.join(", "):h)}),l}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,l])=>s+": "+l).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...l){const h=new this(s);return l.forEach(_=>h.set(_)),h}static accessor(s){const h=(this[FU]=this[FU]={accessors:{}}).accessors,_=this.prototype;function g(C){const b=Jh(C);h[b]||(dne(_,C),h[b]=!0)}return de.isArray(s)?s.forEach(g):g(s),this}}Ti.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);de.reduceDescriptors(Ti.prototype,({value:o},s)=>{let l=s[0].toUpperCase()+s.slice(1);return{get:()=>o,set(h){this[l]=h}}});de.freezeMethods(Ti);function AC(o,s){const l=this||Gp,h=s||l,_=Ti.from(h.headers);let g=h.data;return de.forEach(o,function(b){g=b.call(l,g,_.normalize(),s?s.status:void 0)}),_.normalize(),g}function J4(o){return!!(o&&o.__CANCEL__)}function Eu(o,s,l){vt.call(this,o??"canceled",vt.ERR_CANCELED,s,l),this.name="CanceledError"}de.inherits(Eu,vt,{__CANCEL__:!0});function X4(o,s,l){const h=l.config.validateStatus;!l.status||!h||h(l.status)?o(l):s(new vt("Request failed with status code "+l.status,[vt.ERR_BAD_REQUEST,vt.ERR_BAD_RESPONSE][Math.floor(l.status/100)-4],l.config,l.request,l))}function lne(o){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return s&&s[1]||""}function une(o,s){o=o||10;const l=new Array(o),h=new Array(o);let _=0,g=0,C;return s=s!==void 0?s:1e3,function(D){const M=Date.now(),j=h[g];C||(C=M),l[_]=D,h[_]=M;let x=g,W=0;for(;x!==_;)W+=l[x++],x=x%o;if(_=(_+1)%o,_===g&&(g=(g+1)%o),M-C<s)return;const te=j&&M-j;return te?Math.round(W*1e3/te):void 0}}function hne(o,s){let l=0;const h=1e3/s;let _=null;return function(){const C=this===!0,b=Date.now();if(C||b-l>h)return _&&(clearTimeout(_),_=null),l=b,o.apply(null,arguments);_||(_=setTimeout(()=>(_=null,l=Date.now(),o.apply(null,arguments)),h-(b-l)))}}const LE=(o,s,l=3)=>{let h=0;const _=une(50,250);return hne(g=>{const C=g.loaded,b=g.lengthComputable?g.total:void 0,D=C-h,M=_(D),j=C<=b;h=C;const x={loaded:C,total:b,progress:b?C/b:void 0,bytes:D,rate:M||void 0,estimated:M&&b&&j?(b-C)/M:void 0,event:g,lengthComputable:b!=null};x[s?"download":"upload"]=!0,o(x)},l)},pne=Ho.hasStandardBrowserEnv?function(){const s=/(msie|trident)/i.test(navigator.userAgent),l=document.createElement("a");let h;function _(g){let C=g;return s&&(l.setAttribute("href",C),C=l.href),l.setAttribute("href",C),{href:l.href,protocol:l.protocol?l.protocol.replace(/:$/,""):"",host:l.host,search:l.search?l.search.replace(/^\?/,""):"",hash:l.hash?l.hash.replace(/^#/,""):"",hostname:l.hostname,port:l.port,pathname:l.pathname.charAt(0)==="/"?l.pathname:"/"+l.pathname}}return h=_(window.location.href),function(C){const b=de.isString(C)?_(C):C;return b.protocol===h.protocol&&b.host===h.host}}():function(){return function(){return!0}}(),fne=Ho.hasStandardBrowserEnv?{write(o,s,l,h,_,g){const C=[o+"="+encodeURIComponent(s)];de.isNumber(l)&&C.push("expires="+new Date(l).toGMTString()),de.isString(h)&&C.push("path="+h),de.isString(_)&&C.push("domain="+_),g===!0&&C.push("secure"),document.cookie=C.join("; ")},read(o){const s=document.cookie.match(new RegExp("(^|;\\s*)("+o+")=([^;]*)"));return s?decodeURIComponent(s[3]):null},remove(o){this.write(o,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function mne(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}function _ne(o,s){return s?o.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):o}function Q4(o,s){return o&&!mne(s)?_ne(o,s):s}const BU=o=>o instanceof Ti?{...o}:o;function hd(o,s){s=s||{};const l={};function h(M,j,x){return de.isPlainObject(M)&&de.isPlainObject(j)?de.merge.call({caseless:x},M,j):de.isPlainObject(j)?de.merge({},j):de.isArray(j)?j.slice():j}function _(M,j,x){if(de.isUndefined(j)){if(!de.isUndefined(M))return h(void 0,M,x)}else return h(M,j,x)}function g(M,j){if(!de.isUndefined(j))return h(void 0,j)}function C(M,j){if(de.isUndefined(j)){if(!de.isUndefined(M))return h(void 0,M)}else return h(void 0,j)}function b(M,j,x){if(x in s)return h(M,j);if(x in o)return h(void 0,M)}const D={url:g,method:g,data:g,baseURL:C,transformRequest:C,transformResponse:C,paramsSerializer:C,timeout:C,timeoutMessage:C,withCredentials:C,withXSRFToken:C,adapter:C,responseType:C,xsrfCookieName:C,xsrfHeaderName:C,onUploadProgress:C,onDownloadProgress:C,decompress:C,maxContentLength:C,maxBodyLength:C,beforeRedirect:C,transport:C,httpAgent:C,httpsAgent:C,cancelToken:C,socketPath:C,responseEncoding:C,validateStatus:b,headers:(M,j)=>_(BU(M),BU(j),!0)};return de.forEach(Object.keys(Object.assign({},o,s)),function(j){const x=D[j]||_,W=x(o[j],s[j],j);de.isUndefined(W)&&x!==b||(l[j]=W)}),l}const Z4=o=>{const s=hd({},o);let{data:l,withXSRFToken:h,xsrfHeaderName:_,xsrfCookieName:g,headers:C,auth:b}=s;s.headers=C=Ti.from(C),s.url=z4(Q4(s.baseURL,s.url),o.params,o.paramsSerializer),b&&C.set("Authorization","Basic "+btoa((b.username||"")+":"+(b.password?unescape(encodeURIComponent(b.password)):"")));let D;if(de.isFormData(l)){if(Ho.hasStandardBrowserEnv||Ho.hasStandardBrowserWebWorkerEnv)C.setContentType(void 0);else if((D=C.getContentType())!==!1){const[M,...j]=D?D.split(";").map(x=>x.trim()).filter(Boolean):[];C.setContentType([M||"multipart/form-data",...j].join("; "))}}if(Ho.hasStandardBrowserEnv&&(h&&de.isFunction(h)&&(h=h(s)),h||h!==!1&&pne(s.url))){const M=_&&g&&fne.read(g);M&&C.set(_,M)}return s},Ene=typeof XMLHttpRequest<"u",gne=Ene&&function(o){return new Promise(function(l,h){const _=Z4(o);let g=_.data;const C=Ti.from(_.headers).normalize();let{responseType:b}=_,D;function M(){_.cancelToken&&_.cancelToken.unsubscribe(D),_.signal&&_.signal.removeEventListener("abort",D)}let j=new XMLHttpRequest;j.open(_.method.toUpperCase(),_.url,!0),j.timeout=_.timeout;function x(){if(!j)return;const te=Ti.from("getAllResponseHeaders"in j&&j.getAllResponseHeaders()),ie={data:!b||b==="text"||b==="json"?j.responseText:j.response,status:j.status,statusText:j.statusText,headers:te,config:o,request:j};X4(function(K){l(K),M()},function(K){h(K),M()},ie),j=null}"onloadend"in j?j.onloadend=x:j.onreadystatechange=function(){!j||j.readyState!==4||j.status===0&&!(j.responseURL&&j.responseURL.indexOf("file:")===0)||setTimeout(x)},j.onabort=function(){j&&(h(new vt("Request aborted",vt.ECONNABORTED,_,j)),j=null)},j.onerror=function(){h(new vt("Network Error",vt.ERR_NETWORK,_,j)),j=null},j.ontimeout=function(){let X=_.timeout?"timeout of "+_.timeout+"ms exceeded":"timeout exceeded";const ie=_.transitional||Y4;_.timeoutErrorMessage&&(X=_.timeoutErrorMessage),h(new vt(X,ie.clarifyTimeoutError?vt.ETIMEDOUT:vt.ECONNABORTED,_,j)),j=null},g===void 0&&C.setContentType(null),"setRequestHeader"in j&&de.forEach(C.toJSON(),function(X,ie){j.setRequestHeader(ie,X)}),de.isUndefined(_.withCredentials)||(j.withCredentials=!!_.withCredentials),b&&b!=="json"&&(j.responseType=_.responseType),typeof _.onDownloadProgress=="function"&&j.addEventListener("progress",LE(_.onDownloadProgress,!0)),typeof _.onUploadProgress=="function"&&j.upload&&j.upload.addEventListener("progress",LE(_.onUploadProgress)),(_.cancelToken||_.signal)&&(D=te=>{j&&(h(!te||te.type?new Eu(null,o,j):te),j.abort(),j=null)},_.cancelToken&&_.cancelToken.subscribe(D),_.signal&&(_.signal.aborted?D():_.signal.addEventListener("abort",D)));const W=lne(_.url);if(W&&Ho.protocols.indexOf(W)===-1){h(new vt("Unsupported protocol "+W+":",vt.ERR_BAD_REQUEST,o));return}j.send(g||null)})},Sne=(o,s)=>{let l=new AbortController,h;const _=function(D){if(!h){h=!0,C();const M=D instanceof Error?D:this.reason;l.abort(M instanceof vt?M:new Eu(M instanceof Error?M.message:M))}};let g=s&&setTimeout(()=>{_(new vt(`timeout ${s} of ms exceeded`,vt.ETIMEDOUT))},s);const C=()=>{o&&(g&&clearTimeout(g),g=null,o.forEach(D=>{D&&(D.removeEventListener?D.removeEventListener("abort",_):D.unsubscribe(_))}),o=null)};o.forEach(D=>D&&D.addEventListener&&D.addEventListener("abort",_));const{signal:b}=l;return b.unsubscribe=C,[b,()=>{g&&clearTimeout(g),g=null}]},Tne=function*(o,s){let l=o.byteLength;if(!s||l<s){yield o;return}let h=0,_;for(;h<l;)_=h+s,yield o.slice(h,_),h=_},vne=async function*(o,s,l){for await(const h of o)yield*Tne(ArrayBuffer.isView(h)?h:await l(String(h)),s)},GU=(o,s,l,h,_)=>{const g=vne(o,s,_);let C=0;return new ReadableStream({type:"bytes",async pull(b){const{done:D,value:M}=await g.next();if(D){b.close(),h();return}let j=M.byteLength;l&&l(C+=j),b.enqueue(new Uint8Array(M))},cancel(b){return h(b),g.return()}},{highWaterMark:2})},WU=(o,s)=>{const l=o!=null;return h=>setTimeout(()=>s({lengthComputable:l,total:o,loaded:h}))},og=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",$4=og&&typeof ReadableStream=="function",IR=og&&(typeof TextEncoder=="function"?(o=>s=>o.encode(s))(new TextEncoder):async o=>new Uint8Array(await new Response(o).arrayBuffer())),yne=$4&&(()=>{let o=!1;const s=new Request(Ho.origin,{body:new ReadableStream,method:"POST",get duplex(){return o=!0,"half"}}).headers.has("Content-Type");return o&&!s})(),HU=64*1024,AR=$4&&!!(()=>{try{return de.isReadableStream(new Response("").body)}catch{}})(),kE={stream:AR&&(o=>o.body)};og&&(o=>{["text","arrayBuffer","blob","formData","stream"].forEach(s=>{!kE[s]&&(kE[s]=de.isFunction(o[s])?l=>l[s]():(l,h)=>{throw new vt(`Response type '${s}' is not supported`,vt.ERR_NOT_SUPPORT,h)})})})(new Response);const Cne=async o=>{if(o==null)return 0;if(de.isBlob(o))return o.size;if(de.isSpecCompliantForm(o))return(await new Request(o).arrayBuffer()).byteLength;if(de.isArrayBufferView(o))return o.byteLength;if(de.isURLSearchParams(o)&&(o=o+""),de.isString(o))return(await IR(o)).byteLength},Rne=async(o,s)=>{const l=de.toFiniteNumber(o.getContentLength());return l??Cne(s)},wne=og&&(async o=>{let{url:s,method:l,data:h,signal:_,cancelToken:g,timeout:C,onDownloadProgress:b,onUploadProgress:D,responseType:M,headers:j,withCredentials:x="same-origin",fetchOptions:W}=Z4(o);M=M?(M+"").toLowerCase():"text";let[te,X]=_||g||C?Sne([_,g],C):[],ie,ve;const K=()=>{!ie&&setTimeout(()=>{te&&te.unsubscribe()}),ie=!0};let H;try{if(D&&yne&&l!=="get"&&l!=="head"&&(H=await Rne(j,h))!==0){let ke=new Request(s,{method:"POST",body:h,duplex:"half"}),Pe;de.isFormData(h)&&(Pe=ke.headers.get("content-type"))&&j.setContentType(Pe),ke.body&&(h=GU(ke.body,HU,WU(H,LE(D)),null,IR))}de.isString(x)||(x=x?"cors":"omit"),ve=new Request(s,{...W,signal:te,method:l.toUpperCase(),headers:j.normalize().toJSON(),body:h,duplex:"half",withCredentials:x});let Y=await fetch(ve);const pe=AR&&(M==="stream"||M==="response");if(AR&&(b||pe)){const ke={};["status","statusText","headers"].forEach(He=>{ke[He]=Y[He]});const Pe=de.toFiniteNumber(Y.headers.get("content-length"));Y=new Response(GU(Y.body,HU,b&&WU(Pe,LE(b,!0)),pe&&K,IR),ke)}M=M||"text";let Ne=await kE[de.findKey(kE,M)||"text"](Y,o);return!pe&&K(),X&&X(),await new Promise((ke,Pe)=>{X4(ke,Pe,{data:Ne,headers:Ti.from(Y.headers),status:Y.status,statusText:Y.statusText,config:o,request:ve})})}catch(Y){throw K(),Y&&Y.name==="TypeError"&&/fetch/i.test(Y.message)?Object.assign(new vt("Network Error",vt.ERR_NETWORK,o,ve),{cause:Y.cause||Y}):vt.from(Y,Y&&Y.code,o,ve)}}),bR={http:Gte,xhr:gne,fetch:wne};de.forEach(bR,(o,s)=>{if(o){try{Object.defineProperty(o,"name",{value:s})}catch{}Object.defineProperty(o,"adapterName",{value:s})}});const KU=o=>`- ${o}`,Ine=o=>de.isFunction(o)||o===null||o===!1,ej={getAdapter:o=>{o=de.isArray(o)?o:[o];const{length:s}=o;let l,h;const _={};for(let g=0;g<s;g++){l=o[g];let C;if(h=l,!Ine(l)&&(h=bR[(C=String(l)).toLowerCase()],h===void 0))throw new vt(`Unknown adapter '${C}'`);if(h)break;_[C||"#"+g]=h}if(!h){const g=Object.entries(_).map(([b,D])=>`adapter ${b} `+(D===!1?"is not supported by the environment":"is not available in the build"));let C=s?g.length>1?`since :
`+g.map(KU).join(`
`):" "+KU(g[0]):"as no adapter specified";throw new vt("There is no suitable adapter to dispatch the request "+C,"ERR_NOT_SUPPORT")}return h},adapters:bR};function bC(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new Eu(null,o)}function zU(o){return bC(o),o.headers=Ti.from(o.headers),o.data=AC.call(o,o.transformRequest),["post","put","patch"].indexOf(o.method)!==-1&&o.headers.setContentType("application/x-www-form-urlencoded",!1),ej.getAdapter(o.adapter||Gp.adapter)(o).then(function(h){return bC(o),h.data=AC.call(o,o.transformResponse,h),h.headers=Ti.from(h.headers),h},function(h){return J4(h)||(bC(o),h&&h.response&&(h.response.data=AC.call(o,o.transformResponse,h.response),h.response.headers=Ti.from(h.response.headers))),Promise.reject(h)})}const tj="1.7.2",x0={};["object","boolean","number","function","string","symbol"].forEach((o,s)=>{x0[o]=function(h){return typeof h===o||"a"+(s<1?"n ":" ")+o}});const YU={};x0.transitional=function(s,l,h){function _(g,C){return"[Axios v"+tj+"] Transitional option '"+g+"'"+C+(h?". "+h:"")}return(g,C,b)=>{if(s===!1)throw new vt(_(C," has been removed"+(l?" in "+l:"")),vt.ERR_DEPRECATED);return l&&!YU[C]&&(YU[C]=!0,console.warn(_(C," has been deprecated since v"+l+" and will be removed in the near future"))),s?s(g,C,b):!0}};function Ane(o,s,l){if(typeof o!="object")throw new vt("options must be an object",vt.ERR_BAD_OPTION_VALUE);const h=Object.keys(o);let _=h.length;for(;_-- >0;){const g=h[_],C=s[g];if(C){const b=o[g],D=b===void 0||C(b,g,o);if(D!==!0)throw new vt("option "+g+" must be "+D,vt.ERR_BAD_OPTION_VALUE);continue}if(l!==!0)throw new vt("Unknown option "+g,vt.ERR_BAD_OPTION)}}const OR={assertOptions:Ane,validators:x0},Fa=OR.validators;class od{constructor(s){this.defaults=s,this.interceptors={request:new jU,response:new jU}}async request(s,l){try{return await this._request(s,l)}catch(h){if(h instanceof Error){let _;Error.captureStackTrace?Error.captureStackTrace(_={}):_=new Error;const g=_.stack?_.stack.replace(/^.+\n/,""):"";try{h.stack?g&&!String(h.stack).endsWith(g.replace(/^.+\n.+\n/,""))&&(h.stack+=`
`+g):h.stack=g}catch{}}throw h}}_request(s,l){typeof s=="string"?(l=l||{},l.url=s):l=s||{},l=hd(this.defaults,l);const{transitional:h,paramsSerializer:_,headers:g}=l;h!==void 0&&OR.assertOptions(h,{silentJSONParsing:Fa.transitional(Fa.boolean),forcedJSONParsing:Fa.transitional(Fa.boolean),clarifyTimeoutError:Fa.transitional(Fa.boolean)},!1),_!=null&&(de.isFunction(_)?l.paramsSerializer={serialize:_}:OR.assertOptions(_,{encode:Fa.function,serialize:Fa.function},!0)),l.method=(l.method||this.defaults.method||"get").toLowerCase();let C=g&&de.merge(g.common,g[l.method]);g&&de.forEach(["delete","get","head","post","put","patch","common"],X=>{delete g[X]}),l.headers=Ti.concat(C,g);const b=[];let D=!0;this.interceptors.request.forEach(function(ie){typeof ie.runWhen=="function"&&ie.runWhen(l)===!1||(D=D&&ie.synchronous,b.unshift(ie.fulfilled,ie.rejected))});const M=[];this.interceptors.response.forEach(function(ie){M.push(ie.fulfilled,ie.rejected)});let j,x=0,W;if(!D){const X=[zU.bind(this),void 0];for(X.unshift.apply(X,b),X.push.apply(X,M),W=X.length,j=Promise.resolve(l);x<W;)j=j.then(X[x++],X[x++]);return j}W=b.length;let te=l;for(x=0;x<W;){const X=b[x++],ie=b[x++];try{te=X(te)}catch(ve){ie.call(this,ve);break}}try{j=zU.call(this,te)}catch(X){return Promise.reject(X)}for(x=0,W=M.length;x<W;)j=j.then(M[x++],M[x++]);return j}getUri(s){s=hd(this.defaults,s);const l=Q4(s.baseURL,s.url);return z4(l,s.params,s.paramsSerializer)}}de.forEach(["delete","get","head","options"],function(s){od.prototype[s]=function(l,h){return this.request(hd(h||{},{method:s,url:l,data:(h||{}).data}))}});de.forEach(["post","put","patch"],function(s){function l(h){return function(g,C,b){return this.request(hd(b||{},{method:s,headers:h?{"Content-Type":"multipart/form-data"}:{},url:g,data:C}))}}od.prototype[s]=l(),od.prototype[s+"Form"]=l(!0)});class U0{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let l;this.promise=new Promise(function(g){l=g});const h=this;this.promise.then(_=>{if(!h._listeners)return;let g=h._listeners.length;for(;g-- >0;)h._listeners[g](_);h._listeners=null}),this.promise.then=_=>{let g;const C=new Promise(b=>{h.subscribe(b),g=b}).then(_);return C.cancel=function(){h.unsubscribe(g)},C},s(function(g,C,b){h.reason||(h.reason=new Eu(g,C,b),l(h.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const l=this._listeners.indexOf(s);l!==-1&&this._listeners.splice(l,1)}static source(){let s;return{token:new U0(function(_){s=_}),cancel:s}}}function bne(o){return function(l){return o.apply(null,l)}}function One(o){return de.isObject(o)&&o.isAxiosError===!0}const NR={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(NR).forEach(([o,s])=>{NR[s]=o});function nj(o){const s=new od(o),l=k4(od.prototype.request,s);return de.extend(l,od.prototype,s,{allOwnKeys:!0}),de.extend(l,s,null,{allOwnKeys:!0}),l.create=function(_){return nj(hd(o,_))},l}const jn=nj(Gp);jn.Axios=od;jn.CanceledError=Eu;jn.CancelToken=U0;jn.isCancel=J4;jn.VERSION=tj;jn.toFormData=ig;jn.AxiosError=vt;jn.Cancel=jn.CanceledError;jn.all=function(s){return Promise.all(s)};jn.spread=bne;jn.isAxiosError=One;jn.mergeConfig=hd;jn.AxiosHeaders=Ti;jn.formToJSON=o=>q4(de.isHTMLForm(o)?new FormData(o):o);jn.getAdapter=ej.getAdapter;jn.HttpStatusCode=NR;jn.default=jn;const Nne=()=>{const[o,s]=we.useState([]);return we.useEffect(()=>{jn.get("http://localhost:3000/api/v1/videos").then(l=>{s(l.data)}).catch(l=>{console.error("There was an error fetching the videos!",l)})},[]),L.jsxs("div",{children:[L.jsx("h1",{children:"All Videos"}),L.jsxs("table",{children:[L.jsx("thead",{children:L.jsxs("tr",{children:[L.jsx("th",{children:"ID"}),L.jsx("th",{children:"Title"}),L.jsx("th",{children:"Url Link"}),L.jsx("th",{children:"User ID"}),L.jsx("th",{children:"Created At"}),L.jsx("th",{children:"Is Critical?"})]})}),L.jsx("tbody",{children:o.map(l=>L.jsxs("tr",{children:[L.jsx("td",{children:l.id}),L.jsx("td",{children:l.title}),L.jsx("td",{children:L.jsx("a",{href:l.file_path,children:l.file_path})}),L.jsx("td",{children:l.user_id}),L.jsx("td",{children:new Date(l.created_at).toLocaleString()}),L.jsx("td",{children:l.is_critical?"Yes":"No"})]},l.id))})]})]})},Dne="1297c1a58c0a4f40a55d1f1f7c52b7cd",Pne="007eJxTYHB88m0Nsxd7b/6s0K9TZHa/Ya16vWbPaq0jBrW8P5bENZkoMBgaWZonGyaaWiQbJJqkmRgkmpqmGKYZppknmxolmSen7NWentYQyMjA8l2MiZEBAkF8NoakxMrcxAoGBgCyoSB1",Lne="baymax",kne=({videos:o})=>{const[s,l]=we.useState({client:null,remoteUsers:{},streamingCount:0,displayCount:0,mediaRecorder:null,recordedChunks:[]});we.useEffect(()=>{(async()=>{const C=zl.createClient({mode:"live",codec:"vp8"});await C.join(Dne,Lne,Pne,null),C.on("user-published",async(b,D)=>{if(D==="video"){await C.subscribe(b,D);const M=b.videoTrack;l(x=>{const W=x.displayCount+1,te={...x.remoteUsers,[b.uid]:b},X=x.streamingCount+1;return{...x,displayCount:W,remoteUsers:te,streamingCount:X}});const j=document.createElement("div");j.classList.add("card","mt-4","col-md-6"),j.id=`camera-${b.uid}`,j.innerHTML=`
            <div class="card-body text-center">
              <h1 class="card-title">Camera ${s.displayCount}</h1>
              <div id="camera-${b.uid}-preview" style="width: 320px; height: 240px;"></div>
              <p class="card-text">UID: ${b.uid}</p>
              <a href="/camera_broadcast" class="btn btn-primary btn-lg">Watch Live</a>
            </div>
          `,document.getElementById("camera-list").appendChild(j),M.play(`camera-${b.uid}-preview`,{fit:"contain",muted:!1})}}),C.on("user-unpublished",b=>{const D=document.getElementById(`camera-${b.uid}`);D&&D.remove(),l(M=>{const j={...M.remoteUsers};delete j[b.uid];const x=M.streamingCount-1;return{...M,remoteUsers:j,streamingCount:x}})}),l(b=>({...b,client:C}))})()},[]);const h=()=>{const g=new MediaStream;for(let b in s.remoteUsers){const D=s.remoteUsers[b];if(D.videoTrack){const M=D.videoTrack.getMediaStreamTrack();g.addTrack(M)}}const C=new MediaRecorder(g,{mimeType:"video/webm;codecs=vp9"});C.ondataavailable=b=>{b.data.size>0&&l(D=>({...D,recordedChunks:[...D.recordedChunks,b.data]}))},C.onstop=async()=>{const b=new Blob(s.recordedChunks,{type:"video/webm"}),D=new FormData;D.append("video[title]",`Recording ${new Date().toLocaleString()}`),D.append("video[file]",b,`recording_${new Date().toISOString().replace(/[:.]/g,"-")}.webm`);for(let[j,x]of D.entries())console.log(`${j}: ${x}`);const M=document.querySelector('meta[name="csrf-token"]').getAttribute("content");await fetch("/videos",{method:"POST",headers:{"X-CSRF-Token":M},body:D}),setTimeout(()=>{window.location.reload()},5e3)},C.start(),l(b=>({...b,mediaRecorder:C})),document.getElementById("start-recording").disabled=!0,document.getElementById("stop-recording").disabled=!1},_=()=>{s.mediaRecorder.stop(),document.getElementById("start-recording").disabled=!1,document.getElementById("stop-recording").disabled=!0};return L.jsxs("div",{className:"container mx-auto mt-5",children:[L.jsx("h1",{className:"text-3xl font-bold",children:"Video Recording"}),L.jsx("div",{id:"camera-list",className:"grid grid-cols-1 md:grid-cols-2 gap-4"}),L.jsx("div",{className:"mt-4",children:L.jsxs("h2",{className:"text-xl",children:["Total Streaming Devices: ",L.jsx("span",{id:"streaming-count",children:s.streamingCount})]})}),L.jsx("button",{id:"start-recording",className:"btn btn-success mt-4",onClick:h,children:"Start Recording"}),L.jsx("button",{id:"stop-recording",className:"btn btn-error mt-4 ml-4",onClick:_,disabled:!0,children:"Stop Recording"}),L.jsx("h2",{className:"mt-10 text-2xl",children:"Uploaded Videos"}),L.jsx("ul",{className:"mt-4",children:o&&o.length>0?o.map(g=>L.jsxs("li",{className:"mb-4",children:[L.jsx("h3",{className:"text-lg font-semibold",children:g.title}),g.file.attached?L.jsxs("video",{controls:!0,className:"w-full max-w-md",children:[L.jsx("source",{src:g.file.url,type:"video/webm"}),"Your browser does not support the video tag."]}):L.jsx("p",{children:"No video available"})]},g.id)):L.jsx("p",{children:"No videos availabledddd"})}),L.jsx(Nne,{})]})};var DR={exports:{}},pd={},rj={exports:{}},Mne="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",xne=Mne,Une=xne;function ij(){}function oj(){}oj.resetWarningCache=ij;var Vne=function(){function o(h,_,g,C,b,D){if(D!==Une){var M=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw M.name="Invariant Violation",M}}o.isRequired=o;function s(){return o}var l={array:o,bigint:o,bool:o,func:o,number:o,object:o,string:o,symbol:o,any:o,arrayOf:s,element:o,elementType:o,instanceOf:s,node:o,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:oj,resetWarningCache:ij};return l.PropTypes=l,l};rj.exports=Vne();var sj=rj.exports,PR={exports:{}},qo={},LR={exports:{}};(function(o,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=j;/*!
 * Adapted from jQuery UI core
 *
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/category/ui-core/
 */var l="none",h="contents",_=/input|select|textarea|button|object|iframe/;function g(x,W){return W.getPropertyValue("overflow")!=="visible"||x.scrollWidth<=0&&x.scrollHeight<=0}function C(x){var W=x.offsetWidth<=0&&x.offsetHeight<=0;if(W&&!x.innerHTML)return!0;try{var te=window.getComputedStyle(x),X=te.getPropertyValue("display");return W?X!==h&&g(x,te):X===l}catch{return console.warn("Failed to inspect element style"),!1}}function b(x){for(var W=x,te=x.getRootNode&&x.getRootNode();W&&W!==document.body;){if(te&&W===te&&(W=te.host.parentNode),C(W))return!1;W=W.parentNode}return!0}function D(x,W){var te=x.nodeName.toLowerCase(),X=_.test(te)&&!x.disabled||te==="a"&&x.href||W;return X&&b(x)}function M(x){var W=x.getAttribute("tabindex");W===null&&(W=void 0);var te=isNaN(W);return(te||W>=0)&&D(x,!te)}function j(x){var W=[].slice.call(x.querySelectorAll("*"),0).reduce(function(te,X){return te.concat(X.shadowRoot?j(X.shadowRoot):[X])},[]);return W.filter(M)}o.exports=s.default})(LR,LR.exports);var aj=LR.exports;Object.defineProperty(qo,"__esModule",{value:!0});qo.resetState=Gne;qo.log=Wne;qo.handleBlur=Lp;qo.handleFocus=kp;qo.markForFocusLater=Hne;qo.returnFocus=Kne;qo.popWithoutFocus=zne;qo.setupScopedFocus=Yne;qo.teardownScopedFocus=qne;var jne=aj,Fne=Bne(jne);function Bne(o){return o&&o.__esModule?o:{default:o}}var au=[],Yl=null,kR=!1;function Gne(){au=[]}function Wne(){}function Lp(){kR=!0}function kp(){if(kR){if(kR=!1,!Yl)return;setTimeout(function(){if(!Yl.contains(document.activeElement)){var o=(0,Fne.default)(Yl)[0]||Yl;o.focus()}},0)}}function Hne(){au.push(document.activeElement)}function Kne(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,s=null;try{au.length!==0&&(s=au.pop(),s.focus({preventScroll:o}));return}catch{console.warn(["You tried to return focus to",s,"but it is not in the DOM anymore"].join(" "))}}function zne(){au.length>0&&au.pop()}function Yne(o){Yl=o,window.addEventListener?(window.addEventListener("blur",Lp,!1),document.addEventListener("focus",kp,!0)):(window.attachEvent("onBlur",Lp),document.attachEvent("onFocus",kp))}function qne(){Yl=null,window.addEventListener?(window.removeEventListener("blur",Lp),document.removeEventListener("focus",kp)):(window.detachEvent("onBlur",Lp),document.detachEvent("onFocus",kp))}var MR={exports:{}};(function(o,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=C;var l=aj,h=_(l);function _(b){return b&&b.__esModule?b:{default:b}}function g(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document;return b.activeElement.shadowRoot?g(b.activeElement.shadowRoot):b.activeElement}function C(b,D){var M=(0,h.default)(b);if(!M.length){D.preventDefault();return}var j=void 0,x=D.shiftKey,W=M[0],te=M[M.length-1],X=g();if(b===X){if(!x)return;j=te}if(te===X&&!x&&(j=W),W===X&&x&&(j=te),j){D.preventDefault(),j.focus();return}var ie=/(\bChrome\b|\bSafari\b)\//.exec(navigator.userAgent),ve=ie!=null&&ie[1]!="Chrome"&&/\biPod\b|\biPad\b/g.exec(navigator.userAgent)==null;if(ve){var K=M.indexOf(X);if(K>-1&&(K+=x?-1:1),j=M[K],typeof j>"u"){D.preventDefault(),j=x?te:W,j.focus();return}D.preventDefault(),j.focus()}}o.exports=s.default})(MR,MR.exports);var Jne=MR.exports,Jo={},Xne=function(){},Qne=Xne,Ko={},cj={exports:{}};/*!
  Copyright (c) 2015 Jed Watson.
  Based on code that is Copyright 2013-2015, Facebook, Inc.
  All rights reserved.
*/(function(o){(function(){var s=!!(typeof window<"u"&&window.document&&window.document.createElement),l={canUseDOM:s,canUseWorkers:typeof Worker<"u",canUseEventListeners:s&&!!(window.addEventListener||window.attachEvent),canUseViewport:s&&!!window.screen};o.exports?o.exports=l:window.ExecutionEnvironment=l})()})(cj);var Zne=cj.exports;Object.defineProperty(Ko,"__esModule",{value:!0});Ko.canUseDOM=Ko.SafeNodeList=Ko.SafeHTMLCollection=void 0;var $ne=Zne,ere=tre($ne);function tre(o){return o&&o.__esModule?o:{default:o}}var sg=ere.default,nre=sg.canUseDOM?window.HTMLElement:{};Ko.SafeHTMLCollection=sg.canUseDOM?window.HTMLCollection:{};Ko.SafeNodeList=sg.canUseDOM?window.NodeList:{};Ko.canUseDOM=sg.canUseDOM;Ko.default=nre;Object.defineProperty(Jo,"__esModule",{value:!0});Jo.resetState=are;Jo.log=cre;Jo.assertNodeList=dj;Jo.setElement=dre;Jo.validateElement=V0;Jo.hide=lre;Jo.show=ure;Jo.documentNotReadyOrSSRTesting=hre;var rre=Qne,ire=sre(rre),ore=Ko;function sre(o){return o&&o.__esModule?o:{default:o}}var uo=null;function are(){uo&&(uo.removeAttribute?uo.removeAttribute("aria-hidden"):uo.length!=null?uo.forEach(function(o){return o.removeAttribute("aria-hidden")}):document.querySelectorAll(uo).forEach(function(o){return o.removeAttribute("aria-hidden")})),uo=null}function cre(){}function dj(o,s){if(!o||!o.length)throw new Error("react-modal: No elements were found for selector "+s+".")}function dre(o){var s=o;if(typeof s=="string"&&ore.canUseDOM){var l=document.querySelectorAll(s);dj(l,s),s=l}return uo=s||uo,uo}function V0(o){var s=o||uo;return s?Array.isArray(s)||s instanceof HTMLCollection||s instanceof NodeList?s:[s]:((0,ire.default)(!1,["react-modal: App element is not defined.","Please use `Modal.setAppElement(el)` or set `appElement={el}`.","This is needed so screen readers don't see main content","when modal is opened. It is not recommended, but you can opt-out","by setting `ariaHideApp={false}`."].join(" ")),[])}function lre(o){var s=!0,l=!1,h=void 0;try{for(var _=V0(o)[Symbol.iterator](),g;!(s=(g=_.next()).done);s=!0){var C=g.value;C.setAttribute("aria-hidden","true")}}catch(b){l=!0,h=b}finally{try{!s&&_.return&&_.return()}finally{if(l)throw h}}}function ure(o){var s=!0,l=!1,h=void 0;try{for(var _=V0(o)[Symbol.iterator](),g;!(s=(g=_.next()).done);s=!0){var C=g.value;C.removeAttribute("aria-hidden")}}catch(b){l=!0,h=b}finally{try{!s&&_.return&&_.return()}finally{if(l)throw h}}}function hre(){uo=null}var gu={};Object.defineProperty(gu,"__esModule",{value:!0});gu.resetState=pre;gu.log=fre;var up={},hp={};function qU(o,s){o.classList.remove(s)}function pre(){var o=document.getElementsByTagName("html")[0];for(var s in up)qU(o,up[s]);var l=document.body;for(var h in hp)qU(l,hp[h]);up={},hp={}}function fre(){}var mre=function(s,l){return s[l]||(s[l]=0),s[l]+=1,l},_re=function(s,l){return s[l]&&(s[l]-=1),l},Ere=function(s,l,h){h.forEach(function(_){mre(l,_),s.add(_)})},gre=function(s,l,h){h.forEach(function(_){_re(l,_),l[_]===0&&s.remove(_)})};gu.add=function(s,l){return Ere(s.classList,s.nodeName.toLowerCase()=="html"?up:hp,l.split(" "))};gu.remove=function(s,l){return gre(s.classList,s.nodeName.toLowerCase()=="html"?up:hp,l.split(" "))};var Su={};Object.defineProperty(Su,"__esModule",{value:!0});Su.log=Tre;Su.resetState=vre;function Sre(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}var lj=function o(){var s=this;Sre(this,o),this.register=function(l){s.openInstances.indexOf(l)===-1&&(s.openInstances.push(l),s.emit("register"))},this.deregister=function(l){var h=s.openInstances.indexOf(l);h!==-1&&(s.openInstances.splice(h,1),s.emit("deregister"))},this.subscribe=function(l){s.subscribers.push(l)},this.emit=function(l){s.subscribers.forEach(function(h){return h(l,s.openInstances.slice())})},this.openInstances=[],this.subscribers=[]},ME=new lj;function Tre(){console.log("portalOpenInstances ----------"),console.log(ME.openInstances.length),ME.openInstances.forEach(function(o){return console.log(o)}),console.log("end portalOpenInstances ----------")}function vre(){ME=new lj}Su.default=ME;var j0={};Object.defineProperty(j0,"__esModule",{value:!0});j0.resetState=wre;j0.log=Ire;var yre=Su,Cre=Rre(yre);function Rre(o){return o&&o.__esModule?o:{default:o}}var jr=void 0,jo=void 0,sd=[];function wre(){for(var o=[jr,jo],s=0;s<o.length;s++){var l=o[s];l&&l.parentNode&&l.parentNode.removeChild(l)}jr=jo=null,sd=[]}function Ire(){console.log("bodyTrap ----------"),console.log(sd.length);for(var o=[jr,jo],s=0;s<o.length;s++){var l=o[s],h=l||{};console.log(h.nodeName,h.className,h.id)}console.log("edn bodyTrap ----------")}function JU(){sd.length!==0&&sd[sd.length-1].focusContent()}function Are(o,s){!jr&&!jo&&(jr=document.createElement("div"),jr.setAttribute("data-react-modal-body-trap",""),jr.style.position="absolute",jr.style.opacity="0",jr.setAttribute("tabindex","0"),jr.addEventListener("focus",JU),jo=jr.cloneNode(),jo.addEventListener("focus",JU)),sd=s,sd.length>0?(document.body.firstChild!==jr&&document.body.insertBefore(jr,document.body.firstChild),document.body.lastChild!==jo&&document.body.appendChild(jo)):(jr.parentElement&&jr.parentElement.removeChild(jr),jo.parentElement&&jo.parentElement.removeChild(jo))}Cre.default.subscribe(Are);(function(o,s){Object.defineProperty(s,"__esModule",{value:!0});var l=Object.assign||function(Ve){for(var nt=1;nt<arguments.length;nt++){var Dt=arguments[nt];for(var he in Dt)Object.prototype.hasOwnProperty.call(Dt,he)&&(Ve[he]=Dt[he])}return Ve},h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Ve){return typeof Ve}:function(Ve){return Ve&&typeof Symbol=="function"&&Ve.constructor===Symbol&&Ve!==Symbol.prototype?"symbol":typeof Ve},_=function(){function Ve(nt,Dt){for(var he=0;he<Dt.length;he++){var Ee=Dt[he];Ee.enumerable=Ee.enumerable||!1,Ee.configurable=!0,"value"in Ee&&(Ee.writable=!0),Object.defineProperty(nt,Ee.key,Ee)}}return function(nt,Dt,he){return Dt&&Ve(nt.prototype,Dt),he&&Ve(nt,he),nt}}(),g=we,C=sj,b=Ne(C),D=qo,M=pe(D),j=Jne,x=Ne(j),W=Jo,te=pe(W),X=gu,ie=pe(X),ve=Ko,K=Ne(ve),H=Su,Y=Ne(H);function pe(Ve){if(Ve&&Ve.__esModule)return Ve;var nt={};if(Ve!=null)for(var Dt in Ve)Object.prototype.hasOwnProperty.call(Ve,Dt)&&(nt[Dt]=Ve[Dt]);return nt.default=Ve,nt}function Ne(Ve){return Ve&&Ve.__esModule?Ve:{default:Ve}}function ke(Ve,nt){if(!(Ve instanceof nt))throw new TypeError("Cannot call a class as a function")}function Pe(Ve,nt){if(!Ve)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return nt&&(typeof nt=="object"||typeof nt=="function")?nt:Ve}function He(Ve,nt){if(typeof nt!="function"&&nt!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof nt);Ve.prototype=Object.create(nt&&nt.prototype,{constructor:{value:Ve,enumerable:!1,writable:!0,configurable:!0}}),nt&&(Object.setPrototypeOf?Object.setPrototypeOf(Ve,nt):Ve.__proto__=nt)}var mn={overlay:"ReactModal__Overlay",content:"ReactModal__Content"},mt=function(nt){return nt.code==="Tab"||nt.keyCode===9},vr=function(nt){return nt.code==="Escape"||nt.keyCode===27},Gr=0,So=function(Ve){He(nt,Ve);function nt(Dt){ke(this,nt);var he=Pe(this,(nt.__proto__||Object.getPrototypeOf(nt)).call(this,Dt));return he.setOverlayRef=function(Ee){he.overlay=Ee,he.props.overlayRef&&he.props.overlayRef(Ee)},he.setContentRef=function(Ee){he.content=Ee,he.props.contentRef&&he.props.contentRef(Ee)},he.afterClose=function(){var Ee=he.props,De=Ee.appElement,Ke=Ee.ariaHideApp,_t=Ee.htmlOpenClassName,nn=Ee.bodyOpenClassName,ei=Ee.parentSelector,Yn=ei&&ei().ownerDocument||document;nn&&ie.remove(Yn.body,nn),_t&&ie.remove(Yn.getElementsByTagName("html")[0],_t),Ke&&Gr>0&&(Gr-=1,Gr===0&&te.show(De)),he.props.shouldFocusAfterRender&&(he.props.shouldReturnFocusAfterClose?(M.returnFocus(he.props.preventScroll),M.teardownScopedFocus()):M.popWithoutFocus()),he.props.onAfterClose&&he.props.onAfterClose(),Y.default.deregister(he)},he.open=function(){he.beforeOpen(),he.state.afterOpen&&he.state.beforeClose?(clearTimeout(he.closeTimer),he.setState({beforeClose:!1})):(he.props.shouldFocusAfterRender&&(M.setupScopedFocus(he.node),M.markForFocusLater()),he.setState({isOpen:!0},function(){he.openAnimationFrame=requestAnimationFrame(function(){he.setState({afterOpen:!0}),he.props.isOpen&&he.props.onAfterOpen&&he.props.onAfterOpen({overlayEl:he.overlay,contentEl:he.content})})}))},he.close=function(){he.props.closeTimeoutMS>0?he.closeWithTimeout():he.closeWithoutTimeout()},he.focusContent=function(){return he.content&&!he.contentHasFocus()&&he.content.focus({preventScroll:!0})},he.closeWithTimeout=function(){var Ee=Date.now()+he.props.closeTimeoutMS;he.setState({beforeClose:!0,closesAt:Ee},function(){he.closeTimer=setTimeout(he.closeWithoutTimeout,he.state.closesAt-Date.now())})},he.closeWithoutTimeout=function(){he.setState({beforeClose:!1,isOpen:!1,afterOpen:!1,closesAt:null},he.afterClose)},he.handleKeyDown=function(Ee){mt(Ee)&&(0,x.default)(he.content,Ee),he.props.shouldCloseOnEsc&&vr(Ee)&&(Ee.stopPropagation(),he.requestClose(Ee))},he.handleOverlayOnClick=function(Ee){he.shouldClose===null&&(he.shouldClose=!0),he.shouldClose&&he.props.shouldCloseOnOverlayClick&&(he.ownerHandlesClose()?he.requestClose(Ee):he.focusContent()),he.shouldClose=null},he.handleContentOnMouseUp=function(){he.shouldClose=!1},he.handleOverlayOnMouseDown=function(Ee){!he.props.shouldCloseOnOverlayClick&&Ee.target==he.overlay&&Ee.preventDefault()},he.handleContentOnClick=function(){he.shouldClose=!1},he.handleContentOnMouseDown=function(){he.shouldClose=!1},he.requestClose=function(Ee){return he.ownerHandlesClose()&&he.props.onRequestClose(Ee)},he.ownerHandlesClose=function(){return he.props.onRequestClose},he.shouldBeClosed=function(){return!he.state.isOpen&&!he.state.beforeClose},he.contentHasFocus=function(){return document.activeElement===he.content||he.content.contains(document.activeElement)},he.buildClassName=function(Ee,De){var Ke=(typeof De>"u"?"undefined":h(De))==="object"?De:{base:mn[Ee],afterOpen:mn[Ee]+"--after-open",beforeClose:mn[Ee]+"--before-close"},_t=Ke.base;return he.state.afterOpen&&(_t=_t+" "+Ke.afterOpen),he.state.beforeClose&&(_t=_t+" "+Ke.beforeClose),typeof De=="string"&&De?_t+" "+De:_t},he.attributesFromObject=function(Ee,De){return Object.keys(De).reduce(function(Ke,_t){return Ke[Ee+"-"+_t]=De[_t],Ke},{})},he.state={afterOpen:!1,beforeClose:!1},he.shouldClose=null,he.moveFromContentToOverlay=null,he}return _(nt,[{key:"componentDidMount",value:function(){this.props.isOpen&&this.open()}},{key:"componentDidUpdate",value:function(he,Ee){this.props.isOpen&&!he.isOpen?this.open():!this.props.isOpen&&he.isOpen&&this.close(),this.props.shouldFocusAfterRender&&this.state.isOpen&&!Ee.isOpen&&this.focusContent()}},{key:"componentWillUnmount",value:function(){this.state.isOpen&&this.afterClose(),clearTimeout(this.closeTimer),cancelAnimationFrame(this.openAnimationFrame)}},{key:"beforeOpen",value:function(){var he=this.props,Ee=he.appElement,De=he.ariaHideApp,Ke=he.htmlOpenClassName,_t=he.bodyOpenClassName,nn=he.parentSelector,ei=nn&&nn().ownerDocument||document;_t&&ie.add(ei.body,_t),Ke&&ie.add(ei.getElementsByTagName("html")[0],Ke),De&&(Gr+=1,te.hide(Ee)),Y.default.register(this)}},{key:"render",value:function(){var he=this.props,Ee=he.id,De=he.className,Ke=he.overlayClassName,_t=he.defaultStyles,nn=he.children,ei=De?{}:_t.content,Yn=Ke?{}:_t.overlay;if(this.shouldBeClosed())return null;var Xo={ref:this.setOverlayRef,className:this.buildClassName("overlay",Ke),style:l({},Yn,this.props.style.overlay),onClick:this.handleOverlayOnClick,onMouseDown:this.handleOverlayOnMouseDown},ur=l({id:Ee,ref:this.setContentRef,style:l({},ei,this.props.style.content),className:this.buildClassName("content",De),tabIndex:"-1",onKeyDown:this.handleKeyDown,onMouseDown:this.handleContentOnMouseDown,onMouseUp:this.handleContentOnMouseUp,onClick:this.handleContentOnClick,role:this.props.role,"aria-label":this.props.contentLabel},this.attributesFromObject("aria",l({modal:!0},this.props.aria)),this.attributesFromObject("data",this.props.data||{}),{"data-testid":this.props.testId}),ea=this.props.contentElement(ur,nn);return this.props.overlayElement(Xo,ea)}}]),nt}(g.Component);So.defaultProps={style:{overlay:{},content:{}},defaultStyles:{}},So.propTypes={isOpen:b.default.bool.isRequired,defaultStyles:b.default.shape({content:b.default.object,overlay:b.default.object}),style:b.default.shape({content:b.default.object,overlay:b.default.object}),className:b.default.oneOfType([b.default.string,b.default.object]),overlayClassName:b.default.oneOfType([b.default.string,b.default.object]),parentSelector:b.default.func,bodyOpenClassName:b.default.string,htmlOpenClassName:b.default.string,ariaHideApp:b.default.bool,appElement:b.default.oneOfType([b.default.instanceOf(K.default),b.default.instanceOf(ve.SafeHTMLCollection),b.default.instanceOf(ve.SafeNodeList),b.default.arrayOf(b.default.instanceOf(K.default))]),onAfterOpen:b.default.func,onAfterClose:b.default.func,onRequestClose:b.default.func,closeTimeoutMS:b.default.number,shouldFocusAfterRender:b.default.bool,shouldCloseOnOverlayClick:b.default.bool,shouldReturnFocusAfterClose:b.default.bool,preventScroll:b.default.bool,role:b.default.string,contentLabel:b.default.string,aria:b.default.object,data:b.default.object,children:b.default.node,shouldCloseOnEsc:b.default.bool,overlayRef:b.default.func,contentRef:b.default.func,id:b.default.string,overlayElement:b.default.func,contentElement:b.default.func,testId:b.default.string},s.default=So,o.exports=s.default})(PR,PR.exports);var bre=PR.exports;function uj(){var o=this.constructor.getDerivedStateFromProps(this.props,this.state);o!=null&&this.setState(o)}function hj(o){function s(l){var h=this.constructor.getDerivedStateFromProps(o,l);return h??null}this.setState(s.bind(this))}function pj(o,s){try{var l=this.props,h=this.state;this.props=o,this.state=s,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(l,h)}finally{this.props=l,this.state=h}}uj.__suppressDeprecationWarning=!0;hj.__suppressDeprecationWarning=!0;pj.__suppressDeprecationWarning=!0;function Ore(o){var s=o.prototype;if(!s||!s.isReactComponent)throw new Error("Can only polyfill class components");if(typeof o.getDerivedStateFromProps!="function"&&typeof s.getSnapshotBeforeUpdate!="function")return o;var l=null,h=null,_=null;if(typeof s.componentWillMount=="function"?l="componentWillMount":typeof s.UNSAFE_componentWillMount=="function"&&(l="UNSAFE_componentWillMount"),typeof s.componentWillReceiveProps=="function"?h="componentWillReceiveProps":typeof s.UNSAFE_componentWillReceiveProps=="function"&&(h="UNSAFE_componentWillReceiveProps"),typeof s.componentWillUpdate=="function"?_="componentWillUpdate":typeof s.UNSAFE_componentWillUpdate=="function"&&(_="UNSAFE_componentWillUpdate"),l!==null||h!==null||_!==null){var g=o.displayName||o.name,C=typeof o.getDerivedStateFromProps=="function"?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error(`Unsafe legacy lifecycles will not be called for components using new component APIs.

`+g+" uses "+C+" but also contains the following legacy lifecycles:"+(l!==null?`
  `+l:"")+(h!==null?`
  `+h:"")+(_!==null?`
  `+_:"")+`

The above lifecycles should be removed. Learn more about this warning here:
https://fb.me/react-async-component-lifecycle-hooks`)}if(typeof o.getDerivedStateFromProps=="function"&&(s.componentWillMount=uj,s.componentWillReceiveProps=hj),typeof s.getSnapshotBeforeUpdate=="function"){if(typeof s.componentDidUpdate!="function")throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");s.componentWillUpdate=pj;var b=s.componentDidUpdate;s.componentDidUpdate=function(M,j,x){var W=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:x;b.call(this,M,j,W)}}return o}const Nre=Object.freeze(Object.defineProperty({__proto__:null,polyfill:Ore},Symbol.toStringTag,{value:"Module"})),Dre=aQ(Nre);Object.defineProperty(pd,"__esModule",{value:!0});pd.bodyOpenClassName=pd.portalClassName=void 0;var XU=Object.assign||function(o){for(var s=1;s<arguments.length;s++){var l=arguments[s];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(o[h]=l[h])}return o},Pre=function(){function o(s,l){for(var h=0;h<l.length;h++){var _=l[h];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(s,_.key,_)}}return function(s,l,h){return l&&o(s.prototype,l),h&&o(s,h),s}}(),fj=we,xE=Wp(fj),Lre=f4,UE=Wp(Lre),kre=sj,ft=Wp(kre),Mre=bre,QU=Wp(Mre),xre=Jo,Ure=jre(xre),qa=Ko,ZU=Wp(qa),Vre=Dre;function jre(o){if(o&&o.__esModule)return o;var s={};if(o!=null)for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(s[l]=o[l]);return s.default=o,s}function Wp(o){return o&&o.__esModule?o:{default:o}}function Fre(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}function $U(o,s){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:o}function Bre(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);o.prototype=Object.create(s&&s.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(o,s):o.__proto__=s)}var Gre=pd.portalClassName="ReactModalPortal",Wre=pd.bodyOpenClassName="ReactModal__Body--open",Zc=qa.canUseDOM&&UE.default.createPortal!==void 0,eV=function(s){return document.createElement(s)},tV=function(){return Zc?UE.default.createPortal:UE.default.unstable_renderSubtreeIntoContainer};function G_(o){return o()}var Hp=function(o){Bre(s,o);function s(){var l,h,_,g;Fre(this,s);for(var C=arguments.length,b=Array(C),D=0;D<C;D++)b[D]=arguments[D];return g=(h=(_=$U(this,(l=s.__proto__||Object.getPrototypeOf(s)).call.apply(l,[this].concat(b))),_),_.removePortal=function(){!Zc&&UE.default.unmountComponentAtNode(_.node);var M=G_(_.props.parentSelector);M&&M.contains(_.node)?M.removeChild(_.node):console.warn('React-Modal: "parentSelector" prop did not returned any DOM element. Make sure that the parent element is unmounted to avoid any memory leaks.')},_.portalRef=function(M){_.portal=M},_.renderPortal=function(M){var j=tV(),x=j(_,xE.default.createElement(QU.default,XU({defaultStyles:s.defaultStyles},M)),_.node);_.portalRef(x)},h),$U(_,g)}return Pre(s,[{key:"componentDidMount",value:function(){if(qa.canUseDOM){Zc||(this.node=eV("div")),this.node.className=this.props.portalClassName;var h=G_(this.props.parentSelector);h.appendChild(this.node),!Zc&&this.renderPortal(this.props)}}},{key:"getSnapshotBeforeUpdate",value:function(h){var _=G_(h.parentSelector),g=G_(this.props.parentSelector);return{prevParent:_,nextParent:g}}},{key:"componentDidUpdate",value:function(h,_,g){if(qa.canUseDOM){var C=this.props,b=C.isOpen,D=C.portalClassName;h.portalClassName!==D&&(this.node.className=D);var M=g.prevParent,j=g.nextParent;j!==M&&(M.removeChild(this.node),j.appendChild(this.node)),!(!h.isOpen&&!b)&&!Zc&&this.renderPortal(this.props)}}},{key:"componentWillUnmount",value:function(){if(!(!qa.canUseDOM||!this.node||!this.portal)){var h=this.portal.state,_=Date.now(),g=h.isOpen&&this.props.closeTimeoutMS&&(h.closesAt||_+this.props.closeTimeoutMS);g?(h.beforeClose||this.portal.closeWithTimeout(),setTimeout(this.removePortal,g-_)):this.removePortal()}}},{key:"render",value:function(){if(!qa.canUseDOM||!Zc)return null;!this.node&&Zc&&(this.node=eV("div"));var h=tV();return h(xE.default.createElement(QU.default,XU({ref:this.portalRef,defaultStyles:s.defaultStyles},this.props)),this.node)}}],[{key:"setAppElement",value:function(h){Ure.setElement(h)}}]),s}(fj.Component);Hp.propTypes={isOpen:ft.default.bool.isRequired,style:ft.default.shape({content:ft.default.object,overlay:ft.default.object}),portalClassName:ft.default.string,bodyOpenClassName:ft.default.string,htmlOpenClassName:ft.default.string,className:ft.default.oneOfType([ft.default.string,ft.default.shape({base:ft.default.string.isRequired,afterOpen:ft.default.string.isRequired,beforeClose:ft.default.string.isRequired})]),overlayClassName:ft.default.oneOfType([ft.default.string,ft.default.shape({base:ft.default.string.isRequired,afterOpen:ft.default.string.isRequired,beforeClose:ft.default.string.isRequired})]),appElement:ft.default.oneOfType([ft.default.instanceOf(ZU.default),ft.default.instanceOf(qa.SafeHTMLCollection),ft.default.instanceOf(qa.SafeNodeList),ft.default.arrayOf(ft.default.instanceOf(ZU.default))]),onAfterOpen:ft.default.func,onRequestClose:ft.default.func,closeTimeoutMS:ft.default.number,ariaHideApp:ft.default.bool,shouldFocusAfterRender:ft.default.bool,shouldCloseOnOverlayClick:ft.default.bool,shouldReturnFocusAfterClose:ft.default.bool,preventScroll:ft.default.bool,parentSelector:ft.default.func,aria:ft.default.object,data:ft.default.object,role:ft.default.string,contentLabel:ft.default.string,shouldCloseOnEsc:ft.default.bool,overlayRef:ft.default.func,contentRef:ft.default.func,id:ft.default.string,overlayElement:ft.default.func,contentElement:ft.default.func};Hp.defaultProps={isOpen:!1,portalClassName:Gre,bodyOpenClassName:Wre,role:"dialog",ariaHideApp:!0,closeTimeoutMS:0,shouldFocusAfterRender:!0,shouldCloseOnEsc:!0,shouldCloseOnOverlayClick:!0,shouldReturnFocusAfterClose:!0,preventScroll:!1,parentSelector:function(){return document.body},overlayElement:function(s,l){return xE.default.createElement("div",s,l)},contentElement:function(s,l){return xE.default.createElement("div",s,l)}};Hp.defaultStyles={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.75)"},content:{position:"absolute",top:"40px",left:"40px",right:"40px",bottom:"40px",border:"1px solid #ccc",background:"#fff",overflow:"auto",WebkitOverflowScrolling:"touch",borderRadius:"4px",outline:"none",padding:"20px"}};(0,Vre.polyfill)(Hp);pd.default=Hp;(function(o,s){Object.defineProperty(s,"__esModule",{value:!0});var l=pd,h=_(l);function _(g){return g&&g.__esModule?g:{default:g}}s.default=h.default,o.exports=s.default})(DR,DR.exports);var Hre=DR.exports;const Kre=xR(Hre),zre=({id:o,title:s,time:l,isCritical:h,file_path:_,onEdit:g,onDelete:C})=>{const[b,D]=we.useState(!1),M=pu(),j=()=>{D(!b)},x=()=>{D(!1),g(o)},W=()=>{D(!1),C(o)},te=()=>{M(`/video/${encodeURIComponent(s)}/${encodeURIComponent(_)}`)};return L.jsxs("div",{className:`cursor-pointer flex items-center justify-between bg-neutral px-3 py-4 mb-2 rounded-lg shadow ${h?"border-2 border-red-500":"bg-gray-100"}`,children:[L.jsxs("div",{className:"flex items-center",children:[L.jsx("div",{className:"w-24 h-14 bg-gray-300 rounded mr-4"}),L.jsxs("div",{onClick:te,children:[L.jsx("h2",{className:"",children:s}),L.jsx("p",{className:"text-sm text-gray-600",children:l})]})]}),L.jsxs("div",{className:"relative flex items-center",children:[h&&L.jsx(Yee,{className:"text-red-500 mr-4"}),L.jsxs("div",{className:"text-gray-600",onClick:j,children:[L.jsx(zee,{}),b&&L.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white border rounded shadow-lg",children:[L.jsx("button",{className:"block w-full text-left px-4 py-2 text-gray-800 hover:bg-gray-100",onClick:x,children:"Edit"}),L.jsx("button",{className:"block w-full text-left px-4 py-2 text-gray-800 hover:bg-gray-100",onClick:W,children:"Delete"})]})]})]})]})},Yre=()=>{const[o,s]=we.useState([]),[l,h]=we.useState("desc"),[_,g]=we.useState(!1),[C,b]=we.useState(null),[D,M]=we.useState({title:"",file_path:"",duration:"",is_critical:!1,user_id:""});we.useEffect(()=>{jn.get("http://localhost:3000/api/v1/videos").then(K=>{s(K.data)}).catch(K=>{console.error("There was an error fetching the videos!",K)})},[]);const j=[...o].sort((K,H)=>{const Y=new Date(K.created_at),pe=new Date(H.created_at);return l==="asc"?Y-pe:pe-Y}),x=()=>{h(K=>K==="asc"?"desc":"asc")},W=K=>{const H=o.find(Y=>Y.id===K);b(H),M({title:H.title||"",file_path:H.file_path||"",duration:H.duration||"",is_critical:H.is_critical||!1,user_id:H.user_id||""}),g(!0),console.log("Modal should open, "+_)},te=K=>{jn.delete(`http://localhost:3000/api/v1/videos/${K}`).then(H=>{s(o.filter(Y=>Y.id!==K))}).catch(H=>{console.error("There was an error deleting the video!",H)})},X=K=>{const{name:H,value:Y,type:pe,checked:Ne}=K.target;M(ke=>({...ke,[H]:pe==="checkbox"?Ne:Y}))},ie=K=>{K.preventDefault(),jn.put(`http://localhost:3000/api/v1/videos/${C.id}`,D).then(H=>{s(o.map(Y=>Y.id===C.id?H.data:Y)),g(!1),b(null)}).catch(H=>{console.error("There was an error updating the video!",H)})},ve=()=>{g(!1),b(null)};return L.jsxs("div",{className:"font-ubuntu p-4 py-8 flex flex-col h-screen",children:[L.jsxs("div",{className:"flex-grow overflow-auto p-4",children:[L.jsx("h1",{className:"text-2xl text-primary font-bold mb-4",children:"History"}),L.jsxs("div",{className:"flex justify-between items-center pt-2 mb-4",children:[L.jsx("span",{className:"text-gray-600",children:"All"}),L.jsxs("button",{onClick:x,className:"text-gray-600",children:["Sort By: Date (",l==="asc"?"Ascending":"Descending",")"]})]}),j.map(K=>L.jsx("div",{className:"mb-4",children:L.jsx(zre,{id:K.id,title:K.title,time:new Date(K.created_at).toLocaleString(),isCritical:K.is_critical,file_path:K.file_path,onEdit:W,onDelete:te})},K.id))]}),L.jsx(mu,{}),L.jsx(Kre,{isOpen:_,onRequestClose:ve,contentLabel:"Edit Video",className:"modal",overlayClassName:"overlay",ariaHideApp:!1,children:C&&L.jsxs("div",{children:[L.jsx("h2",{children:"Edit Video"}),L.jsxs("form",{onSubmit:ie,children:[L.jsxs("div",{children:[L.jsx("label",{children:"Title:"}),L.jsx("input",{type:"text",name:"title",value:D.title,onChange:X,className:"border p-1"})]}),L.jsxs("div",{children:[L.jsx("label",{children:"File Path:"}),L.jsx("input",{type:"text",name:"file_path",value:D.file_path,onChange:X,className:"border p-1"})]}),L.jsxs("div",{children:[L.jsx("label",{children:"Duration:"}),L.jsx("input",{type:"number",name:"duration",value:D.duration,onChange:X,className:"border p-1"})]}),L.jsx("div",{children:L.jsxs("label",{children:[L.jsx("input",{type:"checkbox",name:"is_critical",checked:D.is_critical,onChange:X}),"Critical"]})}),L.jsxs("div",{children:[L.jsx("label",{children:"User ID:"}),L.jsx("input",{type:"text",name:"user_id",value:D.user_id,onChange:X,className:"border p-1"})]}),L.jsx("button",{type:"submit",className:"bg-blue-500 text-white p-2 mt-2",children:"Save"}),L.jsx("button",{onClick:ve,className:"bg-gray-500 text-white p-2 mt-2 ml-2",children:"Cancel"})]})]})})]})},qre=()=>{const{filePath:o,title:s}=R4();return L.jsxs("div",{className:"video-player",children:[L.jsx("h1",{children:s}),L.jsxs("video",{controls:!0,children:[L.jsx("source",{src:o,type:"video/mp4"}),"Your browser does not support the video tag."]})]})};function Jre(){return L.jsx(bee,{children:L.jsxs(vee,{children:[L.jsx(Li,{path:"/",element:L.jsx(Pee,{})}),L.jsx(Li,{path:"/user",element:L.jsx(xee,{})}),L.jsx(Li,{path:"/camera",element:L.jsx(Uee,{})}),L.jsx(Li,{path:"/camera/:id",element:L.jsx(rte,{})}),L.jsx(Li,{path:"/user-home",element:L.jsx(Zee,{})}),L.jsx(Li,{path:"/profile",element:L.jsx(nte,{})}),L.jsx(Li,{path:"/profile/particulars",element:L.jsx($ee,{})}),L.jsx(Li,{path:"/profile/accsettings",element:L.jsx(ete,{})}),L.jsx(Li,{path:"/profile/editcams",element:L.jsx(tte,{})}),L.jsx(Li,{path:"/vidrecord",element:L.jsx(kne,{})}),L.jsx(Li,{path:"/histories",element:L.jsx(Yre,{})}),L.jsx(Li,{path:"/video/:title/:filePath",element:L.jsx(qre,{})})]})})}const Xre=m4(document.getElementById("root"));Xre.render(L.jsx(Ys.StrictMode,{children:L.jsx(Jre,{})}));
