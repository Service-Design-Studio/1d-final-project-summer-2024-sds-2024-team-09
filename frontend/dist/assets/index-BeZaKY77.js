function cQ(o,s){for(var d=0;d<s.length;d++){const h=s[d];if(typeof h!="string"&&!Array.isArray(h)){for(const _ in h)if(_!=="default"&&!(_ in o)){const g=Object.getOwnPropertyDescriptor(h,_);g&&Object.defineProperty(o,_,g.get?g:{enumerable:!0,get:()=>h[_]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))h(_);new MutationObserver(_=>{for(const g of _)if(g.type==="childList")for(const C of g.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&h(C)}).observe(document,{childList:!0,subtree:!0});function d(_){const g={};return _.integrity&&(g.integrity=_.integrity),_.referrerPolicy&&(g.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?g.credentials="include":_.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function h(_){if(_.ep)return;_.ep=!0;const g=d(_);fetch(_.href,g)}})();var R_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function U0(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function dQ(o){if(o.__esModule)return o;var s=o.default;if(typeof s=="function"){var d=function h(){return this instanceof h?Reflect.construct(s,arguments,this.constructor):s.apply(this,arguments)};d.prototype=s.prototype}else d={};return Object.defineProperty(d,"__esModule",{value:!0}),Object.keys(o).forEach(function(h){var _=Object.getOwnPropertyDescriptor(o,h);Object.defineProperty(d,h,_.get?_:{enumerable:!0,get:function(){return o[h]}})}),d}var rj={exports:{}},VE={},ij={exports:{}},Lt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xp=Symbol.for("react.element"),lQ=Symbol.for("react.portal"),uQ=Symbol.for("react.fragment"),hQ=Symbol.for("react.strict_mode"),pQ=Symbol.for("react.profiler"),fQ=Symbol.for("react.provider"),mQ=Symbol.for("react.context"),_Q=Symbol.for("react.forward_ref"),EQ=Symbol.for("react.suspense"),gQ=Symbol.for("react.memo"),SQ=Symbol.for("react.lazy"),_x=Symbol.iterator;function TQ(o){return o===null||typeof o!="object"?null:(o=_x&&o[_x]||o["@@iterator"],typeof o=="function"?o:null)}var oj={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},sj=Object.assign,aj={};function uu(o,s,d){this.props=o,this.context=s,this.refs=aj,this.updater=d||oj}uu.prototype.isReactComponent={};uu.prototype.setState=function(o,s){if(typeof o!="object"&&typeof o!="function"&&o!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,o,s,"setState")};uu.prototype.forceUpdate=function(o){this.updater.enqueueForceUpdate(this,o,"forceUpdate")};function cj(){}cj.prototype=uu.prototype;function j0(o,s,d){this.props=o,this.context=s,this.refs=aj,this.updater=d||oj}var V0=j0.prototype=new cj;V0.constructor=j0;sj(V0,uu.prototype);V0.isPureReactComponent=!0;var Ex=Array.isArray,dj=Object.prototype.hasOwnProperty,F0={current:null},lj={key:!0,ref:!0,__self:!0,__source:!0};function uj(o,s,d){var h,_={},g=null,C=null;if(s!=null)for(h in s.ref!==void 0&&(C=s.ref),s.key!==void 0&&(g=""+s.key),s)dj.call(s,h)&&!lj.hasOwnProperty(h)&&(_[h]=s[h]);var A=arguments.length-2;if(A===1)_.children=d;else if(1<A){for(var P=Array(A),M=0;M<A;M++)P[M]=arguments[M+2];_.children=P}if(o&&o.defaultProps)for(h in A=o.defaultProps,A)_[h]===void 0&&(_[h]=A[h]);return{$$typeof:xp,type:o,key:g,ref:C,props:_,_owner:F0.current}}function vQ(o,s){return{$$typeof:xp,type:o.type,key:s,ref:o.ref,props:o.props,_owner:o._owner}}function B0(o){return typeof o=="object"&&o!==null&&o.$$typeof===xp}function yQ(o){var s={"=":"=0",":":"=2"};return"$"+o.replace(/[=:]/g,function(d){return s[d]})}var gx=/\/+/g;function $y(o,s){return typeof o=="object"&&o!==null&&o.key!=null?yQ(""+o.key):s.toString(36)}function H_(o,s,d,h,_){var g=typeof o;(g==="undefined"||g==="boolean")&&(o=null);var C=!1;if(o===null)C=!0;else switch(g){case"string":case"number":C=!0;break;case"object":switch(o.$$typeof){case xp:case lQ:C=!0}}if(C)return C=o,_=_(C),o=h===""?"."+$y(C,0):h,Ex(_)?(d="",o!=null&&(d=o.replace(gx,"$&/")+"/"),H_(_,s,d,"",function(M){return M})):_!=null&&(B0(_)&&(_=vQ(_,d+(!_.key||C&&C.key===_.key?"":(""+_.key).replace(gx,"$&/")+"/")+o)),s.push(_)),1;if(C=0,h=h===""?".":h+":",Ex(o))for(var A=0;A<o.length;A++){g=o[A];var P=h+$y(g,A);C+=H_(g,s,d,P,_)}else if(P=TQ(o),typeof P=="function")for(o=P.call(o),A=0;!(g=o.next()).done;)g=g.value,P=h+$y(g,A++),C+=H_(g,s,d,P,_);else if(g==="object")throw s=String(o),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return C}function w_(o,s,d){if(o==null)return o;var h=[],_=0;return H_(o,h,"","",function(g){return s.call(d,g,_++)}),h}function CQ(o){if(o._status===-1){var s=o._result;s=s(),s.then(function(d){(o._status===0||o._status===-1)&&(o._status=1,o._result=d)},function(d){(o._status===0||o._status===-1)&&(o._status=2,o._result=d)}),o._status===-1&&(o._status=0,o._result=s)}if(o._status===1)return o._result.default;throw o._result}var ei={current:null},K_={transition:null},RQ={ReactCurrentDispatcher:ei,ReactCurrentBatchConfig:K_,ReactCurrentOwner:F0};function hj(){throw Error("act(...) is not supported in production builds of React.")}Lt.Children={map:w_,forEach:function(o,s,d){w_(o,function(){s.apply(this,arguments)},d)},count:function(o){var s=0;return w_(o,function(){s++}),s},toArray:function(o){return w_(o,function(s){return s})||[]},only:function(o){if(!B0(o))throw Error("React.Children.only expected to receive a single React element child.");return o}};Lt.Component=uu;Lt.Fragment=uQ;Lt.Profiler=pQ;Lt.PureComponent=j0;Lt.StrictMode=hQ;Lt.Suspense=EQ;Lt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=RQ;Lt.act=hj;Lt.cloneElement=function(o,s,d){if(o==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+o+".");var h=sj({},o.props),_=o.key,g=o.ref,C=o._owner;if(s!=null){if(s.ref!==void 0&&(g=s.ref,C=F0.current),s.key!==void 0&&(_=""+s.key),o.type&&o.type.defaultProps)var A=o.type.defaultProps;for(P in s)dj.call(s,P)&&!lj.hasOwnProperty(P)&&(h[P]=s[P]===void 0&&A!==void 0?A[P]:s[P])}var P=arguments.length-2;if(P===1)h.children=d;else if(1<P){A=Array(P);for(var M=0;M<P;M++)A[M]=arguments[M+2];h.children=A}return{$$typeof:xp,type:o.type,key:_,ref:g,props:h,_owner:C}};Lt.createContext=function(o){return o={$$typeof:mQ,_currentValue:o,_currentValue2:o,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},o.Provider={$$typeof:fQ,_context:o},o.Consumer=o};Lt.createElement=uj;Lt.createFactory=function(o){var s=uj.bind(null,o);return s.type=o,s};Lt.createRef=function(){return{current:null}};Lt.forwardRef=function(o){return{$$typeof:_Q,render:o}};Lt.isValidElement=B0;Lt.lazy=function(o){return{$$typeof:SQ,_payload:{_status:-1,_result:o},_init:CQ}};Lt.memo=function(o,s){return{$$typeof:gQ,type:o,compare:s===void 0?null:s}};Lt.startTransition=function(o){var s=K_.transition;K_.transition={};try{o()}finally{K_.transition=s}};Lt.unstable_act=hj;Lt.useCallback=function(o,s){return ei.current.useCallback(o,s)};Lt.useContext=function(o){return ei.current.useContext(o)};Lt.useDebugValue=function(){};Lt.useDeferredValue=function(o){return ei.current.useDeferredValue(o)};Lt.useEffect=function(o,s){return ei.current.useEffect(o,s)};Lt.useId=function(){return ei.current.useId()};Lt.useImperativeHandle=function(o,s,d){return ei.current.useImperativeHandle(o,s,d)};Lt.useInsertionEffect=function(o,s){return ei.current.useInsertionEffect(o,s)};Lt.useLayoutEffect=function(o,s){return ei.current.useLayoutEffect(o,s)};Lt.useMemo=function(o,s){return ei.current.useMemo(o,s)};Lt.useReducer=function(o,s,d){return ei.current.useReducer(o,s,d)};Lt.useRef=function(o){return ei.current.useRef(o)};Lt.useState=function(o){return ei.current.useState(o)};Lt.useSyncExternalStore=function(o,s,d){return ei.current.useSyncExternalStore(o,s,d)};Lt.useTransition=function(){return ei.current.useTransition()};Lt.version="18.3.1";ij.exports=Lt;var ve=ij.exports;const qs=U0(ve),wQ=cQ({__proto__:null,default:qs},[ve]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var IQ=ve,bQ=Symbol.for("react.element"),AQ=Symbol.for("react.fragment"),OQ=Object.prototype.hasOwnProperty,NQ=IQ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,DQ={key:!0,ref:!0,__self:!0,__source:!0};function pj(o,s,d){var h,_={},g=null,C=null;d!==void 0&&(g=""+d),s.key!==void 0&&(g=""+s.key),s.ref!==void 0&&(C=s.ref);for(h in s)OQ.call(s,h)&&!DQ.hasOwnProperty(h)&&(_[h]=s[h]);if(o&&o.defaultProps)for(h in s=o.defaultProps,s)_[h]===void 0&&(_[h]=s[h]);return{$$typeof:bQ,type:o,key:g,ref:C,props:_,_owner:NQ.current}}VE.Fragment=AQ;VE.jsx=pj;VE.jsxs=pj;rj.exports=VE;var N=rj.exports,fj={exports:{}},Vi={},mj={exports:{}},_j={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(o){function s(ge,De){var Ke=ge.length;ge.push(De);e:for(;0<Ke;){var _t=Ke-1>>>1,rn=ge[_t];if(0<_(rn,De))ge[_t]=De,ge[Ke]=rn,Ke=_t;else break e}}function d(ge){return ge.length===0?null:ge[0]}function h(ge){if(ge.length===0)return null;var De=ge[0],Ke=ge.pop();if(Ke!==De){ge[0]=Ke;e:for(var _t=0,rn=ge.length,ni=rn>>>1;_t<ni;){var qn=2*(_t+1)-1,Qo=ge[qn],pr=qn+1,ta=ge[pr];if(0>_(Qo,Ke))pr<rn&&0>_(ta,Qo)?(ge[_t]=ta,ge[pr]=Ke,_t=pr):(ge[_t]=Qo,ge[qn]=Ke,_t=qn);else if(pr<rn&&0>_(ta,Ke))ge[_t]=ta,ge[pr]=Ke,_t=pr;else break e}}return De}function _(ge,De){var Ke=ge.sortIndex-De.sortIndex;return Ke!==0?Ke:ge.id-De.id}if(typeof performance=="object"&&typeof performance.now=="function"){var g=performance;o.unstable_now=function(){return g.now()}}else{var C=Date,A=C.now();o.unstable_now=function(){return C.now()-A}}var P=[],M=[],V=1,j=null,G=3,Z=!1,z=!1,$=!1,pe=typeof setTimeout=="function"?setTimeout:null,K=typeof clearTimeout=="function"?clearTimeout:null,H=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Y(ge){for(var De=d(M);De!==null;){if(De.callback===null)h(M);else if(De.startTime<=ge)h(M),De.sortIndex=De.expirationTime,s(P,De);else break;De=d(M)}}function ae(ge){if($=!1,Y(ge),!z)if(d(P)!==null)z=!0,Dt(Ae);else{var De=d(M);De!==null&&fe(ae,De.startTime-ge)}}function Ae(ge,De){z=!1,$&&($=!1,K(We),We=-1),Z=!0;var Ke=G;try{for(Y(De),j=d(P);j!==null&&(!(j.expirationTime>De)||ge&&!or());){var _t=j.callback;if(typeof _t=="function"){j.callback=null,G=j.priorityLevel;var rn=_t(j.expirationTime<=De);De=o.unstable_now(),typeof rn=="function"?j.callback=rn:j===d(P)&&h(P),Y(De)}else h(P);j=d(P)}if(j!==null)var ni=!0;else{var qn=d(M);qn!==null&&fe(ae,qn.startTime-De),ni=!1}return ni}finally{j=null,G=Ke,Z=!1}}var Le=!1,Pe=null,We=-1,Jt=5,dt=-1;function or(){return!(o.unstable_now()-dt<Jt)}function Cr(){if(Pe!==null){var ge=o.unstable_now();dt=ge;var De=!0;try{De=Pe(!0,ge)}finally{De?Yn():(Le=!1,Pe=null)}}else Le=!1}var Yn;if(typeof H=="function")Yn=function(){H(Cr)};else if(typeof MessageChannel<"u"){var je=new MessageChannel,nt=je.port2;je.port1.onmessage=Cr,Yn=function(){nt.postMessage(null)}}else Yn=function(){pe(Cr,0)};function Dt(ge){Pe=ge,Le||(Le=!0,Yn())}function fe(ge,De){We=pe(function(){ge(o.unstable_now())},De)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(ge){ge.callback=null},o.unstable_continueExecution=function(){z||Z||(z=!0,Dt(Ae))},o.unstable_forceFrameRate=function(ge){0>ge||125<ge?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Jt=0<ge?Math.floor(1e3/ge):5},o.unstable_getCurrentPriorityLevel=function(){return G},o.unstable_getFirstCallbackNode=function(){return d(P)},o.unstable_next=function(ge){switch(G){case 1:case 2:case 3:var De=3;break;default:De=G}var Ke=G;G=De;try{return ge()}finally{G=Ke}},o.unstable_pauseExecution=function(){},o.unstable_requestPaint=function(){},o.unstable_runWithPriority=function(ge,De){switch(ge){case 1:case 2:case 3:case 4:case 5:break;default:ge=3}var Ke=G;G=ge;try{return De()}finally{G=Ke}},o.unstable_scheduleCallback=function(ge,De,Ke){var _t=o.unstable_now();switch(typeof Ke=="object"&&Ke!==null?(Ke=Ke.delay,Ke=typeof Ke=="number"&&0<Ke?_t+Ke:_t):Ke=_t,ge){case 1:var rn=-1;break;case 2:rn=250;break;case 5:rn=1073741823;break;case 4:rn=1e4;break;default:rn=5e3}return rn=Ke+rn,ge={id:V++,callback:De,priorityLevel:ge,startTime:Ke,expirationTime:rn,sortIndex:-1},Ke>_t?(ge.sortIndex=Ke,s(M,ge),d(P)===null&&ge===d(M)&&($?(K(We),We=-1):$=!0,fe(ae,Ke-_t))):(ge.sortIndex=rn,s(P,ge),z||Z||(z=!0,Dt(Ae))),ge},o.unstable_shouldYield=or,o.unstable_wrapCallback=function(ge){var De=G;return function(){var Ke=G;G=De;try{return ge.apply(this,arguments)}finally{G=Ke}}}})(_j);mj.exports=_j;var PQ=mj.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LQ=ve,ji=PQ;function Ie(o){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+o,d=1;d<arguments.length;d++)s+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+o+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ej=new Set,fp={};function Ed(o,s){ru(o,s),ru(o+"Capture",s)}function ru(o,s){for(fp[o]=s,o=0;o<s.length;o++)Ej.add(s[o])}var Xs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),NC=Object.prototype.hasOwnProperty,kQ=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Sx={},Tx={};function MQ(o){return NC.call(Tx,o)?!0:NC.call(Sx,o)?!1:kQ.test(o)?Tx[o]=!0:(Sx[o]=!0,!1)}function xQ(o,s,d,h){if(d!==null&&d.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return h?!1:d!==null?!d.acceptsBooleans:(o=o.toLowerCase().slice(0,5),o!=="data-"&&o!=="aria-");default:return!1}}function UQ(o,s,d,h){if(s===null||typeof s>"u"||xQ(o,s,d,h))return!0;if(h)return!1;if(d!==null)switch(d.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function ti(o,s,d,h,_,g,C){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=h,this.attributeNamespace=_,this.mustUseProperty=d,this.propertyName=o,this.type=s,this.sanitizeURL=g,this.removeEmptyString=C}var Nr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(o){Nr[o]=new ti(o,0,!1,o,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(o){var s=o[0];Nr[s]=new ti(s,1,!1,o[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(o){Nr[o]=new ti(o,2,!1,o.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(o){Nr[o]=new ti(o,2,!1,o,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(o){Nr[o]=new ti(o,3,!1,o.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(o){Nr[o]=new ti(o,3,!0,o,null,!1,!1)});["capture","download"].forEach(function(o){Nr[o]=new ti(o,4,!1,o,null,!1,!1)});["cols","rows","size","span"].forEach(function(o){Nr[o]=new ti(o,6,!1,o,null,!1,!1)});["rowSpan","start"].forEach(function(o){Nr[o]=new ti(o,5,!1,o.toLowerCase(),null,!1,!1)});var W0=/[\-:]([a-z])/g;function G0(o){return o[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(o){var s=o.replace(W0,G0);Nr[s]=new ti(s,1,!1,o,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(o){var s=o.replace(W0,G0);Nr[s]=new ti(s,1,!1,o,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(o){var s=o.replace(W0,G0);Nr[s]=new ti(s,1,!1,o,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(o){Nr[o]=new ti(o,1,!1,o.toLowerCase(),null,!1,!1)});Nr.xlinkHref=new ti("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(o){Nr[o]=new ti(o,1,!1,o.toLowerCase(),null,!0,!0)});function H0(o,s,d,h){var _=Nr.hasOwnProperty(s)?Nr[s]:null;(_!==null?_.type!==0:h||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(UQ(s,d,_,h)&&(d=null),h||_===null?MQ(s)&&(d===null?o.removeAttribute(s):o.setAttribute(s,""+d)):_.mustUseProperty?o[_.propertyName]=d===null?_.type===3?!1:"":d:(s=_.attributeName,h=_.attributeNamespace,d===null?o.removeAttribute(s):(_=_.type,d=_===3||_===4&&d===!0?"":""+d,h?o.setAttributeNS(h,s,d):o.setAttribute(s,d))))}var ea=LQ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,I_=Symbol.for("react.element"),Ul=Symbol.for("react.portal"),jl=Symbol.for("react.fragment"),K0=Symbol.for("react.strict_mode"),DC=Symbol.for("react.profiler"),gj=Symbol.for("react.provider"),Sj=Symbol.for("react.context"),z0=Symbol.for("react.forward_ref"),PC=Symbol.for("react.suspense"),LC=Symbol.for("react.suspense_list"),Y0=Symbol.for("react.memo"),Wa=Symbol.for("react.lazy"),Tj=Symbol.for("react.offscreen"),vx=Symbol.iterator;function Wh(o){return o===null||typeof o!="object"?null:(o=vx&&o[vx]||o["@@iterator"],typeof o=="function"?o:null)}var Fn=Object.assign,eC;function Qh(o){if(eC===void 0)try{throw Error()}catch(d){var s=d.stack.trim().match(/\n( *(at )?)/);eC=s&&s[1]||""}return`
`+eC+o}var tC=!1;function nC(o,s){if(!o||tC)return"";tC=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(M){var h=M}Reflect.construct(o,[],s)}else{try{s.call()}catch(M){h=M}o.call(s.prototype)}else{try{throw Error()}catch(M){h=M}o()}}catch(M){if(M&&h&&typeof M.stack=="string"){for(var _=M.stack.split(`
`),g=h.stack.split(`
`),C=_.length-1,A=g.length-1;1<=C&&0<=A&&_[C]!==g[A];)A--;for(;1<=C&&0<=A;C--,A--)if(_[C]!==g[A]){if(C!==1||A!==1)do if(C--,A--,0>A||_[C]!==g[A]){var P=`
`+_[C].replace(" at new "," at ");return o.displayName&&P.includes("<anonymous>")&&(P=P.replace("<anonymous>",o.displayName)),P}while(1<=C&&0<=A);break}}}finally{tC=!1,Error.prepareStackTrace=d}return(o=o?o.displayName||o.name:"")?Qh(o):""}function jQ(o){switch(o.tag){case 5:return Qh(o.type);case 16:return Qh("Lazy");case 13:return Qh("Suspense");case 19:return Qh("SuspenseList");case 0:case 2:case 15:return o=nC(o.type,!1),o;case 11:return o=nC(o.type.render,!1),o;case 1:return o=nC(o.type,!0),o;default:return""}}function kC(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case jl:return"Fragment";case Ul:return"Portal";case DC:return"Profiler";case K0:return"StrictMode";case PC:return"Suspense";case LC:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case Sj:return(o.displayName||"Context")+".Consumer";case gj:return(o._context.displayName||"Context")+".Provider";case z0:var s=o.render;return o=o.displayName,o||(o=s.displayName||s.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case Y0:return s=o.displayName||null,s!==null?s:kC(o.type)||"Memo";case Wa:s=o._payload,o=o._init;try{return kC(o(s))}catch{}}return null}function VQ(o){var s=o.type;switch(o.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=s.render,o=o.displayName||o.name||"",s.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return kC(s);case 8:return s===K0?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function oc(o){switch(typeof o){case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function vj(o){var s=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function FQ(o){var s=vj(o)?"checked":"value",d=Object.getOwnPropertyDescriptor(o.constructor.prototype,s),h=""+o[s];if(!o.hasOwnProperty(s)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var _=d.get,g=d.set;return Object.defineProperty(o,s,{configurable:!0,get:function(){return _.call(this)},set:function(C){h=""+C,g.call(this,C)}}),Object.defineProperty(o,s,{enumerable:d.enumerable}),{getValue:function(){return h},setValue:function(C){h=""+C},stopTracking:function(){o._valueTracker=null,delete o[s]}}}}function b_(o){o._valueTracker||(o._valueTracker=FQ(o))}function yj(o){if(!o)return!1;var s=o._valueTracker;if(!s)return!0;var d=s.getValue(),h="";return o&&(h=vj(o)?o.checked?"true":"false":o.value),o=h,o!==d?(s.setValue(o),!0):!1}function sE(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}function MC(o,s){var d=s.checked;return Fn({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??o._wrapperState.initialChecked})}function yx(o,s){var d=s.defaultValue==null?"":s.defaultValue,h=s.checked!=null?s.checked:s.defaultChecked;d=oc(s.value!=null?s.value:d),o._wrapperState={initialChecked:h,initialValue:d,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function Cj(o,s){s=s.checked,s!=null&&H0(o,"checked",s,!1)}function xC(o,s){Cj(o,s);var d=oc(s.value),h=s.type;if(d!=null)h==="number"?(d===0&&o.value===""||o.value!=d)&&(o.value=""+d):o.value!==""+d&&(o.value=""+d);else if(h==="submit"||h==="reset"){o.removeAttribute("value");return}s.hasOwnProperty("value")?UC(o,s.type,d):s.hasOwnProperty("defaultValue")&&UC(o,s.type,oc(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(o.defaultChecked=!!s.defaultChecked)}function Cx(o,s,d){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var h=s.type;if(!(h!=="submit"&&h!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+o._wrapperState.initialValue,d||s===o.value||(o.value=s),o.defaultValue=s}d=o.name,d!==""&&(o.name=""),o.defaultChecked=!!o._wrapperState.initialChecked,d!==""&&(o.name=d)}function UC(o,s,d){(s!=="number"||sE(o.ownerDocument)!==o)&&(d==null?o.defaultValue=""+o._wrapperState.initialValue:o.defaultValue!==""+d&&(o.defaultValue=""+d))}var Zh=Array.isArray;function Ql(o,s,d,h){if(o=o.options,s){s={};for(var _=0;_<d.length;_++)s["$"+d[_]]=!0;for(d=0;d<o.length;d++)_=s.hasOwnProperty("$"+o[d].value),o[d].selected!==_&&(o[d].selected=_),_&&h&&(o[d].defaultSelected=!0)}else{for(d=""+oc(d),s=null,_=0;_<o.length;_++){if(o[_].value===d){o[_].selected=!0,h&&(o[_].defaultSelected=!0);return}s!==null||o[_].disabled||(s=o[_])}s!==null&&(s.selected=!0)}}function jC(o,s){if(s.dangerouslySetInnerHTML!=null)throw Error(Ie(91));return Fn({},s,{value:void 0,defaultValue:void 0,children:""+o._wrapperState.initialValue})}function Rx(o,s){var d=s.value;if(d==null){if(d=s.children,s=s.defaultValue,d!=null){if(s!=null)throw Error(Ie(92));if(Zh(d)){if(1<d.length)throw Error(Ie(93));d=d[0]}s=d}s==null&&(s=""),d=s}o._wrapperState={initialValue:oc(d)}}function Rj(o,s){var d=oc(s.value),h=oc(s.defaultValue);d!=null&&(d=""+d,d!==o.value&&(o.value=d),s.defaultValue==null&&o.defaultValue!==d&&(o.defaultValue=d)),h!=null&&(o.defaultValue=""+h)}function wx(o){var s=o.textContent;s===o._wrapperState.initialValue&&s!==""&&s!==null&&(o.value=s)}function wj(o){switch(o){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function VC(o,s){return o==null||o==="http://www.w3.org/1999/xhtml"?wj(s):o==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":o}var A_,Ij=function(o){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,d,h,_){MSApp.execUnsafeLocalFunction(function(){return o(s,d,h,_)})}:o}(function(o,s){if(o.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in o)o.innerHTML=s;else{for(A_=A_||document.createElement("div"),A_.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=A_.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;s.firstChild;)o.appendChild(s.firstChild)}});function mp(o,s){if(s){var d=o.firstChild;if(d&&d===o.lastChild&&d.nodeType===3){d.nodeValue=s;return}}o.textContent=s}var rp={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},BQ=["Webkit","ms","Moz","O"];Object.keys(rp).forEach(function(o){BQ.forEach(function(s){s=s+o.charAt(0).toUpperCase()+o.substring(1),rp[s]=rp[o]})});function bj(o,s,d){return s==null||typeof s=="boolean"||s===""?"":d||typeof s!="number"||s===0||rp.hasOwnProperty(o)&&rp[o]?(""+s).trim():s+"px"}function Aj(o,s){o=o.style;for(var d in s)if(s.hasOwnProperty(d)){var h=d.indexOf("--")===0,_=bj(d,s[d],h);d==="float"&&(d="cssFloat"),h?o.setProperty(d,_):o[d]=_}}var WQ=Fn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function FC(o,s){if(s){if(WQ[o]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(Ie(137,o));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(Ie(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(Ie(61))}if(s.style!=null&&typeof s.style!="object")throw Error(Ie(62))}}function BC(o,s){if(o.indexOf("-")===-1)return typeof s.is=="string";switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var WC=null;function q0(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var GC=null,Zl=null,$l=null;function Ix(o){if(o=Vp(o)){if(typeof GC!="function")throw Error(Ie(280));var s=o.stateNode;s&&(s=HE(s),GC(o.stateNode,o.type,s))}}function Oj(o){Zl?$l?$l.push(o):$l=[o]:Zl=o}function Nj(){if(Zl){var o=Zl,s=$l;if($l=Zl=null,Ix(o),s)for(o=0;o<s.length;o++)Ix(s[o])}}function Dj(o,s){return o(s)}function Pj(){}var rC=!1;function Lj(o,s,d){if(rC)return o(s,d);rC=!0;try{return Dj(o,s,d)}finally{rC=!1,(Zl!==null||$l!==null)&&(Pj(),Nj())}}function _p(o,s){var d=o.stateNode;if(d===null)return null;var h=HE(d);if(h===null)return null;d=h[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(o=o.type,h=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!h;break e;default:o=!1}if(o)return null;if(d&&typeof d!="function")throw Error(Ie(231,s,typeof d));return d}var HC=!1;if(Xs)try{var Gh={};Object.defineProperty(Gh,"passive",{get:function(){HC=!0}}),window.addEventListener("test",Gh,Gh),window.removeEventListener("test",Gh,Gh)}catch{HC=!1}function GQ(o,s,d,h,_,g,C,A,P){var M=Array.prototype.slice.call(arguments,3);try{s.apply(d,M)}catch(V){this.onError(V)}}var ip=!1,aE=null,cE=!1,KC=null,HQ={onError:function(o){ip=!0,aE=o}};function KQ(o,s,d,h,_,g,C,A,P){ip=!1,aE=null,GQ.apply(HQ,arguments)}function zQ(o,s,d,h,_,g,C,A,P){if(KQ.apply(this,arguments),ip){if(ip){var M=aE;ip=!1,aE=null}else throw Error(Ie(198));cE||(cE=!0,KC=M)}}function gd(o){var s=o,d=o;if(o.alternate)for(;s.return;)s=s.return;else{o=s;do s=o,s.flags&4098&&(d=s.return),o=s.return;while(o)}return s.tag===3?d:null}function kj(o){if(o.tag===13){var s=o.memoizedState;if(s===null&&(o=o.alternate,o!==null&&(s=o.memoizedState)),s!==null)return s.dehydrated}return null}function bx(o){if(gd(o)!==o)throw Error(Ie(188))}function YQ(o){var s=o.alternate;if(!s){if(s=gd(o),s===null)throw Error(Ie(188));return s!==o?null:o}for(var d=o,h=s;;){var _=d.return;if(_===null)break;var g=_.alternate;if(g===null){if(h=_.return,h!==null){d=h;continue}break}if(_.child===g.child){for(g=_.child;g;){if(g===d)return bx(_),o;if(g===h)return bx(_),s;g=g.sibling}throw Error(Ie(188))}if(d.return!==h.return)d=_,h=g;else{for(var C=!1,A=_.child;A;){if(A===d){C=!0,d=_,h=g;break}if(A===h){C=!0,h=_,d=g;break}A=A.sibling}if(!C){for(A=g.child;A;){if(A===d){C=!0,d=g,h=_;break}if(A===h){C=!0,h=g,d=_;break}A=A.sibling}if(!C)throw Error(Ie(189))}}if(d.alternate!==h)throw Error(Ie(190))}if(d.tag!==3)throw Error(Ie(188));return d.stateNode.current===d?o:s}function Mj(o){return o=YQ(o),o!==null?xj(o):null}function xj(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var s=xj(o);if(s!==null)return s;o=o.sibling}return null}var Uj=ji.unstable_scheduleCallback,Ax=ji.unstable_cancelCallback,qQ=ji.unstable_shouldYield,JQ=ji.unstable_requestPaint,$n=ji.unstable_now,XQ=ji.unstable_getCurrentPriorityLevel,J0=ji.unstable_ImmediatePriority,jj=ji.unstable_UserBlockingPriority,dE=ji.unstable_NormalPriority,QQ=ji.unstable_LowPriority,Vj=ji.unstable_IdlePriority,FE=null,ws=null;function ZQ(o){if(ws&&typeof ws.onCommitFiberRoot=="function")try{ws.onCommitFiberRoot(FE,o,void 0,(o.current.flags&128)===128)}catch{}}var Go=Math.clz32?Math.clz32:tZ,$Q=Math.log,eZ=Math.LN2;function tZ(o){return o>>>=0,o===0?32:31-($Q(o)/eZ|0)|0}var O_=64,N_=4194304;function $h(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function lE(o,s){var d=o.pendingLanes;if(d===0)return 0;var h=0,_=o.suspendedLanes,g=o.pingedLanes,C=d&268435455;if(C!==0){var A=C&~_;A!==0?h=$h(A):(g&=C,g!==0&&(h=$h(g)))}else C=d&~_,C!==0?h=$h(C):g!==0&&(h=$h(g));if(h===0)return 0;if(s!==0&&s!==h&&!(s&_)&&(_=h&-h,g=s&-s,_>=g||_===16&&(g&4194240)!==0))return s;if(h&4&&(h|=d&16),s=o.entangledLanes,s!==0)for(o=o.entanglements,s&=h;0<s;)d=31-Go(s),_=1<<d,h|=o[d],s&=~_;return h}function nZ(o,s){switch(o){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function rZ(o,s){for(var d=o.suspendedLanes,h=o.pingedLanes,_=o.expirationTimes,g=o.pendingLanes;0<g;){var C=31-Go(g),A=1<<C,P=_[C];P===-1?(!(A&d)||A&h)&&(_[C]=nZ(A,s)):P<=s&&(o.expiredLanes|=A),g&=~A}}function zC(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function Fj(){var o=O_;return O_<<=1,!(O_&4194240)&&(O_=64),o}function iC(o){for(var s=[],d=0;31>d;d++)s.push(o);return s}function Up(o,s,d){o.pendingLanes|=s,s!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,s=31-Go(s),o[s]=d}function iZ(o,s){var d=o.pendingLanes&~s;o.pendingLanes=s,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=s,o.mutableReadLanes&=s,o.entangledLanes&=s,s=o.entanglements;var h=o.eventTimes;for(o=o.expirationTimes;0<d;){var _=31-Go(d),g=1<<_;s[_]=0,h[_]=-1,o[_]=-1,d&=~g}}function X0(o,s){var d=o.entangledLanes|=s;for(o=o.entanglements;d;){var h=31-Go(d),_=1<<h;_&s|o[h]&s&&(o[h]|=s),d&=~_}}var ln=0;function Bj(o){return o&=-o,1<o?4<o?o&268435455?16:536870912:4:1}var Wj,Q0,Gj,Hj,Kj,YC=!1,D_=[],Xa=null,Qa=null,Za=null,Ep=new Map,gp=new Map,Ha=[],oZ="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ox(o,s){switch(o){case"focusin":case"focusout":Xa=null;break;case"dragenter":case"dragleave":Qa=null;break;case"mouseover":case"mouseout":Za=null;break;case"pointerover":case"pointerout":Ep.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":gp.delete(s.pointerId)}}function Hh(o,s,d,h,_,g){return o===null||o.nativeEvent!==g?(o={blockedOn:s,domEventName:d,eventSystemFlags:h,nativeEvent:g,targetContainers:[_]},s!==null&&(s=Vp(s),s!==null&&Q0(s)),o):(o.eventSystemFlags|=h,s=o.targetContainers,_!==null&&s.indexOf(_)===-1&&s.push(_),o)}function sZ(o,s,d,h,_){switch(s){case"focusin":return Xa=Hh(Xa,o,s,d,h,_),!0;case"dragenter":return Qa=Hh(Qa,o,s,d,h,_),!0;case"mouseover":return Za=Hh(Za,o,s,d,h,_),!0;case"pointerover":var g=_.pointerId;return Ep.set(g,Hh(Ep.get(g)||null,o,s,d,h,_)),!0;case"gotpointercapture":return g=_.pointerId,gp.set(g,Hh(gp.get(g)||null,o,s,d,h,_)),!0}return!1}function zj(o){var s=nd(o.target);if(s!==null){var d=gd(s);if(d!==null){if(s=d.tag,s===13){if(s=kj(d),s!==null){o.blockedOn=s,Kj(o.priority,function(){Gj(d)});return}}else if(s===3&&d.stateNode.current.memoizedState.isDehydrated){o.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}o.blockedOn=null}function z_(o){if(o.blockedOn!==null)return!1;for(var s=o.targetContainers;0<s.length;){var d=qC(o.domEventName,o.eventSystemFlags,s[0],o.nativeEvent);if(d===null){d=o.nativeEvent;var h=new d.constructor(d.type,d);WC=h,d.target.dispatchEvent(h),WC=null}else return s=Vp(d),s!==null&&Q0(s),o.blockedOn=d,!1;s.shift()}return!0}function Nx(o,s,d){z_(o)&&d.delete(s)}function aZ(){YC=!1,Xa!==null&&z_(Xa)&&(Xa=null),Qa!==null&&z_(Qa)&&(Qa=null),Za!==null&&z_(Za)&&(Za=null),Ep.forEach(Nx),gp.forEach(Nx)}function Kh(o,s){o.blockedOn===s&&(o.blockedOn=null,YC||(YC=!0,ji.unstable_scheduleCallback(ji.unstable_NormalPriority,aZ)))}function Sp(o){function s(_){return Kh(_,o)}if(0<D_.length){Kh(D_[0],o);for(var d=1;d<D_.length;d++){var h=D_[d];h.blockedOn===o&&(h.blockedOn=null)}}for(Xa!==null&&Kh(Xa,o),Qa!==null&&Kh(Qa,o),Za!==null&&Kh(Za,o),Ep.forEach(s),gp.forEach(s),d=0;d<Ha.length;d++)h=Ha[d],h.blockedOn===o&&(h.blockedOn=null);for(;0<Ha.length&&(d=Ha[0],d.blockedOn===null);)zj(d),d.blockedOn===null&&Ha.shift()}var eu=ea.ReactCurrentBatchConfig,uE=!0;function cZ(o,s,d,h){var _=ln,g=eu.transition;eu.transition=null;try{ln=1,Z0(o,s,d,h)}finally{ln=_,eu.transition=g}}function dZ(o,s,d,h){var _=ln,g=eu.transition;eu.transition=null;try{ln=4,Z0(o,s,d,h)}finally{ln=_,eu.transition=g}}function Z0(o,s,d,h){if(uE){var _=qC(o,s,d,h);if(_===null)fC(o,s,h,hE,d),Ox(o,h);else if(sZ(_,o,s,d,h))h.stopPropagation();else if(Ox(o,h),s&4&&-1<oZ.indexOf(o)){for(;_!==null;){var g=Vp(_);if(g!==null&&Wj(g),g=qC(o,s,d,h),g===null&&fC(o,s,h,hE,d),g===_)break;_=g}_!==null&&h.stopPropagation()}else fC(o,s,h,null,d)}}var hE=null;function qC(o,s,d,h){if(hE=null,o=q0(h),o=nd(o),o!==null)if(s=gd(o),s===null)o=null;else if(d=s.tag,d===13){if(o=kj(s),o!==null)return o;o=null}else if(d===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;o=null}else s!==o&&(o=null);return hE=o,null}function Yj(o){switch(o){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(XQ()){case J0:return 1;case jj:return 4;case dE:case QQ:return 16;case Vj:return 536870912;default:return 16}default:return 16}}var za=null,$0=null,Y_=null;function qj(){if(Y_)return Y_;var o,s=$0,d=s.length,h,_="value"in za?za.value:za.textContent,g=_.length;for(o=0;o<d&&s[o]===_[o];o++);var C=d-o;for(h=1;h<=C&&s[d-h]===_[g-h];h++);return Y_=_.slice(o,1<h?1-h:void 0)}function q_(o){var s=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&s===13&&(o=13)):o=s,o===10&&(o=13),32<=o||o===13?o:0}function P_(){return!0}function Dx(){return!1}function Fi(o){function s(d,h,_,g,C){this._reactName=d,this._targetInst=_,this.type=h,this.nativeEvent=g,this.target=C,this.currentTarget=null;for(var A in o)o.hasOwnProperty(A)&&(d=o[A],this[A]=d?d(g):g[A]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?P_:Dx,this.isPropagationStopped=Dx,this}return Fn(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=P_)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=P_)},persist:function(){},isPersistent:P_}),s}var hu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},eR=Fi(hu),jp=Fn({},hu,{view:0,detail:0}),lZ=Fi(jp),oC,sC,zh,BE=Fn({},jp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:tR,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==zh&&(zh&&o.type==="mousemove"?(oC=o.screenX-zh.screenX,sC=o.screenY-zh.screenY):sC=oC=0,zh=o),oC)},movementY:function(o){return"movementY"in o?o.movementY:sC}}),Px=Fi(BE),uZ=Fn({},BE,{dataTransfer:0}),hZ=Fi(uZ),pZ=Fn({},jp,{relatedTarget:0}),aC=Fi(pZ),fZ=Fn({},hu,{animationName:0,elapsedTime:0,pseudoElement:0}),mZ=Fi(fZ),_Z=Fn({},hu,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),EZ=Fi(_Z),gZ=Fn({},hu,{data:0}),Lx=Fi(gZ),SZ={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},TZ={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vZ={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function yZ(o){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(o):(o=vZ[o])?!!s[o]:!1}function tR(){return yZ}var CZ=Fn({},jp,{key:function(o){if(o.key){var s=SZ[o.key]||o.key;if(s!=="Unidentified")return s}return o.type==="keypress"?(o=q_(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?TZ[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:tR,charCode:function(o){return o.type==="keypress"?q_(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?q_(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),RZ=Fi(CZ),wZ=Fn({},BE,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),kx=Fi(wZ),IZ=Fn({},jp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:tR}),bZ=Fi(IZ),AZ=Fn({},hu,{propertyName:0,elapsedTime:0,pseudoElement:0}),OZ=Fi(AZ),NZ=Fn({},BE,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),DZ=Fi(NZ),PZ=[9,13,27,32],nR=Xs&&"CompositionEvent"in window,op=null;Xs&&"documentMode"in document&&(op=document.documentMode);var LZ=Xs&&"TextEvent"in window&&!op,Jj=Xs&&(!nR||op&&8<op&&11>=op),Mx=" ",xx=!1;function Xj(o,s){switch(o){case"keyup":return PZ.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Qj(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var Vl=!1;function kZ(o,s){switch(o){case"compositionend":return Qj(s);case"keypress":return s.which!==32?null:(xx=!0,Mx);case"textInput":return o=s.data,o===Mx&&xx?null:o;default:return null}}function MZ(o,s){if(Vl)return o==="compositionend"||!nR&&Xj(o,s)?(o=qj(),Y_=$0=za=null,Vl=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Jj&&s.locale!=="ko"?null:s.data;default:return null}}var xZ={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ux(o){var s=o&&o.nodeName&&o.nodeName.toLowerCase();return s==="input"?!!xZ[o.type]:s==="textarea"}function Zj(o,s,d,h){Oj(h),s=pE(s,"onChange"),0<s.length&&(d=new eR("onChange","change",null,d,h),o.push({event:d,listeners:s}))}var sp=null,Tp=null;function UZ(o){dV(o,0)}function WE(o){var s=Wl(o);if(yj(s))return o}function jZ(o,s){if(o==="change")return s}var $j=!1;if(Xs){var cC;if(Xs){var dC="oninput"in document;if(!dC){var jx=document.createElement("div");jx.setAttribute("oninput","return;"),dC=typeof jx.oninput=="function"}cC=dC}else cC=!1;$j=cC&&(!document.documentMode||9<document.documentMode)}function Vx(){sp&&(sp.detachEvent("onpropertychange",eV),Tp=sp=null)}function eV(o){if(o.propertyName==="value"&&WE(Tp)){var s=[];Zj(s,Tp,o,q0(o)),Lj(UZ,s)}}function VZ(o,s,d){o==="focusin"?(Vx(),sp=s,Tp=d,sp.attachEvent("onpropertychange",eV)):o==="focusout"&&Vx()}function FZ(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return WE(Tp)}function BZ(o,s){if(o==="click")return WE(s)}function WZ(o,s){if(o==="input"||o==="change")return WE(s)}function GZ(o,s){return o===s&&(o!==0||1/o===1/s)||o!==o&&s!==s}var Yo=typeof Object.is=="function"?Object.is:GZ;function vp(o,s){if(Yo(o,s))return!0;if(typeof o!="object"||o===null||typeof s!="object"||s===null)return!1;var d=Object.keys(o),h=Object.keys(s);if(d.length!==h.length)return!1;for(h=0;h<d.length;h++){var _=d[h];if(!NC.call(s,_)||!Yo(o[_],s[_]))return!1}return!0}function Fx(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function Bx(o,s){var d=Fx(o);o=0;for(var h;d;){if(d.nodeType===3){if(h=o+d.textContent.length,o<=s&&h>=s)return{node:d,offset:s-o};o=h}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Fx(d)}}function tV(o,s){return o&&s?o===s?!0:o&&o.nodeType===3?!1:s&&s.nodeType===3?tV(o,s.parentNode):"contains"in o?o.contains(s):o.compareDocumentPosition?!!(o.compareDocumentPosition(s)&16):!1:!1}function nV(){for(var o=window,s=sE();s instanceof o.HTMLIFrameElement;){try{var d=typeof s.contentWindow.location.href=="string"}catch{d=!1}if(d)o=s.contentWindow;else break;s=sE(o.document)}return s}function rR(o){var s=o&&o.nodeName&&o.nodeName.toLowerCase();return s&&(s==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||s==="textarea"||o.contentEditable==="true")}function HZ(o){var s=nV(),d=o.focusedElem,h=o.selectionRange;if(s!==d&&d&&d.ownerDocument&&tV(d.ownerDocument.documentElement,d)){if(h!==null&&rR(d)){if(s=h.start,o=h.end,o===void 0&&(o=s),"selectionStart"in d)d.selectionStart=s,d.selectionEnd=Math.min(o,d.value.length);else if(o=(s=d.ownerDocument||document)&&s.defaultView||window,o.getSelection){o=o.getSelection();var _=d.textContent.length,g=Math.min(h.start,_);h=h.end===void 0?g:Math.min(h.end,_),!o.extend&&g>h&&(_=h,h=g,g=_),_=Bx(d,g);var C=Bx(d,h);_&&C&&(o.rangeCount!==1||o.anchorNode!==_.node||o.anchorOffset!==_.offset||o.focusNode!==C.node||o.focusOffset!==C.offset)&&(s=s.createRange(),s.setStart(_.node,_.offset),o.removeAllRanges(),g>h?(o.addRange(s),o.extend(C.node,C.offset)):(s.setEnd(C.node,C.offset),o.addRange(s)))}}for(s=[],o=d;o=o.parentNode;)o.nodeType===1&&s.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<s.length;d++)o=s[d],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var KZ=Xs&&"documentMode"in document&&11>=document.documentMode,Fl=null,JC=null,ap=null,XC=!1;function Wx(o,s,d){var h=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;XC||Fl==null||Fl!==sE(h)||(h=Fl,"selectionStart"in h&&rR(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),ap&&vp(ap,h)||(ap=h,h=pE(JC,"onSelect"),0<h.length&&(s=new eR("onSelect","select",null,s,d),o.push({event:s,listeners:h}),s.target=Fl)))}function L_(o,s){var d={};return d[o.toLowerCase()]=s.toLowerCase(),d["Webkit"+o]="webkit"+s,d["Moz"+o]="moz"+s,d}var Bl={animationend:L_("Animation","AnimationEnd"),animationiteration:L_("Animation","AnimationIteration"),animationstart:L_("Animation","AnimationStart"),transitionend:L_("Transition","TransitionEnd")},lC={},rV={};Xs&&(rV=document.createElement("div").style,"AnimationEvent"in window||(delete Bl.animationend.animation,delete Bl.animationiteration.animation,delete Bl.animationstart.animation),"TransitionEvent"in window||delete Bl.transitionend.transition);function GE(o){if(lC[o])return lC[o];if(!Bl[o])return o;var s=Bl[o],d;for(d in s)if(s.hasOwnProperty(d)&&d in rV)return lC[o]=s[d];return o}var iV=GE("animationend"),oV=GE("animationiteration"),sV=GE("animationstart"),aV=GE("transitionend"),cV=new Map,Gx="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function cc(o,s){cV.set(o,s),Ed(s,[o])}for(var uC=0;uC<Gx.length;uC++){var hC=Gx[uC],zZ=hC.toLowerCase(),YZ=hC[0].toUpperCase()+hC.slice(1);cc(zZ,"on"+YZ)}cc(iV,"onAnimationEnd");cc(oV,"onAnimationIteration");cc(sV,"onAnimationStart");cc("dblclick","onDoubleClick");cc("focusin","onFocus");cc("focusout","onBlur");cc(aV,"onTransitionEnd");ru("onMouseEnter",["mouseout","mouseover"]);ru("onMouseLeave",["mouseout","mouseover"]);ru("onPointerEnter",["pointerout","pointerover"]);ru("onPointerLeave",["pointerout","pointerover"]);Ed("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ed("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ed("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ed("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ed("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ed("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ep="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),qZ=new Set("cancel close invalid load scroll toggle".split(" ").concat(ep));function Hx(o,s,d){var h=o.type||"unknown-event";o.currentTarget=d,zQ(h,s,void 0,o),o.currentTarget=null}function dV(o,s){s=(s&4)!==0;for(var d=0;d<o.length;d++){var h=o[d],_=h.event;h=h.listeners;e:{var g=void 0;if(s)for(var C=h.length-1;0<=C;C--){var A=h[C],P=A.instance,M=A.currentTarget;if(A=A.listener,P!==g&&_.isPropagationStopped())break e;Hx(_,A,M),g=P}else for(C=0;C<h.length;C++){if(A=h[C],P=A.instance,M=A.currentTarget,A=A.listener,P!==g&&_.isPropagationStopped())break e;Hx(_,A,M),g=P}}}if(cE)throw o=KC,cE=!1,KC=null,o}function bn(o,s){var d=s[t0];d===void 0&&(d=s[t0]=new Set);var h=o+"__bubble";d.has(h)||(lV(s,o,2,!1),d.add(h))}function pC(o,s,d){var h=0;s&&(h|=4),lV(d,o,h,s)}var k_="_reactListening"+Math.random().toString(36).slice(2);function yp(o){if(!o[k_]){o[k_]=!0,Ej.forEach(function(d){d!=="selectionchange"&&(qZ.has(d)||pC(d,!1,o),pC(d,!0,o))});var s=o.nodeType===9?o:o.ownerDocument;s===null||s[k_]||(s[k_]=!0,pC("selectionchange",!1,s))}}function lV(o,s,d,h){switch(Yj(s)){case 1:var _=cZ;break;case 4:_=dZ;break;default:_=Z0}d=_.bind(null,s,d,o),_=void 0,!HC||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(_=!0),h?_!==void 0?o.addEventListener(s,d,{capture:!0,passive:_}):o.addEventListener(s,d,!0):_!==void 0?o.addEventListener(s,d,{passive:_}):o.addEventListener(s,d,!1)}function fC(o,s,d,h,_){var g=h;if(!(s&1)&&!(s&2)&&h!==null)e:for(;;){if(h===null)return;var C=h.tag;if(C===3||C===4){var A=h.stateNode.containerInfo;if(A===_||A.nodeType===8&&A.parentNode===_)break;if(C===4)for(C=h.return;C!==null;){var P=C.tag;if((P===3||P===4)&&(P=C.stateNode.containerInfo,P===_||P.nodeType===8&&P.parentNode===_))return;C=C.return}for(;A!==null;){if(C=nd(A),C===null)return;if(P=C.tag,P===5||P===6){h=g=C;continue e}A=A.parentNode}}h=h.return}Lj(function(){var M=g,V=q0(d),j=[];e:{var G=cV.get(o);if(G!==void 0){var Z=eR,z=o;switch(o){case"keypress":if(q_(d)===0)break e;case"keydown":case"keyup":Z=RZ;break;case"focusin":z="focus",Z=aC;break;case"focusout":z="blur",Z=aC;break;case"beforeblur":case"afterblur":Z=aC;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Z=Px;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Z=hZ;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Z=bZ;break;case iV:case oV:case sV:Z=mZ;break;case aV:Z=OZ;break;case"scroll":Z=lZ;break;case"wheel":Z=DZ;break;case"copy":case"cut":case"paste":Z=EZ;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Z=kx}var $=(s&4)!==0,pe=!$&&o==="scroll",K=$?G!==null?G+"Capture":null:G;$=[];for(var H=M,Y;H!==null;){Y=H;var ae=Y.stateNode;if(Y.tag===5&&ae!==null&&(Y=ae,K!==null&&(ae=_p(H,K),ae!=null&&$.push(Cp(H,ae,Y)))),pe)break;H=H.return}0<$.length&&(G=new Z(G,z,null,d,V),j.push({event:G,listeners:$}))}}if(!(s&7)){e:{if(G=o==="mouseover"||o==="pointerover",Z=o==="mouseout"||o==="pointerout",G&&d!==WC&&(z=d.relatedTarget||d.fromElement)&&(nd(z)||z[Qs]))break e;if((Z||G)&&(G=V.window===V?V:(G=V.ownerDocument)?G.defaultView||G.parentWindow:window,Z?(z=d.relatedTarget||d.toElement,Z=M,z=z?nd(z):null,z!==null&&(pe=gd(z),z!==pe||z.tag!==5&&z.tag!==6)&&(z=null)):(Z=null,z=M),Z!==z)){if($=Px,ae="onMouseLeave",K="onMouseEnter",H="mouse",(o==="pointerout"||o==="pointerover")&&($=kx,ae="onPointerLeave",K="onPointerEnter",H="pointer"),pe=Z==null?G:Wl(Z),Y=z==null?G:Wl(z),G=new $(ae,H+"leave",Z,d,V),G.target=pe,G.relatedTarget=Y,ae=null,nd(V)===M&&($=new $(K,H+"enter",z,d,V),$.target=Y,$.relatedTarget=pe,ae=$),pe=ae,Z&&z)t:{for($=Z,K=z,H=0,Y=$;Y;Y=Ml(Y))H++;for(Y=0,ae=K;ae;ae=Ml(ae))Y++;for(;0<H-Y;)$=Ml($),H--;for(;0<Y-H;)K=Ml(K),Y--;for(;H--;){if($===K||K!==null&&$===K.alternate)break t;$=Ml($),K=Ml(K)}$=null}else $=null;Z!==null&&Kx(j,G,Z,$,!1),z!==null&&pe!==null&&Kx(j,pe,z,$,!0)}}e:{if(G=M?Wl(M):window,Z=G.nodeName&&G.nodeName.toLowerCase(),Z==="select"||Z==="input"&&G.type==="file")var Ae=jZ;else if(Ux(G))if($j)Ae=WZ;else{Ae=FZ;var Le=VZ}else(Z=G.nodeName)&&Z.toLowerCase()==="input"&&(G.type==="checkbox"||G.type==="radio")&&(Ae=BZ);if(Ae&&(Ae=Ae(o,M))){Zj(j,Ae,d,V);break e}Le&&Le(o,G,M),o==="focusout"&&(Le=G._wrapperState)&&Le.controlled&&G.type==="number"&&UC(G,"number",G.value)}switch(Le=M?Wl(M):window,o){case"focusin":(Ux(Le)||Le.contentEditable==="true")&&(Fl=Le,JC=M,ap=null);break;case"focusout":ap=JC=Fl=null;break;case"mousedown":XC=!0;break;case"contextmenu":case"mouseup":case"dragend":XC=!1,Wx(j,d,V);break;case"selectionchange":if(KZ)break;case"keydown":case"keyup":Wx(j,d,V)}var Pe;if(nR)e:{switch(o){case"compositionstart":var We="onCompositionStart";break e;case"compositionend":We="onCompositionEnd";break e;case"compositionupdate":We="onCompositionUpdate";break e}We=void 0}else Vl?Xj(o,d)&&(We="onCompositionEnd"):o==="keydown"&&d.keyCode===229&&(We="onCompositionStart");We&&(Jj&&d.locale!=="ko"&&(Vl||We!=="onCompositionStart"?We==="onCompositionEnd"&&Vl&&(Pe=qj()):(za=V,$0="value"in za?za.value:za.textContent,Vl=!0)),Le=pE(M,We),0<Le.length&&(We=new Lx(We,o,null,d,V),j.push({event:We,listeners:Le}),Pe?We.data=Pe:(Pe=Qj(d),Pe!==null&&(We.data=Pe)))),(Pe=LZ?kZ(o,d):MZ(o,d))&&(M=pE(M,"onBeforeInput"),0<M.length&&(V=new Lx("onBeforeInput","beforeinput",null,d,V),j.push({event:V,listeners:M}),V.data=Pe))}dV(j,s)})}function Cp(o,s,d){return{instance:o,listener:s,currentTarget:d}}function pE(o,s){for(var d=s+"Capture",h=[];o!==null;){var _=o,g=_.stateNode;_.tag===5&&g!==null&&(_=g,g=_p(o,d),g!=null&&h.unshift(Cp(o,g,_)),g=_p(o,s),g!=null&&h.push(Cp(o,g,_))),o=o.return}return h}function Ml(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5);return o||null}function Kx(o,s,d,h,_){for(var g=s._reactName,C=[];d!==null&&d!==h;){var A=d,P=A.alternate,M=A.stateNode;if(P!==null&&P===h)break;A.tag===5&&M!==null&&(A=M,_?(P=_p(d,g),P!=null&&C.unshift(Cp(d,P,A))):_||(P=_p(d,g),P!=null&&C.push(Cp(d,P,A)))),d=d.return}C.length!==0&&o.push({event:s,listeners:C})}var JZ=/\r\n?/g,XZ=/\u0000|\uFFFD/g;function zx(o){return(typeof o=="string"?o:""+o).replace(JZ,`
`).replace(XZ,"")}function M_(o,s,d){if(s=zx(s),zx(o)!==s&&d)throw Error(Ie(425))}function fE(){}var QC=null,ZC=null;function $C(o,s){return o==="textarea"||o==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var e0=typeof setTimeout=="function"?setTimeout:void 0,QZ=typeof clearTimeout=="function"?clearTimeout:void 0,Yx=typeof Promise=="function"?Promise:void 0,ZZ=typeof queueMicrotask=="function"?queueMicrotask:typeof Yx<"u"?function(o){return Yx.resolve(null).then(o).catch($Z)}:e0;function $Z(o){setTimeout(function(){throw o})}function mC(o,s){var d=s,h=0;do{var _=d.nextSibling;if(o.removeChild(d),_&&_.nodeType===8)if(d=_.data,d==="/$"){if(h===0){o.removeChild(_),Sp(s);return}h--}else d!=="$"&&d!=="$?"&&d!=="$!"||h++;d=_}while(d);Sp(s)}function $a(o){for(;o!=null;o=o.nextSibling){var s=o.nodeType;if(s===1||s===3)break;if(s===8){if(s=o.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return o}function qx(o){o=o.previousSibling;for(var s=0;o;){if(o.nodeType===8){var d=o.data;if(d==="$"||d==="$!"||d==="$?"){if(s===0)return o;s--}else d==="/$"&&s++}o=o.previousSibling}return null}var pu=Math.random().toString(36).slice(2),Rs="__reactFiber$"+pu,Rp="__reactProps$"+pu,Qs="__reactContainer$"+pu,t0="__reactEvents$"+pu,e$="__reactListeners$"+pu,t$="__reactHandles$"+pu;function nd(o){var s=o[Rs];if(s)return s;for(var d=o.parentNode;d;){if(s=d[Qs]||d[Rs]){if(d=s.alternate,s.child!==null||d!==null&&d.child!==null)for(o=qx(o);o!==null;){if(d=o[Rs])return d;o=qx(o)}return s}o=d,d=o.parentNode}return null}function Vp(o){return o=o[Rs]||o[Qs],!o||o.tag!==5&&o.tag!==6&&o.tag!==13&&o.tag!==3?null:o}function Wl(o){if(o.tag===5||o.tag===6)return o.stateNode;throw Error(Ie(33))}function HE(o){return o[Rp]||null}var n0=[],Gl=-1;function dc(o){return{current:o}}function An(o){0>Gl||(o.current=n0[Gl],n0[Gl]=null,Gl--)}function vn(o,s){Gl++,n0[Gl]=o.current,o.current=s}var sc={},Gr=dc(sc),Si=dc(!1),ld=sc;function iu(o,s){var d=o.type.contextTypes;if(!d)return sc;var h=o.stateNode;if(h&&h.__reactInternalMemoizedUnmaskedChildContext===s)return h.__reactInternalMemoizedMaskedChildContext;var _={},g;for(g in d)_[g]=s[g];return h&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=s,o.__reactInternalMemoizedMaskedChildContext=_),_}function Ti(o){return o=o.childContextTypes,o!=null}function mE(){An(Si),An(Gr)}function Jx(o,s,d){if(Gr.current!==sc)throw Error(Ie(168));vn(Gr,s),vn(Si,d)}function uV(o,s,d){var h=o.stateNode;if(s=s.childContextTypes,typeof h.getChildContext!="function")return d;h=h.getChildContext();for(var _ in h)if(!(_ in s))throw Error(Ie(108,VQ(o)||"Unknown",_));return Fn({},d,h)}function _E(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||sc,ld=Gr.current,vn(Gr,o),vn(Si,Si.current),!0}function Xx(o,s,d){var h=o.stateNode;if(!h)throw Error(Ie(169));d?(o=uV(o,s,ld),h.__reactInternalMemoizedMergedChildContext=o,An(Si),An(Gr),vn(Gr,o)):An(Si),vn(Si,d)}var Ks=null,KE=!1,_C=!1;function hV(o){Ks===null?Ks=[o]:Ks.push(o)}function n$(o){KE=!0,hV(o)}function lc(){if(!_C&&Ks!==null){_C=!0;var o=0,s=ln;try{var d=Ks;for(ln=1;o<d.length;o++){var h=d[o];do h=h(!0);while(h!==null)}Ks=null,KE=!1}catch(_){throw Ks!==null&&(Ks=Ks.slice(o+1)),Uj(J0,lc),_}finally{ln=s,_C=!1}}return null}var Hl=[],Kl=0,EE=null,gE=0,po=[],fo=0,ud=null,zs=1,Ys="";function $c(o,s){Hl[Kl++]=gE,Hl[Kl++]=EE,EE=o,gE=s}function pV(o,s,d){po[fo++]=zs,po[fo++]=Ys,po[fo++]=ud,ud=o;var h=zs;o=Ys;var _=32-Go(h)-1;h&=~(1<<_),d+=1;var g=32-Go(s)+_;if(30<g){var C=_-_%5;g=(h&(1<<C)-1).toString(32),h>>=C,_-=C,zs=1<<32-Go(s)+_|d<<_|h,Ys=g+o}else zs=1<<g|d<<_|h,Ys=o}function iR(o){o.return!==null&&($c(o,1),pV(o,1,0))}function oR(o){for(;o===EE;)EE=Hl[--Kl],Hl[Kl]=null,gE=Hl[--Kl],Hl[Kl]=null;for(;o===ud;)ud=po[--fo],po[fo]=null,Ys=po[--fo],po[fo]=null,zs=po[--fo],po[fo]=null}var Ui=null,xi=null,kn=!1,Wo=null;function fV(o,s){var d=mo(5,null,null,0);d.elementType="DELETED",d.stateNode=s,d.return=o,s=o.deletions,s===null?(o.deletions=[d],o.flags|=16):s.push(d)}function Qx(o,s){switch(o.tag){case 5:var d=o.type;return s=s.nodeType!==1||d.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(o.stateNode=s,Ui=o,xi=$a(s.firstChild),!0):!1;case 6:return s=o.pendingProps===""||s.nodeType!==3?null:s,s!==null?(o.stateNode=s,Ui=o,xi=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(d=ud!==null?{id:zs,overflow:Ys}:null,o.memoizedState={dehydrated:s,treeContext:d,retryLane:1073741824},d=mo(18,null,null,0),d.stateNode=s,d.return=o,o.child=d,Ui=o,xi=null,!0):!1;default:return!1}}function r0(o){return(o.mode&1)!==0&&(o.flags&128)===0}function i0(o){if(kn){var s=xi;if(s){var d=s;if(!Qx(o,s)){if(r0(o))throw Error(Ie(418));s=$a(d.nextSibling);var h=Ui;s&&Qx(o,s)?fV(h,d):(o.flags=o.flags&-4097|2,kn=!1,Ui=o)}}else{if(r0(o))throw Error(Ie(418));o.flags=o.flags&-4097|2,kn=!1,Ui=o}}}function Zx(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;Ui=o}function x_(o){if(o!==Ui)return!1;if(!kn)return Zx(o),kn=!0,!1;var s;if((s=o.tag!==3)&&!(s=o.tag!==5)&&(s=o.type,s=s!=="head"&&s!=="body"&&!$C(o.type,o.memoizedProps)),s&&(s=xi)){if(r0(o))throw mV(),Error(Ie(418));for(;s;)fV(o,s),s=$a(s.nextSibling)}if(Zx(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Ie(317));e:{for(o=o.nextSibling,s=0;o;){if(o.nodeType===8){var d=o.data;if(d==="/$"){if(s===0){xi=$a(o.nextSibling);break e}s--}else d!=="$"&&d!=="$!"&&d!=="$?"||s++}o=o.nextSibling}xi=null}}else xi=Ui?$a(o.stateNode.nextSibling):null;return!0}function mV(){for(var o=xi;o;)o=$a(o.nextSibling)}function ou(){xi=Ui=null,kn=!1}function sR(o){Wo===null?Wo=[o]:Wo.push(o)}var r$=ea.ReactCurrentBatchConfig;function Yh(o,s,d){if(o=d.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(Ie(309));var h=d.stateNode}if(!h)throw Error(Ie(147,o));var _=h,g=""+o;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===g?s.ref:(s=function(C){var A=_.refs;C===null?delete A[g]:A[g]=C},s._stringRef=g,s)}if(typeof o!="string")throw Error(Ie(284));if(!d._owner)throw Error(Ie(290,o))}return o}function U_(o,s){throw o=Object.prototype.toString.call(s),Error(Ie(31,o==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":o))}function $x(o){var s=o._init;return s(o._payload)}function _V(o){function s(K,H){if(o){var Y=K.deletions;Y===null?(K.deletions=[H],K.flags|=16):Y.push(H)}}function d(K,H){if(!o)return null;for(;H!==null;)s(K,H),H=H.sibling;return null}function h(K,H){for(K=new Map;H!==null;)H.key!==null?K.set(H.key,H):K.set(H.index,H),H=H.sibling;return K}function _(K,H){return K=rc(K,H),K.index=0,K.sibling=null,K}function g(K,H,Y){return K.index=Y,o?(Y=K.alternate,Y!==null?(Y=Y.index,Y<H?(K.flags|=2,H):Y):(K.flags|=2,H)):(K.flags|=1048576,H)}function C(K){return o&&K.alternate===null&&(K.flags|=2),K}function A(K,H,Y,ae){return H===null||H.tag!==6?(H=CC(Y,K.mode,ae),H.return=K,H):(H=_(H,Y),H.return=K,H)}function P(K,H,Y,ae){var Ae=Y.type;return Ae===jl?V(K,H,Y.props.children,ae,Y.key):H!==null&&(H.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===Wa&&$x(Ae)===H.type)?(ae=_(H,Y.props),ae.ref=Yh(K,H,Y),ae.return=K,ae):(ae=tE(Y.type,Y.key,Y.props,null,K.mode,ae),ae.ref=Yh(K,H,Y),ae.return=K,ae)}function M(K,H,Y,ae){return H===null||H.tag!==4||H.stateNode.containerInfo!==Y.containerInfo||H.stateNode.implementation!==Y.implementation?(H=RC(Y,K.mode,ae),H.return=K,H):(H=_(H,Y.children||[]),H.return=K,H)}function V(K,H,Y,ae,Ae){return H===null||H.tag!==7?(H=sd(Y,K.mode,ae,Ae),H.return=K,H):(H=_(H,Y),H.return=K,H)}function j(K,H,Y){if(typeof H=="string"&&H!==""||typeof H=="number")return H=CC(""+H,K.mode,Y),H.return=K,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case I_:return Y=tE(H.type,H.key,H.props,null,K.mode,Y),Y.ref=Yh(K,null,H),Y.return=K,Y;case Ul:return H=RC(H,K.mode,Y),H.return=K,H;case Wa:var ae=H._init;return j(K,ae(H._payload),Y)}if(Zh(H)||Wh(H))return H=sd(H,K.mode,Y,null),H.return=K,H;U_(K,H)}return null}function G(K,H,Y,ae){var Ae=H!==null?H.key:null;if(typeof Y=="string"&&Y!==""||typeof Y=="number")return Ae!==null?null:A(K,H,""+Y,ae);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case I_:return Y.key===Ae?P(K,H,Y,ae):null;case Ul:return Y.key===Ae?M(K,H,Y,ae):null;case Wa:return Ae=Y._init,G(K,H,Ae(Y._payload),ae)}if(Zh(Y)||Wh(Y))return Ae!==null?null:V(K,H,Y,ae,null);U_(K,Y)}return null}function Z(K,H,Y,ae,Ae){if(typeof ae=="string"&&ae!==""||typeof ae=="number")return K=K.get(Y)||null,A(H,K,""+ae,Ae);if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case I_:return K=K.get(ae.key===null?Y:ae.key)||null,P(H,K,ae,Ae);case Ul:return K=K.get(ae.key===null?Y:ae.key)||null,M(H,K,ae,Ae);case Wa:var Le=ae._init;return Z(K,H,Y,Le(ae._payload),Ae)}if(Zh(ae)||Wh(ae))return K=K.get(Y)||null,V(H,K,ae,Ae,null);U_(H,ae)}return null}function z(K,H,Y,ae){for(var Ae=null,Le=null,Pe=H,We=H=0,Jt=null;Pe!==null&&We<Y.length;We++){Pe.index>We?(Jt=Pe,Pe=null):Jt=Pe.sibling;var dt=G(K,Pe,Y[We],ae);if(dt===null){Pe===null&&(Pe=Jt);break}o&&Pe&&dt.alternate===null&&s(K,Pe),H=g(dt,H,We),Le===null?Ae=dt:Le.sibling=dt,Le=dt,Pe=Jt}if(We===Y.length)return d(K,Pe),kn&&$c(K,We),Ae;if(Pe===null){for(;We<Y.length;We++)Pe=j(K,Y[We],ae),Pe!==null&&(H=g(Pe,H,We),Le===null?Ae=Pe:Le.sibling=Pe,Le=Pe);return kn&&$c(K,We),Ae}for(Pe=h(K,Pe);We<Y.length;We++)Jt=Z(Pe,K,We,Y[We],ae),Jt!==null&&(o&&Jt.alternate!==null&&Pe.delete(Jt.key===null?We:Jt.key),H=g(Jt,H,We),Le===null?Ae=Jt:Le.sibling=Jt,Le=Jt);return o&&Pe.forEach(function(or){return s(K,or)}),kn&&$c(K,We),Ae}function $(K,H,Y,ae){var Ae=Wh(Y);if(typeof Ae!="function")throw Error(Ie(150));if(Y=Ae.call(Y),Y==null)throw Error(Ie(151));for(var Le=Ae=null,Pe=H,We=H=0,Jt=null,dt=Y.next();Pe!==null&&!dt.done;We++,dt=Y.next()){Pe.index>We?(Jt=Pe,Pe=null):Jt=Pe.sibling;var or=G(K,Pe,dt.value,ae);if(or===null){Pe===null&&(Pe=Jt);break}o&&Pe&&or.alternate===null&&s(K,Pe),H=g(or,H,We),Le===null?Ae=or:Le.sibling=or,Le=or,Pe=Jt}if(dt.done)return d(K,Pe),kn&&$c(K,We),Ae;if(Pe===null){for(;!dt.done;We++,dt=Y.next())dt=j(K,dt.value,ae),dt!==null&&(H=g(dt,H,We),Le===null?Ae=dt:Le.sibling=dt,Le=dt);return kn&&$c(K,We),Ae}for(Pe=h(K,Pe);!dt.done;We++,dt=Y.next())dt=Z(Pe,K,We,dt.value,ae),dt!==null&&(o&&dt.alternate!==null&&Pe.delete(dt.key===null?We:dt.key),H=g(dt,H,We),Le===null?Ae=dt:Le.sibling=dt,Le=dt);return o&&Pe.forEach(function(Cr){return s(K,Cr)}),kn&&$c(K,We),Ae}function pe(K,H,Y,ae){if(typeof Y=="object"&&Y!==null&&Y.type===jl&&Y.key===null&&(Y=Y.props.children),typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case I_:e:{for(var Ae=Y.key,Le=H;Le!==null;){if(Le.key===Ae){if(Ae=Y.type,Ae===jl){if(Le.tag===7){d(K,Le.sibling),H=_(Le,Y.props.children),H.return=K,K=H;break e}}else if(Le.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===Wa&&$x(Ae)===Le.type){d(K,Le.sibling),H=_(Le,Y.props),H.ref=Yh(K,Le,Y),H.return=K,K=H;break e}d(K,Le);break}else s(K,Le);Le=Le.sibling}Y.type===jl?(H=sd(Y.props.children,K.mode,ae,Y.key),H.return=K,K=H):(ae=tE(Y.type,Y.key,Y.props,null,K.mode,ae),ae.ref=Yh(K,H,Y),ae.return=K,K=ae)}return C(K);case Ul:e:{for(Le=Y.key;H!==null;){if(H.key===Le)if(H.tag===4&&H.stateNode.containerInfo===Y.containerInfo&&H.stateNode.implementation===Y.implementation){d(K,H.sibling),H=_(H,Y.children||[]),H.return=K,K=H;break e}else{d(K,H);break}else s(K,H);H=H.sibling}H=RC(Y,K.mode,ae),H.return=K,K=H}return C(K);case Wa:return Le=Y._init,pe(K,H,Le(Y._payload),ae)}if(Zh(Y))return z(K,H,Y,ae);if(Wh(Y))return $(K,H,Y,ae);U_(K,Y)}return typeof Y=="string"&&Y!==""||typeof Y=="number"?(Y=""+Y,H!==null&&H.tag===6?(d(K,H.sibling),H=_(H,Y),H.return=K,K=H):(d(K,H),H=CC(Y,K.mode,ae),H.return=K,K=H),C(K)):d(K,H)}return pe}var su=_V(!0),EV=_V(!1),SE=dc(null),TE=null,zl=null,aR=null;function cR(){aR=zl=TE=null}function dR(o){var s=SE.current;An(SE),o._currentValue=s}function o0(o,s,d){for(;o!==null;){var h=o.alternate;if((o.childLanes&s)!==s?(o.childLanes|=s,h!==null&&(h.childLanes|=s)):h!==null&&(h.childLanes&s)!==s&&(h.childLanes|=s),o===d)break;o=o.return}}function tu(o,s){TE=o,aR=zl=null,o=o.dependencies,o!==null&&o.firstContext!==null&&(o.lanes&s&&(gi=!0),o.firstContext=null)}function go(o){var s=o._currentValue;if(aR!==o)if(o={context:o,memoizedValue:s,next:null},zl===null){if(TE===null)throw Error(Ie(308));zl=o,TE.dependencies={lanes:0,firstContext:o}}else zl=zl.next=o;return s}var rd=null;function lR(o){rd===null?rd=[o]:rd.push(o)}function gV(o,s,d,h){var _=s.interleaved;return _===null?(d.next=d,lR(s)):(d.next=_.next,_.next=d),s.interleaved=d,Zs(o,h)}function Zs(o,s){o.lanes|=s;var d=o.alternate;for(d!==null&&(d.lanes|=s),d=o,o=o.return;o!==null;)o.childLanes|=s,d=o.alternate,d!==null&&(d.childLanes|=s),d=o,o=o.return;return d.tag===3?d.stateNode:null}var Ga=!1;function uR(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function SV(o,s){o=o.updateQueue,s.updateQueue===o&&(s.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function Js(o,s){return{eventTime:o,lane:s,tag:0,payload:null,callback:null,next:null}}function ec(o,s,d){var h=o.updateQueue;if(h===null)return null;if(h=h.shared,Yt&2){var _=h.pending;return _===null?s.next=s:(s.next=_.next,_.next=s),h.pending=s,Zs(o,d)}return _=h.interleaved,_===null?(s.next=s,lR(h)):(s.next=_.next,_.next=s),h.interleaved=s,Zs(o,d)}function J_(o,s,d){if(s=s.updateQueue,s!==null&&(s=s.shared,(d&4194240)!==0)){var h=s.lanes;h&=o.pendingLanes,d|=h,s.lanes=d,X0(o,d)}}function eU(o,s){var d=o.updateQueue,h=o.alternate;if(h!==null&&(h=h.updateQueue,d===h)){var _=null,g=null;if(d=d.firstBaseUpdate,d!==null){do{var C={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};g===null?_=g=C:g=g.next=C,d=d.next}while(d!==null);g===null?_=g=s:g=g.next=s}else _=g=s;d={baseState:h.baseState,firstBaseUpdate:_,lastBaseUpdate:g,shared:h.shared,effects:h.effects},o.updateQueue=d;return}o=d.lastBaseUpdate,o===null?d.firstBaseUpdate=s:o.next=s,d.lastBaseUpdate=s}function vE(o,s,d,h){var _=o.updateQueue;Ga=!1;var g=_.firstBaseUpdate,C=_.lastBaseUpdate,A=_.shared.pending;if(A!==null){_.shared.pending=null;var P=A,M=P.next;P.next=null,C===null?g=M:C.next=M,C=P;var V=o.alternate;V!==null&&(V=V.updateQueue,A=V.lastBaseUpdate,A!==C&&(A===null?V.firstBaseUpdate=M:A.next=M,V.lastBaseUpdate=P))}if(g!==null){var j=_.baseState;C=0,V=M=P=null,A=g;do{var G=A.lane,Z=A.eventTime;if((h&G)===G){V!==null&&(V=V.next={eventTime:Z,lane:0,tag:A.tag,payload:A.payload,callback:A.callback,next:null});e:{var z=o,$=A;switch(G=s,Z=d,$.tag){case 1:if(z=$.payload,typeof z=="function"){j=z.call(Z,j,G);break e}j=z;break e;case 3:z.flags=z.flags&-65537|128;case 0:if(z=$.payload,G=typeof z=="function"?z.call(Z,j,G):z,G==null)break e;j=Fn({},j,G);break e;case 2:Ga=!0}}A.callback!==null&&A.lane!==0&&(o.flags|=64,G=_.effects,G===null?_.effects=[A]:G.push(A))}else Z={eventTime:Z,lane:G,tag:A.tag,payload:A.payload,callback:A.callback,next:null},V===null?(M=V=Z,P=j):V=V.next=Z,C|=G;if(A=A.next,A===null){if(A=_.shared.pending,A===null)break;G=A,A=G.next,G.next=null,_.lastBaseUpdate=G,_.shared.pending=null}}while(!0);if(V===null&&(P=j),_.baseState=P,_.firstBaseUpdate=M,_.lastBaseUpdate=V,s=_.shared.interleaved,s!==null){_=s;do C|=_.lane,_=_.next;while(_!==s)}else g===null&&(_.shared.lanes=0);pd|=C,o.lanes=C,o.memoizedState=j}}function tU(o,s,d){if(o=s.effects,s.effects=null,o!==null)for(s=0;s<o.length;s++){var h=o[s],_=h.callback;if(_!==null){if(h.callback=null,h=d,typeof _!="function")throw Error(Ie(191,_));_.call(h)}}}var Fp={},Is=dc(Fp),wp=dc(Fp),Ip=dc(Fp);function id(o){if(o===Fp)throw Error(Ie(174));return o}function hR(o,s){switch(vn(Ip,s),vn(wp,o),vn(Is,Fp),o=s.nodeType,o){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:VC(null,"");break;default:o=o===8?s.parentNode:s,s=o.namespaceURI||null,o=o.tagName,s=VC(s,o)}An(Is),vn(Is,s)}function au(){An(Is),An(wp),An(Ip)}function TV(o){id(Ip.current);var s=id(Is.current),d=VC(s,o.type);s!==d&&(vn(wp,o),vn(Is,d))}function pR(o){wp.current===o&&(An(Is),An(wp))}var Un=dc(0);function yE(o){for(var s=o;s!==null;){if(s.tag===13){var d=s.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===o)break;for(;s.sibling===null;){if(s.return===null||s.return===o)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var EC=[];function fR(){for(var o=0;o<EC.length;o++)EC[o]._workInProgressVersionPrimary=null;EC.length=0}var X_=ea.ReactCurrentDispatcher,gC=ea.ReactCurrentBatchConfig,hd=0,jn=null,ur=null,vr=null,CE=!1,cp=!1,bp=0,i$=0;function Vr(){throw Error(Ie(321))}function mR(o,s){if(s===null)return!1;for(var d=0;d<s.length&&d<o.length;d++)if(!Yo(o[d],s[d]))return!1;return!0}function _R(o,s,d,h,_,g){if(hd=g,jn=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,X_.current=o===null||o.memoizedState===null?c$:d$,o=d(h,_),cp){g=0;do{if(cp=!1,bp=0,25<=g)throw Error(Ie(301));g+=1,vr=ur=null,s.updateQueue=null,X_.current=l$,o=d(h,_)}while(cp)}if(X_.current=RE,s=ur!==null&&ur.next!==null,hd=0,vr=ur=jn=null,CE=!1,s)throw Error(Ie(300));return o}function ER(){var o=bp!==0;return bp=0,o}function Cs(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vr===null?jn.memoizedState=vr=o:vr=vr.next=o,vr}function So(){if(ur===null){var o=jn.alternate;o=o!==null?o.memoizedState:null}else o=ur.next;var s=vr===null?jn.memoizedState:vr.next;if(s!==null)vr=s,ur=o;else{if(o===null)throw Error(Ie(310));ur=o,o={memoizedState:ur.memoizedState,baseState:ur.baseState,baseQueue:ur.baseQueue,queue:ur.queue,next:null},vr===null?jn.memoizedState=vr=o:vr=vr.next=o}return vr}function Ap(o,s){return typeof s=="function"?s(o):s}function SC(o){var s=So(),d=s.queue;if(d===null)throw Error(Ie(311));d.lastRenderedReducer=o;var h=ur,_=h.baseQueue,g=d.pending;if(g!==null){if(_!==null){var C=_.next;_.next=g.next,g.next=C}h.baseQueue=_=g,d.pending=null}if(_!==null){g=_.next,h=h.baseState;var A=C=null,P=null,M=g;do{var V=M.lane;if((hd&V)===V)P!==null&&(P=P.next={lane:0,action:M.action,hasEagerState:M.hasEagerState,eagerState:M.eagerState,next:null}),h=M.hasEagerState?M.eagerState:o(h,M.action);else{var j={lane:V,action:M.action,hasEagerState:M.hasEagerState,eagerState:M.eagerState,next:null};P===null?(A=P=j,C=h):P=P.next=j,jn.lanes|=V,pd|=V}M=M.next}while(M!==null&&M!==g);P===null?C=h:P.next=A,Yo(h,s.memoizedState)||(gi=!0),s.memoizedState=h,s.baseState=C,s.baseQueue=P,d.lastRenderedState=h}if(o=d.interleaved,o!==null){_=o;do g=_.lane,jn.lanes|=g,pd|=g,_=_.next;while(_!==o)}else _===null&&(d.lanes=0);return[s.memoizedState,d.dispatch]}function TC(o){var s=So(),d=s.queue;if(d===null)throw Error(Ie(311));d.lastRenderedReducer=o;var h=d.dispatch,_=d.pending,g=s.memoizedState;if(_!==null){d.pending=null;var C=_=_.next;do g=o(g,C.action),C=C.next;while(C!==_);Yo(g,s.memoizedState)||(gi=!0),s.memoizedState=g,s.baseQueue===null&&(s.baseState=g),d.lastRenderedState=g}return[g,h]}function vV(){}function yV(o,s){var d=jn,h=So(),_=s(),g=!Yo(h.memoizedState,_);if(g&&(h.memoizedState=_,gi=!0),h=h.queue,gR(wV.bind(null,d,h,o),[o]),h.getSnapshot!==s||g||vr!==null&&vr.memoizedState.tag&1){if(d.flags|=2048,Op(9,RV.bind(null,d,h,_,s),void 0,null),yr===null)throw Error(Ie(349));hd&30||CV(d,s,_)}return _}function CV(o,s,d){o.flags|=16384,o={getSnapshot:s,value:d},s=jn.updateQueue,s===null?(s={lastEffect:null,stores:null},jn.updateQueue=s,s.stores=[o]):(d=s.stores,d===null?s.stores=[o]:d.push(o))}function RV(o,s,d,h){s.value=d,s.getSnapshot=h,IV(s)&&bV(o)}function wV(o,s,d){return d(function(){IV(s)&&bV(o)})}function IV(o){var s=o.getSnapshot;o=o.value;try{var d=s();return!Yo(o,d)}catch{return!0}}function bV(o){var s=Zs(o,1);s!==null&&Ho(s,o,1,-1)}function nU(o){var s=Cs();return typeof o=="function"&&(o=o()),s.memoizedState=s.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ap,lastRenderedState:o},s.queue=o,o=o.dispatch=a$.bind(null,jn,o),[s.memoizedState,o]}function Op(o,s,d,h){return o={tag:o,create:s,destroy:d,deps:h,next:null},s=jn.updateQueue,s===null?(s={lastEffect:null,stores:null},jn.updateQueue=s,s.lastEffect=o.next=o):(d=s.lastEffect,d===null?s.lastEffect=o.next=o:(h=d.next,d.next=o,o.next=h,s.lastEffect=o)),o}function AV(){return So().memoizedState}function Q_(o,s,d,h){var _=Cs();jn.flags|=o,_.memoizedState=Op(1|s,d,void 0,h===void 0?null:h)}function zE(o,s,d,h){var _=So();h=h===void 0?null:h;var g=void 0;if(ur!==null){var C=ur.memoizedState;if(g=C.destroy,h!==null&&mR(h,C.deps)){_.memoizedState=Op(s,d,g,h);return}}jn.flags|=o,_.memoizedState=Op(1|s,d,g,h)}function rU(o,s){return Q_(8390656,8,o,s)}function gR(o,s){return zE(2048,8,o,s)}function OV(o,s){return zE(4,2,o,s)}function NV(o,s){return zE(4,4,o,s)}function DV(o,s){if(typeof s=="function")return o=o(),s(o),function(){s(null)};if(s!=null)return o=o(),s.current=o,function(){s.current=null}}function PV(o,s,d){return d=d!=null?d.concat([o]):null,zE(4,4,DV.bind(null,s,o),d)}function SR(){}function LV(o,s){var d=So();s=s===void 0?null:s;var h=d.memoizedState;return h!==null&&s!==null&&mR(s,h[1])?h[0]:(d.memoizedState=[o,s],o)}function kV(o,s){var d=So();s=s===void 0?null:s;var h=d.memoizedState;return h!==null&&s!==null&&mR(s,h[1])?h[0]:(o=o(),d.memoizedState=[o,s],o)}function MV(o,s,d){return hd&21?(Yo(d,s)||(d=Fj(),jn.lanes|=d,pd|=d,o.baseState=!0),s):(o.baseState&&(o.baseState=!1,gi=!0),o.memoizedState=d)}function o$(o,s){var d=ln;ln=d!==0&&4>d?d:4,o(!0);var h=gC.transition;gC.transition={};try{o(!1),s()}finally{ln=d,gC.transition=h}}function xV(){return So().memoizedState}function s$(o,s,d){var h=nc(o);if(d={lane:h,action:d,hasEagerState:!1,eagerState:null,next:null},UV(o))jV(s,d);else if(d=gV(o,s,d,h),d!==null){var _=$r();Ho(d,o,h,_),VV(d,s,h)}}function a$(o,s,d){var h=nc(o),_={lane:h,action:d,hasEagerState:!1,eagerState:null,next:null};if(UV(o))jV(s,_);else{var g=o.alternate;if(o.lanes===0&&(g===null||g.lanes===0)&&(g=s.lastRenderedReducer,g!==null))try{var C=s.lastRenderedState,A=g(C,d);if(_.hasEagerState=!0,_.eagerState=A,Yo(A,C)){var P=s.interleaved;P===null?(_.next=_,lR(s)):(_.next=P.next,P.next=_),s.interleaved=_;return}}catch{}finally{}d=gV(o,s,_,h),d!==null&&(_=$r(),Ho(d,o,h,_),VV(d,s,h))}}function UV(o){var s=o.alternate;return o===jn||s!==null&&s===jn}function jV(o,s){cp=CE=!0;var d=o.pending;d===null?s.next=s:(s.next=d.next,d.next=s),o.pending=s}function VV(o,s,d){if(d&4194240){var h=s.lanes;h&=o.pendingLanes,d|=h,s.lanes=d,X0(o,d)}}var RE={readContext:go,useCallback:Vr,useContext:Vr,useEffect:Vr,useImperativeHandle:Vr,useInsertionEffect:Vr,useLayoutEffect:Vr,useMemo:Vr,useReducer:Vr,useRef:Vr,useState:Vr,useDebugValue:Vr,useDeferredValue:Vr,useTransition:Vr,useMutableSource:Vr,useSyncExternalStore:Vr,useId:Vr,unstable_isNewReconciler:!1},c$={readContext:go,useCallback:function(o,s){return Cs().memoizedState=[o,s===void 0?null:s],o},useContext:go,useEffect:rU,useImperativeHandle:function(o,s,d){return d=d!=null?d.concat([o]):null,Q_(4194308,4,DV.bind(null,s,o),d)},useLayoutEffect:function(o,s){return Q_(4194308,4,o,s)},useInsertionEffect:function(o,s){return Q_(4,2,o,s)},useMemo:function(o,s){var d=Cs();return s=s===void 0?null:s,o=o(),d.memoizedState=[o,s],o},useReducer:function(o,s,d){var h=Cs();return s=d!==void 0?d(s):s,h.memoizedState=h.baseState=s,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:s},h.queue=o,o=o.dispatch=s$.bind(null,jn,o),[h.memoizedState,o]},useRef:function(o){var s=Cs();return o={current:o},s.memoizedState=o},useState:nU,useDebugValue:SR,useDeferredValue:function(o){return Cs().memoizedState=o},useTransition:function(){var o=nU(!1),s=o[0];return o=o$.bind(null,o[1]),Cs().memoizedState=o,[s,o]},useMutableSource:function(){},useSyncExternalStore:function(o,s,d){var h=jn,_=Cs();if(kn){if(d===void 0)throw Error(Ie(407));d=d()}else{if(d=s(),yr===null)throw Error(Ie(349));hd&30||CV(h,s,d)}_.memoizedState=d;var g={value:d,getSnapshot:s};return _.queue=g,rU(wV.bind(null,h,g,o),[o]),h.flags|=2048,Op(9,RV.bind(null,h,g,d,s),void 0,null),d},useId:function(){var o=Cs(),s=yr.identifierPrefix;if(kn){var d=Ys,h=zs;d=(h&~(1<<32-Go(h)-1)).toString(32)+d,s=":"+s+"R"+d,d=bp++,0<d&&(s+="H"+d.toString(32)),s+=":"}else d=i$++,s=":"+s+"r"+d.toString(32)+":";return o.memoizedState=s},unstable_isNewReconciler:!1},d$={readContext:go,useCallback:LV,useContext:go,useEffect:gR,useImperativeHandle:PV,useInsertionEffect:OV,useLayoutEffect:NV,useMemo:kV,useReducer:SC,useRef:AV,useState:function(){return SC(Ap)},useDebugValue:SR,useDeferredValue:function(o){var s=So();return MV(s,ur.memoizedState,o)},useTransition:function(){var o=SC(Ap)[0],s=So().memoizedState;return[o,s]},useMutableSource:vV,useSyncExternalStore:yV,useId:xV,unstable_isNewReconciler:!1},l$={readContext:go,useCallback:LV,useContext:go,useEffect:gR,useImperativeHandle:PV,useInsertionEffect:OV,useLayoutEffect:NV,useMemo:kV,useReducer:TC,useRef:AV,useState:function(){return TC(Ap)},useDebugValue:SR,useDeferredValue:function(o){var s=So();return ur===null?s.memoizedState=o:MV(s,ur.memoizedState,o)},useTransition:function(){var o=TC(Ap)[0],s=So().memoizedState;return[o,s]},useMutableSource:vV,useSyncExternalStore:yV,useId:xV,unstable_isNewReconciler:!1};function Vo(o,s){if(o&&o.defaultProps){s=Fn({},s),o=o.defaultProps;for(var d in o)s[d]===void 0&&(s[d]=o[d]);return s}return s}function s0(o,s,d,h){s=o.memoizedState,d=d(h,s),d=d==null?s:Fn({},s,d),o.memoizedState=d,o.lanes===0&&(o.updateQueue.baseState=d)}var YE={isMounted:function(o){return(o=o._reactInternals)?gd(o)===o:!1},enqueueSetState:function(o,s,d){o=o._reactInternals;var h=$r(),_=nc(o),g=Js(h,_);g.payload=s,d!=null&&(g.callback=d),s=ec(o,g,_),s!==null&&(Ho(s,o,_,h),J_(s,o,_))},enqueueReplaceState:function(o,s,d){o=o._reactInternals;var h=$r(),_=nc(o),g=Js(h,_);g.tag=1,g.payload=s,d!=null&&(g.callback=d),s=ec(o,g,_),s!==null&&(Ho(s,o,_,h),J_(s,o,_))},enqueueForceUpdate:function(o,s){o=o._reactInternals;var d=$r(),h=nc(o),_=Js(d,h);_.tag=2,s!=null&&(_.callback=s),s=ec(o,_,h),s!==null&&(Ho(s,o,h,d),J_(s,o,h))}};function iU(o,s,d,h,_,g,C){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(h,g,C):s.prototype&&s.prototype.isPureReactComponent?!vp(d,h)||!vp(_,g):!0}function FV(o,s,d){var h=!1,_=sc,g=s.contextType;return typeof g=="object"&&g!==null?g=go(g):(_=Ti(s)?ld:Gr.current,h=s.contextTypes,g=(h=h!=null)?iu(o,_):sc),s=new s(d,g),o.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=YE,o.stateNode=s,s._reactInternals=o,h&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=_,o.__reactInternalMemoizedMaskedChildContext=g),s}function oU(o,s,d,h){o=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(d,h),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(d,h),s.state!==o&&YE.enqueueReplaceState(s,s.state,null)}function a0(o,s,d,h){var _=o.stateNode;_.props=d,_.state=o.memoizedState,_.refs={},uR(o);var g=s.contextType;typeof g=="object"&&g!==null?_.context=go(g):(g=Ti(s)?ld:Gr.current,_.context=iu(o,g)),_.state=o.memoizedState,g=s.getDerivedStateFromProps,typeof g=="function"&&(s0(o,s,g,d),_.state=o.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(s=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),s!==_.state&&YE.enqueueReplaceState(_,_.state,null),vE(o,d,_,h),_.state=o.memoizedState),typeof _.componentDidMount=="function"&&(o.flags|=4194308)}function cu(o,s){try{var d="",h=s;do d+=jQ(h),h=h.return;while(h);var _=d}catch(g){_=`
Error generating stack: `+g.message+`
`+g.stack}return{value:o,source:s,stack:_,digest:null}}function vC(o,s,d){return{value:o,source:null,stack:d??null,digest:s??null}}function c0(o,s){try{console.error(s.value)}catch(d){setTimeout(function(){throw d})}}var u$=typeof WeakMap=="function"?WeakMap:Map;function BV(o,s,d){d=Js(-1,d),d.tag=3,d.payload={element:null};var h=s.value;return d.callback=function(){IE||(IE=!0,g0=h),c0(o,s)},d}function WV(o,s,d){d=Js(-1,d),d.tag=3;var h=o.type.getDerivedStateFromError;if(typeof h=="function"){var _=s.value;d.payload=function(){return h(_)},d.callback=function(){c0(o,s)}}var g=o.stateNode;return g!==null&&typeof g.componentDidCatch=="function"&&(d.callback=function(){c0(o,s),typeof h!="function"&&(tc===null?tc=new Set([this]):tc.add(this));var C=s.stack;this.componentDidCatch(s.value,{componentStack:C!==null?C:""})}),d}function sU(o,s,d){var h=o.pingCache;if(h===null){h=o.pingCache=new u$;var _=new Set;h.set(s,_)}else _=h.get(s),_===void 0&&(_=new Set,h.set(s,_));_.has(d)||(_.add(d),o=w$.bind(null,o,s,d),s.then(o,o))}function aU(o){do{var s;if((s=o.tag===13)&&(s=o.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return o;o=o.return}while(o!==null);return null}function cU(o,s,d,h,_){return o.mode&1?(o.flags|=65536,o.lanes=_,o):(o===s?o.flags|=65536:(o.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(s=Js(-1,1),s.tag=2,ec(d,s,1))),d.lanes|=1),o)}var h$=ea.ReactCurrentOwner,gi=!1;function Zr(o,s,d,h){s.child=o===null?EV(s,null,d,h):su(s,o.child,d,h)}function dU(o,s,d,h,_){d=d.render;var g=s.ref;return tu(s,_),h=_R(o,s,d,h,g,_),d=ER(),o!==null&&!gi?(s.updateQueue=o.updateQueue,s.flags&=-2053,o.lanes&=~_,$s(o,s,_)):(kn&&d&&iR(s),s.flags|=1,Zr(o,s,h,_),s.child)}function lU(o,s,d,h,_){if(o===null){var g=d.type;return typeof g=="function"&&!bR(g)&&g.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(s.tag=15,s.type=g,GV(o,s,g,h,_)):(o=tE(d.type,null,h,s,s.mode,_),o.ref=s.ref,o.return=s,s.child=o)}if(g=o.child,!(o.lanes&_)){var C=g.memoizedProps;if(d=d.compare,d=d!==null?d:vp,d(C,h)&&o.ref===s.ref)return $s(o,s,_)}return s.flags|=1,o=rc(g,h),o.ref=s.ref,o.return=s,s.child=o}function GV(o,s,d,h,_){if(o!==null){var g=o.memoizedProps;if(vp(g,h)&&o.ref===s.ref)if(gi=!1,s.pendingProps=h=g,(o.lanes&_)!==0)o.flags&131072&&(gi=!0);else return s.lanes=o.lanes,$s(o,s,_)}return d0(o,s,d,h,_)}function HV(o,s,d){var h=s.pendingProps,_=h.children,g=o!==null?o.memoizedState:null;if(h.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},vn(ql,Mi),Mi|=d;else{if(!(d&1073741824))return o=g!==null?g.baseLanes|d:d,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:o,cachePool:null,transitions:null},s.updateQueue=null,vn(ql,Mi),Mi|=o,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},h=g!==null?g.baseLanes:d,vn(ql,Mi),Mi|=h}else g!==null?(h=g.baseLanes|d,s.memoizedState=null):h=d,vn(ql,Mi),Mi|=h;return Zr(o,s,_,d),s.child}function KV(o,s){var d=s.ref;(o===null&&d!==null||o!==null&&o.ref!==d)&&(s.flags|=512,s.flags|=2097152)}function d0(o,s,d,h,_){var g=Ti(d)?ld:Gr.current;return g=iu(s,g),tu(s,_),d=_R(o,s,d,h,g,_),h=ER(),o!==null&&!gi?(s.updateQueue=o.updateQueue,s.flags&=-2053,o.lanes&=~_,$s(o,s,_)):(kn&&h&&iR(s),s.flags|=1,Zr(o,s,d,_),s.child)}function uU(o,s,d,h,_){if(Ti(d)){var g=!0;_E(s)}else g=!1;if(tu(s,_),s.stateNode===null)Z_(o,s),FV(s,d,h),a0(s,d,h,_),h=!0;else if(o===null){var C=s.stateNode,A=s.memoizedProps;C.props=A;var P=C.context,M=d.contextType;typeof M=="object"&&M!==null?M=go(M):(M=Ti(d)?ld:Gr.current,M=iu(s,M));var V=d.getDerivedStateFromProps,j=typeof V=="function"||typeof C.getSnapshotBeforeUpdate=="function";j||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(A!==h||P!==M)&&oU(s,C,h,M),Ga=!1;var G=s.memoizedState;C.state=G,vE(s,h,C,_),P=s.memoizedState,A!==h||G!==P||Si.current||Ga?(typeof V=="function"&&(s0(s,d,V,h),P=s.memoizedState),(A=Ga||iU(s,d,A,h,G,P,M))?(j||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(s.flags|=4194308)):(typeof C.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=h,s.memoizedState=P),C.props=h,C.state=P,C.context=M,h=A):(typeof C.componentDidMount=="function"&&(s.flags|=4194308),h=!1)}else{C=s.stateNode,SV(o,s),A=s.memoizedProps,M=s.type===s.elementType?A:Vo(s.type,A),C.props=M,j=s.pendingProps,G=C.context,P=d.contextType,typeof P=="object"&&P!==null?P=go(P):(P=Ti(d)?ld:Gr.current,P=iu(s,P));var Z=d.getDerivedStateFromProps;(V=typeof Z=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(A!==j||G!==P)&&oU(s,C,h,P),Ga=!1,G=s.memoizedState,C.state=G,vE(s,h,C,_);var z=s.memoizedState;A!==j||G!==z||Si.current||Ga?(typeof Z=="function"&&(s0(s,d,Z,h),z=s.memoizedState),(M=Ga||iU(s,d,M,h,G,z,P)||!1)?(V||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(h,z,P),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(h,z,P)),typeof C.componentDidUpdate=="function"&&(s.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof C.componentDidUpdate!="function"||A===o.memoizedProps&&G===o.memoizedState||(s.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||A===o.memoizedProps&&G===o.memoizedState||(s.flags|=1024),s.memoizedProps=h,s.memoizedState=z),C.props=h,C.state=z,C.context=P,h=M):(typeof C.componentDidUpdate!="function"||A===o.memoizedProps&&G===o.memoizedState||(s.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||A===o.memoizedProps&&G===o.memoizedState||(s.flags|=1024),h=!1)}return l0(o,s,d,h,g,_)}function l0(o,s,d,h,_,g){KV(o,s);var C=(s.flags&128)!==0;if(!h&&!C)return _&&Xx(s,d,!1),$s(o,s,g);h=s.stateNode,h$.current=s;var A=C&&typeof d.getDerivedStateFromError!="function"?null:h.render();return s.flags|=1,o!==null&&C?(s.child=su(s,o.child,null,g),s.child=su(s,null,A,g)):Zr(o,s,A,g),s.memoizedState=h.state,_&&Xx(s,d,!0),s.child}function zV(o){var s=o.stateNode;s.pendingContext?Jx(o,s.pendingContext,s.pendingContext!==s.context):s.context&&Jx(o,s.context,!1),hR(o,s.containerInfo)}function hU(o,s,d,h,_){return ou(),sR(_),s.flags|=256,Zr(o,s,d,h),s.child}var u0={dehydrated:null,treeContext:null,retryLane:0};function h0(o){return{baseLanes:o,cachePool:null,transitions:null}}function YV(o,s,d){var h=s.pendingProps,_=Un.current,g=!1,C=(s.flags&128)!==0,A;if((A=C)||(A=o!==null&&o.memoizedState===null?!1:(_&2)!==0),A?(g=!0,s.flags&=-129):(o===null||o.memoizedState!==null)&&(_|=1),vn(Un,_&1),o===null)return i0(s),o=s.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?(s.mode&1?o.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(C=h.children,o=h.fallback,g?(h=s.mode,g=s.child,C={mode:"hidden",children:C},!(h&1)&&g!==null?(g.childLanes=0,g.pendingProps=C):g=XE(C,h,0,null),o=sd(o,h,d,null),g.return=s,o.return=s,g.sibling=o,s.child=g,s.child.memoizedState=h0(d),s.memoizedState=u0,o):TR(s,C));if(_=o.memoizedState,_!==null&&(A=_.dehydrated,A!==null))return p$(o,s,C,h,A,_,d);if(g){g=h.fallback,C=s.mode,_=o.child,A=_.sibling;var P={mode:"hidden",children:h.children};return!(C&1)&&s.child!==_?(h=s.child,h.childLanes=0,h.pendingProps=P,s.deletions=null):(h=rc(_,P),h.subtreeFlags=_.subtreeFlags&14680064),A!==null?g=rc(A,g):(g=sd(g,C,d,null),g.flags|=2),g.return=s,h.return=s,h.sibling=g,s.child=h,h=g,g=s.child,C=o.child.memoizedState,C=C===null?h0(d):{baseLanes:C.baseLanes|d,cachePool:null,transitions:C.transitions},g.memoizedState=C,g.childLanes=o.childLanes&~d,s.memoizedState=u0,h}return g=o.child,o=g.sibling,h=rc(g,{mode:"visible",children:h.children}),!(s.mode&1)&&(h.lanes=d),h.return=s,h.sibling=null,o!==null&&(d=s.deletions,d===null?(s.deletions=[o],s.flags|=16):d.push(o)),s.child=h,s.memoizedState=null,h}function TR(o,s){return s=XE({mode:"visible",children:s},o.mode,0,null),s.return=o,o.child=s}function j_(o,s,d,h){return h!==null&&sR(h),su(s,o.child,null,d),o=TR(s,s.pendingProps.children),o.flags|=2,s.memoizedState=null,o}function p$(o,s,d,h,_,g,C){if(d)return s.flags&256?(s.flags&=-257,h=vC(Error(Ie(422))),j_(o,s,C,h)):s.memoizedState!==null?(s.child=o.child,s.flags|=128,null):(g=h.fallback,_=s.mode,h=XE({mode:"visible",children:h.children},_,0,null),g=sd(g,_,C,null),g.flags|=2,h.return=s,g.return=s,h.sibling=g,s.child=h,s.mode&1&&su(s,o.child,null,C),s.child.memoizedState=h0(C),s.memoizedState=u0,g);if(!(s.mode&1))return j_(o,s,C,null);if(_.data==="$!"){if(h=_.nextSibling&&_.nextSibling.dataset,h)var A=h.dgst;return h=A,g=Error(Ie(419)),h=vC(g,h,void 0),j_(o,s,C,h)}if(A=(C&o.childLanes)!==0,gi||A){if(h=yr,h!==null){switch(C&-C){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(h.suspendedLanes|C)?0:_,_!==0&&_!==g.retryLane&&(g.retryLane=_,Zs(o,_),Ho(h,o,_,-1))}return IR(),h=vC(Error(Ie(421))),j_(o,s,C,h)}return _.data==="$?"?(s.flags|=128,s.child=o.child,s=I$.bind(null,o),_._reactRetry=s,null):(o=g.treeContext,xi=$a(_.nextSibling),Ui=s,kn=!0,Wo=null,o!==null&&(po[fo++]=zs,po[fo++]=Ys,po[fo++]=ud,zs=o.id,Ys=o.overflow,ud=s),s=TR(s,h.children),s.flags|=4096,s)}function pU(o,s,d){o.lanes|=s;var h=o.alternate;h!==null&&(h.lanes|=s),o0(o.return,s,d)}function yC(o,s,d,h,_){var g=o.memoizedState;g===null?o.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:h,tail:d,tailMode:_}:(g.isBackwards=s,g.rendering=null,g.renderingStartTime=0,g.last=h,g.tail=d,g.tailMode=_)}function qV(o,s,d){var h=s.pendingProps,_=h.revealOrder,g=h.tail;if(Zr(o,s,h.children,d),h=Un.current,h&2)h=h&1|2,s.flags|=128;else{if(o!==null&&o.flags&128)e:for(o=s.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&pU(o,d,s);else if(o.tag===19)pU(o,d,s);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===s)break e;for(;o.sibling===null;){if(o.return===null||o.return===s)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}h&=1}if(vn(Un,h),!(s.mode&1))s.memoizedState=null;else switch(_){case"forwards":for(d=s.child,_=null;d!==null;)o=d.alternate,o!==null&&yE(o)===null&&(_=d),d=d.sibling;d=_,d===null?(_=s.child,s.child=null):(_=d.sibling,d.sibling=null),yC(s,!1,_,d,g);break;case"backwards":for(d=null,_=s.child,s.child=null;_!==null;){if(o=_.alternate,o!==null&&yE(o)===null){s.child=_;break}o=_.sibling,_.sibling=d,d=_,_=o}yC(s,!0,d,null,g);break;case"together":yC(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Z_(o,s){!(s.mode&1)&&o!==null&&(o.alternate=null,s.alternate=null,s.flags|=2)}function $s(o,s,d){if(o!==null&&(s.dependencies=o.dependencies),pd|=s.lanes,!(d&s.childLanes))return null;if(o!==null&&s.child!==o.child)throw Error(Ie(153));if(s.child!==null){for(o=s.child,d=rc(o,o.pendingProps),s.child=d,d.return=s;o.sibling!==null;)o=o.sibling,d=d.sibling=rc(o,o.pendingProps),d.return=s;d.sibling=null}return s.child}function f$(o,s,d){switch(s.tag){case 3:zV(s),ou();break;case 5:TV(s);break;case 1:Ti(s.type)&&_E(s);break;case 4:hR(s,s.stateNode.containerInfo);break;case 10:var h=s.type._context,_=s.memoizedProps.value;vn(SE,h._currentValue),h._currentValue=_;break;case 13:if(h=s.memoizedState,h!==null)return h.dehydrated!==null?(vn(Un,Un.current&1),s.flags|=128,null):d&s.child.childLanes?YV(o,s,d):(vn(Un,Un.current&1),o=$s(o,s,d),o!==null?o.sibling:null);vn(Un,Un.current&1);break;case 19:if(h=(d&s.childLanes)!==0,o.flags&128){if(h)return qV(o,s,d);s.flags|=128}if(_=s.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),vn(Un,Un.current),h)break;return null;case 22:case 23:return s.lanes=0,HV(o,s,d)}return $s(o,s,d)}var JV,p0,XV,QV;JV=function(o,s){for(var d=s.child;d!==null;){if(d.tag===5||d.tag===6)o.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===s)break;for(;d.sibling===null;){if(d.return===null||d.return===s)return;d=d.return}d.sibling.return=d.return,d=d.sibling}};p0=function(){};XV=function(o,s,d,h){var _=o.memoizedProps;if(_!==h){o=s.stateNode,id(Is.current);var g=null;switch(d){case"input":_=MC(o,_),h=MC(o,h),g=[];break;case"select":_=Fn({},_,{value:void 0}),h=Fn({},h,{value:void 0}),g=[];break;case"textarea":_=jC(o,_),h=jC(o,h),g=[];break;default:typeof _.onClick!="function"&&typeof h.onClick=="function"&&(o.onclick=fE)}FC(d,h);var C;d=null;for(M in _)if(!h.hasOwnProperty(M)&&_.hasOwnProperty(M)&&_[M]!=null)if(M==="style"){var A=_[M];for(C in A)A.hasOwnProperty(C)&&(d||(d={}),d[C]="")}else M!=="dangerouslySetInnerHTML"&&M!=="children"&&M!=="suppressContentEditableWarning"&&M!=="suppressHydrationWarning"&&M!=="autoFocus"&&(fp.hasOwnProperty(M)?g||(g=[]):(g=g||[]).push(M,null));for(M in h){var P=h[M];if(A=_!=null?_[M]:void 0,h.hasOwnProperty(M)&&P!==A&&(P!=null||A!=null))if(M==="style")if(A){for(C in A)!A.hasOwnProperty(C)||P&&P.hasOwnProperty(C)||(d||(d={}),d[C]="");for(C in P)P.hasOwnProperty(C)&&A[C]!==P[C]&&(d||(d={}),d[C]=P[C])}else d||(g||(g=[]),g.push(M,d)),d=P;else M==="dangerouslySetInnerHTML"?(P=P?P.__html:void 0,A=A?A.__html:void 0,P!=null&&A!==P&&(g=g||[]).push(M,P)):M==="children"?typeof P!="string"&&typeof P!="number"||(g=g||[]).push(M,""+P):M!=="suppressContentEditableWarning"&&M!=="suppressHydrationWarning"&&(fp.hasOwnProperty(M)?(P!=null&&M==="onScroll"&&bn("scroll",o),g||A===P||(g=[])):(g=g||[]).push(M,P))}d&&(g=g||[]).push("style",d);var M=g;(s.updateQueue=M)&&(s.flags|=4)}};QV=function(o,s,d,h){d!==h&&(s.flags|=4)};function qh(o,s){if(!kn)switch(o.tailMode){case"hidden":s=o.tail;for(var d=null;s!==null;)s.alternate!==null&&(d=s),s=s.sibling;d===null?o.tail=null:d.sibling=null;break;case"collapsed":d=o.tail;for(var h=null;d!==null;)d.alternate!==null&&(h=d),d=d.sibling;h===null?s||o.tail===null?o.tail=null:o.tail.sibling=null:h.sibling=null}}function Fr(o){var s=o.alternate!==null&&o.alternate.child===o.child,d=0,h=0;if(s)for(var _=o.child;_!==null;)d|=_.lanes|_.childLanes,h|=_.subtreeFlags&14680064,h|=_.flags&14680064,_.return=o,_=_.sibling;else for(_=o.child;_!==null;)d|=_.lanes|_.childLanes,h|=_.subtreeFlags,h|=_.flags,_.return=o,_=_.sibling;return o.subtreeFlags|=h,o.childLanes=d,s}function m$(o,s,d){var h=s.pendingProps;switch(oR(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Fr(s),null;case 1:return Ti(s.type)&&mE(),Fr(s),null;case 3:return h=s.stateNode,au(),An(Si),An(Gr),fR(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(o===null||o.child===null)&&(x_(s)?s.flags|=4:o===null||o.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,Wo!==null&&(v0(Wo),Wo=null))),p0(o,s),Fr(s),null;case 5:pR(s);var _=id(Ip.current);if(d=s.type,o!==null&&s.stateNode!=null)XV(o,s,d,h,_),o.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!h){if(s.stateNode===null)throw Error(Ie(166));return Fr(s),null}if(o=id(Is.current),x_(s)){h=s.stateNode,d=s.type;var g=s.memoizedProps;switch(h[Rs]=s,h[Rp]=g,o=(s.mode&1)!==0,d){case"dialog":bn("cancel",h),bn("close",h);break;case"iframe":case"object":case"embed":bn("load",h);break;case"video":case"audio":for(_=0;_<ep.length;_++)bn(ep[_],h);break;case"source":bn("error",h);break;case"img":case"image":case"link":bn("error",h),bn("load",h);break;case"details":bn("toggle",h);break;case"input":yx(h,g),bn("invalid",h);break;case"select":h._wrapperState={wasMultiple:!!g.multiple},bn("invalid",h);break;case"textarea":Rx(h,g),bn("invalid",h)}FC(d,g),_=null;for(var C in g)if(g.hasOwnProperty(C)){var A=g[C];C==="children"?typeof A=="string"?h.textContent!==A&&(g.suppressHydrationWarning!==!0&&M_(h.textContent,A,o),_=["children",A]):typeof A=="number"&&h.textContent!==""+A&&(g.suppressHydrationWarning!==!0&&M_(h.textContent,A,o),_=["children",""+A]):fp.hasOwnProperty(C)&&A!=null&&C==="onScroll"&&bn("scroll",h)}switch(d){case"input":b_(h),Cx(h,g,!0);break;case"textarea":b_(h),wx(h);break;case"select":case"option":break;default:typeof g.onClick=="function"&&(h.onclick=fE)}h=_,s.updateQueue=h,h!==null&&(s.flags|=4)}else{C=_.nodeType===9?_:_.ownerDocument,o==="http://www.w3.org/1999/xhtml"&&(o=wj(d)),o==="http://www.w3.org/1999/xhtml"?d==="script"?(o=C.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)):typeof h.is=="string"?o=C.createElement(d,{is:h.is}):(o=C.createElement(d),d==="select"&&(C=o,h.multiple?C.multiple=!0:h.size&&(C.size=h.size))):o=C.createElementNS(o,d),o[Rs]=s,o[Rp]=h,JV(o,s,!1,!1),s.stateNode=o;e:{switch(C=BC(d,h),d){case"dialog":bn("cancel",o),bn("close",o),_=h;break;case"iframe":case"object":case"embed":bn("load",o),_=h;break;case"video":case"audio":for(_=0;_<ep.length;_++)bn(ep[_],o);_=h;break;case"source":bn("error",o),_=h;break;case"img":case"image":case"link":bn("error",o),bn("load",o),_=h;break;case"details":bn("toggle",o),_=h;break;case"input":yx(o,h),_=MC(o,h),bn("invalid",o);break;case"option":_=h;break;case"select":o._wrapperState={wasMultiple:!!h.multiple},_=Fn({},h,{value:void 0}),bn("invalid",o);break;case"textarea":Rx(o,h),_=jC(o,h),bn("invalid",o);break;default:_=h}FC(d,_),A=_;for(g in A)if(A.hasOwnProperty(g)){var P=A[g];g==="style"?Aj(o,P):g==="dangerouslySetInnerHTML"?(P=P?P.__html:void 0,P!=null&&Ij(o,P)):g==="children"?typeof P=="string"?(d!=="textarea"||P!=="")&&mp(o,P):typeof P=="number"&&mp(o,""+P):g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&g!=="autoFocus"&&(fp.hasOwnProperty(g)?P!=null&&g==="onScroll"&&bn("scroll",o):P!=null&&H0(o,g,P,C))}switch(d){case"input":b_(o),Cx(o,h,!1);break;case"textarea":b_(o),wx(o);break;case"option":h.value!=null&&o.setAttribute("value",""+oc(h.value));break;case"select":o.multiple=!!h.multiple,g=h.value,g!=null?Ql(o,!!h.multiple,g,!1):h.defaultValue!=null&&Ql(o,!!h.multiple,h.defaultValue,!0);break;default:typeof _.onClick=="function"&&(o.onclick=fE)}switch(d){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}}h&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return Fr(s),null;case 6:if(o&&s.stateNode!=null)QV(o,s,o.memoizedProps,h);else{if(typeof h!="string"&&s.stateNode===null)throw Error(Ie(166));if(d=id(Ip.current),id(Is.current),x_(s)){if(h=s.stateNode,d=s.memoizedProps,h[Rs]=s,(g=h.nodeValue!==d)&&(o=Ui,o!==null))switch(o.tag){case 3:M_(h.nodeValue,d,(o.mode&1)!==0);break;case 5:o.memoizedProps.suppressHydrationWarning!==!0&&M_(h.nodeValue,d,(o.mode&1)!==0)}g&&(s.flags|=4)}else h=(d.nodeType===9?d:d.ownerDocument).createTextNode(h),h[Rs]=s,s.stateNode=h}return Fr(s),null;case 13:if(An(Un),h=s.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(kn&&xi!==null&&s.mode&1&&!(s.flags&128))mV(),ou(),s.flags|=98560,g=!1;else if(g=x_(s),h!==null&&h.dehydrated!==null){if(o===null){if(!g)throw Error(Ie(318));if(g=s.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(Ie(317));g[Rs]=s}else ou(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;Fr(s),g=!1}else Wo!==null&&(v0(Wo),Wo=null),g=!0;if(!g)return s.flags&65536?s:null}return s.flags&128?(s.lanes=d,s):(h=h!==null,h!==(o!==null&&o.memoizedState!==null)&&h&&(s.child.flags|=8192,s.mode&1&&(o===null||Un.current&1?hr===0&&(hr=3):IR())),s.updateQueue!==null&&(s.flags|=4),Fr(s),null);case 4:return au(),p0(o,s),o===null&&yp(s.stateNode.containerInfo),Fr(s),null;case 10:return dR(s.type._context),Fr(s),null;case 17:return Ti(s.type)&&mE(),Fr(s),null;case 19:if(An(Un),g=s.memoizedState,g===null)return Fr(s),null;if(h=(s.flags&128)!==0,C=g.rendering,C===null)if(h)qh(g,!1);else{if(hr!==0||o!==null&&o.flags&128)for(o=s.child;o!==null;){if(C=yE(o),C!==null){for(s.flags|=128,qh(g,!1),h=C.updateQueue,h!==null&&(s.updateQueue=h,s.flags|=4),s.subtreeFlags=0,h=d,d=s.child;d!==null;)g=d,o=h,g.flags&=14680066,C=g.alternate,C===null?(g.childLanes=0,g.lanes=o,g.child=null,g.subtreeFlags=0,g.memoizedProps=null,g.memoizedState=null,g.updateQueue=null,g.dependencies=null,g.stateNode=null):(g.childLanes=C.childLanes,g.lanes=C.lanes,g.child=C.child,g.subtreeFlags=0,g.deletions=null,g.memoizedProps=C.memoizedProps,g.memoizedState=C.memoizedState,g.updateQueue=C.updateQueue,g.type=C.type,o=C.dependencies,g.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),d=d.sibling;return vn(Un,Un.current&1|2),s.child}o=o.sibling}g.tail!==null&&$n()>du&&(s.flags|=128,h=!0,qh(g,!1),s.lanes=4194304)}else{if(!h)if(o=yE(C),o!==null){if(s.flags|=128,h=!0,d=o.updateQueue,d!==null&&(s.updateQueue=d,s.flags|=4),qh(g,!0),g.tail===null&&g.tailMode==="hidden"&&!C.alternate&&!kn)return Fr(s),null}else 2*$n()-g.renderingStartTime>du&&d!==1073741824&&(s.flags|=128,h=!0,qh(g,!1),s.lanes=4194304);g.isBackwards?(C.sibling=s.child,s.child=C):(d=g.last,d!==null?d.sibling=C:s.child=C,g.last=C)}return g.tail!==null?(s=g.tail,g.rendering=s,g.tail=s.sibling,g.renderingStartTime=$n(),s.sibling=null,d=Un.current,vn(Un,h?d&1|2:d&1),s):(Fr(s),null);case 22:case 23:return wR(),h=s.memoizedState!==null,o!==null&&o.memoizedState!==null!==h&&(s.flags|=8192),h&&s.mode&1?Mi&1073741824&&(Fr(s),s.subtreeFlags&6&&(s.flags|=8192)):Fr(s),null;case 24:return null;case 25:return null}throw Error(Ie(156,s.tag))}function _$(o,s){switch(oR(s),s.tag){case 1:return Ti(s.type)&&mE(),o=s.flags,o&65536?(s.flags=o&-65537|128,s):null;case 3:return au(),An(Si),An(Gr),fR(),o=s.flags,o&65536&&!(o&128)?(s.flags=o&-65537|128,s):null;case 5:return pR(s),null;case 13:if(An(Un),o=s.memoizedState,o!==null&&o.dehydrated!==null){if(s.alternate===null)throw Error(Ie(340));ou()}return o=s.flags,o&65536?(s.flags=o&-65537|128,s):null;case 19:return An(Un),null;case 4:return au(),null;case 10:return dR(s.type._context),null;case 22:case 23:return wR(),null;case 24:return null;default:return null}}var V_=!1,Wr=!1,E$=typeof WeakSet=="function"?WeakSet:Set,Ve=null;function Yl(o,s){var d=o.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(h){zn(o,s,h)}else d.current=null}function f0(o,s,d){try{d()}catch(h){zn(o,s,h)}}var fU=!1;function g$(o,s){if(QC=uE,o=nV(),rR(o)){if("selectionStart"in o)var d={start:o.selectionStart,end:o.selectionEnd};else e:{d=(d=o.ownerDocument)&&d.defaultView||window;var h=d.getSelection&&d.getSelection();if(h&&h.rangeCount!==0){d=h.anchorNode;var _=h.anchorOffset,g=h.focusNode;h=h.focusOffset;try{d.nodeType,g.nodeType}catch{d=null;break e}var C=0,A=-1,P=-1,M=0,V=0,j=o,G=null;t:for(;;){for(var Z;j!==d||_!==0&&j.nodeType!==3||(A=C+_),j!==g||h!==0&&j.nodeType!==3||(P=C+h),j.nodeType===3&&(C+=j.nodeValue.length),(Z=j.firstChild)!==null;)G=j,j=Z;for(;;){if(j===o)break t;if(G===d&&++M===_&&(A=C),G===g&&++V===h&&(P=C),(Z=j.nextSibling)!==null)break;j=G,G=j.parentNode}j=Z}d=A===-1||P===-1?null:{start:A,end:P}}else d=null}d=d||{start:0,end:0}}else d=null;for(ZC={focusedElem:o,selectionRange:d},uE=!1,Ve=s;Ve!==null;)if(s=Ve,o=s.child,(s.subtreeFlags&1028)!==0&&o!==null)o.return=s,Ve=o;else for(;Ve!==null;){s=Ve;try{var z=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(z!==null){var $=z.memoizedProps,pe=z.memoizedState,K=s.stateNode,H=K.getSnapshotBeforeUpdate(s.elementType===s.type?$:Vo(s.type,$),pe);K.__reactInternalSnapshotBeforeUpdate=H}break;case 3:var Y=s.stateNode.containerInfo;Y.nodeType===1?Y.textContent="":Y.nodeType===9&&Y.documentElement&&Y.removeChild(Y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ie(163))}}catch(ae){zn(s,s.return,ae)}if(o=s.sibling,o!==null){o.return=s.return,Ve=o;break}Ve=s.return}return z=fU,fU=!1,z}function dp(o,s,d){var h=s.updateQueue;if(h=h!==null?h.lastEffect:null,h!==null){var _=h=h.next;do{if((_.tag&o)===o){var g=_.destroy;_.destroy=void 0,g!==void 0&&f0(s,d,g)}_=_.next}while(_!==h)}}function qE(o,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var d=s=s.next;do{if((d.tag&o)===o){var h=d.create;d.destroy=h()}d=d.next}while(d!==s)}}function m0(o){var s=o.ref;if(s!==null){var d=o.stateNode;switch(o.tag){case 5:o=d;break;default:o=d}typeof s=="function"?s(o):s.current=o}}function ZV(o){var s=o.alternate;s!==null&&(o.alternate=null,ZV(s)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(s=o.stateNode,s!==null&&(delete s[Rs],delete s[Rp],delete s[t0],delete s[e$],delete s[t$])),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function $V(o){return o.tag===5||o.tag===3||o.tag===4}function mU(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||$V(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function _0(o,s,d){var h=o.tag;if(h===5||h===6)o=o.stateNode,s?d.nodeType===8?d.parentNode.insertBefore(o,s):d.insertBefore(o,s):(d.nodeType===8?(s=d.parentNode,s.insertBefore(o,d)):(s=d,s.appendChild(o)),d=d._reactRootContainer,d!=null||s.onclick!==null||(s.onclick=fE));else if(h!==4&&(o=o.child,o!==null))for(_0(o,s,d),o=o.sibling;o!==null;)_0(o,s,d),o=o.sibling}function E0(o,s,d){var h=o.tag;if(h===5||h===6)o=o.stateNode,s?d.insertBefore(o,s):d.appendChild(o);else if(h!==4&&(o=o.child,o!==null))for(E0(o,s,d),o=o.sibling;o!==null;)E0(o,s,d),o=o.sibling}var Ar=null,Bo=!1;function Fa(o,s,d){for(d=d.child;d!==null;)e5(o,s,d),d=d.sibling}function e5(o,s,d){if(ws&&typeof ws.onCommitFiberUnmount=="function")try{ws.onCommitFiberUnmount(FE,d)}catch{}switch(d.tag){case 5:Wr||Yl(d,s);case 6:var h=Ar,_=Bo;Ar=null,Fa(o,s,d),Ar=h,Bo=_,Ar!==null&&(Bo?(o=Ar,d=d.stateNode,o.nodeType===8?o.parentNode.removeChild(d):o.removeChild(d)):Ar.removeChild(d.stateNode));break;case 18:Ar!==null&&(Bo?(o=Ar,d=d.stateNode,o.nodeType===8?mC(o.parentNode,d):o.nodeType===1&&mC(o,d),Sp(o)):mC(Ar,d.stateNode));break;case 4:h=Ar,_=Bo,Ar=d.stateNode.containerInfo,Bo=!0,Fa(o,s,d),Ar=h,Bo=_;break;case 0:case 11:case 14:case 15:if(!Wr&&(h=d.updateQueue,h!==null&&(h=h.lastEffect,h!==null))){_=h=h.next;do{var g=_,C=g.destroy;g=g.tag,C!==void 0&&(g&2||g&4)&&f0(d,s,C),_=_.next}while(_!==h)}Fa(o,s,d);break;case 1:if(!Wr&&(Yl(d,s),h=d.stateNode,typeof h.componentWillUnmount=="function"))try{h.props=d.memoizedProps,h.state=d.memoizedState,h.componentWillUnmount()}catch(A){zn(d,s,A)}Fa(o,s,d);break;case 21:Fa(o,s,d);break;case 22:d.mode&1?(Wr=(h=Wr)||d.memoizedState!==null,Fa(o,s,d),Wr=h):Fa(o,s,d);break;default:Fa(o,s,d)}}function _U(o){var s=o.updateQueue;if(s!==null){o.updateQueue=null;var d=o.stateNode;d===null&&(d=o.stateNode=new E$),s.forEach(function(h){var _=b$.bind(null,o,h);d.has(h)||(d.add(h),h.then(_,_))})}}function jo(o,s){var d=s.deletions;if(d!==null)for(var h=0;h<d.length;h++){var _=d[h];try{var g=o,C=s,A=C;e:for(;A!==null;){switch(A.tag){case 5:Ar=A.stateNode,Bo=!1;break e;case 3:Ar=A.stateNode.containerInfo,Bo=!0;break e;case 4:Ar=A.stateNode.containerInfo,Bo=!0;break e}A=A.return}if(Ar===null)throw Error(Ie(160));e5(g,C,_),Ar=null,Bo=!1;var P=_.alternate;P!==null&&(P.return=null),_.return=null}catch(M){zn(_,s,M)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)t5(s,o),s=s.sibling}function t5(o,s){var d=o.alternate,h=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(jo(s,o),ys(o),h&4){try{dp(3,o,o.return),qE(3,o)}catch($){zn(o,o.return,$)}try{dp(5,o,o.return)}catch($){zn(o,o.return,$)}}break;case 1:jo(s,o),ys(o),h&512&&d!==null&&Yl(d,d.return);break;case 5:if(jo(s,o),ys(o),h&512&&d!==null&&Yl(d,d.return),o.flags&32){var _=o.stateNode;try{mp(_,"")}catch($){zn(o,o.return,$)}}if(h&4&&(_=o.stateNode,_!=null)){var g=o.memoizedProps,C=d!==null?d.memoizedProps:g,A=o.type,P=o.updateQueue;if(o.updateQueue=null,P!==null)try{A==="input"&&g.type==="radio"&&g.name!=null&&Cj(_,g),BC(A,C);var M=BC(A,g);for(C=0;C<P.length;C+=2){var V=P[C],j=P[C+1];V==="style"?Aj(_,j):V==="dangerouslySetInnerHTML"?Ij(_,j):V==="children"?mp(_,j):H0(_,V,j,M)}switch(A){case"input":xC(_,g);break;case"textarea":Rj(_,g);break;case"select":var G=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!g.multiple;var Z=g.value;Z!=null?Ql(_,!!g.multiple,Z,!1):G!==!!g.multiple&&(g.defaultValue!=null?Ql(_,!!g.multiple,g.defaultValue,!0):Ql(_,!!g.multiple,g.multiple?[]:"",!1))}_[Rp]=g}catch($){zn(o,o.return,$)}}break;case 6:if(jo(s,o),ys(o),h&4){if(o.stateNode===null)throw Error(Ie(162));_=o.stateNode,g=o.memoizedProps;try{_.nodeValue=g}catch($){zn(o,o.return,$)}}break;case 3:if(jo(s,o),ys(o),h&4&&d!==null&&d.memoizedState.isDehydrated)try{Sp(s.containerInfo)}catch($){zn(o,o.return,$)}break;case 4:jo(s,o),ys(o);break;case 13:jo(s,o),ys(o),_=o.child,_.flags&8192&&(g=_.memoizedState!==null,_.stateNode.isHidden=g,!g||_.alternate!==null&&_.alternate.memoizedState!==null||(CR=$n())),h&4&&_U(o);break;case 22:if(V=d!==null&&d.memoizedState!==null,o.mode&1?(Wr=(M=Wr)||V,jo(s,o),Wr=M):jo(s,o),ys(o),h&8192){if(M=o.memoizedState!==null,(o.stateNode.isHidden=M)&&!V&&o.mode&1)for(Ve=o,V=o.child;V!==null;){for(j=Ve=V;Ve!==null;){switch(G=Ve,Z=G.child,G.tag){case 0:case 11:case 14:case 15:dp(4,G,G.return);break;case 1:Yl(G,G.return);var z=G.stateNode;if(typeof z.componentWillUnmount=="function"){h=G,d=G.return;try{s=h,z.props=s.memoizedProps,z.state=s.memoizedState,z.componentWillUnmount()}catch($){zn(h,d,$)}}break;case 5:Yl(G,G.return);break;case 22:if(G.memoizedState!==null){gU(j);continue}}Z!==null?(Z.return=G,Ve=Z):gU(j)}V=V.sibling}e:for(V=null,j=o;;){if(j.tag===5){if(V===null){V=j;try{_=j.stateNode,M?(g=_.style,typeof g.setProperty=="function"?g.setProperty("display","none","important"):g.display="none"):(A=j.stateNode,P=j.memoizedProps.style,C=P!=null&&P.hasOwnProperty("display")?P.display:null,A.style.display=bj("display",C))}catch($){zn(o,o.return,$)}}}else if(j.tag===6){if(V===null)try{j.stateNode.nodeValue=M?"":j.memoizedProps}catch($){zn(o,o.return,$)}}else if((j.tag!==22&&j.tag!==23||j.memoizedState===null||j===o)&&j.child!==null){j.child.return=j,j=j.child;continue}if(j===o)break e;for(;j.sibling===null;){if(j.return===null||j.return===o)break e;V===j&&(V=null),j=j.return}V===j&&(V=null),j.sibling.return=j.return,j=j.sibling}}break;case 19:jo(s,o),ys(o),h&4&&_U(o);break;case 21:break;default:jo(s,o),ys(o)}}function ys(o){var s=o.flags;if(s&2){try{e:{for(var d=o.return;d!==null;){if($V(d)){var h=d;break e}d=d.return}throw Error(Ie(160))}switch(h.tag){case 5:var _=h.stateNode;h.flags&32&&(mp(_,""),h.flags&=-33);var g=mU(o);E0(o,g,_);break;case 3:case 4:var C=h.stateNode.containerInfo,A=mU(o);_0(o,A,C);break;default:throw Error(Ie(161))}}catch(P){zn(o,o.return,P)}o.flags&=-3}s&4096&&(o.flags&=-4097)}function S$(o,s,d){Ve=o,n5(o)}function n5(o,s,d){for(var h=(o.mode&1)!==0;Ve!==null;){var _=Ve,g=_.child;if(_.tag===22&&h){var C=_.memoizedState!==null||V_;if(!C){var A=_.alternate,P=A!==null&&A.memoizedState!==null||Wr;A=V_;var M=Wr;if(V_=C,(Wr=P)&&!M)for(Ve=_;Ve!==null;)C=Ve,P=C.child,C.tag===22&&C.memoizedState!==null?SU(_):P!==null?(P.return=C,Ve=P):SU(_);for(;g!==null;)Ve=g,n5(g),g=g.sibling;Ve=_,V_=A,Wr=M}EU(o)}else _.subtreeFlags&8772&&g!==null?(g.return=_,Ve=g):EU(o)}}function EU(o){for(;Ve!==null;){var s=Ve;if(s.flags&8772){var d=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:Wr||qE(5,s);break;case 1:var h=s.stateNode;if(s.flags&4&&!Wr)if(d===null)h.componentDidMount();else{var _=s.elementType===s.type?d.memoizedProps:Vo(s.type,d.memoizedProps);h.componentDidUpdate(_,d.memoizedState,h.__reactInternalSnapshotBeforeUpdate)}var g=s.updateQueue;g!==null&&tU(s,g,h);break;case 3:var C=s.updateQueue;if(C!==null){if(d=null,s.child!==null)switch(s.child.tag){case 5:d=s.child.stateNode;break;case 1:d=s.child.stateNode}tU(s,C,d)}break;case 5:var A=s.stateNode;if(d===null&&s.flags&4){d=A;var P=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":P.autoFocus&&d.focus();break;case"img":P.src&&(d.src=P.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var M=s.alternate;if(M!==null){var V=M.memoizedState;if(V!==null){var j=V.dehydrated;j!==null&&Sp(j)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ie(163))}Wr||s.flags&512&&m0(s)}catch(G){zn(s,s.return,G)}}if(s===o){Ve=null;break}if(d=s.sibling,d!==null){d.return=s.return,Ve=d;break}Ve=s.return}}function gU(o){for(;Ve!==null;){var s=Ve;if(s===o){Ve=null;break}var d=s.sibling;if(d!==null){d.return=s.return,Ve=d;break}Ve=s.return}}function SU(o){for(;Ve!==null;){var s=Ve;try{switch(s.tag){case 0:case 11:case 15:var d=s.return;try{qE(4,s)}catch(P){zn(s,d,P)}break;case 1:var h=s.stateNode;if(typeof h.componentDidMount=="function"){var _=s.return;try{h.componentDidMount()}catch(P){zn(s,_,P)}}var g=s.return;try{m0(s)}catch(P){zn(s,g,P)}break;case 5:var C=s.return;try{m0(s)}catch(P){zn(s,C,P)}}}catch(P){zn(s,s.return,P)}if(s===o){Ve=null;break}var A=s.sibling;if(A!==null){A.return=s.return,Ve=A;break}Ve=s.return}}var T$=Math.ceil,wE=ea.ReactCurrentDispatcher,vR=ea.ReactCurrentOwner,_o=ea.ReactCurrentBatchConfig,Yt=0,yr=null,rr=null,Or=0,Mi=0,ql=dc(0),hr=0,Np=null,pd=0,JE=0,yR=0,lp=null,Ei=null,CR=0,du=1/0,Hs=null,IE=!1,g0=null,tc=null,F_=!1,Ya=null,bE=0,up=0,S0=null,$_=-1,eE=0;function $r(){return Yt&6?$n():$_!==-1?$_:$_=$n()}function nc(o){return o.mode&1?Yt&2&&Or!==0?Or&-Or:r$.transition!==null?(eE===0&&(eE=Fj()),eE):(o=ln,o!==0||(o=window.event,o=o===void 0?16:Yj(o.type)),o):1}function Ho(o,s,d,h){if(50<up)throw up=0,S0=null,Error(Ie(185));Up(o,d,h),(!(Yt&2)||o!==yr)&&(o===yr&&(!(Yt&2)&&(JE|=d),hr===4&&Ka(o,Or)),vi(o,h),d===1&&Yt===0&&!(s.mode&1)&&(du=$n()+500,KE&&lc()))}function vi(o,s){var d=o.callbackNode;rZ(o,s);var h=lE(o,o===yr?Or:0);if(h===0)d!==null&&Ax(d),o.callbackNode=null,o.callbackPriority=0;else if(s=h&-h,o.callbackPriority!==s){if(d!=null&&Ax(d),s===1)o.tag===0?n$(TU.bind(null,o)):hV(TU.bind(null,o)),ZZ(function(){!(Yt&6)&&lc()}),d=null;else{switch(Bj(h)){case 1:d=J0;break;case 4:d=jj;break;case 16:d=dE;break;case 536870912:d=Vj;break;default:d=dE}d=l5(d,r5.bind(null,o))}o.callbackPriority=s,o.callbackNode=d}}function r5(o,s){if($_=-1,eE=0,Yt&6)throw Error(Ie(327));var d=o.callbackNode;if(nu()&&o.callbackNode!==d)return null;var h=lE(o,o===yr?Or:0);if(h===0)return null;if(h&30||h&o.expiredLanes||s)s=AE(o,h);else{s=h;var _=Yt;Yt|=2;var g=o5();(yr!==o||Or!==s)&&(Hs=null,du=$n()+500,od(o,s));do try{C$();break}catch(A){i5(o,A)}while(!0);cR(),wE.current=g,Yt=_,rr!==null?s=0:(yr=null,Or=0,s=hr)}if(s!==0){if(s===2&&(_=zC(o),_!==0&&(h=_,s=T0(o,_))),s===1)throw d=Np,od(o,0),Ka(o,h),vi(o,$n()),d;if(s===6)Ka(o,h);else{if(_=o.current.alternate,!(h&30)&&!v$(_)&&(s=AE(o,h),s===2&&(g=zC(o),g!==0&&(h=g,s=T0(o,g))),s===1))throw d=Np,od(o,0),Ka(o,h),vi(o,$n()),d;switch(o.finishedWork=_,o.finishedLanes=h,s){case 0:case 1:throw Error(Ie(345));case 2:ed(o,Ei,Hs);break;case 3:if(Ka(o,h),(h&130023424)===h&&(s=CR+500-$n(),10<s)){if(lE(o,0)!==0)break;if(_=o.suspendedLanes,(_&h)!==h){$r(),o.pingedLanes|=o.suspendedLanes&_;break}o.timeoutHandle=e0(ed.bind(null,o,Ei,Hs),s);break}ed(o,Ei,Hs);break;case 4:if(Ka(o,h),(h&4194240)===h)break;for(s=o.eventTimes,_=-1;0<h;){var C=31-Go(h);g=1<<C,C=s[C],C>_&&(_=C),h&=~g}if(h=_,h=$n()-h,h=(120>h?120:480>h?480:1080>h?1080:1920>h?1920:3e3>h?3e3:4320>h?4320:1960*T$(h/1960))-h,10<h){o.timeoutHandle=e0(ed.bind(null,o,Ei,Hs),h);break}ed(o,Ei,Hs);break;case 5:ed(o,Ei,Hs);break;default:throw Error(Ie(329))}}}return vi(o,$n()),o.callbackNode===d?r5.bind(null,o):null}function T0(o,s){var d=lp;return o.current.memoizedState.isDehydrated&&(od(o,s).flags|=256),o=AE(o,s),o!==2&&(s=Ei,Ei=d,s!==null&&v0(s)),o}function v0(o){Ei===null?Ei=o:Ei.push.apply(Ei,o)}function v$(o){for(var s=o;;){if(s.flags&16384){var d=s.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var h=0;h<d.length;h++){var _=d[h],g=_.getSnapshot;_=_.value;try{if(!Yo(g(),_))return!1}catch{return!1}}}if(d=s.child,s.subtreeFlags&16384&&d!==null)d.return=s,s=d;else{if(s===o)break;for(;s.sibling===null;){if(s.return===null||s.return===o)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Ka(o,s){for(s&=~yR,s&=~JE,o.suspendedLanes|=s,o.pingedLanes&=~s,o=o.expirationTimes;0<s;){var d=31-Go(s),h=1<<d;o[d]=-1,s&=~h}}function TU(o){if(Yt&6)throw Error(Ie(327));nu();var s=lE(o,0);if(!(s&1))return vi(o,$n()),null;var d=AE(o,s);if(o.tag!==0&&d===2){var h=zC(o);h!==0&&(s=h,d=T0(o,h))}if(d===1)throw d=Np,od(o,0),Ka(o,s),vi(o,$n()),d;if(d===6)throw Error(Ie(345));return o.finishedWork=o.current.alternate,o.finishedLanes=s,ed(o,Ei,Hs),vi(o,$n()),null}function RR(o,s){var d=Yt;Yt|=1;try{return o(s)}finally{Yt=d,Yt===0&&(du=$n()+500,KE&&lc())}}function fd(o){Ya!==null&&Ya.tag===0&&!(Yt&6)&&nu();var s=Yt;Yt|=1;var d=_o.transition,h=ln;try{if(_o.transition=null,ln=1,o)return o()}finally{ln=h,_o.transition=d,Yt=s,!(Yt&6)&&lc()}}function wR(){Mi=ql.current,An(ql)}function od(o,s){o.finishedWork=null,o.finishedLanes=0;var d=o.timeoutHandle;if(d!==-1&&(o.timeoutHandle=-1,QZ(d)),rr!==null)for(d=rr.return;d!==null;){var h=d;switch(oR(h),h.tag){case 1:h=h.type.childContextTypes,h!=null&&mE();break;case 3:au(),An(Si),An(Gr),fR();break;case 5:pR(h);break;case 4:au();break;case 13:An(Un);break;case 19:An(Un);break;case 10:dR(h.type._context);break;case 22:case 23:wR()}d=d.return}if(yr=o,rr=o=rc(o.current,null),Or=Mi=s,hr=0,Np=null,yR=JE=pd=0,Ei=lp=null,rd!==null){for(s=0;s<rd.length;s++)if(d=rd[s],h=d.interleaved,h!==null){d.interleaved=null;var _=h.next,g=d.pending;if(g!==null){var C=g.next;g.next=_,h.next=C}d.pending=h}rd=null}return o}function i5(o,s){do{var d=rr;try{if(cR(),X_.current=RE,CE){for(var h=jn.memoizedState;h!==null;){var _=h.queue;_!==null&&(_.pending=null),h=h.next}CE=!1}if(hd=0,vr=ur=jn=null,cp=!1,bp=0,vR.current=null,d===null||d.return===null){hr=1,Np=s,rr=null;break}e:{var g=o,C=d.return,A=d,P=s;if(s=Or,A.flags|=32768,P!==null&&typeof P=="object"&&typeof P.then=="function"){var M=P,V=A,j=V.tag;if(!(V.mode&1)&&(j===0||j===11||j===15)){var G=V.alternate;G?(V.updateQueue=G.updateQueue,V.memoizedState=G.memoizedState,V.lanes=G.lanes):(V.updateQueue=null,V.memoizedState=null)}var Z=aU(C);if(Z!==null){Z.flags&=-257,cU(Z,C,A,g,s),Z.mode&1&&sU(g,M,s),s=Z,P=M;var z=s.updateQueue;if(z===null){var $=new Set;$.add(P),s.updateQueue=$}else z.add(P);break e}else{if(!(s&1)){sU(g,M,s),IR();break e}P=Error(Ie(426))}}else if(kn&&A.mode&1){var pe=aU(C);if(pe!==null){!(pe.flags&65536)&&(pe.flags|=256),cU(pe,C,A,g,s),sR(cu(P,A));break e}}g=P=cu(P,A),hr!==4&&(hr=2),lp===null?lp=[g]:lp.push(g),g=C;do{switch(g.tag){case 3:g.flags|=65536,s&=-s,g.lanes|=s;var K=BV(g,P,s);eU(g,K);break e;case 1:A=P;var H=g.type,Y=g.stateNode;if(!(g.flags&128)&&(typeof H.getDerivedStateFromError=="function"||Y!==null&&typeof Y.componentDidCatch=="function"&&(tc===null||!tc.has(Y)))){g.flags|=65536,s&=-s,g.lanes|=s;var ae=WV(g,A,s);eU(g,ae);break e}}g=g.return}while(g!==null)}a5(d)}catch(Ae){s=Ae,rr===d&&d!==null&&(rr=d=d.return);continue}break}while(!0)}function o5(){var o=wE.current;return wE.current=RE,o===null?RE:o}function IR(){(hr===0||hr===3||hr===2)&&(hr=4),yr===null||!(pd&268435455)&&!(JE&268435455)||Ka(yr,Or)}function AE(o,s){var d=Yt;Yt|=2;var h=o5();(yr!==o||Or!==s)&&(Hs=null,od(o,s));do try{y$();break}catch(_){i5(o,_)}while(!0);if(cR(),Yt=d,wE.current=h,rr!==null)throw Error(Ie(261));return yr=null,Or=0,hr}function y$(){for(;rr!==null;)s5(rr)}function C$(){for(;rr!==null&&!qQ();)s5(rr)}function s5(o){var s=d5(o.alternate,o,Mi);o.memoizedProps=o.pendingProps,s===null?a5(o):rr=s,vR.current=null}function a5(o){var s=o;do{var d=s.alternate;if(o=s.return,s.flags&32768){if(d=_$(d,s),d!==null){d.flags&=32767,rr=d;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{hr=6,rr=null;return}}else if(d=m$(d,s,Mi),d!==null){rr=d;return}if(s=s.sibling,s!==null){rr=s;return}rr=s=o}while(s!==null);hr===0&&(hr=5)}function ed(o,s,d){var h=ln,_=_o.transition;try{_o.transition=null,ln=1,R$(o,s,d,h)}finally{_o.transition=_,ln=h}return null}function R$(o,s,d,h){do nu();while(Ya!==null);if(Yt&6)throw Error(Ie(327));d=o.finishedWork;var _=o.finishedLanes;if(d===null)return null;if(o.finishedWork=null,o.finishedLanes=0,d===o.current)throw Error(Ie(177));o.callbackNode=null,o.callbackPriority=0;var g=d.lanes|d.childLanes;if(iZ(o,g),o===yr&&(rr=yr=null,Or=0),!(d.subtreeFlags&2064)&&!(d.flags&2064)||F_||(F_=!0,l5(dE,function(){return nu(),null})),g=(d.flags&15990)!==0,d.subtreeFlags&15990||g){g=_o.transition,_o.transition=null;var C=ln;ln=1;var A=Yt;Yt|=4,vR.current=null,g$(o,d),t5(d,o),HZ(ZC),uE=!!QC,ZC=QC=null,o.current=d,S$(d),JQ(),Yt=A,ln=C,_o.transition=g}else o.current=d;if(F_&&(F_=!1,Ya=o,bE=_),g=o.pendingLanes,g===0&&(tc=null),ZQ(d.stateNode),vi(o,$n()),s!==null)for(h=o.onRecoverableError,d=0;d<s.length;d++)_=s[d],h(_.value,{componentStack:_.stack,digest:_.digest});if(IE)throw IE=!1,o=g0,g0=null,o;return bE&1&&o.tag!==0&&nu(),g=o.pendingLanes,g&1?o===S0?up++:(up=0,S0=o):up=0,lc(),null}function nu(){if(Ya!==null){var o=Bj(bE),s=_o.transition,d=ln;try{if(_o.transition=null,ln=16>o?16:o,Ya===null)var h=!1;else{if(o=Ya,Ya=null,bE=0,Yt&6)throw Error(Ie(331));var _=Yt;for(Yt|=4,Ve=o.current;Ve!==null;){var g=Ve,C=g.child;if(Ve.flags&16){var A=g.deletions;if(A!==null){for(var P=0;P<A.length;P++){var M=A[P];for(Ve=M;Ve!==null;){var V=Ve;switch(V.tag){case 0:case 11:case 15:dp(8,V,g)}var j=V.child;if(j!==null)j.return=V,Ve=j;else for(;Ve!==null;){V=Ve;var G=V.sibling,Z=V.return;if(ZV(V),V===M){Ve=null;break}if(G!==null){G.return=Z,Ve=G;break}Ve=Z}}}var z=g.alternate;if(z!==null){var $=z.child;if($!==null){z.child=null;do{var pe=$.sibling;$.sibling=null,$=pe}while($!==null)}}Ve=g}}if(g.subtreeFlags&2064&&C!==null)C.return=g,Ve=C;else e:for(;Ve!==null;){if(g=Ve,g.flags&2048)switch(g.tag){case 0:case 11:case 15:dp(9,g,g.return)}var K=g.sibling;if(K!==null){K.return=g.return,Ve=K;break e}Ve=g.return}}var H=o.current;for(Ve=H;Ve!==null;){C=Ve;var Y=C.child;if(C.subtreeFlags&2064&&Y!==null)Y.return=C,Ve=Y;else e:for(C=H;Ve!==null;){if(A=Ve,A.flags&2048)try{switch(A.tag){case 0:case 11:case 15:qE(9,A)}}catch(Ae){zn(A,A.return,Ae)}if(A===C){Ve=null;break e}var ae=A.sibling;if(ae!==null){ae.return=A.return,Ve=ae;break e}Ve=A.return}}if(Yt=_,lc(),ws&&typeof ws.onPostCommitFiberRoot=="function")try{ws.onPostCommitFiberRoot(FE,o)}catch{}h=!0}return h}finally{ln=d,_o.transition=s}}return!1}function vU(o,s,d){s=cu(d,s),s=BV(o,s,1),o=ec(o,s,1),s=$r(),o!==null&&(Up(o,1,s),vi(o,s))}function zn(o,s,d){if(o.tag===3)vU(o,o,d);else for(;s!==null;){if(s.tag===3){vU(s,o,d);break}else if(s.tag===1){var h=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(tc===null||!tc.has(h))){o=cu(d,o),o=WV(s,o,1),s=ec(s,o,1),o=$r(),s!==null&&(Up(s,1,o),vi(s,o));break}}s=s.return}}function w$(o,s,d){var h=o.pingCache;h!==null&&h.delete(s),s=$r(),o.pingedLanes|=o.suspendedLanes&d,yr===o&&(Or&d)===d&&(hr===4||hr===3&&(Or&130023424)===Or&&500>$n()-CR?od(o,0):yR|=d),vi(o,s)}function c5(o,s){s===0&&(o.mode&1?(s=N_,N_<<=1,!(N_&130023424)&&(N_=4194304)):s=1);var d=$r();o=Zs(o,s),o!==null&&(Up(o,s,d),vi(o,d))}function I$(o){var s=o.memoizedState,d=0;s!==null&&(d=s.retryLane),c5(o,d)}function b$(o,s){var d=0;switch(o.tag){case 13:var h=o.stateNode,_=o.memoizedState;_!==null&&(d=_.retryLane);break;case 19:h=o.stateNode;break;default:throw Error(Ie(314))}h!==null&&h.delete(s),c5(o,d)}var d5;d5=function(o,s,d){if(o!==null)if(o.memoizedProps!==s.pendingProps||Si.current)gi=!0;else{if(!(o.lanes&d)&&!(s.flags&128))return gi=!1,f$(o,s,d);gi=!!(o.flags&131072)}else gi=!1,kn&&s.flags&1048576&&pV(s,gE,s.index);switch(s.lanes=0,s.tag){case 2:var h=s.type;Z_(o,s),o=s.pendingProps;var _=iu(s,Gr.current);tu(s,d),_=_R(null,s,h,o,_,d);var g=ER();return s.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,Ti(h)?(g=!0,_E(s)):g=!1,s.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,uR(s),_.updater=YE,s.stateNode=_,_._reactInternals=s,a0(s,h,o,d),s=l0(null,s,h,!0,g,d)):(s.tag=0,kn&&g&&iR(s),Zr(null,s,_,d),s=s.child),s;case 16:h=s.elementType;e:{switch(Z_(o,s),o=s.pendingProps,_=h._init,h=_(h._payload),s.type=h,_=s.tag=O$(h),o=Vo(h,o),_){case 0:s=d0(null,s,h,o,d);break e;case 1:s=uU(null,s,h,o,d);break e;case 11:s=dU(null,s,h,o,d);break e;case 14:s=lU(null,s,h,Vo(h.type,o),d);break e}throw Error(Ie(306,h,""))}return s;case 0:return h=s.type,_=s.pendingProps,_=s.elementType===h?_:Vo(h,_),d0(o,s,h,_,d);case 1:return h=s.type,_=s.pendingProps,_=s.elementType===h?_:Vo(h,_),uU(o,s,h,_,d);case 3:e:{if(zV(s),o===null)throw Error(Ie(387));h=s.pendingProps,g=s.memoizedState,_=g.element,SV(o,s),vE(s,h,null,d);var C=s.memoizedState;if(h=C.element,g.isDehydrated)if(g={element:h,isDehydrated:!1,cache:C.cache,pendingSuspenseBoundaries:C.pendingSuspenseBoundaries,transitions:C.transitions},s.updateQueue.baseState=g,s.memoizedState=g,s.flags&256){_=cu(Error(Ie(423)),s),s=hU(o,s,h,d,_);break e}else if(h!==_){_=cu(Error(Ie(424)),s),s=hU(o,s,h,d,_);break e}else for(xi=$a(s.stateNode.containerInfo.firstChild),Ui=s,kn=!0,Wo=null,d=EV(s,null,h,d),s.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(ou(),h===_){s=$s(o,s,d);break e}Zr(o,s,h,d)}s=s.child}return s;case 5:return TV(s),o===null&&i0(s),h=s.type,_=s.pendingProps,g=o!==null?o.memoizedProps:null,C=_.children,$C(h,_)?C=null:g!==null&&$C(h,g)&&(s.flags|=32),KV(o,s),Zr(o,s,C,d),s.child;case 6:return o===null&&i0(s),null;case 13:return YV(o,s,d);case 4:return hR(s,s.stateNode.containerInfo),h=s.pendingProps,o===null?s.child=su(s,null,h,d):Zr(o,s,h,d),s.child;case 11:return h=s.type,_=s.pendingProps,_=s.elementType===h?_:Vo(h,_),dU(o,s,h,_,d);case 7:return Zr(o,s,s.pendingProps,d),s.child;case 8:return Zr(o,s,s.pendingProps.children,d),s.child;case 12:return Zr(o,s,s.pendingProps.children,d),s.child;case 10:e:{if(h=s.type._context,_=s.pendingProps,g=s.memoizedProps,C=_.value,vn(SE,h._currentValue),h._currentValue=C,g!==null)if(Yo(g.value,C)){if(g.children===_.children&&!Si.current){s=$s(o,s,d);break e}}else for(g=s.child,g!==null&&(g.return=s);g!==null;){var A=g.dependencies;if(A!==null){C=g.child;for(var P=A.firstContext;P!==null;){if(P.context===h){if(g.tag===1){P=Js(-1,d&-d),P.tag=2;var M=g.updateQueue;if(M!==null){M=M.shared;var V=M.pending;V===null?P.next=P:(P.next=V.next,V.next=P),M.pending=P}}g.lanes|=d,P=g.alternate,P!==null&&(P.lanes|=d),o0(g.return,d,s),A.lanes|=d;break}P=P.next}}else if(g.tag===10)C=g.type===s.type?null:g.child;else if(g.tag===18){if(C=g.return,C===null)throw Error(Ie(341));C.lanes|=d,A=C.alternate,A!==null&&(A.lanes|=d),o0(C,d,s),C=g.sibling}else C=g.child;if(C!==null)C.return=g;else for(C=g;C!==null;){if(C===s){C=null;break}if(g=C.sibling,g!==null){g.return=C.return,C=g;break}C=C.return}g=C}Zr(o,s,_.children,d),s=s.child}return s;case 9:return _=s.type,h=s.pendingProps.children,tu(s,d),_=go(_),h=h(_),s.flags|=1,Zr(o,s,h,d),s.child;case 14:return h=s.type,_=Vo(h,s.pendingProps),_=Vo(h.type,_),lU(o,s,h,_,d);case 15:return GV(o,s,s.type,s.pendingProps,d);case 17:return h=s.type,_=s.pendingProps,_=s.elementType===h?_:Vo(h,_),Z_(o,s),s.tag=1,Ti(h)?(o=!0,_E(s)):o=!1,tu(s,d),FV(s,h,_),a0(s,h,_,d),l0(null,s,h,!0,o,d);case 19:return qV(o,s,d);case 22:return HV(o,s,d)}throw Error(Ie(156,s.tag))};function l5(o,s){return Uj(o,s)}function A$(o,s,d,h){this.tag=o,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function mo(o,s,d,h){return new A$(o,s,d,h)}function bR(o){return o=o.prototype,!(!o||!o.isReactComponent)}function O$(o){if(typeof o=="function")return bR(o)?1:0;if(o!=null){if(o=o.$$typeof,o===z0)return 11;if(o===Y0)return 14}return 2}function rc(o,s){var d=o.alternate;return d===null?(d=mo(o.tag,s,o.key,o.mode),d.elementType=o.elementType,d.type=o.type,d.stateNode=o.stateNode,d.alternate=o,o.alternate=d):(d.pendingProps=s,d.type=o.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=o.flags&14680064,d.childLanes=o.childLanes,d.lanes=o.lanes,d.child=o.child,d.memoizedProps=o.memoizedProps,d.memoizedState=o.memoizedState,d.updateQueue=o.updateQueue,s=o.dependencies,d.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},d.sibling=o.sibling,d.index=o.index,d.ref=o.ref,d}function tE(o,s,d,h,_,g){var C=2;if(h=o,typeof o=="function")bR(o)&&(C=1);else if(typeof o=="string")C=5;else e:switch(o){case jl:return sd(d.children,_,g,s);case K0:C=8,_|=8;break;case DC:return o=mo(12,d,s,_|2),o.elementType=DC,o.lanes=g,o;case PC:return o=mo(13,d,s,_),o.elementType=PC,o.lanes=g,o;case LC:return o=mo(19,d,s,_),o.elementType=LC,o.lanes=g,o;case Tj:return XE(d,_,g,s);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case gj:C=10;break e;case Sj:C=9;break e;case z0:C=11;break e;case Y0:C=14;break e;case Wa:C=16,h=null;break e}throw Error(Ie(130,o==null?o:typeof o,""))}return s=mo(C,d,s,_),s.elementType=o,s.type=h,s.lanes=g,s}function sd(o,s,d,h){return o=mo(7,o,h,s),o.lanes=d,o}function XE(o,s,d,h){return o=mo(22,o,h,s),o.elementType=Tj,o.lanes=d,o.stateNode={isHidden:!1},o}function CC(o,s,d){return o=mo(6,o,null,s),o.lanes=d,o}function RC(o,s,d){return s=mo(4,o.children!==null?o.children:[],o.key,s),s.lanes=d,s.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},s}function N$(o,s,d,h,_){this.tag=s,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=iC(0),this.expirationTimes=iC(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=iC(0),this.identifierPrefix=h,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function AR(o,s,d,h,_,g,C,A,P){return o=new N$(o,s,d,A,P),s===1?(s=1,g===!0&&(s|=8)):s=0,g=mo(3,null,null,s),o.current=g,g.stateNode=o,g.memoizedState={element:h,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},uR(g),o}function D$(o,s,d){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ul,key:h==null?null:""+h,children:o,containerInfo:s,implementation:d}}function u5(o){if(!o)return sc;o=o._reactInternals;e:{if(gd(o)!==o||o.tag!==1)throw Error(Ie(170));var s=o;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(Ti(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(Ie(171))}if(o.tag===1){var d=o.type;if(Ti(d))return uV(o,d,s)}return s}function h5(o,s,d,h,_,g,C,A,P){return o=AR(d,h,!0,o,_,g,C,A,P),o.context=u5(null),d=o.current,h=$r(),_=nc(d),g=Js(h,_),g.callback=s??null,ec(d,g,_),o.current.lanes=_,Up(o,_,h),vi(o,h),o}function QE(o,s,d,h){var _=s.current,g=$r(),C=nc(_);return d=u5(d),s.context===null?s.context=d:s.pendingContext=d,s=Js(g,C),s.payload={element:o},h=h===void 0?null:h,h!==null&&(s.callback=h),o=ec(_,s,C),o!==null&&(Ho(o,_,C,g),J_(o,_,C)),C}function OE(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return o.child.stateNode;default:return o.child.stateNode}}function yU(o,s){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var d=o.retryLane;o.retryLane=d!==0&&d<s?d:s}}function OR(o,s){yU(o,s),(o=o.alternate)&&yU(o,s)}function P$(){return null}var p5=typeof reportError=="function"?reportError:function(o){console.error(o)};function NR(o){this._internalRoot=o}ZE.prototype.render=NR.prototype.render=function(o){var s=this._internalRoot;if(s===null)throw Error(Ie(409));QE(o,s,null,null)};ZE.prototype.unmount=NR.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var s=o.containerInfo;fd(function(){QE(null,o,null,null)}),s[Qs]=null}};function ZE(o){this._internalRoot=o}ZE.prototype.unstable_scheduleHydration=function(o){if(o){var s=Hj();o={blockedOn:null,target:o,priority:s};for(var d=0;d<Ha.length&&s!==0&&s<Ha[d].priority;d++);Ha.splice(d,0,o),d===0&&zj(o)}};function DR(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function $E(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11&&(o.nodeType!==8||o.nodeValue!==" react-mount-point-unstable "))}function CU(){}function L$(o,s,d,h,_){if(_){if(typeof h=="function"){var g=h;h=function(){var M=OE(C);g.call(M)}}var C=h5(s,h,o,0,null,!1,!1,"",CU);return o._reactRootContainer=C,o[Qs]=C.current,yp(o.nodeType===8?o.parentNode:o),fd(),C}for(;_=o.lastChild;)o.removeChild(_);if(typeof h=="function"){var A=h;h=function(){var M=OE(P);A.call(M)}}var P=AR(o,0,!1,null,null,!1,!1,"",CU);return o._reactRootContainer=P,o[Qs]=P.current,yp(o.nodeType===8?o.parentNode:o),fd(function(){QE(s,P,d,h)}),P}function eg(o,s,d,h,_){var g=d._reactRootContainer;if(g){var C=g;if(typeof _=="function"){var A=_;_=function(){var P=OE(C);A.call(P)}}QE(s,C,o,_)}else C=L$(d,s,o,_,h);return OE(C)}Wj=function(o){switch(o.tag){case 3:var s=o.stateNode;if(s.current.memoizedState.isDehydrated){var d=$h(s.pendingLanes);d!==0&&(X0(s,d|1),vi(s,$n()),!(Yt&6)&&(du=$n()+500,lc()))}break;case 13:fd(function(){var h=Zs(o,1);if(h!==null){var _=$r();Ho(h,o,1,_)}}),OR(o,1)}};Q0=function(o){if(o.tag===13){var s=Zs(o,134217728);if(s!==null){var d=$r();Ho(s,o,134217728,d)}OR(o,134217728)}};Gj=function(o){if(o.tag===13){var s=nc(o),d=Zs(o,s);if(d!==null){var h=$r();Ho(d,o,s,h)}OR(o,s)}};Hj=function(){return ln};Kj=function(o,s){var d=ln;try{return ln=o,s()}finally{ln=d}};GC=function(o,s,d){switch(s){case"input":if(xC(o,d),s=d.name,d.type==="radio"&&s!=null){for(d=o;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<d.length;s++){var h=d[s];if(h!==o&&h.form===o.form){var _=HE(h);if(!_)throw Error(Ie(90));yj(h),xC(h,_)}}}break;case"textarea":Rj(o,d);break;case"select":s=d.value,s!=null&&Ql(o,!!d.multiple,s,!1)}};Dj=RR;Pj=fd;var k$={usingClientEntryPoint:!1,Events:[Vp,Wl,HE,Oj,Nj,RR]},Jh={findFiberByHostInstance:nd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},M$={bundleType:Jh.bundleType,version:Jh.version,rendererPackageName:Jh.rendererPackageName,rendererConfig:Jh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ea.ReactCurrentDispatcher,findHostInstanceByFiber:function(o){return o=Mj(o),o===null?null:o.stateNode},findFiberByHostInstance:Jh.findFiberByHostInstance||P$,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var B_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!B_.isDisabled&&B_.supportsFiber)try{FE=B_.inject(M$),ws=B_}catch{}}Vi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=k$;Vi.createPortal=function(o,s){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!DR(s))throw Error(Ie(200));return D$(o,s,null,d)};Vi.createRoot=function(o,s){if(!DR(o))throw Error(Ie(299));var d=!1,h="",_=p5;return s!=null&&(s.unstable_strictMode===!0&&(d=!0),s.identifierPrefix!==void 0&&(h=s.identifierPrefix),s.onRecoverableError!==void 0&&(_=s.onRecoverableError)),s=AR(o,1,!1,null,null,d,!1,h,_),o[Qs]=s.current,yp(o.nodeType===8?o.parentNode:o),new NR(s)};Vi.findDOMNode=function(o){if(o==null)return null;if(o.nodeType===1)return o;var s=o._reactInternals;if(s===void 0)throw typeof o.render=="function"?Error(Ie(188)):(o=Object.keys(o).join(","),Error(Ie(268,o)));return o=Mj(s),o=o===null?null:o.stateNode,o};Vi.flushSync=function(o){return fd(o)};Vi.hydrate=function(o,s,d){if(!$E(s))throw Error(Ie(200));return eg(null,o,s,!0,d)};Vi.hydrateRoot=function(o,s,d){if(!DR(o))throw Error(Ie(405));var h=d!=null&&d.hydratedSources||null,_=!1,g="",C=p5;if(d!=null&&(d.unstable_strictMode===!0&&(_=!0),d.identifierPrefix!==void 0&&(g=d.identifierPrefix),d.onRecoverableError!==void 0&&(C=d.onRecoverableError)),s=h5(s,null,o,1,d??null,_,!1,g,C),o[Qs]=s.current,yp(o),h)for(o=0;o<h.length;o++)d=h[o],_=d._getVersion,_=_(d._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[d,_]:s.mutableSourceEagerHydrationData.push(d,_);return new ZE(s)};Vi.render=function(o,s,d){if(!$E(s))throw Error(Ie(200));return eg(null,o,s,!1,d)};Vi.unmountComponentAtNode=function(o){if(!$E(o))throw Error(Ie(40));return o._reactRootContainer?(fd(function(){eg(null,null,o,!1,function(){o._reactRootContainer=null,o[Qs]=null})}),!0):!1};Vi.unstable_batchedUpdates=RR;Vi.unstable_renderSubtreeIntoContainer=function(o,s,d,h){if(!$E(d))throw Error(Ie(200));if(o==null||o._reactInternals===void 0)throw Error(Ie(38));return eg(o,s,d,!1,h)};Vi.version="18.3.1-next-f1338f8080-20240426";function f5(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(f5)}catch(o){console.error(o)}}f5(),fj.exports=Vi;var m5=fj.exports,_5,RU=m5;_5=RU.createRoot,RU.hydrateRoot;/**
 * @remix-run/router v1.18.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Dp(){return Dp=Object.assign?Object.assign.bind():function(o){for(var s=1;s<arguments.length;s++){var d=arguments[s];for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(o[h]=d[h])}return o},Dp.apply(this,arguments)}var qa;(function(o){o.Pop="POP",o.Push="PUSH",o.Replace="REPLACE"})(qa||(qa={}));const wU="popstate";function x$(o){o===void 0&&(o={});function s(h,_){let{pathname:g,search:C,hash:A}=h.location;return y0("",{pathname:g,search:C,hash:A},_.state&&_.state.usr||null,_.state&&_.state.key||"default")}function d(h,_){return typeof _=="string"?_:NE(_)}return j$(s,d,null,o)}function ir(o,s){if(o===!1||o===null||typeof o>"u")throw new Error(s)}function E5(o,s){if(!o){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function U$(){return Math.random().toString(36).substr(2,8)}function IU(o,s){return{usr:o.state,key:o.key,idx:s}}function y0(o,s,d,h){return d===void 0&&(d=null),Dp({pathname:typeof o=="string"?o:o.pathname,search:"",hash:""},typeof s=="string"?fu(s):s,{state:d,key:s&&s.key||h||U$()})}function NE(o){let{pathname:s="/",search:d="",hash:h=""}=o;return d&&d!=="?"&&(s+=d.charAt(0)==="?"?d:"?"+d),h&&h!=="#"&&(s+=h.charAt(0)==="#"?h:"#"+h),s}function fu(o){let s={};if(o){let d=o.indexOf("#");d>=0&&(s.hash=o.substr(d),o=o.substr(0,d));let h=o.indexOf("?");h>=0&&(s.search=o.substr(h),o=o.substr(0,h)),o&&(s.pathname=o)}return s}function j$(o,s,d,h){h===void 0&&(h={});let{window:_=document.defaultView,v5Compat:g=!1}=h,C=_.history,A=qa.Pop,P=null,M=V();M==null&&(M=0,C.replaceState(Dp({},C.state,{idx:M}),""));function V(){return(C.state||{idx:null}).idx}function j(){A=qa.Pop;let pe=V(),K=pe==null?null:pe-M;M=pe,P&&P({action:A,location:$.location,delta:K})}function G(pe,K){A=qa.Push;let H=y0($.location,pe,K);M=V()+1;let Y=IU(H,M),ae=$.createHref(H);try{C.pushState(Y,"",ae)}catch(Ae){if(Ae instanceof DOMException&&Ae.name==="DataCloneError")throw Ae;_.location.assign(ae)}g&&P&&P({action:A,location:$.location,delta:1})}function Z(pe,K){A=qa.Replace;let H=y0($.location,pe,K);M=V();let Y=IU(H,M),ae=$.createHref(H);C.replaceState(Y,"",ae),g&&P&&P({action:A,location:$.location,delta:0})}function z(pe){let K=_.location.origin!=="null"?_.location.origin:_.location.href,H=typeof pe=="string"?pe:NE(pe);return H=H.replace(/ $/,"%20"),ir(K,"No window.location.(origin|href) available to create URL for href: "+H),new URL(H,K)}let $={get action(){return A},get location(){return o(_,C)},listen(pe){if(P)throw new Error("A history only accepts one active listener");return _.addEventListener(wU,j),P=pe,()=>{_.removeEventListener(wU,j),P=null}},createHref(pe){return s(_,pe)},createURL:z,encodeLocation(pe){let K=z(pe);return{pathname:K.pathname,search:K.search,hash:K.hash}},push:G,replace:Z,go(pe){return C.go(pe)}};return $}var bU;(function(o){o.data="data",o.deferred="deferred",o.redirect="redirect",o.error="error"})(bU||(bU={}));function V$(o,s,d){return d===void 0&&(d="/"),F$(o,s,d,!1)}function F$(o,s,d,h){let _=typeof s=="string"?fu(s):s,g=PR(_.pathname||"/",d);if(g==null)return null;let C=g5(o);B$(C);let A=null;for(let P=0;A==null&&P<C.length;++P){let M=Z$(g);A=X$(C[P],M,h)}return A}function g5(o,s,d,h){s===void 0&&(s=[]),d===void 0&&(d=[]),h===void 0&&(h="");let _=(g,C,A)=>{let P={relativePath:A===void 0?g.path||"":A,caseSensitive:g.caseSensitive===!0,childrenIndex:C,route:g};P.relativePath.startsWith("/")&&(ir(P.relativePath.startsWith(h),'Absolute route path "'+P.relativePath+'" nested under path '+('"'+h+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),P.relativePath=P.relativePath.slice(h.length));let M=ic([h,P.relativePath]),V=d.concat(P);g.children&&g.children.length>0&&(ir(g.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+M+'".')),g5(g.children,s,V,M)),!(g.path==null&&!g.index)&&s.push({path:M,score:q$(M,g.index),routesMeta:V})};return o.forEach((g,C)=>{var A;if(g.path===""||!((A=g.path)!=null&&A.includes("?")))_(g,C);else for(let P of S5(g.path))_(g,C,P)}),s}function S5(o){let s=o.split("/");if(s.length===0)return[];let[d,...h]=s,_=d.endsWith("?"),g=d.replace(/\?$/,"");if(h.length===0)return _?[g,""]:[g];let C=S5(h.join("/")),A=[];return A.push(...C.map(P=>P===""?g:[g,P].join("/"))),_&&A.push(...C),A.map(P=>o.startsWith("/")&&P===""?"/":P)}function B$(o){o.sort((s,d)=>s.score!==d.score?d.score-s.score:J$(s.routesMeta.map(h=>h.childrenIndex),d.routesMeta.map(h=>h.childrenIndex)))}const W$=/^:[\w-]+$/,G$=3,H$=2,K$=1,z$=10,Y$=-2,AU=o=>o==="*";function q$(o,s){let d=o.split("/"),h=d.length;return d.some(AU)&&(h+=Y$),s&&(h+=H$),d.filter(_=>!AU(_)).reduce((_,g)=>_+(W$.test(g)?G$:g===""?K$:z$),h)}function J$(o,s){return o.length===s.length&&o.slice(0,-1).every((h,_)=>h===s[_])?o[o.length-1]-s[s.length-1]:0}function X$(o,s,d){let{routesMeta:h}=o,_={},g="/",C=[];for(let A=0;A<h.length;++A){let P=h[A],M=A===h.length-1,V=g==="/"?s:s.slice(g.length)||"/",j=OU({path:P.relativePath,caseSensitive:P.caseSensitive,end:M},V),G=P.route;if(!j&&M&&d&&!h[h.length-1].route.index&&(j=OU({path:P.relativePath,caseSensitive:P.caseSensitive,end:!1},V)),!j)return null;Object.assign(_,j.params),C.push({params:_,pathname:ic([g,j.pathname]),pathnameBase:nee(ic([g,j.pathnameBase])),route:G}),j.pathnameBase!=="/"&&(g=ic([g,j.pathnameBase]))}return C}function OU(o,s){typeof o=="string"&&(o={path:o,caseSensitive:!1,end:!0});let[d,h]=Q$(o.path,o.caseSensitive,o.end),_=s.match(d);if(!_)return null;let g=_[0],C=g.replace(/(.)\/+$/,"$1"),A=_.slice(1);return{params:h.reduce((M,V,j)=>{let{paramName:G,isOptional:Z}=V;if(G==="*"){let $=A[j]||"";C=g.slice(0,g.length-$.length).replace(/(.)\/+$/,"$1")}const z=A[j];return Z&&!z?M[G]=void 0:M[G]=(z||"").replace(/%2F/g,"/"),M},{}),pathname:g,pathnameBase:C,pattern:o}}function Q$(o,s,d){s===void 0&&(s=!1),d===void 0&&(d=!0),E5(o==="*"||!o.endsWith("*")||o.endsWith("/*"),'Route path "'+o+'" will be treated as if it were '+('"'+o.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+o.replace(/\*$/,"/*")+'".'));let h=[],_="^"+o.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(C,A,P)=>(h.push({paramName:A,isOptional:P!=null}),P?"/?([^\\/]+)?":"/([^\\/]+)"));return o.endsWith("*")?(h.push({paramName:"*"}),_+=o==="*"||o==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):d?_+="\\/*$":o!==""&&o!=="/"&&(_+="(?:(?=\\/|$))"),[new RegExp(_,s?void 0:"i"),h]}function Z$(o){try{return o.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return E5(!1,'The URL path "'+o+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+s+").")),o}}function PR(o,s){if(s==="/")return o;if(!o.toLowerCase().startsWith(s.toLowerCase()))return null;let d=s.endsWith("/")?s.length-1:s.length,h=o.charAt(d);return h&&h!=="/"?null:o.slice(d)||"/"}function $$(o,s){s===void 0&&(s="/");let{pathname:d,search:h="",hash:_=""}=typeof o=="string"?fu(o):o;return{pathname:d?d.startsWith("/")?d:eee(d,s):s,search:ree(h),hash:iee(_)}}function eee(o,s){let d=s.replace(/\/+$/,"").split("/");return o.split("/").forEach(_=>{_===".."?d.length>1&&d.pop():_!=="."&&d.push(_)}),d.length>1?d.join("/"):"/"}function wC(o,s,d,h){return"Cannot include a '"+o+"' character in a manually specified "+("`to."+s+"` field ["+JSON.stringify(h)+"].  Please separate it out to the ")+("`to."+d+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function tee(o){return o.filter((s,d)=>d===0||s.route.path&&s.route.path.length>0)}function T5(o,s){let d=tee(o);return s?d.map((h,_)=>_===d.length-1?h.pathname:h.pathnameBase):d.map(h=>h.pathnameBase)}function v5(o,s,d,h){h===void 0&&(h=!1);let _;typeof o=="string"?_=fu(o):(_=Dp({},o),ir(!_.pathname||!_.pathname.includes("?"),wC("?","pathname","search",_)),ir(!_.pathname||!_.pathname.includes("#"),wC("#","pathname","hash",_)),ir(!_.search||!_.search.includes("#"),wC("#","search","hash",_)));let g=o===""||_.pathname==="",C=g?"/":_.pathname,A;if(C==null)A=d;else{let j=s.length-1;if(!h&&C.startsWith("..")){let G=C.split("/");for(;G[0]==="..";)G.shift(),j-=1;_.pathname=G.join("/")}A=j>=0?s[j]:"/"}let P=$$(_,A),M=C&&C!=="/"&&C.endsWith("/"),V=(g||C===".")&&d.endsWith("/");return!P.pathname.endsWith("/")&&(M||V)&&(P.pathname+="/"),P}const ic=o=>o.join("/").replace(/\/\/+/g,"/"),nee=o=>o.replace(/\/+$/,"").replace(/^\/*/,"/"),ree=o=>!o||o==="?"?"":o.startsWith("?")?o:"?"+o,iee=o=>!o||o==="#"?"":o.startsWith("#")?o:"#"+o;function oee(o){return o!=null&&typeof o.status=="number"&&typeof o.statusText=="string"&&typeof o.internal=="boolean"&&"data"in o}const y5=["post","put","patch","delete"];new Set(y5);const see=["get",...y5];new Set(see);/**
 * React Router v6.25.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Pp(){return Pp=Object.assign?Object.assign.bind():function(o){for(var s=1;s<arguments.length;s++){var d=arguments[s];for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(o[h]=d[h])}return o},Pp.apply(this,arguments)}const LR=ve.createContext(null),aee=ve.createContext(null),Sd=ve.createContext(null),tg=ve.createContext(null),uc=ve.createContext({outlet:null,matches:[],isDataRoute:!1}),C5=ve.createContext(null);function cee(o,s){let{relative:d}=s===void 0?{}:s;Bp()||ir(!1);let{basename:h,navigator:_}=ve.useContext(Sd),{hash:g,pathname:C,search:A}=I5(o,{relative:d}),P=C;return h!=="/"&&(P=C==="/"?h:ic([h,C])),_.createHref({pathname:P,search:A,hash:g})}function Bp(){return ve.useContext(tg)!=null}function hc(){return Bp()||ir(!1),ve.useContext(tg).location}function R5(o){ve.useContext(Sd).static||ve.useLayoutEffect(o)}function To(){let{isDataRoute:o}=ve.useContext(uc);return o?vee():dee()}function dee(){Bp()||ir(!1);let o=ve.useContext(LR),{basename:s,future:d,navigator:h}=ve.useContext(Sd),{matches:_}=ve.useContext(uc),{pathname:g}=hc(),C=JSON.stringify(T5(_,d.v7_relativeSplatPath)),A=ve.useRef(!1);return R5(()=>{A.current=!0}),ve.useCallback(function(M,V){if(V===void 0&&(V={}),!A.current)return;if(typeof M=="number"){h.go(M);return}let j=v5(M,JSON.parse(C),g,V.relative==="path");o==null&&s!=="/"&&(j.pathname=j.pathname==="/"?s:ic([s,j.pathname])),(V.replace?h.replace:h.push)(j,V.state,V)},[s,h,C,g,o])}function w5(){let{matches:o}=ve.useContext(uc),s=o[o.length-1];return s?s.params:{}}function I5(o,s){let{relative:d}=s===void 0?{}:s,{future:h}=ve.useContext(Sd),{matches:_}=ve.useContext(uc),{pathname:g}=hc(),C=JSON.stringify(T5(_,h.v7_relativeSplatPath));return ve.useMemo(()=>v5(o,JSON.parse(C),g,d==="path"),[o,C,g,d])}function lee(o,s){return uee(o,s)}function uee(o,s,d,h){Bp()||ir(!1);let{navigator:_}=ve.useContext(Sd),{matches:g}=ve.useContext(uc),C=g[g.length-1],A=C?C.params:{};C&&C.pathname;let P=C?C.pathnameBase:"/";C&&C.route;let M=hc(),V;if(s){var j;let pe=typeof s=="string"?fu(s):s;P==="/"||(j=pe.pathname)!=null&&j.startsWith(P)||ir(!1),V=pe}else V=M;let G=V.pathname||"/",Z=G;if(P!=="/"){let pe=P.replace(/^\//,"").split("/");Z="/"+G.replace(/^\//,"").split("/").slice(pe.length).join("/")}let z=V$(o,{pathname:Z}),$=_ee(z&&z.map(pe=>Object.assign({},pe,{params:Object.assign({},A,pe.params),pathname:ic([P,_.encodeLocation?_.encodeLocation(pe.pathname).pathname:pe.pathname]),pathnameBase:pe.pathnameBase==="/"?P:ic([P,_.encodeLocation?_.encodeLocation(pe.pathnameBase).pathname:pe.pathnameBase])})),g,d,h);return s&&$?ve.createElement(tg.Provider,{value:{location:Pp({pathname:"/",search:"",hash:"",state:null,key:"default"},V),navigationType:qa.Pop}},$):$}function hee(){let o=Tee(),s=oee(o)?o.status+" "+o.statusText:o instanceof Error?o.message:JSON.stringify(o),d=o instanceof Error?o.stack:null,_={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ve.createElement(ve.Fragment,null,ve.createElement("h2",null,"Unexpected Application Error!"),ve.createElement("h3",{style:{fontStyle:"italic"}},s),d?ve.createElement("pre",{style:_},d):null,null)}const pee=ve.createElement(hee,null);class fee extends ve.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,d){return d.location!==s.location||d.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:d.error,location:d.location,revalidation:s.revalidation||d.revalidation}}componentDidCatch(s,d){console.error("React Router caught the following error during render",s,d)}render(){return this.state.error!==void 0?ve.createElement(uc.Provider,{value:this.props.routeContext},ve.createElement(C5.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function mee(o){let{routeContext:s,match:d,children:h}=o,_=ve.useContext(LR);return _&&_.static&&_.staticContext&&(d.route.errorElement||d.route.ErrorBoundary)&&(_.staticContext._deepestRenderedBoundaryId=d.route.id),ve.createElement(uc.Provider,{value:s},h)}function _ee(o,s,d,h){var _;if(s===void 0&&(s=[]),d===void 0&&(d=null),h===void 0&&(h=null),o==null){var g;if((g=d)!=null&&g.errors)o=d.matches;else return null}let C=o,A=(_=d)==null?void 0:_.errors;if(A!=null){let V=C.findIndex(j=>j.route.id&&(A==null?void 0:A[j.route.id])!==void 0);V>=0||ir(!1),C=C.slice(0,Math.min(C.length,V+1))}let P=!1,M=-1;if(d&&h&&h.v7_partialHydration)for(let V=0;V<C.length;V++){let j=C[V];if((j.route.HydrateFallback||j.route.hydrateFallbackElement)&&(M=V),j.route.id){let{loaderData:G,errors:Z}=d,z=j.route.loader&&G[j.route.id]===void 0&&(!Z||Z[j.route.id]===void 0);if(j.route.lazy||z){P=!0,M>=0?C=C.slice(0,M+1):C=[C[0]];break}}}return C.reduceRight((V,j,G)=>{let Z,z=!1,$=null,pe=null;d&&(Z=A&&j.route.id?A[j.route.id]:void 0,$=j.route.errorElement||pee,P&&(M<0&&G===0?(z=!0,pe=null):M===G&&(z=!0,pe=j.route.hydrateFallbackElement||null)));let K=s.concat(C.slice(0,G+1)),H=()=>{let Y;return Z?Y=$:z?Y=pe:j.route.Component?Y=ve.createElement(j.route.Component,null):j.route.element?Y=j.route.element:Y=V,ve.createElement(mee,{match:j,routeContext:{outlet:V,matches:K,isDataRoute:d!=null},children:Y})};return d&&(j.route.ErrorBoundary||j.route.errorElement||G===0)?ve.createElement(fee,{location:d.location,revalidation:d.revalidation,component:$,error:Z,children:H(),routeContext:{outlet:null,matches:K,isDataRoute:!0}}):H()},null)}var b5=function(o){return o.UseBlocker="useBlocker",o.UseRevalidator="useRevalidator",o.UseNavigateStable="useNavigate",o}(b5||{}),DE=function(o){return o.UseBlocker="useBlocker",o.UseLoaderData="useLoaderData",o.UseActionData="useActionData",o.UseRouteError="useRouteError",o.UseNavigation="useNavigation",o.UseRouteLoaderData="useRouteLoaderData",o.UseMatches="useMatches",o.UseRevalidator="useRevalidator",o.UseNavigateStable="useNavigate",o.UseRouteId="useRouteId",o}(DE||{});function Eee(o){let s=ve.useContext(LR);return s||ir(!1),s}function gee(o){let s=ve.useContext(aee);return s||ir(!1),s}function See(o){let s=ve.useContext(uc);return s||ir(!1),s}function A5(o){let s=See(),d=s.matches[s.matches.length-1];return d.route.id||ir(!1),d.route.id}function Tee(){var o;let s=ve.useContext(C5),d=gee(DE.UseRouteError),h=A5(DE.UseRouteError);return s!==void 0?s:(o=d.errors)==null?void 0:o[h]}function vee(){let{router:o}=Eee(b5.UseNavigateStable),s=A5(DE.UseNavigateStable),d=ve.useRef(!1);return R5(()=>{d.current=!0}),ve.useCallback(function(_,g){g===void 0&&(g={}),d.current&&(typeof _=="number"?o.navigate(_):o.navigate(_,Pp({fromRouteId:s},g)))},[o,s])}function Qr(o){ir(!1)}function yee(o){let{basename:s="/",children:d=null,location:h,navigationType:_=qa.Pop,navigator:g,static:C=!1,future:A}=o;Bp()&&ir(!1);let P=s.replace(/^\/*/,"/"),M=ve.useMemo(()=>({basename:P,navigator:g,static:C,future:Pp({v7_relativeSplatPath:!1},A)}),[P,A,g,C]);typeof h=="string"&&(h=fu(h));let{pathname:V="/",search:j="",hash:G="",state:Z=null,key:z="default"}=h,$=ve.useMemo(()=>{let pe=PR(V,P);return pe==null?null:{location:{pathname:pe,search:j,hash:G,state:Z,key:z},navigationType:_}},[P,V,j,G,Z,z,_]);return $==null?null:ve.createElement(Sd.Provider,{value:M},ve.createElement(tg.Provider,{children:d,value:$}))}function Cee(o){let{children:s,location:d}=o;return lee(C0(s),d)}new Promise(()=>{});function C0(o,s){s===void 0&&(s=[]);let d=[];return ve.Children.forEach(o,(h,_)=>{if(!ve.isValidElement(h))return;let g=[...s,_];if(h.type===ve.Fragment){d.push.apply(d,C0(h.props.children,g));return}h.type!==Qr&&ir(!1),!h.props.index||!h.props.children||ir(!1);let C={id:h.props.id||g.join("-"),caseSensitive:h.props.caseSensitive,element:h.props.element,Component:h.props.Component,index:h.props.index,path:h.props.path,loader:h.props.loader,action:h.props.action,errorElement:h.props.errorElement,ErrorBoundary:h.props.ErrorBoundary,hasErrorBoundary:h.props.ErrorBoundary!=null||h.props.errorElement!=null,shouldRevalidate:h.props.shouldRevalidate,handle:h.props.handle,lazy:h.props.lazy};h.props.children&&(C.children=C0(h.props.children,g)),d.push(C)}),d}/**
 * React Router DOM v6.25.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function R0(){return R0=Object.assign?Object.assign.bind():function(o){for(var s=1;s<arguments.length;s++){var d=arguments[s];for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(o[h]=d[h])}return o},R0.apply(this,arguments)}function Ree(o,s){if(o==null)return{};var d={},h=Object.keys(o),_,g;for(g=0;g<h.length;g++)_=h[g],!(s.indexOf(_)>=0)&&(d[_]=o[_]);return d}function wee(o){return!!(o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)}function Iee(o,s){return o.button===0&&(!s||s==="_self")&&!wee(o)}const bee=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],Aee="6";try{window.__reactRouterVersion=Aee}catch{}const Oee="startTransition",NU=wQ[Oee];function Nee(o){let{basename:s,children:d,future:h,window:_}=o,g=ve.useRef();g.current==null&&(g.current=x$({window:_,v5Compat:!0}));let C=g.current,[A,P]=ve.useState({action:C.action,location:C.location}),{v7_startTransition:M}=h||{},V=ve.useCallback(j=>{M&&NU?NU(()=>P(j)):P(j)},[P,M]);return ve.useLayoutEffect(()=>C.listen(V),[C,V]),ve.createElement(yee,{basename:s,children:d,location:A.location,navigationType:A.action,navigator:C,future:h})}const Dee=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Pee=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ad=ve.forwardRef(function(s,d){let{onClick:h,relative:_,reloadDocument:g,replace:C,state:A,target:P,to:M,preventScrollReset:V,unstable_viewTransition:j}=s,G=Ree(s,bee),{basename:Z}=ve.useContext(Sd),z,$=!1;if(typeof M=="string"&&Pee.test(M)&&(z=M,Dee))try{let Y=new URL(window.location.href),ae=M.startsWith("//")?new URL(Y.protocol+M):new URL(M),Ae=PR(ae.pathname,Z);ae.origin===Y.origin&&Ae!=null?M=Ae+ae.search+ae.hash:$=!0}catch{}let pe=cee(M,{relative:_}),K=Lee(M,{replace:C,state:A,target:P,preventScrollReset:V,relative:_,unstable_viewTransition:j});function H(Y){h&&h(Y),Y.defaultPrevented||K(Y)}return ve.createElement("a",R0({},G,{href:z||pe,onClick:$||g?h:H,ref:d,target:P}))});var DU;(function(o){o.UseScrollRestoration="useScrollRestoration",o.UseSubmit="useSubmit",o.UseSubmitFetcher="useSubmitFetcher",o.UseFetcher="useFetcher",o.useViewTransitionState="useViewTransitionState"})(DU||(DU={}));var PU;(function(o){o.UseFetcher="useFetcher",o.UseFetchers="useFetchers",o.UseScrollRestoration="useScrollRestoration"})(PU||(PU={}));function Lee(o,s){let{target:d,replace:h,state:_,preventScrollReset:g,relative:C,unstable_viewTransition:A}=s===void 0?{}:s,P=To(),M=hc(),V=I5(o,{relative:C});return ve.useCallback(j=>{if(Iee(j,d)){j.preventDefault();let G=h!==void 0?h:NE(M)===NE(V);P(o,{replace:G,state:_,preventScrollReset:g,relative:C,unstable_viewTransition:A})}},[M,P,V,h,_,d,o,g,C,A])}function kee(){return N.jsx("div",{className:"min-h-screen flex items-center justify-center bg-cover bg-center relative font-ubuntu",style:{backgroundImage:"url('/baymax.jpg')"},children:N.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-60 flex items-center justify-center",children:N.jsxs("div",{className:"text-center p-8 rounded-lg",children:[N.jsx("h1",{className:"text-4xl font-bold text-white",children:"We are Team Baymax"}),N.jsx("p",{className:"text-xl text-white mt-2",children:"This is our cry detection app!"}),N.jsxs("div",{className:"mt-6 space-x-4",children:[N.jsx("a",{href:"/user",className:"btn btn-primary btn-md text-white mx-2",children:"User Page"}),N.jsx("a",{href:"/camlogin",className:"btn btn-secondary text-black btn-md mx-2",children:"Camera Page"}),N.jsx("a",{href:"https://github.com",className:"btn btn-secondary text-black btn-md mx-2",children:"Github"}),N.jsx("a",{href:"https://your-website.com",className:"btn btn-secondary text-black btn-md mx-2",children:"Website"})]})]})})})}const ac={API_BASE_URL:"https://crybabydatabase-eqgye24l6a-as.a.run.app"},Mee=({setShowLogin:o})=>{const s=To(),[d,h]=ve.useState(""),[_,g]=ve.useState(""),[C,A]=ve.useState(""),P=j=>{localStorage.setItem("user-data",JSON.stringify(j)),s("/user-home",{state:{userData:j}})},M=()=>{s("/")},V=async j=>{j.preventDefault(),A("");try{const G=await fetch(`${ac.API_BASE_URL}/api/v1/sessions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:d,email:d,password:_})}),Z=await G.json();console.log(Z),G.ok?(console.log("User logged in successfully:",Z),P(Z)):A(Z.message)}catch{A("An error occurred. Please try again.")}};return N.jsxs("div",{className:"font-ubuntu bg-base-100 w-full max-w-md rounded-lg p-6 py-12 justify-center",children:[N.jsx("button",{"aria-label":"close",className:"text-left mb-4",onClick:M,children:N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:N.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),N.jsx("div",{className:"flex justify-center",children:N.jsx("img",{src:"/logo.png",alt:"Illustration",className:"w-64 h-64"})}),N.jsx("h2",{className:"text-3xl font-bold text-primary text-center mb-4",children:"Welcome Back"}),N.jsx("p",{className:"font-lato text-lg text-primary text-center mb-6",children:"Log in to your account"}),C&&N.jsx("p",{className:"text-red-500 text-center",children:C}),N.jsxs("form",{onSubmit:V,children:[N.jsxs("div",{className:"space-y-4 mx-8",children:[N.jsx("input",{type:"text",placeholder:"Username or Email",className:"bg-neutral w-full px-6 py-3 rounded-2xl focus:outline-none focus:ring-1 focus:ring-info",value:d,onChange:j=>h(j.target.value)}),N.jsx("input",{type:"password",placeholder:"Password",className:"bg-neutral w-full px-6 py-3 rounded-2xl focus:outline-none focus:ring-1 focus:ring-info",value:_,onChange:j=>g(j.target.value)})]}),N.jsxs("div",{className:"flex justify-between items-center mt-4 mx-8",children:[N.jsxs("label",{className:"flex items-center",children:[N.jsx("input",{type:"checkbox",className:"form-checkbox"}),N.jsx("span",{className:"ml-2",children:"Remember Me"})]}),N.jsx("a",{href:"#",className:"text-sm text-indigo-500 hover:underline",children:"Forget Password"})]}),N.jsx("div",{className:"space-y-4 mx-8 mt-2",children:N.jsx("button",{type:"submit",className:"w-full bg-info text-white py-2 px-4 rounded-full mt-6 hover:bg-info-600",children:"Login"})})]}),N.jsxs("div",{className:"space-y-4 mx-8 mt-6 text-center",children:["Don't have an account?","  ",N.jsx("button",{className:"text-blue-500",onClick:()=>o(!1),children:"Sign Up"})]})]})},xee=({setShowLogin:o})=>{const[s,d]=ve.useState(""),[h,_]=ve.useState(""),[g,C]=ve.useState(""),[A,P]=ve.useState(""),[M,V]=ve.useState(null),j=To(),G=z=>{localStorage.setItem("user-data",JSON.stringify(z)),j("/user-home",{state:{userData:z}})},Z=async z=>{if(z.preventDefault(),g!==A){V("Passwords do not match");return}try{const $=await fetch(`${ac.API_BASE_URL}/api/v1/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:{username:s,email:h,password:g,password_confirmation:A}})}),pe=await $.json();$.ok?console.log("User created successfully:",pe):V(pe.errors||"An error occurred")}catch($){console.error("Error:",$),V("Sign up failed. Please try again.")}try{const $=await fetch(`${ac.API_BASE_URL}/api/v1/sessions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:s,email:h,password:g})}),pe=await $.json();console.log(pe),$.ok?(console.log(pe),G(pe)):V(pe.message)}catch{V("Login from new account failed. Please try again.")}};return N.jsxs("div",{className:"font-ubuntu bg-base-100 w-full max-w-md rounded-lg p-6 py-6 justify-center",children:[N.jsx("button",{"aria-label":"close",className:"text-left mb-4",onClick:()=>o(!0),children:N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:N.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),N.jsx("div",{className:"flex justify-center mb-4",children:N.jsx("img",{src:"/others/crybaby.png",alt:"Illustration",className:"w-48 h-48"})}),N.jsx("h2",{className:"text-3xl font-bold text-primary text-center mb-3",children:"Sign Up"}),N.jsx("h3",{className:"text-md text-primary text-center mb-6",children:"Create an account"}),M&&N.jsx("p",{className:"text-red-500 text-center",children:M}),N.jsxs("form",{onSubmit:Z,className:"space-y-4 mx-8",children:[N.jsx("input",{type:"text",placeholder:"Username",className:"bg-neutral w-full px-6 py-3 rounded-2xl focus:outline-none focus:ring-1 focus:ring-info",value:s,onChange:z=>d(z.target.value)}),N.jsx("input",{type:"text",placeholder:"Email Address",className:"bg-neutral w-full px-6 py-3 rounded-2xl focus:outline-none focus:ring-1 focus:ring-info",value:h,onChange:z=>_(z.target.value)}),N.jsx("input",{type:"password",placeholder:"Password",className:"bg-neutral w-full px-6 py-3 rounded-2xl focus:outline-none focus:ring-1 focus:ring-info",value:g,onChange:z=>C(z.target.value)}),N.jsx("input",{type:"password",placeholder:"Confirm Password",className:"bg-neutral w-full px-6 py-3 rounded-2xl focus:outline-none focus:ring-1 focus:ring-info",value:A,onChange:z=>P(z.target.value)}),N.jsx("button",{type:"submit",className:"w-full bg-info text-white py-2 px-4 rounded mt-6 hover:bg-info-600 rounded-full",children:"Create Account"})]}),N.jsxs("p",{className:"mt-4 text-center",children:["Already a member?"," ",N.jsx("button",{className:"text-blue-500",onClick:()=>o(!0),children:"Log in"})]}),N.jsx("div",{className:"space-y-4 mx-8 mt-2",children:N.jsx("div",{className:"flex w-full flex-col border-opacity-50",children:N.jsx("div",{className:"divider",children:"OR"})})}),N.jsx("div",{className:"space-y-4 mx-8 mt-2",children:N.jsxs("button",{className:"w-full bg-blue-500 text-white text-center py-2 px-4 mb-4 btn no-animation",children:[N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"30",height:"30",viewBox:"0 0 30 30",children:N.jsx("path",{d:"M24,4H6C4.895,4,4,4.895,4,6v18c0,1.105,0.895,2,2,2h10v-9h-3v-3h3v-1.611C16,9.339,17.486,8,20.021,8 c1.214,0,1.856,0.09,2.16,0.131V11h-1.729C19.376,11,19,11.568,19,12.718V14h3.154l-0.428,3H19v9h5c1.105,0,2-0.895,2-2V6 C26,4.895,25.104,4,24,4z"})}),"Sign up with Facebook"]})})]})},LU=["Babies can swallow and breathe at the same time.","Babies are born with natural swimming abilities and can hold their breath.","A baby's head is 1/4th of its total length, but by the age of 25 will only be 1/8th of its total length.","Babies are born with 300 bones, but by adulthood the number is reduced to 206.","Babies are always born with blue eyes. The color of the eyes changes within a few weeks.","A baby's cry is unique to them, and can be identified by their mother","Babies are born with the ability to differentiate between different languages.","Babies can recognize the smell and voice of their mother at birth."],Uee=()=>{const o=To(),s=()=>{o("/")},[d,h]=ve.useState("");return ve.useEffect(()=>{const _=LU[Math.floor(Math.random()*LU.length)];h(_)},[]),N.jsx("div",{className:"flex justify-center h-screen",children:N.jsxs("div",{className:"p-8 max-w-sm mx-auto",children:[N.jsx("button",{className:"text-left mb-4",onClick:()=>s(),children:N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"h-6 w-6 text-gray-700",children:N.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),N.jsx("div",{className:"my-40",children:N.jsxs("div",{className:"text-center items-center",children:[N.jsx("img",{src:"/others/crybaby.gif",alt:"Loading",className:"mx-auto mb-4"}),N.jsx("h2",{className:"text-2xl font-bold mt-6",children:"Loading..."}),N.jsx("p",{className:"text-gray-500 mt-2",children:d})]})}),N.jsx("div",{className:"loader"}),N.jsx("style",{jsx:!0,children:`
        .loader {
          border: 4px solid rgba(255, 255, 255, 0.3);
          width: 40px;
          height: 40px;
          border-radius: 50%;
          border-top-color: #3498db;
          animation: spin 1s ease-in-out infinite;
          margin: auto;
        }

        @keyframes spin {
          to {
            transform: rotate(360deg);
          }
        }
      `})]})})},jee=()=>{const[o,s]=ve.useState(!0),[d,h]=ve.useState(!0);return ve.useEffect(()=>{const _=setTimeout(()=>{s(!1)},4e3);return()=>clearTimeout(_)},[]),N.jsx("div",{className:"flex items-center flex-col min-h-screen",children:o?N.jsx(Uee,{}):d?N.jsx(Mee,{setShowLogin:h}):N.jsx(xee,{setShowLogin:h})})};var O5={exports:{}};(function(o,s){(function(d,h){o.exports=h()})(R_,function(){function d(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in e)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(e)}var h=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof R_<"u"?R_:typeof self<"u"?self:{};function _(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var g=function(e){try{return!!e()}catch{return!0}},C=!g(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),A=C,P=Function.prototype,M=P.call,V=A&&P.bind.bind(M,M),j=A?V:function(e){return function(){return M.apply(e,arguments)}},G=j({}.isPrototypeOf),Z=function(e){return e&&e.Math==Math&&e},z=Z(typeof globalThis=="object"&&globalThis)||Z(typeof window=="object"&&window)||Z(typeof self=="object"&&self)||Z(typeof h=="object"&&h)||function(){return this}()||h||Function("return this")(),$=C,pe=Function.prototype,K=pe.apply,H=pe.call,Y=typeof Reflect=="object"&&Reflect.apply||($?H.bind(K):function(){return H.apply(K,arguments)}),ae=j,Ae=ae({}.toString),Le=ae("".slice),Pe=function(e){return Le(Ae(e),8,-1)},We=Pe,Jt=j,dt=function(e){if(We(e)==="Function")return Jt(e)},or=typeof document=="object"&&document.all,Cr={all:or,IS_HTMLDDA:or===void 0&&or!==void 0},Yn=Cr.all,je=Cr.IS_HTMLDDA?function(e){return typeof e=="function"||e===Yn}:function(e){return typeof e=="function"},nt={},Dt=!g(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),fe=C,ge=Function.prototype.call,De=fe?ge.bind(ge):function(){return ge.apply(ge,arguments)},Ke={},_t={}.propertyIsEnumerable,rn=Object.getOwnPropertyDescriptor,ni=rn&&!_t.call({1:2},1);Ke.f=ni?function(e){var t=rn(this,e);return!!t&&t.enumerable}:_t;var qn,Qo,pr=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},ta=g,E4=Pe,cg=Object,g4=j("".split),zp=ta(function(){return!cg("z").propertyIsEnumerable(0)})?function(e){return E4(e)=="String"?g4(e,""):cg(e)}:cg,Td=function(e){return e==null},S4=Td,T4=TypeError,vd=function(e){if(S4(e))throw T4("Can't call method on "+e);return e},v4=zp,y4=vd,na=function(e){return v4(y4(e))},BR=je,C4=Cr.all,ri=Cr.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:BR(e)||e===C4}:function(e){return typeof e=="object"?e!==null:BR(e)},vo={},dg=vo,lg=z,R4=je,WR=function(e){return R4(e)?e:void 0},Hr=function(e,t){return arguments.length<2?WR(dg[e])||WR(lg[e]):dg[e]&&dg[e][t]||lg[e]&&lg[e][t]},pc=typeof navigator<"u"&&String(navigator.userAgent)||"",GR=z,ug=pc,HR=GR.process,KR=GR.Deno,zR=HR&&HR.versions||KR&&KR.version,YR=zR&&zR.v8;YR&&(Qo=(qn=YR.split("."))[0]>0&&qn[0]<4?1:+(qn[0]+qn[1])),!Qo&&ug&&(!(qn=ug.match(/Edge\/(\d+)/))||qn[1]>=74)&&(qn=ug.match(/Chrome\/(\d+)/))&&(Qo=+qn[1]);var fc=Qo,qR=fc,w4=g,I4=z.String,yd=!!Object.getOwnPropertySymbols&&!w4(function(){var e=Symbol();return!I4(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&qR&&qR<41}),JR=yd&&!Symbol.sham&&typeof Symbol.iterator=="symbol",b4=Hr,A4=je,O4=G,N4=Object,vu=JR?function(e){return typeof e=="symbol"}:function(e){var t=b4("Symbol");return A4(t)&&O4(t.prototype,N4(e))},D4=String,Cd=function(e){try{return D4(e)}catch{return"Object"}},P4=je,L4=Cd,k4=TypeError,Bi=function(e){if(P4(e))return e;throw k4(L4(e)+" is not a function")},M4=Bi,x4=Td,Yp=function(e,t){var n=e[t];return x4(n)?void 0:M4(n)},XR=De,QR=je,ZR=ri,U4=TypeError,$R={exports:{}},ew=z,j4=Object.defineProperty,V4=function(e,t){try{j4(ew,e,{value:t,configurable:!0,writable:!0})}catch{ew[e]=t}return t},tw="__core-js_shared__",hg=z[tw]||V4(tw,{}),nw=hg;($R.exports=function(e,t){return nw[e]||(nw[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Rd=$R.exports,F4=vd,B4=Object,Zo=function(e){return B4(F4(e))},W4=Zo,G4=j({}.hasOwnProperty),Jn=Object.hasOwn||function(e,t){return G4(W4(e),t)},H4=j,K4=0,z4=Math.random(),Y4=H4(1 .toString),pg=function(e){return"Symbol("+(e===void 0?"":e)+")_"+Y4(++K4+z4,36)},q4=Rd,rw=Jn,J4=pg,X4=yd,Q4=JR,wd=z.Symbol,fg=q4("wks"),Z4=Q4?wd.for||wd:wd&&wd.withoutSetter||J4,on=function(e){return rw(fg,e)||(fg[e]=X4&&rw(wd,e)?wd[e]:Z4("Symbol."+e)),fg[e]},$4=De,iw=ri,ow=vu,e3=Yp,t3=function(e,t){var n,r;if(QR(n=e.toString)&&!ZR(r=XR(n,e))||QR(n=e.valueOf)&&!ZR(r=XR(n,e)))return r;throw U4("Can't convert object to primitive value")},n3=TypeError,r3=on("toPrimitive"),i3=function(e,t){if(!iw(e)||ow(e))return e;var n,r=e3(e,r3);if(r){if(n=$4(r,e,t),!iw(n)||ow(n))return n;throw n3("Can't convert object to primitive value")}return t3(e)},o3=vu,qp=function(e){var t=i3(e,"string");return o3(t)?t:t+""},sw=ri,mg=z.document,s3=sw(mg)&&sw(mg.createElement),_g=function(e){return s3?mg.createElement(e):{}},a3=_g,aw=!Dt&&!g(function(){return Object.defineProperty(a3("div"),"a",{get:function(){return 7}}).a!=7}),c3=Dt,d3=De,l3=Ke,u3=pr,h3=na,p3=qp,f3=Jn,m3=aw,cw=Object.getOwnPropertyDescriptor;nt.f=c3?cw:function(e,t){if(e=h3(e),t=p3(t),m3)try{return cw(e,t)}catch{}if(f3(e,t))return u3(!d3(l3.f,e,t),e[t])};var _3=g,E3=je,g3=/#|\.prototype\./,yu=function(e,t){var n=T3[S3(e)];return n==y3||n!=v3&&(E3(t)?_3(t):!!t)},S3=yu.normalize=function(e){return String(e).replace(g3,".").toLowerCase()},T3=yu.data={},v3=yu.NATIVE="N",y3=yu.POLYFILL="P",dw=yu,C3=Bi,R3=C,w3=dt(dt.bind),ra=function(e,t){return C3(e),t===void 0?e:R3?w3(e,t):function(){return e.apply(t,arguments)}},Wi={},lw=Dt&&g(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),I3=ri,b3=String,A3=TypeError,Dr=function(e){if(I3(e))return e;throw A3(b3(e)+" is not an object")},O3=Dt,N3=aw,D3=lw,Jp=Dr,uw=qp,P3=TypeError,Eg=Object.defineProperty,L3=Object.getOwnPropertyDescriptor,gg="enumerable",Sg="configurable",Tg="writable";Wi.f=O3?D3?function(e,t,n){if(Jp(e),t=uw(t),Jp(n),typeof e=="function"&&t==="prototype"&&"value"in n&&Tg in n&&!n[Tg]){var r=L3(e,t);r&&r[Tg]&&(e[t]=n.value,n={configurable:Sg in n?n[Sg]:r[Sg],enumerable:gg in n?n[gg]:r[gg],writable:!1})}return Eg(e,t,n)}:Eg:function(e,t,n){if(Jp(e),t=uw(t),Jp(n),N3)try{return Eg(e,t,n)}catch{}if("get"in n||"set"in n)throw P3("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var k3=Wi,M3=pr,ia=Dt?function(e,t,n){return k3.f(e,t,M3(1,n))}:function(e,t,n){return e[t]=n,e},Xp=z,x3=Y,U3=dt,j3=je,V3=nt.f,F3=dw,Id=vo,B3=ra,bd=ia,hw=Jn,W3=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return x3(e,this,arguments)};return t.prototype=e.prototype,t},bt=function(e,t){var n,r,i,a,c,l,u,p,f,m=e.target,E=e.global,S=e.stat,I=e.proto,v=E?Xp:S?Xp[m]:(Xp[m]||{}).prototype,y=E?Id:Id[m]||bd(Id,m,{})[m],b=y.prototype;for(a in t)r=!(n=F3(E?a:m+(S?".":"#")+a,e.forced))&&v&&hw(v,a),l=y[a],r&&(u=e.dontCallGetSet?(f=V3(v,a))&&f.value:v[a]),c=r&&u?u:t[a],r&&typeof l==typeof c||(p=e.bind&&r?B3(c,Xp):e.wrap&&r?W3(c):I&&j3(c)?U3(c):c,(e.sham||c&&c.sham||l&&l.sham)&&bd(p,"sham",!0),bd(y,a,p),I&&(hw(Id,i=m+"Prototype")||bd(Id,i,{}),bd(Id[i],a,c),e.real&&b&&(n||!b[a])&&bd(b,a,c)))},G3=Math.ceil,H3=Math.floor,K3=Math.trunc||function(e){var t=+e;return(t>0?H3:G3)(t)},z3=K3,vg=function(e){var t=+e;return t!=t||t===0?0:z3(t)},Y3=vg,q3=Math.max,J3=Math.min,yg=function(e,t){var n=Y3(e);return n<0?q3(n+t,0):J3(n,t)},X3=vg,Q3=Math.min,pw=function(e){return e>0?Q3(X3(e),9007199254740991):0},Z3=pw,bs=function(e){return Z3(e.length)},$3=na,eF=yg,tF=bs,fw=function(e){return function(t,n,r){var i,a=$3(t),c=tF(a),l=eF(r,c);if(e&&n!=n){for(;c>l;)if((i=a[l++])!=i)return!0}else for(;c>l;l++)if((e||l in a)&&a[l]===n)return e||l||0;return!e&&-1}},Cg={includes:fw(!0),indexOf:fw(!1)},nF=Cg.includes;bt({target:"Array",proto:!0,forced:g(function(){return!Array(1).includes()})},{includes:function(e){return nF(this,e,arguments.length>1?arguments[1]:void 0)}});var rF=vo,Gi=function(e){return rF[e+"Prototype"]},iF=Gi("Array").includes,oF=ri,sF=Pe,aF=on("match"),mw=function(e){var t;return oF(e)&&((t=e[aF])!==void 0?!!t:sF(e)=="RegExp")},cF=mw,dF=TypeError,_w={};_w[on("toStringTag")]="z";var Rg=String(_w)==="[object z]",lF=Rg,uF=je,Qp=Pe,hF=on("toStringTag"),pF=Object,fF=Qp(function(){return arguments}())=="Arguments",$o=lF?Qp:function(e){var t,n,r;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(i,a){try{return i[a]}catch{}}(t=pF(e),hF))=="string"?n:fF?Qp(t):(r=Qp(t))=="Object"&&uF(t.callee)?"Arguments":r},mF=$o,_F=String,Ci=function(e){if(mF(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return _F(e)},EF=on("match"),gF=bt,SF=function(e){if(cF(e))throw dF("The method doesn't accept regular expressions");return e},TF=vd,Ew=Ci,vF=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[EF]=!1,"/./"[e](t)}catch{}}return!1},yF=j("".indexOf);gF({target:"String",proto:!0,forced:!vF("includes")},{includes:function(e){return!!~yF(Ew(TF(this)),Ew(SF(e)),arguments.length>1?arguments[1]:void 0)}});var CF=Gi("String").includes,gw=G,RF=iF,wF=CF,wg=Array.prototype,Ig=String.prototype,IF=function(e){var t=e.includes;return e===wg||gw(wg,e)&&t===wg.includes?RF:typeof e=="string"||e===Ig||gw(Ig,e)&&t===Ig.includes?wF:t},ue=_(IF),bF=Bi,AF=Zo,OF=zp,NF=bs,DF=TypeError,Sw=function(e){return function(t,n,r,i){bF(n);var a=AF(t),c=OF(a),l=NF(a),u=e?l-1:0,p=e?-1:1;if(r<2)for(;;){if(u in c){i=c[u],u+=p;break}if(u+=p,e?u<0:l<=u)throw DF("Reduce of empty array with no initial value")}for(;e?u>=0:l>u;u+=p)u in c&&(i=n(i,c[u],u,a));return i}},PF={left:Sw(!1),right:Sw(!0)},LF=g,Zp=function(e,t){var n=[][e];return!!n&&LF(function(){n.call(null,t||function(){return 1},1)})},Cu=typeof process<"u"&&Pe(process)=="process",kF=PF.left;bt({target:"Array",proto:!0,forced:!Cu&&fc>79&&fc<83||!Zp("reduce")},{reduce:function(e){var t=arguments.length;return kF(this,e,t,t>1?arguments[1]:void 0)}});var MF=Gi("Array").reduce,xF=G,UF=MF,bg=Array.prototype,jF=function(e){var t=e.reduce;return e===bg||xF(bg,e)&&t===bg.reduce?UF:t},Tw=jF,yo=_(Tw);let vw=!0,yw=!0;function $p(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function mc(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(c,l){if(c!==t)return i.apply(this,arguments);const u=p=>{const f=n(p);f&&(l.handleEvent?l.handleEvent(f):l(f))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(l,u),i.apply(this,[c,u])};const a=r.removeEventListener;r.removeEventListener=function(c,l){if(c!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(l))return a.apply(this,arguments);const u=this._eventMap[t].get(l);return this._eventMap[t].delete(l),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[c,u])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(c){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),c&&this.addEventListener(t,this["_on"+t]=c)},enumerable:!0,configurable:!0})}function VF(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(vw=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function FF(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(yw=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Cw(){if(typeof window=="object"){if(vw)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Ag(e,t){yw&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Rw(e){return Object.prototype.toString.call(e)==="[object Object]"}function ww(e){var t;return Rw(e)?yo(t=Object.keys(e)).call(t,function(n,r){const i=Rw(e[r]),a=i?ww(e[r]):e[r],c=i&&!Object.keys(a).length;return a===void 0||c?n:Object.assign(n,{[r]:a})},{}):e}function Og(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?Og(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(i=>{Og(e,e.get(i),n)})}))}function Iw(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const a=[];return e.forEach(c=>{c.type==="track"&&c.trackIdentifier===t.id&&a.push(c)}),a.forEach(c=>{e.forEach(l=>{l.type===r&&l.trackId===c.id&&Og(e,l,i)})}),i}var BF=pg,bw=Rd("keys"),ef=function(e){return bw[e]||(bw[e]=BF(e))},WF=!g(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),GF=Jn,HF=je,KF=Zo,zF=WF,Aw=ef("IE_PROTO"),Ng=Object,YF=Ng.prototype,Dg=zF?Ng.getPrototypeOf:function(e){var t=KF(e);if(GF(t,Aw))return t[Aw];var n=t.constructor;return HF(n)&&t instanceof n?n.prototype:t instanceof Ng?YF:null},qF=j,JF=Bi,XF=je,QF=String,ZF=TypeError,$F=function(e,t,n){try{return qF(JF(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},eB=Dr,tB=function(e){if(typeof e=="object"||XF(e))return e;throw ZF("Can't set "+QF(e)+" as a prototype")},nB=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=$F(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(r,i){return eB(r),tB(i),t?e(r,i):r.__proto__=i,r}}():void 0),tf={},nf={},Pg=Jn,rB=na,iB=Cg.indexOf,oB=nf,Ow=j([].push),Nw=function(e,t){var n,r=rB(e),i=0,a=[];for(n in r)!Pg(oB,n)&&Pg(r,n)&&Ow(a,n);for(;t.length>i;)Pg(r,n=t[i++])&&(~iB(a,n)||Ow(a,n));return a},Lg=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],sB=Nw,aB=Lg.concat("length","prototype");tf.f=Object.getOwnPropertyNames||function(e){return sB(e,aB)};var Ru={};Ru.f=Object.getOwnPropertySymbols;var cB=Hr,dB=tf,lB=Ru,uB=Dr,hB=j([].concat),pB=cB("Reflect","ownKeys")||function(e){var t=dB.f(uB(e)),n=lB.f;return n?hB(t,n(e)):t},Dw=Jn,fB=pB,mB=nt,_B=Wi,kg={},EB=Nw,gB=Lg,rf=Object.keys||function(e){return EB(e,gB)},SB=Dt,TB=lw,vB=Wi,yB=Dr,CB=na,RB=rf;kg.f=SB&&!TB?Object.defineProperties:function(e,t){yB(e);for(var n,r=CB(t),i=RB(t),a=i.length,c=0;a>c;)vB.f(e,n=i[c++],r[n]);return e};var of,Pw=Hr("document","documentElement"),wB=Dr,IB=kg,Lw=Lg,bB=nf,AB=Pw,OB=_g,Mg="prototype",xg="script",kw=ef("IE_PROTO"),Ug=function(){},Mw=function(e){return"<"+xg+">"+e+"</"+xg+">"},xw=function(e){e.write(Mw("")),e.close();var t=e.parentWindow.Object;return e=null,t},sf=function(){try{of=new ActiveXObject("htmlfile")}catch{}var e,t,n;sf=typeof document<"u"?document.domain&&of?xw(of):(t=OB("iframe"),n="java"+xg+":",t.style.display="none",AB.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(Mw("document.F=Object")),e.close(),e.F):xw(of);for(var r=Lw.length;r--;)delete sf[Mg][Lw[r]];return sf()};bB[kw]=!0;var wu=Object.create||function(e,t){var n;return e!==null?(Ug[Mg]=wB(e),n=new Ug,Ug[Mg]=null,n[kw]=e):n=sf(),t===void 0?n:IB.f(n,t)},NB=ri,DB=ia,Uw=Error,PB=j("".replace),LB=String(Uw("zxcasd").stack),jw=/\n\s*at [^:]*:[^\n]*/,kB=jw.test(LB),MB=pr,xB=!g(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",MB(1,7)),e.stack!==7)}),UB=ia,jB=function(e,t){if(kB&&typeof e=="string"&&!Uw.prepareStackTrace)for(;t--;)e=PB(e,jw,"");return e},VB=xB,Vw=Error.captureStackTrace,_c={},FB=_c,BB=on("iterator"),WB=Array.prototype,Fw=function(e){return e!==void 0&&(FB.Array===e||WB[BB]===e)},GB=$o,Bw=Yp,HB=Td,KB=_c,zB=on("iterator"),af=function(e){if(!HB(e))return Bw(e,zB)||Bw(e,"@@iterator")||KB[GB(e)]},YB=De,qB=Bi,JB=Dr,XB=Cd,QB=af,ZB=TypeError,jg=function(e,t){var n=arguments.length<2?QB(e):t;if(qB(n))return JB(YB(n,e));throw ZB(XB(e)+" is not iterable")},$B=De,Ww=Dr,e6=Yp,Gw=function(e,t,n){var r,i;Ww(e);try{if(!(r=e6(e,"return"))){if(t==="throw")throw n;return n}r=$B(r,e)}catch(a){i=!0,r=a}if(t==="throw")throw n;if(i)throw r;return Ww(r),n},t6=ra,n6=De,r6=Dr,i6=Cd,o6=Fw,s6=bs,Hw=G,a6=jg,c6=af,Kw=Gw,d6=TypeError,cf=function(e,t){this.stopped=e,this.result=t},zw=cf.prototype,Iu=function(e,t,n){var r,i,a,c,l,u,p,f=n&&n.that,m=!(!n||!n.AS_ENTRIES),E=!(!n||!n.IS_RECORD),S=!(!n||!n.IS_ITERATOR),I=!(!n||!n.INTERRUPTED),v=t6(t,f),y=function(D){return r&&Kw(r,"normal",D),new cf(!0,D)},b=function(D){return m?(r6(D),I?v(D[0],D[1],y):v(D[0],D[1])):I?v(D,y):v(D)};if(E)r=e.iterator;else if(S)r=e;else{if(!(i=c6(e)))throw d6(i6(e)+" is not iterable");if(o6(i)){for(a=0,c=s6(e);c>a;a++)if((l=b(e[a]))&&Hw(zw,l))return l;return new cf(!1)}r=a6(e,i)}for(u=E?e.next:r.next;!(p=n6(u,r)).done;){try{l=b(p.value)}catch(D){Kw(r,"throw",D)}if(typeof l=="object"&&l&&Hw(zw,l))return l}return new cf(!1)},l6=Ci,u6=bt,h6=G,p6=Dg,df=nB,f6=function(e,t,n){for(var r=fB(t),i=_B.f,a=mB.f,c=0;c<r.length;c++){var l=r[c];Dw(e,l)||n&&Dw(n,l)||i(e,l,a(t,l))}},Yw=wu,Vg=ia,Fg=pr,m6=function(e,t){NB(t)&&"cause"in t&&DB(e,"cause",t.cause)},_6=function(e,t,n,r){VB&&(Vw?Vw(e,t):UB(e,"stack",jB(n,r)))},E6=Iu,g6=function(e,t){return e===void 0?arguments.length<2?"":t:l6(e)},S6=on("toStringTag"),lf=Error,T6=[].push,Ad=function(e,t){var n,r=h6(Bg,this);df?n=df(lf(),r?p6(this):Bg):(n=r?this:Yw(Bg),Vg(n,S6,"Error")),t!==void 0&&Vg(n,"message",g6(t)),_6(n,Ad,n.stack,1),arguments.length>2&&m6(n,arguments[2]);var i=[];return E6(e,T6,{that:i}),Vg(n,"errors",i),n};df?df(Ad,lf):f6(Ad,lf,{name:!0});var Bg=Ad.prototype=Yw(lf.prototype,{constructor:Fg(1,Ad),message:Fg(1,""),name:Fg(1,"AggregateError")});u6({global:!0,constructor:!0,arity:2},{AggregateError:Ad});var uf,bu,hf,v6=je,qw=z.WeakMap,y6=v6(qw)&&/native code/.test(String(qw)),Jw=z,C6=ri,R6=ia,Wg=Jn,Gg=hg,w6=ef,I6=nf,Xw="Object already initialized",Hg=Jw.TypeError,b6=Jw.WeakMap;if(y6||Gg.state){var es=Gg.state||(Gg.state=new b6);es.get=es.get,es.has=es.has,es.set=es.set,uf=function(e,t){if(es.has(e))throw Hg(Xw);return t.facade=e,es.set(e,t),t},bu=function(e){return es.get(e)||{}},hf=function(e){return es.has(e)}}else{var Od=w6("state");I6[Od]=!0,uf=function(e,t){if(Wg(e,Od))throw Hg(Xw);return t.facade=e,R6(e,Od,t),t},bu=function(e){return Wg(e,Od)?e[Od]:{}},hf=function(e){return Wg(e,Od)}}var Ec,Qw,Zw,gc={set:uf,get:bu,has:hf,enforce:function(e){return hf(e)?bu(e):uf(e,{})},getterFor:function(e){return function(t){var n;if(!C6(t)||(n=bu(t)).type!==e)throw Hg("Incompatible receiver, "+e+" required");return n}}},Kg=Dt,A6=Jn,$w=Function.prototype,O6=Kg&&Object.getOwnPropertyDescriptor,zg=A6($w,"name"),eI={EXISTS:zg,PROPER:zg&&(function(){}).name==="something",CONFIGURABLE:zg&&(!Kg||Kg&&O6($w,"name").configurable)},N6=ia,oa=function(e,t,n,r){return r&&r.enumerable?e[t]=n:N6(e,t,n),e},D6=g,P6=je,L6=ri,k6=wu,tI=Dg,M6=oa,Yg=on("iterator"),nI=!1;[].keys&&("next"in(Zw=[].keys())?(Qw=tI(tI(Zw)))!==Object.prototype&&(Ec=Qw):nI=!0);var x6=!L6(Ec)||D6(function(){var e={};return Ec[Yg].call(e)!==e});P6((Ec=x6?{}:k6(Ec))[Yg])||M6(Ec,Yg,function(){return this});var rI={IteratorPrototype:Ec,BUGGY_SAFARI_ITERATORS:nI},U6=$o,j6=Rg?{}.toString:function(){return"[object "+U6(this)+"]"},V6=Rg,F6=Wi.f,B6=ia,W6=Jn,G6=j6,iI=on("toStringTag"),sa=function(e,t,n,r){if(e){var i=n?e:e.prototype;W6(i,iI)||F6(i,iI,{configurable:!0,value:t}),r&&!V6&&B6(i,"toString",G6)}},H6=rI.IteratorPrototype,K6=wu,z6=pr,Y6=sa,q6=_c,J6=function(){return this},qg=function(e,t,n,r){var i=t+" Iterator";return e.prototype=K6(H6,{next:z6(+!r,n)}),Y6(e,i,!1,!0),q6[i]=J6,e},X6=bt,Q6=De,Z6=eI,$6=qg,e8=Dg,t8=sa,oI=oa,sI=_c,n8=rI,r8=Z6.PROPER,pf=n8.BUGGY_SAFARI_ITERATORS,Jg=on("iterator"),aI="keys",ff="values",cI="entries",i8=function(){return this},dI=function(e,t,n,r,i,a,c){$6(n,t,r);var l,u,p,f=function(b){if(b===i&&v)return v;if(!pf&&b in S)return S[b];switch(b){case aI:case ff:case cI:return function(){return new n(this,b)}}return function(){return new n(this)}},m=t+" Iterator",E=!1,S=e.prototype,I=S[Jg]||S["@@iterator"]||i&&S[i],v=!pf&&I||f(i),y=t=="Array"&&S.entries||I;if(y&&(l=e8(y.call(new e)))!==Object.prototype&&l.next&&(t8(l,m,!0,!0),sI[m]=i8),r8&&i==ff&&I&&I.name!==ff&&(E=!0,v=function(){return Q6(I,this)}),i)if(u={values:f(ff),keys:a?v:f(aI),entries:f(cI)},c)for(p in u)(pf||E||!(p in S))&&oI(S,p,u[p]);else X6({target:t,proto:!0,forced:pf||E},u);return c&&S[Jg]!==v&&oI(S,Jg,v,{name:i}),sI[t]=v,u},Xg=function(e,t){return{value:e,done:t}},o8=na,lI=_c,uI=gc;Wi.f;var s8=dI,hI=Xg,pI="Array Iterator",a8=uI.set,c8=uI.getterFor(pI);s8(Array,"Array",function(e,t){a8(this,{type:pI,target:o8(e),index:0,kind:t})},function(){var e=c8(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,hI(void 0,!0)):hI(n=="keys"?r:n=="values"?t[r]:[r,t[r]],!1)},"values"),lI.Arguments=lI.Array;var d8=Wi,mf=function(e,t,n){return d8.f(e,t,n)},l8=Hr,u8=mf,h8=Dt,fI=on("species"),p8=G,f8=TypeError,Qg=function(e,t){if(p8(t,e))return e;throw f8("Incorrect invocation")},m8=je,Zg=hg,_8=j(Function.toString);m8(Zg.inspectSource)||(Zg.inspectSource=function(e){return _8(e)});var mI=Zg.inspectSource,E8=j,g8=g,_I=je,S8=$o,T8=mI,EI=function(){},v8=[],gI=Hr("Reflect","construct"),$g=/^\s*(?:class|function)\b/,y8=E8($g.exec),C8=!$g.exec(EI),Au=function(e){if(!_I(e))return!1;try{return gI(EI,v8,e),!0}catch{return!1}},SI=function(e){if(!_I(e))return!1;switch(S8(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return C8||!!y8($g,T8(e))}catch{return!0}};SI.sham=!0;var Ou,Nd,TI,eS,_f=!gI||g8(function(){var e;return Au(Au.call)||!Au(Object)||!Au(function(){e=!0})||e})?SI:Au,R8=_f,w8=Cd,I8=TypeError,vI=Dr,b8=function(e){if(R8(e))return e;throw I8(w8(e)+" is not a constructor")},A8=Td,O8=on("species"),tS=function(e,t){var n,r=vI(e).constructor;return r===void 0||A8(n=vI(r)[O8])?t:b8(n)},nS=j([].slice),N8=TypeError,Ef=function(e,t){if(e<t)throw N8("Not enough arguments");return e},yI=/(?:ipad|iphone|ipod).*applewebkit/i.test(pc),Ri=z,D8=Y,P8=ra,CI=je,L8=Jn,RI=g,wI=Pw,k8=nS,II=_g,M8=Ef,x8=yI,U8=Cu,rS=Ri.setImmediate,iS=Ri.clearImmediate,j8=Ri.process,oS=Ri.Dispatch,V8=Ri.Function,bI=Ri.MessageChannel,F8=Ri.String,sS=0,Nu={},AI="onreadystatechange";RI(function(){Ou=Ri.location});var aS=function(e){if(L8(Nu,e)){var t=Nu[e];delete Nu[e],t()}},cS=function(e){return function(){aS(e)}},OI=function(e){aS(e.data)},NI=function(e){Ri.postMessage(F8(e),Ou.protocol+"//"+Ou.host)};rS&&iS||(rS=function(e){M8(arguments.length,1);var t=CI(e)?e:V8(e),n=k8(arguments,1);return Nu[++sS]=function(){D8(t,void 0,n)},Nd(sS),sS},iS=function(e){delete Nu[e]},U8?Nd=function(e){j8.nextTick(cS(e))}:oS&&oS.now?Nd=function(e){oS.now(cS(e))}:bI&&!x8?(eS=(TI=new bI).port2,TI.port1.onmessage=OI,Nd=P8(eS.postMessage,eS)):Ri.addEventListener&&CI(Ri.postMessage)&&!Ri.importScripts&&Ou&&Ou.protocol!=="file:"&&!RI(NI)?(Nd=NI,Ri.addEventListener("message",OI,!1)):Nd=AI in II("script")?function(e){wI.appendChild(II("script"))[AI]=function(){wI.removeChild(this),aS(e)}}:function(e){setTimeout(cS(e),0)});var DI={set:rS,clear:iS},PI=function(){this.head=null,this.tail=null};PI.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Dd,dS,lS,uS,LI,kI=PI,B8=/ipad|iphone|ipod/i.test(pc)&&typeof Pebble<"u",W8=/web0s(?!.*chrome)/i.test(pc),Sc=z,MI=ra,G8=nt.f,hS=DI.set,H8=kI,K8=yI,z8=B8,Y8=W8,pS=Cu,xI=Sc.MutationObserver||Sc.WebKitMutationObserver,UI=Sc.document,jI=Sc.process,gf=Sc.Promise,VI=G8(Sc,"queueMicrotask"),fS=VI&&VI.value;if(!fS){var Sf=new H8,Tf=function(){var e,t;for(pS&&(e=jI.domain)&&e.exit();t=Sf.get();)try{t()}catch(n){throw Sf.head&&Dd(),n}e&&e.enter()};K8||pS||Y8||!xI||!UI?!z8&&gf&&gf.resolve?((uS=gf.resolve(void 0)).constructor=gf,LI=MI(uS.then,uS),Dd=function(){LI(Tf)}):pS?Dd=function(){jI.nextTick(Tf)}:(hS=MI(hS,Sc),Dd=function(){hS(Tf)}):(dS=!0,lS=UI.createTextNode(""),new xI(Tf).observe(lS,{characterData:!0}),Dd=function(){lS.data=dS=!dS}),fS=function(e){Sf.head||Dd(),Sf.add(e)}}var q8=fS,Pd=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Tc=z.Promise,FI=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",J8=!FI&&!Cu&&typeof window=="object"&&typeof document=="object",X8=z,Du=Tc,Q8=je,Z8=dw,$8=mI,eW=on,tW=J8,nW=FI,mS=fc,BI=Du&&Du.prototype,rW=eW("species"),WI=!1,GI=Q8(X8.PromiseRejectionEvent),iW=Z8("Promise",function(){var e=$8(Du),t=e!==String(Du);if(!t&&mS===66||!BI.catch||!BI.finally)return!0;if(!mS||mS<51||!/native code/.test(e)){var n=new Du(function(i){i(1)}),r=function(i){i(function(){},function(){})};if((n.constructor={})[rW]=r,!(WI=n.then(function(){})instanceof r))return!0}return!t&&(tW||nW)&&!GI}),Pu={CONSTRUCTOR:iW,REJECTION_EVENT:GI,SUBCLASSING:WI},ts={},HI=Bi,oW=TypeError,sW=function(e){var t,n;this.promise=new e(function(r,i){if(t!==void 0||n!==void 0)throw oW("Bad Promise constructor");t=r,n=i}),this.resolve=HI(t),this.reject=HI(n)};ts.f=function(e){return new sW(e)};var _S,KI,aW=bt,vf=Cu,aa=z,Lu=De,cW=oa,dW=sa,lW=function(e){var t=l8(e);h8&&t&&!t[fI]&&u8(t,fI,{configurable:!0,get:function(){return this}})},uW=Bi,ES=je,hW=ri,pW=Qg,fW=tS,zI=DI.set,gS=q8,mW=function(e,t){try{arguments.length==1?console.error(e):console.error(e,t)}catch{}},_W=Pd,EW=kI,YI=gc,SS=Tc,qI=Pu,JI=ts,yf="Promise",XI=qI.CONSTRUCTOR,gW=qI.REJECTION_EVENT,TS=YI.getterFor(yf),SW=YI.set,TW=SS&&SS.prototype,ku=SS,vS=TW,QI=aa.TypeError,yS=aa.document,CS=aa.process,RS=JI.f,vW=RS,yW=!!(yS&&yS.createEvent&&aa.dispatchEvent),ZI="unhandledrejection",$I=function(e){var t;return!(!hW(e)||!ES(t=e.then))&&t},eb=function(e,t){var n,r,i,a=t.value,c=t.state==1,l=c?e.ok:e.fail,u=e.resolve,p=e.reject,f=e.domain;try{l?(c||(t.rejection===2&&RW(t),t.rejection=1),l===!0?n=a:(f&&f.enter(),n=l(a),f&&(f.exit(),i=!0)),n===e.promise?p(QI("Promise-chain cycle")):(r=$I(n))?Lu(r,n,u,p):u(n)):p(a)}catch(m){f&&!i&&f.exit(),p(m)}},tb=function(e,t){e.notified||(e.notified=!0,gS(function(){for(var n,r=e.reactions;n=r.get();)eb(n,e);e.notified=!1,t&&!e.rejection&&CW(e)}))},nb=function(e,t,n){var r,i;yW?((r=yS.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),aa.dispatchEvent(r)):r={promise:t,reason:n},!gW&&(i=aa["on"+e])?i(r):e===ZI&&mW("Unhandled promise rejection",n)},CW=function(e){Lu(zI,aa,function(){var t,n=e.facade,r=e.value;if(rb(e)&&(t=_W(function(){vf?CS.emit("unhandledRejection",r,n):nb(ZI,n,r)}),e.rejection=vf||rb(e)?2:1,t.error))throw t.value})},rb=function(e){return e.rejection!==1&&!e.parent},RW=function(e){Lu(zI,aa,function(){var t=e.facade;vf?CS.emit("rejectionHandled",t):nb("rejectionhandled",t,e.value)})},Ld=function(e,t,n){return function(r){e(t,r,n)}},kd=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,tb(e,!0))},wS=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw QI("Promise can't be resolved itself");var r=$I(t);r?gS(function(){var i={done:!1};try{Lu(r,t,Ld(wS,i,e),Ld(kd,i,e))}catch(a){kd(i,a,e)}}):(e.value=t,e.state=1,tb(e,!1))}catch(i){kd({done:!1},i,e)}}};XI&&(vS=(ku=function(e){pW(this,vS),uW(e),Lu(_S,this);var t=TS(this);try{e(Ld(wS,t),Ld(kd,t))}catch(n){kd(t,n)}}).prototype,(_S=function(e){SW(this,{type:yf,done:!1,notified:!1,parent:!1,reactions:new EW,rejection:!1,state:0,value:void 0})}).prototype=cW(vS,"then",function(e,t){var n=TS(this),r=RS(fW(this,ku));return n.parent=!0,r.ok=!ES(e)||e,r.fail=ES(t)&&t,r.domain=vf?CS.domain:void 0,n.state==0?n.reactions.add(r):gS(function(){eb(r,n)}),r.promise}),KI=function(){var e=new _S,t=TS(e);this.promise=e,this.resolve=Ld(wS,t),this.reject=Ld(kd,t)},JI.f=RS=function(e){return e===ku||e===void 0?new KI(e):vW(e)}),aW({global:!0,constructor:!0,wrap:!0,forced:XI},{Promise:ku}),dW(ku,yf,!1,!0),lW(yf);var ib=on("iterator"),ob=!1;try{var wW=0,sb={next:function(){return{done:!!wW++}},return:function(){ob=!0}};sb[ib]=function(){return this},Array.from(sb,function(){throw 2})}catch{}var IW=Tc,bW=function(e,t){if(!ob)return!1;var n=!1;try{var r={};r[ib]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch{}return n},Cf=Pu.CONSTRUCTOR||!bW(function(e){IW.all(e).then(void 0,function(){})}),AW=De,OW=Bi,NW=ts,DW=Pd,PW=Iu;bt({target:"Promise",stat:!0,forced:Cf},{all:function(e){var t=this,n=NW.f(t),r=n.resolve,i=n.reject,a=DW(function(){var c=OW(t.resolve),l=[],u=0,p=1;PW(e,function(f){var m=u++,E=!1;p++,AW(c,t,f).then(function(S){E||(E=!0,l[m]=S,--p||r(l))},i)}),--p||r(l)});return a.error&&i(a.value),n.promise}});var LW=bt,kW=Pu.CONSTRUCTOR;Tc&&Tc.prototype,LW({target:"Promise",proto:!0,forced:kW,real:!0},{catch:function(e){return this.then(void 0,e)}});var MW=De,xW=Bi,UW=ts,jW=Pd,VW=Iu;bt({target:"Promise",stat:!0,forced:Cf},{race:function(e){var t=this,n=UW.f(t),r=n.reject,i=jW(function(){var a=xW(t.resolve);VW(e,function(c){MW(a,t,c).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}});var FW=De,BW=ts;bt({target:"Promise",stat:!0,forced:Pu.CONSTRUCTOR},{reject:function(e){var t=BW.f(this);return FW(t.reject,void 0,e),t.promise}});var WW=Dr,GW=ri,HW=ts,ab=function(e,t){if(WW(e),GW(t)&&t.constructor===e)return t;var n=HW.f(e);return(0,n.resolve)(t),n.promise},KW=bt,zW=Tc,YW=Pu.CONSTRUCTOR,qW=ab,JW=Hr("Promise"),XW=!YW;KW({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return qW(XW&&this===JW?zW:this,e)}});var QW=De,ZW=Bi,$W=ts,e7=Pd,t7=Iu;bt({target:"Promise",stat:!0,forced:Cf},{allSettled:function(e){var t=this,n=$W.f(t),r=n.resolve,i=n.reject,a=e7(function(){var c=ZW(t.resolve),l=[],u=0,p=1;t7(e,function(f){var m=u++,E=!1;p++,QW(c,t,f).then(function(S){E||(E=!0,l[m]={status:"fulfilled",value:S},--p||r(l))},function(S){E||(E=!0,l[m]={status:"rejected",reason:S},--p||r(l))})}),--p||r(l)});return a.error&&i(a.value),n.promise}});var n7=De,r7=Bi,i7=Hr,o7=ts,s7=Pd,a7=Iu,cb="No one promise resolved";bt({target:"Promise",stat:!0,forced:Cf},{any:function(e){var t=this,n=i7("AggregateError"),r=o7.f(t),i=r.resolve,a=r.reject,c=s7(function(){var l=r7(t.resolve),u=[],p=0,f=1,m=!1;a7(e,function(E){var S=p++,I=!1;f++,n7(l,t,E).then(function(v){I||m||(m=!0,i(v))},function(v){I||m||(I=!0,u[S]=v,--f||a(new n(u,cb)))})}),--f||a(new n(u,cb))});return c.error&&a(c.value),r.promise}});var c7=bt,IS=Tc,d7=g,l7=Hr,u7=je,h7=tS,db=ab,p7=IS&&IS.prototype;c7({target:"Promise",proto:!0,real:!0,forced:!!IS&&d7(function(){p7.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=h7(this,l7("Promise")),n=u7(e);return this.then(n?function(r){return db(t,e()).then(function(){return r})}:e,n?function(r){return db(t,e()).then(function(){throw r})}:e)}});var bS=j,f7=vg,m7=Ci,_7=vd,E7=bS("".charAt),lb=bS("".charCodeAt),g7=bS("".slice),ub=function(e){return function(t,n){var r,i,a=m7(_7(t)),c=f7(n),l=a.length;return c<0||c>=l?e?"":void 0:(r=lb(a,c))<55296||r>56319||c+1===l||(i=lb(a,c+1))<56320||i>57343?e?E7(a,c):r:e?g7(a,c,c+2):i-56320+(r-55296<<10)+65536}},AS={codeAt:ub(!1),charAt:ub(!0)},S7=AS.charAt,T7=Ci,hb=gc,v7=dI,pb=Xg,fb="String Iterator",y7=hb.set,C7=hb.getterFor(fb);v7(String,"String",function(e){y7(this,{type:fb,string:T7(e),index:0})},function(){var e,t=C7(this),n=t.string,r=t.index;return r>=n.length?pb(void 0,!0):(e=S7(n,r),t.index+=e.length,pb(e,!1))});var R7=vo.Promise,w7={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},I7=z,b7=$o,A7=ia,mb=_c,_b=on("toStringTag");for(var OS in w7){var Eb=I7[OS],NS=Eb&&Eb.prototype;NS&&b7(NS)!==_b&&A7(NS,_b,OS),mb[OS]=mb.Array}var gb=R7,ce=_(gb);const Sb=Cw;function Tb(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const l={};return Object.keys(c).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const p=typeof c[u]=="object"?c[u]:{ideal:c[u]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const f=function(m,E){return m?m+E.charAt(0).toUpperCase()+E.slice(1):E==="deviceId"?"sourceId":E};if(p.ideal!==void 0){l.optional=l.optional||[];let m={};typeof p.ideal=="number"?(m[f("min",u)]=p.ideal,l.optional.push(m),m={},m[f("max",u)]=p.ideal,l.optional.push(m)):(m[f("",u)]=p.ideal,l.optional.push(m))}p.exact!==void 0&&typeof p.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[f("",u)]=p.exact):["min","max"].forEach(m=>{p[m]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[f(m,u)]=p[m])})}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},i=function(c,l){if(t.version>=61)return l(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){const u=function(p,f,m){f in p&&!(m in p)&&(p[m]=p[f],delete p[f])};u((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),u(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=r(c.audio)}if(c&&typeof c.video=="object"){let u=c.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const p=t.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||p)){let f;if(delete c.video.facingMode,u.exact==="environment"||u.ideal==="environment"?f=["back","rear"]:u.exact!=="user"&&u.ideal!=="user"||(f=["front"]),f)return n.mediaDevices.enumerateDevices().then(m=>{let E=(m=m.filter(S=>S.kind==="videoinput")).find(S=>f.some(I=>{var v;return ue(v=S.label.toLowerCase()).call(v,I)}));return!E&&m.length&&ue(f).call(f,"back")&&(E=m[m.length-1]),E&&(c.video.deviceId=u.exact?{exact:E.deviceId}:{ideal:E.deviceId}),c.video=r(c.video),Sb("chrome: "+JSON.stringify(c)),l(c)})}c.video=r(c.video)}return Sb("chrome: "+JSON.stringify(c)),l(c)},a=function(c){return t.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(c,l,u){i(c,p=>{n.webkitGetUserMedia(p,l,f=>{u&&u(a(f))})})}).bind(n),n.mediaDevices.getUserMedia){const c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return i(l,u=>c(u).then(p=>{if(u.audio&&!p.getAudioTracks().length||u.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return p},p=>ce.reject(a(p))))}}}function vb(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function yb(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===r.track.id):{track:r.track};const a=new Event("track");a.track=r.track,a.receiver=i,a.transceiver={receiver:i},a.streams=[n.stream],this.dispatchEvent(a)}),n.stream.getTracks().forEach(r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===r.id):{track:r};const a=new Event("track");a.track=r,a.receiver=i,a.transceiver={receiver:i},a.streams=[n.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else mc(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Cb(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=i.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,l){let u=i.apply(this,arguments);return u||(u=t(this,c),this._senders.push(u)),u};const a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){a.apply(this,arguments);const l=this._senders.indexOf(c);l!==-1&&this._senders.splice(l,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(a=>{this._senders.push(t(this,a))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(a=>{const c=this._senders.find(l=>l.track===a);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Rb(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,r,i]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const a=function(l){const u={};return l.result().forEach(p=>{const f={id:p.id,timestamp:p.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[p.type]||p.type};p.names().forEach(m=>{f[m]=p.stat(m)}),u[f.id]=f}),u},c=function(l){return new Map(Object.keys(l).map(u=>[u,l[u]]))};if(arguments.length>=2){const l=function(u){r(c(a(u)))};return t.apply(this,[l,n])}return new ce((l,u)=>{t.apply(this,[function(p){l(c(a(p)))},u])}).then(r,i)}}function wb(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(a=>a._pc=this),i});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(a=>Iw(a,i.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(i=>i._pc=this),r}),mc(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(i=>Iw(i,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let r,i,a;return this.getSenders().forEach(c=>{c.track===n&&(r?a=!0:r=c)}),this.getReceivers().forEach(c=>(c.track===n&&(i?a=!0:i=c),c.track===n)),a||r&&i?ce.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():ce.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Ib(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=t.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(l)===-1&&this._shimmedLocalStreams[c.id].push(l):this._shimmedLocalStreams[c.id]=[c,l],l};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(u=>{if(this.getSenders().find(f=>f.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(u=>c.indexOf(u)===-1);this._shimmedLocalStreams[a.id]=[a].concat(l)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const l=this._shimmedLocalStreams[c].indexOf(a);l!==-1&&this._shimmedLocalStreams[c].splice(l,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),i.apply(this,arguments)}}function bb(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Ib(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(p=>this._reverseStreams[p.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(p=>{if(this.getSenders().find(m=>m.track===p))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const p=new e.MediaStream(u.getTracks());this._streams[u.id]=p,this._reverseStreams[p.id]=u,u=p}r.apply(this,[u])};const i=e.RTCPeerConnection.prototype.removeStream;function a(u,p){let f=p.sdp;return Object.keys(u._reverseStreams||[]).forEach(m=>{const E=u._reverseStreams[m],S=u._streams[E.id];f=f.replace(new RegExp(S.id,"g"),E.id)}),new RTCSessionDescription({type:p.type,sdp:f})}e.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},e.RTCPeerConnection.prototype.addTrack=function(u,p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(S=>S===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(S=>S.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const E=this._streams[p.id];if(E)E.addTrack(u),ce.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const S=new e.MediaStream([u]);this._streams[p.id]=S,this._reverseStreams[S.id]=p,this.addStream(S)}return this.getSenders().find(S=>S.track===u)},["createOffer","createAnswer"].forEach(function(u){const p=e.RTCPeerConnection.prototype[u],f={[u](){const m=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[E=>{const S=a(this,E);m[0].apply(null,[S])},E=>{m[1]&&m[1].apply(null,E)},arguments[2]]):p.apply(this,arguments).then(E=>a(this,E))}};e.RTCPeerConnection.prototype[u]=f[u]});const c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(u,p){let f=p.sdp;return Object.keys(u._reverseStreams||[]).forEach(m=>{const E=u._reverseStreams[m],S=u._streams[E.id];f=f.replace(new RegExp(E.id,"g"),S.id)}),new RTCSessionDescription({type:p.type,sdp:f})}(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};const l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const u=l.get.apply(this);return u.type===""?u:a(this,u)}}),e.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(u._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let p;this._streams=this._streams||{},Object.keys(this._streams).forEach(f=>{this._streams[f].getTracks().find(m=>u.track===m)&&(p=this._streams[f])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function DS(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=e.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=i[n]})}function Ab(e,t){mc(e,"negotiationneeded",n=>{const r=n.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return n})}var Ob=Object.freeze({__proto__:null,fixNegotiationNeeded:Ab,shimAddTrackRemoveTrack:bb,shimAddTrackRemoveTrackWithNative:Ib,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(r=>{const i=n.video&&n.video.width,a=n.video&&n.video.height,c=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:c||3}},i&&(n.video.mandatory.maxWidth=i),a&&(n.video.mandatory.maxHeight=a),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Cb,shimGetStats:Rb,shimGetUserMedia:Tb,shimMediaStream:vb,shimOnTrack:yb,shimPeerConnection:DS,shimSenderReceiverGetStats:wb});function Nb(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(i,a,c){Ag("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(a,c)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(c,l,u){l in c&&!(u in c)&&(c[u]=c[l],delete c[l])},a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),i(c.audio,"autoGainControl","mozAutoGainControl"),i(c.audio,"noiseSuppression","mozNoiseSuppression")),a(c)},r&&r.prototype.getSettings){const c=r.prototype.getSettings;r.prototype.getSettings=function(){const l=c.apply(this,arguments);return i(l,"mozAutoGainControl","autoGainControl"),i(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){const c=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),i(l,"autoGainControl","mozAutoGainControl"),i(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function Db(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function PS(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const a=e.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=c[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,a,c]=arguments;return r.apply(this,[i||null]).then(l=>{if(t.version<53&&!a)try{l.forEach(u=>{u.type=n[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;l.forEach((p,f)=>{l.set(f,Object.assign({},p,{type:n[p.type]||p.type}))})}return l}).then(a,c)}}function Pb(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ce.resolve(new Map)}}function Lb(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n}),mc(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function kb(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){Ag("removeStream","removeTrack"),this.getSenders().forEach(n=>{var r;n.track&&ue(r=t.getTracks()).call(r,n.track)&&this.removeTrack(n)})})}function Mb(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function xb(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=t.apply(this,arguments);if(r){const{sender:a}=i,c=a.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n,a.sendEncodings=n,this.setParametersPromises.push(a.setParameters(c).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return i})}function Ub(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function jb(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ce.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Vb(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ce.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var Fb=Object.freeze({__proto__:null,shimAddTransceiver:xb,shimCreateAnswer:Vb,shimCreateOffer:jb,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,ce.reject(r)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:Ub,shimGetUserMedia:Nb,shimOnTrack:Db,shimPeerConnection:PS,shimRTCDataChannel:Mb,shimReceiverGetStats:Lb,shimRemoveStream:kb,shimSenderGetStats:Pb});function Bb(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var r;this._localStreams||(this._localStreams=[]),ue(r=this._localStreams).call(r,n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>t.call(this,i,n)),n.getVideoTracks().forEach(i=>t.call(this,i,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return i&&i.forEach(c=>{var l;this._localStreams?ue(l=this._localStreams).call(l,c)||this._localStreams.push(c):this._localStreams=[c]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const r=t.getTracks();this.getSenders().forEach(i=>{ue(r).call(r,i.track)&&this.removeTrack(i)})})}}function Wb(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{var a;if(this._remoteStreams||(this._remoteStreams=[]),ue(a=this._remoteStreams).call(a,i))return;this._remoteStreams.push(i);const c=new Event("addstream");c.stream=i,this.dispatchEvent(c)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(i=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(i)>=0)return;n._remoteStreams.push(i);const a=new Event("addstream");a.stream=i,n.dispatchEvent(a)})}),t.apply(n,arguments)}}}function Gb(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(u,p){const f=arguments.length>=2?arguments[2]:arguments[0],m=n.apply(this,[f]);return p?(m.then(u,p),ce.resolve()):m},t.createAnswer=function(u,p){const f=arguments.length>=2?arguments[2]:arguments[0],m=r.apply(this,[f]);return p?(m.then(u,p),ce.resolve()):m};let l=function(u,p,f){const m=i.apply(this,[u]);return f?(m.then(p,f),ce.resolve()):m};t.setLocalDescription=l,l=function(u,p,f){const m=a.apply(this,[u]);return f?(m.then(p,f),ce.resolve()):m},t.setRemoteDescription=l,l=function(u,p,f){const m=c.apply(this,[u]);return f?(m.then(p,f),ce.resolve()):m},t.addIceCandidate=l}function Hb(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=i=>r(Kb(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,r,i){t.mediaDevices.getUserMedia(n).then(r,i)}).bind(t))}function Kb(e){return e&&e.video!==void 0?Object.assign({},e,{video:ww(e.video)}):e}function zb(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const i=[];for(let a=0;a<n.iceServers.length;a++){let c=n.iceServers[a];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(Ag("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,i.push(c)):i.push(n.iceServers[a])}n.iceServers=i}return new t(n,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Yb(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function qb(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const i=this.getTransceivers().find(a=>a.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Jb(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Xb=Object.freeze({__proto__:null,shimAudioContext:Jb,shimCallbacksAPI:Gb,shimConstraints:Kb,shimCreateOfferLegacy:qb,shimGetUserMedia:Hb,shimLocalStreamsAPI:Bb,shimRTCIceServerUrls:zb,shimRemoteStreamsAPI:Wb,shimTrackEventTransceiver:Yb}),Qb=`	
\v\f\r                　\u2028\u2029\uFEFF`,O7=vd,N7=Ci,LS=Qb,Zb=j("".replace),D7=RegExp("^["+LS+"]+"),P7=RegExp("(^|[^"+LS+"])["+LS+"]+$"),kS=function(e){return function(t){var n=N7(O7(t));return 1&e&&(n=Zb(n,D7,"")),2&e&&(n=Zb(n,P7,"$1")),n}},L7={start:kS(1),end:kS(2),trim:kS(3)},k7=eI.PROPER,M7=g,$b=Qb,x7=L7.trim;bt({target:"String",proto:!0,forced:function(e){return M7(function(){return!!$b[e]()||"​᠎"[e]()!=="​᠎"||k7&&$b[e].name!==e})}("trim")},{trim:function(){return x7(this)}});var U7=Gi("String").trim,j7=G,V7=U7,MS=String.prototype,F7=function(e){var t=e.trim;return typeof e=="string"||e===MS||j7(MS,e)&&t===MS.trim?V7:t},sr=_(F7),eA={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(n){return n.split(`
m=`).map((r,i)=>(i>0?"m="+r:r).trim()+`\r
`)},t.getDescription=function(n){const r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){const r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter(i=>i.indexOf(r)===0)},t.parseCandidate=function(n){let r;r=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let a=8;a<r.length;a+=2)switch(r[a]){case"raddr":i.relatedAddress=r[a+1];break;case"rport":i.relatedPort=parseInt(r[a+1],10);break;case"tcptype":i.tcpType=r[a+1];break;case"ufrag":i.ufrag=r[a+1],i.usernameFragment=r[a+1];break;default:i[r[a]]===void 0&&(i[r[a]]=r[a+1])}return i},t.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const a=n.type;return r.push("typ"),r.push(a),a!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const r={};let i;const a=n.substring(n.indexOf(" ")+1).split(";");for(let c=0;c<a.length;c++)i=a[c].trim().split("="),r[i[0].trim()]=i[1];return r},t.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const a=[];Object.keys(n.parameters).forEach(c=>{n.parameters[c]!==void 0?a.push(c+"="+n.parameters[c]):a.push(c)}),r+="a=fmtp:"+i+" "+a.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(a=>{r+="a=rtcp-fb:"+i+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},a=n.indexOf(":",r);return a>-1?(i.attribute=n.substring(r+1,a),i.value=n.substring(a+1)):i.attribute=n.substring(r+1),i},t.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},t.getMid=function(n){const r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(a=>{i+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),i},t.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){const i=t.matchPrefix(n+r,"a=ice-ufrag:")[0],a=t.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&a?{usernameFragment:i.substring(12),password:a.substring(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(n)[0].split(" ");r.profile=i[2];for(let c=3;c<i.length;c++){const l=i[c],u=t.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(u){const p=t.parseRtpMap(u),f=t.matchPrefix(n,"a=fmtp:"+l+" ");switch(p.parameters=f.length?t.parseFmtp(f[0]):{},p.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(t.parseRtcpFb),r.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(p.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(c=>{r.headerExtensions.push(t.parseExtmap(c))});const a=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(c=>{a.forEach(l=>{c.rtcpFeedback.find(u=>u.type===l.type&&u.parameter===l.parameter)||c.rtcpFeedback.push(l)})}),r},t.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(c=>{i+=t.writeRtpMap(c),i+=t.writeFmtp(c),i+=t.writeRtcpFb(c)});let a=0;return r.codecs.forEach(c=>{c.maxptime>a&&(a=c.maxptime)}),a>0&&(i+="a=maxptime:"+a+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(c=>{i+=t.writeExtmap(c)}),i},t.parseRtpEncodingParameters=function(n){const r=[],i=t.parseRtpParameters(n),a=i.fecMechanisms.indexOf("RED")!==-1,c=i.fecMechanisms.indexOf("ULPFEC")!==-1,l=t.matchPrefix(n,"a=ssrc:").map(E=>t.parseSsrcMedia(E)).filter(E=>E.attribute==="cname"),u=l.length>0&&l[0].ssrc;let p;const f=t.matchPrefix(n,"a=ssrc-group:FID").map(E=>E.substring(17).split(" ").map(S=>parseInt(S,10)));f.length>0&&f[0].length>1&&f[0][0]===u&&(p=f[0][1]),i.codecs.forEach(E=>{if(E.name.toUpperCase()==="RTX"&&E.parameters.apt){let S={ssrc:u,codecPayloadType:parseInt(E.parameters.apt,10)};u&&p&&(S.rtx={ssrc:p}),r.push(S),a&&(S=JSON.parse(JSON.stringify(S)),S.fec={ssrc:u,mechanism:c?"red+ulpfec":"red"},r.push(S))}}),r.length===0&&u&&r.push({ssrc:u});let m=t.matchPrefix(n,"b=");return m.length&&(m=m[0].indexOf("b=TIAS:")===0?parseInt(m[0].substring(7),10):m[0].indexOf("b=AS:")===0?1e3*parseInt(m[0].substring(5),10)*.95-16e3:void 0,r.forEach(E=>{E.maxBitrate=m})),r},t.parseRtcpParameters=function(n){const r={},i=t.matchPrefix(n,"a=ssrc:").map(l=>t.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const a=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=a.length>0,r.compound=a.length===0;const c=t.matchPrefix(n,"a=rtcp-mux");return r.mux=c.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r;const i=t.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const a=t.matchPrefix(n,"a=ssrc:").map(c=>t.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");return a.length>0?(r=a[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(n){const r=t.parseMLine(n),i=t.matchPrefix(n,"a=max-message-size:");let a;i.length>0&&(a=parseInt(i[0].substring(19),10)),isNaN(a)&&(a=65536);const c=t.matchPrefix(n,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:r.fmt,maxMessageSize:a};const l=t.matchPrefix(n,"a=sctpmap:");if(l.length>0){const u=l[0].substring(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:a}}},t.writeSctpDescription=function(n,r){let i=[];return i=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,r,i){let a;const c=r!==void 0?r:2;return a=n||t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+a+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){const i=t.splitLines(n);for(let a=0;a<i.length;a++)switch(i[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[a].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const r=t.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(n){const r=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=t.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},e.exports=t})(eA);var tA=eA.exports,Md=_(tA),B7=d({__proto__:null,default:Md},[tA]);function Rf(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const r=new t(n),i=Md.parseCandidate(n.candidate),a=Object.assign(r,i);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,mc(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function xS(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||mc(e,"icecandidate",t=>{if(t.candidate){const n=Md.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function wf(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const u=Md.splitSections(l.sdp);return u.shift(),u.some(p=>{const f=Md.parseMLine(p);return f&&f.kind==="application"&&f.protocol.indexOf("SCTP")!==-1})},r=function(l){const u=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;const p=parseInt(u[1],10);return p!=p?-1:p},i=function(l){let u=65536;return t.browser==="firefox"&&(u=t.version<57?l===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),u},a=function(l,u){let p=65536;t.browser==="firefox"&&t.version===57&&(p=65535);const f=Md.matchPrefix(l.sdp,"a=max-message-size:");return f.length>0?p=parseInt(f[0].substr(19),10):t.browser==="firefox"&&u!==-1&&(p=2147483637),p},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=r(arguments[0]),u=i(l),p=a(arguments[0],l);let f;f=u===0&&p===0?Number.POSITIVE_INFINITY:u===0||p===0?Math.max(u,p):Math.min(u,p);const m={};Object.defineProperty(m,"maxMessageSize",{get:()=>f}),this._sctp=m}return c.apply(this,arguments)}}function If(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,i){const a=r.send;r.send=function(){const c=arguments[0],l=c.length||c.size||c.byteLength;if(r.readyState==="open"&&i.sctp&&l>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return a.apply(r,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return t(r,this),r},mc(e,"datachannel",r=>(t(r.channel,r.target),r))}function US(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const a=i.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;const c=new Event("connectionstatechange",i);a.dispatchEvent(c)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function jS(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=r.sdp.split(`
`).filter(a=>sr(a).call(a)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return n.apply(this,arguments)}}function bf(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ce.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ce.resolve())})}function Af(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i=>n.apply(this,[i]))})}var W7=Object.freeze({__proto__:null,removeExtmapAllowMixed:jS,shimAddIceCandidateNullOrEmpty:bf,shimConnectionState:US,shimMaxMessageSize:wf,shimParameterlessSetLocalDescription:Af,shimRTCIceCandidate:Rf,shimRTCIceCandidateRelayProtocol:xS,shimSendThrowTypeError:If});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Cw,r=function(a){const c={browser:null,version:null};if(a===void 0||!a.navigator)return c.browser="Not a browser.",c;const{navigator:l}=a;if(l.mozGetUserMedia)c.browser="firefox",c.version=$p(l.userAgent,/Firefox\/(\d+)\./,1);else if(l.webkitGetUserMedia||a.isSecureContext===!1&&a.webkitRTCPeerConnection)c.browser="chrome",c.version=$p(l.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!a.RTCPeerConnection||!l.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=$p(l.userAgent,/AppleWebKit\/(\d+)\./,1),c.supportsUnifiedPlan=a.RTCRtpTransceiver&&"currentDirection"in a.RTCRtpTransceiver.prototype}return c}(e),i={browserDetails:r,commonShim:W7,extractVersion:$p,disableLog:VF,disableWarnings:FF,sdp:B7};switch(r.browser){case"chrome":if(!Ob||!DS||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=Ob,bf(e,r),Af(e),Tb(e,r),vb(e),DS(e,r),yb(e),bb(e,r),Cb(e),Rb(e),wb(e),Ab(e,r),Rf(e),xS(e),US(e),wf(e,r),If(e),jS(e,r);break;case"firefox":if(!Fb||!PS||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=Fb,bf(e,r),Af(e),Nb(e,r),PS(e,r),Db(e),kb(e),Pb(e),Lb(e),Mb(e),xb(e),Ub(e),jb(e),Vb(e),Rf(e),US(e),wf(e,r),If(e);break;case"safari":if(!Xb||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=Xb,bf(e,r),Af(e),zb(e),qb(e),Gb(e),Bb(e),Wb(e),Yb(e),Hb(e),Jb(e),Rf(e),xS(e),wf(e,r),If(e),jS(e,r);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var G7=Gi("Array").keys,H7=$o,K7=Jn,z7=G,Y7=G7,VS=Array.prototype,q7={DOMTokenList:!0,NodeList:!0},J7=function(e){var t=e.keys;return e===VS||z7(VS,e)&&t===VS.keys||K7(q7,H7(e))?Y7:t},ii=_(J7),nA=Cd,X7=TypeError,Q7=qp,Z7=Wi,$7=pr,Of=function(e,t,n){var r=Q7(t);r in e?Z7.f(e,r,$7(0,n)):e[r]=n},rA=yg,eG=bs,tG=Of,nG=Array,rG=Math.max,FS=function(e,t,n){for(var r=eG(e),i=rA(t,r),a=rA(n===void 0?r:n,r),c=nG(rG(a-i,0)),l=0;i<a;i++,l++)tG(c,l,e[i]);return c.length=l,c},iA=FS,iG=Math.floor,BS=function(e,t){var n=e.length,r=iG(n/2);return n<8?oG(e,t):sG(e,BS(iA(e,0,r),t),BS(iA(e,r),t),t)},oG=function(e,t){for(var n,r,i=e.length,a=1;a<i;){for(r=a,n=e[a];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==a++&&(e[r]=n)}return e},sG=function(e,t,n,r){for(var i=t.length,a=n.length,c=0,l=0;c<i||l<a;)e[c+l]=c<i&&l<a?r(t[c],n[l])<=0?t[c++]:n[l++]:c<i?t[c++]:n[l++];return e},oA=BS,sA=pc.match(/firefox\/(\d+)/i),aG=!!sA&&+sA[1],cG=/MSIE|Trident/.test(pc),aA=pc.match(/AppleWebKit\/(\d+)\./),dG=!!aA&&+aA[1],lG=bt,cA=j,uG=Bi,hG=Zo,dA=bs,pG=function(e,t){if(!delete e[t])throw X7("Cannot delete property "+nA(t)+" of "+nA(e))},lA=Ci,WS=g,fG=oA,mG=Zp,uA=aG,_G=cG,hA=fc,pA=dG,ca=[],fA=cA(ca.sort),EG=cA(ca.push),gG=WS(function(){ca.sort(void 0)}),SG=WS(function(){ca.sort(null)}),TG=mG("sort"),mA=!WS(function(){if(hA)return hA<70;if(!(uA&&uA>3)){if(_G)return!0;if(pA)return pA<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)ca.push({k:t+r,v:n})}for(ca.sort(function(a,c){return c.v-a.v}),r=0;r<ca.length;r++)t=ca[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return i!=="DGBEFHACIJK"}});lG({target:"Array",proto:!0,forced:gG||!SG||!TG||!mA},{sort:function(e){e!==void 0&&uG(e);var t=hG(this);if(mA)return e===void 0?fA(t):fA(t,e);var n,r,i=[],a=dA(t);for(r=0;r<a;r++)r in t&&EG(i,t[r]);for(fG(i,function(c){return function(l,u){return u===void 0?-1:l===void 0?1:c!==void 0?+c(l,u)||0:lA(l)>lA(u)?1:-1}}(e)),n=dA(i),r=0;r<n;)t[r]=i[r++];for(;r<a;)pG(t,r++);return t}});var vG=Gi("Array").sort,yG=G,CG=vG,GS=Array.prototype,RG=function(e){var t=e.sort;return e===GS||yG(GS,e)&&t===GS.sort?CG:t},Mu=_(RG),HS={exports:{}};(function(e,t){(function(n,r){var i="function",a="undefined",c="object",l="string",u="major",p="model",f="name",m="type",E="vendor",S="version",I="architecture",v="console",y="mobile",b="tablet",D="smarttv",U="wearable",F="embedded",W="Amazon",q="Apple",Q="ASUS",ee="BlackBerry",ne="Browser",_e="Chrome",Qe="Firefox",ct="Google",Nt="Huawei",dn="LG",Gt="Microsoft",uo="Motorola",te="Opera",oe="Samsung",Te="Sharp",Me="Sony",st="Xiaomi",de="Zebra",R="Facebook",k="Chromium OS",x="Mac OS",ie=function(tn){for(var mn={},Mt=0;Mt<tn.length;Mt++)mn[tn[Mt].toUpperCase()]=tn[Mt];return mn},xe=function(tn,mn){return typeof tn===l&&gt(mn).indexOf(gt(tn))!==-1},gt=function(tn){return tn.toLowerCase()},Tn=function(tn,mn){if(typeof tn===l)return tn=tn.replace(/^\s\s*/,""),typeof mn===a?tn:tn.substring(0,350)},Ur=function(tn,mn){for(var Mt,Xr,vs,nn,at,jr,Va=0;Va<mn.length&&!at;){var Uo=mn[Va],mx=mn[Va+1];for(Mt=Xr=0;Mt<Uo.length&&!at&&Uo[Mt];)if(at=Uo[Mt++].exec(tn))for(vs=0;vs<mx.length;vs++)jr=at[++Xr],typeof(nn=mx[vs])===c&&nn.length>0?nn.length===2?typeof nn[1]==i?this[nn[0]]=nn[1].call(this,jr):this[nn[0]]=nn[1]:nn.length===3?typeof nn[1]!==i||nn[1].exec&&nn[1].test?this[nn[0]]=jr?jr.replace(nn[1],nn[2]):r:this[nn[0]]=jr?nn[1].call(this,jr,nn[2]):r:nn.length===4&&(this[nn[0]]=jr?nn[3].call(this,jr.replace(nn[1],nn[2])):r):this[nn]=jr||r;Va+=2}},Gs=function(tn,mn){for(var Mt in mn)if(typeof mn[Mt]===c&&mn[Mt].length>0){for(var Xr=0;Xr<mn[Mt].length;Xr++)if(xe(mn[Mt][Xr],tn))return Mt==="?"?r:Mt}else if(xe(mn[Mt],tn))return Mt==="?"?r:Mt;return tn},y_={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},C_={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[S,[f,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[S,[f,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[f,S],[/opios[\/ ]+([\w\.]+)/i],[S,[f,te+" Mini"]],[/\bopr\/([\w\.]+)/i],[S,[f,te]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[f,S],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[S,[f,"UC"+ne]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[S,[f,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[S,[f,"WeChat"]],[/konqueror\/([\w\.]+)/i],[S,[f,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[S,[f,"IE"]],[/yabrowser\/([\w\.]+)/i],[S,[f,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[f,/(.+)/,"$1 Secure "+ne],S],[/\bfocus\/([\w\.]+)/i],[S,[f,Qe+" Focus"]],[/\bopt\/([\w\.]+)/i],[S,[f,te+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[S,[f,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[S,[f,"Dolphin"]],[/coast\/([\w\.]+)/i],[S,[f,te+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[S,[f,"MIUI "+ne]],[/fxios\/([-\w\.]+)/i],[S,[f,Qe]],[/\bqihu|(qi?ho?o?|360)browser/i],[[f,"360 "+ne]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[f,/(.+)/,"$1 "+ne],S],[/(comodo_dragon)\/([\w\.]+)/i],[[f,/_/g," "],S],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[f,S],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[f],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[f,R],S],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[f,S],[/\bgsa\/([\w\.]+) .*safari\//i],[S,[f,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[S,[f,_e+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[f,_e+" WebView"],S],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[S,[f,"Android "+ne]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[f,S],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[S,[f,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[S,f],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[f,[S,Gs,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[f,S],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[f,"Netscape"],S],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[S,[f,Qe+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[f,S],[/(cobalt)\/([\w\.]+)/i],[f,[S,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[I,"amd64"]],[/(ia32(?=;))/i],[[I,gt]],[/((?:i[346]|x)86)[;\)]/i],[[I,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[I,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[I,"armhf"]],[/windows (ce|mobile); ppc;/i],[[I,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[I,/ower/,"",gt]],[/(sun4\w)[;\)]/i],[[I,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[I,gt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[p,[E,oe],[m,b]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[p,[E,oe],[m,y]],[/\((ip(?:hone|od)[\w ]*);/i],[p,[E,q],[m,y]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[E,q],[m,b]],[/(macintosh);/i],[p,[E,q]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[p,[E,Te],[m,y]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[p,[E,Nt],[m,b]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[p,[E,Nt],[m,y]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[p,/_/g," "],[E,st],[m,y]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[p,/_/g," "],[E,st],[m,b]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[p,[E,"OPPO"],[m,y]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[p,[E,"Vivo"],[m,y]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[p,[E,"Realme"],[m,y]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[p,[E,uo],[m,y]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[p,[E,uo],[m,b]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[p,[E,dn],[m,b]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[p,[E,dn],[m,y]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[p,[E,"Lenovo"],[m,b]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[p,/_/g," "],[E,"Nokia"],[m,y]],[/(pixel c)\b/i],[p,[E,ct],[m,b]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[p,[E,ct],[m,y]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[E,Me],[m,y]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[p,"Xperia Tablet"],[E,Me],[m,b]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[p,[E,"OnePlus"],[m,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[p,[E,W],[m,b]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[p,/(.+)/g,"Fire Phone $1"],[E,W],[m,y]],[/(playbook);[-\w\),; ]+(rim)/i],[p,E,[m,b]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[p,[E,ee],[m,y]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[p,[E,Q],[m,b]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[p,[E,Q],[m,y]],[/(nexus 9)/i],[p,[E,"HTC"],[m,b]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[E,[p,/_/g," "],[m,y]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[p,[E,"Acer"],[m,b]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[p,[E,"Meizu"],[m,y]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[E,p,[m,y]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[E,p,[m,b]],[/(surface duo)/i],[p,[E,Gt],[m,b]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[p,[E,"Fairphone"],[m,y]],[/(u304aa)/i],[p,[E,"AT&T"],[m,y]],[/\bsie-(\w*)/i],[p,[E,"Siemens"],[m,y]],[/\b(rct\w+) b/i],[p,[E,"RCA"],[m,b]],[/\b(venue[\d ]{2,7}) b/i],[p,[E,"Dell"],[m,b]],[/\b(q(?:mv|ta)\w+) b/i],[p,[E,"Verizon"],[m,b]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[p,[E,"Barnes & Noble"],[m,b]],[/\b(tm\d{3}\w+) b/i],[p,[E,"NuVision"],[m,b]],[/\b(k88) b/i],[p,[E,"ZTE"],[m,b]],[/\b(nx\d{3}j) b/i],[p,[E,"ZTE"],[m,y]],[/\b(gen\d{3}) b.+49h/i],[p,[E,"Swiss"],[m,y]],[/\b(zur\d{3}) b/i],[p,[E,"Swiss"],[m,b]],[/\b((zeki)?tb.*\b) b/i],[p,[E,"Zeki"],[m,b]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[E,"Dragon Touch"],p,[m,b]],[/\b(ns-?\w{0,9}) b/i],[p,[E,"Insignia"],[m,b]],[/\b((nxa|next)-?\w{0,9}) b/i],[p,[E,"NextBook"],[m,b]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[E,"Voice"],p,[m,y]],[/\b(lvtel\-)?(v1[12]) b/i],[[E,"LvTel"],p,[m,y]],[/\b(ph-1) /i],[p,[E,"Essential"],[m,y]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[p,[E,"Envizen"],[m,b]],[/\b(trio[-\w\. ]+) b/i],[p,[E,"MachSpeed"],[m,b]],[/\btu_(1491) b/i],[p,[E,"Rotor"],[m,b]],[/(shield[\w ]+) b/i],[p,[E,"Nvidia"],[m,b]],[/(sprint) (\w+)/i],[E,p,[m,y]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[E,Gt],[m,y]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[E,de],[m,b]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[E,de],[m,y]],[/smart-tv.+(samsung)/i],[E,[m,D]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[E,oe],[m,D]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[E,dn],[m,D]],[/(apple) ?tv/i],[E,[p,q+" TV"],[m,D]],[/crkey/i],[[p,_e+"cast"],[E,ct],[m,D]],[/droid.+aft(\w)( bui|\))/i],[p,[E,W],[m,D]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[p,[E,Te],[m,D]],[/(bravia[\w ]+)( bui|\))/i],[p,[E,Me],[m,D]],[/(mitv-\w{5}) bui/i],[p,[E,st],[m,D]],[/Hbbtv.*(technisat) (.*);/i],[E,p,[m,D]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[E,Tn],[p,Tn],[m,D]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,D]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[E,p,[m,v]],[/droid.+; (shield) bui/i],[p,[E,"Nvidia"],[m,v]],[/(playstation [345portablevi]+)/i],[p,[E,Me],[m,v]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[p,[E,Gt],[m,v]],[/((pebble))app/i],[E,p,[m,U]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[p,[E,q],[m,U]],[/droid.+; (glass) \d/i],[p,[E,ct],[m,U]],[/droid.+; (wt63?0{2,3})\)/i],[p,[E,de],[m,U]],[/(quest( 2| pro)?)/i],[p,[E,R],[m,U]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[E,[m,F]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[p,[m,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[p,[m,b]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,b]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[m,y]],[/(android[-\w\. ]{0,9});.+buil/i],[p,[E,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[S,[f,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[S,[f,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[f,S],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[S,f]],os:[[/microsoft (windows) (vista|xp)/i],[f,S],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[f,[S,Gs,y_]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[f,"Windows"],[S,Gs,y_]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[S,/_/g,"."],[f,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[f,x],[S,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[S,f],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[f,S],[/\(bb(10);/i],[S,[f,ee]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[S,[f,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[S,[f,Qe+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[S,[f,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[S,[f,"watchOS"]],[/crkey\/([\d\.]+)/i],[S,[f,_e+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[f,k],S],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[f,S],[/(sunos) ?([\w\.\d]*)/i],[[f,"Solaris"],S],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[f,S]]},ki=function(tn,mn){if(typeof tn===c&&(mn=tn,tn=r),!(this instanceof ki))return new ki(tn,mn).getResult();var Mt=typeof n!==a&&n.navigator?n.navigator:r,Xr=tn||(Mt&&Mt.userAgent?Mt.userAgent:""),vs=Mt&&Mt.userAgentData?Mt.userAgentData:r,nn=mn?function(at,jr){var Va={};for(var Uo in at)jr[Uo]&&jr[Uo].length%2==0?Va[Uo]=jr[Uo].concat(at[Uo]):Va[Uo]=at[Uo];return Va}(C_,mn):C_;return this.getBrowser=function(){var at={};return at[f]=r,at[S]=r,Ur.call(at,Xr,nn.browser),at[u]=function(jr){return typeof jr===l?jr.replace(/[^\d\.]/g,"").split(".")[0]:r}(at[S]),Mt&&Mt.brave&&typeof Mt.brave.isBrave==i&&(at[f]="Brave"),at},this.getCPU=function(){var at={};return at[I]=r,Ur.call(at,Xr,nn.cpu),at},this.getDevice=function(){var at={};return at[E]=r,at[p]=r,at[m]=r,Ur.call(at,Xr,nn.device),!at[m]&&vs&&vs.mobile&&(at[m]=y),at[p]=="Macintosh"&&Mt&&typeof Mt.standalone!==a&&Mt.maxTouchPoints&&Mt.maxTouchPoints>2&&(at[p]="iPad",at[m]=b),at},this.getEngine=function(){var at={};return at[f]=r,at[S]=r,Ur.call(at,Xr,nn.engine),at},this.getOS=function(){var at={};return at[f]=r,at[S]=r,Ur.call(at,Xr,nn.os),!at[f]&&vs&&vs.platform!="Unknown"&&(at[f]=vs.platform.replace(/chrome os/i,k).replace(/macos/i,x)),at},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Xr},this.setUA=function(at){return Xr=typeof at===l&&at.length>350?Tn(at,350):at,this},this.setUA(Xr),this};ki.VERSION="0.7.34",ki.BROWSER=ie([f,S,u]),ki.CPU=ie([I]),ki.DEVICE=ie([p,E,m,v,y,D,b,U,F]),ki.ENGINE=ki.OS=ie([f,S]),e.exports&&(t=e.exports=ki),t.UAParser=ki;var ja=typeof n!==a&&(n.jQuery||n.Zepto);if(ja&&!ja.ua){var kl=new ki;ja.ua=kl.getResult(),ja.ua.get=function(){return kl.getUA()},ja.ua.set=function(tn){kl.setUA(tn);var mn=kl.getResult();for(var Mt in mn)ja.ua[Mt]=mn[Mt]}}})(typeof window=="object"?window:h)})(HS,HS.exports);var wG=_(HS.exports),IG=$o,bG=Jn,AG=Td,OG=_c,NG=on("iterator"),DG=Object,PG=function(e){if(AG(e))return!1;var t=DG(e);return t[NG]!==void 0||"@@iterator"in t||bG(OG,IG(t))},LG=_(PG),KS=z;bt({global:!0,forced:KS.globalThis!==KS},{globalThis:KS});var _A=_(z);function EA(e,t){return function(){return e.apply(t,arguments)}}const{toString:kG}=Object.prototype,{getPrototypeOf:zS}=Object,Nf=(YS=Object.create(null),e=>{const t=kG.call(e);return YS[t]||(YS[t]=t.slice(8,-1).toLowerCase())});var YS;const ns=e=>(e=e.toLowerCase(),t=>Nf(t)===e),Df=e=>t=>typeof t===e,{isArray:xd}=Array,xu=Df("undefined"),gA=ns("ArrayBuffer"),MG=Df("string"),Hi=Df("function"),SA=Df("number"),Pf=e=>e!==null&&typeof e=="object",Lf=e=>{if(Nf(e)!=="object")return!1;const t=zS(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.toStringTag in e||LG(e))},xG=ns("Date"),UG=ns("File"),jG=ns("Blob"),VG=ns("FileList"),FG=ns("URLSearchParams");function Uu(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),xd(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const a=i?Object.getOwnPropertyNames(e):Object.keys(e),c=a.length;let l;for(n=0;n<c;n++)l=a[n],t.call(null,e[l],l,e)}}function TA(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const vA=_A!==void 0?_A:typeof self<"u"?self:typeof window<"u"?window:R_,yA=e=>!xu(e)&&e!==vA,BG=(qS=typeof Uint8Array<"u"&&zS(Uint8Array),e=>qS&&e instanceof qS);var qS;const WG=ns("HTMLFormElement"),CA=(e=>{let{hasOwnProperty:t}=e;return(n,r)=>t.call(n,r)})(Object.prototype),GG=ns("RegExp"),RA=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};Uu(n,(i,a)=>{let c;(c=t(i,a,e))!==!1&&(r[a]=c||i)}),Object.defineProperties(e,r)},JS="abcdefghijklmnopqrstuvwxyz",wA="0123456789",IA={DIGIT:wA,ALPHA:JS,ALPHA_DIGIT:JS+JS.toUpperCase()+wA},HG=ns("AsyncFunction");var Se={isArray:xd,isArrayBuffer:gA,isBuffer:function(e){return e!==null&&!xu(e)&&e.constructor!==null&&!xu(e.constructor)&&Hi(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Hi(e.append)&&((t=Nf(e))==="formdata"||t==="object"&&Hi(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&gA(e.buffer),t},isString:MG,isNumber:SA,isBoolean:e=>e===!0||e===!1,isObject:Pf,isPlainObject:Lf,isUndefined:xu,isDate:xG,isFile:UG,isBlob:jG,isRegExp:GG,isFunction:Hi,isStream:e=>Pf(e)&&Hi(e.pipe),isURLSearchParams:FG,isTypedArray:BG,isFileList:VG,forEach:Uu,merge:function e(){const{caseless:t}=yA(this)&&this||{},n={},r=(i,a)=>{const c=t&&TA(n,a)||a;Lf(n[c])&&Lf(i)?n[c]=e(n[c],i):Lf(i)?n[c]=e({},i):xd(i)?n[c]=i.slice():n[c]=i};for(let i=0,a=arguments.length;i<a;i++)arguments[i]&&Uu(arguments[i],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Uu(t,(i,a)=>{n&&Hi(i)?e[a]=EA(i,n):e[a]=i},{allOwnKeys:r}),e},trim:e=>sr(e)?sr(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,a,c;const l={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),a=i.length;a-- >0;)c=i[a],r&&!r(c,e,t)||l[c]||(t[c]=e[c],l[c]=!0);e=n!==!1&&zS(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Nf,kindOfTest:ns,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return r!==-1&&r===n},toArray:e=>{if(!e)return null;if(xd(e))return e;let t=e.length;if(!SA(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const i=r.value;t.call(e,i[0],i[1])}},matchAll:(e,t)=>{let n;const r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},isHTMLForm:WG,hasOwnProperty:CA,hasOwnProp:CA,reduceDescriptors:RA,freezeMethods:e=>{RA(e,(t,n)=>{if(Hi(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=e[n];Hi(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},r=i=>{i.forEach(a=>{n[a]=!0})};return xd(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,r){return n.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:TA,global:vA,isContextDefined:yA,ALPHABET:IA,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:IA.ALPHA_DIGIT,n="";const{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&Hi(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(r,i)=>{if(Pf(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[i]=r;const a=xd(r)?[]:{};return Uu(r,(c,l)=>{const u=n(c,i+1);!xu(u)&&(a[l]=u)}),t[i]=void 0,a}}return r};return n(e,0)},isAsyncFn:HG,isThenable:e=>e&&(Pf(e)||Hi(e))&&Hi(e.then)&&Hi(e.catch)};function Ft(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}Se.inherits(Ft,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Se.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const bA=Ft.prototype,AA={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{AA[e]={value:e}}),Object.defineProperties(Ft,AA),Object.defineProperty(bA,"isAxiosError",{value:!0}),Ft.from=(e,t,n,r,i,a)=>{const c=Object.create(bA);return Se.toFlatObject(e,c,function(l){return l!==Error.prototype},l=>l!=="isAxiosError"),Ft.call(c,e.message,t,n,r,i),c.cause=e,c.name=e.name,a&&Object.assign(c,a),c};function XS(e){return Se.isPlainObject(e)||Se.isArray(e)}function OA(e){return Se.endsWith(e,"[]")?e.slice(0,-2):e}function NA(e,t,n){return e?e.concat(t).map(function(r,i){return r=OA(r),!n&&i?"["+r+"]":r}).join(n?".":""):t}const KG=Se.toFlatObject(Se,{},null,function(e){return/^is[A-Z]/.test(e)});function kf(e,t,n){if(!Se.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=Se.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(E,S){return!Se.isUndefined(S[E])})).metaTokens,i=n.visitor||p,a=n.dots,c=n.indexes,l=(n.Blob||typeof Blob<"u"&&Blob)&&Se.isSpecCompliantForm(t);if(!Se.isFunction(i))throw new TypeError("visitor must be a function");function u(E){if(E===null)return"";if(Se.isDate(E))return E.toISOString();if(!l&&Se.isBlob(E))throw new Ft("Blob is not supported. Use a Buffer instead.");return Se.isArrayBuffer(E)||Se.isTypedArray(E)?l&&typeof Blob=="function"?new Blob([E]):Buffer.from(E):E}function p(E,S,I){let v=E;if(E&&!I&&typeof E=="object"){if(Se.endsWith(S,"{}"))S=r?S:S.slice(0,-2),E=JSON.stringify(E);else if(Se.isArray(E)&&function(y){return Se.isArray(y)&&!y.some(XS)}(E)||(Se.isFileList(E)||Se.endsWith(S,"[]"))&&(v=Se.toArray(E)))return S=OA(S),v.forEach(function(y,b){!Se.isUndefined(y)&&y!==null&&t.append(c===!0?NA([S],b,a):c===null?S:S+"[]",u(y))}),!1}return!!XS(E)||(t.append(NA(I,S,a),u(E)),!1)}const f=[],m=Object.assign(KG,{defaultVisitor:p,convertValue:u,isVisitable:XS});if(!Se.isObject(e))throw new TypeError("data must be an object");return function E(S,I){if(!Se.isUndefined(S)){if(f.indexOf(S)!==-1)throw Error("Circular reference detected in "+I.join("."));f.push(S),Se.forEach(S,function(v,y){(!(Se.isUndefined(v)||v===null)&&i.call(t,v,Se.isString(y)?sr(y).call(y):y,I,m))===!0&&E(v,I?I.concat(y):[y])}),f.pop()}}(e),t}function DA(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function QS(e,t){this._pairs=[],e&&kf(e,this,t)}const PA=QS.prototype;function zG(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function LA(e,t,n){if(!t)return e;const r=n&&n.encode||zG,i=n&&n.serialize;let a;if(a=i?i(t,n):Se.isURLSearchParams(t)?t.toString():new QS(t,n).toString(r),a){const c=e.indexOf("#");c!==-1&&(e=e.slice(0,c)),e+=(e.indexOf("?")===-1?"?":"&")+a}return e}PA.append=function(e,t){this._pairs.push([e,t])},PA.toString=function(e){const t=e?function(n){return e.call(this,n,DA)}:DA;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var kA=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Se.forEach(this.handlers,function(t){t!==null&&e(t)})}},MA={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},xA={exports:{}},YG=bt,qG=Dt,UA=Wi.f;YG({target:"Object",stat:!0,forced:Object.defineProperty!==UA,sham:!qG},{defineProperty:UA});var jA=vo.Object,JG=xA.exports=function(e,t,n){return jA.defineProperty(e,t,n)};jA.defineProperty.sham&&(JG.sham=!0);var VA=_(xA.exports),XG=Pe,ju=Array.isArray||function(e){return XG(e)=="Array"},QG=TypeError,FA=ju,ZG=_f,$G=ri,e9=on("species"),BA=Array,t9=function(e){var t;return FA(e)&&(t=e.constructor,(ZG(t)&&(t===BA||FA(t.prototype))||$G(t)&&(t=t[e9])===null)&&(t=void 0)),t===void 0?BA:t},WA=function(e,t){return new(t9(e))(t===0?0:t)},n9=g,r9=fc,i9=on("species"),GA=function(e){return r9>=51||!n9(function(){var t=[];return(t.constructor={})[i9]=function(){return{foo:1}},t[e](Boolean).foo!==1})},o9=bt,s9=g,a9=ju,c9=ri,d9=Zo,l9=bs,HA=function(e){if(e>9007199254740991)throw QG("Maximum allowed index exceeded");return e},KA=Of,u9=WA,h9=GA,p9=fc,zA=on("isConcatSpreadable"),f9=p9>=51||!s9(function(){var e=[];return e[zA]=!1,e.concat()[0]!==e}),m9=function(e){if(!c9(e))return!1;var t=e[zA];return t!==void 0?!!t:a9(e)};o9({target:"Array",proto:!0,arity:1,forced:!f9||!h9("concat")},{concat:function(e){var t,n,r,i,a,c=d9(this),l=u9(c,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if(m9(a=t===-1?c:arguments[t]))for(i=l9(a),HA(u+i),n=0;n<i;n++,u++)n in a&&KA(l,u,a[n]);else HA(u+1),KA(l,u++,a);return l.length=u,l}});var YA={},_9=Pe,E9=na,qA=tf.f,g9=FS,JA=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];YA.f=function(e){return JA&&_9(e)=="Window"?function(t){try{return qA(t)}catch{return g9(JA)}}(e):qA(E9(e))};var Ud={},S9=on;Ud.f=S9;var XA=vo,T9=Jn,v9=Ud,y9=Wi.f,Bn=function(e){var t=XA.Symbol||(XA.Symbol={});T9(t,e)||y9(t,e,{value:v9.f(e)})},C9=De,R9=Hr,w9=on,I9=oa,QA=function(){var e=R9("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=w9("toPrimitive");t&&!t[r]&&I9(t,r,function(i){return C9(n,this)},{arity:1})},b9=ra,A9=zp,O9=Zo,N9=bs,D9=WA,ZA=j([].push),da=function(e){var t=e==1,n=e==2,r=e==3,i=e==4,a=e==6,c=e==7,l=e==5||a;return function(u,p,f,m){for(var E,S,I=O9(u),v=A9(I),y=b9(p,f),b=N9(v),D=0,U=m||D9,F=t?U(u,b):n||c?U(u,0):void 0;b>D;D++)if((l||D in v)&&(S=y(E=v[D],D,I),e))if(t)F[D]=S;else if(S)switch(e){case 3:return!0;case 5:return E;case 6:return D;case 2:ZA(F,E)}else switch(e){case 4:return!1;case 7:ZA(F,E)}return a?-1:r||i?i:F}},$A={forEach:da(0),map:da(1),filter:da(2),some:da(3),every:da(4),find:da(5),findIndex:da(6),filterReject:da(7)},Mf=bt,ZS=z,$S=De,P9=j,jd=Dt,Vd=yd,L9=g,fr=Jn,k9=G,eT=Dr,xf=na,tT=qp,M9=Ci,nT=pr,Vu=wu,eO=rf,x9=tf,tO=YA,U9=Ru,nO=nt,rO=Wi,j9=kg,iO=Ke,oO=oa,V9=mf,rT=Rd,sO=nf,aO=pg,F9=on,B9=Ud,W9=Bn,G9=QA,H9=sa,cO=gc,Uf=$A.forEach,oi=ef("hidden"),jf="Symbol",Fu="prototype",K9=cO.set,dO=cO.getterFor(jf),Co=Object[Fu],vc=ZS.Symbol,Vf=vc&&vc[Fu],z9=ZS.TypeError,iT=ZS.QObject,lO=nO.f,yc=rO.f,uO=tO.f,Y9=iO.f,hO=P9([].push),As=rT("symbols"),Bu=rT("op-symbols"),q9=rT("wks"),oT=!iT||!iT[Fu]||!iT[Fu].findChild,sT=jd&&L9(function(){return Vu(yc({},"a",{get:function(){return yc(this,"a",{value:7}).a}})).a!=7})?function(e,t,n){var r=lO(Co,t);r&&delete Co[t],yc(e,t,n),r&&e!==Co&&yc(Co,t,r)}:yc,aT=function(e,t){var n=As[e]=Vu(Vf);return K9(n,{type:jf,tag:e,description:t}),jd||(n.description=t),n},Ff=function(e,t,n){e===Co&&Ff(Bu,t,n),eT(e);var r=tT(t);return eT(n),fr(As,r)?(n.enumerable?(fr(e,oi)&&e[oi][r]&&(e[oi][r]=!1),n=Vu(n,{enumerable:nT(0,!1)})):(fr(e,oi)||yc(e,oi,nT(1,{})),e[oi][r]=!0),sT(e,r,n)):yc(e,r,n)},cT=function(e,t){eT(e);var n=xf(t),r=eO(n).concat(_O(n));return Uf(r,function(i){jd&&!$S(pO,n,i)||Ff(e,i,n[i])}),e},pO=function(e){var t=tT(e),n=$S(Y9,this,t);return!(this===Co&&fr(As,t)&&!fr(Bu,t))&&(!(n||!fr(this,t)||!fr(As,t)||fr(this,oi)&&this[oi][t])||n)},fO=function(e,t){var n=xf(e),r=tT(t);if(n!==Co||!fr(As,r)||fr(Bu,r)){var i=lO(n,r);return!i||!fr(As,r)||fr(n,oi)&&n[oi][r]||(i.enumerable=!0),i}},mO=function(e){var t=uO(xf(e)),n=[];return Uf(t,function(r){fr(As,r)||fr(sO,r)||hO(n,r)}),n},_O=function(e){var t=e===Co,n=uO(t?Bu:xf(e)),r=[];return Uf(n,function(i){!fr(As,i)||t&&!fr(Co,i)||hO(r,As[i])}),r};Vd||(vc=function(){if(k9(Vf,this))throw z9("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?M9(arguments[0]):void 0,t=aO(e),n=function(r){this===Co&&$S(n,Bu,r),fr(this,oi)&&fr(this[oi],t)&&(this[oi][t]=!1),sT(this,t,nT(1,r))};return jd&&oT&&sT(Co,t,{configurable:!0,set:n}),aT(t,e)},oO(Vf=vc[Fu],"toString",function(){return dO(this).tag}),oO(vc,"withoutSetter",function(e){return aT(aO(e),e)}),iO.f=pO,rO.f=Ff,j9.f=cT,nO.f=fO,x9.f=tO.f=mO,U9.f=_O,B9.f=function(e){return aT(F9(e),e)},jd&&V9(Vf,"description",{configurable:!0,get:function(){return dO(this).description}})),Mf({global:!0,constructor:!0,wrap:!0,forced:!Vd,sham:!Vd},{Symbol:vc}),Uf(eO(q9),function(e){W9(e)}),Mf({target:jf,stat:!0,forced:!Vd},{useSetter:function(){oT=!0},useSimple:function(){oT=!1}}),Mf({target:"Object",stat:!0,forced:!Vd,sham:!jd},{create:function(e,t){return t===void 0?Vu(e):cT(Vu(e),t)},defineProperty:Ff,defineProperties:cT,getOwnPropertyDescriptor:fO}),Mf({target:"Object",stat:!0,forced:!Vd},{getOwnPropertyNames:mO}),G9(),H9(vc,jf),sO[oi]=!0;var EO=yd&&!!Symbol.for&&!!Symbol.keyFor,J9=bt,X9=Hr,Q9=Jn,Z9=Ci,gO=Rd,$9=EO,dT=gO("string-to-symbol-registry"),eH=gO("symbol-to-string-registry");J9({target:"Symbol",stat:!0,forced:!$9},{for:function(e){var t=Z9(e);if(Q9(dT,t))return dT[t];var n=X9("Symbol")(t);return dT[t]=n,eH[n]=t,n}});var tH=bt,nH=Jn,rH=vu,iH=Cd,oH=EO,SO=Rd("symbol-to-string-registry");tH({target:"Symbol",stat:!0,forced:!oH},{keyFor:function(e){if(!rH(e))throw TypeError(iH(e)+" is not a symbol");if(nH(SO,e))return SO[e]}});var TO=ju,sH=je,vO=Pe,aH=Ci,yO=j([].push),cH=bt,CO=Hr,RO=Y,dH=De,Wu=j,wO=g,IO=je,bO=vu,AO=nS,lH=function(e){if(sH(e))return e;if(TO(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];typeof i=="string"?yO(n,i):typeof i!="number"&&vO(i)!="Number"&&vO(i)!="String"||yO(n,aH(i))}var a=n.length,c=!0;return function(l,u){if(c)return c=!1,u;if(TO(this))return u;for(var p=0;p<a;p++)if(n[p]===l)return u}}},uH=yd,hH=String,la=CO("JSON","stringify"),Bf=Wu(/./.exec),OO=Wu("".charAt),pH=Wu("".charCodeAt),fH=Wu("".replace),mH=Wu(1 .toString),_H=/[\uD800-\uDFFF]/g,NO=/^[\uD800-\uDBFF]$/,DO=/^[\uDC00-\uDFFF]$/,PO=!uH||wO(function(){var e=CO("Symbol")();return la([e])!="[null]"||la({a:e})!="{}"||la(Object(e))!="{}"}),LO=wO(function(){return la("\uDF06\uD834")!=='"\\udf06\\ud834"'||la("\uDEAD")!=='"\\udead"'}),EH=function(e,t){var n=AO(arguments),r=lH(t);if(IO(r)||e!==void 0&&!bO(e))return n[1]=function(i,a){if(IO(r)&&(a=dH(r,this,hH(i),a)),!bO(a))return a},RO(la,null,n)},gH=function(e,t,n){var r=OO(n,t-1),i=OO(n,t+1);return Bf(NO,e)&&!Bf(DO,i)||Bf(DO,e)&&!Bf(NO,r)?"\\u"+mH(pH(e,0),16):e};la&&cH({target:"JSON",stat:!0,arity:3,forced:PO||LO},{stringify:function(e,t,n){var r=AO(arguments),i=RO(PO?EH:la,null,r);return LO&&typeof i=="string"?fH(i,_H,gH):i}});var kO=Ru,SH=Zo;bt({target:"Object",stat:!0,forced:!yd||g(function(){kO.f(1)})},{getOwnPropertySymbols:function(e){var t=kO.f;return t?t(SH(e)):[]}}),Bn("asyncIterator"),Bn("hasInstance"),Bn("isConcatSpreadable"),Bn("iterator"),Bn("match"),Bn("matchAll"),Bn("replace"),Bn("search"),Bn("species"),Bn("split");var TH=QA;Bn("toPrimitive"),TH();var vH=Hr,yH=sa;Bn("toStringTag"),yH(vH("Symbol"),"Symbol"),Bn("unscopables"),sa(z.JSON,"JSON",!0);var CH=vo.Symbol,RH=on,wH=Wi.f,MO=RH("metadata"),xO=Function.prototype;xO[MO]===void 0&&wH(xO,MO,{value:null}),Bn("dispose"),Bn("metadata");var IH=CH;Bn("asyncDispose");var bH=j,lT=Hr("Symbol"),AH=lT.keyFor,OH=bH(lT.prototype.valueOf),UO=lT.isRegisteredSymbol||function(e){try{return AH(OH(e))!==void 0}catch{return!1}};bt({target:"Symbol",stat:!0},{isRegisteredSymbol:UO});for(var NH=Rd,jO=Hr,DH=j,PH=vu,LH=on,Wf=jO("Symbol"),VO=Wf.isWellKnownSymbol,FO=jO("Object","getOwnPropertyNames"),kH=DH(Wf.prototype.valueOf),BO=NH("wks"),uT=0,WO=FO(Wf),MH=WO.length;uT<MH;uT++)try{var GO=WO[uT];PH(Wf[GO])&&LH(GO)}catch{}var HO=function(e){if(VO&&VO(e))return!0;try{for(var t=kH(e),n=0,r=FO(BO),i=r.length;n<i;n++)if(BO[r[n]]==t)return!0}catch{}return!1};bt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:HO}),Bn("matcher"),Bn("observable"),bt({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:UO}),bt({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:HO}),Bn("metadataKey"),Bn("patternMatch"),Bn("replaceAll");var Fd=_(IH),KO=_(Ud.f("iterator"));function Gu(e){return Gu=typeof Fd=="function"&&typeof KO=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Fd=="function"&&t.constructor===Fd&&t!==Fd.prototype?"symbol":typeof t},Gu(e)}var xH=_(Ud.f("toPrimitive"));function UH(e){var t=function(n,r){if(Gu(n)!=="object"||n===null)return n;var i=n[xH];if(i!==void 0){var a=i.call(n,r||"default");if(Gu(a)!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}(e,"string");return Gu(t)==="symbol"?t:String(t)}function w(e,t,n){return(t=UH(t))in e?VA(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var jH=g,VH=on("iterator"),hT=!jH(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2"),r="";return e.pathname="c%20d",t.forEach(function(i,a){t.delete("b"),r+=a+i}),n.delete("a",2),!e.toJSON||!n.has("a",1)||n.has("a",2)||!t.size&&!0||!t.sort||e.href!=="http://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[VH]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://тест").host!=="xn--e1aybc"||new URL("http://a#б").hash!=="#%D0%B1"||r!=="a1c3"||new URL("http://x",void 0).host!=="x"}),FH=oa,pT=bt,Bd=z,Gf=De,rs=j,Wd=Dt,zO=hT,YO=oa,BH=mf,WH=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:FH(e,r,t[r],n);return e},GH=sa,HH=qg,fT=gc,qO=Qg,mT=je,KH=Jn,zH=ra,YH=$o,qH=Dr,JO=ri,Kr=Ci,JH=wu,XO=pr,_T=jg,XH=af,Gd=Ef,QH=oA,ZH=on("iterator"),Hu="URLSearchParams",QO=Hu+"Iterator",ZO=fT.set,Ki=fT.getterFor(Hu),$H=fT.getterFor(QO),eK=Object.getOwnPropertyDescriptor,ET=function(e){if(!Wd)return Bd[e];var t=eK(Bd,e);return t&&t.value},$O=ET("fetch"),Hf=ET("Request"),Ku=ET("Headers"),gT=Hf&&Hf.prototype,eN=Ku&&Ku.prototype,tK=Bd.RegExp,nK=Bd.TypeError,tN=Bd.decodeURIComponent,rK=Bd.encodeURIComponent,iK=rs("".charAt),nN=rs([].join),Cc=rs([].push),ST=rs("".replace),oK=rs([].shift),rN=rs([].splice),iN=rs("".split),sK=rs("".slice),aK=/\+/g,oN=Array(4),cK=function(e){return oN[e-1]||(oN[e-1]=tK("((?:%[\\da-f]{2}){"+e+"})","gi"))},dK=function(e){try{return tN(e)}catch{return e}},sN=function(e){var t=ST(e,aK," "),n=4;try{return tN(t)}catch{for(;n;)t=ST(t,cK(n--),dK);return t}},lK=/[!'()~]|%20/g,uK={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},hK=function(e){return uK[e]},aN=function(e){return ST(rK(e),lK,hK)},TT=HH(function(e,t){ZO(this,{type:QO,iterator:_T(Ki(e).entries),kind:t})},"Iterator",function(){var e=$H(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value=t==="keys"?r.key:t==="values"?r.value:[r.key,r.value]),n},!0),cN=function(e){this.entries=[],this.url=null,e!==void 0&&(JO(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?iK(e,0)==="?"?sK(e,1):e:Kr(e)))};cN.prototype={type:Hu,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,a,c,l,u=XH(e);if(u)for(n=(t=_T(e,u)).next;!(r=Gf(n,t)).done;){if(a=(i=_T(qH(r.value))).next,(c=Gf(a,i)).done||(l=Gf(a,i)).done||!Gf(a,i).done)throw nK("Expected sequence with length 2");Cc(this.entries,{key:Kr(c.value),value:Kr(l.value)})}else for(var p in e)KH(e,p)&&Cc(this.entries,{key:p,value:Kr(e[p])})},parseQuery:function(e){if(e)for(var t,n,r=iN(e,"&"),i=0;i<r.length;)(t=r[i++]).length&&(n=iN(t,"="),Cc(this.entries,{key:sN(oK(n)),value:sN(nN(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],Cc(n,aN(e.key)+"="+aN(e.value));return nN(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Kf=function(){qO(this,Hd);var e=ZO(this,new cN(arguments.length>0?arguments[0]:void 0));Wd||(this.size=e.entries.length)},Hd=Kf.prototype;if(WH(Hd,{append:function(e,t){var n=Ki(this);Gd(arguments.length,2),Cc(n.entries,{key:Kr(e),value:Kr(t)}),Wd||this.length++,n.updateURL()},delete:function(e){for(var t=Ki(this),n=Gd(arguments.length,1),r=t.entries,i=Kr(e),a=n<2?void 0:arguments[1],c=a===void 0?a:Kr(a),l=0;l<r.length;){var u=r[l];if(u.key!==i||c!==void 0&&u.value!==c)l++;else if(rN(r,l,1),c!==void 0)break}Wd||(this.size=r.length),t.updateURL()},get:function(e){var t=Ki(this).entries;Gd(arguments.length,1);for(var n=Kr(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=Ki(this).entries;Gd(arguments.length,1);for(var n=Kr(e),r=[],i=0;i<t.length;i++)t[i].key===n&&Cc(r,t[i].value);return r},has:function(e){for(var t=Ki(this).entries,n=Gd(arguments.length,1),r=Kr(e),i=n<2?void 0:arguments[1],a=i===void 0?i:Kr(i),c=0;c<t.length;){var l=t[c++];if(l.key===r&&(a===void 0||l.value===a))return!0}return!1},set:function(e,t){var n=Ki(this);Gd(arguments.length,1);for(var r,i=n.entries,a=!1,c=Kr(e),l=Kr(t),u=0;u<i.length;u++)(r=i[u]).key===c&&(a?rN(i,u--,1):(a=!0,r.value=l));a||Cc(i,{key:c,value:l}),Wd||(this.size=i.length),n.updateURL()},sort:function(){var e=Ki(this);QH(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=Ki(this).entries,r=zH(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new TT(this,"keys")},values:function(){return new TT(this,"values")},entries:function(){return new TT(this,"entries")}},{enumerable:!0}),YO(Hd,ZH,Hd.entries,{name:"entries"}),YO(Hd,"toString",function(){return Ki(this).serialize()},{enumerable:!0}),Wd&&BH(Hd,"size",{get:function(){return Ki(this).entries.length},configurable:!0,enumerable:!0}),GH(Kf,Hu),pT({global:!0,constructor:!0,forced:!zO},{URLSearchParams:Kf}),!zO&&mT(Ku)){var pK=rs(eN.has),fK=rs(eN.set),dN=function(e){if(JO(e)){var t,n=e.body;if(YH(n)===Hu)return t=e.headers?new Ku(e.headers):new Ku,pK(t,"content-type")||fK(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),JH(e,{body:XO(0,Kr(n)),headers:XO(0,t)})}return e};if(mT($O)&&pT({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return $O(e,arguments.length>1?dN(arguments[1]):{})}}),mT(Hf)){var vT=function(e){return qO(this,gT),new Hf(e,arguments.length>1?dN(arguments[1]):{})};gT.constructor=vT,vT.prototype=gT,pT({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:vT})}}var mK={URLSearchParams:Kf,getState:Ki},lN=_(vo.URLSearchParams),_K={isBrowser:!0,classes:{URLSearchParams:lN!==void 0?lN:QS,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const uN=typeof window<"u"&&typeof document<"u",EK=(hN=typeof navigator<"u"&&navigator.product,uN&&["ReactNative","NativeScript","NS"].indexOf(hN)<0);var hN;const gK=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function";function pN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function fN(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?pN(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pN(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var is=fN(fN({},Object.freeze({__proto__:null,hasBrowserEnv:uN,hasStandardBrowserEnv:EK,hasStandardBrowserWebWorkerEnv:gK})),_K),SK=Dr,TK=De,vK=Jn,yK=G,CK=function(){var e=SK(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},mN=RegExp.prototype,_N=function(e){var t=e.flags;return t!==void 0||"flags"in mN||vK(e,"flags")||!yK(mN,e)?t:TK(CK,e)},RK=AS.charAt,EN=De,wK=Dr,IK=je,bK=Pe,AK=/./.exec,OK=TypeError,NK=bt,gN=De,SN=dt,DK=qg,zf=Xg,TN=vd,vN=pw,zu=Ci,PK=Dr,LK=Td,kK=Pe,MK=mw,yN=_N,xK=Yp,UK=g,jK=tS,VK=function(e,t,n){return t+(n?RK(e,t).length:1)},FK=function(e,t){var n=e.exec;if(IK(n)){var r=EN(n,e,t);return r!==null&&wK(r),r}if(bK(e)==="RegExp")return EN(AK,e,t);throw OK("RegExp#exec called on incompatible receiver")},CN=gc,BK=on("matchAll"),RN="RegExp String",wN=RN+" Iterator",WK=CN.set,GK=CN.getterFor(wN),HK=TypeError,yT=SN("".indexOf),Yf=SN("".matchAll),CT=!!Yf&&!UK(function(){Yf("a",/./)}),KK=DK(function(e,t,n,r){WK(this,{type:wN,regexp:e,string:t,global:n,unicode:r,done:!1})},RN,function(){var e=GK(this);if(e.done)return zf(void 0,!0);var t=e.regexp,n=e.string,r=FK(t,n);return r===null?(e.done=!0,zf(void 0,!0)):e.global?(zu(r[0])===""&&(t.lastIndex=VK(n,vN(t.lastIndex),e.unicode)),zf(r,!1)):(e.done=!0,zf(r,!1))}),IN=function(e){var t,n,r,i=PK(this),a=zu(e),c=jK(i,RegExp),l=zu(yN(i));return t=new c(c===RegExp?i.source:i,l),n=!!~yT(l,"g"),r=!!~yT(l,"u"),t.lastIndex=vN(i.lastIndex),new KK(t,a,n,r)};NK({target:"String",proto:!0,forced:CT},{matchAll:function(e){var t,n,r,i,a=TN(this);if(LK(e)){if(CT)return Yf(a,e)}else{if(MK(e)&&(t=zu(TN(yN(e))),!~yT(t,"g")))throw HK("`.matchAll` does not allow non-global regexes");if(CT)return Yf(a,e);if((r=xK(e,BK))===void 0&&kK(e)=="RegExp"&&(r=IN),r)return gN(r,e,a)}return n=zu(a),i=new RegExp(e,"g"),gN(IN,i,n)}});var zK=Gi("String").matchAll,YK=G,qK=zK,RT=String.prototype,JK=function(e){var t=e.matchAll;return typeof e=="string"||e===RT||YK(RT,e)&&t===RT.matchAll?qK:t},XK=_(JK);function bN(e){function t(n,r,i,a){let c=n[a++];if(c==="__proto__")return!0;const l=Number.isFinite(+c),u=a>=n.length;return c=!c&&Se.isArray(i)?i.length:c,u?(Se.hasOwnProp(i,c)?i[c]=[i[c],r]:i[c]=r,!l):(i[c]&&Se.isObject(i[c])||(i[c]=[]),t(n,r,i[c],a)&&Se.isArray(i[c])&&(i[c]=function(p){const f={},m=Object.keys(p);let E;const S=m.length;let I;for(E=0;E<S;E++)I=m[E],f[I]=p[I];return f}(i[c])),!l)}if(Se.isFormData(e)&&Se.isFunction(e.entries)){const n={};return Se.forEachEntry(e,(r,i)=>{t(function(a){return XK(Se).call(Se,/\w+|\[(\w*)]/g,a).map(c=>c[0]==="[]"?"":c[1]||c[0])}(r),i,n,0)}),n}return null}const wT={transitional:MA,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=Se.isObject(e);if(i&&Se.isHTMLForm(e)&&(e=new FormData(e)),Se.isFormData(e))return r?JSON.stringify(bN(e)):e;if(Se.isArrayBuffer(e)||Se.isBuffer(e)||Se.isStream(e)||Se.isFile(e)||Se.isBlob(e))return e;if(Se.isArrayBufferView(e))return e.buffer;if(Se.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(c,l){return kf(c,new is.classes.URLSearchParams,Object.assign({visitor:function(u,p,f,m){return is.isNode&&Se.isBuffer(u)?(this.append(p,u.toString("base64")),!1):m.defaultVisitor.apply(this,arguments)}},l))}(e,this.formSerializer).toString();if((a=Se.isFileList(e))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return kf(a?{"files[]":e}:e,c&&new c,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(c,l,u){if(Se.isString(c))try{return(l||JSON.parse)(c),sr(Se).call(Se,c)}catch(p){if(p.name!=="SyntaxError")throw p}return(0,JSON.stringify)(c)}(e)):e}],transformResponse:[function(e){const t=this.transitional||wT.transitional,n=t&&t.forcedJSONParsing,r=this.responseType==="json";if(e&&Se.isString(e)&&(n&&!this.responseType||r)){const i=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(a){if(i)throw a.name==="SyntaxError"?Ft.from(a,Ft.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:is.classes.FormData,Blob:is.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Se.forEach(["delete","get","head","post","put","patch"],e=>{wT.headers[e]={}});var IT=wT;const QK=Se.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),AN=Symbol("internals");function Yu(e){var t;return e&&sr(t=String(e)).call(t).toLowerCase()}function qf(e){return e===!1||e==null?e:Se.isArray(e)?e.map(qf):String(e)}function bT(e,t,n,r,i){return Se.isFunction(r)?r.call(this,t,n):(i&&(t=n),Se.isString(t)?Se.isString(r)?t.indexOf(r)!==-1:Se.isRegExp(r)?r.test(t):void 0:void 0)}class Jf{constructor(t){t&&this.set(t)}set(t,n,r){const i=this;function a(u,p,f){const m=Yu(p);if(!m)throw new Error("header name must be a non-empty string");const E=Se.findKey(i,m);(!E||i[E]===void 0||f===!0||f===void 0&&i[E]!==!1)&&(i[E||p]=qf(u))}const c=(u,p)=>Se.forEach(u,(f,m)=>a(f,m,p));var l;return Se.isPlainObject(t)||t instanceof this.constructor?c(t,n):Se.isString(t)&&(t=sr(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(sr(l=t).call(l))?c((u=>{const p={};let f,m,E;return u&&u.split(`
`).forEach(function(S){var I,v;E=S.indexOf(":"),f=sr(I=S.substring(0,E)).call(I).toLowerCase(),m=sr(v=S.substring(E+1)).call(v),!f||p[f]&&QK[f]||(f==="set-cookie"?p[f]?p[f].push(m):p[f]=[m]:p[f]=p[f]?p[f]+", "+m:m)}),p})(t),n):t!=null&&a(n,t,r),this}get(t,n){if(t=Yu(t)){const r=Se.findKey(this,t);if(r){const i=this[r];if(!n)return i;if(n===!0)return function(a){const c=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let u;for(;u=l.exec(a);)c[u[1]]=u[2];return c}(i);if(Se.isFunction(n))return n.call(this,i,r);if(Se.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=Yu(t)){const r=Se.findKey(this,t);return!(!r||this[r]===void 0||n&&!bT(0,this[r],r,n))}return!1}delete(t,n){const r=this;let i=!1;function a(c){if(c=Yu(c)){const l=Se.findKey(r,c);!l||n&&!bT(0,r[l],l,n)||(delete r[l],i=!0)}}return Se.isArray(t)?t.forEach(a):a(t),i}clear(t){const n=Object.keys(this);let r=n.length,i=!1;for(;r--;){const a=n[r];t&&!bT(0,this[a],a,t,!0)||(delete this[a],i=!0)}return i}normalize(t){const n=this,r={};return Se.forEach(this,(i,a)=>{var c;const l=Se.findKey(r,a);if(l)return n[l]=qf(i),void delete n[a];const u=t?function(p){return sr(p).call(p).toLowerCase().replace(/([a-z\d])(\w*)/g,(f,m,E)=>m.toUpperCase()+E)}(a):sr(c=String(a)).call(c);u!==a&&delete n[a],n[u]=qf(i),r[u]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return Se.forEach(this,(r,i)=>{r!=null&&r!==!1&&(n[i]=t&&Se.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,r]=t;return n+": "+r}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return i.forEach(c=>n.set(c)),n}static accessor(t){const n=(this[AN]=this[AN]={accessors:{}}).accessors,r=this.prototype;function i(a){const c=Yu(a);n[c]||(function(l,u){const p=Se.toCamelCase(" "+u);["get","set","has"].forEach(f=>{Object.defineProperty(l,f+p,{value:function(m,E,S){return this[f].call(this,u,m,E,S)},configurable:!0})})}(r,a),n[c]=!0)}return Se.isArray(t)?t.forEach(i):i(t),this}}Jf.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Se.reduceDescriptors(Jf.prototype,(e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(i){this[r]=i}}}),Se.freezeMethods(Jf);var Os=Jf;function AT(e,t){const n=this||IT,r=t||n,i=Os.from(r.headers);let a=r.data;return Se.forEach(e,function(c){a=c.call(n,a,i.normalize(),t?t.status:void 0)}),i.normalize(),a}function ON(e){return!(!e||!e.__CANCEL__)}function qu(e,t,n){Ft.call(this,e??"canceled",Ft.ERR_CANCELED,t,n),this.name="CanceledError"}Se.inherits(qu,Ft,{__CANCEL__:!0});var ZK=is.hasStandardBrowserEnv?{write(e,t,n,r,i,a){const c=[e+"="+encodeURIComponent(t)];Se.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),Se.isString(r)&&c.push("path="+r),Se.isString(i)&&c.push("domain="+i),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function NN(e,t){return e&&!function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(t)?function(n,r){return r?n.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):n}(e,t):t}var $K=is.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function r(i){let a=i;return e&&(t.setAttribute("href",a),a=t.href),t.setAttribute("href",a),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return n=r(window.location.href),function(i){const a=Se.isString(i)?r(i):i;return a.protocol===n.protocol&&a.host===n.host}}():function(){return!0};function DN(e,t){let n=0;const r=function(i,a){i=i||10;const c=new Array(i),l=new Array(i);let u,p=0,f=0;return a=a!==void 0?a:1e3,function(m){const E=Date.now(),S=l[f];u||(u=E),c[p]=m,l[p]=E;let I=f,v=0;for(;I!==p;)v+=c[I++],I%=i;if(p=(p+1)%i,p===f&&(f=(f+1)%i),E-u<a)return;const y=S&&E-S;return y?Math.round(1e3*v/y):void 0}}(50,250);return i=>{const a=i.loaded,c=i.lengthComputable?i.total:void 0,l=a-n,u=r(l);n=a;const p={loaded:a,total:c,progress:c?a/c:void 0,bytes:l,rate:u||void 0,estimated:u&&c&&a<=c?(c-a)/u:void 0,event:i};p[t?"download":"upload"]=!0,e(p)}}var ez=typeof XMLHttpRequest<"u"&&function(e){return new ce(function(t,n){let r=e.data;const i=Os.from(e.headers).normalize();let a,c,{responseType:l,withXSRFToken:u}=e;function p(){e.cancelToken&&e.cancelToken.unsubscribe(a),e.signal&&e.signal.removeEventListener("abort",a)}if(Se.isFormData(r)){if(is.hasStandardBrowserEnv||is.hasStandardBrowserWebWorkerEnv)i.setContentType(!1);else if((c=i.getContentType())!==!1){const[I,...v]=c?c.split(";").map(y=>sr(y).call(y)).filter(Boolean):[];i.setContentType([I||"multipart/form-data",...v].join("; "))}}let f=new XMLHttpRequest;if(e.auth){const I=e.auth.username||"",v=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";i.set("Authorization","Basic "+btoa(I+":"+v))}const m=NN(e.baseURL,e.url);function E(){if(!f)return;const I=Os.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());(function(v,y,b){const D=b.config.validateStatus;b.status&&D&&!D(b.status)?y(new Ft("Request failed with status code "+b.status,[Ft.ERR_BAD_REQUEST,Ft.ERR_BAD_RESPONSE][Math.floor(b.status/100)-4],b.config,b.request,b)):v(b)})(function(v){t(v),p()},function(v){n(v),p()},{data:l&&l!=="text"&&l!=="json"?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:I,config:e,request:f}),f=null}if(f.open(e.method.toUpperCase(),LA(m,e.params,e.paramsSerializer),!0),f.timeout=e.timeout,"onloadend"in f?f.onloadend=E:f.onreadystatechange=function(){f&&f.readyState===4&&(f.status!==0||f.responseURL&&f.responseURL.indexOf("file:")===0)&&setTimeout(E)},f.onabort=function(){f&&(n(new Ft("Request aborted",Ft.ECONNABORTED,e,f)),f=null)},f.onerror=function(){n(new Ft("Network Error",Ft.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let I=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const v=e.transitional||MA;e.timeoutErrorMessage&&(I=e.timeoutErrorMessage),n(new Ft(I,v.clarifyTimeoutError?Ft.ETIMEDOUT:Ft.ECONNABORTED,e,f)),f=null},is.hasStandardBrowserEnv&&(u&&Se.isFunction(u)&&(u=u(e)),u||u!==!1&&$K(m))){const I=e.xsrfHeaderName&&e.xsrfCookieName&&ZK.read(e.xsrfCookieName);I&&i.set(e.xsrfHeaderName,I)}r===void 0&&i.setContentType(null),"setRequestHeader"in f&&Se.forEach(i.toJSON(),function(I,v){f.setRequestHeader(v,I)}),Se.isUndefined(e.withCredentials)||(f.withCredentials=!!e.withCredentials),l&&l!=="json"&&(f.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&f.addEventListener("progress",DN(e.onDownloadProgress,!0)),typeof e.onUploadProgress=="function"&&f.upload&&f.upload.addEventListener("progress",DN(e.onUploadProgress)),(e.cancelToken||e.signal)&&(a=I=>{f&&(n(!I||I.type?new qu(null,e,f):I),f.abort(),f=null)},e.cancelToken&&e.cancelToken.subscribe(a),e.signal&&(e.signal.aborted?a():e.signal.addEventListener("abort",a)));const S=function(I){const v=/^([-+\w]{1,25})(:?\/\/|:)/.exec(I);return v&&v[1]||""}(m);S&&is.protocols.indexOf(S)===-1?n(new Ft("Unsupported protocol "+S+":",Ft.ERR_BAD_REQUEST,e)):f.send(r||null)})};const OT={http:null,xhr:ez};Se.forEach(OT,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const PN=e=>"- ".concat(e),tz=e=>Se.isFunction(e)||e===null||e===!1;var LN={getAdapter:e=>{e=Se.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let a=0;a<t;a++){let c;if(n=e[a],r=n,!tz(n)&&(r=OT[(c=String(n)).toLowerCase()],r===void 0))throw new Ft("Unknown adapter '".concat(c,"'"));if(r)break;i[c||"#"+a]=r}if(!r){const a=Object.entries(i).map(c=>{let[l,u]=c;return"adapter ".concat(l," ")+(u===!1?"is not supported by the environment":"is not available in the build")});throw new Ft("There is no suitable adapter to dispatch the request "+(t?a.length>1?`since :
`+a.map(PN).join(`
`):" "+PN(a[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:OT};function NT(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new qu(null,e)}function kN(e){return NT(e),e.headers=Os.from(e.headers),e.data=AT.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),LN.getAdapter(e.adapter||IT.adapter)(e).then(function(t){return NT(e),t.data=AT.call(e,e.transformResponse,t),t.headers=Os.from(t.headers),t},function(t){return ON(t)||(NT(e),t&&t.response&&(t.response.data=AT.call(e,e.transformResponse,t.response),t.response.headers=Os.from(t.response.headers))),ce.reject(t)})}function MN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}const xN=e=>e instanceof Os?function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?MN(Object(r),!0).forEach(function(i){w(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):MN(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}({},e):e;function Kd(e,t){t=t||{};const n={};function r(p,f,m){return Se.isPlainObject(p)&&Se.isPlainObject(f)?Se.merge.call({caseless:m},p,f):Se.isPlainObject(f)?Se.merge({},f):Se.isArray(f)?f.slice():f}function i(p,f,m){return Se.isUndefined(f)?Se.isUndefined(p)?void 0:r(void 0,p,m):r(p,f,m)}function a(p,f){if(!Se.isUndefined(f))return r(void 0,f)}function c(p,f){return Se.isUndefined(f)?Se.isUndefined(p)?void 0:r(void 0,p):r(void 0,f)}function l(p,f,m){return m in t?r(p,f):m in e?r(void 0,p):void 0}const u={url:a,method:a,data:a,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l,headers:(p,f)=>i(xN(p),xN(f),!0)};return Se.forEach(Object.keys(Object.assign({},e,t)),function(p){const f=u[p]||i,m=f(e[p],t[p],p);Se.isUndefined(m)&&f!==l||(n[p]=m)}),n}const UN="1.6.8",DT={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{DT[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const jN={};DT.transitional=function(e,t,n){function r(i,a){return"[Axios v"+UN+"] Transitional option '"+i+"'"+a+(n?". "+n:"")}return(i,a,c)=>{if(e===!1)throw new Ft(r(a," has been removed"+(t?" in "+t:"")),Ft.ERR_DEPRECATED);return t&&!jN[a]&&(jN[a]=!0,console.warn(r(a," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,a,c)}};var PT={assertOptions:function(e,t,n){if(typeof e!="object")throw new Ft("options must be an object",Ft.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const a=r[i],c=t[a];if(c){const l=e[a],u=l===void 0||c(l,a,e);if(u!==!0)throw new Ft("option "+a+" must be "+u,Ft.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new Ft("Unknown option "+a,Ft.ERR_BAD_OPTION)}},validators:DT};const ua=PT.validators;let Xf=class{constructor(e){this.defaults=e,this.interceptors={request:new kA,response:new kA}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Kd(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;n!==void 0&&PT.assertOptions(n,{silentJSONParsing:ua.transitional(ua.boolean),forcedJSONParsing:ua.transitional(ua.boolean),clarifyTimeoutError:ua.transitional(ua.boolean)},!1),r!=null&&(Se.isFunction(r)?t.paramsSerializer={serialize:r}:PT.assertOptions(r,{encode:ua.function,serialize:ua.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=i&&Se.merge(i.common,i[t.method]);i&&Se.forEach(["delete","get","head","post","put","patch","common"],S=>{delete i[S]}),t.headers=Os.concat(a,i);const c=[];let l=!0;this.interceptors.request.forEach(function(S){typeof S.runWhen=="function"&&S.runWhen(t)===!1||(l=l&&S.synchronous,c.unshift(S.fulfilled,S.rejected))});const u=[];let p;this.interceptors.response.forEach(function(S){u.push(S.fulfilled,S.rejected)});let f,m=0;if(!l){const S=[kN.bind(this),void 0];for(S.unshift.apply(S,c),S.push.apply(S,u),f=S.length,p=ce.resolve(t);m<f;)p=p.then(S[m++],S[m++]);return p}f=c.length;let E=t;for(m=0;m<f;){const S=c[m++],I=c[m++];try{E=S(E)}catch(v){I.call(this,v);break}}try{p=kN.call(this,E)}catch(S){return ce.reject(S)}for(m=0,f=u.length;m<f;)p=p.then(u[m++],u[m++]);return p}getUri(e){return LA(NN((e=Kd(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};Se.forEach(["delete","get","head","options"],function(e){Xf.prototype[e]=function(t,n){return this.request(Kd(n||{},{method:e,url:t,data:(n||{}).data}))}}),Se.forEach(["post","put","patch"],function(e){function t(n){return function(r,i,a){return this.request(Kd(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}Xf.prototype[e]=t(),Xf.prototype[e+"Form"]=t(!0)});var Qf=Xf;class LT{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new ce(function(i){n=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](i);r._listeners=null}),this.promise.then=i=>{let a;const c=new ce(l=>{r.subscribe(l),a=l}).then(i);return c.cancel=function(){r.unsubscribe(a)},c},t(function(i,a,c){r.reason||(r.reason=new qu(i,a,c),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}static source(){let t;return{token:new LT(function(n){t=n}),cancel:t}}}var nz=LT;const kT={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(kT).forEach(e=>{let[t,n]=e;kT[n]=t});var rz=kT;const er=function e(t){const n=new Qf(t),r=EA(Qf.prototype.request,n);return Se.extend(r,Qf.prototype,n,{allOwnKeys:!0}),Se.extend(r,n,null,{allOwnKeys:!0}),r.create=function(i){return e(Kd(t,i))},r}(IT);er.Axios=Qf,er.CanceledError=qu,er.CancelToken=nz,er.isCancel=ON,er.VERSION=UN,er.toFormData=kf,er.AxiosError=Ft,er.Cancel=er.CanceledError,er.all=function(e){return ce.all(e)},er.spread=function(e){return function(t){return e.apply(null,t)}},er.isAxiosError=function(e){return Se.isObject(e)&&e.isAxiosError===!0},er.mergeConfig=Kd,er.AxiosHeaders=Os,er.formToJSON=e=>bN(Se.isHTMLForm(e)?new FormData(e):e),er.getAdapter=LN.getAdapter,er.HttpStatusCode=rz,er.default=er;var Rr=er;const iz=()=>{};function Ju(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:iz};return e.promise=new ce((t,n)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=r=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(r))}}),e}const Zf=new Map,$f=new Map,os=new Map;let yn=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),lt=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const VN=new wG;let Ro=VN.getResult(),MT=null;function tt(e){if(!MT){Ro=VN.getResult();const t=function(l){if(l.engine.name==="Blink"&&l.browser.name!=="WeChat")return lt.CHROME;switch(l.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return lt.CHROME;case"Safari":case"Mobile Safari":return lt.SAFARI;case"Edge":return lt.EDGE;case"Firefox":return lt.FIREFOX;case"QQ":case"QQBrowser":return lt.QQ;case"Opera":return lt.OPERA;case"WeChat":return lt.WECHAT;default:return l.browser.name||""}}(Ro),n=FN(Ro),r=function(l){return l.os.name==="Windows"?l.os.version?l.os.name+" "+l.os.version:l.os.name:l.os.name||""}(Ro),i=Ro.os.version,a=FN(Ro,!1),c=Ro.device.type;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i,browserVersion:a,deviceType:c};MT={name:t,version:n,os:r,osVersion:i,browserVersion:a,deviceType:c}}return MT}function FN(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function em(){return tt().os}function BN(){const e=tt();return"".concat(e.os," ").concat(e.osVersion)}function tm(){const e=tt();return!!(Ro.engine.name==="WebKit"&&e.os===yn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==lt.SAFARI||Xn()&&e.name!==lt.SAFARI)}function ha(){return tt().name===lt.CHROME}function Cn(){return tt().name===lt.SAFARI}function WN(){return tt().name===lt.EDGE}function yt(){return tt().name===lt.FIREFOX}function Xn(){return tt().os===yn.IOS}function xT(e){const t=tt();return!(t.name!==lt.CHROME||!t.osVersion)&&Number(t.version)>=e}function GN(e){const t=tt();return!(t.name!==lt.EDGE||!t.osVersion)&&Number(t.version)>=e}function HN(e){const t=tt();return!(t.name!==lt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function KN(e,t,n){const r=tt();if(r.os!==yn.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e}function zN(e,t,n){const r=tt();if(r.name!==lt.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e}function YN(e){const t=tt();return!(t.name!==lt.OPERA||!t.osVersion)&&Number(t.version)>=e}function qN(){const e=tt();return!(e.name!==lt.CHROME||!e.osVersion)&&Number(e.version)<=90}function JN(){const e=tt();if(e.os!==yn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function zd(){const e=tt();if(e.os!==yn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function UT(){const e=tt();if(e.os!==yn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function XN(){const e=tt();if(e.os!==yn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function zi(){return Cn()&&navigator.maxTouchPoints>0}function QN(){return tt().name===lt.WECHAT}function ZN(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function jT(){const e=em();return function(){const{deviceType:t}=tt();return t==="mobile"||t==="tablet"}()||e===yn.ANDROID||e===yn.IOS||e===yn.HARMONY_OS}function pa(){const e=tt();return e.name!==lt.EDGE&&e.name!==lt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function nm(){return em()===yn.ANDROID}function Xu(){const e=tt();return nm()&&(e.name===lt.CHROME||e.name===lt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function $N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Re(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$N(Object(n),!0).forEach(function(r){kt(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$N(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function kt(e,t,n){return(t=function(r){var i=function(a,c){if(typeof a!="object"||a===null)return a;var l=a[Symbol.toPrimitive];if(l!==void 0){var u=l.call(a,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(r);return typeof i=="symbol"?i:String(i)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let O=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({});class J extends Error{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(n),kt(this,"code",void 0),kt(this,"message",void 0),kt(this,"data",void 0),kt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=r}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",n=arguments.length>1?arguments[1]:void 0;return t==="error"&&(n||console).error(this.toString()),t==="warning"&&(n||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}}function Ns(e,t){if(typeof e!="boolean")throw new J(O.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Sn(e,t,n){if(!ue(n).call(n,e))throw new J(O.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function St(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(i){return typeof i=="number"&&i%1==0}(e))throw new J(O.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function VT(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new J(O.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&St(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&St(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&St(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&St(e.ideal,"".concat(t,".ideal"),1,1/0)}else St(e,t,1,1/0)}function Mn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new J(O.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!e1(e,n,r,i))throw new J(O.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function Ds(e,t){if(!Array.isArray(e))throw new J(O.INVALID_PARAMS,"".concat(t," should be an array"))}function Ht(e){return e==null}function e1(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!r||function(i){if(typeof i!="string")return!1;for(let a=0;a<i.length;a+=1){const c=i.charCodeAt(a);if(c<0||c>255)return!1}return!0}(e))}function t1(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);const r=e.getUint32(t,n),i=e.getUint32(t+4,n),a=+!!n,c=+!n;return BigInt(r*c+i*a)<<BigInt(32)|BigInt(r*a+i*c)}function n1(e,t,n,r){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,r);const i=Number(n>>BigInt(32)),a=Number(n&BigInt(4294967295));e.setUint32(t,i,r),e.setUint32(t+4,a,r)}var Qu=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(Qu||{}),FT=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(FT||{});const r1=new class{constructor(){kt(this,"_clientSize",null),kt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),kt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),kt(this,"getStyle",e=>window.getComputedStyle(e,null)),kt(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const r=this.getStyle(e),{display:i,visibility:a,opacity:c,filter:l}=r;return(i==="none"||ue(t=["hidden","collapse"]).call(t,a)||Number(c)<.1)&&(n=!1),!!n&&(l&&l.split(" ").filter(u=>{var p;const f=u.split("(")[0];return ue(p=["brightness","blur","opacity"]).call(p,f)}).map(u=>{const[p,f]=u.split(/\(|\)/);return[p,Number(f.match(/^[0-9\.]+/))]}).forEach(u=>{const[p,f]=u;switch(p){case"brightness":(f<.1||f>3)&&(n=!1);break;case"blur":f>3&&(n=!1);break;case"opacity":f<.1&&(n=!1)}}),n)}),kt(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,r=!0;const i=c=>t(c);let a=e;for(;a&&r;)i(a)||(n=!1,r=!1),a=a.parentElement,a||(r=!1);return n}),kt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),kt(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:r,right:i,top:a,bottom:c}=e.getBoundingClientRect(),l=this.getClientWidth(),u=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:a,bottom:c,clientWidth:l,clientHeight:u,clientMin:Math.min(l,u)}}),kt(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),kt(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),kt(this,"checkCoverForAPoint",(e,t,n)=>{const r=this.elementFromPoint(e,t);return r!==null&&r!==n}),kt(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,a=t/6,c=[],l=10**6;for(let u=0;u<5;u++)for(let p=0;p<5;p++){const f=(n*l+(u===0?.1:u===4?(i*u*l-1e5)/l:i*u)*l)/l,m=(r*l+(p===0?.1:p===4?(a*p*l-1e5)/l:a*p)*l)/l;c.push({x:f,y:m})}return[...c]}),kt(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),kt(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),kt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:i,clientWidth:a,clientMin:c}=this._clientSize;let l,u,p,f;if(e<0)l=0;else{if(!(e<a))return!1;l=e}if(t<0)return!1;if(u=t<a?t:a,n<0)p=0;else{if(!(n<i))return!1;p=n}if(r<0)return!1;f=r<i?r:i;const m=u-l,E=f-p;return this.checkSizeIsVisible(m,E,c)}),kt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),kt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Qu.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(Qu.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Qu.SIZE)}}return this.returnHiddenResult(Qu.STYLE)}return this.returnHiddenResult(FT.UNMOUNTED)}return this.returnHiddenResult(FT.INVALID_HTML_ELEMENT)}),kt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function BT(e){return new TextEncoder().encode(e)}const i1=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},WT=async e=>function(t,n){let r="";return new Uint8Array(t).forEach(i=>{r+=i.toString(n).padStart(2,"0")}),r}(await crypto.subtle.digest("SHA-256",BT(e)),16);let xt=class{constructor(){kt(this,"_events",{}),kt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],r=this._indexOfListener(n,t);r!==-1&&n.splice(r,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(a=>a);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(let a=0;a<t.length;a+=1){const c=t[a];c.once&&this.off(e,c.listener),c.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];[...this._events[e]||[]].forEach(i=>{i.once&&this.off(e,i.listener);try{i.listener.apply(this,n)}catch(a){console.error("safeEmit event:".concat(e," error ").concat(a==null?void 0:a.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},Zu=null;function o1(){if(Zu)return Zu;if(window.electron)return Zu=window.electron;if(!window.require)return null;try{return Zu=window.require("electron"),Zu}catch{return null}}let un=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.DATACHANNEL_FAILBACK="Client._datachannelFailback",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e}({}),Kt=function(e){return e.TRACER="tracer",e}({});function s1(e){return St(e.timeout,"config.timeout",0,1e5),St(e.timeoutFactor,"config.timeoutFactor",0,100,!1),St(e.maxRetryCount,"config.maxRetryConfig",0,1/0),St(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let oz=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),qe=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.FALLBACK="FALLBACK",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function Yd(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function a1(e){return Mn(e.turnServerURL,"turnServerURL"),Mn(e.username,"username"),Mn(e.password,"password"),e.udpport&&St(e.udpport,"udpport",1,99999,!0),e.forceturn&&Ns(e.forceturn,"forceturn"),e.security&&Ns(e.security,"security"),e.tcpport&&St(e.tcpport,"tcpport",1,99999,!0),!0}function c1(e){return e.level!==void 0&&Sn(e.level,"level",[1,2,3]),e.delay!==void 0&&St(e.delay,"delay",0,3e3,!0),!0}let Je=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Wn=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),mr=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Rc=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function hn(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return e.getListeners(t).length===0?ce.reject(new J(O.UNEXPECTED_ERROR,"can not emit promise")):new ce((a,c)=>{e.emit(t,...r,a,c)})}function Ct(e,t){if(e.getListeners(t).length===0)return ce.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return hn(e,t,...r)}function zr(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return wc(e,t,...r)}function wc(e,t){let n=null,r=null;for(var i=arguments.length,a=new Array(i>2?i-2:0),c=2;c<i;c++)a[c-2]=arguments[c];if(e.emit(t,...a,l=>{n=l},l=>{r=l}),r!==null)throw r;if(n===null)throw new J(O.UNEXPECTED_ERROR,"handler is not sync");return n}const zt=new class extends xt{set networkState(e){this.emit(Rc.NETWORK_STATE_CHANGE,e,this._networkState),e===mr.ONLINE?this.emit(Rc.ONLINE):e===mr.OFFLINE&&(this.onlineWaiter=new ce(t=>{this.once(Rc.ONLINE,()=>{this.onlineWaiter=void 0,t(mr.ONLINE)})}),this.emit(Rc.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===mr.ONLINE}constructor(){super(),kt(this,"_moduleName","network-indicator"),kt(this,"_networkState",mr.ONLINE),kt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=mr.ONLINE}),window.addEventListener("offline",()=>{this.networkState=mr.OFFLINE})}};function rm(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function qd(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function im(e){ce!==void 0?ce.resolve().then(e):setTimeout(e,0)}function At(e){return JSON.parse(JSON.stringify(e))}function Ic(e){try{return At(e)}catch{return e}}const d1={};function fa(e,t){d1[t]||(d1[t]=!0,e())}function bc(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function ma(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function l1(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const r=new Uint8Array(t);r.set(n),n=r}return n}function u1(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=yo(t).call(t,(c,l)=>c+l.length,0),i=new Uint8Array(new ArrayBuffer(r));let a=0;return t.forEach(c=>{i.set(c,a),a+=c.length}),i}function ss(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function h1(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?ss(n):n.size}),t+138}function sz(e){const t=new J(O.TIMEOUT,"timeout");return new ce((n,r)=>{window.setTimeout(()=>r(t),e)})}function Rn(e){return new ce(t=>{window.setTimeout(t,e)})}function Rt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+Rt(e-n.length,"")}function $u(){return Rt(32,"").toUpperCase()}const om=()=>{},p1=new class{constructor(){kt(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,a=new Array(i>4?i-4:0),c=4;c<i;c++)a[c-4]=arguments[c];if(this.fnMap.has(t)){const l=this.fnMap.get(t);if(l.threshold!==n){l.fn(...l.args),clearTimeout(l.timer);const u=window.setTimeout(()=>{const p=this.fnMap.get(t);p&&p.fn(...p.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:u,args:a,skipFn:r})}else l.skipFn&&l.skipFn(...l.args),this.fnMap.set(t,Re(Re({},l),{},{fn:e,args:a,skipFn:r}))}else{const l=window.setTimeout(()=>{const u=this.fnMap.get(t);u&&u.fn(...u.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:l,args:a,skipFn:r})}}},f1=p1.throttleByKey.bind(p1);function m1(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function GT(e,t){if(!m1(e)||!m1(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let r=0;r<t.length;r++)n[r]=GT(e[r],t[r]);return n}{const n=Re({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=GT(e[r],t[r]):n[r]=t[r]);return n}}function _1(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,r!==t););return n}function HT(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function E1(e){const t="0123456789abcdef";function n(U){let F,W="";for(F=0;F<=3;F++)W+=t.charAt(U>>8*F+4&15)+t.charAt(U>>8*F&15);return W}function r(U,F){const W=(65535&U)+(65535&F);return(U>>16)+(F>>16)+(W>>16)<<16|65535&W}function i(U,F,W,q,Q,ee){return r(function(ne,_e){return ne<<_e|ne>>>32-_e}(r(r(F,U),r(q,ee)),Q),W)}function a(U,F,W,q,Q,ee,ne){return i(F&W|~F&q,U,F,Q,ee,ne)}function c(U,F,W,q,Q,ee,ne){return i(F&q|W&~q,U,F,Q,ee,ne)}function l(U,F,W,q,Q,ee,ne){return i(F^W^q,U,F,Q,ee,ne)}function u(U,F,W,q,Q,ee,ne){return i(W^(F|~q),U,F,Q,ee,ne)}const p=function(U){let F;const W=1+(U.length+8>>6),q=new Array(16*W);for(F=0;F<16*W;F++)q[F]=0;for(F=0;F<U.length;F++)q[F>>2]|=U.charCodeAt(F)<<F%4*8;return q[F>>2]|=128<<F%4*8,q[16*W-2]=8*U.length,q}(e);let f,m,E,S,I,v=1732584193,y=-271733879,b=-1732584194,D=271733878;for(f=0;f<p.length;f+=16)m=v,E=y,S=b,I=D,v=a(v,y,b,D,p[f+0],7,-680876936),D=a(D,v,y,b,p[f+1],12,-389564586),b=a(b,D,v,y,p[f+2],17,606105819),y=a(y,b,D,v,p[f+3],22,-1044525330),v=a(v,y,b,D,p[f+4],7,-176418897),D=a(D,v,y,b,p[f+5],12,1200080426),b=a(b,D,v,y,p[f+6],17,-1473231341),y=a(y,b,D,v,p[f+7],22,-45705983),v=a(v,y,b,D,p[f+8],7,1770035416),D=a(D,v,y,b,p[f+9],12,-1958414417),b=a(b,D,v,y,p[f+10],17,-42063),y=a(y,b,D,v,p[f+11],22,-1990404162),v=a(v,y,b,D,p[f+12],7,1804603682),D=a(D,v,y,b,p[f+13],12,-40341101),b=a(b,D,v,y,p[f+14],17,-1502002290),y=a(y,b,D,v,p[f+15],22,1236535329),v=c(v,y,b,D,p[f+1],5,-165796510),D=c(D,v,y,b,p[f+6],9,-1069501632),b=c(b,D,v,y,p[f+11],14,643717713),y=c(y,b,D,v,p[f+0],20,-373897302),v=c(v,y,b,D,p[f+5],5,-701558691),D=c(D,v,y,b,p[f+10],9,38016083),b=c(b,D,v,y,p[f+15],14,-660478335),y=c(y,b,D,v,p[f+4],20,-405537848),v=c(v,y,b,D,p[f+9],5,568446438),D=c(D,v,y,b,p[f+14],9,-1019803690),b=c(b,D,v,y,p[f+3],14,-187363961),y=c(y,b,D,v,p[f+8],20,1163531501),v=c(v,y,b,D,p[f+13],5,-1444681467),D=c(D,v,y,b,p[f+2],9,-51403784),b=c(b,D,v,y,p[f+7],14,1735328473),y=c(y,b,D,v,p[f+12],20,-1926607734),v=l(v,y,b,D,p[f+5],4,-378558),D=l(D,v,y,b,p[f+8],11,-2022574463),b=l(b,D,v,y,p[f+11],16,1839030562),y=l(y,b,D,v,p[f+14],23,-35309556),v=l(v,y,b,D,p[f+1],4,-1530992060),D=l(D,v,y,b,p[f+4],11,1272893353),b=l(b,D,v,y,p[f+7],16,-155497632),y=l(y,b,D,v,p[f+10],23,-1094730640),v=l(v,y,b,D,p[f+13],4,681279174),D=l(D,v,y,b,p[f+0],11,-358537222),b=l(b,D,v,y,p[f+3],16,-722521979),y=l(y,b,D,v,p[f+6],23,76029189),v=l(v,y,b,D,p[f+9],4,-640364487),D=l(D,v,y,b,p[f+12],11,-421815835),b=l(b,D,v,y,p[f+15],16,530742520),y=l(y,b,D,v,p[f+2],23,-995338651),v=u(v,y,b,D,p[f+0],6,-198630844),D=u(D,v,y,b,p[f+7],10,1126891415),b=u(b,D,v,y,p[f+14],15,-1416354905),y=u(y,b,D,v,p[f+5],21,-57434055),v=u(v,y,b,D,p[f+12],6,1700485571),D=u(D,v,y,b,p[f+3],10,-1894986606),b=u(b,D,v,y,p[f+10],15,-1051523),y=u(y,b,D,v,p[f+1],21,-2054922799),v=u(v,y,b,D,p[f+8],6,1873313359),D=u(D,v,y,b,p[f+15],10,-30611744),b=u(b,D,v,y,p[f+6],15,-1560198380),y=u(y,b,D,v,p[f+13],21,1309151649),v=u(v,y,b,D,p[f+4],6,-145523070),D=u(D,v,y,b,p[f+11],10,-1120210379),b=u(b,D,v,y,p[f+2],15,718787259),y=u(y,b,D,v,p[f+9],21,-343485551),v=r(v,m),y=r(y,E),b=r(b,S),D=r(D,I);return n(v)+n(y)+n(b)+n(D)}let az=1,sm=console,On=class{static setLogger(e){sm=e}constructor(e){kt(this,"lockingPromise",ce.resolve()),kt(this,"locks",0),kt(this,"name",""),kt(this,"lockId",void 0),this.lockId=az++,e&&(this.name=e),sm.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,sm.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:""));const n=new ce(i=>{t=()=>{this.locks-=1,sm.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:"")),i()}}),r=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),r}};function Jd(e,t){return function(n,r,i){const a=i.value;if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this[t];if(!c)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const l=await c.lock("From ".concat(e,".").concat(r));try{for(var u=arguments.length,p=new Array(u),f=0;f<u;f++)p[f]=arguments[f];return await a.apply(this,p)}finally{l()}},i}}const sn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function am(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function wo(e,t,n,r){const i=Object.assign({},sn,r);let a=i.timeout;const c=async()=>{await function(p){return new ce(f=>{window.setTimeout(f,p)})}(a),a*=i.timeoutFactor,a=Math.min(i.maxRetryTimeout,a)};let l=!1;const u=new ce(async(p,f)=>{t=t||(()=>!1),n=n||(()=>!0);for(let m=0;m<i.maxRetryCount;m+=1){if(l)return f(new J(O.OPERATION_ABORTED));try{const E=await e();if(!t(E,m)||m+1===i.maxRetryCount)return p(E);await c()}catch(E){if(!n(E,m)||m+1===i.maxRetryCount)return f(E);await c()}}});return u.cancel=()=>l=!0,u}class KT{constructor(t){kt(this,"input",[]),kt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:yo(t=this.input).call(t,(n,r)=>n+r)/this.input.length}}let cm,dm=0,zT=0;function YT(e,t,n,r){return new ce((i,a)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),dm+=ss(t.data)):n&&(t.data.size?dm+=t.data.size:t.data instanceof FormData?dm+=h1(t.data):dm+=ss(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Rr.request(t).then(c=>{typeof c.data=="string"?zT+=ss(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?zT+=c.data.byteLength:zT+=ss(JSON.stringify(c.data)),i(c.data)}).catch(c=>{Rr.isCancel(c)?a(new J(O.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?a(new J(O.NETWORK_TIMEOUT,c.message)):c.response?a(new J(O.NETWORK_RESPONSE_ERROR,c.response.status)):a(new J(O.NETWORK_ERROR,c.message))})})}async function cz(e,t){const n=new Blob([t.data],{type:"buffer"});return await YT(e,Re(Re({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const g1=()=>window.isSecureContext!==void 0,wi=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){const r=t[1],i=t[2];return"".concat(r,".").concat(i)}const n=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(n&&n[1]&&n[2]){const r=n[1],i=n[2];return"".concat(r,".").concat(100*(Number(i)+1))}return"4.0.0.999"}("4.21.0"),qT=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Ac=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const JT={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},XT="v4.21.0-0-g16fdae2c-dirty(6/3/2024, 2:55:18 PM)",_n={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:void 0,ENABLE_CC_FALLBACK:void 0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:JT,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0};function Tt(e,t,n){var r,i,a;ue(r=Object.keys(_n)).call(r,e)&&(!n&&ue(i=Object.keys(_a)).call(i,e)||(_n[e]=t,e==="ENABLE_VIDEO_SEI"&&t===!0&&(_n.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(a=!!t,_n.USE_NEW_NETWORK_CONFIG=a,a&&(_n.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],_n.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],_n.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],_n.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],_n.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",_n.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",_n.GATEWAY_DOMAINS=["edge.sd-rtn.com"]))))}function L(e){return _n[e]}const _a={};var ze=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(ze||{});class dz{constructor(t,n,r,i){kt(this,"state",void 0),this.state={codec:t,audioCodec:n,mode:r,clientId:i,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1,p2pTransport:Ac.Default}}dispatch(t){this.state=function(n,r){switch(r.type){case ze.SET_SESSION_ID:return Re(Re({},n),{},{sessionId:r.sessionId});case ze.SET_P2P_ID:return Re(Re({},n),{},{p2pId:r.p2pId});case ze.SET_UID:return Re(Re({},n),{},{uid:r.uid});case ze.SET_INT_UID:return Re(Re({},n),{},{intUid:r.intUid});case ze.SET_PUB_ID:return Re(Re({},n),{},{pubId:r.pubId});case ze.KEY_METRIC_CLIENT_CREATED:return Re(Re({},n),{},{keyMetrics:Re(Re({},n.keyMetrics),{},{clientCreated:r.metric})});case ze.KEY_METRIC_JOIN_START:return Re(Re({},n),{},{keyMetrics:Re(Re({},n.keyMetrics),{},{joinStart:r.metric})});case ze.AVOID_JOIN_START:return Re(Re({},n),{},{avoidJoinStart:r.avoidJoinStart});case ze.KEY_METRIC_JOIN_END:return Re(Re({},n),{},{keyMetrics:Re(Re({},n.keyMetrics),{},{joinEnd:r.metric})});case ze.KEY_METRIC_REQUEST_AP_START:return Re(Re({},n),{},{keyMetrics:Re(Re({},n.keyMetrics),{},{requestAPStart:r.metric})});case ze.KEY_METRIC_REQUEST_AP_END:return Re(Re({},n),{},{keyMetrics:Re(Re({},n.keyMetrics),{},{requestAPEnd:r.metric})});case ze.KEY_METRIC_JOIN_GATEWAY_START:return Re(Re({},n),{},{keyMetrics:Re(Re({},n.keyMetrics),{},{joinGatewayStart:r.metric})});case ze.KEY_METRIC_JOIN_GATEWAY_END:return Re(Re({},n),{},{keyMetrics:Re(Re({},n.keyMetrics),{},{joinGatewayEnd:r.metric})});case ze.KEY_METRIC_PEER_CONNECTION_START:return Re(Re({},n),{},{keyMetrics:Re(Re({},n.keyMetrics),{},{peerConnectionStart:r.metric})});case ze.KEY_METRIC_PEER_CONNECTION_END:return Re(Re({},n),{},{keyMetrics:Re(Re({},n.keyMetrics),{},{peerConnectionEnd:r.metric})});case ze.KEY_METRIC_DESCRIPTION_START:return Re(Re({},n),{},{keyMetrics:Re(Re({},n.keyMetrics),{},{descriptionStart:r.metric})});case ze.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Re(Re({},n),{},{keyMetrics:Re(Re({},n.keyMetrics),{},{signalChannelOpen:r.metric})});case ze.KEY_METRIC_ICE_CONNECTION_END:return Re(Re({},n),{},{keyMetrics:Re(Re({},n.keyMetrics),{},{iceConnectionEnd:r.metric})});case ze.KEY_METRIC_PUBLISH:{const i=n.keyMetrics.publish,a=i.findIndex(c=>c.trackId===r.metric.trackId);return a!==-1?(i[a]=Re(Re({},i[a]),r.metric),Re(Re({},n),{},{keyMetrics:Re(Re({},n.keyMetrics),{},{publish:[...i]})})):Re(Re({},n),{},{keyMetrics:Re(Re({},n.keyMetrics),{},{publish:[...n.keyMetrics.publish,r.metric]})})}case ze.KEY_METRIC_SUBSCRIBE:{const i=n.keyMetrics.subscribe,a=i.findIndex(c=>c.userId===r.metric.userId&&c.type===r.metric.type);return a!==-1?(i[a]=Re(Re({},i[a]),r.metric),Re(Re({},n),{},{keyMetrics:Re(Re({},n.keyMetrics),{},{subscribe:[...i]})})):Re(Re({},n),{},{keyMetrics:Re(Re({},n.keyMetrics),{},{subscribe:[...n.keyMetrics.subscribe,r.metric]})})}case ze.SET_CLOUD_PROXY_SERVER_MODE:return n.cloudProxyServerMode=r.mode,n;case ze.RECORD_JOIN_CHANNEL_SERVICE:return typeof r.index!="number"?n.joinChannelServiceRecords=[...n.joinChannelServiceRecords,r.record]:(n.joinChannelServiceRecords[r.index]=Re(Re({},n.joinChannelServiceRecords[r.index]),r.record),n.joinChannelServiceRecords=[...n.joinChannelServiceRecords]),n;case ze.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return n.joinChannelServiceRecords=[],n;case ze.RESET_KEY_METRICS:return n.keyMetrics={publish:[],subscribe:[]},n;case ze.SET_USE_DATACHANNEL:return Re(Re({},n),{},{useDataChannel:r.val});case ze.SET_USE_P2P:return Re(Re({},n),{},{useP2P:r.val});case ze.SET_TRANSPORT_TYPE:return Re(Re({},n),{},{p2pTransport:r.val});default:return n}}(this.state,t)}set sessionId(t){this.dispatch({type:ze.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.state.sessionId}set codec(t){this.state.codec=t}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t){this.dispatch({type:ze.SET_P2P_ID,p2pId:t})}get p2pId(){return this.state.p2pId}set dcId(t){this.dispatch({type:ze.SET_DC_ID,dcId:t})}get dcId(){return this.state.dcId}set uid(t){this.dispatch({type:ze.SET_UID,uid:t})}get uid(){return this.state.uid}set intUid(t){this.dispatch({type:ze.SET_INT_UID,intUid:t})}get intUid(){return this.state.intUid}set pubId(t){this.dispatch({type:ze.SET_PUB_ID,pubId:t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t){this.dispatch({type:ze.SET_CLOUD_PROXY_SERVER_MODE,mode:t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(t){this.dispatch({type:ze.SET_USE_DATACHANNEL,val:t})}get useDataChannel(){return this.state.useDataChannel}set useP2P(t){this.dispatch({type:ze.SET_USE_P2P,val:t})}get useP2P(){return this.state.useP2P}set p2pTransport(t){this.dispatch({type:ze.SET_TRANSPORT_TYPE,val:t})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:ze.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ze.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:ze.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ze.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ze.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ze.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ze.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ze.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ze.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:ze.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ze.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ze.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t,n,r,i){this.dispatch({type:ze.KEY_METRIC_PUBLISH,metric:Re(Re({trackId:t,type:n},r&&{publishStart:r}),i&&{publishEnd:i})})}subscribe(t,n,r,i,a,c,l){this.dispatch({type:ze.KEY_METRIC_SUBSCRIBE,metric:Re(Re(Re(Re(Re({userId:t,type:n},r&&{subscribeStart:r}),i&&{subscribeEnd:i}),a&&{firstFrame:a}),c&&{streamAdded:c}),l&&{firstDecoded:l})})}massSubscribe(t,n,r,i){t.forEach(a=>{this.dispatch({type:ze.KEY_METRIC_SUBSCRIBE,metric:Re(Re(Re({userId:a.userId,type:a.type},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),i&&{firstFrame:i})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t,n){t.service==="gateway"&&Array.isArray(t.urls)&&(t.urls=t.urls.map(r=>r.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof n!="number"?(this.dispatch({type:ze.RECORD_JOIN_CHANNEL_SERVICE,record:Re(Re({},t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(n<0||n>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ze.RECORD_JOIN_CHANNEL_SERVICE,record:t,index:n}),n)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ze.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ze.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t){this.dispatch({type:ze.AVOID_JOIN_START,avoidJoinStart:t})}}let Xd=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const S1=128,lz=96,T1=1e3,Qd=10;let uz=0;function v1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Fe(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?v1(Object(n),!0).forEach(function(r){Qt(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v1(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Qt(e,t,n){return(t=function(r){var i=function(a,c){if(typeof a!="object"||a===null)return a;var l=a[Symbol.toPrimitive];if(l!==void 0){var u=l.call(a,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(r);return typeof i=="symbol"?i:String(i)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const y1=new class extends xt{constructor(){super(...arguments),Qt(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class hz{constructor(t){Qt(this,"logger",void 0),Qt(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function QT(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function C1(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Ii={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},lm=Date.now(),eh=e=>{for(const t in Ii)if(Object.prototype.hasOwnProperty.call(Ii,t)&&Ii[t]===e)return t;return"DEFAULT"},T=new class{constructor(){Qt(this,"proxyServerURL",void 0),Qt(this,"logLevel",Ii.DEBUG),Qt(this,"uploadState","collecting"),Qt(this,"uploadLogWaitingList",[]),Qt(this,"uploadLogUploadingList",[]),Qt(this,"uploadErrorCount",0),Qt(this,"currentLogID",0),Qt(this,"url",void 0),Qt(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Ii.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Ii.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Ii.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Ii.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Ii.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Tt("UPLOAD_LOG",!0)}disableLogUpload(){Tt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new hz(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-lm<100)return void setTimeout(()=>{this.log(...t)},Date.now()-lm);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=QT()+" Agora-SDK [".concat(eh(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=QT()+" %cAgora-SDK [".concat(eh(r),"]:");let a=[];if(!L("USE_NEW_LOG"))switch(r){case Ii.DEBUG:a=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,a);break;case Ii.INFO:a=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,a);break;case Ii.WARNING:a=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,a);break;case Ii.ERROR:a=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,a)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-lm<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-lm);const r=Math.max(0,Math.min(4,t[0]));t[0]=QT()+" Agora-SDK [".concat(eh(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!L("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=C1()+" Agora-SDK [".concat(eh(e),"]:"):n[0]=C1()+" Agora-SDK [".concat(eh(e),"]:");let i="";n.forEach(a=>{typeof a=="object"&&(a=JSON.stringify(a)),i+="".concat(a," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:wi,process_id:L("PROCESS_ID"),payload:JSON.stringify(e)};return wo(async()=>{const n=await Rr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(L("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(L("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const r=new Error("unexpected upload log response");throw r.response=n,r}},()=>(this.uploadLogUploadingList=[],!1),n=>{const r={status:-1,message:n.message,errorRange:e.map(i=>i.log_item_id)};return n.response?(r.status=n.response.status,r.data=n.response.data,r.headers=n.response.headers):n.request&&(r.status=n.request.status),y1.reportLogUploadError(r),!0},{timeout:L("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:L("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,L("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),L("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),L("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),L("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var R1;function pz(e){return Mn(e.reportId,"params.reportId",0,100,!1),Mn(e.category,"params.category",0,100,!1),Mn(e.event,"params.event",0,100,!1),Mn(e.label,"params.label",0,100,!1),St(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(R1={}).FREE="free",R1.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const fz={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Nn=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e}({}),Bt=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({}),function(e){e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}({});class th{constructor(){Qt(this,"baseInfoMap",new Map),Qt(this,"proxyServer",void 0),Qt(this,"eventUploadTimer",void 0),Qt(this,"setSessionIdTimer",void 0),Qt(this,"url",void 0),Qt(this,"backupUrl",void 0),Qt(this,"_appId",void 0),Qt(this,"keyEventUploadPendingItems",[]),Qt(this,"normalEventUploadPendingItems",[]),Qt(this,"apiInvokeUploadPendingItems",[]),Qt(this,"apiInvokeCount",0),Qt(this,"ltsList",[]),Qt(this,"lastSendNormalEventTime",Date.now()),Qt(this,"customReportCounterTimer",void 0),Qt(this,"customReportCount",0),Qt(this,"extApiInvoke",async t=>{for(const n of t){const r=Fe(Fe({},n),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Kt.TRACER});this.sendApiInvoke(r)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),L("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),L("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}adjustSessionStartTime(t){if(!this.baseInfoMap.has(t)&&!this.baseInfoMap.get(t))return void T.error("adjust session ".concat(t," start time, sid is not exist or info is undefined"));const n=this.baseInfoMap.get(t),r=Date.now(),i=n.startTime;n.startTime=r,T.debug("rewrite session ".concat(t," startTime: ").concat(r," , ").concat(r-i,"ms")),this.baseInfoMap.set(t,n)}setAppId(t){this._appId=t}reportApiInvoke(t,n,r){n.timeout=n.timeout||6e4,n.reportResult=n.reportResult===void 0||n.reportResult;const i=Date.now();this.apiInvokeCount+=1;const a=this.apiInvokeCount,c=()=>({tag:n.tag,invokeId:a,sid:t,name:n.name,apiInvokeTime:i,options:n.options,states:n.states||null}),l=!!L("SHOW_REPORT_INVOKER_LOG");l&&T.info("".concat(n.name," start"),n.options);let u=!1;Rn(n.timeout).then(()=>{u||(this.sendApiInvoke(Fe(Fe({},c()),{},{error:O.API_INVOKE_TIMEOUT,success:!1})),T.debug("".concat(n.name," timeout")))});const p=new J(O.UNEXPECTED_ERROR,"".concat(n.name,": this api invoke is end"));return{onSuccess:f=>{const m=()=>{if(u)throw p;return u=!0,this.sendApiInvoke(Fe(Fe({},c()),{},{success:!0},n.reportResult&&{result:f})),l&&T.info("".concat(n.name," onSuccess")),f};return r?f1(m,n.name+"Success",r,()=>u=!0):m()},onError:f=>{const m=()=>{if(u)throw f;u=!0,this.sendApiInvoke(Fe(Fe({},c()),{},{success:!1,error:f})),l&&T.info("".concat(n.name," onFailure"),f.toString())};return r?f1(m,n.name+"Error",r,()=>u=!0):m()}}}sessionInit(t,n){if(this.baseInfoMap.has(t))return;const r=Date.now(),i=this.createBaseInfo(t,r);i.cname=n.cname;const a=Object.assign({},{willUploadConsoleLog:L("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:qT?"global":"oversea",areas:L("AREAS")&&L("AREAS").join(",")},n.extend),{stringUid:c,channelProfile:l,channelMode:u,isABTestSuccess:p,lsid:f,clientRole:m}=n,E=Date.now(),S=Fe(Fe({},i),{},{eventType:Nn.SESSION_INIT,appid:n.appid,browser:navigator.userAgent,buildFormat:n.buildFormat,build:XT,lts:E,elapse:E-r,extend:JSON.stringify(a),mode:n.mode,process:L("PROCESS_ID"),appType:L("APP_TYPE"),success:!0,version:wi,stringUid:c,channelProfile:l,channelMode:u,isABTestSuccess:p,lsid:f,clientType:20,clientRole:m,serviceId:L("PROCESS_ID"),extensionID:L("PLUGIN_INFO").join(",")||"",preload:n.preload?1:0});this.send({type:Bt.SESSION,data:S},!0)}joinChooseServer(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe({},i),{},{eventType:Nn.JOIN_CHOOSE_SERVER,lts:a,eventElapse:n.elapse||a-n.lts,chooseServerAddr:n.csAddr,errorCode:n.ec,elapse:a-r.startTime,success:n.succ,chooseServerAddrList:JSON.stringify(n.serverList),uid:n.uid?parseInt(n.uid):null,cid:n.cid?parseInt(n.cid):null,chooseServerIp:n.csIp||"",opid:n.opid,unilbsServerIds:n.unilbsServerIds,extend:n.extend||void 0,isHttp3:n.isHttp3});this.send({type:Bt.JOIN_CHOOSE_SERVER,data:c},!0)}reqUserAccount(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe({},i),{},{eventType:Nn.REQ_USER_ACCOUNT,lts:a,success:n.success,serverAddress:n.serverAddr,stringUid:n.stringUid,uid:n.uid,errorCode:n.errorCode,elapse:n.elapse||a-r.startTime,eventElapse:a-n.lts,extend:JSON.stringify(n.extend)});this.send({type:Bt.REQ_USER_ACCOUNT,data:c},!0)}joinGateway(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info;n.vid&&(i.vid=n.vid),i.uid=n.uid,i.cid=n.cid;const a=Date.now(),{firstSuccess:c,avoidJoinStartTime:l,isProxy:u,addr:p}=n,f=a-(c&&l?l:r.startTime),m=Fe(Fe({},i),{},{eventType:Nn.JOIN_GATEWAY,lts:a,gatewayAddr:n.addr,success:n.succ,errorCode:n.ec,elapse:f,eventElapse:a-n.lts,firstSuccess:c,signalChannel:n.signalChannel}),E=m.success?1:0;if(n.succ&&(r.lastJoinSuccessTime=a),c)this.send({type:Bt.JOIN_GATEWAY,data:m},!0);else{let S;if(p)if(u){const v=p.match(/h=(\d{1,3}-){3}\d{1,3}/g),y=p.match(/p=[0-9]{1,6}/g);S={isSuccess:E,gatewayIp:v&&v.length?v[0].split("=")[1].replace(/-/g,"."):"",port:y&&y.length?y[0].split("=")[1]:"",isProxy:u?1:0}}else{const v=p.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),y=p.match(/(:|p=)[0-9]{1,6}/g);S={isSuccess:E,gatewayIp:v&&v.length?v[0].split("//")[1].replace(/-/g,"."):"",port:y&&y.length?y[0].split(/:|p=/g)[1]:"",isProxy:u?1:0}}else S={isSuccess:E,gatewayIp:"",port:"",isProxy:u?1:0};delete m.success,delete m.eventType,delete m.firstSuccess,m.vid=Number(m.vid);const I=Object.assign({},m,S,{eventType:Nn.REJOIN_GATEWAY});this.send({type:Bt.RE_JOIN_GATEWAY,data:I},!0)}}joinChannelTimeout(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=Date.now(),a=Fe(Fe({},r.info),{},{lts:i,timeout:n,elapse:i-r.startTime});this.send({type:Bt.JOIN_CHANNEL_TIMEOUT,data:a},!0)}publish(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe({},i),{},{eventType:Nn.PUBLISH,lts:a,eventElapse:n.eventElapse,elapse:a-r.startTime,success:n.succ,errorCode:n.ec,videoName:n.videoName,audioName:n.audioName,screenName:n.screenName,screenshare:n.screenshare,audio:n.audio,video:n.video,p2pid:n.p2pid,publishRequestid:n.publishRequestid});this.send({type:Bt.PUBLISH,data:c},!0)}subscribe(t,n,r){const i=this.baseInfoMap.get(t);if(!i)return;const a=i.info,c=Date.now(),l=Fe(Fe({},a),{},{eventType:Nn.SUBSCRIBE,lts:c,eventElapse:n.eventElapse,elapse:c-i.startTime,success:n.succ,errorCode:n.ec,video:n.video,audio:n.audio,subscribeRequestid:n.subscribeRequestid,p2pid:n.p2pid},r&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof n.peerid=="string"?l.peerSuid=n.peerid:l.peer=n.peerid,this.send({type:Bt.SUBSCRIBE,data:l},!0)}wsCompressorInit(t){var n;const r=[...ii(n=this.baseInfoMap).call(n)],i=r.length?r[0]:"UnableToGetSid",a=this.baseInfoMap.get(i);if(!a)return;const c=a.info,l=Date.now(),u=Fe(Fe({},c),{},{eventType:Nn.WS_COMPRESSOR_INIT,lts:l,eventElapse:t.eventElapse,elapse:l-a.startTime,status:t.status?1:2});this.send({type:Bt.WS_COMPRESSOR_INIT,data:u},!0)}firstRemoteVideoDecode(t,n,r,i){const a=this.baseInfoMap.get(t);if(!a)return;const c=a.info,l=Date.now(),u=Fe(Fe(Fe({},c),i),{},{elapse:l-a.startTime,eventType:n,lts:l,firstDecodeFrame:Math.max(l-a.startTime,0),apEnd:Math.max(i.apEnd-a.startTime,0),apStart:Math.max(i.apStart-a.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-a.startTime,0),joinGwStart:Math.max(i.joinGwStart-a.startTime,0),pcEnd:Math.max(i.pcEnd-a.startTime,0),pcStart:Math.max(i.pcStart-a.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-a.startTime,0),subscriberStart:Math.max(i.subscriberStart-a.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-a.startTime,0)});this.send({type:r,data:u},!0)}firstRemoteFrame(t,n,r,i){const a=this.baseInfoMap.get(t);if(!a)return;const c=a.info,l=Date.now(),u=Fe(Fe(Fe({},c),i),{},{elapse:l-a.startTime,eventType:n,lts:l});this.send({type:r,data:u},!0)}pcStats(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe(Fe({},i),n),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:a-r.startTime,eventType:Nn.PC_STATS,lts:a});this.send({type:Bt.PC_STATS,data:c},!0)}updateRemoteRTPCapabilities(t,n){if(t){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe(Fe({},i),n),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:Nn.UPDATE_REMOTE_RTPCAPABILITIES,lts:a});this.send({type:Bt.UPDATE_REMOTE_RTPCAPABILITIES,data:c},!0)}}onGatewayStream(t,n,r,i){const a=this.baseInfoMap.get(t);if(!a)return;const c=a.info,l=Date.now(),u=Fe(Fe(Fe({},c),i),{},{eventType:n,lts:l});this.send({type:r,data:u},!0)}streamSwitch(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe({},i),{},{eventType:Nn.STREAM_SWITCH,lts:a,isDual:n.isdual,elapse:a-r.startTime,success:n.succ});this.send({type:Bt.STREAM_SWITCH,data:c},!0)}requestProxyAppCenter(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe({},i),{},{eventType:Nn.REQUEST_PROXY_APPCENTER,lts:a,eventElapse:a-n.lts,elapse:a-r.startTime,APAddr:n.APAddr,workerManagerList:n.workerManagerList,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:Bt.REQUEST_PROXY_APPCENTER,data:c},!0)}requestProxyWorkerManager(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe({},i),{},{eventType:Nn.REQUEST_PROXY_WORKER_MANAGER,lts:a,eventElapse:a-n.lts,elapse:a-r.startTime,workerManagerAddr:n.workerManagerAddr,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:Bt.REQUEST_PROXY_WORKER_MANAGER,data:c},!0)}setProxyServer(t){this.proxyServer=t,t?T.debug("reportProxyServerurl: ".concat(t)):T.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe({},i),{},{subscribeElapse:n.subscribeElapse,peer:n.peer,peerPublishDuration:Math.max(n.audioPublishDuration,n.videoPublishDuration),audiotag:n.audioPublishDuration>0?1:-1,videotag:n.videoPublishDuration>0?1:-1,lts:a,elapse:a-r.startTime,joinChannelSuccessElapse:a-(r.lastJoinSuccessTime||a),peerPublishDurationVideo:n.videoPublishDuration,peerPublishDurationAudio:n.audioPublishDuration});this.send({type:Bt.PEER_PUBLISH_STATUS,data:c},!0)}workerEvent(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now();(function(c,l,u){const p=c[l];if(!p||typeof p!="string")return[c];c[l]="";const f=ss(JSON.stringify(c));let m=0;const E=[];let S=0;for(let I=0;I<p.length;I++)S+=p.charCodeAt(I)<=127?1:3,S<=u-f||(E[E.length]=Re(Re({},c),{},{[l]:p.substring(m,I)}),m=I,S=p.charCodeAt(I)<=127?1:3);return m!==p.length-1&&(E[E.length]=Re(Re({},c),{},{[l]:p.substring(m)})),E})(Fe(Fe(Fe({},i),n),{},{elapse:a-r.startTime,lts:a,productType:"WebRTC"}),"payload",1300).forEach(c=>this.send({type:Bt.WORKER_EVENT,data:c},!0))}apworkerEvent(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe(Fe({},i),n),{},{elapse:a-r.startTime,lts:a});this.send({type:Bt.AP_WORKER_EVENT,data:c},!0)}joinWebProxyAP(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe(Fe({},i),n),{},{elapse:a-r.startTime,lts:a,extend:n.extend||void 0});this.send({type:Bt.JOIN_WEB_PROXY_AP,data:c},!0)}WebSocketQuit(t,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,a=Date.now(),c=Fe(Fe(Fe({},i),n),{},{elapse:a-r.startTime,lts:a});this.send({type:Bt.WEBSOCKET_QUIT,data:c},!0)}async sendCustomReportMessage(t,n){if(this.customReportCount+=n.length,this.customReportCount>L("CUSTOM_REPORT_LIMIT"))throw new J(O.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const r=Date.now(),i=n.map(a=>({type:Bt.USER_ANALYTICS,data:Fe(Fe({sid:t},a),{},{lts:r})}));try{L("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(a){throw T.error("send custom report message failed",a.toString()),new J(O.CUSTOM_REPORT_SEND_FAILED,a.message)}}sendApiInvoke(t){const n=L("NOT_REPORT_EVENT");if(t.tag&&ue(n)&&ue(n).call(n,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const r=this.baseInfoMap.get(t.sid);if(!r)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:i,uid:a,cid:c}=r.info;let l;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof J){const{code:p,message:f}=t.error;l=p||f||t.error.toString()}else l=t.error.toString();const u={invokeId:t.invokeId,sid:t.sid,cname:i,cid:c,uid:a,lts:t.lts,success:t.success,elapse:t.lts-r.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?l:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Bt.API_INVOKE,data:u},!1),!0}appendSessionId(){th.__CLIENT_LIST__.forEach(t=>{if(t._sessionId){const n=this.apiInvokeUploadPendingItems.length;for(let r=0;r<n;r++){const i=this.apiInvokeUploadPendingItems.shift();i&&(i.sid=t._sessionId,this.sendApiInvoke(Object.assign({},i)))}}})}send(t,n){if(n)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>L("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,n){const r=[],i=[];for(;t.length;){const c=t.shift();r.length<20?r.push(c):i.push(c)}t.push(...i);for(const c of[...r]){var a;this.ltsList.indexOf(c.data.lts)!==-1?(c.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(c.data.lts)):(this.ltsList.push(c.data.lts),Mu(a=this.ltsList).call(a,(l,u)=>l-u))}return n||(this.lastSendNormalEventTime=Date.now()),L("ENABLE_EVENT_REPORT")&&r.length&&(L("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch((c=>l=>{L("EVENT_REPORT_RETRY")&&(n?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(c):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(c),this.normalEventUploadPendingItems.length>L("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-L("NORMAL_EVENT_QUEUE_CAPACITY")),T.warning("report: drop normal events"))))})(r)),t}async postDataToStatsCollector2(t){zt.networkState===mr.OFFLINE&&await ce.race([zt.onlineWaiter,Rn(2*sn.maxRetryTimeout)]);const n=a=>{let c=new Uint8Array;return a.forEach(l=>{const u=BT(JSON.stringify(l.data)),p=new ArrayBuffer(5),f=(E=>{let S=0;return Object.entries(Bt).forEach(I=>{let[v,y]=I;y===E.type&&(S=EventNameToID[v])}),S})(l),m=new DataView(p);m.setUint16(0,u.byteLength,!0),m.setUint8(2,255&f),m.setUint8(3,f>>>8&255),m.setUint8(4,f>>>16&255),c=i1(c,new Uint8Array(p)),c=i1(c,u)}),c},r="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(L("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat(L("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r);for(let a=0;a<2;a+=1){a===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(L("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat(L("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r));try{await YT(i,{timeout:1e4,data:n(t),headers:Fe(Fe({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(c){if(a===1)throw c;continue}return}}async postDataToStatsCollector(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(c=>JSON.stringify(c)),vid:(c=>{const l=c&&c.data.sid&&this.baseInfoMap.get(c.data.sid);return l&&l.info.vid&&+l.info.vid||0})(t[0])};zt.networkState===mr.OFFLINE&&await ce.race([zt.onlineWaiter,Rn(2*sn.maxRetryTimeout)]);const i=n?"/events/proto-raws":"/events/messages";let a=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(L("EVENT_REPORT_DOMAIN"),"&p=").concat(L("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(L("EVENT_REPORT_DOMAIN"),":").concat(L("STATS_COLLECTOR_PORT")).concat(i));for(let c=0;c<2;c+=1){c===1&&(a=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(L("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(L("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(L("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(L("STATS_COLLECTOR_PORT")).concat(i)));try{n?await cz(a,{timeout:1e4,data:r}):await YT(a,{timeout:1e4,data:r})}catch(l){if(c===1)throw l;continue}return}}createBaseInfo(t,n){const r=Object.assign({},fz);return r.sid=t,this.baseInfoMap.set(t,{info:r,startTime:n}),r}reportResourceTiming(t,n){const r=performance.getEntriesByName(t),i=r[r.length-1];i&&this.reportApiInvoke(n,{name:"Client.resourceTiming",options:i,tag:Kt.TRACER}).onSuccess()}}function Oe(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,r){const i=r.value;if(typeof i=="function"){const a=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];let p=l;if(e.argsMap)try{p=e.argsMap(this,...l)}catch(m){T.warning(m),p=[]}try{JSON.stringify(p)}catch{T.warning("arguments for method ".concat(a,".").concat(String(n)," not serializable for apiInvoke.")),p=[]}const f=(e.report||Ce).reportApiInvoke(this._sessionId||null,{name:"".concat(a,".").concat(String(n)),options:p,tag:Kt.TRACER,reportResult:e.reportResult},e.throttleTime);try{const m=i.apply(this,l);return m instanceof ce?m.then(E=>(f.onSuccess(e.reportResult&&E),E)).catch(E=>{throw f.onError(E),E}):(f.onSuccess(e.reportResult&&m),m)}catch(m){throw f.onError(m),m}}}return r}}Qt(th,"__CLIENT_LIST__",[]);const Ce=new th;y1.on("REPORT_LOG_UPLOAD",e=>{e.networkState=zt.networkState,Ce.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Kt.TRACER}).onSuccess("logUploadError")});const mz=["CHINA","GLOBAL"],Gn=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let l=0;l<6;l++)i.push("1");const a=i.join(""),c={};return c[e]=r,c[t]=a,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Gn,qT||(_n.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],_n.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],_n.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],_n.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],_n.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],_n.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],_n.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",_n.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",_n.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",_n.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",_n.AREAS=["NORTH_AMERICA","OVERSEA"]);const w1=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Ea=[];function Oc(e,t){return!!t&&Ea.some(n=>n.uid===e&&n.channelName===t)}th.__CLIENT_LIST__=Ea;var _z=$A.forEach,I1=Zp("forEach")?[].forEach:function(e){return _z(this,e,arguments.length>1?arguments[1]:void 0)};bt({target:"Array",proto:!0,forced:[].forEach!=I1},{forEach:I1});var Ez=Gi("Array").forEach,gz=$o,Sz=Jn,Tz=G,vz=Ez,ZT=Array.prototype,yz={DOMTokenList:!0,NodeList:!0},Cz=function(e){var t=e.forEach;return e===ZT||Tz(ZT,e)&&t===ZT.forEach||Sz(yz,gz(e))?vz:t},Rz=_(Cz),wz=Zo,b1=rf;bt({target:"Object",stat:!0,forced:g(function(){b1(1)})},{keys:function(e){return b1(wz(e))}});var A1=_(vo.Object.keys),Iz=_(Tw),bz=bt,Az=ju,Oz=j([].reverse),O1=[1,2];bz({target:"Array",proto:!0,forced:String(O1)===String(O1.reverse())},{reverse:function(){return Az(this)&&(this.length=this.length),Oz(this)}});var Nz=Gi("Array").reverse,Dz=G,Pz=Nz,$T=Array.prototype,Lz=function(e){var t=e.reverse;return e===$T||Dz($T,e)&&t===$T.reverse?Pz:t},N1=Lz,kz=_(N1),Mz=bt,D1=ju,xz=_f,Uz=ri,P1=yg,jz=bs,Vz=na,Fz=Of,Bz=on,Wz=nS,Gz=GA("slice"),Hz=Bz("species"),ev=Array,Kz=Math.max;Mz({target:"Array",proto:!0,forced:!Gz},{slice:function(e,t){var n,r,i,a=Vz(this),c=jz(a),l=P1(e,c),u=P1(t===void 0?c:t,c);if(D1(a)&&(n=a.constructor,(xz(n)&&(n===ev||D1(n.prototype))||Uz(n)&&(n=n[Hz])===null)&&(n=void 0),n===ev||n===void 0))return Wz(a,l,u);for(r=new(n===void 0?ev:n)(Kz(u-l,0)),i=0;l<u;l++,i++)l in a&&Fz(r,i,a[l]);return r.length=i,r}});var zz=Gi("Array").slice,Yz=G,qz=zz,tv=Array.prototype,Jz=function(e){var t=e.slice;return e===tv||Yz(tv,e)&&t===tv.slice?qz:t},Xz=_(Jz);function se(e,t,n,r,i){var a,c,l,u={};return Rz(a=A1(r)).call(a,function(p){u[p]=r[p]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=Iz(c=kz(l=Xz(n).call(n)).call(l)).call(c,function(p,f){return f(e,t,p)||p},u),i&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(i):void 0,u.initializer=void 0),u.initializer===void 0&&(VA(e,t,u),u=null),u}var Qz=Gi("Array").values,Zz=$o,$z=Jn,eY=G,tY=Qz,nv=Array.prototype,nY={DOMTokenList:!0,NodeList:!0},rY=function(e){var t=e.values;return e===nv||eY(nv,e)&&t===nv.values||$z(nY,Zz(e))?tY:t},Io=_(rY);let iY=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),si=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({}),um=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),rv=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Yi=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),_r=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),be=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Ye=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Ee=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e}({}),we=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),Nc=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Ue=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Er=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),ke=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});class B extends J{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),w(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,T)}throw(){super.throw(T)}}function hm(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw T.error("Invalid Channel Name ".concat(e)),new B(O.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function pm(e){if(!function(t){return typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295}(e)&&!e1(e,1,255))throw new B(O.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof e=="string"&&T.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Dn=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming",e}({}),Zd=function(e){return e[e.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",e[e.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",e[e.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",e[e.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",e[e.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",e[e.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",e[e.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",e[e.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",e[e.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN",e}({});const oY={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},iv={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function ov(e,t){Mn(e.url,"".concat(t,".url"),1,1e3,!1),Ht(e.x)||St(e.x,"".concat(t,".x"),0,1e4),Ht(e.y)||St(e.y,"".concat(t,".y"),0,1e4),Ht(e.width)||St(e.width,"".concat(t,".width"),0,1e4),Ht(e.height)||St(e.height,"".concat(t,".height"),0,1e4),Ht(e.zOrder)||St(e.zOrder,"".concat(t,".zOrder"),0,255),Ht(e.alpha)||St(e.alpha,"".concat(t,".alpha"),0,1,!1)}const sY={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},aY={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};let as=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),fm=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),En=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function L1(e){if(!e.channelName)throw new B(O.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new B(O.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Mn(e.token,"info.token",1,2047),pm(e.uid),hm(e.channelName),!0}let gr=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Ps=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Pr=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),$d=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),ut=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Zt=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_FAILBACK="datachannel_failback",e.RESET_SIGNAL="reset-signal",e}({}),nh=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),wn=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),k1=function(e){return e[e.websocket=0]="websocket",e[e.datachannel=1]="datachannel",e}({}),ot=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const M1=[ot.AFRICA,ot.ASIA,ot.CHINA,ot.EUROPE,ot.GLOBAL,ot.INDIA,ot.JAPAN,ot.NORTH_AMERICA,ot.OCEANIA,ot.OVERSEA,ot.SOUTH_AMERICA];let Qn=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const mm={CHINA:{},ASIA:{CODE:Qn.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Qn.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Qn.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Qn.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Qn.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Qn.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Qn.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Qn.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Qn.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Qn.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Qn.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Qn.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Qn.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};qT&&(mm.CHINA={CODE:Qn.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let sv=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e}({});class x1 extends xt{constructor(t,n){super(),w(this,"onICEConnectionStateChange",void 0),w(this,"onConnectionStateChange",void 0),w(this,"onDTLSTransportStateChange",void 0),w(this,"onDTLSTransportError",void 0),w(this,"onICETransportStateChange",void 0),w(this,"onFirstAudioReceived",void 0),w(this,"onFirstVideoReceived",void 0),w(this,"onFirstAudioDecoded",void 0),w(this,"onFirstVideoDecoded",void 0),w(this,"onFirstVideoDecodedTimeout",void 0),w(this,"onSelectedLocalCandidateChanged",void 0),w(this,"onSelectedRemoteCandidateChanged",void 0),w(this,"getLocalVideoStats",void 0)}}class _m extends x1{constructor(t,n){super(t,n),w(this,"establishPromise",void 0)}}let ye=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),ar=function(e){return e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY",e}({}),Ls=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),re=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),ht=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Ne=function(e){return e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),qi=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Ji=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Pn=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),ga=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),pn=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e}({}),cs=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),bi=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),bo=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),el=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),$t=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),tl=function(e){return e.ABORT="abort",e}({}),Sa=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),cY=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const dY={[um.ACCESS_POINT]:{[_r.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[_r.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[_r.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[_r.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[_r.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[_r.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[_r.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[_r.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[_r.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[_r.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[_r.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[_r.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[_r.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[_r.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[_r.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[_r.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[_r.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[_r.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[um.UNILBS]:{[Yi.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Yi.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Yi.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Yi.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Yi.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Yi.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Yi.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Yi.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Yi.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Yi.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Yi.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Yi.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[um.STRING_UID_ALLOCATOR]:{[rv.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[rv.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[rv.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function nl(e){const t=dY[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===um.ACCESS_POINT){const r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const lY={[be.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[be.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[be.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[be.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[be.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[be.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[be.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[be.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[be.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[be.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[be.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[be.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[be.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[be.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[be.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[be.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[be.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[be.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[be.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[be.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[be.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[be.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[be.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[be.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[be.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[be.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[be.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[be.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[be.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[be.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[be.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[be.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[be.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[be.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[be.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[be.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[be.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[be.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[be.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[be.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[be.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[be.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[be.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[be.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[be.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[be.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[be.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[be.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[be.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[be.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[be.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[be.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[be.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[be.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[be.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[be.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[be.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[be.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[be.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[be.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[be.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[be.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[be.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Dc(e){return lY[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function U1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function av(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?U1(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U1(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function j1(e){return e.every(t=>t.readyState===WebSocket.CLOSED||t.readyState===WebSocket.CLOSING)}function V1(e,t){if(typeof e=="string")return e;const{proxy:n,host:r,port:i}=e;if(t){const a=L("JOIN_GATEWAY_FALLBACK_PORT")||443;return a===443?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(a,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const uY=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,hY=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,pY=/wss:\/\/(.+):([0-9]+)\/?/,fY=/wss:\/\/(.[^\/]+)\/?/;let mY=0;class _Y{constructor(t,n){w(this,"id",0),w(this,"store",void 0),w(this,"recordIndex",void 0),w(this,"websockets",[]),w(this,"try443PortDuration",2e3),w(this,"forceCloseWSDuration",5e3),w(this,"try443PortTimeout",null),w(this,"forceCloseTimeout",null),w(this,"isTry443PortFailed",!1),w(this,"isNormalPortFailed",!1),w(this,"useDoubleDomain",!1),w(this,"useProxy",!1),w(this,"startTime",Date.now()),this.id=++mY,this.try443PortDuration=L("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var t;const n=Date.now()-this.startTime;for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];T.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...i)}createWebSocket(t,n,r){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:r});const i=L("GATEWAY_DOMAINS"),a=Date.now(),c=[],l=i.find(f=>{var m;return ue(m=t.host).call(m,f)});l||(this.useDoubleDomain=!1);const u=[];if(this.useDoubleDomain)i.forEach(f=>{u.push(V1(av(av({},t),{},{host:t.host.replace(l,f)}),n))});else{const f=av({},t);if(n&&l){const m=i.find(E=>E!==l);m&&(f.host=f.host.replace(l,m))}u.push(V1(f,n))}try{u.forEach(f=>{const m=new WebSocket(f);m.binaryType="arraybuffer",c.push(m),this.logger("ws is connecting:",m.url)})}catch(f){if(this.logger("ws create failed"),c.forEach(m=>m.close()),c.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,r);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,r);throw new B(O.WS_ERR,"init websocket failed! Error: ".concat(f.toString()))}const p=Ju();return this.store&&this.store.recordJoinChannelService({urls:c.map(f=>f.url),service:"gateway"},this.recordIndex),c.forEach(f=>{f.onopen=()=>{this.logger("onopen: ws ".concat(f.url," open cost ").concat(Date.now()-a,"ms")),this.websockets.forEach(m=>{m!==f&&(m.onopen=null,m.onclose=null,m.onmessage=null,m.close(),this.logger("close backup websocket: ".concat(m.url)))}),this.websockets.length=0,p.resolve(f)},f.onclose=m=>{this.logger("onclose: ws ".concat(f.url," closed cost ").concat(Date.now()-a,"ms state: ").concat(f.readyState)),n?this.isTry443PortFailed=j1(c):this.isNormalPortFailed=j1(c),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(n&&this.isTry443PortFailed||!n&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(m.reason)),p.reject({code:m.code,reason:nh.A_ROUND_WS_FAILED}))},f.onmessage=m=>this.logger("".concat(f.url," onmessage: ").concat(m.data))}),this.websockets.push(...c),r||(()=>{const f=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",p.isResolved),this.websockets.forEach(m=>m.readyState!==WebSocket.OPEN&&m.close())};if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(f,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",p.isResolved),p.isResolved)return f();tt().os===yn.MAC_OS&&yt()&&f(),this.createWebSocket(t,!0,!0).then(m=>p.resolve(m)).catch(m=>{this.isNormalPortFailed&&p.reject(m),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(f,this.forceCloseWSDuration)},this.try443PortDuration)})(),p.promise}chooseBestWebsocket(t,n,r,i){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(a){let c,l,u;return[,c,l,u]=a.match(uY)||[],c||([,l,u]=a.match(hY)||[]),l&&u||([,l,u]=a.match(pY)||[]),l&&u||([,l]=a.match(fY)||[]),l||T.warning("un-destructible url: ",a),{proxy:c,host:l,port:u||"443"}}(t)),this.recordIndex=i,this.useProxy=!!t.proxy,r&&this.useProxy&&(T.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(t,!!r,!1).finally(()=>this.clearTimeout())}}function F1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class B1 extends xt{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;ue(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(ke.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(ke.CONNECTED):this._state==="closed"?this.emit(ke.CLOSED):this._state==="failed"&&this.emit(ke.FAILED))}resetReconnectCount(t){T.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],a=arguments.length>4&&arguments[4]!==void 0&&arguments[4],c=arguments.length>5?arguments[5]:void 0;super(),w(this,"connectionID",0),w(this,"currentURLIndex",0),w(this,"urls",[]),w(this,"_reconnectMode","tryNext"),w(this,"reconnectReason",void 0),w(this,"_initMutex",new On("websocket")),w(this,"name",void 0),w(this,"_state","closed"),w(this,"reconnectInterrupter",void 0),w(this,"websocket",void 0),w(this,"retryConfig",void 0),w(this,"reconnectCount",0),w(this,"forceCloseTimeout",5e3),w(this,"onlineReconnectListener",void 0),w(this,"useCompress",void 0),w(this,"tryDoubleDomain",!1),w(this,"use443PortOnly",!1),w(this,"wsInflateLength",0),w(this,"wsDeflateLength",0),w(this,"closeEstablishingWs",()=>{}),w(this,"store",void 0),w(this,"joinGatewayRecordIndex",void 0),this.store=c,this.name=t,this.retryConfig=function(m){for(var E=1;E<arguments.length;E++){var S=arguments[E]!=null?arguments[E]:{};E%2?F1(Object(S),!0).forEach(function(I){w(m,I,S[I])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(S)):F1(Object(S)).forEach(function(I){Object.defineProperty(m,I,Object.getOwnPropertyDescriptor(S,I))})}return m}({},n),this.useCompress=r,this.tryDoubleDomain=i,this.use443PortOnly=a;const{timeout:l,timeoutFactor:u}=n,p=Math.max(300,Math.floor(3*l/5)),f=Math.max(1.2,Math.floor(8*u)/10);mr.ONLINE&&(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=f),zt.on(Rc.NETWORK_STATE_CHANGE,(m,E)=>{m!==E&&(this.resetReconnectCount("network state change: ".concat(E," -> ").concat(m)),m===mr.ONLINE?(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=f):(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=u))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=await this._initMutex.lock();this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{const i=Ju(),a=this.urls[this.currentURLIndex];this.createWebSocketConnection(a).then(i.resolve).catch(i.reject),this.once(ke.CLOSED,()=>{i.reject(new J(O.WS_DISCONNECT))}),this.once(ke.CONNECTED,i.resolve),await i.promise}catch{}finally{r()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r=this.websocket;n?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void T.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),T.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new J(O.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new J(O.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const r=Ju();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i=f=>{var m;(m=this.store)===null||m===void 0||m.signalChannelOpen(),T.debug("[".concat(this.name,"] websocket opened:"),f),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},a=async f=>{var m;if(T.debug("[".concat(this.name,"] websocket close ").concat((m=this.websocket)===null||m===void 0?void 0:m.url,", code: ").concat(f.code,", reason: ").concat(f.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new J(O.WS_DISCONNECT,"websocket close: ".concat(f.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=f.reason,this.state="reconnecting");const E=zr(this,ke.WILL_RECONNECT,this.reconnectMode,f.reason)||this.reconnectMode,S=await this.reconnectWithAction(E);if(this.state==="closed")return void T.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!S)return r.reject(new J(O.WS_DISCONNECT,"websocket reconnect failed: ".concat(f.code))),this.close(!0);r.resolve()}},c=f=>{this.emit(ke.ON_MESSAGE,f)},l=f=>{T.warn("[".concat(this.connectionID,"] ws open error ").concat(f))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),L("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=L("GATEWAY_WSS_ADDRESS")),T.debug("[".concat(this.name,"] start connect, url:"),t);const u=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var p;const f=await this.chooseBestWebsocketConnection(t);this.websocket=f,i&&i(this.websocket.url),this.websocket.onclose=a,this.websocket.onmessage=c,this.websocket.onerror=l,(p=this.store)===null||p===void 0||p.recordJoinChannelService({endTs:Date.now(),status:"success"},u),this.joinGatewayRecordIndex=u}catch(f){const m=this.state==="closed",E=f instanceof J,S=E&&f.code===O.WS_ABORT,I=E&&f.code===O.WS_ERR,v=E?f.message:f&&(f.reason||f.toString());T.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(v)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:S?"aborted":"error",errors:[f]},u),m||I?(r.reject(m?new J(O.WS_DISCONNECT,"websocket is closed: ".concat(v)):new J(O.WS_ERR,"init websocket failed: ".concat(v))),I&&T.error("[".concat(this.name,"] init websocket failed: ").concat(v))):a&&a(f)}return r.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;T.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||zt.isOnline||!zt.onlineWaiter||(this.onlineReconnectListener=zt.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,n){const c=am(this.reconnectCount,this.retryConfig);T.debug("[".concat(this.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(t)),await ce.race([Rn(c),this.onlineReconnectListener||new ce(()=>{})])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;const i=async(c,l)=>{this.emit(ke.RECONNECT_CREATE_CONNECTION,l),await this.createWebSocketConnection(c)};try{if(t==="retry")this.emit(ke.RECONNECT_WAITTING_FINISH,t),await i(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);T.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(ke.RECONNECT_WAITTING_FINISH,t),await i(this.urls[this.currentURLIndex],t)}else t==="recover"&&(T.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(ke.RECONNECT_WAITTING_FINISH,t),this.urls=await hn(this,ke.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],t))}catch(c){var a;T.error("[".concat(this.name,"] reconnect failed ").concat(c&&c.toString()));const l=c==null||(a=c.data)===null||a===void 0?void 0:a.desc;return Array.isArray(l)&&ue(l).call(l,"dynamic key expired")?(this.emit(ke.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,n)}return!0}}class rh extends B1{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const r=Ju(),i=function(c,l){return new _Y(c,l)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),r.reject(new J(O.WS_ABORT,"choose best websocket aborted"))};const a=L("GATEWAY_DOMAINS");return T.debug("[choose-best-ws] currentDomain: ",t,", domains: ",a,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class ih extends B1{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new ce((r,i)=>{let a=!1;const c=[];this.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),c.forEach(I=>{I.onclose=null,I.onopen=null,I.onmessage=null,I.close()}),i(new J(O.WS_ABORT,"choose best websocket aborted"))};const l=L("GATEWAY_DOMAINS");let u;const p=t.indexOf("?h="),f=l.find(I=>p!==-1?ue(t).call(t,I,p):ue(t).call(t,I));T.debug("[choose-best-ws] currentDomain: ",f,", domains: ",l);let m=!this.tryDoubleDomain||!f;if(!m&&f){var E;const I=Date.now();try{l.forEach(v=>{const y=p===-1?t.replace(f,v):t.substr(0,p)+t.substr(p).replace(f,v),b=new WebSocket(y);b.binaryType="arraybuffer",c.push(b),T.debug("[choose-best-ws] ws is connecting:",b.url)})}catch{for(T.debug("[choose-best-ws] ws create failed, fallback to single url"),c.forEach(y=>y.close());c.length;)c.pop();m=!0}(E=this.store)===null||E===void 0||E.recordJoinChannelService({urls:c.map(v=>v.url),service:"gateway"},n),c.forEach(v=>{v.onopen=()=>{if(a)return;const y=Date.now()-I;T.debug("[choose-best-ws] ws open cost ".concat(y,"ms")),c.filter(b=>b!==v).forEach(b=>{T.debug("[choose-best-ws]close backup websocket: ".concat(b.url)),b.close()}),a=!0,r(v)},v.onclose=y=>{u=y,!a&&(c.find(b=>!(b.readyState===WebSocket.CLOSED||b.readyState===WebSocket.CLOSING))||(T.debug("[choose-best-ws] all websocket is closed"),a=!0,i(u)))},v.onmessage=y=>{T.debug("[choose-best-ws]".concat(v.url," onmessage: ").concat(y.data))}}),Rn(this.forceCloseTimeout).then(()=>{c.forEach(v=>{v.readyState!==WebSocket.OPEN&&v.close()})})}if(m){var S;let I;T.debug("[choose-best-ws] use single url: ",t),(S=this.store)===null||S===void 0||S.recordJoinChannelService({urls:[t],service:"gateway"},n);try{I=new WebSocket(t),c.push(I),I.binaryType="arraybuffer"}catch(v){const y=new J(O.WS_ERR,"init websocket failed! Error: ".concat(v.toString()));return T.error("[".concat(this.name,"]").concat(y)),void i(y)}I.onopen=()=>{r(I)},I.onclose=v=>{i(v)},I.onmessage=v=>{T.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(v.data))},Rn(this.forceCloseTimeout).then(()=>{I&&I.readyState!==WebSocket.OPEN&&I.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})}}class W1 extends xt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Ye.CONNECTED?this.emit(Ee.WS_CONNECTED):t===Ye.RECONNECTING?this.emit(Ee.WS_RECONNECTING,this._websocketReconnectReason):t===Ye.CLOSED&&this.emit(Ee.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),w(this,"_disconnectedReason",void 0),w(this,"_websocketReconnectReason",void 0),w(this,"_connectionState",Ye.CLOSED),w(this,"reconnectToken",void 0),w(this,"websocket",void 0),w(this,"openConnectionTime",void 0),w(this,"clientId",void 0),w(this,"lastMsgTime",Date.now()),w(this,"uploadCache",[]),w(this,"uploadCacheInterval",void 0),w(this,"rttRolling",new KT(5)),w(this,"pingpongTimer",void 0),w(this,"wsInflateDataTimer",void 0),w(this,"pingpongTimeoutCount",0),w(this,"joinResponse",void 0),w(this,"multiIpOption",void 0),w(this,"initError",void 0),w(this,"spec",void 0),w(this,"store",void 0),w(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(Ee.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const a="res-@".concat(i._id);this.emit(a,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===Ue.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Ue.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(qe.UID_BANNED);break;case 15:this.close(qe.IP_BANNED);break;case 16:this.close(qe.CHANNEL_BANNED)}if(i._type===Ue.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case be.ERR_LICENSE_MISSING:this.close(qe.LICENSE_MISSING);break;case be.ERR_LICENSE_EXPIRED:this.close(qe.LICENSE_EXPIRED);break;case be.ERR_LICENSE_MINUTES_EXCEEDED:this.close(qe.LICENSE_MINUTES_EXCEEDED);break;case be.ERR_LICENSE_PERIOD_INVALID:this.close(qe.LICENSE_PERIOD_INVALID);break;case be.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(qe.LICENSE_MULTIPLE_SDK_SERVICE);break;case be.ERR_LICENSE_ILLEGAL:this.close(qe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new rh("gateway-".concat(this.clientId),this.spec.retryConfig,!0,L("JOIN_GATEWAY_USE_DUAL_DOMAIN"),L("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ye.CONNECTED&&this.reconnect("retry",Wn.OFFLINE)})}async request(t,n,r,i){const a=Rt(6,""),c={_id:a,_type:t,_message:n},l=this.websocket.connectionID,u=()=>new ce((I,v)=>{if(this.connectionState===Ye.CONNECTED)return I();const y=()=>{this.off(Ee.WS_CLOSED,b),I()},b=()=>{this.off(Ee.WS_CONNECTED,y),v(new B(O.WS_ABORT))};this.once(Ee.WS_CONNECTED,y),this.once(Ee.WS_CLOSED,b),t!==we.PUBLISH&&t!==we.PUBLISH_DATASTREAM&&t!==we.SUBSCRIBE&&t!==we.SUBSCRIBE_DATASTREAM&&t!==we.UNSUBSCRIBE&&t!==we.UNSUBSCRIBE_DATASTREAM&&t!==we.UNPUBLISH&&t!==we.UNPUBLISH_DATASTREAM&&t!==we.CONTROL&&t!==we.RESTART_ICE||this.once(Ee.DISCONNECT_P2P,()=>{v(new B(O.DISCONNECT_P2P))}),t!==we.PUBLISH&&t!==we.RESTART_ICE||this.once(Ee.ABORT_P2P_EXECUTION,()=>{v(new B(O.DISCONNECT_P2P))})});if(this.connectionState!==Ye.CONNECTING&&this.connectionState!==Ye.RECONNECTING||t===we.JOIN||t===we.REJOIN||await u(),this.websocket.sendMessage(c,!0),i)return;const p=new ce((I,v)=>{let y=!1;const b=(U,F)=>{y=!0,I({isSuccess:U==="success",message:F||{}}),this.off(Ee.WS_CLOSED,D),this.off(Ee.WS_RECONNECTING,D),this.emit(Ee.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(a),b);const D=()=>{v(new B(O.WS_ABORT,"type: ".concat(t))),this.off(Ee.WS_CLOSED,D),this.off(Ee.WS_RECONNECTING,D),this.off("res-@".concat(a),b)};this.once(Ee.WS_CLOSED,D),this.once(Ee.WS_RECONNECTING,D),Rn(L("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||y||(T.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Ee.REQUEST_TIMEOUT,t,n))})});let f=null;try{f=await p}catch(I){if(this.connectionState===Ye.CLOSED||t===we.LEAVE)throw new B(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?I.throw():t===we.JOIN||t===we.REJOIN?null:(await u(),await this.request(t,n))}if(f.isSuccess)return f.message;const m=Number(f.message.error_code||f.message.code),E=Dc(m),S=new B(O.UNEXPECTED_RESPONSE,"".concat(E.desc,": ").concat(f.message.error_str),{code:m,data:f.message});return E.action==="success"?f.message:(T.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(m,", message: ").concat(E.desc,", action: ").concat(E.action)),m===be.ERR_TOO_MANY_BROADCASTERS?((t===we.JOIN||t===we.REJOIN)&&(this.initError=S,this.close()),S.throw()):E.action==="failed"?S.throw():E.action==="quit"?(this.initError=S,this.close(),S.throw()):(m===be.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Wn.MULTI_IP)):this.reconnect(E.action,Wn.SERVER_ERROR),t===we.JOIN||t===we.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new ce(r=>{const i=a=>{(!n||n(a))&&(this.off(t,i),r(a))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Nc.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const a=L("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ye.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},L("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}init(t,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ce((r,i)=>{this.once(Ee.WS_CONNECTED,()=>r(this.joinResponse)),this.once(Ee.WS_CLOSED,()=>i(this.initError||new B(O.WS_ABORT))),this.connectionState=Ye.CONNECTING,this.websocket.init(t).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||qe.LEAVE,this.connectionState=Ye.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===qe.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new rh("gateway-".concat(this.clientId),this.spec.retryConfig,!0,L("JOIN_GATEWAY_USE_DUAL_DOMAIN"),L("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(Ee.ABORT_P2P_EXECUTION);const t=await hn(this,Ee.REQUEST_JOIN_INFO),n=await this.request(we.JOIN,t);if(!n)return this.emit(Ee.REPORT_JOIN_GATEWAY,nh.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Ee.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ye.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new B(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=wc(this,Ee.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(we.REJOIN,t);return!!n&&(this.connectionState=Ye.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(Ue.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Ue.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Ue.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Ue.MUTE_AUDIO,{uid:r.uid}):this.emit(Ue.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Ue.MUTE_VIDEO,{uid:r.uid}):this.emit(Ue.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Ue.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Ue.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Ue.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Ue.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Ue.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){T.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Dc(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(qe.UID_BANNED),void this.close()):void this.reconnect(n.action,Wn.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=L("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(T.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>L("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Wn.TIMEOUT):this.request(we.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),L("REPORT_STATS")&&this.send(we.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(Nc.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(ke.RECONNECT_WAITTING_FINISH,t=>{this.emit(Ee.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(ke.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Ee.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(ke.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ke.CLOSED,()=>{this.connectionState=Ye.CLOSED}),this.websocket.on(ke.FAILED,()=>{this._disconnectedReason=qe.NETWORK_ERROR,this.connectionState=Ye.CLOSED}),this.websocket.on(ke.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Ye.CONNECTED?this.connectionState=Ye.RECONNECTING:this.connectionState=Ye.CONNECTING}),this.websocket.on(ke.WILL_RECONNECT,(t,n,r)=>{const i=wc(this,Ee.IS_P2P_DISCONNECTED),a=i||t!=="retry";i&&t==="retry"&&(T.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=nh.P2P_DISCONNECTED),a&&(T.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(Ee.REPORT_JOIN_GATEWAY,n||nh.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Ee.NEED_RENEW_SESSION,this.websocket.currentURLIndex>=this.websocket.urls.length-1?"recover":t),this.emit(Ee.DISCONNECT_P2P)),r(t)}),this.websocket.on(ke.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{T.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Wn.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Ee.REPORT_JOIN_GATEWAY,t.message||t.code||nh.UNKNOWN_REASON,this.url||""),t instanceof B){if(t.code===O.UNEXPECTED_RESPONSE&&t.data.code===be.ERR_NO_AUTHORIZED)return this.initError=new B(O.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Wn.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Wn.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(ke.REQUEST_NEW_URLS,(t,n)=>{hn(this,Ee.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(ke.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}let an=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function G1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Em(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?G1(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G1(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Ta(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(L("TURN_DOMAIN")):(T.info("Unidentified as ip: ".concat(e,", use as host")),e)}function cv(e,t){e.addresses||(e.addresses=[]);const n=function(a,c){if(L("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return a.map(p=>{let{ip:f,port:m}=p;return{address:"".concat(f,":").concat(m)}});const l=L("GATEWAY_DOMAINS");let u=l[1]&&ue(c).call(c,l[1])?1:0;return a.map(p=>{let{domain_prefix:f,port:m,ip:E}=p;if(f)return{address:"".concat(f,".").concat(l[u++%l.length],":").concat(m)};const S=/^[\.\:\d]+$/.test(E),I=S?"".concat(E.replace(/[^\d]/g,"-"),".").concat(l[u++%l.length],":").concat(m):"".concat(E,":").concat(m);return S||T.info("Unidentified as ip: ".concat(E,", use as host")),{ip:E,port:m,address:I}})}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&typeof r=="string"){const a=r.split(";");for(let c=0;c<a.length;c++){var i;const l=sr(i=a[c]).call(i);n[c]&&l&&(n[c].ip6=l)}}return{gatewayAddrs:n,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Lr(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function H1(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(Lr(t.width),"x").concat(Lr(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function K1(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function oh(e,t){let n,r,i;switch(t){case an.CHOOSE_SERVER:r=4096,i="choose server";break;case an.CLOUD_PROXY:r=1048576,i="proxy";break;case an.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case an.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new B(O.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(a=>{a.buffer&&a.buffer.flag===r&&(n={code:a.buffer.code,addresses:(a.buffer.edges_services||[]).map(c=>Em(Em({},c),{},{ticket:a.buffer.cert})),server_ts:e.enter_ts,uid:a.buffer.uid,cid:a.buffer.cid,cname:a.buffer.cname,detail:Em(Em({},a.buffer.detail),e.detail),flag:a.buffer.flag,opid:e.opid,cert:a.buffer.cert})}),!n)throw new B(O.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function z1(e,t){return await ce.all(e.addresses.map(async n=>({address:Ta(n.ip),tcpport:n.port,udpport:n.port,username:t&&L("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Gn.username,password:t&&L("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await WT(t.toString()):Gn.password})))}function dv(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,i=t.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(Lr(e.height),Lr(e.width)),1):(T.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function va(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:a,protocol:c}=e;return r==="local-candidate"?{candidateType:t,relayProtocol:n,protocol:c}:{candidateType:t,relayProtocol:n,address:i,port:a,protocol:c}}function Y1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class EY extends xt{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;ue(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(pn.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(pn.CONNECTED):this._state==="closed"?this.emit(pn.CLOSED):this._state==="failed"&&this.emit(pn.FAILED))}constructor(t,n,r,i){super(),w(this,"connectionID",0),w(this,"currentURLIndex",0),w(this,"reconnectReason",void 0),w(this,"_reconnectMode","tryNext"),w(this,"_initMutex",void 0),w(this,"_name",void 0),w(this,"_state","closed"),w(this,"_reconnectInterrupter",void 0),w(this,"_url",void 0),w(this,"_retryConfig",void 0),w(this,"_reconnectCount",0),w(this,"_forceCloseTimeout",5e3),w(this,"_onlineReconnectListener",void 0),w(this,"_closeEstablishingTransmitter",()=>{}),w(this,"_store",void 0),w(this,"_joinChannelServiceRecordIndex",void 0),w(this,"_transmitter",void 0),w(this,"_useCompress",void 0),w(this,"_inflateLength",0),w(this,"_deflateLength",0),this._store=i,this._name=t,this._retryConfig=function(a){for(var c=1;c<arguments.length;c++){var l=arguments[c]!=null?arguments[c]:{};c%2?Y1(Object(l),!0).forEach(function(u){w(a,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(l)):Y1(Object(l)).forEach(function(u){Object.defineProperty(a,u,Object.getOwnPropertyDescriptor(l,u))})}return a}({},n),this._useCompress=r}resetReconnectCount(t){T.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const r=this._transmitter;n?setTimeout(()=>r.close(),500):r.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,n){if(!this._transmitter)return void T.warning("[".concat(this._name,"] can not reconnect, no websocket"));var r;t!==void 0&&(this.reconnectMode=t),T.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((r=this._store)===null||r===void 0||r.recordJoinChannelService({status:"error",errors:[new Error(n)]},this._joinChannelServiceRecordIndex));const i=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),i&&i.bind(this._transmitter)({code:9999,reason:n})}getInflateData(){const t=this._inflateLength,n=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:n}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let Ao=function(e){return e[e.Default=0]="Default",e[e.Ack=1]="Ack",e}({});class gY{constructor(t,n,r){w(this,"version",1),w(this,"initialRTO",void 0),w(this,"maxBatchAckCount",void 0),w(this,"maxRTO",void 0),w(this,"initialRTT",void 0),w(this,"ID",void 0),w(this,"rtt",void 0),w(this,"packetNumber",1),w(this,"rtoRatioMap",new Map),w(this,"timeoutMap",new Map),w(this,"unorderedPacketQueue",[]),w(this,"batchAckPacketQueue",[]),w(this,"lastOrderedPacketNumber",0),w(this,"batchAckTimer",void 0),w(this,"sendImpl",void 0),w(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=n,this.ID=Rt(7,"transmitter-"),this.initialRTO=(r==null?void 0:r.initialRTO)!==void 0?r.initialRTO:L("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(r==null?void 0:r.initialRTT)!==void 0?r.initialRTT:L("TRANSMITTER_INITIAL_RTT"),this.rtt=(r==null?void 0:r.initialRTT)!==void 0?r.initialRTT:L("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(r==null?void 0:r.maxBatchAckCount)!==void 0?r.maxBatchAckCount:L("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(r==null?void 0:r.maxRTO)!==void 0?r.maxRTO:L("TRANSMITTER_MAX_RTO")}packetize(t,n){return{type:Ao.Default,version:this.version,packetNumber:n,payload:t}}serialize(t){switch(t.type){case Ao.Default:{let n;typeof t.payload=="string"?n=new TextEncoder().encode(t.payload):n=t.payload;const r=new ArrayBuffer(n.length+15),i=new DataView(r);return i.setUint16(0,t.version),i.setUint8(2,t.type),i.setUint32(3,t.packetNumber),n1(i,7,BigInt(t.sendTs)),new Uint8Array(i.buffer).set(n,15),r}case Ao.Ack:{const n=new ArrayBuffer(16),r=new DataView(n);return r.setUint16(0,t.version),r.setUint8(2,t.type),r.setUint32(3,t.maxAckPacketNumber),r.setUint8(7,t.shift),n1(r,8,BigInt(t.ackSendTs)),n}}}deserialize(t){const n=new DataView(t),r=n.getUint16(0),i=n.getUint8(2);switch(i){case Ao.Default:{const a=n.getUint32(3),c=t1(n,7),l=t.slice(15),u=new TextDecoder().decode(l);return{version:r,type:i,packetNumber:a,sendTs:Number(c),payload:u}}case Ao.Ack:{const a=n.getUint32(3),c=n.getUint8(7),l=t1(n,8);return{version:r,type:i,maxAckPacketNumber:a,shift:c,ackSendTs:Number(l)}}default:throw T.error("[".concat(this.ID,"] Unrecognized packet type ").concat(i)),new Error("Unrecognized packet type ".concat(i))}}sendMessage(t){const n=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const r=this.calculateRTO(n),i=window.setTimeout(()=>{this.resendMessage(n)},r);this.timeoutMap.set(n.packetNumber,i),this.sendPacket(n)}onData(t){const n=this.deserialize(t);n.type===Ao.Default?this.ack(n):n.type===Ao.Ack&&(this.updateRTT(n,Math.round(performance.now())),this.clearRTO(n))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[n,r]=t;window.clearTimeout(r)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){const n=this.calculateRTO(t),r=window.setTimeout(()=>{this.resendMessage(t)},n);this.timeoutMap.set(t.packetNumber,r),this.sendPacket(t)}calculateRTO(t){const n=this.rtoRatioMap.get(t.packetNumber);if(n===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{const r=9*this.rtt/8*n;return this.rtoRatioMap.set(t.packetNumber,n+1),r>this.maxRTO?this.maxRTO:r}}updateRTT(t,n){const r=t.ackSendTs;this.rtt=this.rtt*(7/8)+(n-r-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){const n=this.unorderedPacketQueue[0];if(!n){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(n.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Ao.Ack,version:this.version};this.sendPacket(n)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Ao.Ack,version:this.version};this.sendPacket(n)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Ao.Ack,version:this.version};this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===Ao.Default&&(t.sendTs=Math.round(performance.now()));const n=this.serialize(t);this.sendImpl(n)}clearRTO(t){for(let n=t.maxAckPacketNumber-t.shift;n<=t.maxAckPacketNumber;n++){const r=this.timeoutMap.get(n);r!==void 0&&window.clearTimeout(r),this.timeoutMap.delete(n),this.rtoRatioMap.delete(n)}}}class q1 extends EY{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),w(this,"_initMutex",void 0),w(this,"_reconnectInterrupter",void 0),w(this,"_url",void 0),w(this,"_transmitter",void 0),w(this,"_addresses",void 0),w(this,"_reliableTransmission",void 0),this._initMutex=new On("datachannel");const{timeout:r,timeoutFactor:i}=n,a=Math.max(300,Math.floor(3*r/5)),c=Math.max(1.2,Math.floor(8*i)/10);mr.ONLINE&&(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=c),zt.on(Rc.NETWORK_STATE_CHANGE,(l,u)=>{l!==u&&(this.resetReconnectCount("network state change: ".concat(u," -> ").concat(l)),l===mr.ONLINE?(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=c):(this._retryConfig.timeout=r,this._retryConfig.timeoutFactor=i))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=n;const r=(i,a)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(l=>l.fingerprint||L("FINGERPRINT"));const c=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(c).then(i).catch(a),this.once(pn.CLOSED,()=>a(new B(O.WS_DISCONNECT))),this.once(pn.CONNECTED,()=>i())};return this._initMutex.lock().then(i=>new ce((a,c)=>{r(a,c)}).then(()=>{i()}).catch(()=>{i()}))}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new B(O.WS_ABORT,"datachannel is not ready");try{n||(t=JSON.stringify(t)),this._reliableTransmission.sendMessage(t)}catch(r){throw new B(O.WS_ERR,"send datachannel signal message error"+r.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){const n=JSON.stringify(t);return{compressed:n,compressedLength:n.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new ce((n,r)=>{var i;const a=()=>{T.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n()},c=async f=>{var m;if((m=this._closeEstablishingTransmitter)===null||m===void 0||m.call(this),T.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(f.code,", reason: ").concat(f.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=f.reason,this.state="reconnecting");const E=zr(this,pn.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,S=await this.reconnectWithAction(E);if(this.state==="closed")return void T.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!S)return r(new B(O.WS_DISCONNECT,"datachannel reconnect failed: ".concat(f.code))),void this.close(!0);n()}else r(new B(O.WS_DISCONNECT,"datachannel close: ".concat(f.code))),this.close()},l=f=>{var m;(m=this._reliableTransmission)===null||m===void 0||m.onData(f.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),T.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));const u=(i=this._store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),p=Date.now();hn(this,pn.TO_CONNECT_DATACHANNEL,t).then(f=>{var m,E;if(!f)throw new Error("transmissonInfo not exist yet");const{transmitter:S,close:I}=f;this._transmitter=S,(m=this._store)===null||m===void 0||m.signalChannelOpen();const v=Date.now()-p;T.debug("[choose dc] dc open cost ".concat(v,"ms")),this._reliableTransmission=new gY(y=>{var b;this._transmitter&&this._transmitter.readyState==="open"&&((b=this._transmitter)===null||b===void 0||b.send(y))},y=>{typeof y=="string"&&this.emit(pn.ON_MESSAGE,y)}),this._closeEstablishingTransmitter=()=>{var y;(y=this._reliableTransmission)===null||y===void 0||y.close(),this._reliableTransmission=void 0,I()},a&&a(),S.onclose=c,S.onmessage=l,(E=this._store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:"success"},u),this._joinChannelServiceRecordIndex=u}).catch(f=>{var m;if((m=this._store)===null||m===void 0||m.recordJoinChannelService({endTs:Date.now(),status:f instanceof B&&f.code===O.WS_ABORT?"aborted":"error",errors:[f]},u),this.state!=="closed"){if(f instanceof B&&f.code===O.WS_ERR){const E=new B(O.WS_ERR,"init datachannel failed! Error: ".concat(f.toString()));return T.error("[".concat(this._name,"]").concat(E)),void r(E)}c&&c(f)}else r(new B(O.WS_DISCONNECT,"datachannel is closed: ".concat(f.toString())))})})}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||zt.networkState!==mr.OFFLINE||(this._onlineReconnectListener=zt.onlineWaiter&&zt.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let r=!0;if(this._reconnectInterrupter=()=>{r=!1},n){const l=am(this._reconnectCount,this._retryConfig);T.debug("[".concat(this._name,"] wait ").concat(l,"ms to reconnect datachannel, mode: ").concat(t)),await ce.race([Rn(l),this._onlineReconnectListener||new ce(()=>{})])}if(this.state==="closed"||!r)return!1;this._reconnectCount+=1;const i=async(l,u)=>{this.emit(pn.RECONNECT_CREATE_CONNECTION,u),await this.createTransmitterConnection(l)};try{if(t==="retry"){const l=this._addresses[this.currentURLIndex];this.emit(pn.RECONNECT_WAITTING_FINISH,t),await i(l,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let u=this.currentURLIndex;u<this._addresses.length;u++){if(this._addresses[u].fingerprint||L("FINGERPRINT")){this.currentURLIndex=u;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return T.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);T.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const l=this._addresses[this.currentURLIndex];this.emit(pn.RECONNECT_WAITTING_FINISH,t),await i(l,t)}else t==="recover"&&(T.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(pn.RECONNECT_WAITTING_FINISH,t),this.emit(pn.FAILBACK));return!0}catch(l){var a,c;return T.error("[".concat(this._name,"] reconnect failed"),l.toString()),l!=null&&(a=l.data)!==null&&a!==void 0&&a.desc&&Array.isArray(l.data.desc)&&l.data.desc.length&&ue(c=l.data.desc).call(c,"dynamic key expired")?(this.emit(pn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,n)}}}class ks extends xt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Ye.CONNECTED?this.emit(Ee.WS_CONNECTED):t===Ye.RECONNECTING?this.emit(Ee.WS_RECONNECTING,this._websocketReconnectReason):t===Ye.CLOSED&&this.emit(Ee.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),w(this,"_disconnectedReason",void 0),w(this,"_websocketReconnectReason",void 0),w(this,"_connectionState",Ye.CLOSED),w(this,"reconnectToken",void 0),w(this,"websocket",void 0),w(this,"openConnectionTime",void 0),w(this,"clientId",void 0),w(this,"lastMsgTime",Date.now()),w(this,"uploadCache",[]),w(this,"uploadCacheInterval",void 0),w(this,"rttRolling",new KT(5)),w(this,"pingpongTimer",void 0),w(this,"inflateDataTimer",void 0),w(this,"pingpongTimeoutCount",0),w(this,"joinResponse",void 0),w(this,"multiIpOption",void 0),w(this,"initError",void 0),w(this,"spec",void 0),w(this,"store",void 0),w(this,"onWebsocketMessage",r=>{if(r instanceof ArrayBuffer)return void this.emit(Ee.ON_BINARY_DATA,r);const i=JSON.parse(r);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const a="res-@".concat(i._id);this.emit(a,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")&&(this.emit(i._type,i._message),i._type===Ue.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Ue.ON_USER_BANNED))switch(i._message.error_code){case 14:this.close(qe.UID_BANNED);break;case 15:this.close(qe.IP_BANNED);break;case 16:this.close(qe.CHANNEL_BANNED)}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new q1("gateway-".concat(this.clientId),this.spec.retryConfig,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ye.CONNECTED&&this.reconnect("retry",ga.OFFLINE)})}async request(t,n,r,i){const a=Rt(6,""),c={_id:a,_type:t,_message:n},l=this.websocket.connectionID,u=()=>new ce((I,v)=>{if(this.connectionState===Ye.CONNECTED)return I();const y=()=>{this.off(Ee.WS_CLOSED,b),I()},b=()=>{this.off(Ee.WS_CONNECTED,y),v(new B(O.WS_ABORT))};this.once(Ee.WS_CONNECTED,y),this.once(Ee.WS_CLOSED,b),t!==we.PUBLISH&&t!==we.SUBSCRIBE&&t!==we.UNSUBSCRIBE&&t!==we.UNPUBLISH&&t!==we.CONTROL&&t!==we.RESTART_ICE||this.once(Ee.DISCONNECT_P2P,()=>{v(new B(O.DISCONNECT_P2P))}),t!==we.PUBLISH&&t!==we.RESTART_ICE||this.once(Ee.ABORT_P2P_EXECUTION,()=>{v(new B(O.DISCONNECT_P2P))})});if(this.connectionState!==Ye.CONNECTING&&this.connectionState!==Ye.RECONNECTING||t===we.JOIN||t===we.REJOIN||await u(),t===we.LEAVE&&(this.websocket.unbindDcCloseEventListener(),i=!0),this.websocket.sendMessage(c,!0,!1),i)return;const p=new ce((I,v)=>{let y=!1;const b=(U,F)=>{y=!0,I({isSuccess:U==="success",message:F||{}}),this.off(Ee.WS_CLOSED,D),this.off(Ee.WS_RECONNECTING,D),this.emit(Ee.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(a),b);const D=()=>{v(new B(O.WS_ABORT,"type: ".concat(t))),this.off(Ee.WS_CLOSED,D),this.off(Ee.WS_RECONNECTING,D),this.off("res-@".concat(a),b)};this.once(Ee.WS_CLOSED,D),this.once(Ee.WS_RECONNECTING,D),Rn(L("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||y||(T.warning("dc request timeout, type: ".concat(t)),this.emit(Ee.REQUEST_TIMEOUT,t,n))})});let f=null;try{f=await p}catch(I){if(this.connectionState===Ye.CLOSED||t===we.LEAVE)throw new B(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?I.throw():t===we.JOIN||t===we.REJOIN?null:(await u(),await this.request(t,n))}if(f.isSuccess)return f.message;const m=Number(f.message.error_code||f.message.code),E=Dc(m),S=new B(O.UNEXPECTED_RESPONSE,"".concat(E.desc,": ").concat(f.message.error_str),{code:m,data:f.message});return E.action==="success"?f.message:(T.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(m,", message: ").concat(E.desc,", action: ").concat(E.action)),m===be.ERR_TOO_MANY_BROADCASTERS?((t===we.JOIN||t===we.REJOIN)&&(this.initError=S,this.close()),S.throw()):E.action==="failed"?S.throw():E.action==="quit"?(this.initError=S,this.close(),S.throw()):(m===be.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ga.MULTI_IP)):this.reconnect(E.action,ga.SERVER_ERROR),t===we.JOIN||t===we.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new ce(r=>{const i=a=>{(!n||n(a))&&(this.off(t,i),r(a))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Nc.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const a=L("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ye.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},L("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}init(t,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ce((r,i)=>{this.once(Ee.WS_CONNECTED,()=>r(this.joinResponse)),this.once(Ee.WS_CLOSED,()=>i(this.initError||new B(O.WS_ABORT))),this.connectionState=Ye.CONNECTING,this.websocket.init(t).catch(i),this.websocket.once(pn.FAILBACK,()=>{this.openConnectionTime===void 0&&i(new B(O.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{n&&this.openConnectionTime===void 0&&(T.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),i(new B(O.INIT_DATACHANNEL_TIMEOUT)))},L("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||qe.LEAVE,this.connectionState=Ye.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===qe.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new q1("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(Ee.ABORT_P2P_EXECUTION);const t=await hn(this,Ee.DATACHANNEL_CONNECTING),n=await this.request(we.JOIN,t);if(!n)return this.emit(Ee.REPORT_JOIN_GATEWAY,O.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Ee.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ye.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new B(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=wc(this,Ee.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(we.REJOIN,t);return!!n&&(this.connectionState=Ye.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(Ue.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Ue.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Ue.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Ue.MUTE_AUDIO,{uid:r.uid}):this.emit(Ue.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Ue.MUTE_VIDEO,{uid:r.uid}):this.emit(Ue.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Ue.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Ue.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Ue.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Ue.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Ue.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){T.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Dc(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(qe.UID_BANNED),void this.close()):void this.reconnect(n.action,ga.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=L("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(T.warning("PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>L("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ga.TIMEOUT):this.request(we.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),L("REPORT_STATS")&&this.send(we.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleInflateData(){const{inflateLength:t,deflateLength:n}=this.websocket.getInflateData();t!==0&&n!==0&&this.upload(Nc.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(pn.RECONNECT_WAITTING_FINISH,t=>{this.emit(Ee.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(pn.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Ee.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(pn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pn.CLOSED,()=>{this.connectionState=Ye.CLOSED}),this.websocket.on(pn.FAILED,()=>{this._disconnectedReason=qe.NETWORK_ERROR,this.connectionState=Ye.CLOSED}),this.websocket.on(pn.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Ye.CONNECTED?this.connectionState=Ye.RECONNECTING:this.connectionState=Ye.CONNECTING}),this.websocket.on(pn.WILL_RECONNECT,(t,n)=>{if(wc(this,Ee.IS_P2P_DISCONNECTED)&&t==="retry")return T.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(Ee.NEED_RENEW_SESSION),this.emit(Ee.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(T.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(Ee.NEED_RENEW_SESSION),this.emit(Ee.DISCONNECT_P2P)),n(t)}),this.websocket.on(pn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{T.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",ga.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Ee.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof B&&t.code===O.UNEXPECTED_RESPONSE&&t.data.code===be.ERR_NO_AUTHORIZED)return T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ga.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ga.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(pn.REQUEST_NEW_URLS,(t,n)=>{hn(this,Ee.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(pn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(pn.TO_CONNECT_DATACHANNEL,async(t,n,r)=>hn(this,Ee.DATACHANNEL_PRECONNECT,t).then(n).catch(r)),this.websocket.on(pn.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(Ee.DATACHANNEL_FAILBACK)})}}class Pc extends xt{constructor(t,n){super(),w(this,"signal",void 0),w(this,"token",void 0),w(this,"tokenTimeout",void 0),w(this,"tokenInterval",void 0),w(this,"_sequence",0),w(this,"userMap",new Map),w(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const r=()=>{this.signal.connectionState===Ye.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*L("P2P_TOKEN_INTERVAL"))};r()}async send(t,n,r,i,a){var c,l,u;if(this.userMap.size===0)return;const p=Array.from(Io(c=this.userMap).call(c))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),i=(l=i)!==null&&l!==void 0?l:Rt(6,""),a=(u=a)!==null&&u!==void 0?u:this._sequence++;const f={_id:i,_type:t,_seq:a,_message:n,token:"".concat(this.token,"_").concat(p)};L("SHOW_P2P_LOG")&&T.debug("send message",f,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(f)).forEach(E=>{this.signal.request(we.DATA_STREAM,{payload:ma(this.encoder.encode(E))})});const m=new ce((E,S)=>{const I=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),v),this.off("res-@".concat(i),b),this.off(tl.ABORT,y),T.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(i)),this.userMap.size===0?S(new J(O.INVALID_REMOTE_USER)):S(new J(O.TIMEOUT))},L("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),v=()=>{I&&window.clearTimeout(I),this.off(tl.ABORT,y),r&&E()},y=()=>{I&&window.clearTimeout(I),this.off("res-@".concat(i,"_ack"),v),this.off("res-@".concat(i),b),S(new J(O.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(i)))};this.once(tl.ABORT,y),this.once("res-@".concat(i,"_ack"),v);const b=(U,F)=>{D=!0,I&&window.clearTimeout(I),this.off("res-@".concat(i,"_ack"),v),this.off(tl.ABORT,y),U==="success"?E(F):S(new J(O.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(i)))};let D=!1;r||(this.once("res-@".concat(i),b),Rn(L("SIGNAL_REQUEST_TIMEOUT")).then(()=>{D||T.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(i,", ").concat(f))}))});try{return await m}catch(E){if(E.code===O.TIMEOUT)return await this.send(t,n,r,i,a);throw E}}onMessage(t){var n;const{_uid:r}=t;let i,a=this.userMap.get(r);if(a)i=a.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==$t.CHECK)return;const{token:p}=t;i=new Map,a={uid:r,isStart:!0,token:p,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,a),this.signal.emit(Ue.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in t&&"total"in t){var c;const{id:p,total:f}=t,m=(c=i.get(p))!==null&&c!==void 0?c:[];if(m.push(t),i.has(p)||i.set(p,m),m.length!==f)return;{const E=Mu(m).call(m,(S,I)=>S.index-I.index).map(S=>S.payload).join("");i.delete(p),(t=JSON.parse(E))._uid=r}}const{_type:l,token:u}=t;if(ue(n=[$t.ACK,$t.CHECK]).call(n,l))return l===$t.CHECK&&this.handleCheckToken(a,u),void this.receiveMessage(t);u==="".concat(a.token,"_").concat(this.token)?this.handleReceivedMessage(t):T.debug('Receive unexpected message", '.concat(u,", cur_token: ").concat(a.token,"_").concat(this.token),t)}check(){const t={_id:Rt(6,""),token:this.token,_type:$t.CHECK};L("SHOW_P2P_LOG")&&T.debug("send message",t),this.signal.request(we.DATA_STREAM,{payload:ma(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:$t.ACK,token:this.token};L("SHOW_P2P_LOG")&&T.debug("send message",n),this.signal.request(we.DATA_STREAM,{payload:ma(this.encoder.encode(JSON.stringify(n)))})}response(t,n,r){this.send($t.RESPONSE,JSON.stringify({success:!r,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(p=>{const{receivedMessagesMap:f,nextExpectedSequenceNumber:m}=p;for(;f.has(m);){const E=f.get(m);f.delete(m),this.receiveMessage(E),p.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:r,_seq:i}=t,a=this.userMap.get(r),{receivedMessagesMap:c,isStart:l,nextExpectedSequenceNumber:u}=a;if(i<u)return this.ack(t._id),void T.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(t._message));c.set(i,t),l&&i===u&&(this.receiveMessage(t),c.delete(u),a.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:r,_message:i,_uid:a}=t;if(L("SHOW_P2P_LOG")&&T.debug("receive message",t),n){let c;switch(t._type!==$t.ACK&&(i&&(c=JSON.parse(i)),this.ack(t._id)),t._type){case $t.CANDIDATE:case $t.CONTROL:this.signal.emit(r,c,a);break;case $t.PUBLISH:case $t.UNPUBLISH:case $t.RESTART_ICE:case $t.CALL:c.uid=a,hn(this.signal,r,c).then(l=>{this.response(t._id,l)}).catch(()=>{this.response(t._id,void 0,!0)});break;case $t.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case $t.RESPONSE:{const{success:l,message:u}=c;this.emit("res-@".concat(n),l?"success":"failed",u);break}}}}splitMessage(t){if(t.length<Pc.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:r}=JSON.parse(t),i=Rt(6,"");let a=0,c=800;const l=Math.ceil(t.length/c);for(;t.length>0;){a++;const u={id:i,index:a,total:l,payload:t.slice(0,c),token:"".concat(this.token,"_").concat(r)};JSON.stringify(u).length>Pc.MAX_MESSAGE_SIZE?c-=50:(n.push(u),t=t.slice(c))}return n.map(u=>JSON.stringify(u))}handleCheckToken(t,n){return t.token!==n?(T.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{T.debug("token timeout, ".concat(n)),this.reset(t.uid)},L("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await hn(this.signal,$t.CALL,void 0),n=await this.send($t.CALL,t);this.signal.emit(Ee.P2P_CONNECTION,n,!0)}async reset(t,n){const r=this.userMap.get(t);r&&(this.emit(tl.ABORT),this.signal.emit(Ue.ON_USER_OFFLINE,{uid:r.uid,reason:cY.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(T.debug("change local token from ".concat(n," to ").concat(n)),this.token=Rt(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(tl.ABORT)}}w(Pc,"MAX_SIZE",1),w(Pc,"MAX_MESSAGE_SIZE",1024);class J1 extends xt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Ye.CONNECTED?this.emit(Ee.WS_CONNECTED):t===Ye.RECONNECTING?this.emit(Ee.WS_RECONNECTING,this._websocketReconnectReason):t===Ye.CLOSED&&this.emit(Ee.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),w(this,"_disconnectedReason",void 0),w(this,"_websocketReconnectReason",void 0),w(this,"_connectionState",Ye.CLOSED),w(this,"reconnectToken",void 0),w(this,"p2pToken",void 0),w(this,"websocket",void 0),w(this,"openConnectionTime",void 0),w(this,"clientId",void 0),w(this,"lastMsgTime",Date.now()),w(this,"uploadCache",[]),w(this,"uploadCacheInterval",void 0),w(this,"rttRolling",new KT(5)),w(this,"pingpongTimer",void 0),w(this,"pingpongTimeoutCount",0),w(this,"joinResponse",void 0),w(this,"multiIpOption",void 0),w(this,"initError",void 0),w(this,"spec",void 0),w(this,"store",void 0),w(this,"_external_signal",void 0),w(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(Ee.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const a="res-@".concat(i._id);this.emit(a,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case Ue.ON_DATA_STREAM:return void this.handleDataStream(i._message);case Ue.MUTE_AUDIO:case Ue.MUTE_VIDEO:case Ue.ON_P2P_LOST:case Ue.ON_USER_ONLINE:return;case Ue.ON_USER_OFFLINE:const{uid:a}=i._message;return T.debug("[".concat(this.clientId,"] user-offline uid: ").concat(a)),void this._external_signal.reset(a)}if(this.emit(i._type,i._message),i._type===Ue.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Ue.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(qe.UID_BANNED);break;case 15:this.close(qe.IP_BANNED);break;case 16:this.close(qe.CHANNEL_BANNED)}if(i._type===Ue.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case be.ERR_LICENSE_MISSING:this.close(qe.LICENSE_MISSING);break;case be.ERR_LICENSE_EXPIRED:this.close(qe.LICENSE_EXPIRED);break;case be.ERR_LICENSE_MINUTES_EXCEEDED:this.close(qe.LICENSE_MINUTES_EXCEEDED);break;case be.ERR_LICENSE_PERIOD_INVALID:this.close(qe.LICENSE_PERIOD_INVALID);break;case be.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(qe.LICENSE_MULTIPLE_SDK_SERVICE);break;case be.ERR_LICENSE_ILLEGAL:this.close(qe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new rh("gateway-".concat(this.clientId),this.spec.retryConfig,!0,L("JOIN_GATEWAY_USE_DUAL_DOMAIN"),L("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ye.CONNECTED&&this.reconnect("retry",Wn.OFFLINE)}),this.p2pToken=Rt(6,""),this._external_signal=new Pc(this,this.p2pToken)}async request(t,n,r,i){const a=Rt(6,""),c={_id:a,_type:t,_message:n},l=this.websocket.connectionID,u=()=>new ce((I,v)=>{if(this.connectionState===Ye.CONNECTED)return I();const y=()=>{this.off(Ee.WS_CLOSED,b),I()},b=()=>{this.off(Ee.WS_CONNECTED,y),v(new J(O.WS_ABORT))};this.once(Ee.WS_CONNECTED,y),this.once(Ee.WS_CLOSED,b)});if(this.connectionState!==Ye.CONNECTING&&this.connectionState!==Ye.RECONNECTING||t===we.JOIN||t===we.REJOIN||await u(),this.websocket.sendMessage(c,!0),i)return;const p=new ce((I,v)=>{let y=!1;const b=(U,F)=>{y=!0,I({isSuccess:U==="success",message:F||{}}),this.off(Ee.WS_CLOSED,D),this.off(Ee.WS_RECONNECTING,D),this.emit(Ee.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(a),b);const D=()=>{v(new J(O.WS_ABORT,"type: ".concat(t))),this.off(Ee.WS_CLOSED,D),this.off(Ee.WS_RECONNECTING,D),this.off("res-@".concat(a),b)};this.once(Ee.WS_CLOSED,D),this.once(Ee.WS_RECONNECTING,D),Rn(L("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||y||(T.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Ee.REQUEST_TIMEOUT,t,n))})});let f=null;try{f=await p}catch(I){if(this.connectionState===Ye.CLOSED||t===we.LEAVE)throw new J(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?I.throw():t===we.JOIN||t===we.REJOIN?null:(await u(),await this.request(t,n))}if(f.isSuccess)return f.message;const m=Number(f.message.error_code||f.message.code),E=Dc(m),S=new J(O.UNEXPECTED_RESPONSE,"".concat(E.desc,": ").concat(f.message.error_str),{code:m,data:f.message});return E.action==="success"?f.message:(T.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(m,", message: ").concat(E.desc,", action: ").concat(E.action)),m===be.ERR_TOO_MANY_BROADCASTERS?((t===we.JOIN||t===we.REJOIN)&&(this.initError=S,this.close()),S.throw()):E.action==="failed"?S.throw():E.action==="quit"?(this.initError=S,this.close(),S.throw()):(m===be.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Wn.MULTI_IP)):this.reconnect(E.action,Wn.SERVER_ERROR),t===we.JOIN||t===we.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new ce(r=>{const i=a=>{(!n||n(a))&&(this.off(t,i),r(a))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Nc.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const a=L("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ye.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},L("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}async sendExtensionMessage(t,n,r){return await this._external_signal.send(t,n,r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ce((n,r)=>{this.once(Ee.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Ee.WS_CLOSED,()=>r(this.initError||new J(O.WS_ABORT))),this.connectionState=Ye.CONNECTING,this.websocket.init(t).catch(r)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||qe.LEAVE,this.connectionState=Ye.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===qe.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new rh("gateway-".concat(this.clientId),this.spec.retryConfig,!0,L("JOIN_GATEWAY_USE_DUAL_DOMAIN"),L("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents()),this.p2pToken=Rt(6,""),this._external_signal.clear(),this._external_signal=new Pc(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Ee.ABORT_P2P_EXECUTION);const t=await hn(this,Ee.REQUEST_JOIN_INFO),n=await this.request(we.JOIN,t);if(!n)return this.emit(Ee.REPORT_JOIN_GATEWAY,O.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Ee.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ye.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleDataStream(t){try{var n;const r=bc(t.payload),i=new TextDecoder().decode(r),a=JSON.parse(i);"total"in a&&"id"in a||ue(n=Object.values($t)).call(n,a._type)?(a._uid=t.uid,this._external_signal.onMessage(a)):this.emit(Ue.ON_DATA_STREAM,t)}catch{this.emit(Ue.ON_DATA_STREAM,t)}}handleNotification(t){T.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Dc(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(qe.UID_BANNED),void this.close()):void this.reconnect(n.action,Wn.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=L("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(T.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>L("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Wn.TIMEOUT):this.request(we.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),L("REPORT_STATS")&&this.send(we.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(ke.RECONNECT_WAITTING_FINISH,t=>{this.emit(Ee.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(ke.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Ee.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(ke.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ke.CLOSED,()=>{this.connectionState=Ye.CLOSED}),this.websocket.on(ke.FAILED,()=>{this._disconnectedReason=qe.NETWORK_ERROR,this.connectionState=Ye.CLOSED}),this.websocket.on(ke.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Ye.CONNECTED?this.connectionState=Ye.RECONNECTING:this.connectionState=Ye.CONNECTING}),this.websocket.on(ke.WILL_RECONNECT,(t,n,r)=>{t!=="retry"?(T.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(Ee.NEED_RENEW_SESSION)):T.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(t)}),this.websocket.on(ke.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(Ee.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof J&&t.code===O.UNEXPECTED_RESPONSE&&t.data.code===be.ERR_NO_AUTHORIZED)return T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Wn.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Wn.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(ke.REQUEST_NEW_URLS,(t,n)=>{hn(this,Ee.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(ke.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function X1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Xi(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?X1(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X1(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const lv=new Map;class SY extends xt{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Zt.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(Zt.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){T.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){super(),w(this,"store",void 0),w(this,"joinInfo",void 0),w(this,"key",void 0),w(this,"ntpOffset",0),w(this,"signal",void 0),w(this,"role",void 0),w(this,"inChannelInfo",{joinAt:null,duration:0}),w(this,"spec",void 0),w(this,"_state","DISCONNECTED"),w(this,"_statsCollector",void 0),w(this,"_disconnectedReason",void 0),w(this,"isSignalRecover",!1),w(this,"hasChangeBGPAddress",!1),w(this,"trafficStatsInterval",void 0),w(this,"networkQualityInterval",void 0),w(this,"_joinGatewayStartTime",0),w(this,"_signalTimeout",!1),w(this,"_clientRoleOptions",void 0),w(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?new J1(Xi(Xi({},n),{},{retryConfig:n.websocketRetryConfig}),t):this.store.useDataChannel?new ks(Xi(Xi({},n),{},{retryConfig:n.websocketRetryConfig}),t):new W1(Xi(Xi({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,r){if(this.signal instanceof ks){let u=!1;t.cloudProxyServer!=="disabled"?(T.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),u=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(T.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),u=!0):t.apResponse.addresses.some(p=>p.fingerprint)||L("FINGERPRINT")||(T.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),u=!0),u&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const i=Date.now();let a=lv.get(t.cname);if(a||(a=new Map,lv.set(t.cname,a)),this._isProactiveJoin=!0,a.has(t.uid)){const u=new B(O.UID_CONFLICT);throw Ce.joinGateway(t.sid,{lts:i,succ:!1,ec:u.message,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:this.signal instanceof ks?"1":"0"}),this._isProactiveJoin=!1,u}a.set(t.uid,!0),this.joinInfo=t,this.key=n;let c=0;this.joinGatewayStartTime=i;const l=t.proxyServer;try{let u;if(T.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof ks?"datachannel":"websocket"," join uid ").concat(c)),this.signal instanceof ks)u=await this.signal.init(t.apResponse.addresses,r);else{const p=t.gatewayAddrs.map(f=>{let{address:m}=f;const[E,S]=m.split(":"),I={host:E,port:S};return t.proxyServer&&(I.proxy=t.proxyServer),I});u=await this.signal.init(p,r)}c=u.uid,T.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof ks?"datachannel":"websocket"," join uid ").concat(c," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(u){throw u&&u.code===O.INIT_WEBSOCKET_TIMEOUT?(T.warning("[".concat(this.store.clientId,"] User join failed"),u.toString()),u):u&&u.code===O.INIT_DATACHANNEL_TIMEOUT?(T.warning("[".concat(this.store.clientId,"] User join datachannel failed"),u.toString()),this.resetSignal(),u):(T.error("[".concat(this.store.clientId,"] User join failed"),u.toString()),Ce.joinGateway(t.sid,{lts:i,succ:!1,ec:u.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!l,signalChannel:this.signal instanceof ks?"1":"0"}),this._isProactiveJoin=!1,a.delete(t.uid),this.signal.close(),u)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),T.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(u=>{T.warning("[".concat(this.store.clientId,"] get traffic stats error"),u.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Zt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Zt.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Zt.NETWORK_QUALITY,{uplinkNetworkQuality:K1(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:K1(this._statsCollector.trafficStats.B_dnq)}):this.emit(Zt.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),c}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==qe.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Ye.CONNECTED||await function(r,i){return i===1/0?r:ce.race([r,sz(i)])}(this.signal.request(we.LEAVE,void 0,!0),3e3)}catch(r){T.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(n),n!==qe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:L("PUB_EXTEND"),twcc:!!L("PUBLISH_TWCC"),rtx:!!L("USE_PUB_RTX")};try{return(await this.signal.request(we.PUBLISH,i,!0))._message}catch(a){if(r&&a.data&&a.data.code===be.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),a.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw a}}async publishDataChannel(t,n,r){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const a={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(i=n.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(we.PUBLISH_DATASTREAM,a,!0)}catch(c){if(r&&c.data&&c.data.code===be.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),c.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw c}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(we.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(r){T.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ce.all(t.map(n=>this.signal.request(we.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){T.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!L("SUBSCRIBE_TWCC"),rtx:!!L("USE_SUB_RTX")||void 0,extend:L("SUB_EXTEND"),svc:Array.isArray(L("SVC"))&&L("SVC").length!==0?L("SVC"):void 0};try{return await this.signal.request(we.PRE_SUBSCRIBE,i,!0)}catch(a){if(r&&a.data&&a.data.code===be.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),a.toString()),this.presubscribe(t,n,!1);throw a}}async subscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!L("SUBSCRIBE_TWCC"),rtx:!!L("USE_SUB_RTX"),extend:L("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(L("SVC"))&&L("SVC").length!==0?L("SVC"):void 0};try{return(await this.signal.request(we.SUBSCRIBE,i,!0))._message}catch(a){if(r&&a.data&&a.data.code===be.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),a.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw a}}async subscribeDataChannel(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(we.SUBSCRIBE_DATASTREAM,i,!0)}catch(a){if(r&&a.data&&a.data.code===be.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),a.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw a}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!L("USE_SUB_RTX"),twcc:!!L("SUBSCRIBE_TWCC"),svc:Array.isArray(L("SVC"))&&L("SVC").length!==0?L("SVC"):void 0};try{return await this.signal.request(we.SUBSCRIBE_STREAMS,r,!0)}catch(i){if(n&&i.data&&i.data.code===be.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw i}}async setVideoProfile(t){const n=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let i=r.frameRate,a=r.width,c=r.height,l=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(l=!1)),typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(l=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,i||(l=!1)),l?{stream_type:0,width:a,height:c,fps:i,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(t);if(n)return this.signal.request(we.SET_VIDEO_PROFILE,n);T.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(we.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(r){T.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ce.all(t.map(r=>this.signal.request(we.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:n},!0)))}catch(r){T.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(t){try{await this.signal.request(we.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){T.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=t;return{gatewayEstablishParams:await this.signal.request(we.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(we.GATEWAY_INFO)}async renewToken(t){await this.signal.request(we.RENEW_TOKEN,t),this.key=t.token}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),this.state!=="CONNECTED")return void(this.role=t);let r,i=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0,await this.signal.request(we.SET_CLIENT_ROLE,{role:t,level:i,delay:r,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(we.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(we.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(we.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(we.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(we.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,r){if(this.signal instanceof J1)return this.signal.sendExtensionMessage(t,n,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Xi({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(we.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=lv.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let r;return r=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:Gn.username,password:Gn.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Xi(Xi({},Gn),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(we.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{const r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i=>i.peer_uid===n.peer_uid);r&&r.B_st!==n.B_st&&im(()=>{this.emit(Zt.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new B(O.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let r=L("REPORT_APP_SCENARIO");if(typeof r!="string")try{r=JSON.stringify(r)}catch{r=void 0}r&&r.length>128&&(r=void 0);const i=Xi({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:wi,browser:navigator.userAgent,process_id:L("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:L("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:r,attributes:{userAttributes:{enablePublishedUserList:L("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:L("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof L("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?L("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof L("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?L("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof L("ENABLE_USER_LICENSE_CHECK")=="boolean"?L("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:L("USE_PUB_RTX")===!0||L("USE_SUB_RTX")===!0||void 0,disableFEC:L("DISABLE_FEC"),enableNTPReport:!!L("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!L("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:typeof L("ENABLE_DATASTREAM_2")=="boolean"?L("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!L("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:typeof L("USE_XR")=="boolean"?L("USE_XR"):void 0,enableLossbasedBwe:typeof L("ENABLE_LOSSBASED_BWE")=="boolean"?L("ENABLE_LOSSBASED_BWE"):void 0,enableAutCC:typeof L("ENABLE_AUT_CC")=="boolean"?L("ENABLE_AUT_CC"):void 0,enableCCFallback:typeof L("ENABLE_CC_FALLBACK")=="boolean"?L("ENABLE_CC_FALLBACK"):void 0}},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(i.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(i.aes_mode=this.joinInfo.aesmode,L("ENCRYPT_AES")?(i.aes_secret=this.joinInfo.aespassword,i.aes_encrypt=!0):i.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(i.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(i.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(i.default_video_stream=this.joinInfo.defaultVideoStream),i}getRejoinMessage(){if(!this.joinInfo)throw new B(O.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Ee.WS_RECONNECT_WAITTING_FINISH,t=>{var n;ue(n=["tryNext","recover"]).call(n,t)&&this.joinInfo&&Ce.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(Ee.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Ee.WS_RECONNECTING,t=>{this.joinInfo&&Ce.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Wn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Ce.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Ee.WS_CLOSED,t=>{let n;switch(t){case qe.LEAVE:n=Wn.LEAVE;break;case qe.UID_BANNED:case qe.IP_BANNED:case qe.CHANNEL_BANNED:case qe.SERVER_ERROR:n=Wn.SERVER_ERROR;break;case qe.FALLBACK:n=Wn.FALLBACK;break;case qe.LICENSE_MISSING:case qe.LICENSE_EXPIRED:case qe.LICENSE_MINUTES_EXCEEDED:case qe.LICENSE_PERIOD_INVALID:case qe.LICENSE_MULTIPLE_SDK_SERVICE:case qe.LICENSE_ILLEGAL:case qe.TOKEN_EXPIRE:n=t;break;default:n=Wn.NETWORK_ERROR}T.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Wn.NETWORK_ERROR)),this.joinInfo&&Ce.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===qe.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==qe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Ee.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(T.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),Ce.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof ks?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void T.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));Tt("EVENT_REPORT_DOMAIN",t[1]),Tt("EVENT_REPORT_BACKUP_DOMAIN",t[1]),Tt("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}),this.signal.on(Ue.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Ee.REQUEST_RECOVER,(t,n,r)=>{if(!this.joinInfo)return r(new B(O.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,hn(this,Zt.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)}),this.signal.on(Ee.REQUEST_JOIN_INFO,async t=>{var n;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const{iceParameters:r,dtlsParameters:i,rtpCapabilities:a}=await hn(this,Zt.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(n=this.joinInfo)===null||n===void 0?void 0:n.turnServer});t(this.getJoinMessage({ortc:{iceParameters:r,dtlsParameters:i,rtpCapabilities:a,version:"2"}}))}),this.signal.on(Ee.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Ee.REPORT_JOIN_GATEWAY,(t,n)=>{this.joinInfo&&(Ce.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:t,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof ks?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(Ee.IS_P2P_DISCONNECTED,t=>{t(wc(this,Zt.IS_P2P_DISCONNECTED))}),this.signal.on(Ee.DISCONNECT_P2P,()=>{this.emit(Zt.DISCONNECT_P2P)}),this.signal.on(Ee.NEED_RENEW_SESSION,t=>{this.emit(Zt.NEED_RENEW_SESSION,t)}),this.signal.on(Ee.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Ee.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Ee.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(Zt.JOIN_RESPONSE,t,n)}),this.signal.on(Ee.DATACHANNEL_PRECONNECT,async(t,n,r)=>{this.updateTurnConfigFromSignal();const i=this.getCurrentGatewayAddress();return hn(this,Zt.DATACHANNEL_PRECONNECT,t,i).then(n).catch(r)}),this.signal.on(Ee.DATACHANNEL_CONNECTING,async t=>{const{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=await hn(this,Zt.REQUEST_DC_CONNECTION_PARAMS);t(this.getJoinMessage({ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i,version:"2"}}))}),this.signal.on(Ee.DATACHANNEL_FAILBACK,()=>{T.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Zt.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(we.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(we.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(r){throw T.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(we.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(we.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(r){throw T.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(t){const n={users:t.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(we.UNSUBSCRIBE_STREAMS,n,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(t,n){const r={action:t.find(i=>i.stream_type===ut.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(we.CONTROL,r,!0,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}}async unmuteLocal(t,n){const r={action:t.find(i=>i.stream_type===ut.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(we.CONTROL,r,!0,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}}async muteRemote(t,n){const r={action:t===ye.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(we.CONTROL,r,!0,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}}async unmuteRemote(t,n){const r={action:t===ye.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(we.CONTROL,r,!0,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(we.RESTART_ICE,n,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,Wn.P2P_FAILED)}getCurrentGatewayAddress(){var t;if(!L("GATEWAY_WSS_ADDRESS"))return(t=this.joinInfo)!==null&&t!==void 0&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(we.SET_PARAMETER,{enablePublishAudioFilter:t})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(qe.FALLBACK)),this.store.useDataChannel=!1,this.signal=new W1(Xi(Xi({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Zt.RESET_SIGNAL,k1.websocket)}}let gm=0,uv=0;function Oo(e,t,n,r){return new ce((i,a)=>{t.timeout=t.timeout||L("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),gm+=ss(t.data)):n&&(t.data.size?gm+=t.data.size:t.data instanceof FormData?gm+=h1(t.data):gm+=ss(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Rr.request(t).then(c=>{typeof c.data=="string"?uv+=ss(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?uv+=c.data.byteLength:uv+=ss(JSON.stringify(c.data)),r&&i({data:c.data,headers:c.headers}),i(c.data)}).catch(c=>{Rr.isCancel(c)?a(new B(O.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?a(new B(O.NETWORK_TIMEOUT,c.message)):c.response?a(new B(O.NETWORK_RESPONSE_ERROR,c.response.status)):a(new B(O.NETWORK_ERROR,c.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(te){var oe=0;return function(){return oe<te.length?{done:!1,value:te[oe++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(te,oe,Te){return te==Array.prototype||te==Object.prototype||(te[oe]=Te.value),te},r,i=function(te){te=[typeof globalThis=="object"&&globalThis,te,typeof window=="object"&&window,typeof self=="object"&&self,typeof h=="object"&&h];for(var oe=0;oe<te.length;++oe){var Te=te[oe];if(Te&&Te.Math==Math)return Te}throw Error("Cannot find global object")}(this);function a(te,oe){if(oe)e:{var Te=i;te=te.split(".");for(var Me=0;Me<te.length-1;Me++){var st=te[Me];if(!(st in Te))break e;Te=Te[st]}(oe=oe(Me=Te[te=te[te.length-1]]))!=Me&&oe!=null&&n(Te,te,{configurable:!0,writable:!0,value:oe})}}function c(te){return(te={next:te})[Symbol.iterator]=function(){return this},te}function l(te){var oe=typeof Symbol<"u"&&Symbol.iterator&&te[Symbol.iterator];return oe?oe.call(te):{next:t(te)}}if(a("Symbol",function(te){function oe(st,de){this.A=st,n(this,"description",{configurable:!0,writable:!0,value:de})}if(te)return te;oe.prototype.toString=function(){return this.A};var Te="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Me=0;return function st(de){if(this instanceof st)throw new TypeError("Symbol is not a constructor");return new oe(Te+(de||"")+"_"+Me++,de)}}),a("Symbol.iterator",function(te){if(te)return te;te=Symbol("Symbol.iterator");for(var oe="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Te=0;Te<oe.length;Te++){var Me=i[oe[Te]];typeof Me=="function"&&typeof Me.prototype[te]!="function"&&n(Me.prototype,te,{configurable:!0,writable:!0,value:function(){return c(t(this))}})}return te}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var u;e:{var p={};try{p.__proto__={a:!0},u=p.a;break e}catch{}u=!1}r=u?function(te,oe){if(te.__proto__=oe,te.__proto__!==oe)throw new TypeError(te+" is not extensible");return te}:null}var f=r;function m(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function E(te){if(te.m)throw new TypeError("Generator is already running");te.m=!0}function S(te,oe){return te.h=3,{value:oe}}function I(te){this.g=new m,this.G=te}function v(te,oe,Te,Me){try{var st=oe.call(te.g.j,Te);if(!(st instanceof Object))throw new TypeError("Iterator result "+st+" is not an object");if(!st.done)return te.g.m=!1,st;var de=st.value}catch(R){return te.g.j=null,te.g.s(R),y(te)}return te.g.j=null,Me.call(te.g,de),y(te)}function y(te){for(;te.g.h;)try{var oe=te.G(te.g);if(oe)return te.g.m=!1,{value:oe.value,done:!1}}catch(Te){te.g.v=void 0,te.g.s(Te)}if(te.g.m=!1,te.g.l){if(oe=te.g.l,te.g.l=null,oe.F)throw oe.D;return{value:oe.return,done:!0}}return{value:void 0,done:!0}}function b(te){this.next=function(oe){return te.o(oe)},this.throw=function(oe){return te.s(oe)},this.return=function(oe){return function(Te,Me){E(Te.g);var st=Te.g.j;return st?v(Te,"return"in st?st.return:function(de){return{value:de,done:!0}},Me,Te.g.return):(Te.g.return(Me),y(Te))}(te,oe)},this[Symbol.iterator]=function(){return this}}function D(te,oe){return oe=new b(new I(oe)),f&&te.prototype&&f(oe,te.prototype),oe}if(m.prototype.o=function(te){this.v=te},m.prototype.s=function(te){this.l={D:te,F:!0},this.h=this.C||this.u},m.prototype.return=function(te){this.l={return:te},this.h=this.u},I.prototype.o=function(te){return E(this.g),this.g.j?v(this,this.g.j.next,te,this.g.o):(this.g.o(te),y(this))},I.prototype.s=function(te){return E(this.g),this.g.j?v(this,this.g.j.throw,te,this.g.o):(this.g.s(te),y(this))},a("Array.prototype.entries",function(te){return te||function(){return function(oe,Te){oe instanceof String&&(oe+="");var Me=0,st=!1,de={next:function(){if(!st&&Me<oe.length){var R=Me++;return{value:Te(R,oe[R]),done:!1}}return st=!0,{done:!0,value:void 0}}};return de[Symbol.iterator]=function(){return de},de}(this,function(oe,Te){return[oe,Te]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var U=function(te,oe){for(var Te=0;Te<te.length;Te++)oe(te[Te])},F=function(te){return te.replace(/\r?\n|\r/g,`\r
`)},W=function(te,oe,Te){return oe instanceof Blob?(Te=Te!==void 0?Te+"":typeof oe.name=="string"?oe.name:"blob",oe.name===Te&&Object.prototype.toString.call(oe)!=="[object Blob]"||(oe=new File([oe],Te)),[String(te),oe]):[String(te),String(oe)]},q=function(te,oe){if(te.length<oe)throw new TypeError(oe+" argument required, but only "+te.length+" present.")},Q=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,ee=Q.FormData,ne=Q.XMLHttpRequest&&Q.XMLHttpRequest.prototype.send,_e=Q.Request&&Q.fetch,Qe=Q.navigator&&Q.navigator.sendBeacon,ct=Q.Element&&Q.Element.prototype,Nt=Q.Symbol&&Symbol.toStringTag;Nt&&(Blob.prototype[Nt]||(Blob.prototype[Nt]="Blob"),"File"in Q&&!File.prototype[Nt]&&(File.prototype[Nt]="File"));try{new File([],"")}catch{Q.File=function(oe,Te,Me){return oe=new Blob(oe,Me||{}),Object.defineProperties(oe,{name:{value:Te},lastModified:{value:+(Me&&Me.lastModified!==void 0?new Date(Me.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Nt&&Object.defineProperty(oe,Nt,{value:"File"}),oe}}var dn=function(te){return te.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Gt=function(te){this.i=[];var oe=this;te&&U(te.elements,function(Te){if(Te.name&&!Te.disabled&&Te.type!=="submit"&&Te.type!=="button"&&!Te.matches("form fieldset[disabled] *"))if(Te.type==="file"){var Me=Te.files&&Te.files.length?Te.files:[new File([],"",{type:"application/octet-stream"})];U(Me,function(st){oe.append(Te.name,st)})}else Te.type==="select-multiple"||Te.type==="select-one"?U(Te.options,function(st){!st.disabled&&st.selected&&oe.append(Te.name,st.value)}):Te.type==="checkbox"||Te.type==="radio"?Te.checked&&oe.append(Te.name,Te.value):(Me=Te.type==="textarea"?F(Te.value):Te.value,oe.append(Te.name,Me))})};if((e=Gt.prototype).append=function(te,oe,Te){q(arguments,2),this.i.push(W(te,oe,Te))},e.delete=function(te){q(arguments,1);var oe=[];te=String(te),U(this.i,function(Te){Te[0]!==te&&oe.push(Te)}),this.i=oe},e.entries=function te(){var oe,Te=this;return D(te,function(Me){if(Me.h==1&&(oe=0),Me.h!=3)return oe<Te.i.length?Me=S(Me,Te.i[oe]):(Me.h=0,Me=void 0),Me;oe++,Me.h=2})},e.forEach=function(te,oe){q(arguments,1);for(var Te=l(this),Me=Te.next();!Me.done;Me=Te.next()){var st=l(Me.value);Me=st.next().value,st=st.next().value,te.call(oe,st,Me,this)}},e.get=function(te){q(arguments,1);var oe=this.i;te=String(te);for(var Te=0;Te<oe.length;Te++)if(oe[Te][0]===te)return oe[Te][1];return null},e.getAll=function(te){q(arguments,1);var oe=[];return te=String(te),U(this.i,function(Te){Te[0]===te&&oe.push(Te[1])}),oe},e.has=function(te){q(arguments,1),te=String(te);for(var oe=0;oe<this.i.length;oe++)if(this.i[oe][0]===te)return!0;return!1},e.keys=function te(){var oe,Te,Me,st,de=this;return D(te,function(R){if(R.h==1&&(oe=l(de),Te=oe.next()),R.h!=3)return Te.done?void(R.h=0):(Me=Te.value,st=l(Me),S(R,st.next().value));Te=oe.next(),R.h=2})},e.set=function(te,oe,Te){q(arguments,2),te=String(te);var Me=[],st=W(te,oe,Te),de=!0;U(this.i,function(R){R[0]===te?de&&(de=!Me.push(st)):Me.push(R)}),de&&Me.push(st),this.i=Me},e.values=function te(){var oe,Te,Me,st,de=this;return D(te,function(R){if(R.h==1&&(oe=l(de),Te=oe.next()),R.h!=3)return Te.done?void(R.h=0):(Me=Te.value,(st=l(Me)).next(),S(R,st.next().value));Te=oe.next(),R.h=2})},Gt.prototype._asNative=function(){for(var te=new ee,oe=l(this),Te=oe.next();!Te.done;Te=oe.next()){var Me=l(Te.value);Te=Me.next().value,Me=Me.next().value,te.append(Te,Me)}return te},Gt.prototype._blob=function(){var te="----formdata-polyfill-"+Math.random(),oe=[],Te="--"+te+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Me,st){return typeof Me=="string"?oe.push(Te+dn(F(st))+`"\r
\r
`+F(Me)+`\r
`):oe.push(Te+dn(F(st))+'"; filename="'+dn(Me.name)+`"\r
Content-Type: `+(Me.type||"application/octet-stream")+`\r
\r
`,Me,`\r
`)}),oe.push("--"+te+"--"),new Blob(oe,{type:"multipart/form-data; boundary="+te})},Gt.prototype[Symbol.iterator]=function(){return this.entries()},Gt.prototype.toString=function(){return"[object FormData]"},ct&&!ct.matches&&(ct.matches=ct.matchesSelector||ct.mozMatchesSelector||ct.msMatchesSelector||ct.oMatchesSelector||ct.webkitMatchesSelector||function(te){for(var oe=(te=(this.document||this.ownerDocument).querySelectorAll(te)).length;0<=--oe&&te.item(oe)!==this;);return-1<oe}),Nt&&(Gt.prototype[Nt]="FormData"),ne){var uo=Q.XMLHttpRequest.prototype.setRequestHeader;Q.XMLHttpRequest.prototype.setRequestHeader=function(te,oe){uo.call(this,te,oe),te.toLowerCase()==="content-type"&&(this.B=!0)},Q.XMLHttpRequest.prototype.send=function(te){te instanceof Gt?(te=te._blob(),this.B||this.setRequestHeader("Content-Type",te.type),ne.call(this,te)):ne.call(this,te)}}_e&&(Q.fetch=function(te,oe){return oe&&oe.body&&oe.body instanceof Gt&&(oe.body=oe.body._blob()),_e.call(this,te,oe)}),Qe&&(Q.navigator.sendBeacon=function(te,oe){return oe instanceof Gt&&(oe=oe._asNative()),Qe.call(this,te,oe)}),Q.FormData=Gt}})();const sh=()=>{const e=L("AREAS");return e.length===0&&e.push(ot.GLOBAL),yo(e).call(e,(t,n,r)=>{const i=Q1(n);return i?r===0?i:"".concat(t,",").concat(i):t},"")},Q1=e=>e===ot.OVERSEA?"".concat(Qn.ASIA,",").concat(Qn.EUROPE,",").concat(Qn.AFRICA,",").concat(Qn.NORTH_AMERICA,",").concat(Qn.SOUTH_AMERICA,",").concat(Qn.OCEANIA):Qn[e],TY=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const r=mm[n],i=Object.keys(r);i&&i.map(a=>{a!=="CODE"&&(t[a]=t[a].concat(r[a]))})}),t},Sm={GLOBAL:{ASIA:[ot.CHINA,ot.JAPAN,ot.INDIA,ot.KOREA,ot.HKMC],EUROPE:[],NORTH_AMERICA:[ot.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Tm=Object.keys(Sm[ot.GLOBAL]),hv=[ot.CHINA,ot.NORTH_AMERICA,ot.EUROPE,ot.ASIA,ot.JAPAN,ot.INDIA,ot.OCEANIA,ot.SOUTH_AMERICA,ot.AFRICA,ot.KOREA,ot.HKMC,ot.US],vY=function(e,t){let n=[];if(ue(e).call(e,ot.GLOBAL)){const a=[ot.GLOBAL,ot.OVERSEA],c=Object.keys(mm);if(t===ot.GLOBAL)throw new B(O.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===ot.CHINA)n=[ot.OVERSEA];else if(i=t,ue(Tm).call(Tm,i)){const l=(r=t,Sm[ot.GLOBAL][r]||[]),u=[...a,t,...l];n=c.filter(p=>!ue(u).call(u,p))}else if(function(l){let u=!1;return Tm.forEach(p=>{var f;ue(f=Sm[ot.GLOBAL][p]).call(f,l)&&(u=!0)}),u}(t)){const l=function(p){let f;return Tm.forEach(m=>{var E;ue(E=Sm[ot.GLOBAL][m]).call(E,p)&&(f=m)}),f}(t),u=[...a,l,t];n=c.filter(p=>!ue(u).call(u,p))}else n=e;n=function(l){const u=[];return hv.forEach(p=>{ue(l).call(l,p)&&u.push(p)}),u.concat(l.filter(p=>!ue(hv).call(hv,p)))}(n)}else n=e;var r,i;return n};function Z1(e){var t,n;if(!e&&ue(t=L("AREAS")).call(t,ot.EXTENSIONS))return T.debug("update area from ap : reset"),void pv(mz,!0);if(!ue(n=L("AREAS")).call(n,ot.GLOBAL)||!e)return;let r=mm.EXTENSIONS;r&&(r={CODE:Q1(ot.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},T.debug("update area from ap success: ".concat(e,",config is "),r),Tt("AREAS",[ot.EXTENSIONS],!0),Object.keys(r).map(i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?Tt(i,r[i][0]):Tt(i,r[i])}))}function pv(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Ce.reportApiInvoke(null,{name:un.SET_AREA,options:e,tag:Kt.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach(a=>{if(!ue(M1).call(M1,a))throw new B(O.INVALID_PARAMS,"invalid area code")}),r=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:a,excludedArea:c}=e;if(!a)throw new B(O.INVALID_PARAMS,"area code is needed");let l=a;typeof a=="string"&&(l=[a]),r=c?vY(l,c):l}if(!t){if(_a.AREAS){const a=new B(O.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(a),void T.warning("setArea is prohibited because of config-distribute")}if(ue(r).call(r,ot.GLOBAL)&&L("AREAS")===ot.EXTENSIONS){const a=new B(O.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(a),void T.warning("setArea is prohibited because of ap extensions")}}Tt("AREAS",r,t);const i=TY(r);Object.keys(i).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?Tt(a,i[a][0]):Tt(a,i[a])}),T.debug("set area success:",r.join(","))}catch(r){throw n.onError(r),r}n.onSuccess()}function $1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function fv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$1(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$1(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let mv=1;function yY(e,t,n,r,i){mv+=1;const a={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:mv,requestId:mv,version:wi,cname:n.cname},c={service_name:t,json_body:JSON.stringify(a)};let l,u,p=e[0];return wo(async()=>{l=Date.now();const f=await Oo(p,{data:c,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(u=Date.now()-l,f.code!==0){const S=new B(O.UNEXPECTED_RESPONSE,"live streaming ap error, code"+f.code,{retry:!0,responseTime:u});throw T.error(S.toString()),S}const m=JSON.parse(f.json_body);if(m.code!==200){const S=new B(O.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(m.code,", reason: ").concat(m.reason),{code:m.code,responseTime:u});throw T.error(S.toString()),S}if(!m.servers||m.servers.length===0){const S=new B(O.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:m.code,responseTime:u});throw T.error(S.toString()),S}const E=function(S,I){return{addressList:S.servers.map(v=>"wss://".concat(v.address.replace(/\./g,"-"),".").concat(L("WORKER_DOMAIN"),":").concat(v.wss,"?serviceName=").concat(encodeURIComponent(I))),workerToken:S.workerToken,vid:S.vid}}(m,t);return L("LIVE_STREAMING_ADDRESS")&&(E.addressList=L("LIVE_STREAMING_ADDRESS")instanceof Array?L("LIVE_STREAMING_ADDRESS"):[L("LIVE_STREAMING_ADDRESS")]),fv(fv({},E),{},{responseTime:u})},(f,m)=>(Ce.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(f.addressList),firstSuccess:m===0,responseTime:u,serverIp:e[m%e.length]}),!1),(f,m)=>(Ce.apworkerEvent(n.sid,{success:!1,sc:f.data&&f.data.code||200,serviceName:t,responseTime:u,serverIp:e[m%e.length]}),!!(f.code!==O.OPERATION_ABORTED&&f.code!==O.UNEXPECTED_RESPONSE||f.data&&f.data.retry)&&(p=e[(m+1)%e.length],!0)),i)}let _v=1;function eD(e,t,n,r){let{url:i,areaCode:a}=e;const{clientId:c,sid:l}=t,u=Date.now();let p;const[f,m]=gv(t,a,[an.CHOOSE_SERVER]);let E=zt.networkState;return wo(async()=>{E&&zt.networkState===mr.OFFLINE&&zt.onlineWaiter&&await ce.race([zt.onlineWaiter,Rn(r&&r.maxRetryTimeout||sn.maxRetryTimeout)]),E=zt.networkState;const{data:S,headers:I}=await Oo(i,{data:f,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p=I.http3==="1"?1:-1,Ce.reportResourceTiming(i,l),nD(S,i,t,u,[an.CHOOSE_SERVER],p);const v=oh(S,an.CHOOSE_SERVER);return Ev(v),cv(v,i)},S=>(S&&Ce.joinChooseServer(l,{lts:u,succ:!0,csAddr:i,opid:m,serverList:S.gatewayAddrs.map(I=>I.address),ec:null,cid:S.cid.toString(),uid:S.uid.toString(),csIp:S.csIp,unilbsServerIds:[an.CHOOSE_SERVER].toString(),isHttp3:p}),!1),S=>S.code!==O.OPERATION_ABORTED&&(S.code===O.CAN_NOT_GET_GATEWAY_SERVER?S.data.retry:(Ce.joinChooseServer(l,{lts:u,succ:!1,csAddr:i,serverList:null,opid:m,ec:S.code,csIp:S.data&&S.data.csIp,unilbsServerIds:[an.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:E}),isHttp3:p}),T.warning("[".concat(c||"sid-".concat(l.slice(0,6)),"] Choose server network error, retry"),S),!0)),r)}function tD(e,t,n,r){let i,{url:a,areaCode:c,serviceIds:l}=e;const u=Date.now(),[p,f]=gv(t,c,l);let m;return wo(async()=>{m&&zt.networkState===mr.OFFLINE&&zt.onlineWaiter&&await ce.race([zt.onlineWaiter,Rn(r&&r.maxRetryTimeout||sn.maxRetryTimeout)]),m=zt.networkState;const{data:E,headers:S}=await Oo(a,{data:p,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=S.http3==="1"?1:-1,Ce.reportResourceTiming(a,t.sid),nD(E,a,t,u,l,i);const I=oh(E,an.CHOOSE_SERVER),v=oh(E,t.cloudProxyServer==="proxy5"?an.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?an.CLOUD_PROXY:an.CLOUD_PROXY_FALLBACK);return Ev(I),{gatewayInfo:cv(I,a),proxyInfo:v,url:a}},E=>(E.gatewayInfo&&Ce.joinChooseServer(t.sid,{lts:u,succ:!0,csAddr:a,serverList:E.gatewayInfo.gatewayAddrs.map(S=>S.address),ec:null,opid:f,cid:E.gatewayInfo.cid.toString(),uid:E.gatewayInfo.uid.toString(),csIp:E.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:i}),E.proxyInfo&&Ce.joinWebProxyAP(t.sid,{lts:u,sucess:1,apServerAddr:a,turnServerAddrList:E.proxyInfo.addresses.map(S=>S.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:l.toString()}),!1),E=>E.code!==O.OPERATION_ABORTED&&(E.code===O.CAN_NOT_GET_GATEWAY_SERVER?E.data.retry:(Ce.joinWebProxyAP(t.sid,{lts:u,sucess:0,apServerAddr:a,turnServerAddrList:null,errorCode:E.code,eventType:t.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:m})}),T.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),E),!0)),r)}const nD=(e,t,n,r,i,a)=>{const{sid:c,clientId:l,cloudProxyServer:u}=n,p=[],f=m=>{m.flag===4096?Ce.joinChooseServer(c,{lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:m.error.message,csIp:m.error.data&&m.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:a}):m.flag!==1048576&&m.flag!==4194304&&m.flag!==4194310||Ce.joinWebProxyAP(c,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:m.error.code,eventType:u,unilbsServerIds:i.toString()})};if(e.response_body.forEach(m=>{const E=m.buffer.code;if(m.uri===23&&E===0&&!m.buffer.edges_services)if(m.buffer.flag===4194310)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),m.buffer.edges_services=[];else{const S={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:m.buffer.flag};p.push(S),f(S)}if(E!==0){const S=nl(E),I={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,S.desc,{desc:S.desc,retry:S.retry,csIp:e.detail[502]}),flag:m.buffer.flag};m.buffer.flag===4194310?T.warning(I.error.toString()):p.push(I),f(I)}}),p.length)throw T.warning("[".concat(l||"sid-".concat(c.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(p.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message,", retry: ").concat(m.error.data.retry)).join(" | "))),new B(O.CAN_NOT_GET_GATEWAY_SERVER,p.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message)).join(" | "),{retry:!!p.find(m=>m.error.data.retry),csIp:e.detail[502],desc:[...new Set(p.map(m=>{var E;return m==null||(E=m.error)===null||E===void 0||(E=E.data)===null||E===void 0?void 0:E.desc}).filter(m=>!!m))]})},Ev=e=>{var t,n,r,i;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new B(O.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(L("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((i=e.detail)===null||i===void 0?void 0:i[23])=="string"?Z1(e.detail[23].toLowerCase()):Z1()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const c=e.detail[19],l=c==null?void 0:c.split(";");for(let u=0;u<l.length;u++){var a;const p=sr(a=l[u]).call(a);e.addresses[u]&&l&&(e.addresses[u].fingerprint=p)}}if(L("GATEWAY_ADDRESS")&&L("GATEWAY_ADDRESS").length>0){T.debug("assign gateway address to",L("GATEWAY_ADDRESS"));const c=L("GATEWAY_ADDRESS").map(l=>{var u,p;const f=(u=(p=e.addresses.find(m=>m.ip===l.ip&&m.port===l.port))===null||p===void 0?void 0:p.fingerprint)!==null&&u!==void 0?u:"";return{ip:l.ip,port:l.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:f}});e.addresses=c}},CY=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const r=nl(n.buffer.code);throw new B(O.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw T.debug("update ticket request received ap response without response body:",t),new B(O.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},gv=(e,t,n)=>{const r=Math.floor(Math.random()*1e12),i={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:fv({6:e.stringUid,11:t,12:L("USE_NEW_TOKEN")?"1":void 0,22:t},e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};i.request_bodies.forEach(c=>{e.multiIP&&e.multiIP.gateway_ip&&(c.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const a=new FormData;return a.append("request",JSON.stringify(i)),[a,r]},RY=(e,t)=>{const n=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(a=>({ip:a.ip,port:a.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let rl=0;function il(e){return ce.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const ah=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:a}=e,c=0;const l=t;let u,p=0;const f=async()=>{const m=(()=>{const E=c*l,S=E+l;return n.slice(E,S).map(r)})();a&&a.push(...m);try{u=await il(m)}catch(E){if(p+=l,c++,!(p>=n.length))return void await f();i(E)}m.forEach(E=>E.cancel())};return await f(),u},rD=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:r}=e;const i=t.length;let a=0;const c=async()=>{const l=n(t.shift());try{return await l}catch(u){if(a++,a>=i||r!=null&&r(u))throw u;return c()}};return c()};async function Sv(e,t,n,r){return{gatewayInfo:await async function(a,c,l,u){let p=null;const f=[],m=async()=>{const S=L("WEBCS_DOMAIN").slice(0,L("AJAX_REQUEST_CONCURRENT")).map(y=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"),areaCode:sh()})),I=u.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(y=>y.url)}),v=await ah({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:y=>(T.debug("[".concat(a.clientId,"] Connect to choose_server:"),y.url),eD(y,a,c,l)),allFailedhandler:y=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},I),y[0]},promisesCollector:f});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},I),v},E=async()=>{if(await Rn(1e3),p!==null)return p;const S=L("WEBCS_DOMAIN_BACKUP_LIST").map(y=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"),areaCode:sh()})),I=u.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(y=>y.url)}),v=await ah({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:y=>(T.debug("[".concat(a.clientId,"] Connect to backup choose_server:"),y.url),eD(y,a,c,l)),allFailedhandler:y=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},I),y[0]},promisesCollector:f});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},I),v};try{return p=await il([m(),E()]),f.length&&f.forEach(S=>S.cancel&&typeof S.cancel=="function"&&S.cancel()),p}catch(S){throw S[0]}}(e,t,n,r)}}async function iD(e,t,n,r,i){const a=e.cloudProxyServer;if(a==="disabled"){if(e.useLocalAccessPoint)return await Sv(e,t,n,i);if(L("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:E,proxyInfo:S}=await aD(e,t,n,i);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:E};const I=S.map(v=>({turnServerURL:v.address,tcpport:v.tcpport||Gn.tcpport,udpport:v.udpport||Gn.udpport,username:v.username||Gn.username,password:v.password||Gn.password,forceturn:!1,security:!0}));if(i.useP2P){var c;const v=(c=e.uid)!==null&&c!==void 0?c:E.uid,y="glb:".concat(v.toString()),b=await WT(y),D=S.map(U=>({turnServerURL:U.address,tcpport:U.tcpport||Gn.tcpport,udpport:U.udpport||Gn.udpport,username:y,password:b,forceturn:!1,security:!0}));I.push(...D)}return e.turnServer={mode:"manual",servers:I},{gatewayInfo:E}}return await Sv(e,t,n,i)}const{proxyInfo:l,gatewayInfo:u}=await aD(e,t,n,i),p={gatewayInfo:u},f=l.map(E=>({turnServerURL:E.address,tcpport:a==="proxy3"?void 0:E.tcpport?E.tcpport:Gn.tcpport,udpport:a==="proxy4"?void 0:E.udpport?E.udpport:Gn.udpport,username:E.username||Gn.username,password:E.password||Gn.password,forceturn:a!=="proxy4",security:a==="proxy5"}));if(i.useP2P){var m;const E=(m=e.uid)!==null&&m!==void 0?m:u.uid,S="glb:".concat(E.toString()),I=await WT(S),v=l.map(y=>({turnServerURL:y.address,tcpport:a==="proxy3"?void 0:y.tcpport||Gn.tcpport,udpport:a==="proxy4"?void 0:y.udpport||Gn.udpport,username:S,password:I,forceturn:a!=="proxy4",security:a==="proxy5"}));f.push(...v)}return e.turnServer={mode:"manual",servers:f},T.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(a)),p}async function oD(e,t,n,r,i){const a=L("ACCOUNT_REGISTER").slice(0,L("AJAX_REQUEST_CONCURRENT"));let c=[];c=t.proxyServer?a.map(u=>"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1")):a.map(u=>"https://".concat(u,"/api/v1"));const l=i==null?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{const u=await async function(p,f,m,E,S){const I=Date.now(),v={sid:m.sid,opid:10,appid:m.appId,string_uid:f};let y=p[0];const b=await wo(()=>Oo(y+"".concat(y.indexOf("?")===-1?"?":"&","action=stringuid"),{data:v,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(D,U)=>{if(D.code===0){if(D.uid<=0||D.uid>=Math.pow(2,32))throw T.error("Invalid Uint Uid ".concat(f," => ").concat(D.uid),D),Ce.reqUserAccount(v.sid,{lts:I,success:!1,serverAddr:y,stringUid:v.string_uid,uid:D.uid,errorCode:O.INVALID_UINT_UID_FROM_STRING_UID,extend:v}),new B(O.INVALID_UINT_UID_FROM_STRING_UID);return Ce.reqUserAccount(v.sid,{lts:I,success:!0,serverAddr:y,stringUid:v.string_uid,uid:D.uid,errorCode:null,extend:v}),!1}const F=nl(D.code);return F.retry&&(y=p[(U+1)%p.length]),Ce.reqUserAccount(v.sid,{lts:I,success:!1,serverAddr:y,stringUid:v.string_uid,uid:D.uid,errorCode:F.desc,extend:v}),F.retry},(D,U)=>D.code!==O.OPERATION_ABORTED&&(Ce.reqUserAccount(v.sid,{lts:I,success:!1,serverAddr:y,stringUid:v.string_uid,uid:null,errorCode:D.code,extend:v}),y=p[(U+1)%p.length],!0),S);if(b.code!==0){const D=nl(b.code);throw new B(O.UNEXPECTED_RESPONSE,D.desc)}return b}(c,e,t,n,r);return i==null||i.recordJoinChannelService({status:"success",endTs:Date.now()},l),u.uid}catch(u){throw i==null||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[u]},l),u}}async function wY(e,t,n){const r=L("ACCOUNT_REGISTER");let i=[];i=t.proxyServer?r.map(a=>"https://".concat(t.proxyServer,"/ap/?url=").concat(a+"/api/v1")):r.map(a=>"https://".concat(a,"/api/v1"));try{return await rD({referenceList:i,asyncMapHandler:c=>async function(l,u,p,f){const m=Date.now(),E={sid:p.sid,opid:10,appid:p.appId,string_uid:u};try{const S=await Oo(l+"".concat(l.indexOf("?")===-1?"?":"&","action=stringuid"),{data:E,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(S.code!==0){const I=nl(S.code);throw new B(O.UNEXPECTED_RESPONSE,"preload sua error:".concat(I.desc),I)}if(S.uid<=0||S.uid>=Math.pow(2,32))throw new B(O.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:m,url:l,req:E,uid:S.uid,elapse:Date.now()-m}}catch(S){throw S}}(c,e,t,n),closeFn:c=>c.code===O.OPERATION_ABORTED||c.code===O.UNEXPECTED_RESPONSE&&!c.data.retry})}catch(a){throw a}}async function IY(e,t,n){const r=L("CDS_AP").slice(0,L("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1"):"https://".concat(u,"/api/v1?action=config")),i=r.map(u=>function(p,f,m,E){const S=tt(),I={flag:64,cipher_method:0,features:{device:S.name,system:S.os,system_general:navigator.userAgent,vendor:f.appId,version:wi,cname:f.cname,sid:f.sid,session_id:f.sid,detail:"",proxyServer:f.proxyServer}};return wo(()=>Oo(p,{data:I,timeout:1e3,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,v=>v.code!==O.OPERATION_ABORTED,E)}(u,e,t,n));let a=null,c=null,l={};try{a=await il(i)}catch(u){if(u.code===O.OPERATION_ABORTED)throw u;c=u}if(i.forEach(u=>u.cancel()),Ce.reportApiInvoke(e.sid,{name:un.REQUEST_CONFIG_DISTRIBUTE,options:{error:c,res:a}}).onSuccess(),a&&a.test_tags)try{l=function(u){if(!u.test_tags)return{};const p=u.test_tags,f=Object.keys(p),m={};return f.forEach(E=>{var S;const I=sr(S=E.slice(4)).call(S),v=JSON.parse(p[E])[1];m[I]=v}),m}(a)}catch{}return l}async function sD(e,t){const n=L("WEBCS_DOMAIN").concat(L("WEBCS_DOMAIN_BACKUP_LIST")).map(r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:sh(),serviceIds:[an.CHOOSE_SERVER,an.CLOUD_PROXY_FALLBACK]}));try{return await rD({referenceList:n,asyncMapHandler:i=>async function(a,c,l){let u,{url:p,areaCode:f,serviceIds:m}=a;const E=Date.now(),[S,I]=gv(c,f,m);let v=zt.networkState;try{v&&zt.networkState===mr.OFFLINE&&zt.onlineWaiter&&await ce.race([zt.onlineWaiter,Rn(sn.maxRetryTimeout)]),v=zt.networkState;const{data:y,headers:b}=await Oo(p,{data:S,cancelToken:l,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u=b.http3==="1"?1:-1,(W=>{const q=[];if(W.response_body.forEach(Q=>{const ee=Q.buffer.code;if(Q.uri===23&&ee===0&&!Q.buffer.edges_services)if(Q.buffer.flag===4194310)Q.buffer.edges_services=[];else{const ne={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:W.detail[502]}),flag:Q.buffer.flag};q.push(ne)}if(ee!==0){const ne=nl(ee),_e={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,ne.desc,{desc:ne.desc,retry:ne.retry,csIp:W.detail[502]}),flag:Q.buffer.flag};Q.buffer.flag===4194310?T.warning(_e.error.toString()):q.push(_e)}}),q.length)throw new B(O.CAN_NOT_GET_GATEWAY_SERVER,q.map(Q=>"flag: ".concat(Q.flag,", message: ").concat(Q.error.message)).join(" | "),{retry:!!q.find(Q=>Q.error.data.retry),csIp:W.detail[502],desc:[...new Set(q.map(Q=>{var ee;return Q==null||(ee=Q.error)===null||ee===void 0||(ee=ee.data)===null||ee===void 0?void 0:ee.desc}).filter(Q=>!!Q))]})})(y);const U=oh(y,an.CHOOSE_SERVER),F=oh(y,an.CLOUD_PROXY_FALLBACK);return Ev(U),{gatewayInfo:cv(U,p),proxyInfo:F,opid:I,requestTime:E,url:p,isHttp3:u,elapse:Date.now()-E}}catch(y){throw y}}(i,e,t),closeFn:i=>i.code===O.OPERATION_ABORTED||i.code===O.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(r){throw r}}async function aD(e,t,n,r){const i=L("PROXY_SERVER_TYPE3"),a=(S,I,v)=>{let y=v||i;return Array.isArray(y)&&(y=I%2==0?i[1]:i[0]),"https://".concat(y,"/ap/?url=").concat(S)};let c=null;const l=[],u=async()=>{const S=L("WEBCS_DOMAIN").slice(0,L("AJAX_REQUEST_CONCURRENT")).map((y,b)=>{let D;return D=e.cloudProxyServer==="disabled"&&e.proxyServer?a("".concat(y,"/api/v2/transpond/webrtc?v=2"),b,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(y,"/api/v2/transpond/webrtc?v=2"):a("".concat(y,"/api/v2/transpond/webrtc?v=2"),b),{url:D,areaCode:sh(),serviceIds:[an.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?an.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?an.CLOUD_PROXY:an.CLOUD_PROXY_FALLBACK]}}),I=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(y=>y.url)}),v=await ah({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:y=>(T.debug("[".concat(e.clientId,"] Connect to choose_server:"),y.url),tD(y,e,t,n)),allFailedhandler:y=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},I),y[0]},promisesCollector:l});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},I),v},p=async()=>{if(await Rn(1e3),c!==null)return c;const S=L("WEBCS_DOMAIN_BACKUP_LIST").map((y,b)=>{let D;return D=e.cloudProxyServer==="disabled"&&e.proxyServer?a("".concat(y,"/api/v2/transpond/webrtc?v=2"),b,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(y,"/api/v2/transpond/webrtc?v=2"):a("".concat(y,"/api/v2/transpond/webrtc?v=2"),b),{url:D,areaCode:sh(),serviceIds:[an.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?an.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?an.CLOUD_PROXY:an.CLOUD_PROXY_FALLBACK]}}),I=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(y=>y.url)}),v=await ah({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:y=>(T.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),y.url),tD(y,e,t,n)),allFailedhandler:y=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},I),y[0]},promisesCollector:l});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},I),v};let f,m,E;try{({gatewayInfo:f,proxyInfo:m,url:E}=await il([u(),p()]))}catch(S){throw S[0]}if(l.length&&l.forEach(S=>S.cancel&&typeof S.cancel=="function"&&S.cancel()),!f||!m)throw new B(O.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=E,e.cloudProxyServer!=="disabled"&&Array.isArray(i)&&E){const S=/^https?:\/\/(.+?)(\/.*)?$/.exec(E)[1];ue(i).call(i,S)&&(e.proxyServer=S,T.setProxyServer(S),Ce.setProxyServer(S))}return c={gatewayInfo:f,proxyInfo:await z1(m,f.uid)},c}async function cD(e,t,n,r){const i=L("UAP_AP").slice(0,L("AJAX_REQUEST_CONCURRENT")).map(a=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(a+"/api/v1?action=uap"):"https://".concat(a,"/api/v1?action=uap"));return await yY(i,e,t,n,r)}async function bY(e,t,n){const r=L("UAP_AP").slice(0,L("AJAX_REQUEST_CONCURRENT")).map(a=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(a+"/api/v1?action=uap"):"https://".concat(a,"/api/v1?action=uap")),i=r.map(a=>function(c,l,u,p){const f={command:"convergeAllocateEdge",sid:l.sid,appId:l.appId,token:l.token,ts:Date.now(),version:wi,cname:l.cname,uid:l.uid.toString(),requestId:_v,seq:_v};_v+=1;const m={service_name:"tele_channel",json_body:JSON.stringify(f)};return wo(async()=>{const E=await Oo(c,{data:m,cancelToken:u,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(E.code!==0){const I=new B(O.UNEXPECTED_RESPONSE,"cross channel ap error, code"+E.code,{retry:!0});throw T.error(I.toString()),I}const S=JSON.parse(E.json_body);if(S.code!==200){const I=new B(O.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(S.code,", reason: ").concat(S.reason));throw T.error(I.toString()),I}if(!S.servers||S.servers.length===0){const I=new B(O.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw T.error(I.toString()),I}return{vid:S.vid,workerToken:S.workerToken,addressList:(L("CHANNEL_MEDIA_RELAY_SERVERS")||S.servers).map(I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(L("WORKER_DOMAIN"),":").concat(I.wss))}},void 0,E=>!!(E.code!==O.OPERATION_ABORTED&&E.code!==O.UNEXPECTED_RESPONSE||E.data&&E.data.retry),p)}(a,e,t,n));try{const a=await il(i);return i.forEach(c=>c.cancel()),a}catch(a){throw a[0]}}async function AY(e,t,n){let r=null;const i=[],a=async c=>{const l=L(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v2/transpond/webrtc?v=2"):"https://".concat(u,"/api/v2/transpond/webrtc?v=2"));return c&&(await Rn(1e3),r!==null)?r:await ah({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:u=>(T.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),u),function(p,f,m,E){const[S]=RY(f,[an.CHOOSE_SERVER]);let I=zt.networkState;return wo(async()=>{I&&zt.networkState===mr.OFFLINE&&zt.onlineWaiter&&await ce.race([zt.onlineWaiter,Rn(E&&E.maxRetryTimeout||sn.maxRetryTimeout)]),I=zt.networkState;const v=await Oo(p,{data:S,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0);return CY(v,p)},()=>!1,v=>v.code!==O.OPERATION_ABORTED&&(v.code===O.UPDATE_TICKET_FAILED?v.data.retry:(T.warning("[".concat(f.clientId,"] update ticket network error, retry"),v),!0)),E)}(u,e,t,n)),allFailedhandler:u=>{throw u[0]},promisesCollector:i})};try{return r=await il([a(!1),a(!0)]),i.length&&i.forEach(c=>c.cancel&&typeof c.cancel=="function"&&c.cancel()),r}catch(c){throw c[0]}}function dD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function lD(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dD(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dD(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class OY extends xt{get isSuccess(){return!!this.configs}constructor(){super(),w(this,"configs",void 0),w(this,"joinInfo",void 0),w(this,"cancelToken",void 0),w(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),w(this,"interval",void 0),w(this,"mutex",new On("config-distribute")),w(this,"mutableParamsRead",!1)}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),L("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},L("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Ce.reportApiInvoke(null,{options:void 0,name:un.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Kt.TRACER}).onSuccess(JSON.stringify(_a))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void T.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await IY(this.joinInfo,this.cancelToken,this.retryConfig),T.debug("[config-distribute] get config distribute",JSON.stringify(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t}catch(r){const i=new B(O.NETWORK_RESPONSE_ERROR,r);T.warning("[config-distribute] ".concat(i.toString()))}finally{n()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var n;(n=t)&&n.uplink&&n.id&&n.uplink.max_bitrate!==void 0&&n.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit(sv.UPDATE_BITRATE_LIMIT,t):this.emit(sv.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&lD({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var n;const r=Mu(n=Object.keys(t).filter(a=>/^webrtc_ng_global_parameter/.test(a))).call(n);for(let a=0;a<r.length;a++)for(let c=r.length-1;c>a;c--){const l=r[c];if(typeof t[l].__priority=="number"){const u=t[l].__priority,p=r[c-1];if(typeof t[p].__priority=="number"){if(!(u>t[p].__priority))continue;{const f=l;r[c]=r[c-1],r[c-1]=f}}else{const f=l;r[c]=r[c-1],r[c-1]=f}}}const i={};r.forEach(a=>{const c=t[a],l=c.__expires;Object.keys(c).forEach(u=>{u==="__priority"||u==="__expires"||Object.prototype.hasOwnProperty.call(i,u)||(i[u]=lD({value:c[u]},l&&{expires:l}))})});try{(function(l){try{const u=Date.now();Object.keys(l).forEach(p=>{switch(p){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(_n,p)){const{value:f,expires:m}=l[p];if(m&&m<=u)return;_a[p]=f,_n[p]=f,T.debug("Update global parameters from config distribute",p,f)}}})}catch(u){T.error("Error update config immediately: ".concat(l),u.message)}})(i);const a=JSON.stringify(i),c=window.btoa(a);window.localStorage.setItem("websdk_ng_global_parameter",c),T.debug("Caching global parameters ".concat(a))}catch(a){T.error("Error caching global parameters:",a.message)}}}var Qi,NY=_(N1),uD=Dt,DY=j,PY=De,LY=g,Tv=rf,kY=Ru,MY=Ke,xY=Zo,UY=zp,ol=Object.assign,hD=Object.defineProperty,jY=DY([].concat),VY=!ol||LY(function(){if(uD&&ol({b:1},ol(hD({},"a",{enumerable:!0,get:function(){hD(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(i){t[i]=i}),ol({},e)[n]!=7||Tv(ol({},t)).join("")!=r})?function(e,t){for(var n=xY(e),r=arguments.length,i=1,a=kY.f,c=MY.f;r>i;)for(var l,u=UY(arguments[i++]),p=a?jY(Tv(u),a(u)):Tv(u),f=p.length,m=0;f>m;)l=p[m++],uD&&!PY(c,u,l)||(n[l]=u[l]);return n}:ol,FY=Dr,BY=Gw,WY=ra,GY=De,HY=Zo,KY=function(e,t,n,r){try{return r?t(FY(n)[0],n[1]):t(n)}catch(i){BY(e,"throw",i)}},zY=Fw,YY=_f,qY=bs,pD=Of,JY=jg,XY=af,fD=Array,Lc=j,vv=2147483647,QY=/[^\0-\u007E]/,mD=/[.\u3002\uFF0E\uFF61]/g,_D="Overflow: input needs wider integers to process",ED=RangeError,ZY=Lc(mD.exec),sl=Math.floor,yv=String.fromCharCode,gD=Lc("".charCodeAt),SD=Lc([].join),ya=Lc([].push),$Y=Lc("".replace),eq=Lc("".split),tq=Lc("".toLowerCase),TD=function(e){return e+22+75*(e<26)},nq=function(e,t,n){var r=0;for(e=n?sl(e/700):e>>1,e+=sl(e/t);e>455;)e=sl(e/35),r+=36;return sl(r+36*e/(e+38))},rq=function(e){var t=[];e=function(b){for(var D=[],U=0,F=b.length;U<F;){var W=gD(b,U++);if(W>=55296&&W<=56319&&U<F){var q=gD(b,U++);(64512&q)==56320?ya(D,((1023&W)<<10)+(1023&q)+65536):(ya(D,W),U--)}else ya(D,W)}return D}(e);var n,r,i=e.length,a=128,c=0,l=72;for(n=0;n<e.length;n++)(r=e[n])<128&&ya(t,yv(r));var u=t.length,p=u;for(u&&ya(t,"-");p<i;){var f=vv;for(n=0;n<e.length;n++)(r=e[n])>=a&&r<f&&(f=r);var m=p+1;if(f-a>sl((vv-c)/m))throw ED(_D);for(c+=(f-a)*m,a=f,n=0;n<e.length;n++){if((r=e[n])<a&&++c>vv)throw ED(_D);if(r==a){for(var E=c,S=36;;){var I=S<=l?1:S>=l+26?26:S-l;if(E<I)break;var v=E-I,y=36-I;ya(t,yv(TD(I+v%y))),E=sl(v/y),S+=36}ya(t,yv(TD(E))),l=nq(c,m,p==u),c=0,p++}}c++,a++}return SD(t,"")},iq=bt,Cv=Dt,oq=hT,Rv=z,vD=ra,Zi=j,vm=oa,$i=mf,sq=Qg,wv=Jn,Iv=VY,al=function(e){var t=HY(e),n=YY(this),r=arguments.length,i=r>1?arguments[1]:void 0,a=i!==void 0;a&&(i=WY(i,r>2?arguments[2]:void 0));var c,l,u,p,f,m,E=XY(t),S=0;if(!E||this===fD&&zY(E))for(c=qY(t),l=n?new this(c):fD(c);c>S;S++)m=a?i(t[S],S):t[S],pD(l,S,m);else for(f=(p=JY(t,E)).next,l=n?new this:[];!(u=GY(f,p)).done;S++)m=a?KY(p,i,[u.value,S],!0):u.value,pD(l,S,m);return l.length=S,l},No=FS,aq=AS.codeAt,cq=function(e){var t,n,r=[],i=eq($Y(tq(e),mD,"."),".");for(t=0;t<i.length;t++)n=i[t],ya(r,ZY(QY,n)?"xn--"+rq(n):n);return SD(r,".")},Ms=Ci,dq=sa,lq=Ef,yD=mK,CD=gc,uq=CD.set,ym=CD.getterFor("URL"),hq=yD.URLSearchParams,pq=yD.getState,ch=Rv.URL,bv=Rv.TypeError,Cm=Rv.parseInt,fq=Math.floor,RD=Math.pow,eo=Zi("".charAt),Do=Zi(/./.exec),dh=Zi([].join),mq=Zi(1 .toString),_q=Zi([].pop),cl=Zi([].push),Av=Zi("".replace),Eq=Zi([].shift),gq=Zi("".split),lh=Zi("".slice),Rm=Zi("".toLowerCase),Sq=Zi([].unshift),Ov="Invalid scheme",kc="Invalid host",wD="Invalid port",ID=/[a-z]/i,Tq=/[\d+-.a-z]/i,Nv=/\d/,vq=/^0x/i,yq=/^[0-7]+$/,Cq=/^\d+$/,bD=/^[\da-f]+$/i,Rq=/[\0\t\n\r #%/:<>?@[\\\]^|]/,wq=/[\0\t\n\r #/:<>?@[\\\]^|]/,Iq=/^[\u0000-\u0020]+/,bq=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Aq=/[\t\n\r]/g,uh=function(e){var t,n,r,i;if(typeof e=="number"){for(t=[],n=0;n<4;n++)Sq(t,e%256),e=fq(e/256);return dh(t,".")}if(typeof e=="object"){for(t="",r=function(a){for(var c=null,l=1,u=null,p=0,f=0;f<8;f++)a[f]!==0?(p>l&&(c=u,l=p),u=null,p=0):(u===null&&(u=f),++p);return p>l&&(c=u,l=p),c}(e),n=0;n<8;n++)i&&e[n]===0||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=mq(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},wm={},AD=Iv({},wm,{" ":1,'"':1,"<":1,">":1,"`":1}),OD=Iv({},AD,{"#":1,"?":1,"{":1,"}":1}),Dv=Iv({},OD,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Ca=function(e,t){var n=aq(e,0);return n>32&&n<127&&!wv(t,e)?e:encodeURIComponent(e)},Im={ftp:21,file:null,http:80,https:443,ws:80,wss:443},hh=function(e,t){var n;return e.length==2&&Do(ID,eo(e,0))&&((n=eo(e,1))==":"||!t&&n=="|")},ND=function(e){var t;return e.length>1&&hh(lh(e,0,2))&&(e.length==2||(t=eo(e,2))==="/"||t==="\\"||t==="?"||t==="#")},Oq=function(e){return e==="."||Rm(e)==="%2e"},Pv={},DD={},Lv={},PD={},LD={},kv={},kD={},MD={},bm={},Am={},Mv={},xv={},Uv={},jv={},xD={},Vv={},dl={},ds={},UD={},Mc={},xs={},Fv=function(e,t,n){var r,i,a,c=Ms(e);if(t){if(i=this.parse(c))throw bv(i);this.searchParams=null}else{if(n!==void 0&&(r=new Fv(n,!0)),i=this.parse(c,null,r))throw bv(i);(a=pq(new hq)).bindURL(this),this.searchParams=a}};Fv.prototype={type:"URL",parse:function(e,t,n){var r,i,a,c,l,u=this,p=t||Pv,f=0,m="",E=!1,S=!1,I=!1;for(e=Ms(e),t||(u.scheme="",u.username="",u.password="",u.host=null,u.port=null,u.path=[],u.query=null,u.fragment=null,u.cannotBeABaseURL=!1,e=Av(e,Iq,""),e=Av(e,bq,"$1")),e=Av(e,Aq,""),r=al(e);f<=r.length;){switch(i=r[f],p){case Pv:if(!i||!Do(ID,i)){if(t)return Ov;p=Lv;continue}m+=Rm(i),p=DD;break;case DD:if(i&&(Do(Tq,i)||i=="+"||i=="-"||i=="."))m+=Rm(i);else{if(i!=":"){if(t)return Ov;m="",p=Lv,f=0;continue}if(t&&(u.isSpecial()!=wv(Im,m)||m=="file"&&(u.includesCredentials()||u.port!==null)||u.scheme=="file"&&!u.host))return;if(u.scheme=m,t)return void(u.isSpecial()&&Im[u.scheme]==u.port&&(u.port=null));m="",u.scheme=="file"?p=jv:u.isSpecial()&&n&&n.scheme==u.scheme?p=PD:u.isSpecial()?p=MD:r[f+1]=="/"?(p=LD,f++):(u.cannotBeABaseURL=!0,cl(u.path,""),p=UD)}break;case Lv:if(!n||n.cannotBeABaseURL&&i!="#")return Ov;if(n.cannotBeABaseURL&&i=="#"){u.scheme=n.scheme,u.path=No(n.path),u.query=n.query,u.fragment="",u.cannotBeABaseURL=!0,p=xs;break}p=n.scheme=="file"?jv:kv;continue;case PD:if(i!="/"||r[f+1]!="/"){p=kv;continue}p=bm,f++;break;case LD:if(i=="/"){p=Am;break}p=ds;continue;case kv:if(u.scheme=n.scheme,i==Qi)u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=No(n.path),u.query=n.query;else if(i=="/"||i=="\\"&&u.isSpecial())p=kD;else if(i=="?")u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=No(n.path),u.query="",p=Mc;else{if(i!="#"){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=No(n.path),u.path.length--,p=ds;continue}u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=No(n.path),u.query=n.query,u.fragment="",p=xs}break;case kD:if(!u.isSpecial()||i!="/"&&i!="\\"){if(i!="/"){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,p=ds;continue}p=Am}else p=bm;break;case MD:if(p=bm,i!="/"||eo(m,f+1)!="/")continue;f++;break;case bm:if(i!="/"&&i!="\\"){p=Am;continue}break;case Am:if(i=="@"){E&&(m="%40"+m),E=!0,a=al(m);for(var v=0;v<a.length;v++){var y=a[v];if(y!=":"||I){var b=Ca(y,Dv);I?u.password+=b:u.username+=b}else I=!0}m=""}else if(i==Qi||i=="/"||i=="?"||i=="#"||i=="\\"&&u.isSpecial()){if(E&&m=="")return"Invalid authority";f-=al(m).length+1,m="",p=Mv}else m+=i;break;case Mv:case xv:if(t&&u.scheme=="file"){p=Vv;continue}if(i!=":"||S){if(i==Qi||i=="/"||i=="?"||i=="#"||i=="\\"&&u.isSpecial()){if(u.isSpecial()&&m=="")return kc;if(t&&m==""&&(u.includesCredentials()||u.port!==null))return;if(c=u.parseHost(m))return c;if(m="",p=dl,t)return;continue}i=="["?S=!0:i=="]"&&(S=!1),m+=i}else{if(m=="")return kc;if(c=u.parseHost(m))return c;if(m="",p=Uv,t==xv)return}break;case Uv:if(!Do(Nv,i)){if(i==Qi||i=="/"||i=="?"||i=="#"||i=="\\"&&u.isSpecial()||t){if(m!=""){var D=Cm(m,10);if(D>65535)return wD;u.port=u.isSpecial()&&D===Im[u.scheme]?null:D,m=""}if(t)return;p=dl;continue}return wD}m+=i;break;case jv:if(u.scheme="file",i=="/"||i=="\\")p=xD;else{if(!n||n.scheme!="file"){p=ds;continue}if(i==Qi)u.host=n.host,u.path=No(n.path),u.query=n.query;else if(i=="?")u.host=n.host,u.path=No(n.path),u.query="",p=Mc;else{if(i!="#"){ND(dh(No(r,f),""))||(u.host=n.host,u.path=No(n.path),u.shortenPath()),p=ds;continue}u.host=n.host,u.path=No(n.path),u.query=n.query,u.fragment="",p=xs}}break;case xD:if(i=="/"||i=="\\"){p=Vv;break}n&&n.scheme=="file"&&!ND(dh(No(r,f),""))&&(hh(n.path[0],!0)?cl(u.path,n.path[0]):u.host=n.host),p=ds;continue;case Vv:if(i==Qi||i=="/"||i=="\\"||i=="?"||i=="#"){if(!t&&hh(m))p=ds;else if(m==""){if(u.host="",t)return;p=dl}else{if(c=u.parseHost(m))return c;if(u.host=="localhost"&&(u.host=""),t)return;m="",p=dl}continue}m+=i;break;case dl:if(u.isSpecial()){if(p=ds,i!="/"&&i!="\\")continue}else if(t||i!="?")if(t||i!="#"){if(i!=Qi&&(p=ds,i!="/"))continue}else u.fragment="",p=xs;else u.query="",p=Mc;break;case ds:if(i==Qi||i=="/"||i=="\\"&&u.isSpecial()||!t&&(i=="?"||i=="#")){if((l=Rm(l=m))===".."||l==="%2e."||l===".%2e"||l==="%2e%2e"?(u.shortenPath(),i=="/"||i=="\\"&&u.isSpecial()||cl(u.path,"")):Oq(m)?i=="/"||i=="\\"&&u.isSpecial()||cl(u.path,""):(u.scheme=="file"&&!u.path.length&&hh(m)&&(u.host&&(u.host=""),m=eo(m,0)+":"),cl(u.path,m)),m="",u.scheme=="file"&&(i==Qi||i=="?"||i=="#"))for(;u.path.length>1&&u.path[0]==="";)Eq(u.path);i=="?"?(u.query="",p=Mc):i=="#"&&(u.fragment="",p=xs)}else m+=Ca(i,OD);break;case UD:i=="?"?(u.query="",p=Mc):i=="#"?(u.fragment="",p=xs):i!=Qi&&(u.path[0]+=Ca(i,wm));break;case Mc:t||i!="#"?i!=Qi&&(i=="'"&&u.isSpecial()?u.query+="%27":u.query+=i=="#"?"%23":Ca(i,wm)):(u.fragment="",p=xs);break;case xs:i!=Qi&&(u.fragment+=Ca(i,AD))}f++}},parseHost:function(e){var t,n,r;if(eo(e,0)=="["){if(eo(e,e.length-1)!="]"||(t=function(i){var a,c,l,u,p,f,m,E=[0,0,0,0,0,0,0,0],S=0,I=null,v=0,y=function(){return eo(i,v)};if(y()==":"){if(eo(i,1)!=":")return;v+=2,I=++S}for(;y();){if(S==8)return;if(y()!=":"){for(a=c=0;c<4&&Do(bD,y());)a=16*a+Cm(y(),16),v++,c++;if(y()=="."){if(c==0||(v-=c,S>6))return;for(l=0;y();){if(u=null,l>0){if(!(y()=="."&&l<4))return;v++}if(!Do(Nv,y()))return;for(;Do(Nv,y());){if(p=Cm(y(),10),u===null)u=p;else{if(u==0)return;u=10*u+p}if(u>255)return;v++}E[S]=256*E[S]+u,++l!=2&&l!=4||S++}if(l!=4)return;break}if(y()==":"){if(v++,!y())return}else if(y())return;E[S++]=a}else{if(I!==null)return;v++,I=++S}}if(I!==null)for(f=S-I,S=7;S!=0&&f>0;)m=E[S],E[S--]=E[I+f-1],E[I+--f]=m;else if(S!=8)return;return E}(lh(e,1,-1)),!t))return kc;this.host=t}else if(this.isSpecial()){if(e=cq(e),Do(Rq,e)||(t=function(i){var a,c,l,u,p,f,m,E=gq(i,".");if(E.length&&E[E.length-1]==""&&E.length--,(a=E.length)>4)return i;for(c=[],l=0;l<a;l++){if((u=E[l])=="")return i;if(p=10,u.length>1&&eo(u,0)=="0"&&(p=Do(vq,u)?16:8,u=lh(u,p==8?1:2)),u==="")f=0;else{if(!Do(p==10?Cq:p==8?yq:bD,u))return i;f=Cm(u,p)}cl(c,f)}for(l=0;l<a;l++)if(f=c[l],l==a-1){if(f>=RD(256,5-a))return null}else if(f>255)return null;for(m=_q(c),l=0;l<c.length;l++)m+=c[l]*RD(256,3-l);return m}(e),t===null))return kc;this.host=t}else{if(Do(wq,e))return kc;for(t="",n=al(e),r=0;r<n.length;r++)t+=Ca(n[r],wm);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return wv(Im,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme=="file"&&t==1&&hh(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,a=e.port,c=e.path,l=e.query,u=e.fragment,p=t+":";return i!==null?(p+="//",e.includesCredentials()&&(p+=n+(r?":"+r:"")+"@"),p+=uh(i),a!==null&&(p+=":"+a)):t=="file"&&(p+="//"),p+=e.cannotBeABaseURL?c[0]:c.length?"/"+dh(c,"/"):"",l!==null&&(p+="?"+l),u!==null&&(p+="#"+u),p},setHref:function(e){var t=this.parse(e);if(t)throw bv(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e=="blob")try{return new ll(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+uh(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Ms(e)+":",Pv)},getUsername:function(){return this.username},setUsername:function(e){var t=al(Ms(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Ca(t[n],Dv)}},getPassword:function(){return this.password},setPassword:function(e){var t=al(Ms(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Ca(t[n],Dv)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?uh(e):uh(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Mv)},getHostname:function(){var e=this.host;return e===null?"":uh(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,xv)},getPort:function(){var e=this.port;return e===null?"":Ms(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Ms(e))==""?this.port=null:this.parse(e,Uv))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+dh(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,dl))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Ms(e))==""?this.query=null:(eo(e,0)=="?"&&(e=lh(e,1)),this.query="",this.parse(e,Mc)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Ms(e))!=""?(eo(e,0)=="#"&&(e=lh(e,1)),this.fragment="",this.parse(e,xs)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var ll=function(e){var t=sq(this,Yr),n=lq(arguments.length,1)>1?arguments[1]:void 0,r=uq(t,new Fv(e,!1,n));Cv||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},Yr=ll.prototype,to=function(e,t){return{get:function(){return ym(this)[e]()},set:t&&function(n){return ym(this)[t](n)},configurable:!0,enumerable:!0}};if(Cv&&($i(Yr,"href",to("serialize","setHref")),$i(Yr,"origin",to("getOrigin")),$i(Yr,"protocol",to("getProtocol","setProtocol")),$i(Yr,"username",to("getUsername","setUsername")),$i(Yr,"password",to("getPassword","setPassword")),$i(Yr,"host",to("getHost","setHost")),$i(Yr,"hostname",to("getHostname","setHostname")),$i(Yr,"port",to("getPort","setPort")),$i(Yr,"pathname",to("getPathname","setPathname")),$i(Yr,"search",to("getSearch","setSearch")),$i(Yr,"searchParams",to("getSearchParams")),$i(Yr,"hash",to("getHash","setHash"))),vm(Yr,"toJSON",function(){return ym(this).serialize()},{enumerable:!0}),vm(Yr,"toString",function(){return ym(this).serialize()},{enumerable:!0}),ch){var jD=ch.createObjectURL,VD=ch.revokeObjectURL;jD&&vm(ll,"createObjectURL",vD(jD,ch)),VD&&vm(ll,"revokeObjectURL",vD(VD,ch))}dq(ll,"URL"),iq({global:!0,constructor:!0,forced:!oq,sham:!Cv},{URL:ll});var Nq=bt,Dq=g,Pq=Ef,FD=Ci,Lq=hT,BD=Hr("URL");Nq({target:"URL",stat:!0,forced:!(Lq&&Dq(function(){BD.canParse()}))},{canParse:function(e){var t=Pq(arguments.length,1),n=FD(e),r=t<2||arguments[1]===void 0?void 0:FD(arguments[1]);try{return!!new BD(n,r)}catch{return!1}}});var WD=_(vo.URL),kq=G,Mq=_N,GD=RegExp.prototype,xq=function(e){return e===GD||kq(GD,e)?Mq(e):e.flags},cr=_(xq);function ul(e){let t=e.length;for(;--t>=0;)e[t]=0}const Bv=256,HD=286,ph=30,fh=15,Wv=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Om=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Uq=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),KD=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Us=new Array(576);ul(Us);const mh=new Array(60);ul(mh);const _h=new Array(512);ul(_h);const Eh=new Array(256);ul(Eh);const Gv=new Array(29);ul(Gv);const Nm=new Array(ph);function Hv(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let zD,YD,qD;function Kv(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}ul(Nm);const JD=e=>e<256?_h[e]:_h[256+(e>>>7)],gh=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},ai=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,gh(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},ls=(e,t,n)=>{ai(e,n[2*t],n[2*t+1])},XD=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},QD=(e,t,n)=>{const r=new Array(16);let i,a,c=0;for(i=1;i<=fh;i++)c=c+n[i-1]<<1,r[i]=c;for(a=0;a<=t;a++){let l=e[2*a+1];l!==0&&(e[2*a]=XD(r[l]++,l))}},ZD=e=>{let t;for(t=0;t<HD;t++)e.dyn_ltree[2*t]=0;for(t=0;t<ph;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},$D=e=>{e.bi_valid>8?gh(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},eP=(e,t,n,r)=>{const i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]},zv=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&eP(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!eP(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},tP=(e,t,n)=>{let r,i,a,c,l=0;if(e.sym_next!==0)do r=255&e.pending_buf[e.sym_buf+l++],r+=(255&e.pending_buf[e.sym_buf+l++])<<8,i=e.pending_buf[e.sym_buf+l++],r===0?ls(e,i,t):(a=Eh[i],ls(e,a+Bv+1,t),c=Wv[a],c!==0&&(i-=Gv[a],ai(e,i,c)),r--,a=JD(r),ls(e,a,n),c=Om[a],c!==0&&(r-=Nm[a],ai(e,r,c)));while(l<e.sym_next);ls(e,256,t)},Yv=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,a=t.stat_desc.elems;let c,l,u,p=-1;for(e.heap_len=0,e.heap_max=573,c=0;c<a;c++)n[2*c]!==0?(e.heap[++e.heap_len]=p=c,e.depth[c]=0):n[2*c+1]=0;for(;e.heap_len<2;)u=e.heap[++e.heap_len]=p<2?++p:0,n[2*u]=1,e.depth[u]=0,e.opt_len--,i&&(e.static_len-=r[2*u+1]);for(t.max_code=p,c=e.heap_len>>1;c>=1;c--)zv(e,n,c);u=a;do c=e.heap[1],e.heap[1]=e.heap[e.heap_len--],zv(e,n,1),l=e.heap[1],e.heap[--e.heap_max]=c,e.heap[--e.heap_max]=l,n[2*u]=n[2*c]+n[2*l],e.depth[u]=(e.depth[c]>=e.depth[l]?e.depth[c]:e.depth[l])+1,n[2*c+1]=n[2*l+1]=u,e.heap[1]=u++,zv(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((f,m)=>{const E=m.dyn_tree,S=m.max_code,I=m.stat_desc.static_tree,v=m.stat_desc.has_stree,y=m.stat_desc.extra_bits,b=m.stat_desc.extra_base,D=m.stat_desc.max_length;let U,F,W,q,Q,ee,ne=0;for(q=0;q<=fh;q++)f.bl_count[q]=0;for(E[2*f.heap[f.heap_max]+1]=0,U=f.heap_max+1;U<573;U++)F=f.heap[U],q=E[2*E[2*F+1]+1]+1,q>D&&(q=D,ne++),E[2*F+1]=q,F>S||(f.bl_count[q]++,Q=0,F>=b&&(Q=y[F-b]),ee=E[2*F],f.opt_len+=ee*(q+Q),v&&(f.static_len+=ee*(I[2*F+1]+Q)));if(ne!==0){do{for(q=D-1;f.bl_count[q]===0;)q--;f.bl_count[q]--,f.bl_count[q+1]+=2,f.bl_count[D]--,ne-=2}while(ne>0);for(q=D;q!==0;q--)for(F=f.bl_count[q];F!==0;)W=f.heap[--U],W>S||(E[2*W+1]!==q&&(f.opt_len+=(q-E[2*W+1])*E[2*W],E[2*W+1]=q),F--)}})(e,t),QD(n,p,e.bl_count)},nP=(e,t,n)=>{let r,i,a=-1,c=t[1],l=0,u=7,p=4;for(c===0&&(u=138,p=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=c,c=t[2*(r+1)+1],++l<u&&i===c||(l<p?e.bl_tree[2*i]+=l:i!==0?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):l<=10?e.bl_tree[34]++:e.bl_tree[36]++,l=0,a=i,c===0?(u=138,p=3):i===c?(u=6,p=3):(u=7,p=4))},rP=(e,t,n)=>{let r,i,a=-1,c=t[1],l=0,u=7,p=4;for(c===0&&(u=138,p=3),r=0;r<=n;r++)if(i=c,c=t[2*(r+1)+1],!(++l<u&&i===c)){if(l<p)do ls(e,i,e.bl_tree);while(--l!=0);else i!==0?(i!==a&&(ls(e,i,e.bl_tree),l--),ls(e,16,e.bl_tree),ai(e,l-3,2)):l<=10?(ls(e,17,e.bl_tree),ai(e,l-3,3)):(ls(e,18,e.bl_tree),ai(e,l-11,7));l=0,a=i,c===0?(u=138,p=3):i===c?(u=6,p=3):(u=7,p=4)}};let iP=!1;const oP=(e,t,n,r)=>{ai(e,0+(r?1:0),3),$D(e),gh(e,n),gh(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var jq=e=>{iP||((()=>{let t,n,r,i,a;const c=new Array(16);for(r=0,i=0;i<28;i++)for(Gv[i]=r,t=0;t<1<<Wv[i];t++)Eh[r++]=i;for(Eh[r-1]=i,a=0,i=0;i<16;i++)for(Nm[i]=a,t=0;t<1<<Om[i];t++)_h[a++]=i;for(a>>=7;i<ph;i++)for(Nm[i]=a<<7,t=0;t<1<<Om[i]-7;t++)_h[256+a++]=i;for(n=0;n<=fh;n++)c[n]=0;for(t=0;t<=143;)Us[2*t+1]=8,t++,c[8]++;for(;t<=255;)Us[2*t+1]=9,t++,c[9]++;for(;t<=279;)Us[2*t+1]=7,t++,c[7]++;for(;t<=287;)Us[2*t+1]=8,t++,c[8]++;for(QD(Us,287,c),t=0;t<ph;t++)mh[2*t+1]=5,mh[2*t]=XD(t,5);zD=new Hv(Us,Wv,257,HD,fh),YD=new Hv(mh,Om,0,ph,fh),qD=new Hv(new Array(0),Uq,0,19,7)})(),iP=!0),e.l_desc=new Kv(e.dyn_ltree,zD),e.d_desc=new Kv(e.dyn_dtree,YD),e.bl_desc=new Kv(e.bl_tree,qD),e.bi_buf=0,e.bi_valid=0,ZD(e)},Vq=(e,t,n,r)=>{let i,a,c=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(l=>{let u,p=4093624447;for(u=0;u<=31;u++,p>>>=1)if(1&p&&l.dyn_ltree[2*u]!==0)return 0;if(l.dyn_ltree[18]!==0||l.dyn_ltree[20]!==0||l.dyn_ltree[26]!==0)return 1;for(u=32;u<Bv;u++)if(l.dyn_ltree[2*u]!==0)return 1;return 0})(e)),Yv(e,e.l_desc),Yv(e,e.d_desc),c=(l=>{let u;for(nP(l,l.dyn_ltree,l.l_desc.max_code),nP(l,l.dyn_dtree,l.d_desc.max_code),Yv(l,l.bl_desc),u=18;u>=3&&l.bl_tree[2*KD[u]+1]===0;u--);return l.opt_len+=3*(u+1)+5+5+4,u})(e),i=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=i&&(i=a)):i=a=n+5,n+4<=i&&t!==-1?oP(e,t,n,r):e.strategy===4||a===i?(ai(e,2+(r?1:0),3),tP(e,Us,mh)):(ai(e,4+(r?1:0),3),((l,u,p,f)=>{let m;for(ai(l,u-257,5),ai(l,p-1,5),ai(l,f-4,4),m=0;m<f;m++)ai(l,l.bl_tree[2*KD[m]+1],3);rP(l,l.dyn_ltree,u-1),rP(l,l.dyn_dtree,p-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,c+1),tP(e,e.dyn_ltree,e.dyn_dtree)),ZD(e),r&&$D(e)},Fq=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Eh[n]+Bv+1)]++,e.dyn_dtree[2*JD(t)]++),e.sym_next===e.sym_end),Bq=e=>{ai(e,2,3),ls(e,256,Us),(t=>{t.bi_valid===16?(gh(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},Wq={_tr_init:jq,_tr_stored_block:oP,_tr_flush_block:Vq,_tr_tally:Fq,_tr_align:Bq},Sh=(e,t,n,r)=>{let i=65535&e|0,a=e>>>16&65535|0,c=0;for(;n!==0;){c=n>2e3?2e3:n,n-=c;do i=i+t[r++]|0,a=a+i|0;while(--c);i%=65521,a%=65521}return i|a<<16|0};const Gq=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var Sr=(e,t,n,r)=>{const i=Gq,a=r+n;e^=-1;for(let c=r;c<a;c++)e=e>>>8^i[255&(e^t[c])];return-1^e},xc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},hl={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Hq,_tr_stored_block:qv,_tr_flush_block:Kq,_tr_tally:Ra,_tr_align:zq}=Wq,{Z_NO_FLUSH:wa,Z_PARTIAL_FLUSH:Yq,Z_FULL_FLUSH:qq,Z_FINISH:no,Z_BLOCK:sP,Z_OK:wr,Z_STREAM_END:aP,Z_STREAM_ERROR:us,Z_DATA_ERROR:Jq,Z_BUF_ERROR:Jv,Z_DEFAULT_COMPRESSION:Xq,Z_FILTERED:Qq,Z_HUFFMAN_ONLY:Dm,Z_RLE:Zq,Z_FIXED:$q,Z_DEFAULT_STRATEGY:eJ,Z_UNKNOWN:tJ,Z_DEFLATED:Pm}=hl,Xv=286,nJ=30,rJ=19,iJ=2*Xv+1,oJ=15,Uc=258,hs=262,pl=42,jc=113,Th=666,Vc=(e,t)=>(e.msg=xc[t],t),cP=e=>2*e-(e>4?9:0),Ia=e=>{let t=e.length;for(;--t>=0;)e[t]=0},sJ=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do n=e.head[--r],e.head[r]=n>=i?n-i:0;while(--t);t=i,r=t;do n=e.prev[--r],e.prev[r]=n>=i?n-i:0;while(--t)};let ba=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const Ai=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},Oi=(e,t)=>{Kq(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Ai(e.strm)},Xt=(e,t)=>{e.pending_buf[e.pending++]=t},vh=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Qv=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),i===0?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),e.state.wrap===1?e.adler=Sh(e.adler,t,i,n):e.state.wrap===2&&(e.adler=Sr(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},dP=(e,t)=>{let n,r,i=e.max_chain_length,a=e.strstart,c=e.prev_length,l=e.nice_match;const u=e.strstart>e.w_size-hs?e.strstart-(e.w_size-hs):0,p=e.window,f=e.w_mask,m=e.prev,E=e.strstart+Uc;let S=p[a+c-1],I=p[a+c];e.prev_length>=e.good_match&&(i>>=2),l>e.lookahead&&(l=e.lookahead);do if(n=t,p[n+c]===I&&p[n+c-1]===S&&p[n]===p[a]&&p[++n]===p[a+1]){a+=2,n++;do;while(p[++a]===p[++n]&&p[++a]===p[++n]&&p[++a]===p[++n]&&p[++a]===p[++n]&&p[++a]===p[++n]&&p[++a]===p[++n]&&p[++a]===p[++n]&&p[++a]===p[++n]&&a<E);if(r=Uc-(E-a),a=E-Uc,r>c){if(e.match_start=t,c=r,r>=l)break;S=p[a+c-1],I=p[a+c]}}while((t=m[t&f])>u&&--i!=0);return c<=e.lookahead?c:e.lookahead},fl=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-hs)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),sJ(e),r+=t),e.strm.avail_in===0)break;if(n=Qv(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=ba(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=ba(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<hs&&e.strm.avail_in!==0)},lP=(e,t)=>{let n,r,i,a=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,c=0,l=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i||(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<a&&(n===0&&t!==no||t===wa||n!==r+e.strm.avail_in)))break;c=t===no&&n===r+e.strm.avail_in?1:0,qv(e,0,0,c),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,Ai(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(Qv(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(c===0);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),c?4:t!==wa&&t!==no&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(Qv(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,a=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=a||(r||t===no)&&t!==wa&&e.strm.avail_in===0&&r<=i)&&(n=r>i?i:r,c=t===no&&e.strm.avail_in===0&&n===r?1:0,qv(e,e.block_start,n,c),e.block_start+=n,Ai(e.strm)),c?3:1)},Zv=(e,t)=>{let n,r;for(;;){if(e.lookahead<hs){if(fl(e),e.lookahead<hs&&t===wa)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=ba(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-hs&&(e.match_length=dP(e,n)),e.match_length>=3)if(r=Ra(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=ba(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ba(e,e.ins_h,e.window[e.strstart+1]);else r=Ra(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(Oi(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===no?(Oi(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Oi(e,!1),e.strm.avail_out===0)?1:2},ml=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<hs){if(fl(e),e.lookahead<hs&&t===wa)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=ba(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-hs&&(e.match_length=dP(e,n),e.match_length<=5&&(e.strategy===Qq||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=Ra(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=ba(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(Oi(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(r=Ra(e,0,e.window[e.strstart-1]),r&&Oi(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=Ra(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===no?(Oi(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Oi(e,!1),e.strm.avail_out===0)?1:2};function ps(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const yh=[new ps(0,0,0,0,lP),new ps(4,4,8,4,Zv),new ps(4,5,16,8,Zv),new ps(4,6,32,32,Zv),new ps(4,4,16,16,ml),new ps(8,16,32,32,ml),new ps(8,16,128,128,ml),new ps(8,32,128,256,ml),new ps(32,128,258,1024,ml),new ps(32,258,258,4096,ml)];function aJ(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Pm,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*iJ),this.dyn_dtree=new Uint16Array(2*(2*nJ+1)),this.bl_tree=new Uint16Array(2*(2*rJ+1)),Ia(this.dyn_ltree),Ia(this.dyn_dtree),Ia(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(oJ+1),this.heap=new Uint16Array(2*Xv+1),Ia(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Xv+1),Ia(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ch=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==pl&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==jc&&t.status!==Th?1:0},uP=e=>{if(Ch(e))return Vc(e,us);e.total_in=e.total_out=0,e.data_type=tJ;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?pl:jc,e.adler=t.wrap===2?0:1,t.last_flush=-2,Hq(t),wr},hP=e=>{const t=uP(e);return t===wr&&(n=>{n.window_size=2*n.w_size,Ia(n.head),n.max_lazy_match=yh[n.level].max_lazy,n.good_match=yh[n.level].good_length,n.nice_match=yh[n.level].nice_length,n.max_chain_length=yh[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},pP=(e,t,n,r,i,a)=>{if(!e)return us;let c=1;if(t===Xq&&(t=6),r<0?(c=0,r=-r):r>15&&(c=2,r-=16),i<1||i>9||n!==Pm||r<8||r>15||t<0||t>9||a<0||a>$q||r===8&&c!==1)return Vc(e,us);r===8&&(r=9);const l=new aJ;return e.state=l,l.strm=e,l.status=pl,l.wrap=c,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=i+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<i+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=t,l.strategy=a,l.method=n,hP(e)};var cJ=(e,t)=>{if(Ch(e)||t>sP||t<0)return e?Vc(e,us):us;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===Th&&t!==no)return Vc(e,e.avail_out===0?Jv:us);const r=n.last_flush;if(n.last_flush=t,n.pending!==0){if(Ai(e),e.avail_out===0)return n.last_flush=-1,wr}else if(e.avail_in===0&&cP(t)<=cP(r)&&t!==no)return Vc(e,Jv);if(n.status===Th&&e.avail_in!==0)return Vc(e,Jv);if(n.status===pl&&n.wrap===0&&(n.status=jc),n.status===pl){let i=Pm+(n.w_bits-8<<4)<<8,a=-1;if(a=n.strategy>=Dm||n.level<2?0:n.level<6?1:n.level===6?2:3,i|=a<<6,n.strstart!==0&&(i|=32),i+=31-i%31,vh(n,i),n.strstart!==0&&(vh(n,e.adler>>>16),vh(n,65535&e.adler)),e.adler=1,n.status=jc,Ai(e),n.pending!==0)return n.last_flush=-1,wr}if(n.status===57){if(e.adler=0,Xt(n,31),Xt(n,139),Xt(n,8),n.gzhead)Xt(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Xt(n,255&n.gzhead.time),Xt(n,n.gzhead.time>>8&255),Xt(n,n.gzhead.time>>16&255),Xt(n,n.gzhead.time>>24&255),Xt(n,n.level===9?2:n.strategy>=Dm||n.level<2?4:0),Xt(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Xt(n,255&n.gzhead.extra.length),Xt(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Sr(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Xt(n,0),Xt(n,0),Xt(n,0),Xt(n,0),Xt(n,0),Xt(n,n.level===9?2:n.strategy>=Dm||n.level<2?4:0),Xt(n,3),n.status=jc,Ai(e),n.pending!==0)return n.last_flush=-1,wr}if(n.status===69){if(n.gzhead.extra){let i=n.pending,a=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+a>n.pending_buf_size;){let l=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(e.adler=Sr(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=l,Ai(e),n.pending!==0)return n.last_flush=-1,wr;i=0,a-=l}let c=new Uint8Array(n.gzhead.extra);n.pending_buf.set(c.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending+=a,n.gzhead.hcrc&&n.pending>i&&(e.adler=Sr(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let i,a=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>a&&(e.adler=Sr(e.adler,n.pending_buf,n.pending-a,a)),Ai(e),n.pending!==0)return n.last_flush=-1,wr;a=0}i=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Xt(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>a&&(e.adler=Sr(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let i,a=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>a&&(e.adler=Sr(e.adler,n.pending_buf,n.pending-a,a)),Ai(e),n.pending!==0)return n.last_flush=-1,wr;a=0}i=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Xt(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>a&&(e.adler=Sr(e.adler,n.pending_buf,n.pending-a,a))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Ai(e),n.pending!==0))return n.last_flush=-1,wr;Xt(n,255&e.adler),Xt(n,e.adler>>8&255),e.adler=0}if(n.status=jc,Ai(e),n.pending!==0)return n.last_flush=-1,wr}if(e.avail_in!==0||n.lookahead!==0||t!==wa&&n.status!==Th){let i=n.level===0?lP(n,t):n.strategy===Dm?((a,c)=>{let l;for(;;){if(a.lookahead===0&&(fl(a),a.lookahead===0)){if(c===wa)return 1;break}if(a.match_length=0,l=Ra(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,l&&(Oi(a,!1),a.strm.avail_out===0))return 1}return a.insert=0,c===no?(Oi(a,!0),a.strm.avail_out===0?3:4):a.sym_next&&(Oi(a,!1),a.strm.avail_out===0)?1:2})(n,t):n.strategy===Zq?((a,c)=>{let l,u,p,f;const m=a.window;for(;;){if(a.lookahead<=Uc){if(fl(a),a.lookahead<=Uc&&c===wa)return 1;if(a.lookahead===0)break}if(a.match_length=0,a.lookahead>=3&&a.strstart>0&&(p=a.strstart-1,u=m[p],u===m[++p]&&u===m[++p]&&u===m[++p])){f=a.strstart+Uc;do;while(u===m[++p]&&u===m[++p]&&u===m[++p]&&u===m[++p]&&u===m[++p]&&u===m[++p]&&u===m[++p]&&u===m[++p]&&p<f);a.match_length=Uc-(f-p),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=3?(l=Ra(a,1,a.match_length-3),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(l=Ra(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),l&&(Oi(a,!1),a.strm.avail_out===0))return 1}return a.insert=0,c===no?(Oi(a,!0),a.strm.avail_out===0?3:4):a.sym_next&&(Oi(a,!1),a.strm.avail_out===0)?1:2})(n,t):yh[n.level].func(n,t);if(i!==3&&i!==4||(n.status=Th),i===1||i===3)return e.avail_out===0&&(n.last_flush=-1),wr;if(i===2&&(t===Yq?zq(n):t!==sP&&(qv(n,0,0,!1),t===qq&&(Ia(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),Ai(e),e.avail_out===0))return n.last_flush=-1,wr}return t!==no?wr:n.wrap<=0?aP:(n.wrap===2?(Xt(n,255&e.adler),Xt(n,e.adler>>8&255),Xt(n,e.adler>>16&255),Xt(n,e.adler>>24&255),Xt(n,255&e.total_in),Xt(n,e.total_in>>8&255),Xt(n,e.total_in>>16&255),Xt(n,e.total_in>>24&255)):(vh(n,e.adler>>>16),vh(n,65535&e.adler)),Ai(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?wr:aP)},dJ=(e,t)=>{let n=t.length;if(Ch(e))return us;const r=e.state,i=r.wrap;if(i===2||i===1&&r.status!==pl||r.lookahead)return us;if(i===1&&(e.adler=Sh(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){i===0&&(Ia(r.head),r.strstart=0,r.block_start=0,r.insert=0);let u=new Uint8Array(r.w_size);u.set(t.subarray(n-r.w_size,n),0),t=u,n=r.w_size}const a=e.avail_in,c=e.next_in,l=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,fl(r);r.lookahead>=3;){let u=r.strstart,p=r.lookahead-2;do r.ins_h=ba(r,r.ins_h,r.window[u+3-1]),r.prev[u&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=u,u++;while(--p);r.strstart=u,r.lookahead=2,fl(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=c,e.input=l,e.avail_in=a,r.wrap=i,wr},Rh={deflateInit:(e,t)=>pP(e,t,Pm,15,8,eJ),deflateInit2:pP,deflateReset:hP,deflateResetKeep:uP,deflateSetHeader:(e,t)=>Ch(e)||e.state.wrap!==2?us:(e.state.gzhead=t,wr),deflate:cJ,deflateEnd:e=>{if(Ch(e))return us;const t=e.state.status;return e.state=null,t===jc?Vc(e,Jq):wr},deflateSetDictionary:dJ,deflateInfo:"pako deflate (from Nodeca project)"};const lJ=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Lm={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)lJ(n,r)&&(e[r]=n[r])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,i=0,a=e.length;r<a;r++){let c=e[r];n.set(c,i),i+=c.length}return n}};let fP=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{fP=!1}const wh=new Uint8Array(256);for(let e=0;e<256;e++)wh[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;wh[254]=wh[254]=1;var Ih={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,r,i,a,c=e.length,l=0;for(i=0;i<c;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<c&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(l),a=0,i=0;a<l;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<c&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,i;const a=new Array(2*n);for(i=0,r=0;r<n;){let c=e[r++];if(c<128){a[i++]=c;continue}let l=wh[c];if(l>4)a[i++]=65533,r+=l-1;else{for(c&=l===2?31:l===3?15:7;l>1&&r<n;)c=c<<6|63&e[r++],l--;l>1?a[i++]=65533:c<65536?a[i++]=c:(c-=65536,a[i++]=55296|c>>10&1023,a[i++]=56320|1023&c)}}return((c,l)=>{if(l<65534&&c.subarray&&fP)return String.fromCharCode.apply(null,c.length===l?c:c.subarray(0,l));let u="";for(let p=0;p<l;p++)u+=String.fromCharCode(c[p]);return u})(a,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+wh[e[n]]>t?n:t}},mP=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const _P=Object.prototype.toString,{Z_NO_FLUSH:uJ,Z_SYNC_FLUSH:hJ,Z_FULL_FLUSH:pJ,Z_FINISH:fJ,Z_OK:km,Z_STREAM_END:mJ,Z_DEFAULT_COMPRESSION:_J,Z_DEFAULT_STRATEGY:EJ,Z_DEFLATED:gJ}=hl;function bh(e){this.options=Lm.assign({level:_J,method:gJ,chunkSize:16384,windowBits:15,memLevel:8,strategy:EJ},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new mP,this.strm.avail_out=0;let n=Rh.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==km)throw new Error(xc[n]);if(t.header&&Rh.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?Ih.string2buf(t.dictionary):_P.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=Rh.deflateSetDictionary(this.strm,r),n!==km)throw new Error(xc[n]);this._dict_set=!0}}function $v(e,t){const n=new bh(t);if(n.push(e,!0),n.err)throw n.msg||xc[n.err];return n.result}bh.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,a;if(this.ended)return!1;for(a=t===~~t?t:t===!0?fJ:uJ,typeof e=="string"?n.input=Ih.string2buf(e):_P.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(a===hJ||a===pJ)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=Rh.deflate(n,a),i===mJ)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=Rh.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===km;if(n.avail_out!==0){if(a>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},bh.prototype.onData=function(e){this.chunks.push(e)},bh.prototype.onEnd=function(e){e===km&&(this.result=Lm.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var SJ={Deflate:bh,deflate:$v,deflateRaw:function(e,t){return(t=t||{}).raw=!0,$v(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,$v(e,t)},constants:hl};const Mm=16209;var TJ=function(e,t){let n,r,i,a,c,l,u,p,f,m,E,S,I,v,y,b,D,U,F,W,q,Q,ee,ne;const _e=e.state;n=e.next_in,ee=e.input,r=n+(e.avail_in-5),i=e.next_out,ne=e.output,a=i-(t-e.avail_out),c=i+(e.avail_out-257),l=_e.dmax,u=_e.wsize,p=_e.whave,f=_e.wnext,m=_e.window,E=_e.hold,S=_e.bits,I=_e.lencode,v=_e.distcode,y=(1<<_e.lenbits)-1,b=(1<<_e.distbits)-1;e:do{S<15&&(E+=ee[n++]<<S,S+=8,E+=ee[n++]<<S,S+=8),D=I[E&y];t:for(;;){if(U=D>>>24,E>>>=U,S-=U,U=D>>>16&255,U===0)ne[i++]=65535&D;else{if(!(16&U)){if(!(64&U)){D=I[(65535&D)+(E&(1<<U)-1)];continue t}if(32&U){_e.mode=16191;break e}e.msg="invalid literal/length code",_e.mode=Mm;break e}F=65535&D,U&=15,U&&(S<U&&(E+=ee[n++]<<S,S+=8),F+=E&(1<<U)-1,E>>>=U,S-=U),S<15&&(E+=ee[n++]<<S,S+=8,E+=ee[n++]<<S,S+=8),D=v[E&b];n:for(;;){if(U=D>>>24,E>>>=U,S-=U,U=D>>>16&255,!(16&U)){if(!(64&U)){D=v[(65535&D)+(E&(1<<U)-1)];continue n}e.msg="invalid distance code",_e.mode=Mm;break e}if(W=65535&D,U&=15,S<U&&(E+=ee[n++]<<S,S+=8,S<U&&(E+=ee[n++]<<S,S+=8)),W+=E&(1<<U)-1,W>l){e.msg="invalid distance too far back",_e.mode=Mm;break e}if(E>>>=U,S-=U,U=i-a,W>U){if(U=W-U,U>p&&_e.sane){e.msg="invalid distance too far back",_e.mode=Mm;break e}if(q=0,Q=m,f===0){if(q+=u-U,U<F){F-=U;do ne[i++]=m[q++];while(--U);q=i-W,Q=ne}}else if(f<U){if(q+=u+f-U,U-=f,U<F){F-=U;do ne[i++]=m[q++];while(--U);if(q=0,f<F){U=f,F-=U;do ne[i++]=m[q++];while(--U);q=i-W,Q=ne}}}else if(q+=f-U,U<F){F-=U;do ne[i++]=m[q++];while(--U);q=i-W,Q=ne}for(;F>2;)ne[i++]=Q[q++],ne[i++]=Q[q++],ne[i++]=Q[q++],F-=3;F&&(ne[i++]=Q[q++],F>1&&(ne[i++]=Q[q++]))}else{q=i-W;do ne[i++]=ne[q++],ne[i++]=ne[q++],ne[i++]=ne[q++],F-=3;while(F>2);F&&(ne[i++]=ne[q++],F>1&&(ne[i++]=ne[q++]))}break}}break}}while(n<r&&i<c);F=S>>3,n-=F,S-=F<<3,E&=(1<<S)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<c?c-i+257:257-(i-c),_e.hold=E,_e.bits=S};const xm=15,vJ=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),yJ=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),CJ=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),RJ=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Ah=(e,t,n,r,i,a,c,l)=>{const u=l.bits;let p,f,m,E,S,I,v=0,y=0,b=0,D=0,U=0,F=0,W=0,q=0,Q=0,ee=0,ne=null;const _e=new Uint16Array(16),Qe=new Uint16Array(16);let ct,Nt,dn,Gt=null;for(v=0;v<=xm;v++)_e[v]=0;for(y=0;y<r;y++)_e[t[n+y]]++;for(U=u,D=xm;D>=1&&_e[D]===0;D--);if(U>D&&(U=D),D===0)return i[a++]=20971520,i[a++]=20971520,l.bits=1,0;for(b=1;b<D&&_e[b]===0;b++);for(U<b&&(U=b),q=1,v=1;v<=xm;v++)if(q<<=1,q-=_e[v],q<0)return-1;if(q>0&&(e===0||D!==1))return-1;for(Qe[1]=0,v=1;v<xm;v++)Qe[v+1]=Qe[v]+_e[v];for(y=0;y<r;y++)t[n+y]!==0&&(c[Qe[t[n+y]]++]=y);if(e===0?(ne=Gt=c,I=20):e===1?(ne=vJ,Gt=yJ,I=257):(ne=CJ,Gt=RJ,I=0),ee=0,y=0,v=b,S=a,F=U,W=0,m=-1,Q=1<<U,E=Q-1,e===1&&Q>852||e===2&&Q>592)return 1;for(;;){ct=v-W,c[y]+1<I?(Nt=0,dn=c[y]):c[y]>=I?(Nt=Gt[c[y]-I],dn=ne[c[y]-I]):(Nt=96,dn=0),p=1<<v-W,f=1<<F,b=f;do f-=p,i[S+(ee>>W)+f]=ct<<24|Nt<<16|dn|0;while(f!==0);for(p=1<<v-1;ee&p;)p>>=1;if(p!==0?(ee&=p-1,ee+=p):ee=0,y++,--_e[v]==0){if(v===D)break;v=t[n+c[y]]}if(v>U&&(ee&E)!==m){for(W===0&&(W=U),S+=b,F=v-W,q=1<<F;F+W<D&&(q-=_e[F+W],!(q<=0));)F++,q<<=1;if(Q+=1<<F,e===1&&Q>852||e===2&&Q>592)return 1;m=ee&E,i[m]=U<<24|F<<16|S-a|0}}return ee!==0&&(i[S+ee]=v-W<<24|64<<16|0),l.bits=U,0};const{Z_FINISH:EP,Z_BLOCK:wJ,Z_TREES:Um,Z_OK:Fc,Z_STREAM_END:IJ,Z_NEED_DICT:bJ,Z_STREAM_ERROR:ro,Z_DATA_ERROR:gP,Z_MEM_ERROR:SP,Z_BUF_ERROR:AJ,Z_DEFLATED:TP}=hl,jm=16180,Vm=16190,js=16191,ey=16192,ty=16194,Fm=16199,Bm=16200,ny=16206,Ln=16209,vP=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function OJ(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Bc=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<jm||t.mode>16211?1:0},yP=e=>{if(Bc(e))return ro;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=jm,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Fc},CP=e=>{if(Bc(e))return ro;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,yP(e)},RP=(e,t)=>{let n;if(Bc(e))return ro;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?ro:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,CP(e))},wP=(e,t)=>{if(!e)return ro;const n=new OJ;e.state=n,n.strm=e,n.window=null,n.mode=jm;const r=RP(e,t);return r!==Fc&&(e.state=null),r};let ry,iy,IP=!0;const NJ=e=>{if(IP){ry=new Int32Array(512),iy=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Ah(1,e.lens,0,288,ry,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Ah(2,e.lens,0,32,iy,0,e.work,{bits:5}),IP=!1}e.lencode=ry,e.lenbits=9,e.distcode=iy,e.distbits=5},bP=(e,t,n,r)=>{let i;const a=e.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(i=a.wsize-a.wnext,i>r&&(i=r),a.window.set(t.subarray(n-r,n-r+i),a.wnext),(r-=i)?(a.window.set(t.subarray(n-r,n),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0};var DJ=(e,t)=>{let n,r,i,a,c,l,u,p,f,m,E,S,I,v,y,b,D,U,F,W,q,Q,ee=0;const ne=new Uint8Array(4);let _e,Qe;const ct=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Bc(e)||!e.output||!e.input&&e.avail_in!==0)return ro;n=e.state,n.mode===js&&(n.mode=ey),c=e.next_out,i=e.output,u=e.avail_out,a=e.next_in,r=e.input,l=e.avail_in,p=n.hold,f=n.bits,m=l,E=u,Q=Fc;e:for(;;)switch(n.mode){case jm:if(n.wrap===0){n.mode=ey;break}for(;f<16;){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}if(2&n.wrap&&p===35615){n.wbits===0&&(n.wbits=15),n.check=0,ne[0]=255&p,ne[1]=p>>>8&255,n.check=Sr(n.check,ne,2,0),p=0,f=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&p)<<8)+(p>>8))%31){e.msg="incorrect header check",n.mode=Ln;break}if((15&p)!==TP){e.msg="unknown compression method",n.mode=Ln;break}if(p>>>=4,f-=4,q=8+(15&p),n.wbits===0&&(n.wbits=q),q>15||q>n.wbits){e.msg="invalid window size",n.mode=Ln;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&p?16189:js,p=0,f=0;break;case 16181:for(;f<16;){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}if(n.flags=p,(255&cr(n))!==TP){e.msg="unknown compression method",n.mode=Ln;break}if(57344&cr(n)){e.msg="unknown header flags set",n.mode=Ln;break}n.head&&(n.head.text=p>>8&1),512&cr(n)&&4&n.wrap&&(ne[0]=255&p,ne[1]=p>>>8&255,n.check=Sr(n.check,ne,2,0)),p=0,f=0,n.mode=16182;case 16182:for(;f<32;){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}n.head&&(n.head.time=p),512&cr(n)&&4&n.wrap&&(ne[0]=255&p,ne[1]=p>>>8&255,ne[2]=p>>>16&255,ne[3]=p>>>24&255,n.check=Sr(n.check,ne,4,0)),p=0,f=0,n.mode=16183;case 16183:for(;f<16;){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}n.head&&(n.head.xflags=255&p,n.head.os=p>>8),512&cr(n)&&4&n.wrap&&(ne[0]=255&p,ne[1]=p>>>8&255,n.check=Sr(n.check,ne,2,0)),p=0,f=0,n.mode=16184;case 16184:if(1024&cr(n)){for(;f<16;){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}n.length=p,n.head&&(n.head.extra_len=p),512&cr(n)&&4&n.wrap&&(ne[0]=255&p,ne[1]=p>>>8&255,n.check=Sr(n.check,ne,2,0)),p=0,f=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&cr(n)&&(S=n.length,S>l&&(S=l),S&&(n.head&&(q=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(a,a+S),q)),512&cr(n)&&4&n.wrap&&(n.check=Sr(n.check,r,S,a)),l-=S,a+=S,n.length-=S),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&cr(n)){if(l===0)break e;S=0;do q=r[a+S++],n.head&&q&&n.length<65536&&(n.head.name+=String.fromCharCode(q));while(q&&S<l);if(512&cr(n)&&4&n.wrap&&(n.check=Sr(n.check,r,S,a)),l-=S,a+=S,q)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&cr(n)){if(l===0)break e;S=0;do q=r[a+S++],n.head&&q&&n.length<65536&&(n.head.comment+=String.fromCharCode(q));while(q&&S<l);if(512&cr(n)&&4&n.wrap&&(n.check=Sr(n.check,r,S,a)),l-=S,a+=S,q)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&cr(n)){for(;f<16;){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}if(4&n.wrap&&p!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Ln;break}p=0,f=0}n.head&&(n.head.hcrc=cr(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=js;break;case 16189:for(;f<32;){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}e.adler=n.check=vP(p),p=0,f=0,n.mode=Vm;case Vm:if(n.havedict===0)return e.next_out=c,e.avail_out=u,e.next_in=a,e.avail_in=l,n.hold=p,n.bits=f,bJ;e.adler=n.check=1,n.mode=js;case js:if(t===wJ||t===Um)break e;case ey:if(n.last){p>>>=7&f,f-=7&f,n.mode=ny;break}for(;f<3;){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}switch(n.last=1&p,p>>>=1,f-=1,3&p){case 0:n.mode=16193;break;case 1:if(NJ(n),n.mode=Fm,t===Um){p>>>=2,f-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Ln}p>>>=2,f-=2;break;case 16193:for(p>>>=7&f,f-=7&f;f<32;){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}if((65535&p)!=(p>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Ln;break}if(n.length=65535&p,p=0,f=0,n.mode=ty,t===Um)break e;case ty:n.mode=16195;case 16195:if(S=n.length,S){if(S>l&&(S=l),S>u&&(S=u),S===0)break e;i.set(r.subarray(a,a+S),c),l-=S,a+=S,u-=S,c+=S,n.length-=S;break}n.mode=js;break;case 16196:for(;f<14;){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}if(n.nlen=257+(31&p),p>>>=5,f-=5,n.ndist=1+(31&p),p>>>=5,f-=5,n.ncode=4+(15&p),p>>>=4,f-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Ln;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;f<3;){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}n.lens[ct[n.have++]]=7&p,p>>>=3,f-=3}for(;n.have<19;)n.lens[ct[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,_e={bits:n.lenbits},Q=Ah(0,n.lens,0,19,n.lencode,0,n.work,_e),n.lenbits=_e.bits,Q){e.msg="invalid code lengths set",n.mode=Ln;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;ee=n.lencode[p&(1<<n.lenbits)-1],y=ee>>>24,b=ee>>>16&255,D=65535&ee,!(y<=f);){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}if(D<16)p>>>=y,f-=y,n.lens[n.have++]=D;else{if(D===16){for(Qe=y+2;f<Qe;){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}if(p>>>=y,f-=y,n.have===0){e.msg="invalid bit length repeat",n.mode=Ln;break}q=n.lens[n.have-1],S=3+(3&p),p>>>=2,f-=2}else if(D===17){for(Qe=y+3;f<Qe;){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}p>>>=y,f-=y,q=0,S=3+(7&p),p>>>=3,f-=3}else{for(Qe=y+7;f<Qe;){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}p>>>=y,f-=y,q=0,S=11+(127&p),p>>>=7,f-=7}if(n.have+S>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Ln;break}for(;S--;)n.lens[n.have++]=q}}if(n.mode===Ln)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=Ln;break}if(n.lenbits=9,_e={bits:n.lenbits},Q=Ah(1,n.lens,0,n.nlen,n.lencode,0,n.work,_e),n.lenbits=_e.bits,Q){e.msg="invalid literal/lengths set",n.mode=Ln;break}if(n.distbits=6,n.distcode=n.distdyn,_e={bits:n.distbits},Q=Ah(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,_e),n.distbits=_e.bits,Q){e.msg="invalid distances set",n.mode=Ln;break}if(n.mode=Fm,t===Um)break e;case Fm:n.mode=Bm;case Bm:if(l>=6&&u>=258){e.next_out=c,e.avail_out=u,e.next_in=a,e.avail_in=l,n.hold=p,n.bits=f,TJ(e,E),c=e.next_out,i=e.output,u=e.avail_out,a=e.next_in,r=e.input,l=e.avail_in,p=n.hold,f=n.bits,n.mode===js&&(n.back=-1);break}for(n.back=0;ee=n.lencode[p&(1<<n.lenbits)-1],y=ee>>>24,b=ee>>>16&255,D=65535&ee,!(y<=f);){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}if(b&&!(240&b)){for(U=y,F=b,W=D;ee=n.lencode[W+((p&(1<<U+F)-1)>>U)],y=ee>>>24,b=ee>>>16&255,D=65535&ee,!(U+y<=f);){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}p>>>=U,f-=U,n.back+=U}if(p>>>=y,f-=y,n.back+=y,n.length=D,b===0){n.mode=16205;break}if(32&b){n.back=-1,n.mode=js;break}if(64&b){e.msg="invalid literal/length code",n.mode=Ln;break}n.extra=15&b,n.mode=16201;case 16201:if(n.extra){for(Qe=n.extra;f<Qe;){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}n.length+=p&(1<<n.extra)-1,p>>>=n.extra,f-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;ee=n.distcode[p&(1<<n.distbits)-1],y=ee>>>24,b=ee>>>16&255,D=65535&ee,!(y<=f);){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}if(!(240&b)){for(U=y,F=b,W=D;ee=n.distcode[W+((p&(1<<U+F)-1)>>U)],y=ee>>>24,b=ee>>>16&255,D=65535&ee,!(U+y<=f);){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}p>>>=U,f-=U,n.back+=U}if(p>>>=y,f-=y,n.back+=y,64&b){e.msg="invalid distance code",n.mode=Ln;break}n.offset=D,n.extra=15&b,n.mode=16203;case 16203:if(n.extra){for(Qe=n.extra;f<Qe;){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}n.offset+=p&(1<<n.extra)-1,p>>>=n.extra,f-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Ln;break}n.mode=16204;case 16204:if(u===0)break e;if(S=E-u,n.offset>S){if(S=n.offset-S,S>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Ln;break}S>n.wnext?(S-=n.wnext,I=n.wsize-S):I=n.wnext-S,S>n.length&&(S=n.length),v=n.window}else v=i,I=c-n.offset,S=n.length;S>u&&(S=u),u-=S,n.length-=S;do i[c++]=v[I++];while(--S);n.length===0&&(n.mode=Bm);break;case 16205:if(u===0)break e;i[c++]=n.length,u--,n.mode=Bm;break;case ny:if(n.wrap){for(;f<32;){if(l===0)break e;l--,p|=r[a++]<<f,f+=8}if(E-=u,e.total_out+=E,n.total+=E,4&n.wrap&&E&&(e.adler=n.check=cr(n)?Sr(n.check,i,E,c-E):Sh(n.check,i,E,c-E)),E=u,4&n.wrap&&(cr(n)?p:vP(p))!==n.check){e.msg="incorrect data check",n.mode=Ln;break}p=0,f=0}n.mode=16207;case 16207:if(n.wrap&&cr(n)){for(;f<32;){if(l===0)break e;l--,p+=r[a++]<<f,f+=8}if(4&n.wrap&&p!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Ln;break}p=0,f=0}n.mode=16208;case 16208:Q=IJ;break e;case Ln:Q=gP;break e;case 16210:return SP;default:return ro}return e.next_out=c,e.avail_out=u,e.next_in=a,e.avail_in=l,n.hold=p,n.bits=f,(n.wsize||E!==e.avail_out&&n.mode<Ln&&(n.mode<ny||t!==EP))&&bP(e,e.output,e.next_out,E-e.avail_out),m-=e.avail_in,E-=e.avail_out,e.total_in+=m,e.total_out+=E,n.total+=E,4&n.wrap&&E&&(e.adler=n.check=cr(n)?Sr(n.check,i,E,e.next_out-E):Sh(n.check,i,E,e.next_out-E)),e.data_type=n.bits+(n.last?64:0)+(n.mode===js?128:0)+(n.mode===Fm||n.mode===ty?256:0),(m===0&&E===0||t===EP)&&Q===Fc&&(Q=AJ),Q},Vs={inflateReset:CP,inflateReset2:RP,inflateResetKeep:yP,inflateInit:e=>wP(e,15),inflateInit2:wP,inflate:DJ,inflateEnd:e=>{if(Bc(e))return ro;let t=e.state;return t.window&&(t.window=null),e.state=null,Fc},inflateGetHeader:(e,t)=>{if(Bc(e))return ro;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,Fc):ro},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,a;return Bc(e)?ro:(r=e.state,r.wrap!==0&&r.mode!==Vm?ro:r.mode===Vm&&(i=1,i=Sh(i,t,n,0),i!==r.check)?gP:(a=bP(e,t,n,n),a?(r.mode=16210,SP):(r.havedict=1,Fc)))},inflateInfo:"pako inflate (from Nodeca project)"},PJ=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const AP=Object.prototype.toString,{Z_NO_FLUSH:LJ,Z_FINISH:kJ,Z_OK:Oh,Z_STREAM_END:oy,Z_NEED_DICT:sy,Z_STREAM_ERROR:MJ,Z_DATA_ERROR:OP,Z_MEM_ERROR:xJ}=hl;function Nh(e){this.options=Lm.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new mP,this.strm.avail_out=0;let n=Vs.inflateInit2(this.strm,t.windowBits);if(n!==Oh)throw new Error(xc[n]);if(this.header=new PJ,Vs.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Ih.string2buf(t.dictionary):AP.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Vs.inflateSetDictionary(this.strm,t.dictionary),n!==Oh)))throw new Error(xc[n])}function ay(e,t){const n=new Nh(t);if(n.push(e),n.err)throw n.msg||xc[n.err];return n.result}Nh.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let a,c,l;if(this.ended)return!1;for(c=t===~~t?t:t===!0?kJ:LJ,AP.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),a=Vs.inflate(n,c),a===sy&&i&&(a=Vs.inflateSetDictionary(n,i),a===Oh?a=Vs.inflate(n,c):a===OP&&(a=sy));n.avail_in>0&&a===oy&&n.state.wrap>0&&e[n.next_in]!==0;)Vs.inflateReset(n),a=Vs.inflate(n,c);switch(a){case MJ:case OP:case sy:case xJ:return this.onEnd(a),this.ended=!0,!1}if(l=n.avail_out,n.next_out&&(n.avail_out===0||a===oy))if(this.options.to==="string"){let u=Ih.utf8border(n.output,n.next_out),p=n.next_out-u,f=Ih.buf2string(n.output,u);n.next_out=p,n.avail_out=r-p,p&&n.output.set(n.output.subarray(u,u+p),0),this.onData(f)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(a!==Oh||l!==0){if(a===oy)return a=Vs.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},Nh.prototype.onData=function(e){this.chunks.push(e)},Nh.prototype.onEnd=function(e){e===Oh&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Lm.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var UJ={Inflate:Nh,inflate:ay,inflateRaw:function(e,t){return(t=t||{}).raw=!0,ay(e,t)},ungzip:ay,constants:hl};const{Deflate:eie,deflate:jJ,deflateRaw:tie,gzip:nie}=SJ,{Inflate:rie,inflate:VJ,inflateRaw:iie,ungzip:oie}=UJ;var FJ=jJ,BJ=VJ;const Hn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Ze(){return Hn}function NP(){return"setSinkId"in HTMLAudioElement.prototype&&(!L("RESTRICTION_SET_PLAYBACK_DEVICE")||(ha()||WN())&&!jT())}let xn=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function _l(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function et(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function io(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function cy(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const WJ={"90p":et(160,90),"90p_1":et(160,90),"120p":et(160,120,15,30,65),"120p_1":et(160,120,15,30,65),"120p_3":et(120,120,15,30,50),"120p_4":et(212,120),"180p":et(320,180,15,30,140),"180p_1":et(320,180,15,30,140),"180p_3":et(180,180,15,30,100),"180p_4":et(240,180,15,30,120),"240p":et(320,240,15,40,200),"240p_1":et(320,240,15,40,200),"240p_3":et(240,240,15,40,140),"240p_4":et(424,240,15,40,220),"360p":et(640,360,15,80,400),"360p_1":et(640,360,15,80,400),"360p_3":et(360,360,15,80,260),"360p_4":et(640,360,30,80,600),"360p_6":et(360,360,30,80,400),"360p_7":et(480,360,15,80,320),"360p_8":et(480,360,30,80,490),"360p_9":et(640,360,15,80,800),"360p_10":et(640,360,24,80,800),"360p_11":et(640,360,24,80,1e3),"480p":et(640,480,15,100,500),"480p_1":et(640,480,15,100,500),"480p_2":et(640,480,30,100,1e3),"480p_3":et(480,480,15,100,400),"480p_4":et(640,480,30,100,750),"480p_6":et(480,480,30,100,600),"480p_8":et(848,480,15,100,610),"480p_9":et(848,480,30,100,930),"480p_10":et(640,480,10,100,400),"720p":et(1280,720,15,120,1130),"720p_auto":et(1280,720,30,900,3e3),"720p_1":et(1280,720,15,120,1130),"720p_2":et(1280,720,30,120,2e3),"720p_3":et(1280,720,30,120,1710),"720p_5":et(960,720,15,120,910),"720p_6":et(960,720,30,120,1380),"1080p":et(1920,1080,15,120,2080),"1080p_1":et(1920,1080,15,120,2080),"1080p_2":et(1920,1080,30,120,3e3),"1080p_3":et(1920,1080,30,120,3150),"1080p_5":et(1920,1080,60,120,4780),"1440p":et(2560,1440,30,120,4850),"1440p_1":et(2560,1440,30,120,4850),"1440p_2":et(2560,1440,60,120,7350),"4k":et(3840,2160,30,120,8910),"4k_1":et(3840,2160,30,120,8910),"4k_3":et(3840,2160,60,120,13500)},Wm=[{scaleResolutionDownBy:2,width:1280,height:720,frameRate:30,bitrateMin:300,bitrateMax:900},{scaleResolutionDownBy:1.333333,width:1280,height:720,frameRate:30,bitrateMin:600,bitrateMax:2e3},{scaleResolutionDownBy:1,width:1280,height:720,frameRate:30,bitrateMin:900,bitrateMax:3e3}],GJ={"480p":io(640,480,5),"480p_1":io(640,480,5),"480p_2":io(640,480,30),"480p_3":io(640,480,15),"720p":io(1280,720,5),"720p_auto":et(1280,720,30,900,3e3),"720p_1":io(1280,720,5),"720p_2":io(1280,720,30),"720p_3":io(1280,720,15),"1080p":io(1920,1080,5),"1080p_1":io(1920,1080,5),"1080p_2":io(1920,1080,30),"1080p_3":io(1920,1080,15)},HJ={"1SL1TL":cy(1,1),"3SL3TL":cy(3,3),"2SL3TL":cy(2,3)};function fs(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},WJ[e]):e}function dy(e){return typeof e=="string"?Object.assign({},GJ[e]):e}function Gm(e){return typeof e=="string"?Object.assign({},HJ[e]):e}const KJ={speech_low_quality:_l(16e3,!1),speech_standard:_l(32e3,!1,18),music_standard:_l(48e3,!1),standard_stereo:_l(48e3,!0,56),high_quality:_l(48e3,!1,128),high_quality_stereo:_l(48e3,!0,192)};function Hm(e){return typeof e=="string"?Object.assign({},KJ[e]):e}const El=[];function DP(e){return Sn(e,"mediaSource",["screen","window","application"]),!0}let me=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Ot=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e}({}),gl=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),zJ=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),YJ=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e}({}),Wc=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Sl=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Tl=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),ci=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const ly={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},uy={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},PP={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},qJ={uplinkNetworkQuality:0,downlinkNetworkQuality:0},LP={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Tr=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),di=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Dh=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Gc=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),dr=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),ms=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const hy={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let Km=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function kP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ut(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?kP(Object(n),!0).forEach(function(r){X(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kP(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function X(e,t,n){return(t=function(r){var i=function(a,c){if(typeof a!="object"||a===null)return a;var l=a[Symbol.toPrimitive];if(l!==void 0){var u=l.call(a,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(r);return typeof i=="symbol"?i:String(i)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $e(e,t,n,r,i){var a,c,l={};return Object.keys(r).forEach(function(u){l[u]=r[u]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=yo(a=NY(c=n.slice()).call(c)).call(a,function(u,p){return p(e,t,u)||u},l),i&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(i):void 0,l.initializer=void 0),l.initializer===void 0&&(Object.defineProperty(e,t,l),l=null),l}class MP extends xt{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Wc.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),X(this,"trackMediaType",void 0),X(this,"_ID",void 0),X(this,"_rtpTransceiver",void 0),X(this,"_lowRtpTransceiver",void 0),X(this,"_hints",[]),X(this,"_isClosed",!1),X(this,"_originMediaStreamTrack",void 0),X(this,"mediaStreamTrack",void 0),X(this,"_external",{}),this._ID=n||Rt(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(r){ue(El).call(El,r)||El.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||fa(()=>{var n;Ce.reportApiInvoke(null,{name:un.GET_MEDIA_STREAM_TRACK,options:[],tag:Kt.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===gl.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=El.indexOf(t);n!==-1&&El.splice(n,1)}(this),this.emit(Sl.CLOSED),this.removeAllListeners(Wc.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===gl.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Wc.TRANSCEIVER_UPDATED,t,n)}}class vl extends MP{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),X(this,"_enabled",!0),X(this,"_muted",!1),X(this,"_isExternalTrack",!1),X(this,"_isClosed",!1),X(this,"_enabledMutex",void 0),X(this,"processor",void 0),X(this,"_processorContext",void 0),X(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new On("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,T.debug("[".concat(this.getTrackId(),"] close")),this.emit(me.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ct(this,me.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Sl.TRACK_ENDED)}stateCheck(t,n){if(T.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),Ns(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new J(O.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",T);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new J(O.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",T)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ce.resolve([])}}const xP=window.AudioContext||window.webkitAudioContext;let li=null;const Et=new class extends xt{constructor(){super(...arguments),X(this,"prevState",void 0),X(this,"curState",void 0),X(this,"currentTime",void 0),X(this,"currentTimeStuckAt",void 0),X(this,"interruptDetectorTrack",void 0),X(this,"onLocalAudioTrackMute",()=>{T.info("ios15-interruption-start"),this.emit(xn.IOS_15_16_INTERRUPTION_START)}),X(this,"onLocalAudioTrackUnmute",async()=>{T.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?T.info("ios15-interruption-end-canceled"):(li&&await li.suspend(),this.emit(xn.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){T.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){T.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function yl(){if(!li){if(function(){if(!xP)return void T.error("your browser is not support web audio");T.info("create audio context");const e=Ut({},L("WEBAUDIO_INIT_OPTIONS"));T.debug("audio context init option:",JSON.stringify(e)),li=new xP(e),Et.curState=li.state,li.onstatechange=()=>{Et.prevState=Et.curState,Et.curState=li?li.state:void 0;const{prevState:t,curState:n}=Et,r=n==="running",i=n==="interrupted",a=t==="running",c=t==="suspended",l=t==="interrupted",u=tt().osVersion;(Xn()||zi())&&a&&i&&(T.info("ios".concat(u,"-interruption-start")),Et.emit(xn.IOS_INTERRUPTION_START)),(Xn()||zi())&&(c||l)&&r&&(T.info("ios".concat(u,"-interruption-end")),Et.emit(xn.IOS_INTERRUPTION_END)),t!==n&&Et.emit(xn.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=(t=li)===null||t===void 0?void 0:t.currentTime;Et.currentTime!==n?(Et.currentTimeStuckAt&&(T.debug("AudioContext current time resume at ".concat(n)),Et.currentTimeStuckAt=void 0),Et.currentTime=n):(n!==Et.currentTimeStuckAt&&(Ce.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Kt.TRACER}).onSuccess(),T.warning("AudioContext current time stuck at ".concat(n))),Et.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,i=!1,a=!1,c=!1;function l(v){t.state==="running"?u(!1):Xn()||zi()?t.state==="suspended"&&(u(!0),v&&t.resume().then(p,p)):t.state!=="closed"&&(u(!0),v&&t.resume().then(p,p))}function u(v){if(i!==v){i=v;for(let y=0,b=n;y<b.length;y+=1){const D=b[y];v?window.addEventListener(D,f,{capture:!0,passive:!0}):window.removeEventListener(D,f,{capture:!0,passive:!0})}}}function p(){l(!1)}function f(){l(!0)}function m(v){if(!c)if(r.paused)if(v){let y;E(!1),c=!0;try{y=r.play(),y?y.then(S,S):(r.addEventListener("playing",S),r.addEventListener("abort",S),r.addEventListener("error",S))}catch{S()}}else E(!0);else E(!1)}function E(v){if(a!==v){a=v;for(let y=0,b=n;y<b.length;y++){const D=b[y];v?window.addEventListener(D,I,{capture:!0,passive:!0}):window.removeEventListener(D,I,{capture:!0,passive:!0})}}}function S(){r.removeEventListener("playing",S),r.removeEventListener("abort",S),r.removeEventListener("error",S),c=!1,m(!1)}function I(){m(!0)}if(Xn()){const v=t.createMediaStreamDestination(),y=document.createElement("div");y.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=y.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=v.stream,m(!0)}Et.on(xn.STATE_CHANGE,function(){l(!0)}),l(!1)}(li)}(),!li)throw new J(O.NOT_SUPPORTED,"can not create audio context");return li}return li}function Hc(e){if(function(){if(py!==null)return py;const r=yl(),i=r.createBufferSource(),a=r.createGain(),c=r.createGain();i.connect(a),i.connect(c),i.disconnect(a);let l=!1;try{i.disconnect(a)}catch{l=!0}return i.disconnect(),py=l,l}())return;const t=e.connect,n=e.disconnect;e.connect=(r,i,a)=>{var c;return e._inputNodes||(e._inputNodes=[]),ue(c=e._inputNodes).call(c,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,i,a)):t.call(e,r,i)),e},e.disconnect=(r,i,a)=>{n.call(e),r?rm(e._inputNodes,r):e._inputNodes=[];for(const c of e._inputNodes)t.call(e,c)}}let py=null;function fy(e,t){let n=!1;const r=1/t;if(L("DISABLE_WEBAUDIO")){const i=window.setInterval(()=>{n?window.clearInterval(i):e(performance.now()/1e3)},1e3*r)}else{const i=yl();let a=i.createGain();a.gain.value=0,a.connect(i.destination);const c=()=>{if(n)return void(a=null);const l=i.createOscillator();l.onended=c,l.connect(a),l.start(0),l.stop(i.currentTime+r),e(i.currentTime)};c()}return()=>{n=!0}}class UP{constructor(){X(this,"context",void 0),X(this,"analyserNode",void 0),X(this,"sourceNode",void 0),this.context=yl(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Xn()||zi()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let i=0;i<t.length;++i)t[i]=r[i]/128-1}const n=yo(t).call(t,(r,i)=>r+i*i,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{T.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class jP extends xt{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),X(this,"outputNode",void 0),X(this,"outputTrack",void 0),X(this,"isPlayed",!1),X(this,"sourceNode",void 0),X(this,"context",void 0),X(this,"audioBufferNode",void 0),X(this,"destNode",void 0),X(this,"audioOutputLevel",0),X(this,"volumeLevelAnalyser",void 0),X(this,"_processedNode",void 0),X(this,"playNode",void 0),X(this,"isDestroyed",!1),X(this,"onNoAudioInput",void 0),X(this,"isNoAudioInput",!1),X(this,"_noAudioInputCount",0),this.context=yl(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Hc(this.outputNode),this.volumeLevelAnalyser=new UP}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(ci.ON_AUDIO_BUFFER,function(r){for(let i=0;i<r.outputBuffer.numberOfChannels;i+=1){const a=r.outputBuffer.getChannelData(i);for(let c=0;c<a.length;c+=1)a[c]=0}return r.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ze().webAudioMediaStreamDest)throw new J(O.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&im(()=>{Et.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Xn()||zi()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let r;n.getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r));let i=!1;for(let a=0;a<r.length;a++)r[a]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await Rn(200),await this.checkHasAudioInput(t?t+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class VP extends jP{get isFreeze(){return!1}constructor(t,n,r){var i;if(super(),X(this,"sourceNode",void 0),X(this,"track",void 0),X(this,"clonedTrack",void 0),X(this,"audioElement",void 0),X(this,"isCurrentTrackCloned",!1),X(this,"isRemoteTrack",!1),X(this,"originVolumeLevelAnalyser",void 0),X(this,"rebuildWebAudio",async()=>{if(T.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void T.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>T.info("resume success")),T.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const l=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?l.stop():this.isCurrentTrackCloned=!0;const u=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(u),Hc(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const p=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(p,this.context.currentTime),Hc(this.outputNode),this.emit(ci.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=u,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new J(O.UNEXPECTED_ERROR);this.track=t;const a=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(a),Hc(this.sourceNode),r){const l=r.clone();l.enabled=!0,this.clonedTrack=l,T.debug("create an unmuted track ".concat(l.id," from the original track ").concat(r.id," to get the volume"));const u=this.context.createMediaStreamSource(new MediaStream([l]));Hc(u),this.originVolumeLevelAnalyser=new UP,this.originVolumeLevelAnalyser.updateSource(u)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=a;const c=tt();n&&c.os===yn.IOS&&Number((i=c.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(Et.on(xn.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(l=>{l||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),Hc(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ci.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Et.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),T.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const r=this.context.createMediaStreamSource(new MediaStream([n]));Hc(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function FP(e,t,n){const r=(a,c)=>a?typeof a!="number"?a.max||a.exact||a.ideal||a.min||c:a:c,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function JJ(e,t){const n=await BP(e.mediaSource),{sourceId:r,audio:i}=await function(a){let c=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ce((l,u)=>{const p=document.createElement("div");p.innerText="share screen",p.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const f=document.createElement("div");f.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const m=document.createElement("div");m.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",m.setAttribute("style","height: 12%;");const E=document.createElement("div");E.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const S=document.createElement("div");S.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const I=document.createElement("button");I.innerHTML="cancel",I.setAttribute("style","width: 85px;"),I.onclick=()=>{document.body.removeChild(b);const D=new Error("NotAllowedError");D.name="NotAllowedError",u(D)};let v=c;const y=document.createElement("div");if(c){const D=document.createElement("input");D.setAttribute("type","checkbox");const U=document.createElement("span");D.setAttribute("style","margin-right: 6px;"),U.innerText="Share audio",D.checked=v,D.onchange=()=>{v=D.checked},y.appendChild(D),y.appendChild(U)}S.appendChild(y),S.appendChild(I),f.appendChild(m),f.appendChild(E),f.appendChild(S);const b=document.createElement("div");b.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),b.appendChild(p),b.appendChild(f),document.body.appendChild(b),a.map(D=>{if(D.id){const U=document.createElement("div");U.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let F=D.thumbnail;try{const{width:W}=F.getSize();W>1920&&(F=F.resize({width:1920}))}catch(W){throw W&&W.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),W}U.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+F.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+D.name.replace(/[\u00A0-\u9999<>\&]/g,function(W){return"&#"+W.charCodeAt(0)+";"})+"</span>",U.onclick=()=>{document.body.removeChild(b),l({sourceId:D.id,audio:v})},E.appendChild(U)}})})}(n,t);return await FP(r,e,i)}async function BP(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=o1();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new J(O.ELECTRON_IS_NULL);let r=null;try{var i;r=((i=n.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new ce((a,c)=>{n.desktopCapturer.getSources({types:t},(l,u)=>{l?c(l):a(u)})}));try{return await r}catch(a){throw new J(O.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,a.toString())}}const my=new On("safari");let WP=!1,GP=!1;async function ui(e,t){let n=0,r=null;for(;n<2;)try{r=await XJ(e,t,n>0);break}catch(i){if(i instanceof J)throw T.error("[".concat(t,"] ").concat(i.toString())),i;const a=zm(i.name||i.code||i,i.message);if(a.code===O.MEDIA_OPTION_INVALID){T.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await Rn(500);continue}throw T.error("[".concat(t,"] ").concat(a.toString())),a}if(!r)throw new J(O.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function XJ(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new J(O.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=Ze(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return T.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(o1())e.screen.sourceId?Cl(i,await FP(e.screen.sourceId,e.screen,e.screenAudio)):Cl(i,await JJ(e.screen,e.screenAudio));else if(ha()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new J(O.NOT_SUPPORTED,"This browser does not support screen sharing");T.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const E=await(c=e.screen.extensionId,l=t,new ce((S,I)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},v=>{if(!v||!v.streamId)return T.error("[".concat(l,"] No response from Chrome Plugin. Plugin not installed properly"),v),void I(new J(O.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));S(v.streamId)})}catch(v){T.error("[".concat(l,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),v.toString()),I(new J(O.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=E,Cl(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var a;e.screen.mediaSource&&DP(e.screen.mediaSource);const E={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(a=e.screen.displaySurface)!==null&&a!==void 0?a:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:S,surfaceSwitching:I,systemAudio:v}=e.screen,y={selfBrowserSurface:S,surfaceSwitching:I,systemAudio:v};!S&&delete y.selfBrowserSurface,!I&&delete y.surfaceSwitching,!v&&delete y.systemAudio,T.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:E,audio:!!e.screenAudio,controls:y})),Cl(i,await navigator.mediaDevices.getDisplayMedia(Ut({video:E,audio:!!e.screenAudio},y)))}else{if(!yt())throw T.error("[".concat(t,"] This browser does not support screenSharing")),new J(O.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&DP(e.screen.mediaSource);const E={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};T.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(E))),Cl(i,await navigator.mediaDevices.getUserMedia(E))}}var c,l;if(!e.video&&!e.audio)return i;let u={video:e.video,audio:e.audio},p=L("MEDIA_DEVICE_CONSTRAINTS");if(p)try{typeof p=="string"&&(p=JSON.parse(p)),u=GT(u,p)}catch{}T.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(u)),tt();let f,m=null;(Cn()||Xn()||tm())&&(m=await my.lock());try{f=await navigator.mediaDevices.getUserMedia(u)}catch(E){throw m&&m(),E}return u.audio&&(WP=!0),u.video&&(GP=!0),Cl(i,f),m&&m(),i}function zm(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new J(O.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new J(O.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new J(O.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new J(O.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new J(O.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new J(O.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return T.error("getUserMedia unexpected error",e),new J(O.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Cl(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],a=t.getAudioTracks()[0];a&&(r&&e.removeTrack(r),e.addTrack(a)),i&&(n&&e.removeTrack(n),e.addTrack(i))}const hi=new class extends xt{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Gc.STATE_CHANGE,e),this._state=e)}constructor(){super(),X(this,"_state",Dh.IDLE),X(this,"isAccessMicrophonePermission",!1),X(this,"isAccessCameraPermission",!1),X(this,"lastAccessMicrophonePermission",!1),X(this,"lastAccessCameraPermission",!1),X(this,"checkdeviceMatched",!1),X(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(L("ENUMERATE_DEVICES_INTERVAL")||(nm()||em()===yn.HARMONY_OS)&&pa())&&this.updateDevicesInfo()},L("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>T.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new J(O.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let a=!this.isAccessMicrophonePermission&&e,c=!this.isAccessCameraPermission&&t;i.audio&&(a=!1),i.video&&(c=!1);let l=null,u=null,p=null;if(!n&&(a||c)){if(my.isLocked&&(T.debug("[device manager] wait GUM lock"),(await my.lock())(),T.debug("[device manager] GUM unlock")),WP&&(a=!1,this.isAccessMicrophonePermission=!0),GP&&(c=!1,this.isAccessCameraPermission=!0),T.debug("[device manager] check media device permissions",e,t,a,c),a&&c){try{p=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(f){const m=zm(f.name||f.code||f,f.message);if(m.code===O.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(a){try{l=await navigator.mediaDevices.getUserMedia({audio:e})}catch(f){const m=zm(f.name||f.code||f,f.message);if(m.code===O.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessMicrophonePermission=!0}else if(c){try{u=await navigator.mediaDevices.getUserMedia({video:t})}catch(f){const m=zm(f.name||f.code||f,f.message);if(m.code===O.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0}T.debug("[device manager] mic permission",e,"cam permission",t)}try{const f=await navigator.mediaDevices.enumerateDevices();return l&&l.getTracks().forEach(m=>m.stop()),u&&u.getTracks().forEach(m=>m.stop()),p&&p.getTracks().forEach(m=>m.stop()),l=null,u=null,p=null,f}catch(f){return l&&l.getTracks().forEach(m=>m.stop()),u&&u.getTracks().forEach(m=>m.stop()),p&&p.getTracks().forEach(m=>m.stop()),l=null,u=null,p=null,new J(O.ENUMERATE_DEVICES_FAILED,f.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new J(O.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Dh.INITING;try{await this.updateDevicesInfo(),this.state=Dh.INITEND}catch(e){throw T.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Dh.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new J(O.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const i=e.find(c=>c.kind==="audioinput"&&c.deviceId==="default"),a=e.find(c=>c.kind==="audiooutput"&&c.deviceId==="default");i&&a?a.groupId===i.groupId?T.debug("[device-check] default input ".concat(i.label," and output ").concat(a.label," is the same group")):T.warning("[device-check] default input ".concat(i.label," and output ").concat(a.label," is not the same group")):T.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(i=>{if(!i.deviceId)return;const a=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((a?a.state:"INACTIVE")!=="ACTIVE"){const c={initAt:t,updateAt:t,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),c),n.push(c)}a&&(a.updateAt=t)}),this.deviceInfoMap.forEach((i,a)=>{i.state==="ACTIVE"&&i.updateAt!==t&&(i.state="INACTIVE",n.push(i))}),this.state!==Dh.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Gc.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Gc.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Gc.PLAYOUT_DEVICE_CHANGED,i)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(i=>i.kind==="audioinput"),n=e.filter(i=>i.kind==="videoinput"),r={audio:!1,video:!1};for(const i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}};let _y=!1;const pi=new class extends xt{constructor(){super(...arguments),X(this,"onAutoplayFailed",void 0),X(this,"onAudioAutoplayFailed",void 0)}};function HP(){if(tt(),!_y){const e=t=>{t.preventDefault(),_y=!1,Xu()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};_y=!0,Xu()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),T.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),pi.onAutoplayFailed?pi.onAutoplayFailed():pi.onAudioAutoplayFailed?T.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):T.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),pi.emit("autoplay-failed")}}function KP(e,t,n,r){if(!e)return;const i=Ce.getBaseInfoBySessionId(e);if(!i)return;const a=i.info,c=Date.now(),l=Ut(Ut({},a),{},{vid:a.vid===void 0?0:Number(a.vid),lts:c,elapse:c-i.startTime,cbRegistered:pi.onAutoplayFailed||pi.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});Ce.send({type:Bt.AUTOPLAY_FAILED,data:l},!0)}const QJ=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Ir=new class{constructor(){X(this,"onAutoplayFailed",void 0),X(this,"elementMap",new Map),X(this,"elementStateMap",new Map),X(this,"elementsNeedToResume",[]),X(this,"sinkIdMap",new Map),X(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,r]=t;const i=this.elementStateMap.get(n),a=r.srcObject.getAudioTracks()[0],c=a&&a.readyState;if(T.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(c," ").concat(e)),c==="live"){if(e)return r.pause(),void r.play();if(Et.curState==="running")return zd()?(r.pause(),void r.play()):void(i&&i==="paused"&&r.play())}})}),X(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(T.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),Et.on(xn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Et.on(xn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Et.on(xn.STATE_CHANGE,()=>{Xn()&&Et.prevState==="suspended"&&Et.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(r){throw new J(O.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,dr.INIT),this.setVolume(t,n);const a=this.sinkIdMap.get(t);if(a)try{i.setSinkId(a).catch(l=>{T.warning("[".concat(t,"] set sink id failed"),l.toString())})}catch(l){T.warning("[".concat(t,"] set sink id failed"),l.toString())}const c=i.play();c&&c.then&&c.catch(l=>{r&&KP(r,"audio",l.message,t),T.warning("audio element play warning",l.toString()),this.elementMap.has(t)&&l.name==="NotAllowedError"&&(T.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),im(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),HP()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){QJ.forEach(n=>{t.addEventListener(n,r=>{const i=this.elementStateMap.get(e),a=r.type==="pause"?"paused":r.type;if(T.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(a)),r.type==="error"){const c=t==null?void 0:t.error;c&&T.error("[".concat(e,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(e,a)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{T.debug("Auto resume audio element success")}).catch(n=>{T.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new ce(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Xu()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function en(){return function(e,t,n){const r=n.value;return typeof r=="function"&&(n.value=function(){this._isClosed&&new J(O.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",T);for(var i=arguments.length,a=new Array(i),c=0;c<i;c++)a[c]=arguments[c];const l=r.apply(this,a);return l instanceof ce?new ce((u,p)=>{l.then(u).catch(p)}):l}),n}}class zP extends xt{constructor(t){super(),X(this,"name","VideoProcessorDestination"),X(this,"ID","0"),X(this,"_source",void 0),X(this,"videoContext",void 0),X(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new J(O.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new J(O.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(Tr.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Tr.ON_TRACK,void 0)}}class YP extends xt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),X(this,"constraintsMap",new Map),X(this,"statsRegistry",[]),X(this,"usageRegistry",[]),X(this,"trackId",void 0),X(this,"direction",void 0),X(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await hn(this,di.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var r;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Ct(this,di.REQUEST_UPDATE_CONSTRAINTS,Array.from(Io(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return T.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),Ct(this,di.REQUEST_UPDATE_CONSTRAINTS,Array.from(Io(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:i,cb:a}of this.statsRegistry)try{const c=a();t.push({processorID:n,processorName:r,type:i,stats:c})}catch(c){T.error(new J(O.UNEXPECTED_ERROR,c.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof ce&&(r=await r),t.push(Ut(Ut({},r),{},{direction:this.direction}))}catch(r){T.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class qP extends xt{constructor(t){super(),X(this,"name","AudioProcessorDestination"),X(this,"ID","0"),X(this,"inputTrack",void 0),X(this,"inputNode",void 0),X(this,"audioProcessorContext",void 0),X(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new J(O.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new J(O.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Tr.ON_TRACK,void 0),this.emit(Tr.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(Tr.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(Tr.ON_NODE,this.inputNode))}}class JP extends xt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,r){super(),X(this,"constraintsMap",new Map),X(this,"statsRegistry",[]),X(this,"audioContext",void 0),X(this,"trackId",void 0),X(this,"direction",void 0),X(this,"usageRegistry",[]),X(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=r}async getConstraints(){return hn(this,di.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var r;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Ct(this,di.REQUEST_UPDATE_CONSTRAINTS,Array.from(Io(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),Ct(this,di.REQUEST_UPDATE_CONSTRAINTS,Array.from(Io(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:i,cb:a}of this.statsRegistry)try{const c=a();t.push({processorID:n,processorName:r,type:i,stats:c})}catch(c){T.error(new J(O.UNEXPECTED_ERROR,c.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof ce&&(r=await r),t.push(Ut(Ut({},r),{},{direction:this.direction}))}catch(r){T.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class Ey extends xt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),X(this,"context",void 0),X(this,"processSourceNode",void 0),X(this,"outputTrack",void 0),X(this,"processedNode",void 0),X(this,"clonedTrack",void 0),X(this,"outputNode",void 0),this.outputNode=new ZJ}setVolume(){}createOutputTrack(){throw new J(O.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class ZJ{disconnect(){}connect(){}}function XP(e){return new ce((t,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const a=Xn()?"canplay":"playing";i.addEventListener(a,()=>{const c=i.videoWidth,l=i.videoHeight;!c&&yt()||(r=!0,i.srcObject=null,i.remove(),t([c,l]))}),i.srcObject=new MediaStream([e]),i.play().catch(om),setTimeout(()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))},4e3)})}function Ym(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=fs(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!ZN()&&n.frameRate&&(t.frameRate=n.frameRate),WN()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),yt()&&(t.frameRate={ideal:30,max:30}),t}function QP(e){const t={};if(ZN()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,ha()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){const n=Hm(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),nm()&&(t.sampleRate=void 0),t}const $J=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:r,height:i}=e.getMediaStreamTrackSettings();let{frameRate:a=n,width:c=r,height:l=i}=t;if(!a||!c||!l)return;c=HT(c),l=HT(l),a=HT(a);const{max:u,min:p}=function(S,I,v){const y=200*Math.pow(v/15,.6)*Math.pow(S*I/640/360,.75);return{min:Math.floor(y),max:Math.floor(4*y)}}(c,l,a),{bitrateMax:f,bitrateMin:m}=t||{};f||T.debug("calculate bitrate: [w: ".concat(c,", h: ").concat(l,", fps: ").concat(a,"] => [brMax: ").concat(f,", brMin: ").concat(m,"]"));const{maxFramerate:E}=L("ENCODER_CONFIG_LIMIT");return E&&typeof E=="number"&&(a=Math.min(a,E)),{frameRate:a,bitrateMax:f||u,bitrateMin:m||p,scaleResolutionDownBy:1,scale:0}},ZP=async(e,t,n)=>await(async(r,i,a)=>{const c=function(p){const f=[];for(let m=0;m<p.length;m+=2)f.push(parseInt(p.slice(m,m+2),16));return Uint8Array.from(f)}(E1(""+i+a)).slice(0,16),l=c.slice(0,12),u=await window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:l},u,r))})(e.buffer,t,n),gy=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new ce((n,r)=>{t.toBlob(async i=>{if(t.remove(),i){const a=await $P(i);n({buffer:a,width:t.width,height:t.height})}else r(new J(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},$P=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var eL,tL,nL,rL,iL,oL,sL,aL,cL,dL,lL,uL,hL,pL,fL,mL,_L,EL,Wt,gL,SL,TL,vL,yL,CL,_s,RL,wL,IL,bL,AL,OL,NL,DL,PL,LL,kL,ML,xL,Kn;let qt=(eL=Oe({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),tL=Oe({argsMap:(e,t)=>[e.getTrackId(),t]}),nL=en(),rL=Jd("LocalAudioTrack","_enabledMutex"),iL=Oe({argsMap:(e,t)=>[e.getTrackId(),t]}),oL=en(),sL=Jd("LocalAudioTrack","_enabledMutex"),aL=Oe({argsMap:(e,t)=>[e.getTrackId(),t]}),cL=en(),dL=en(),lL=en(),uL=Oe({argsMap:e=>[e.getTrackId()]}),hL=en(),pL=Oe({argsMap:e=>[e.getTrackId()]}),fL=en(),mL=Oe({argsMap:e=>[e.getTrackId()]}),_L=Oe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),EL=Oe({argsMap:e=>[e.getTrackId()]}),$e((Wt=class extends vl{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Ir.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),X(this,"trackMediaType","audio"),X(this,"_encoderConfig",void 0),X(this,"_trackSource",void 0),X(this,"_enabled",!0),X(this,"_volume",100),X(this,"_useAudioElement",!0),X(this,"_bypassWebAudio",!1),X(this,"processor",void 0),X(this,"_processorContext",void 0),X(this,"_processorDestination",void 0),X(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new Ey,L("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),L("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Cn()&&!li?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){St(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Ir.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void T.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,Ct(this,me.NEED_REPLACE_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{T.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!NP())throw new J(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ir.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Ct(this,me.NEED_ENABLE_TRACK,this),T.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw n||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Ct(this,me.NEED_DISABLE_TRACK,this)}catch(r){throw n||(this._enabled=!0),T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Ct(this,me.NEED_MUTE_TRACK,this):await Ct(this,me.NEED_UNMUTE_TRACK,this))}getStats(){return fa(()=>{T.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),zr(this,me.GET_STATS)||Ut({},ly)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ci.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ci.ON_AUDIO_BUFFER),this._source.on(ci.ON_AUDIO_BUFFER,n=>e(n))}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Ir.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Ir.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ir.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ct(this,me.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return ce.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new J(O.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new J(O.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(Tr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await Ct(this,me.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ct(this,me.NEED_REPLACE_TRACK,this))}),e.on(Tr.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Tr.ON_TRACK),e.removeAllListeners(Tr.ON_NODE)}bindProcessorContextEvents(e){e.on(di.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(di.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Ey&&(this._trackSource=new VP(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new JP(this._source.context,this.getTrackId(),"local"),t=new qP(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(ci.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Ir.stop(this.getTrackId()),this._source.play()),Ct(this,me.NEED_REPLACE_MIXING_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{T.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[eL],Object.getOwnPropertyDescriptor(Wt.prototype,"setVolume"),Wt.prototype),$e(Wt.prototype,"setPlaybackDevice",[tL,nL],Object.getOwnPropertyDescriptor(Wt.prototype,"setPlaybackDevice"),Wt.prototype),$e(Wt.prototype,"setEnabled",[rL,iL,oL],Object.getOwnPropertyDescriptor(Wt.prototype,"setEnabled"),Wt.prototype),$e(Wt.prototype,"setMuted",[sL,aL,cL],Object.getOwnPropertyDescriptor(Wt.prototype,"setMuted"),Wt.prototype),$e(Wt.prototype,"getStats",[dL],Object.getOwnPropertyDescriptor(Wt.prototype,"getStats"),Wt.prototype),$e(Wt.prototype,"setAudioFrameCallback",[lL],Object.getOwnPropertyDescriptor(Wt.prototype,"setAudioFrameCallback"),Wt.prototype),$e(Wt.prototype,"play",[uL,hL],Object.getOwnPropertyDescriptor(Wt.prototype,"play"),Wt.prototype),$e(Wt.prototype,"stop",[pL,fL],Object.getOwnPropertyDescriptor(Wt.prototype,"stop"),Wt.prototype),$e(Wt.prototype,"close",[mL],Object.getOwnPropertyDescriptor(Wt.prototype,"close"),Wt.prototype),$e(Wt.prototype,"pipe",[_L],Object.getOwnPropertyDescriptor(Wt.prototype,"pipe"),Wt.prototype),$e(Wt.prototype,"unpipe",[EL],Object.getOwnPropertyDescriptor(Wt.prototype,"unpipe"),Wt.prototype),Wt),qm=(gL=Oe({argsMap:(e,t)=>[e.getTrackId(),t]}),SL=en(),TL=Jd("MicrophoneAudioTrack","_enabledMutex"),vL=Oe({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),yL=en(),CL=Oe({argsMap:e=>[e.getTrackId()]}),$e((_s=class extends qt{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?Hm(t.encoderConfig):{},r,L("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),X(this,"_config",void 0),X(this,"_deviceName","default"),X(this,"_constraints",void 0),X(this,"_originalConstraints",void 0),X(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(zd()||UT())&&Et.bindInterruptDetectorTrack(this)}async setDevice(e){if(T.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await hi.getDeviceById(e),n={};n.audio=Ut({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await ui(n,this.getTrackId())}catch(i){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),i.toString()),r=await ui({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await hi.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}T.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return T.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),L("AUTO_RESET_AUDIO_ROUTE")&&(Xn()||zi())){const c=navigator.audioSession;c&&(e||(c.type="playback"),c.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),n||(this._enabled=!1);try{await Ct(this,me.NEED_DISABLE_TRACK,this)}catch(c){throw T.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}const i=Ut({},this._constraints),a=hi.searchDeviceIdByName(this._deviceName);a&&!i.deviceId&&(i.deviceId=a);try{n||(this._enabled=!0);const c=await ui({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await Ct(this,me.NEED_ENABLE_TRACK,this)}catch(c){throw n||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}T.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(zd()||UT())&&Et.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Xn()||zi())&&this._enabled&&!this._isClosed&&Et.duringInterruption){const e=async()=>{Et.off(xn.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Et.on(xn.IOS_INTERRUPTION_END,e)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Sl.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=hi.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const r=await ui({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(di.REQUEST_UPDATE_CONSTRAINTS,async(t,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(di.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[gL,SL],Object.getOwnPropertyDescriptor(_s.prototype,"setDevice"),_s.prototype),$e(_s.prototype,"setEnabled",[TL,vL,yL],Object.getOwnPropertyDescriptor(_s.prototype,"setEnabled"),_s.prototype),$e(_s.prototype,"close",[CL],Object.getOwnPropertyDescriptor(_s.prototype,"close"),_s.prototype),_s),eX=(RL=Oe({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),wL=en(),IL=Oe({argsMap:e=>[e.getTrackId()]}),bL=en(),AL=Oe({argsMap:e=>[e.getTrackId()]}),OL=en(),NL=Oe({argsMap:e=>[e.getTrackId()]}),DL=en(),PL=Oe({argsMap:e=>[e.getTrackId()]}),LL=en(),kL=Oe({argsMap:e=>[e.getTrackId()]}),ML=Oe({argsMap:e=>[e.getTrackId()]}),xL=en(),$e((Kn=class extends qt{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),X(this,"source",void 0),X(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(ci.AUDIO_SOURCE_STATE_CHANGE,i=>{this.safeEmit(Sl.SOURCE_STATE_CHANGE,i)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){St(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[RL,wL],Object.getOwnPropertyDescriptor(Kn.prototype,"startProcessAudioBuffer"),Kn.prototype),$e(Kn.prototype,"pauseProcessAudioBuffer",[IL,bL],Object.getOwnPropertyDescriptor(Kn.prototype,"pauseProcessAudioBuffer"),Kn.prototype),$e(Kn.prototype,"seekAudioBuffer",[AL,OL],Object.getOwnPropertyDescriptor(Kn.prototype,"seekAudioBuffer"),Kn.prototype),$e(Kn.prototype,"resumeProcessAudioBuffer",[NL,DL],Object.getOwnPropertyDescriptor(Kn.prototype,"resumeProcessAudioBuffer"),Kn.prototype),$e(Kn.prototype,"stopProcessAudioBuffer",[PL,LL],Object.getOwnPropertyDescriptor(Kn.prototype,"stopProcessAudioBuffer"),Kn.prototype),$e(Kn.prototype,"close",[kL],Object.getOwnPropertyDescriptor(Kn.prototype,"close"),Kn.prototype),$e(Kn.prototype,"setAudioBufferPlaybackSpeed",[ML,xL],Object.getOwnPropertyDescriptor(Kn.prototype,"setAudioBufferPlaybackSpeed"),Kn.prototype),Kn);class gn extends qt{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=yl().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Rt(8,"track-mix-")),X(this,"trackList",void 0),X(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(T.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):T.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){T.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}rm(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof gn?n.emit(Wc.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class tX extends jP{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(ci.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),X(this,"audioBuffer",void 0),X(this,"sourceNode",void 0),X(this,"startPlayTime",0),X(this,"startPlayOffset",0),X(this,"pausePlayTime",0),X(this,"options",void 0),X(this,"currentLoopCount",0),X(this,"currentPlaybackSpeed",100),X(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):T.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const UL=new Map;class Sy{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const t=this.renderStats.curTs-this.renderStats.lastTs,n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/t;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(T.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){X(this,"trackId",void 0),X(this,"config",void 0),X(this,"onFirstVideoFrameDecoded",void 0),X(this,"onVideoStateChanged",void 0),X(this,"freezeTimeCounterList",[]),X(this,"renderFreezeAccTime",0),X(this,"isKeepLastFrame",!1),X(this,"timeUpdatedCount",0),X(this,"freezeTime",0),X(this,"playbackTime",0),X(this,"lastTimeUpdatedTime",0),X(this,"autoplayFailed",!1),X(this,"videoTrack",void 0),X(this,"videoElement",void 0),X(this,"cacheVideoElement",void 0),X(this,"renderStats",void 0),X(this,"_videoState",ms.VideoStateStopped),X(this,"videoElementCheckInterval",void 0),X(this,"videoElementFreezeTimeout",void 0),X(this,"_videoElementStatus",dr.NONE),X(this,"isGettingVideoDimensions",!1),X(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return T.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),X(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Et.curState==="running"&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(BN())),XN()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),X(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=dr.PLAYING;break;case"loadeddata":if(this.videoState=ms.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=dr.CANPLAY;break;case"stalled":this.videoElementStatus=dr.STALLED;break;case"suspend":this.videoElementStatus=dr.SUSPEND;break;case"pause":this.videoElementStatus=dr.PAUSED,Xn()||zi()||Cn()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=dr.WAITING;break;case"abort":this.videoElementStatus=dr.ABORT;break;case"ended":this.videoElementStatus=dr.ENDED;break;case"emptied":this.videoElementStatus=dr.EMPTIED;break;case"error":{const r=this.videoElement.error;r?(this.videoElementStatus=dr.ERROR,T.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")"))):T.debug("[".concat(this.trackId,"] media not been an error."));break}case"timeupdate":{const r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);const i=r-this.lastTimeUpdatedTime,a=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,Fs.lastVisibleTime<Fs.lastHiddenTime||a<Fs.lastHiddenTime||a<Fs.lastVisibleTime)return;for(i>L("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;const c=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(c),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),X(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(BN())),XN()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Et.on(xn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Et.on(xn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(i=>{t&&KP(t,"video",i.message,this.trackId),i.name==="NotAllowedError"?(T.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):T.warning("[".concat(this.trackId,"] play warning: "),i)});const r=tt();if((r.name==="Safari"&&Number(r.version)===15||zd())&&n&&n.then){const i=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(i).catch(i)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return T.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height);return t.remove(),r}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,r.width,r.height),new ce((a,c)=>{r.toBlob(async l=>{if(r.remove(),l){const u=await $P(l);a({buffer:u,width:r.width,height:r.height})}else c(new J(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await gy(t)}destroy(){this.renderStats=void 0,Et.off(xn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Et.off(xn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=ms.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=dr.INIT,!this.videoElementCheckInterval&&(jL.forEach(a=>{this.videoElement.addEventListener(a,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(a){return a!==document.body&&document.body.contains(a)})(this.videoElement)||(this.videoElementStatus=dr.DESTROYED)},1e3),L("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let a;const c=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",c),this.videoElementFreezeTimeout=window.setTimeout(l,L("VIDEO_FREEZE_DURATION")))},l=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===ms.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=ms.VideoStateFrozen:document.addEventListener("visibilitychange",c))},u=(p,f)=>{if(this.videoElementStatus===dr.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=f.mediaTime):this.renderStats={lastTs:f.mediaTime,curTs:f.mediaTime,lastRenderNum:0,renderNum:0},a){const S=f.presentationTime-a.presentationTime;this.videoState===ms.VideoStateStarting&&(this.videoState=ms.VideoStateDecoding),this.videoState===ms.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(l,L("VIDEO_FREEZE_DURATION"))),S<L("VIDEO_FREEZE_DURATION")&&this.videoState===ms.VideoStateFrozen&&(this.videoState=ms.VideoStateDecoding),S>L("VIDEO_FREEZE_DURATION")&&Fs.lastVisibleTime>=Fs.lastHiddenTime&&a.timestamp>Fs.lastVisibleTime&&a.timestamp>Fs.lastHiddenTime&&(this.renderFreezeAccTime+=S)}a=Ut(Ut({},f),{},{timestamp:p})}var m,E;L("ENABLE_VIDEO_FRAME_CALLBACK")&&((m=(E=this.videoElement).requestVideoFrameCallback)===null||m===void 0||m.call(E,u))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,u)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),nm()&&!L("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const r=tt();r.name==="Safari"&&Number(r.version)===15||zd()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,yt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,yt()&&this.videoElement.load());const i=this.videoElement.play();i!==void 0&&i.catch(a=>{T.debug("[".concat(this.trackId,"] playback interrupted"),a.toString())})}resetVideoElement(){jL.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=dr.NONE}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{T.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{T.error(r)}),this.autoplayFailed=!1,Xu()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Xu()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),HP()}}const jL=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class VL extends Sy{constructor(t){super(t),X(this,"container",void 0),X(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,r):await gy(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",L("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var FL,BL,WL,GL,HL,KL,zL,YL,qL,JL,XL,QL,ZL,$L,ek,tk,nk,rk,ik,ok,sk,ak,ck,dk,lk,Xe,uk,hk,pk,fk,mk,_k,Ek,gk,fi;let wt=(FL=Oe({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),BL=en(),WL=Oe({argsMap:e=>[e.getTrackId()]}),GL=Jd("LocalVideoTrack","_enabledMutex"),HL=Oe({argsMap:(e,t)=>[e.getTrackId(),t]}),KL=en(),zL=Jd("LocalVideoTrack","_enabledMutex"),YL=Oe({argsMap:(e,t)=>[e.getTrackId(),t]}),qL=en(),JL=Oe({argsMap:(e,t)=>[e.getTrackId(),t]}),XL=en(),QL=en(),ZL=Oe({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),$L=en(),ek=en(),tk=en(),nk=en(),rk=en(),ik=en(),ok=en(),sk=Oe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),ak=Oe({argsMap:e=>[e.getTrackId()]}),ck=Oe({argsMap:e=>[e.getTrackId()]}),dk=Oe({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),lk=Oe(),Xe=class N5 extends vl{get videoHeight(){if(Cn()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Cn()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==dr.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,r,i,a,c){if(super(t,a),X(this,"trackMediaType","video"),X(this,"_player",void 0),X(this,"isUseScaleResolutionDownBy",!1),X(this,"_videoVisibleTimer",null),X(this,"_statsTimer",null),X(this,"_previousVideoVisibleStatus",void 0),X(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),X(this,"_encoderConfig",void 0),X(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),X(this,"_optimizationMode",void 0),X(this,"_videoHeight",void 0),X(this,"_videoWidth",void 0),X(this,"_forceBitrateLimit",void 0),X(this,"_enabled",!0),X(this,"_processorDestination",void 0),X(this,"_processorContext",void 0),Cn()){const{width:l,height:u}=t.getSettings();this._videoWidth=l,this._videoHeight=u}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=r,this._optimizationMode=i,this._hints=c||[],this._hints.indexOf(Ot.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(l,u,p){const f=tt();return!(f.name!==l||!f.osVersion)&&Number(f.version)===u}(lt.CHROME,115)&&em().indexOf("Windows")!==-1){const l=function(u,p){if("VideoFrame"in window&&"TransformStream"in window&&Ze().supportWebRTCInsertableStream){const f=new MediaStreamTrackProcessor(u),m=new MediaStreamTrackGenerator({kind:"video"});let E,S,I=Date.now();const v=()=>{y&&(clearInterval(y),y=void 0),E&&(E.close(),E=void 0),u.stop(),S=void 0,m.removeEventListener("ended",v)};let y=window.setInterval(()=>{if(S&&E&&Date.now()-I>1e3)try{m.readyState==="live"?S.enqueue(E.clone()):v()}catch{v()}},1e3);const b=new TransformStream({transform:(D,U)=>{m.readyState==="live"?(S=U,I=Date.now(),E===void 0?(E=D,U.enqueue(D.clone())):(U.enqueue(E),E=D)):D.close()}});return m.addEventListener("ended",v),f.readable.pipeThrough(b).pipeTo(m.writable),m}}(t);l&&(T.info("local screen video track begin to inject frame"),this._mediaStreamTrack=l)}n&&this._hints.indexOf(Ot.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new YP(this.getTrackId(),"local"),this._processorDestination=new zP(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const r=Ut(Ut(Ut({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new Sy(r):this._player=new VL(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(Sl.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},L("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._statsTimer&&(this.isUseScaleResolutionDownBy=!1,window.clearInterval(this._statsTimer),this._statsTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await Ct(this,me.NEED_DISABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return n||(this._enabled=!1),void T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Ct(this,me.NEED_ENABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Ct(this,me.NEED_MUTE_TRACK,this):await Ct(this,me.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,n){if(!this._enabled)throw new J(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),t=fs(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const r=Ym({encoderConfig:t});(Cn()||Xn()||zi())&&(r.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(i){const a=new J(O.UNEXPECTED_ERROR,i.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}}this._encoderConfig=t,this._hints.indexOf(Ot.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Ct(this,me.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(T)}}getStats(){return fa(()=>{T.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),zr(this,me.GET_STATS)||Ut({},uy)}async setBeautyEffect(t){T.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await gy(t)}async setBitrateLimit(t){if(T.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await Ct(this,me.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(T)}}}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void T.error(O.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await Ct(this,me.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=n,T.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}T.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return T.error(O.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,T.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){XP(this._originMediaStreamTrack).then(t=>{let[n,r]=t;this._videoHeight=r,this._videoWidth=n}).catch(om)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new J(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");T.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=fs(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Ot.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Ct(this,me.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(T)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!n||!r)return;const{bitrateMax:i,bitrateMin:a}=this._encoderConfig;if(a==null||i==null){const{max:c,min:l}=function(u,p,f,m,E){const S=L("BITRATE_ADAPTER_TYPE");if(S==="DEFAULT_BITRATE")return{min:m,max:E};if(E===void 0){var I;const y=Math.floor(200*Math.pow(f/15,.6)*Math.pow(u*p/640/360,.75));E=S==="STANDARD_BITRATE"?4*y:2*y,m=(I=m)!==null&&I!==void 0?I:y}else{var v;m=(v=m)!==null&&v!==void 0?v:Math.floor(E/10)}return{min:m,max:E}}(t,n,r,a,i);this._encoderConfig.bitrateMin=l,this._encoderConfig.bitrateMax=c,T.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(c,", brMin: ").concat(l,"]"))}}getVideoElementVisibleStatus(){try{var t,n;const r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:a,slot:c}=i;if(this.isPlaying&&a instanceof HTMLVideoElement&&c instanceof HTMLElement){const l=r1.checkOneElementVisible(a),u=Object.assign({},l);if(u.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=u.visible;const p=Ce.reportApiInvoke(null,{tag:Kt.TRACER,name:un.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});u.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(u.reason))}return u}return}catch(r){throw new J(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new J(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=Ut(Ut({},r),fs(t))),r=Ic(r);const i=Rt(8,"track-video-cloned-"),a=new N5(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,Ic(this._scalabilityMode),this._optimizationMode,i,Ic(this._hints));return t&&r&&a.setEncoderConfiguration(r),T.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),a}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new J(O.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new J(O.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}startMonitorStats(){if(!Cn()&&!Xn())return;this._statsTimer&&window.clearInterval(this._statsTimer);let t=2,n=Wm[t],r=-1,i=Date.now();const a=c=>{c>2||c<0||(i=Date.now(),n=Wm[c],this.setSenderConfiguration(n))};this.isUseScaleResolutionDownBy=!0,this._statsTimer=window.setInterval(()=>{const c=this.getStats(),l=zr(this,me.GET_RTC_STATS);if(c.sendPackets>0&&l){r===-1&&(r=Date.now());const u=Date.now();if(u-r<1e3||u-i<L("PROFILE_SWITCH_INTERVAL"))return;const p=c.sendFrameRate,f=.6*n.frameRate,m=.9*n.frameRate;typeof p=="number"&&p>0&&p<f?t>0&&(t--,a(t),T.debug("[".concat(this.getTrackId(),"] step down for fps ").concat(p,", switchProfile to ").concat(t))):l.OutgoingAvailableBandwidth<n.bitrateMin?t>0&&(t--,a(t),T.debug("[".concat(this.getTrackId(),"] step down for OutgoingAvailableBandwidth ").concat(l.OutgoingAvailableBandwidth,", bitrateMin ").concat(n.bitrateMin,", switchProfile to ").concat(t))):typeof p=="number"&&p>m&&t<Wm.length-1&&l.OutgoingAvailableBandwidth>1.2*Wm[t+1].bitrateMin&&(t++,a(t),T.debug("[".concat(this.getTrackId(),"] step up for fps ").concat(p,", OutgoingAvailableBandwidth ").concat(l.OutgoingAvailableBandwidth,", switchProfile to ").concat(t)))}},L("CHECK_LOCAL_STATS_INTERVAL"))}sendSeiData(t){if(fa(()=>{Ce.reportApiInvoke(null,{name:un.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Kt.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!L("ENABLE_VIDEO_SEI")||!L("ENABLE_ENCODED_TRANSFORM"))return void T.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new J(O.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void T.warning("Video track is not published, SEI can not be send");const r=n.sender.getParameters();if(r.codecs.length===0)return;const i=r.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"?this.safeEmit("sei-to-send",t):T.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(Tr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await Ct(this,me.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ct(this,me.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Tr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(di.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(di.REQUEST_CONSTRAINTS)}},$e(Xe.prototype,"play",[FL,BL],Object.getOwnPropertyDescriptor(Xe.prototype,"play"),Xe.prototype),$e(Xe.prototype,"stop",[WL],Object.getOwnPropertyDescriptor(Xe.prototype,"stop"),Xe.prototype),$e(Xe.prototype,"setEnabled",[GL,HL,KL],Object.getOwnPropertyDescriptor(Xe.prototype,"setEnabled"),Xe.prototype),$e(Xe.prototype,"setMuted",[zL,YL,qL],Object.getOwnPropertyDescriptor(Xe.prototype,"setMuted"),Xe.prototype),$e(Xe.prototype,"setEncoderConfiguration",[JL,XL],Object.getOwnPropertyDescriptor(Xe.prototype,"setEncoderConfiguration"),Xe.prototype),$e(Xe.prototype,"getStats",[QL],Object.getOwnPropertyDescriptor(Xe.prototype,"getStats"),Xe.prototype),$e(Xe.prototype,"setBeautyEffect",[ZL,$L],Object.getOwnPropertyDescriptor(Xe.prototype,"setBeautyEffect"),Xe.prototype),$e(Xe.prototype,"getCurrentFrameData",[ek],Object.getOwnPropertyDescriptor(Xe.prototype,"getCurrentFrameData"),Xe.prototype),$e(Xe.prototype,"getCurrentFrameImage",[tk],Object.getOwnPropertyDescriptor(Xe.prototype,"getCurrentFrameImage"),Xe.prototype),$e(Xe.prototype,"setBitrateLimit",[nk],Object.getOwnPropertyDescriptor(Xe.prototype,"setBitrateLimit"),Xe.prototype),$e(Xe.prototype,"setOptimizationMode",[rk],Object.getOwnPropertyDescriptor(Xe.prototype,"setOptimizationMode"),Xe.prototype),$e(Xe.prototype,"setScalabiltyMode",[ik],Object.getOwnPropertyDescriptor(Xe.prototype,"setScalabiltyMode"),Xe.prototype),$e(Xe.prototype,"updateMediaStreamTrackResolution",[ok],Object.getOwnPropertyDescriptor(Xe.prototype,"updateMediaStreamTrackResolution"),Xe.prototype),$e(Xe.prototype,"pipe",[sk],Object.getOwnPropertyDescriptor(Xe.prototype,"pipe"),Xe.prototype),$e(Xe.prototype,"unpipe",[ak],Object.getOwnPropertyDescriptor(Xe.prototype,"unpipe"),Xe.prototype),$e(Xe.prototype,"close",[ck],Object.getOwnPropertyDescriptor(Xe.prototype,"close"),Xe.prototype),$e(Xe.prototype,"replaceTrack",[dk],Object.getOwnPropertyDescriptor(Xe.prototype,"replaceTrack"),Xe.prototype),$e(Xe.prototype,"startMonitorStats",[lk],Object.getOwnPropertyDescriptor(Xe.prototype,"startMonitorStats"),Xe.prototype),Xe),Ty=(uk=Oe({argsMap:(e,t)=>[e.getTrackId(),t]}),hk=en(),pk=Jd("CameraVideoTrack","_enabledMutex"),fk=Oe({argsMap:(e,t)=>[e.getTrackId(),t]}),mk=en(),_k=Oe({argsMap:(e,t)=>[e.getTrackId(),t]}),Ek=en(),gk=Oe({argsMap:e=>[e.getTrackId()]}),fi=class D5 extends wt{get __className__(){return"CameraVideoTrack"}constructor(t,n,r,i,a,c){super(t,fs(n.encoderConfig),i,a,c),X(this,"_config",void 0),X(this,"_originalConstraints",void 0),X(this,"_constraints",void 0),X(this,"_enabled",!0),X(this,"_deviceName","default"),X(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(zd()||UT())&&!function(){const l=tt();if(l.os!==yn.IOS||!l.osVersion)return!1;const u=l.osVersion.split(".");return Number(u[0])===15&&Number(u[1])>=2}()&&QN()&&this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=r,this._constraints=r,this._deviceName=t.label,this._encoderConfig=fs(this._config.encoderConfig),Et.on(xn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Et.on(xn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(T.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await hi.getDeviceById(t),r={};r.video=Ut({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await ui(r,this.getTrackId())}catch(a){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),a.toString()),i=await ui({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await hi.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}T.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){T.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:Ut(Ut({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await ui(n,this.getTrackId())}catch(i){throw T.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),r=await ui({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Ut({},n.video),T.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const r=await ui({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await Ct(this,me.NEED_ENABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await Ct(this,me.NEED_DISABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new J(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),t=fs(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const r=At(this._config);r.encoderConfig=t;const i=Ym(r);(Cn()||Xn()||zi())&&(i.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(a){const c=new J(O.UNEXPECTED_ERROR,a.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=t,this._hints.indexOf(Ot.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Ct(this,me.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(T)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Xn()||zi())&&this._enabled&&!this._isClosed&&Et.duringInterruption){const t=async()=>{Et.off(xn.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Et.on(xn.IOS_INTERRUPTION_END,t)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Sl.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,r=hi.searchDeviceIdByName(this._deviceName);if(r&&!n.deviceId&&(n.deviceId={exact:r}),this._enabled){const i=await ui({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Et.off(xn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Et.off(xn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=Ut(Ut({},r),fs(t))),r=Ic(r);const i=Rt(8,"track-cam-cloned-"),a=new D5(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,Ic(Ut(Ut({},this._config),{},{encoderConfig:r})),Ic(this._constraints),Ic(this._scalabilityMode),this._optimizationMode,i);return t&&r&&a.setEncoderConfiguration(r),T.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),a}bindProcessorContextEvents(){this.processorContext.on(di.REQUEST_UPDATE_CONSTRAINTS,async(t,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}}),this.processorContext.on(di.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},$e(fi.prototype,"setDevice",[uk,hk],Object.getOwnPropertyDescriptor(fi.prototype,"setDevice"),fi.prototype),$e(fi.prototype,"setEnabled",[pk,fk,mk],Object.getOwnPropertyDescriptor(fi.prototype,"setEnabled"),fi.prototype),$e(fi.prototype,"setEncoderConfiguration",[_k,Ek],Object.getOwnPropertyDescriptor(fi.prototype,"setEncoderConfiguration"),fi.prototype),$e(fi.prototype,"close",[gk],Object.getOwnPropertyDescriptor(fi.prototype,"close"),fi.prototype),fi);function vy(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=Ut(Ut({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?T.debug("[".concat(e,"] set content hint to"),n.optimizationMode):T.debug("[".concat(e,"] set content hint failed")))):T.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var Sk,Tk,vk,yk,Ni,Ck,Rk,wk,Ik,bk,Ak,lr;class Ok extends MP{getUserId(){return this._userId}constructor(t,n,r,i){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(i.clientId,"_").concat(Rt(5,""))),X(this,"_userId",void 0),X(this,"_uintId",void 0),X(this,"_isDestroyed",!1),X(this,"store",void 0),X(this,"processor",void 0),X(this,"processorContext",void 0),this._userId=n,this._uintId=r,this.store=i}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,T.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Rl=(Sk=Oe({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Tk=Oe({argsMap:e=>[e.getTrackId()]}),vk=Oe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),yk=Oe({argsMap:e=>[e.getTrackId()]}),$e((Ni=class extends Ok{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==dr.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r){super(e,t,n,r),X(this,"_videoVisibleTimer",null),X(this,"_previousVideoVisibleStatus",void 0),X(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),X(this,"trackMediaType","video"),X(this,"_videoWidth",void 0),X(this,"_videoHeight",void 0),X(this,"_player",void 0),X(this,"processorDestination",void 0),X(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new YP(this.getTrackId(),"remote"),this.processorDestination=new zP(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return fa(()=>{T.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),zr(this,me.GET_STATS)||Ut({},LP)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const r=document.getElementById(e);r?e=r:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=Ut(Ut({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new Sy(n):this._player=new VL(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Tl.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=r=>{this.safeEmit(Tl.VIDEO_STATE_CHANGED,r)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(Tl.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},L("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){XP(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(om)}_updatePlayerSource(){T.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:i,slot:a}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&a instanceof HTMLElement){const c=r1.checkOneElementVisible(i),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const u=Ce.reportApiInvoke(null,{tag:Kt.TRACER,name:un.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?u.onSuccess("Video is visible"):u.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(n){throw new J(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new J(O.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Tr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Tr.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Wc.SEI_RECEIVED,e)}}).prototype,"play",[Sk],Object.getOwnPropertyDescriptor(Ni.prototype,"play"),Ni.prototype),$e(Ni.prototype,"stop",[Tk],Object.getOwnPropertyDescriptor(Ni.prototype,"stop"),Ni.prototype),$e(Ni.prototype,"pipe",[vk],Object.getOwnPropertyDescriptor(Ni.prototype,"pipe"),Ni.prototype),$e(Ni.prototype,"unpipe",[yk],Object.getOwnPropertyDescriptor(Ni.prototype,"unpipe"),Ni.prototype),Ni),wl=(Ck=Oe({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),Rk=Oe({argsMap:(e,t)=>[e.getTrackId(),t]}),wk=Oe({argsMap:e=>[e.getTrackId()]}),Ik=Oe({argsMap:e=>[e.getTrackId()]}),bk=Oe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Ak=Oe({argsMap:e=>[e.getTrackId()]}),$e((lr=class extends Ok{get isPlaying(){return this._useAudioElement?Ir.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),X(this,"trackMediaType","audio"),X(this,"_source",void 0),X(this,"_useAudioElement",!0),X(this,"_volume",100),X(this,"processorContext",void 0),X(this,"processorDestination",void 0),X(this,"_played",!1),X(this,"_bypassWebAudio",!1),L("DISABLE_WEBAUDIO")?(this._source=new Ey,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new VP(e,!0),L("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ci.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Tl.FIRST_FRAME_DECODED)}),this.processorContext=new JP(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new qP(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ci.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ci.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ci.ON_AUDIO_BUFFER),this._source.on(ci.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?Ir.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!NP())throw new J(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ir.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return fa(()=>{T.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),zr(this,me.GET_STATS)||Ut({},PP)}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] use audio element to play")),Ir.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Ir.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ir.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new J(O.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new J(O.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new J(O.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Tr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Tr.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Tr.ON_TRACK),this.processorDestination.removeAllListeners(Tr.ON_NODE)}}).prototype,"setVolume",[Ck],Object.getOwnPropertyDescriptor(lr.prototype,"setVolume"),lr.prototype),$e(lr.prototype,"setPlaybackDevice",[Rk],Object.getOwnPropertyDescriptor(lr.prototype,"setPlaybackDevice"),lr.prototype),$e(lr.prototype,"play",[wk],Object.getOwnPropertyDescriptor(lr.prototype,"play"),lr.prototype),$e(lr.prototype,"stop",[Ik],Object.getOwnPropertyDescriptor(lr.prototype,"stop"),lr.prototype),$e(lr.prototype,"pipe",[bk],Object.getOwnPropertyDescriptor(lr.prototype,"pipe"),lr.prototype),$e(lr.prototype,"unpipe",[Ak],Object.getOwnPropertyDescriptor(lr.prototype,"unpipe"),lr.prototype),lr);const Fs=new class extends xt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),X(this,"_lastHiddenTime",0),X(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),T.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};var Nk=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(Nk||{});class nX{constructor(){X(this,"_sequence",0),X(this,"_startTime",Date.now()),X(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const l=new Uint8Array(4);l.set([1,0,0,0]);const u={id:0,length:4,data:l.buffer},p={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[u]};n.commonPacketHeader.extension=1,n.extension=p,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;L("SHOW_DATASTREAM2_LOG")&&T.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const r=new ArrayBuffer(n.commonPacketHeader.length),i=new Uint8Array(r),a=new DataView(r);let c=0;if(a.setUint16(c,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),c+=2,a.setUint32(c,n.commonPacketHeader.sequence,!0),c+=4,a.setUint16(c,n.commonStreamHeader,!0),c+=2,n.extension){const l=this.serializeExtension(n.extension);i.set(new Uint8Array(l),c),c+=l.byteLength}if(i.set(new Uint8Array(n.payload),c),c+=n.payload.byteLength,c!==n.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let r=0;const i=n.getUint16(r,!0);r+=2;const a={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:n.getUint16(r+2,!0)<<16|n.getUint16(r,!0)};let c,l;if(r+=4,L("SHOW_DATASTREAM2_LOG")&&T.debug("receive data header: ".concat(JSON.stringify(a))),n.getUint16(r,!0),r+=2,a.extension){l=this.deserializeExtension(t.slice(r)),r+=2+l.length,c=t.slice(r);let u=!1;if(l.datas.length>0){const p=l.datas.find(f=>f.id===0);p&&(u=(1&new DataView(p.data).getUint32(0,!0))==1)}c=u?this.decompress(c):c}else c=t.slice(8);return c}serializeExtension(t){const{profile:n,length:r,datas:i}=t,a=new ArrayBuffer(r+2),c=new Uint8Array(a),l=new DataView(a);let u=0;if(l.setUint8(u++,n),l.setUint8(u++,r),i.forEach(p=>{n?(l.setUint8(u++,p.id),l.setUint8(u++,p.length),c.set(new Uint8Array(p.data),u),u+=p.data.byteLength):(l.setUint8(u++,p.id|p.length<<4),c.set(new Uint8Array(p.data),u),u+=p.data.byteLength)}),u!==r+2)throw Error("serialize extension error, is ".concat(u,"!==").concat(r+2));return a}deserializeExtension(t){const n=new DataView(t);let r=0;const i=n.getUint8(r);r++;const a=n.getUint8(r);r++;const c=i===Nk.TWO_BYTE,l=[],u=new DataView(t,2);let p=0;for(;p<a;){let f=0,m=0,E=new ArrayBuffer(0);c?(f=u.getUint8(p),p++,m=u.getUint8(p),p++):(f=15&u.getUint8(p),m=u.getUint8(p)>>4,p++),m>0&&(E=u.buffer.slice(p+2,p+2+m),p+=E.byteLength),l.push({id:f,length:m,data:E})}if(p!==a)throw Error("parse error");return{profile:i,length:a,datas:l}}decompress(t){return BJ(new Uint8Array(t))}compress(t){return FJ(new Uint8Array(t))}}class Dk extends xt{constructor(t,n){super(),X(this,"_version",1),X(this,"_type",3),X(this,"_config",void 0),X(this,"_originDataChannel",void 0),X(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),X(this,"_dataStreamPacketHandler",void 0),X(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader(),this._dataStreamPacketHandler=new nX}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return L("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ce((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const r=setTimeout(()=>{var i;n(new J(O.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new J(O.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new J(O.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[Km.OPEN,Km.CLOSE,Km.ERROR].forEach(n=>{const r=()=>{this.emit(n)};this._datachannelEventMap.set(n,r),t.addEventListener(n,r)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[r,i]=n;t.removeEventListener(r,i)}),this._datachannelEventMap.clear()}}class rX extends Dk{constructor(t){super(t),X(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const r=n.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(r).getUint8(3);if(i!==this.id)return void(L("SHOW_DATASTREAM2_LOG")&&T.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let a=n.data.slice(this._dataStreamPacketHeader.byteLength);a=this._dataStreamPacketHandler.deserialize(a),this.emit(Km.MESSAGE,a)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Pk extends Dk{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const r=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function Jm(){const e=new Blob([atob("ZnVuY3Rpb24gZShlKXtjb25zdCB0PW5ldyBEYXRhVmlldyhlLmRhdGEpO2lmKDA9PT10LmdldFVpbnQ4KDApJiYwPT09dC5nZXRVaW50OCgxKSYmMD09PXQuZ2V0VWludDgoMikmJjE9PT10LmdldFVpbnQ4KDMpJiY2PT09dC5nZXRVaW50OCg0KSl7bGV0IG49NixyPTAsbz0wO2Zvcig7MjU1PT09KG89dC5nZXRVaW50OChuKyspKTspcis9MjU1O3IrPW87Y29uc3QgYT1mdW5jdGlvbihlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLG89W10sYT0wO2Zvcig7YTxuOylhKzM8biYmMD09PXJbYV0mJjA9PT1yW2ErMV0mJjM9PT1yW2ErMl0mJigwPT09clthKzNdfHwxPT09clthKzNdfHwyPT09clthKzNdfHwzPT09clthKzNdKT8oby5wdXNoKHJbYV0sclthKzFdLHJbYSszXSksYSs9NCk6KG8ucHVzaChyW2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShvKX0oZS5kYXRhLG4scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGEpfXJldHVybiBudWxsfWZ1bmN0aW9uIHQoZSx0KXtjb25zdCBuPWZ1bmN0aW9uKGUpe2NvbnN0IHQ9ZS5sZW5ndGg7bGV0IG49W10scj0wO2Zvcig7cjx0OylyKzI8dCYmMD09PWVbcl0mJjA9PT1lW3IrMV0mJigwPT09ZVtyKzJdfHwxPT09ZVtyKzJdfHwyPT09ZVtyKzJdfHwzPT09ZVtyKzJdKT8obi5wdXNoKGVbcl0sZVtyKzFdLDMsZVtyKzJdKSxyKz0zKToobi5wdXNoKGVbcl0pLHIrKyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KG4pfSh0KSxyPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihyLzI1NSksYT1yJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK3IrZS5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBpPTA7Zm9yKDtpPG87KXNbNitpXT0yNTUsaSsrO3JldHVybiBzWzYraV09YSxpKysscy5zZXQobiw2K2kpLHMuc2V0KG5ldyBVaW50OEFycmF5KGUpLDYraStyKSxzLmJ1ZmZlcn1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIlNhZmFyaSIpPi0xJiYtMT09PW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiQ2hyb21lIikmJihzZWxmLm9ucnRjdHJhbnNmb3JtPW49Pntjb25zdCByPW4udHJhbnNmb3JtZXI7bGV0IG89W107ci5vcHRpb25zLnBvcnQub25tZXNzYWdlPWU9PntlLmRhdGEuc2VpJiZvLnB1c2goZS5kYXRhLnNlaSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBhPXIucmVhZGFibGUuZ2V0UmVhZGVyKCkscz1yLndyaXRhYmxlLmdldFdyaXRlcigpOyJyeCI9PT1yLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2EucmVhZCgpLnRoZW4oKHI9PntpZighci5kb25lKXtpZihyLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7YS5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1vLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>WD.revokeObjectURL(e),0),new Worker(WD.createObjectURL(e))}const Xm=new Map,Qm=new Map,Zm=new Map;async function iX(e,t){if(!Ze().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(Zm.has(e)||!e.track)return;const n={track:e.track};if(ha()){if(!e.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(l){return void T.error("create video-encoded-streams error",l&&l.message)}let a=[];t.on("sei-to-send",l=>{a.push(l)});const c=new TransformStream({transform(l,u){n.controller||(n.controller=u),e.track&&e.track.id!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const p=a.shift();p&&(l.data=function(f,m){const E=function(D){const U=D.length;let F=[],W=0;for(;W<U;)W+2<U&&D[W]===0&&D[W+1]===0&&(D[W+2]===0||D[W+2]===1||D[W+2]===2||D[W+2]===3)?(F.push(D[W],D[W+1],3,D[W+2]),W+=3):(F.push(D[W]),W++);return new Uint8Array(F)}(m),S=E.length,I=Math.floor(S/255),v=S%255,y=new Uint8Array(6+I+1+S+f.byteLength);y[0]=0,y[1]=0,y[2]=0,y[3]=1,y[4]=6,y[5]=101;let b=0;for(;b<I;)y[6+b]=255,b++;return y[6+b]=v,b++,y.set(E,6+b),y.set(new Uint8Array(f),6+b+S),y.buffer}(l.data,p)),u.enqueue(l)}});i.readable.pipeThrough(c).pipeTo(i.writable)}else{if(!Cn())return;{if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const i=Jm(),a=new MessageChannel;await new ce(l=>i.onmessage=u=>{u.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(i,{name:"tx",port:a.port2},[a.port2]);e.transform=c,await new ce(l=>i.onmessage=u=>{u.data==="started"&&l(void 0)}),t.on("sei-to-send",l=>{a.port1.postMessage({sei:l})}),a.port1.onmessage=l=>{var u;l.data.transformed&&e.track&&((u=e.track)===null||u===void 0?void 0:u.id)!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r))},n.worker=i}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=Zm.get(e);if(i){Zm.delete(e);try{var a,c;(a=i.controller)===null||a===void 0||a.terminate(),(c=i.worker)===null||c===void 0||c.terminate()}catch(l){T.warning(l&&l.message)}}}Zm.set(e,n),e.track.addEventListener("ended",r)}const Ph=new Map;async function oX(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ze().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(!e.track)return;if(Ph.has(e)){const i=Ph.get(e);return void(i&&(i.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(ha()){if(!e.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(c){return void T.error("create video-encoded-streams error",c&&c.message)}const a=new TransformStream({transform(c,l){n.controller||(n.controller=l),e.track&&e.track.id!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const u=function(p){const f=new DataView(p.data);if(f.getUint8(0)===0&&f.getUint8(1)===0&&f.getUint8(2)===0&&f.getUint8(3)===1&&f.getUint8(4)===6){let m=6,E=0,S=0;for(;(S=f.getUint8(m++))===255;)E+=255;E+=S;const I=function(v,y,b){let D=new Uint8Array(v,y,b),U=[],F=0;for(;F<b;)F+3<b&&D[F]===0&&D[F+1]===0&&D[F+2]===3&&(D[F+3]===0||D[F+3]===1||D[F+3]===2||D[F+3]===3)?(U.push(D[F],D[F+1],D[F+3]),F+=4):(U.push(D[F]),F++);return new Uint8Array(U)}(p.data,m,E);return new Uint8Array(I)}return null}(c);u&&n.onSei&&n.onSei(u),l.enqueue(c)}});i.readable.pipeThrough(a).pipeTo(i.writable)}else if(Cn()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const i=Jm(),a=new MessageChannel;await new ce(l=>i.onmessage=u=>{u.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(i,{name:"rx",port:a.port2},[a.port2]);e.transform=c,await new ce(l=>i.onmessage=u=>{u.data==="started"&&l(void 0)}),a.port1.onmessage=l=>{var u;l.data.transformed&&e.track&&((u=e.track)===null||u===void 0?void 0:u.id)!==n.track.id?(T.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):l.data.sei&&n.onSei&&n.onSei(l.data.sei)},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}(function(i){const a=Ph.get(i);if(a){Ph.delete(i);try{var c,l;(c=a.controller)===null||c===void 0||c.terminate(),(l=a.worker)===null||l===void 0||l.terminate()}catch(u){T.warning(u&&u.message)}}})(e)}Ph.set(e,n),e.track.addEventListener("ended",r)}(function(){const e=tt();Hn.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Hn.getStreamFromExtension=e.name===lt.CHROME&&Number(e.version)>34,Hn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),Hn.supportMinBitrate=e.name===lt.CHROME||e.name===lt.EDGE,Hn.supportSetRtpSenderParameters=function(){const t=tt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!pa()||!(!Cn()&&!tm())||t.name===lt.FIREFOX&&Number(t.version)>=64)}(),e.name===lt.SAFARI&&(Number(e.version)>=14?Hn.supportDualStream=!0:Hn.supportDualStream=!1),Hn.webAudioMediaStreamDest=function(){const t=tt();return!(t.name===lt.SAFARI&&Number(t.version)<12)}(),Hn.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Hn.supportWebGL=typeof WebGLRenderingContext<"u",Hn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,pa()||(Hn.webAudioWithAEC=!0),Hn.supportShareAudio=function(){const t=tt();return(t.os===yn.WIN_10||t.os===yn.WIN_81||t.os===yn.WIN_7||t.os===yn.LINUX||t.os===yn.MAC_OS||t.os===yn.CHROMIUM_OS)&&t.name===lt.CHROME&&Number(t.version)>=74}(),Hn.supportDataChannel=!!(xT(76)||function(t){const n=tt();return!(n.name!==lt.FIREFOX||!n.osVersion)&&Number(n.version)>=t}(68)||HN(14)),Hn.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!yt()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Hn.supportWebRTCEncodedTransform=function(){const t=tt();return t.name==="Chrome"&&Number(t.version)>=86||t.name==="Safari"&&Number(t.version)>=15}(),Hn.supportWebRTCInsertableStream=function(){const t=tt();return(t.name===lt.CHROME||t.name===lt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Hn.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Hn.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,im(()=>{Hn.supportDualStreamEncoding=function(){const t=tt();return!!L("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&L("CHROME_DUAL_STREAM_USE_ENCODING"))}(),T.info("browser compatibility",JSON.stringify(Hn),JSON.stringify(e))})})();class sX extends xt{constructor(){super(...arguments),w(this,"resultStorage",new Map)}setLocalAudioStats(t,n,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,n))}setLocalVideoStats(t,n,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r))}setRemoteAudioStats(t,n){const r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(n))}record(t,n,r){if(L("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const i=this.resultStorage.get(t);if(i&&(i.result.push(r),i.result.length>=5)){var a;const c=ue(a=i.result).call(a,!0);i.isPrevNormal&&!c&&this.emit("exception",Lk[t],t,n),!i.isPrevNormal&&c&&this.emit("exception",Lk[t]+2e3,t+"_RECOVER",n),i.isPrevNormal=c,i.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof gn&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let r=null;n._encoderConfig&&n._encoderConfig.frameRate&&(r=Lr(n._encoderConfig.frameRate));const i=t.captureFrameRate;return!r||!i||!(r>10&&i<5||r<10&&r>=5&&i<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof gn&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const Lk={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Zn=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function yy(e,t){this.v=e,this.k=t}function Be(e){return new yy(e,0)}var aX=gb,cX=ts;bt({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=cX.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var dX=ts,lX=Pd;bt({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=dX.f(this),n=lX(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var Cy=_(aX),kk=Ud.f("asyncIterator"),uX=_(kk);function Lh(e){var t,n;function r(a,c){try{var l=e[a](c),u=l.value,p=u instanceof yy;Cy.resolve(p?u.v:u).then(function(f){if(p){var m=a==="return"?"return":"next";if(!u.k||f.done)return r(m,f);f=e[m](f).value}i(l.done?"return":"normal",f)},function(f){r("throw",f)})}catch(f){i("throw",f)}}function i(a,c){switch(a){case"return":t.resolve({value:c,done:!0});break;case"throw":t.reject(c);break;default:t.resolve({value:c,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(a,c){return new Cy(function(l,u){var p={key:a,arg:c,resolve:l,reject:u,next:null};n?n=n.next=p:(t=n=p,r(a,c))})},typeof e.return!="function"&&(this.return=void 0)}function qr(e){return function(){return new Lh(e.apply(this,arguments))}}Lh.prototype[typeof Fd=="function"&&uX||"@@asyncIterator"]=function(){return this},Lh.prototype.next=function(e){return this._invoke("next",e)},Lh.prototype.throw=function(e){return this._invoke("throw",e)},Lh.prototype.return=function(e){return this._invoke("return",e)};var Mk=_(vo.Object.getOwnPropertySymbols),hX=bt,pX=Cg.indexOf,fX=Zp,Ry=dt([].indexOf),xk=!!Ry&&1/Ry([1],1,-0)<0;hX({target:"Array",proto:!0,forced:xk||!fX("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return xk?Ry(this,e,t)||0:pX(this,e,t)}});var mX=Gi("Array").indexOf,_X=G,EX=mX,wy=Array.prototype,gX=function(e){var t=e.indexOf;return e===wy||_X(wy,e)&&t===wy.indexOf?EX:t},Uk=_(gX);function SX(e,t){if(e==null)return{};var n,r,i=function(c,l){if(c==null)return{};var u,p,f={},m=A1(c);for(p=0;p<m.length;p++)u=m[p],Uk(l).call(l,u)>=0||(f[u]=c[u]);return f}(e,t);if(Mk){var a=Mk(e);for(r=0;r<a.length;r++)n=a[r],Uk(t).call(t,n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var jk={exports:{}};(function(e,t){e.exports=(()=>{var n={8:(a,c,l)=>{l.r(c),l.d(c,{Parser:()=>Qe,Printer:()=>uo,parse:()=>Me,print:()=>st});const u=`
`,p="".concat("\r").concat(u),f=" ";let m;function E(de){return de>="0"&&de<="9"}function S(de){return de>="!"&&de<="~"}function I(de){return S(de)||de>=""&&de<="ÿ"}function v(de){return de==="!"||de>="#"&&de<="'"||de>="*"&&de<="+"||de>="-"&&de<="."||de>="0"&&de<="9"||de>="A"&&de<="Z"||de>="^"&&de<="~"}function y(de){return de>="1"&&de<="9"}function b(de){return de>="A"&&de<="Z"||de>="a"&&de<="z"}function D(de){return de==="d"||de==="h"||de==="m"||de==="s"}function U(de){return de>""&&de<"	"||de>"\v"&&de<"\f"||de>""&&de<"ÿ"}function F(de){return b(de)||E(de)||de==="+"||de==="/"}function W(de){return E(de)||b(de)||de==="+"||de==="/"||de==="-"||de==="_"}function q(de){return b(de)||E(de)||de==="+"||de==="/"}function Q(de,R){var k=Object.keys(de);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(de);R&&(x=x.filter(function(ie){return Object.getOwnPropertyDescriptor(de,ie).enumerable})),k.push.apply(k,x)}return k}function ee(de){for(var R=1;R<arguments.length;R++){var k=arguments[R]!=null?arguments[R]:{};R%2?Q(Object(k),!0).forEach(function(x){ne(de,x,k[x])}):Object.getOwnPropertyDescriptors?Object.defineProperties(de,Object.getOwnPropertyDescriptors(k)):Q(Object(k)).forEach(function(x){Object.defineProperty(de,x,Object.getOwnPropertyDescriptor(k,x))})}return de}function ne(de,R,k){return R in de?Object.defineProperty(de,R,{value:k,enumerable:!0,configurable:!0,writable:!0}):de[R]=k,de}(function(de){de.VERSION="v",de.ORIGIN="o",de.SESSION_NAME="s",de.INFORMATION="i",de.URI="u",de.EMAIL="e",de.PHONE="p",de.CONNECTION="c",de.BANDWIDTH="b",de.TIME="t",de.REPEAT="r",de.ZONE_ADJUSTMENTS="z",de.KEY="k",de.ATTRIBUTE="a",de.MEDIA="m"})(m||(m={}));class _e{consumeText(R,k){let x=k;for(;x<R.length;){const ie=R[x];if(ie==="\0"||ie==="\r"||ie===u)break;x+=1}if(x-k==0)throw new Error("Invalid text, at ".concat(R));return x}consumeUnicastAddress(R,k,x){return this.consumeTill(R,k,f)}consumeOneOrMore(R,k,x){let ie=k;for(;x(R[ie]);)ie++;if(ie-k==0)throw new Error("Invalid rule at ".concat(k,"."));return ie}consumeSpace(R,k){if(R[k]===f)return k+1;throw new Error("Invalid space at ".concat(k,"."))}consumeIP4Address(R,k){let x=k;for(let ie=0;ie<4;ie++)if(x=this.consumeDecimalUChar(R,x),ie!==3){if(R[x]!==".")throw new Error("Invalid IP4 address.");x++}return x}consumeDecimalUChar(R,k){let x=k;for(let xe=0;xe<3&&E(R[x]);xe++,x++);if(x-k==0)throw new Error("Invalid decimal uchar.");const ie=parseInt(R.slice(k,x));if(ie>=0&&ie<=255)return x;throw new Error("Invalid decimal uchar")}consumeIP6Address(R,k){let x=this.consumeHexpart(R,k);return R[x]===":"&&(x+=1,x=this.consumeIP4Address(R,x)),x}consumeHexpart(R,k){let x=k;if(R[x]===":"&&R[x+1]===":"){x+=2;try{x=this.consumeHexseq(R,x)}catch{}return x}if(x=this.consumeHexseq(R,x),R[x]===":"&&R[x+1]===":"){x+=2;try{x=this.consumeHexseq(R,x)}catch{}return x}return x}consumeHexseq(R,k){let x=k;for(;x=this.consumeHex4(R,x),R[x]===":"&&R[x+1]!==":";)x+=1;return x}consumeHex4(R,k){let x=0;for(;x<4;x++)if(!((ie=R[k+x])>="0"&&ie<="9"||ie>="a"&&ie<="f"||ie>="A"&&ie<="F")){if(x===0)throw new Error("Invalid hex 4");break}var ie;return k+x}consumeFQDN(R,k){let x=k;for(;E(R[x])||b(R[x])||R[x]==="-"||R[x]===".";)x+=1;if(x-k<4)throw new Error("Invalid FQDN");return x}consumeExtnAddr(R,k){return this.consumeOneOrMore(R,k,I)}consumeMulticastAddress(R,k,x){switch(x){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(R,k);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(R,k);default:try{return this.consumeFQDN(R,k)}catch{return this.consumeExtnAddr(R,k)}}}consumeIP6MulticastAddress(R,k){const x=this.consumeHexpart(R,k);return R[x]==="/"?this.consumeInteger(R,x+1):x}consumeIP4MulticastAddress(R,k){let x=k+3;const ie=R.slice(k,x),xe=parseInt(ie);if(xe<224||xe>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let gt=0;gt<3;gt++){if(R[x]!==".")throw new Error("Invalid IP4 multicast address.");x+=1,x=this.consumeDecimalUChar(R,x)}return R[x]==="/"&&(x+=1),x=this.consumeTTL(R,x),R[x]==="/"&&(x=this.consumeInteger(R,x)),x}consumeInteger(R,k){if(!y(R[k]))throw new Error("Invalid integer.");for(k+=1;E(R[k]);)k+=1;return k}consumeTTL(R,k){if(R[k]==="0")return k+1;if(!y(R[k]))throw new Error("Invalid TTL.");k+=1;for(let x=0;x<2&&E(R[k]);x++)k+=1;return k}consumeToken(R,k){return this.consumeOneOrMore(R,k,v)}consumeTime(R,k){let x=k;if(R[x]==="0")return x+1;for(y(R[x])&&(x+=1);E(R[x]);)x++;if(x-k<10)throw new Error("Invalid time");return x}consumeAddress(R,k){return this.consumeTill(R,k,f)}consumeTypedTime(R,k){let x=k;return x=this.consumeOneOrMore(R,x,E),D(R[x])?x+1:x}consumeRepeatInterval(R,k){if(!y(R[k]))throw new Error("Invalid repeat interval");for(k+=1;E(R[k]);)k+=1;return D(R[k])&&(k+=1),k}consumePort(R,k){return this.consumeOneOrMore(R,k,E)}consume(R,k,x){for(let ie=0;ie<x.length;ie++){if(k+ie>=R.length)throw new Error("consume exceeding value length");if(R[k+ie]!==x[ie])throw new Error("consume ".concat(x," failed at ").concat(ie))}return k+x.length}consumeTill(R,k,x){let ie=k;for(;ie<R.length&&(typeof x!="string"||R[ie]!==x)&&(typeof x!="function"||!x(R[ie]));)ie++;return ie}}class Qe extends _e{constructor(){super(),ne(this,"records",[]),ne(this,"currentLine",0)}parse(R){const k=this.probeEOL(R);this.records=R.split(k).filter(mn=>!!sr(mn).call(mn)).map(this.parseLine),this.currentLine=0;const x=this.parseVersion(),ie=this.parseOrigin(),xe=this.parseSessionName(),gt=this.parseInformation(),Tn=this.parseUri(),Ur=this.parseEmail(),Gs=this.parsePhone(),y_=this.parseConnection(),C_=this.parseBandWidth(),ki=this.parseTimeFields(),ja=this.parseKey(),kl=this.parseSessionAttribute(),tn=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:x,origin:ie,sessionName:xe,information:gt,uri:Tn,emails:Ur,phones:Gs,connection:y_,bandwidths:C_,timeFields:ki,key:ja,attributes:kl,mediaDescriptions:tn}}getCurrentRecord(){const R=this.records[this.currentLine];if(!R)throw new Error("Record doesn't exit.");return R}probeEOL(R){for(let k=0;k<R.length;k++)if(R[k]===u)return R[k-1]==="\r"?p:u;throw new Error("Invalid newline character.")}parseLine(R,k){if(R.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const x=R[0];if(R[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:x,value:R.slice(2),line:k,cur:0}}parseSessionAttribute(){const R=new Nt;for(;this.currentLine<this.records.length;){const k=this.getCurrentRecord();if(k.type!==m.ATTRIBUTE)break;const x={attField:this.extractOneOrMore(k,ie=>v(ie)&&ie!==":"),_cur:0};k.value[k.cur]===":"&&(k.cur+=1,x.attValue=this.extractOneOrMore(k,U)),R.parse(x),this.currentLine++}return R.digest()}parseMediaAttributes(R){const k=new dn(R);for(;this.currentLine<this.records.length;){const x=this.getCurrentRecord();if(x.type!==m.ATTRIBUTE)break;const ie={attField:this.extractOneOrMore(x,xe=>v(xe)&&xe!==":"),_cur:0};x.value[x.cur]===":"&&(x.cur+=1,ie.attValue=this.extractOneOrMore(x,U)),k.parse(ie),this.currentLine++}return k.digest()}parseKey(){const R=this.getCurrentRecord();if(R.type===m.KEY){if(R.value==="prompt"||R.value==="clear:"||R.value==="base64:"||R.value==="uri:")return R.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const R=this.getCurrentRecord();if(R.type===m.ZONE_ADJUSTMENTS){const k=[];for(;;)try{const x=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);let ie=!1;R.value[R.cur]==="-"&&(ie=!0,R.cur+=1);const xe=this.extract(R,this.consumeTypedTime);k.push({time:x,typedTime:xe,back:ie})}catch{break}if(k.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,k}return[]}parseRepeat(){const R=[];for(;;){const k=this.getCurrentRecord();if(k.type!==m.REPEAT)break;{const x=this.extract(k,this.consumeRepeatInterval),ie=this.parseTypedTime(k);R.push({repeatInterval:x,typedTimes:ie}),this.currentLine++}}return R}parseTypedTime(R){const k=[];for(;;)try{this.consumeSpaceForRecord(R),k.push(this.extract(R,this.consumeTypedTime))}catch{break}if(k.length===0)throw new Error("Invalid typed time.");return k}parseTime(){const R=this.getCurrentRecord(),k=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);const x=this.extract(R,this.consumeTime);return this.currentLine++,{startTime:k,stopTime:x}}parseBandWidth(){const R=[];for(;this.currentLine<this.records.length;){const k=this.getCurrentRecord();if(k.type!==m.BANDWIDTH)break;{const x=this.extractOneOrMore(k,v);if(k.value[k.cur]!==":")throw new Error("Invalid bandwidth field.");k.cur++;const ie=this.extractOneOrMore(k,E);R.push({bwtype:x,bandwidth:ie}),this.currentLine++}}return R}parseVersion(){const R=this.getCurrentRecord();if(R.type!==m.VERSION)throw new Error("first sdp record must be version");const k=R.value.slice(0,this.consumeOneOrMore(R.value,0,E));if(k.length!==R.value.length)throw new Error('invalid proto version, "v='.concat(R.value,'"'));return this.currentLine++,k}parseOrigin(){const R=this.getCurrentRecord();if(R.type!==m.ORIGIN)throw new Error("second line of sdp must be origin");const k=this.extractOneOrMore(R,I);this.consumeSpaceForRecord(R);const x=this.extractOneOrMore(R,E);this.consumeSpaceForRecord(R);const ie=this.extractOneOrMore(R,E);this.consumeSpaceForRecord(R);const xe=this.extractOneOrMore(R,v);this.consumeSpaceForRecord(R);const gt=this.extractOneOrMore(R,v);this.consumeSpaceForRecord(R);const Tn=this.extract(R,this.consumeUnicastAddress);return this.currentLine++,{username:k,sessId:x,sessVersion:ie,nettype:xe,addrtype:gt,unicastAddress:Tn}}parseSessionName(){const R=this.getCurrentRecord();if(R.type===m.SESSION_NAME){const k=this.extract(R,this.consumeText);return this.currentLine++,k}}parseInformation(){const R=this.getCurrentRecord();if(R.type!==m.INFORMATION)return;const k=this.extract(R,this.consumeText);return this.currentLine++,k}parseUri(){const R=this.getCurrentRecord();if(R.type===m.URI)return this.currentLine++,R.value}parseEmail(){const R=[];for(;;){const k=this.getCurrentRecord();if(k.type!==m.EMAIL)break;R.push(k.value),this.currentLine++}return R}parsePhone(){const R=[];for(;;){const k=this.getCurrentRecord();if(k.type!==m.PHONE)break;R.push(k.value),this.currentLine++}return R}parseConnection(){const R=this.getCurrentRecord();if(R.type===m.CONNECTION){const k=this.extractOneOrMore(R,v);this.consumeSpaceForRecord(R);const x=this.extractOneOrMore(R,v);this.consumeSpaceForRecord(R);const ie=this.extract(R,this.consumeAddress);return this.currentLine++,{nettype:k,addrtype:x,address:ie}}}parseMedia(){const R=this.getCurrentRecord(),k=this.extract(R,this.consumeToken);this.consumeSpaceForRecord(R);let x=this.extract(R,this.consumePort);R.value[R.cur]==="/"&&(R.cur+=1,x+=this.extract(R,this.consumeInteger)),this.consumeSpaceForRecord(R);const ie=[];for(ie.push(this.extract(R,this.consumeToken));R.value[R.cur]==="/";)R.cur+=1,ie.push(this.extract(R,this.consumeToken));if(ie.length===0)throw new Error("Invalid proto");const xe=this.parseFmt(R);return this.currentLine++,{mediaType:k,port:x,protos:ie,fmts:xe}}parseTimeFields(){const R=[];for(;this.getCurrentRecord().type===m.TIME;){const k=this.parseTime(),x=this.parseRepeat(),ie=this.parseZone();R.push({time:k,repeats:x,zones:ie})}return R}parseMediaDescription(){const R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===m.MEDIA;){const k=this.parseMedia(),x=this.parseInformation(),ie=this.parseConnections(),xe=this.parseBandWidth(),gt=this.parseKey(),Tn=this.parseMediaAttributes(k);R.push({media:k,information:x,connections:ie,bandwidths:xe,key:gt,attributes:Tn})}return R}parseConnections(){const R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===m.CONNECTION;)R.push(this.parseConnection());return R}parseFmt(R){const k=[];for(;;)try{this.consumeSpaceForRecord(R),k.push(this.extract(R,this.consumeToken))}catch{break}if(k.length===0)throw new Error("Invalid fmts");return k}extract(R,k){for(var x=arguments.length,ie=new Array(x>2?x-2:0),xe=2;xe<x;xe++)ie[xe-2]=arguments[xe];const gt=k.call(this,R.value,R.cur,...ie),Tn=R.value.slice(R.cur,gt);return R.cur=gt,Tn}extractOneOrMore(R,k){const x=this.consumeOneOrMore(R.value,R.cur,k),ie=R.value.slice(R.cur,x);return R.cur=x,ie}consumeSpaceForRecord(R){if(R.value[R.cur]!==f)throw new Error("Invalid space at ".concat(R.cur,"."));R.cur+=1}}class ct extends _e{constructor(){super(...arguments),ne(this,"attributes",void 0),ne(this,"digested",!1)}extractOneOrMore(R,k,x){const ie=this.consumeOneOrMore(R.attValue,R._cur,k),xe=R.attValue.slice(R._cur,ie),[gt,Tn]=x||[];if(typeof gt=="number"&&xe.length<gt)throw new Error("error in length, should be more or equal than ".concat(gt," characters."));if(typeof Tn=="number"&&xe.length>Tn)throw new Error("error in length, should be less or equal than ".concat(Tn," characters."));return R._cur=ie,xe}consumeAttributeSpace(R){if(R.attValue[R._cur]!==f)throw new Error("Invalid space at ".concat(R._cur,"."));R._cur+=1}extract(R,k){if(!R.attValue)throw new Error("Nothing to extract from attValue.");for(var x=arguments.length,ie=new Array(x>2?x-2:0),xe=2;xe<x;xe++)ie[xe-2]=arguments[xe];const gt=k.call(this,R.attValue,R._cur,...ie),Tn=R.attValue.slice(R._cur,gt);return R._cur=gt,Tn}atEnd(R){if(!R.attValue)throw new Error;return R._cur>=R.attValue.length}peekChar(R){if(!R.attValue)throw new Error;return R.attValue[R._cur]}peek(R,k){if(!R.attValue)throw new Error;for(let x=0;x<k.length;x++)if(k[x]!==R.attValue[R._cur+x])return!1;return!0}parseIceUfrag(R){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(R,F,[4,256])}parseIcePwd(R){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(R,F,[22,256])}parseIceOptions(R){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const k=[];for(;!this.atEnd(R);){k.push(this.extractOneOrMore(R,F));try{this.consumeAttributeSpace(R)}catch(x){if(this.atEnd(R))break;throw x}}this.attributes.iceOptions=k}parseFingerprint(R){const k=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const x=this.extract(R,this.consumeTill);this.attributes.fingerprints.push({hashFunction:k,fingerprint:x})}parseExtmap(R){const k=this.extractOneOrMore(R,E);let x;this.peekChar(R)==="/"&&(this.extract(R,this.consume,"/"),x=this.extract(R,this.consumeToken)),this.consumeAttributeSpace(R);const ie=this.extract(R,this.consumeTill,f),xe=ee(ee({entry:parseInt(k,10)},x&&{direction:x}),{},{extensionName:ie});this.peekChar(R)===f&&(this.consumeAttributeSpace(R),xe.extensionAttributes=this.extract(R,this.consumeTill)),this.attributes.extmaps.push(xe)}parseSetup(R){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const k=this.extract(R,this.consumeTill);if(k!=="active"&&k!=="passive"&&k!=="actpass"&&k!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=k}}class Nt extends ct{constructor(){super(...arguments),ne(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"group":this.parseGroup(R);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"fingerprint":this.parseFingerprint(R);break;case"setup":this.parseSetup(R);break;case"tls-id":this.parseTlsId(R);break;case"identity":this.parseIdentity(R);break;case"extmap":this.parseExtmap(R);break;case"msid-semantic":this.parseMsidSemantic(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(k){throw console.error("parsing session attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),k}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(R){const k=this.extract(R,this.consumeToken),x=[];for(;!this.atEnd(R)&&this.peekChar(R)===f;)this.consumeAttributeSpace(R),x.push(this.extract(R,this.consumeToken));this.attributes.groups.push({semantic:k,identificationTag:x})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(R){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(R,W)}parseIdentity(R){const k=this.extractOneOrMore(R,q),x=[];for(;!this.atEnd(R)&&this.peekChar(R)===f;){this.consumeAttributeSpace(R);const ie=this.extract(R,this.consumeToken);this.extract(R,this.consume,"=");const xe=this.extractOneOrMore(R,gt=>gt!==f&&U(gt));x.push({name:ie,value:xe})}this.attributes.identities.push({assertionValue:k,extensions:x})}parseMsidSemantic(R){this.peekChar(R)===f&&this.consumeAttributeSpace(R);const k={semantic:this.extract(R,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(R)}catch{break}if(this.peekChar(R)==="*"){this.extract(R,this.consume,"*"),k.applyForAll=!0;break}{const x=this.extract(R,this.consumeTill,f);k.identifierList.push(x)}}this.attributes.msidSemantic=k}}class dn extends ct{constructor(R){super(),ne(this,"attributes",void 0),R.protos.indexOf("RTP")!==-1||R.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"extmap":this.parseExtmap(R);break;case"setup":this.parseSetup(R);break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"candidate":this.parseCandidate(R);break;case"remote-candidate":this.parseRemoteCandidate(R);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(R);break;case"rtpmap":this.parseRtpmap(R);break;case"ptime":this.parsePtime(R);break;case"maxptime":this.parseMaxPtime(R);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(R);break;case"ssrc":this.parseSSRC(R);break;case"fmtp":this.parseFmtp(R);break;case"rtcp-fb":this.parseRtcpFb(R);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(R);break;case"mid":this.parseMid(R);break;case"msid":this.parseMsid(R);break;case"imageattr":this.parseImageAttr(R);break;case"rid":this.parseRid(R);break;case"simulcast":this.parseSimulcast(R);break;case"sctp-port":this.parseSctpPort(R);break;case"max-message-size":this.parseMaxMessageSize(R);break;case"ssrc-group":this.parseSSRCGroup(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(k){throw console.error("parsing media attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),k}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}parseCandidate(R){const k=this.extractOneOrMore(R,F,[1,32]);this.consumeAttributeSpace(R);const x=this.extractOneOrMore(R,E,[1,5]);this.consumeAttributeSpace(R);const ie=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const xe=this.extractOneOrMore(R,E,[1,10]);this.consumeAttributeSpace(R);const gt=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);const Tn=this.extract(R,this.consumePort);this.consumeAttributeSpace(R),this.extract(R,this.consume,"typ"),this.consumeAttributeSpace(R);const Ur={foundation:k,componentId:x,transport:ie,priority:xe,connectionAddress:gt,port:Tn,type:this.extract(R,this.consumeToken),extension:{}};for(this.peek(R," raddr")&&(this.extract(R,this.consume," raddr"),this.consumeAttributeSpace(R),Ur.relAddr=this.extract(R,this.consumeAddress)),this.peek(R," rport")&&(this.extract(R,this.consume," rport"),this.consumeAttributeSpace(R),Ur.relPort=this.extract(R,this.consumePort));this.peekChar(R)===f;){this.consumeAttributeSpace(R);const Gs=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R),Ur.extension[Gs]=this.extractOneOrMore(R,S)}this.attributes.candidates.push(Ur)}parseRemoteCandidate(R){const k=[];for(;;){const x=this.extractOneOrMore(R,E,[1,5]);this.consumeAttributeSpace(R);const ie=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);const xe=this.extract(R,this.consumePort);k.push({componentId:x,connectionAddress:ie,port:xe});try{this.consumeAttributeSpace(R)}catch{break}}this.attributes.remoteCandidatesList.push(k)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(R){const k=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const x=this.extract(R,this.consumeTill,"/");this.extract(R,this.consume,"/");const ie={encodingName:x,clockRate:this.extractOneOrMore(R,E)};this.atEnd(R)||this.peekChar(R)!=="/"||(this.extract(R,this.consume,"/"),ie.encodingParameters=parseInt(this.extract(R,this.consumeTill),10));const xe=this.attributes.payloads.find(gt=>gt.payloadType===parseInt(k,10));xe?xe.rtpMap=ie:this.attributes.payloads.push({payloadType:parseInt(k,10),rtpMap:ie,rtcpFeedbacks:[]})}parsePtime(R){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(R,this.consumeTill)}parseMaxPtime(R){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(R,this.consumeTill)}parseDirection(R){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=R.attField}parseSSRC(R){const k=this.extractOneOrMore(R,E);this.consumeAttributeSpace(R);const x=this.extract(R,this.consumeTill,":");let ie;this.peekChar(R)===":"&&(this.extract(R,this.consume,":"),ie=this.extract(R,this.consumeTill));const xe=this.attributes.ssrcs.find(gt=>gt.ssrcId===parseInt(k,10));xe?xe.attributes[x]=ie:this.attributes.ssrcs.push({ssrcId:parseInt(k,10),attributes:{[x]:ie}})}parseFmtp(R){const k=this.extract(R,this.consumeTill,f);this.consumeAttributeSpace(R);const x=this.extract(R,this.consumeTill),ie={};x.split(";").forEach(gt=>{let[Tn,Ur]=gt.split("=");Tn=sr(Tn).call(Tn);const Gs=typeof Ur=="string"?sr(Ur).call(Ur):null;typeof Tn=="string"&&Tn.length>0&&(ie[Tn]=Gs)});const xe=this.attributes.payloads.find(gt=>gt.payloadType===parseInt(k,10));xe?xe.fmtp={parameters:ie}:this.attributes.payloads.push({payloadType:parseInt(k,10),rtcpFeedbacks:[],fmtp:{parameters:ie}})}parseFmtParameters(R){const k={},x=this.extract(R,this.consumeTill,"=");R._cur++;const ie=this.extract(R,this.consumeTill,";");for(k[x]=ie;R.attValue[R._cur]===";";){const xe=this.extract(R,this.consumeTill,"=");R._cur++;const gt=this.extract(R,this.consumeTill,";");k[xe]=gt}return k}parseRtcpFb(R){let k="";k=this.peekChar(R)==="*"?this.extract(R,this.consume,"*"):this.extract(R,this.consumeTill,f),this.consumeAttributeSpace(R);const x=this.extract(R,this.consumeTill,f);let ie;if(x==="trr-int")ie={type:x,interval:this.extract(R,this.consumeTill)};else{const xe={type:x};this.peekChar(R)===f&&(this.consumeAttributeSpace(R),xe.parameter=this.extract(R,this.consumeToken),this.peekChar(R)===f&&(xe.additional=this.extract(R,this.consumeTill))),ie=xe}if(k==="*")this.attributes.rtcpFeedbackWildcards.push(ie);else{const xe=this.attributes.payloads.find(gt=>gt.payloadType===parseInt(k,10));xe?xe.rtcpFeedbacks.push(ie):this.attributes.payloads.push({payloadType:parseInt(k,10),rtcpFeedbacks:[ie]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(R){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const k={port:this.extract(R,this.consumePort)};this.peekChar(R)===f&&(this.consumeAttributeSpace(R),k.netType=this.extractOneOrMore(R,v),this.consumeAttributeSpace(R),k.addressType=this.extractOneOrMore(R,v),this.consumeAttributeSpace(R),k.address=this.extract(R,this.consumeAddress)),this.attributes.rtcp=k}parseMsid(R){const k={id:this.extractOneOrMore(R,v,[1,64])};this.peekChar(R)===f&&(this.consumeAttributeSpace(R),k.appdata=this.extractOneOrMore(R,v,[1,64])),this.attributes.msids.push(k)}parseImageAttr(R){this.attributes.imageattr.push(R.attValue)}parseRid(R){const k=this.extractOneOrMore(R,ie=>b(ie)||E(ie)||ie==="_"||ie==="-");this.consumeAttributeSpace(R);const x={id:k,direction:this.extract(R,this.consumeToken),params:[]};if(this.peekChar(R)===f){if(this.consumeAttributeSpace(R),this.peek(R,"pt=")){this.extract(R,this.consume,"pt=");const ie=[];for(;;){const xe=this.extract(R,this.consumeToken);ie.push(xe);try{this.extract(R,this.consume,",")}catch{break}}x.payloads=ie,this.peekChar(R)===f&&this.extract(R,this.consume,f)}for(;;){const ie=this.extract(R,this.consumeToken);switch(ie){case"depend":{const xe={type:ie,rids:this.extract(R,this.consume,"=").split(",")};x.params.push(xe);break}default:{const xe={type:ie};this.peekChar(R)==="="&&(this.extract(R,this.consume,"="),xe.val=this.extract(R,this.consumeTill,";")),x.params.push(xe)}}try{this.extract(R,this.consume,";")}catch{break}}}this.attributes.rids.push(x)}parseSimulcast(R){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=R.attValue,this.extract(R,this.consumeTill)}parseSctpPort(R){this.attributes.sctpPort=this.extractOneOrMore(R,E,[1,5])}parseMaxMessageSize(R){this.attributes.maxMessageSize=this.extractOneOrMore(R,E,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(R){this.attributes.mid=this.extract(R,this.consumeToken)}parseSSRCGroup(R){const k=this.extract(R,this.consumeToken),x=[];for(;;)try{this.consumeAttributeSpace(R);const ie=this.extract(R,this.consumeInteger);x.push(parseInt(ie,10))}catch{break}this.attributes.ssrcGroups.push({semantic:k,ssrcIds:x})}}function Gt(de,R,k){return R in de?Object.defineProperty(de,R,{value:k,enumerable:!0,configurable:!0,writable:!0}):de[R]=k,de}class uo{constructor(){Gt(this,"eol",p)}print(R,k){let x="";return k&&(this.eol=k),x+=this.printVersion(R.version),x+=this.printOrigin(R.origin),x+=this.printSessionName(R.sessionName),x+=this.printInformation(R.information),x+=this.printUri(R.uri),x+=this.printEmail(R.emails),x+=this.printPhone(R.phones),x+=this.printConnection(R.connection),x+=this.printBandwidth(R.bandwidths),x+=this.printTimeFields(R.timeFields),x+=this.printKey(R.key),x+=this.printSessionAttributes(R.attributes),x+=this.printMediaDescription(R.mediaDescriptions),x}printVersion(R){return"v=".concat(R).concat(this.eol)}printOrigin(R){return"o=".concat(R.username," ").concat(R.sessId," ").concat(R.sessVersion," ").concat(R.nettype," ").concat(R.addrtype," ").concat(R.unicastAddress).concat(this.eol)}printSessionName(R){return R?"s=".concat(R).concat(this.eol):""}printInformation(R){return R?"i=".concat(R).concat(this.eol):""}printUri(R){return R?"u=".concat(R).concat(this.eol):""}printEmail(R){let k="";for(const x of R)k+="e=".concat(x).concat(this.eol);return k}printPhone(R){let k="";for(const x of R)k+="e=".concat(x).concat(this.eol);return k}printConnection(R){return R?"c=".concat(R.nettype," ").concat(R.addrtype," ").concat(R.address).concat(this.eol):""}printBandwidth(R){let k="";for(const x of R)k+="b=".concat(x.bwtype,":").concat(x.bandwidth).concat(this.eol);return k}printTimeFields(R){let k="";for(const x of R){k+="t=".concat(x.time.startTime," ").concat(x.time.startTime).concat(this.eol);for(const ie of x.repeats)k+="r=".concat(ie.repeatInterval," ").concat(ie.typedTimes.join(" ")).concat(this.eol);x.zoneAdjustments&&(k+="z=",k+="z=".concat(x.zoneAdjustments.map(ie=>"".concat(ie.time," ").concat(ie.back?"-":""," ").concat(ie.typedTime)).join(" ")).concat(this.eol),k+=this.eol)}return k}printKey(R){return R?"k=".concat(R).concat(this.eol):""}printAttributes(R){let k="";for(const x of R)k+="a=".concat(x.attField).concat(x.attValue?":".concat(x.attValue):"").concat(this.eol);return k}printMediaDescription(R){let k="";for(const x of R)k+=this.printMedia(x.media),k+=this.printInformation(x.information),k+=this.printConnections(x.connections),k+=this.printBandwidth(x.bandwidths),k+=this.printKey(x.key),k+=this.printMediaAttributes(x);return k}printConnections(R){let k="";for(const x of R)k+=this.printConnection(x);return k}printMedia(R){return"m=".concat(R.mediaType," ").concat(R.port," ").concat(R.protos.join("/")," ").concat(R.fmts.join(" ")).concat(this.eol)}printSessionAttributes(R){return new oe(this.eol).print(R)}printMediaAttributes(R){return new Te(this.eol).print(R)}}class te{constructor(R){Gt(this,"eol",void 0),this.eol=R}printIceUfrag(R){return R===void 0?"":"a=ice-ufrag:".concat(R).concat(this.eol)}printIcePwd(R){return R===void 0?"":"a=ice-pwd:".concat(R).concat(this.eol)}printIceOptions(R){return R===void 0?"":"a=ice-options:".concat(R.join(f)).concat(this.eol)}printFingerprints(R){return R.length>0?R.map(k=>"a=fingerprint:".concat(k.hashFunction).concat(f).concat(k.fingerprint)).join(this.eol)+this.eol:""}printExtmap(R){return R.map(k=>"a=extmap:".concat(k.entry).concat(k.direction?"/".concat(k.direction):"").concat(f).concat(k.extensionName).concat(k.extensionAttributes?"".concat(f).concat(k.extensionAttributes):"").concat(this.eol)).join("")}printSetup(R){return R===void 0?"":"a=setup:".concat(R).concat(this.eol)}printUnrecognized(R){return R.map(k=>"a=".concat(k.attField).concat(k.attValue?":".concat(k.attValue):"").concat(this.eol)).join("")}}class oe extends te{print(R){let k="";return k+=this.printGroups(R.groups),k+=this.printMsidSemantic(R.msidSemantic),k+=this.printIceLite(R.iceLite),k+=this.printIceUfrag(R.iceUfrag),k+=this.printIcePwd(R.icePwd),k+=this.printIceOptions(R.iceOptions),k+=this.printFingerprints(R.fingerprints),k+=this.printSetup(R.setup),k+=this.printTlsId(R.tlsId),k+=this.printIdentity(R.identities),k+=this.printExtmap(R.extmaps),k+=this.printUnrecognized(R.unrecognized),k}printGroups(R){let k="";return R.length>0&&(k+=R.map(x=>"a=group:".concat(x.semantic).concat(x.identificationTag.map(ie=>"".concat(f).concat(ie)).join("")).concat(this.eol)).join("")),k}printIceLite(R){return R===void 0?"":"a=ice-lite"+this.eol}printTlsId(R){return R?"a=tls-id:".concat(R).concat(this.eol):""}printIdentity(R){return R.length===0?"":R.map(k=>"a=identity:".concat(k.assertionValue).concat(k.extensions.map(x=>"".concat(f).concat(x.name).concat(x.value?"=".concat(x.value):"")))).join(this.eol)+this.eol}printMsidSemantic(R){if(!R)return"";let k="a=msid-semantic:".concat(R.semantic);return R.applyForAll?k+="".concat(f,"*"):R.identifierList.length>0&&(k+=R.identifierList.map(x=>"".concat(f).concat(x))),k+this.eol}}class Te extends te{print(R){const k=R.attributes;let x="";return x+=this.printRTCP(k.rtcp),x+=this.printIceUfrag(k.iceUfrag),x+=this.printIcePwd(k.icePwd),x+=this.printIceOptions(k.iceOptions),x+=this.printCandidates(k.candidates),x+=this.printRemoteCandidatesList(k.remoteCandidatesList),x+=this.printEndOfCandidates(k.endOfCandidates),x+=this.printFingerprints(k.fingerprints),x+=this.printSetup(k.setup),x+=this.printMid(k.mid),x+=this.printExtmap(k.extmaps),x+=this.printRTPRelated(k),x+=this.printPtime(k.ptime),x+=this.printMaxPtime(k.maxPtime),x+=this.printDirection(k.direction),x+=this.printSSRCGroups(k.ssrcGroups),x+=this.printSSRC(k.ssrcs),x+=this.printRTCPMux(k.rtcpMux),x+=this.printRTCPMuxOnly(k.rtcpMuxOnly),x+=this.printRTCPRsize(k.rtcpRsize),x+=this.printMSId(k.msids),x+=this.printImageattr(k.imageattr),x+=this.printRid(k.rids),x+=this.printSimulcast(k.simulcast),x+=this.printSCTPPort(k.sctpPort),x+=this.printMaxMessageSize(k.maxMessageSize),x+=this.printUnrecognized(k.unrecognized),x}printCandidates(R){return R.map(k=>"a=candidate:".concat(k.foundation).concat(f).concat(k.componentId).concat(f).concat(k.transport).concat(f).concat(k.priority).concat(f).concat(k.connectionAddress).concat(f).concat(k.port).concat(f,"typ").concat(f).concat(k.type).concat(k.relAddr?"".concat(f,"raddr").concat(f).concat(k.relAddr):"").concat(k.relPort?"".concat(f,"rport").concat(f).concat(k.relPort):"").concat(Object.keys(k.extension).map(x=>"".concat(f).concat(x).concat(f).concat(k.extension[x])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(R){return R.map(k=>"a=remote-candidates:".concat(k.join(f)).concat(this.eol)).join("")}printEndOfCandidates(R){return R===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(R){if(!R.payloads)return"";const k=R.payloads;let x="";x+=R.rtcpFeedbackWildcards.map(ie=>this.printRTCPFeedback("*",ie)).join("");for(const ie of k)x+=this.printRtpMap(ie.payloadType,ie.rtpMap),x+=this.printFmtp(ie.payloadType,ie.fmtp),x+=ie.rtcpFeedbacks.map(xe=>this.printRTCPFeedback(ie.payloadType,xe)).join("");return x}printFmtp(R,k){if(!k)return"";const x=Object.keys(k.parameters);return x.length===1&&k.parameters[x[0]]===null?"a=fmtp:".concat(R).concat(f).concat(x[0]).concat(this.eol):"a=fmtp:".concat(R).concat(f).concat(Object.keys(k.parameters).map(ie=>"".concat(ie,"=").concat(k.parameters[ie])).join(";")).concat(this.eol)}printRtpMap(R,k){return k?"a=rtpmap:".concat(R).concat(f).concat(k.encodingName,"/").concat(k.clockRate).concat(k.encodingParameters?"/".concat(k.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(R,k){let x="a=rtcp-fb:".concat(R).concat(f),ie=k;return ie.type==="trr-int"?x+="ttr-int".concat(f).concat(ie.interval):(x+="".concat(ie.type),ie.parameter&&(x+="".concat(f).concat(ie.parameter),ie.additional&&(x+="".concat(f).concat(ie.additional)))),x+this.eol}printPtime(R){return R===void 0?"":"a=ptime:".concat(R).concat(this.eol)}printMaxPtime(R){return R===void 0?"":"a=maxptime:".concat(R).concat(this.eol)}printDirection(R){return R===void 0?"":"a=".concat(R).concat(this.eol)}printSSRC(R){return R.map(k=>Object.keys(k.attributes).map(x=>"a=ssrc:".concat(k.ssrcId.toString(10)).concat(f).concat(x).concat(k.attributes[x]?":".concat(k.attributes[x]):"").concat(this.eol)).join("")).join("")}printRTCPMux(R){return R===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(R){return R===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(R){return R===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(R){if(R===void 0)return"";let k="a=rtcp:".concat(R.port);return R.netType&&(k+="".concat(f).concat(R.netType)),R.addressType&&(k+="".concat(f).concat(R.addressType)),R.address&&(k+="".concat(f).concat(R.address)),k+this.eol}printMSId(R){return R.map(k=>"a=msid:".concat(k.id).concat(k.appdata?"".concat(f).concat(k.appdata):"").concat(this.eol)).join("")}printImageattr(R){return R.map(k=>"a=imageattr:".concat(k).concat(this.eol)).join("")}printRid(R){return R.map(k=>{let x="a=rid:".concat(k.id).concat(f).concat(k.direction);return k.payloads&&(x+="".concat(f,"pt=").concat(k.payloads.join(","))),k.params.length>0&&(x+="".concat(f).concat(k.params.map(ie=>ie.type==="depend"?"depend=".concat(ie.rids.join(",")):"".concat(ie.type,"=").concat(ie.val)).join(";"))),x+this.eol}).join("")}printSimulcast(R){return R===void 0?"":"a=simulcast:".concat(R).concat(this.eol)}printSCTPPort(R){return R===void 0?"":"a=sctp-port:".concat(R).concat(this.eol)}printMaxMessageSize(R){return R===void 0?"":"a=max-message-size:".concat(R).concat(this.eol)}printMid(R){return R===void 0?"":"a=mid:".concat(R).concat(this.eol)}printSSRCGroups(R){return R.map(k=>"a=ssrc-group:".concat(k.semantic).concat(k.ssrcIds.map(x=>"".concat(f).concat(x.toString(10))).join("")).concat(this.eol)).join("")}}function Me(de){return new Qe().parse(de)}function st(de,R){return new uo().print(de,R)}}},r={};function i(a){if(r[a])return r[a].exports;var c=r[a]={exports:{}};return n[a](c,c.exports,i),c.exports}return i.d=(a,c)=>{for(var l in c)i.o(c,l)&&!i.o(a,l)&&Object.defineProperty(a,l,{enumerable:!0,get:c[l]})},i.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),i.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},i(8)})()})(jk);var jt=jk.exports;function oo(e){if(Array.isArray(e))return e.map(n=>n);if(!Vk(e))return e;const t={};for(const n in e){const r=e[n];Vk(r)||Array.isArray(r)?t[n]=oo(r):t[n]=r}return t}function Vk(e){return!(typeof e!="object"||Array.isArray(e)||!e)}class Iy{constructor(t){w(this,"input",[]),w(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const Es={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},kh={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Es,remoteCandidate:Es}},Fk={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},Bk={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},Wk={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},Gk={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function Hk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Kk(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Hk(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hk(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class by{constructor(t,n){w(this,"onFirstVideoReceived",void 0),w(this,"onFirstVideoDecoded",void 0),w(this,"onFirstAudioReceived",void 0),w(this,"onFirstVideoDecodedTimeout",void 0),w(this,"onFirstAudioDecoded",void 0),w(this,"onSelectedLocalCandidateChanged",void 0),w(this,"onSelectedRemoteCandidateChanged",void 0),w(this,"videoIsReady",!1),w(this,"videoIsReady2",{}),w(this,"pc",void 0),w(this,"options",void 0),w(this,"intervalTimer",void 0),w(this,"stats",oo(kh)),w(this,"isFirstVideoReceived",{}),w(this,"isFirstVideoDecoded",{}),w(this,"isFirstAudioReceived",{}),w(this,"isFirstAudioDecoded",{}),w(this,"isFirstVideoDecodedTimeout",{}),w(this,"lossRateWindowStats",[]),this.pc=t,this.options=n,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ce(t=>{t({local:Kk({},Es),remote:Kk({},Es)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,n){this.videoIsReady2[t]=n}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,a=0,c=0,l=0;for(const u of r)t[u].forEach((p,f)=>{if(!this.lossRateWindowStats[n-1][u][f]||!this.lossRateWindowStats[0][u][f])return;const m=this.lossRateWindowStats[n-1][u][f].packets-this.lossRateWindowStats[0][u][f].packets,E=this.lossRateWindowStats[n-1][u][f].packetsLost-this.lossRateWindowStats[0][u][f].packetsLost;u==="videoSend"||u==="audioSend"?(i+=m,c+=E):(a+=m,l+=E),Number.isNaN(m)||Number.isNaN(m)?p.packetLostRate=0:p.packetLostRate=m<=0||E<=0?0:E/(m+E)});t.sendPacketLossRate=i<=0||c<=0?0:c/(i+c),t.recvPacketLossRate=a<=0||l<=0?0:l/(a+l)}}function zk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function TX(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?zk(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zk(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class vX extends by{constructor(){super(...arguments),w(this,"_stats",kh),w(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),n=this.statsResponsesToObjects(t);this._stats=oo(kh);const r=n.filter(a=>a.type==="ssrc");this.processSSRCStats(r);const i=n.find(a=>a.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(n=>{var r;const i=ue(r=n.id).call(r,"send");switch("".concat(n.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const a=oo(Bk);a.codec=n.googCodecName,a.adaptionChangeReason="none",n.googCpuLimitedResolution&&(a.adaptionChangeReason="cpu"),n.googBandwidthLimitedResolution&&(a.adaptionChangeReason="bandwidth"),a.avgEncodeMs=Number(n.googAvgEncodeMs),a.inputFrame={width:Number(n.googFrameWidthInput)||Number(n.googFrameWidthSent),height:Number(n.googFrameHeightInput)||Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},a.sentFrame={width:Number(n.googFrameWidthSent),height:Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},a.firsCount=Number(n.googFirReceived),a.nacksCount=Number(n.googNacksReceived),a.plisCount=Number(n.googPlisReceived),a.frameCount=Number(n.framesEncoded),a.bytes=Number(n.bytesSent),a.packets=Number(n.packetsSent),a.packetsLost=Number(n.packetsLost),a.ssrc=Number(n.ssrc),a.rttMs=Number(n.googRtt||0),this._stats.videoSend.push(a),this._stats.rtt=a.rttMs;break}case"video_recv":{const a=oo(Fk),c=this.lastDecodeVideoReceiverStats.get(Number(n.ssrc));if(a.codec=n.googCodecName,a.targetDelayMs=Number(n.googTargetDelayMs),a.renderDelayMs=Number(n.googRenderDelayMs),a.currentDelayMs=Number(n.googCurrentDelayMs),a.minPlayoutDelayMs=Number(n.googMinPlayoutDelayMs),a.decodeMs=Number(n.googDecodeMs),a.maxDecodeMs=Number(n.googMaxDecodeMs),a.receivedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateReceived)},a.decodedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateDecoded)},a.decodeFrameRate=Number(n.googFrameRateDecoded),a.outputFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateOutput)},a.jitterBufferMs=Number(n.googJitterBufferMs),a.firsCount=Number(n.googFirsSent),a.nacksCount=Number(n.googNacksSent),a.plisCount=Number(n.googPlisSent),a.framesDecodeCount=Number(n.framesDecoded),a.bytes=Number(n.bytesReceived),a.packets=Number(n.packetsReceived),a.packetsLost=Number(n.packetsLost),a.ssrc=Number(n.ssrc),a.packets>0&&!this.isFirstVideoReceived[a.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(a.ssrc),this.isFirstVideoReceived[a.ssrc]=!0),a.framesDecodeCount>0&&!this.isFirstVideoDecoded[a.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(a.ssrc,a.decodedFrame.width,a.decodedFrame.height),this.isFirstVideoDecoded[a.ssrc]=!0),c){const l=c.stats,u=Date.now()-c.lts;a.framesDecodeFreezeTime=l.framesDecodeFreezeTime,a.framesDecodeInterval=l.framesDecodeInterval,a.framesDecodeCount>l.framesDecodeCount&&this.isFirstVideoDecoded[a.ssrc]?(c.lts=Date.now(),a.framesDecodeInterval=u,a.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc,10))?a.framesDecodeFreezeTime+=a.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):a.framesDecodeCount<c.stats.framesDecodeCount&&(a.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(a.ssrc,{stats:TX({},a),lts:Date.now()}),this._stats.videoRecv.push(a);break}case"audio_recv":{const a=oo(Gk);a.codec=n.googCodecName,a.outputLevel=Math.abs(Number(n.audioOutputLevel))/32767,a.decodingCNG=Number(n.googDecodingCNG),a.decodingCTN=Number(n.googDecodingCTN),a.decodingCTSG=Number(n.googDecodingCTSG),a.decodingNormal=Number(n.googDecodingNormal),a.decodingPLC=Number(n.googDecodingPLC),a.decodingPLCCNG=Number(n.googDecodingPLCCNG),a.expandRate=Number(n.googExpandRate),a.accelerateRate=Number(n.googAccelerateRate),a.preemptiveExpandRate=Number(n.googPreemptiveExpandRate),a.secondaryDecodedRate=Number(n.googSecondaryDecodedRate),a.speechExpandRate=Number(n.googSpeechExpandRate),a.preferredJitterBufferMs=Number(n.googPreferredJitterBufferMs),a.jitterBufferMs=Number(n.googJitterBufferMs),a.jitterMs=Number(n.googJitterReceived),a.bytes=Number(n.bytesReceived),a.packets=Number(n.packetsReceived),a.packetsLost=Number(n.packetsLost),a.ssrc=Number(n.ssrc),a.receivedFrames=Number(n.googDecodingCTN)||Number(n.packetsReceived),a.droppedFrames=Number(n.googDecodingPLC)+Number(n.googDecodingPLCCNG)||Number(n.packetsLost),a.receivedFrames>0&&!this.isFirstAudioReceived[a.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(a.ssrc),this.isFirstAudioReceived[a.ssrc]=!0),a.decodingNormal>0&&!this.isFirstAudioDecoded[a.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(a.ssrc),this.isFirstAudioDecoded[a.ssrc]=!0),this._stats.audioRecv.push(a);break}case"audio_send":{const a=oo(Wk);a.codec=n.googCodecName,a.inputLevel=Math.abs(Number(n.audioInputLevel))/32767,a.aecReturnLoss=Number(n.googEchoCancellationReturnLoss||0),a.aecReturnLossEnhancement=Number(n.googEchoCancellationReturnLossEnhancement||0),a.residualEchoLikelihood=Number(n.googResidualEchoLikelihood||0),a.residualEchoLikelihoodRecentMax=Number(n.googResidualEchoLikelihoodRecentMax||0),a.bytes=Number(n.bytesSent),a.packets=Number(n.packetsSent),a.packetsLost=Number(n.packetsLost),a.ssrc=Number(n.ssrc),a.rttMs=Number(n.googRtt||0),this._stats.rtt=a.rttMs,this._stats.audioSend.push(a);break}}})}_getStats(){return new ce((t,n)=>{this.pc.getStats(t,n)})}statsResponsesToObjects(t){const n=[];return t.result().forEach(r=>{const i={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach(a=>{i[a]=r.stat(a)}),n.push(i)}),n}}function Yk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Kc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Yk(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yk(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class qk extends by{constructor(){super(...arguments),w(this,"_stats",kh),w(this,"report",void 0),w(this,"lastDecodeVideoReceiverStats",new Map),w(this,"lastVideoFramesRecv",new Map),w(this,"lastVideoFramesSent",new Map),w(this,"lastVideoFramesDecode",new Map),w(this,"lastVideoFramesOutput",new Map),w(this,"lastVideoJBDelay",new Map),w(this,"lastAudioJBDelay",new Map),w(this,"mediaBytesSent",new Map),w(this,"mediaBytesRetransmit",new Map),w(this,"mediaBytesTargetEncode",new Map),w(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=oo(kh),this.report.forEach(t=>{switch(t.type){case si.OUTBOUND:case si.INBOUND:{const n=t.mediaType||t.kind,r=!n&&"frameWidth"in t,i=!n&&!("frameWidth"in t);t.type===si.OUTBOUND?n==="audio"||i?this.processAudioOutboundStats(t):(n==="video"||r)&&this.processVideoOutboundStats(t):t.type===si.INBOUND&&(n==="audio"||i?this.processAudioInboundStats(t):(n==="video"||r)&&this.processVideoInboundStats(t));break}case si.TRANSPORT:{const n=this.report.get(t.selectedCandidatePairId);n&&this.processCandidatePairStats(n);break}case si.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),n={local:Kc({},Es),remote:Kc({},Es)};return t.forEach(r=>{let i;if(r.type===si.TRANSPORT&&(i=t.get(r.selectedCandidatePairId)),r.type===si.CANDIDATE_PAIR&&r.selected&&(i=r),i){const a=(c,l)=>{c.type=l.type,c.id=l.id,l.address&&(c.address=l.address),l.candidateType&&(c.candidateType=l.candidateType),l.port&&(c.port=l.port),l.priority&&(c.priority=l.priority),l.protocol&&(c.protocol=l.protocol),l.relayProtocol&&(c.relayProtocol=l.relayProtocol)};if(i.localCandidateId){const c=t.get(i.localCandidateId);c&&a(n.local,c)}if(i.remoteCandidateId){const c=t.get(i.remoteCandidateId);c&&a(n.remote,c)}}}),n}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(n=>{t.currentRoundTripTime&&(n.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(n=>{t.currentRoundTripTime&&(n.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const n=this.report.get(t.localCandidateId);n&&this.processCandidateStats(n)}if(t.remoteCandidateId){const n=this.report.get(t.remoteCandidateId);n&&this.processCandidateStats(n)}}processCandidateStats(t){let n;t.type===si.LOCAL_CANDIDATE&&(n=this._stats.selectedCandidatePair.localCandidate),t.type===si.REMOTE_CANDIDATE&&(n=this._stats.selectedCandidatePair.remoteCandidate),n&&(n.type=t.type,n.id=t.id,t.address&&(n.address=t.address),t.candidateType&&(n.candidateType=t.candidateType),t.port&&(n.port=t.port),t.priority&&(n.priority=t.priority),t.protocol&&(n.protocol=t.protocol),t.relayProtocol&&(n.relayProtocol=t.relayProtocol),t.type===si.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Kc({},n),Kc({},this.stats.selectedCandidatePair.localCandidate)),t.type===si.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Kc({},n),Kc({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let n=this._stats.audioRecv.find(r=>r.ssrc===t.ssrc);n||(n=oo(Gk),this._stats.audioRecv.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsReceived,n.packetsLost=t.packetsLost,n.bytes=t.bytesReceived,n.jitterMs=1e3*t.jitter,this.processAudioTrackReceiverStats(t,t.trackId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),n.receivedFrames||(n.receivedFrames=t.packetsReceived),n.droppedFrames||(n.droppedFrames=t.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.outputLevel&&n.outputLevel>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),typeof t.concealedSamples=="number"&&(n.concealedSamples=t.concealedSamples)}processVideoInboundStats(t){let n=this._stats.videoRecv.find(l=>l.ssrc===t.ssrc);n||(n=oo(Fk),this._stats.videoRecv.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsReceived,n.packetsLost=t.packetsLost,n.bytes=t.bytesReceived,n.firsCount=t.firCount,n.nacksCount=t.nackCount,n.plisCount=t.pliCount,n.framesDecodeCount=t.framesDecoded,n.framesDroppedCount=t.framesDropped,n.totalInterFrameDelay=t.totalInterFrameDelay,n.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,n.totalFreezesDuration=t.totalFreezesDuration;const r=this.lastDecodeVideoReceiverStats.get(n.ssrc),i=this.lastVideoFramesDecode.get(n.ssrc),a=this.lastVideoFramesOutput.get(n.ssrc),c=Date.now();if(n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]){const l=n.decodedFrame?n.decodedFrame.width:0,u=n.decodedFrame?n.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,l,u),this.isFirstVideoDecoded[n.ssrc]=!0}if(r){const l=r.stats,u=c-r.lts;n.framesDecodeFreezeTime=l.framesDecodeFreezeTime,n.framesDecodeInterval=l.framesDecodeInterval,!this.isFirstVideoDecoded[n.ssrc]&&u>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n.ssrc),this.isFirstVideoDecodedTimeout[n.ssrc]=!0),n.framesDecodeCount>l.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(r.lts=Date.now(),n.framesDecodeInterval=u,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):n.framesDecodeCount<l.framesDecodeCount&&(n.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(r.stats.framesDecodeCount>t.framesDecoded?n.qpSumPerFrame=t.qpSum/t.framesDecoded:n.qpSumPerFrame=(t.qpSum-r.qpSum)/(t.framesDecoded-r.stats.framesDecodeCount))}i&&c-i.lts>=800?(n.decodeFrameRate=Math.round((n.framesDecodeCount-i.count)/((c-i.lts)/1e3)),this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:c,rate:n.decodeFrameRate})):i?n.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:c,rate:0}),n.framesDroppedCount&&t.framesReceived&&(a&&c-a.lts>=800?(n.outputFrameRate=Math.round((t.framesReceived-n.framesDroppedCount-a.count)/((c-a.lts)/1e3)),this.lastVideoFramesOutput.set(n.ssrc,{count:t.framesReceived-n.framesDroppedCount,lts:c,rate:Math.max(n.outputFrameRate,0)})):a?n.outputFrameRate=a.rate:this.lastVideoFramesOutput.set(n.ssrc,{count:t.framesReceived-n.framesDroppedCount,lts:c,rate:0})),t.totalDecodeTime&&(n.decodeMs=1e3*t.totalDecodeTime),this.processVideoTrackReceiverStats(t,t.trackId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(n.framesRateFirefox=t.framerateMean),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:Kc({},n),lts:r?r.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let n=this._stats.videoSend.find(i=>i.ssrc===t.ssrc);n||(n=oo(Bk),this._stats.videoSend.push(n));const r=this.mediaBytesSent.get(t.ssrc);if(r)r.add(t.bytesSent);else{const i=new Iy(10);i.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,i)}if(t.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(t.ssrc);if(i)i.add(t.retransmittedBytesSent);else{const a=new Iy(10);a.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,a)}}if(t.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(t.ssrc);if(i)i.add(t.totalEncodedBytesTarget);else{const a=new Iy(10);a.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,a)}}if(n.ssrc=t.ssrc,n.bytes=t.bytesSent,n.packets=t.packetsSent,n.firsCount=t.firCount,n.nacksCount=t.nackCount,n.plisCount=t.pliCount,n.frameCount=t.framesEncoded,n.adaptionChangeReason=t.qualityLimitationReason,n.scalabilityMode=t.scalabilityMode,t.totalEncodeTime&&t.framesEncoded){const i=this.lastEncoderMs.get(t.ssrc);if(!i||i.lastFrameCount>t.framesEncoded)n.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const a=t.framesEncoded-i.lastFrameCount,c=t.totalEncodeTime-i.lastEncoderTime;n.avgEncodeMs=1e3*c/a}}if(t.framesEncoded&&t.qpSum){const i=this.lastEncoderMs.get(t.ssrc);!i||i.lastFrameCount>t.framesEncoded?n.qpSumPerFrame=t.qpSum/t.framesEncoded:n.qpSumPerFrame=(t.qpSum-i.lastQpSum)/(t.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,n),this.processVideoTrackSenderStats(t,t.trackId,n),t.remoteId)this.processRemoteInboundStats(t.remoteId,n);else{const i=this.findRemoteStatsId(t.ssrc,si.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,n)}}processAudioOutboundStats(t){let n=this._stats.audioSend.find(r=>r.ssrc===t.ssrc);if(n||(n=oo(Wk),this._stats.audioSend.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsSent,n.bytes=t.bytesSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,n),t.remoteId)this.processRemoteInboundStats(t.remoteId,n);else{const r=this.findRemoteStatsId(t.ssrc,si.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,n)}}findRemoteStatsId(t,n){var r;const i=Array.from(Io(r=this.report).call(r)).find(a=>a.type===n&&a.ssrc===t);return i?i.id:null}processVideoMediaSource(t,n){const r=this.report.get(t);r&&r.width&&r.height&&r.framesPerSecond&&(n.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(t,n){const r=this.report.get(t);r&&(n.inputLevel=r.audioLevel)}processVideoTrackSenderStats(t,n,r){var i,a,c,l;const u=n?this.report.get(n):void 0,p=(i=u==null?void 0:u.framesSent)!==null&&i!==void 0?i:t.framesSent;if(typeof p!="number")return;let f=(a=u==null?void 0:u.frameWidth)!==null&&a!==void 0?a:t.frameWidth,m=(c=u==null?void 0:u.frameHeight)!==null&&c!==void 0?c:t.frameHeight,E=(l=u==null?void 0:u.framesPerSecond)!==null&&l!==void 0?l:t.framesPerSecond;if(typeof f=="number"&&typeof m=="number"||(f=0,m=0),E==null){const S=Date.now(),I=this.lastVideoFramesSent.get(r.ssrc);I&&S-I.lts>=800?(E=Math.round((p-I.count)/((S-I.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:p,lts:S,rate:E})):I?E=I.rate:this.lastVideoFramesSent.set(r.ssrc,{count:p,lts:S,rate:0})}r.sentFrame={width:f,height:m,frameRate:Math.max(0,E)}}processVideoTrackReceiverStats(t,n,r){var i,a,c,l,u;const p=n?this.report.get(n):void 0,f=(i=p==null?void 0:p.framesReceived)!==null&&i!==void 0?i:t.framesReceived,m=(a=p==null?void 0:p.frameWidth)!==null&&a!==void 0?a:t.frameWidth,E=(c=p==null?void 0:p.frameHeight)!==null&&c!==void 0?c:t.frameHeight,S=(l=p==null?void 0:p.jitterBufferDelay)!==null&&l!==void 0?l:t.jitterBufferDelay,I=(u=p==null?void 0:p.jitterBufferEmittedCount)!==null&&u!==void 0?u:t.jitterBufferEmittedCount;if(typeof f=="number"){const v=this.lastVideoFramesRecv.get(r.ssrc),y=Date.now();r.framesReceivedCount=f;let b=0;v&&y-v.lts>=800?(b=Math.round((f-v.count)/((y-v.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:f,lts:y,rate:b})):v?b=v.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:f,lts:y,rate:0}),r.receivedFrame={width:m||0,height:E||0,frameRate:b||0},r.decodedFrame={width:m||0,height:E||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:m||0,height:E||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(S&&I){const v=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let y=v.jitterBufferMs;const b=I-v.jitterBufferEmittedCount;b>0&&(y=1e3*(S-v.jitterBufferDelay)/b),r.jitterBufferMs=y,r.currentDelayMs=Math.round(y),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:S,jitterBufferEmittedCount:I,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(t,n,r){var i,a,c,l;const u=n?this.report.get(n):void 0,p=(i=(a=u==null?void 0:u.echoReturnLoss)!==null&&a!==void 0?a:t.echoReturnLoss)!==null&&i!==void 0?i:0,f=(c=(l=u==null?void 0:u.echoReturnLossEnhancement)!==null&&l!==void 0?l:t.echoReturnLossEnhancement)!==null&&c!==void 0?c:0;r.aecReturnLoss=p,r.aecReturnLossEnhancement=f}processAudioTrackReceiverStats(t,n,r){var i,a,c,l,u,p,f;const m=n?this.report.get(n):void 0,E=(i=m==null?void 0:m.removedSamplesForAcceleration)!==null&&i!==void 0?i:t.removedSamplesForAcceleration,S=(a=m==null?void 0:m.totalSamplesReceived)!==null&&a!==void 0?a:t.totalSamplesReceived,I=(c=m==null?void 0:m.jitterBufferDelay)!==null&&c!==void 0?c:t.jitterBufferDelay,v=(l=m==null?void 0:m.jitterBufferEmittedCount)!==null&&l!==void 0?l:t.jitterBufferEmittedCount,y=(u=m==null?void 0:m.audioLevel)!==null&&u!==void 0?u:t==null?void 0:t.audioLevel,b=(p=m==null?void 0:m.totalSamplesDuration)!==null&&p!==void 0?p:t==null?void 0:t.totalSamplesDuration,D=(f=m==null?void 0:m.concealedSamples)!==null&&f!==void 0?f:t.concealedSamples;if(E&&S&&(r.accelerateRate=E/S),I&&v){const F=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let W=F.jitterBufferMs;const q=v-F.jitterBufferEmittedCount;q>0&&(W=1e3*(I-F.jitterBufferDelay)/q),r.jitterBufferMs=Math.round(W),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:I,jitterBufferEmittedCount:v,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=y;let U=1920;b&&S&&(U=S/b/50,r.receivedFrames=Math.round(S/U)),D&&(r.droppedFrames=Math.round(D/U))}processRemoteInboundStats(t,n){const r=this.report.get(t);r&&(n.packetsLost=r.packetsLost,r.roundTripTime&&(n.rttMs=1e3*r.roundTripTime),r.jitter&&(n.jitterMs=1e3*r.jitter),r.timestamp&&(n.timestamp=r.timestamp))}getCodecFromCodecStats(t){const n=this.report.get(t);if(!n)return"";const r=n.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let t=0,n=null,r=null;this.mediaBytesSent.forEach(a=>{t+=a.diffMean()}),this.mediaBytesRetransmit.forEach(a=>{n=n===null?a.diffMean():n+a.diffMean()}),this.mediaBytesTargetEncode.forEach(a=>{r=r===null?a.diffMean():r+a.diffMean()});const i=n!==null?t-n:t;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},n!==null&&(this._stats.bitrate.retransmit=8*n/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}}class yX extends by{updateStats(){return ce.resolve()}}function $m(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const a=function(){const c=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return c&&c[0]?Number(c[0].split("/")[1]):null}();return a?a<76?new vX(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new qk(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(c){return!!window.RTCStatsReport&&c.getStats()instanceof ce}(e)?new qk(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new yX(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}function Jk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Xk(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Jk(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jk(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Mh(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:a,filterAudioFec:c,filterAudioCodec:l,filterVideoCodec:u}=t,{useXR:p}=n;let f=[],m=[],E=[],S=[],I=!1,v=!1;if(jt.parse(e).mediaDescriptions.forEach(b=>{r&&r!==b.attributes.direction||(b.media.mediaType!=="video"||I||(m=b.attributes.payloads,S=b.attributes.extmaps,I=!0),b.media.mediaType!=="audio"||v||(f=b.attributes.payloads,E=b.attributes.extmaps,v=!0))}),!S||m.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!E||f.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(m.forEach(b=>{var D;(D=b.rtpMap)!==null&&D!==void 0&&D.clockRate&&(b.rtpMap.clockRate=parseInt(b.rtpMap.clockRate)),p&&b.rtcpFeedbacks.push({type:"rrtr"})}),f.forEach(b=>{var D;(D=b.rtpMap)!==null&&D!==void 0&&D.clockRate&&(b.rtpMap.clockRate=parseInt(b.rtpMap.clockRate)),p&&b.rtcpFeedbacks.push({type:"rrtr"})}),i&&(f=f.filter(b=>{var D;return((D=b.rtpMap)===null||D===void 0?void 0:D.encodingName.toLowerCase())!=="rtx"}),m=m.filter(b=>{var D;return((D=b.rtpMap)===null||D===void 0?void 0:D.encodingName.toLowerCase())!=="rtx"})),a&&(m=m.filter(b=>{var D;return!/(red)|(ulpfec)|(flexfec)/i.test(((D=b.rtpMap)===null||D===void 0?void 0:D.encodingName)||"")})),c&&(f=f.filter(b=>{var D;return!/(red)|(ulpfec)|(flexfec)/i.test(((D=b.rtpMap)===null||D===void 0?void 0:D.encodingName)||"")})),l&&(l==null?void 0:l.length)>0&&(f=f.filter(b=>{var D;return ue(l).call(l,((D=b.rtpMap)===null||D===void 0?void 0:D.encodingName.toLowerCase())||"")})),u&&(u==null?void 0:u.length)>0){const b=m.filter(D=>{var U;return ue(u).call(u,((U=D.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())||"")});m=b.concat(i?[]:Py(b,m))}const y=L("UNSUPPORTED_VIDEO_CODEC");return y&&y.length>0&&(m=m.filter(b=>!(b.rtpMap&&ue(y).call(y,b.rtpMap.encodingName.toLowerCase())))),{audioCodecs:f,videoCodecs:m,audioExtensions:E,videoExtensions:S}}function Po(e){const t=jt.parse(e);let n,r;for(const i of t.mediaDescriptions){if(!n){const a=i.attributes.iceUfrag,c=i.attributes.icePwd;if(!a||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:a,icePwd:c}}if(!r){const a=i.attributes.fingerprints;a.length>0&&(r={fingerprints:a})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function Ay(e,t){const n=[],r=e.attributes.ssrcGroups.filter(c=>c.semantic==="FID"),i=e.attributes.ssrcGroups.find(c=>c.semantic==="SIM"),a=e.attributes.ssrcs;if(i)i.ssrcIds.forEach(c=>{var l;const u=(l=r.find(p=>p.ssrcIds[0]===c))===null||l===void 0?void 0:l.ssrcIds[1];n.push({ssrcId:c,rtx:t?u:void 0})});else if(r.length>0){const c=r[0].ssrcIds[0],l=r[0].ssrcIds[1];n.push({ssrcId:c,rtx:t?l:void 0})}else{if(a.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:a[0].ssrcId})}return n}function Qk(e,t){const{cname:n}=e;let r;t&&t.ip&&typeof t.port=="number"?(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],T.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),T.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):r=e.iceParameters.candidates.map(l=>({foundation:l.foundation,componentId:"1",transport:l.protocol,priority:l.priority.toString(),connectionAddress:l.ip,port:l.port.toString(),type:l.type,extension:{}}));const i={fingerprints:e.dtlsParameters.fingerprints.map(l=>({hashFunction:l.algorithm,fingerprint:l.fingerprint}))},a={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let c;switch(e.dtlsParameters.role){case"server":c="passive";break;case"client":c="active";break;case"auto":c="actpass"}return{dtlsParameters:i,iceParameters:a,candidates:r,rtpCapabilities:bl(e.rtpCapabilities),setup:c,cname:n}}function mi(e,t,n){const r=[],i=[];return e.forEach(a=>{let{ssrcId:c,rtx:l}=a;const u=Rt(8,"track-"),p={ssrcId:c,attributes:Xk({label:u,mslabel:n=n||Rt(10,""),msid:"".concat(n," ").concat(u)},t&&{cname:t})};if(r.push(p),l!==void 0){const f={ssrcId:l,attributes:Xk({label:u,mslabel:n,msid:"".concat(n," ").concat(u)},t&&{cname:t})};r.push(f),i.push({semantic:"FID",ssrcIds:[c,l]})}}),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map(a=>{let{ssrcId:c}=a;return c})}),{ssrcs:r,ssrcGroups:i}}function Aa(e,t){t instanceof qt&&e.attributes.payloads.forEach(n=>{var r;const i=(r=n.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const a=t._encoderConfig;a&&i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(a.bitrate&&!yt()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*a.bitrate))),a.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(a.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(a.sampleRate)),a.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function e_(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function t_(e,t){var n;if(!(t instanceof wt&&t._encoderConfig&&t._hints.indexOf(Ot.SCREEN_TRACK)===-1))return;const r=t._encoderConfig;Ze().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach(i=>{var a,c;ue(a=["h264","h265","vp8","vp9","av1"]).call(a,((c=i.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),Ze().supportMinBitrate&&!ue(n=t._hints).call(n,Ot.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach(i=>{var a,c;ue(a=["h264","h265","vp8","vp9","av1"]).call(a,((c=i.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(L("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function Oy(e){if(e.media.mediaType!=="video")return;const t=tt();if(t.name!==lt.SAFARI&&t.os!==yn.IOS)return;const n=e.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function Il(e,t,n){if(!t)return;let r,i;if(e.media.mediaType==="video"?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),t.twcc===!0){const a=r.find(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a&&(e.attributes.extmaps.find(l=>l.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||e.attributes.extmaps.push({entry:a.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(l,u){return u.filter(p=>!!l.find(f=>f.payloadType===p.payloadType&&!!f.rtcpFeedbacks.find(m=>m.type==="transport-cc")))}(i,e.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(u=>u.type==="transport-cc")||l.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(t.twcc===!1){const a=e.attributes.extmaps.findIndex(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a!==-1&&e.attributes.extmaps.splice(a,1),e.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(u=>u.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}if(t.remb===!0){const a=r.find(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");a&&(e.attributes.extmaps.find(l=>l.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||e.attributes.extmaps.push({entry:a.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(l,u){return u.filter(p=>!!l.find(f=>f.payloadType===p.payloadType&&!!f.rtcpFeedbacks.find(m=>m.type==="goog-remb")))}(i,e.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(u=>u.type==="goog-remb")||l.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(t.remb===!1){const a=e.attributes.extmaps.findIndex(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");a!==-1&&e.attributes.extmaps.splice(a,1),e.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(u=>u.type==="goog-remb");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}}function Ny(e,t,n){if(yt()||e.media.mediaType!=="video"||!(t instanceof wt)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!L("SIMULCAST")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const r=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],a=e.attributes.ssrcGroups.find(l=>l.semantic==="FID"&&l.ssrcIds[0]===i.ssrcId),c={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let l=1;l<r;l++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+l,attributes:At(i.attributes)}),c.ssrcIds.push(i.ssrcId+l),a&&(e.attributes.ssrcs.push({ssrcId:a.ssrcIds[1]+l,attributes:At(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+l,a.ssrcIds[1]+l]}));e.attributes.ssrcGroups.unshift(c)}async function Dy(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:i,recv:a,sendrecv:c}=function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;const f=Mh(p,l,u,"sendonly"),m=Mh(p,l,u,"recvonly"),E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(so(f,m,"videoExtensions",E,S,I),so(f,m,"videoCodecs",E,S,I),so(f,m,"audioExtensions",E,S,I),so(f,m,"audioCodecs",E,S,I),L("RAISE_H264_BASELINE_PRIORITY")){const v=I.videoCodecs.findIndex(y=>{var b,D;return((b=y.rtpMap)===null||b===void 0?void 0:b.encodingName.toLocaleLowerCase())==="h264"&&((D=y.fmtp)===null||D===void 0?void 0:D.parameters["profile-level-id"])==="42001f"});if(v!==-1){const y=I.videoCodecs.findIndex(b=>{var D;return((D=b.rtpMap)===null||D===void 0?void 0:D.encodingName.toLocaleLowerCase())==="h264"});if(y<v){T.debug("raising H264 baseline profile priority");const b=I.videoCodecs[v];I.videoCodecs.splice(v,1),I.videoCodecs.splice(y,0,b)}y!==-1&&(S.videoCodecs=S.videoCodecs.filter(b=>{var D,U;return!(((D=b.rtpMap)===null||D===void 0?void 0:D.encodingName.toLocaleLowerCase())==="h264"&&((U=b.fmtp)===null||U===void 0?void 0:U.parameters["profile-level-id"])!=="42001f")})),y!==-1&&L("FILTER_SEND_H264_BASELINE")&&(E.videoCodecs=E.videoCodecs.filter(b=>{var D,U;return!(((D=b.rtpMap)===null||D===void 0?void 0:D.encodingName.toLocaleLowerCase())==="h264"&&((U=b.fmtp)===null||U===void 0?void 0:U.parameters["profile-level-id"])!=="42001f")}))}}return{send:E,recv:S,sendrecv:I}}(e,t,r);try{n.close()}catch{}return{send:i,recv:a,sendrecv:c}}function Zk(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Mh(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(so(e,t,"videoExtensions",n,r,i),so(e,t,"videoCodecs",n,r,i),so(e,t,"audioExtensions",n,r,i),so(e,t,"audioCodecs",n,r,i),L("RAISE_H264_BASELINE_PRIORITY")){const a=i.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]==="42001f");if(a!==-1){const c=i.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(c<a){T.debug("raising H264 baseline profile priority");const l=i.videoCodecs[a];i.videoCodecs.splice(a,1),i.videoCodecs.splice(c,0,l)}c!==-1&&(r.videoCodecs=r.videoCodecs.filter(l=>!(l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:r,sendrecv:i}}function so(e,t,n,r,i,a){if(n==="videoExtensions"||n==="audioExtensions"){const c=[];return e[n].forEach(l=>{t[n].some((u,p)=>{if(l.entry===u.entry&&l.extensionName===u.extensionName)return c.push(p),!0})?a[n].push(l):r[n].push(l)}),void t[n].forEach((l,u)=>{c.indexOf(u)===-1&&i[n].push(l)})}if(n==="videoCodecs"||n==="audioCodecs"){const c=[];return e[n].forEach(l=>{t[n].some((u,p)=>{if(l.payloadType===u.payloadType&&JSON.stringify(l)===JSON.stringify(u))return c.push(p),!0})?a[n].push(l):r[n].push(l)}),void t[n].forEach((l,u)=>{c.indexOf(u)===-1&&i[n].push(l)})}}function bl(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,a;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=r,n?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...n.audioCodecs,...r.audioCodecs],a.videoCodecs=[...n.videoCodecs,...r.videoCodecs],a.audioExtensions=[...n.audioExtensions,...r.audioExtensions],a.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):a=r,{send:i,recv:a}}function Lo(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function n_(e){e.mediaDescriptions.forEach(t=>{t.media.mediaType!=="video"&&t.media.mediaType!=="audio"||t.attributes.payloads.forEach(n=>{n.rtcpFeedbacks.findIndex(r=>r.type==="rrtr")===-1&&n.rtcpFeedbacks.push({type:"rrtr"})})})}function zc(e,t,n,r){let i=[];if(e===ye.VIDEO){if(L("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(i=t.videoCodecs.filter(a=>{var c;return ue(c=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(c,r)&&a&&a.fmtp&&a.fmtp.parameters["profile-level-id"]===L("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||i.length===0){let a=[];const c=[],l=[],u=[];if(n.videoCodecs.forEach(p=>{const f=p.rtpMap&&p.rtpMap.encodingName.toLowerCase()||"";ue(f).call(f,r)?a.push(p):ue(f).call(f,"vp9")?c.push(p):ue(f).call(f,"vp8")?l.push(p):ue(f).call(f,"h264")&&u.push(p)}),a.length===0){let p="";c.length!==0?(a=c,p="vp9"):l.length!==0?(a=l,p="vp8"):u.length!==0&&(a=u,p="h264"),T.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(p))}a.length!==0&&(i=t.videoCodecs.filter(p=>a.some(f=>f.payloadType===p.payloadType)))}if(i.length===0&&(T.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),L("USE_PUB_RTX")||L("USE_SUB_RTX")){const a=Py(i,t.videoCodecs);i=[...i,...a]}}else i=t.audioCodecs.filter(a=>{var c;return ue(c=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(c,r)}),i.length===0&&(T.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter(a=>{var c;return ue(c=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")}));return i}function Py(e,t){const n=e.map(r=>r.payloadType.toString());return t.filter(r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&ue(n).call(n,r.fmtp&&r.fmtp.parameters.apt))}let $k=class{get localCapabilities(){return At(this._localCapabilities)}get rtpCapabilities(){return At(this._rtpCapabilities)}get candidates(){return At(this._candidates)}get iceParameters(){return At(this._iceParameters)}get dtlsParameters(){return At(this._dtlsParameters)}constructor(e){w(this,"sessionDesc",void 0),w(this,"_localCapabilities",void 0),w(this,"_rtpCapabilities",void 0),w(this,"_candidates",void 0),w(this,"_iceParameters",void 0),w(this,"_dtlsParameters",void 0),w(this,"setup",void 0),w(this,"currentMidIndex",void 0),w(this,"cname","o/i14u9pJrxRKAsu"),w(this,"firefoxSsrcMidMap",new Map),e=At(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,localCapabilities:a,direction:c,setup:l,videoCodec:u,audioCodec:p}=e;let f;this.setup=l,f=c===Er.RECEIVE_ONLY?jt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):jt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=a;const m=c===Er.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,E=c===Er.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,S=c===Er.RECEIVE_ONLY?i.send.videoCodecs:zc(ye.VIDEO,m,E,u),I=c===Er.RECEIVE_ONLY?i.send.audioCodecs:zc(ye.AUDIO,m,E,p);for(const v of f.mediaDescriptions)v.attributes.iceUfrag=t.iceUfrag,v.attributes.icePwd=t.icePwd,v.attributes.fingerprints=n.fingerprints,v.attributes.candidates=r,v.attributes.setup=this.setup,v.media.mediaType==="application"&&(v.attributes.sctpPort="5000"),v.media.mediaType==="video"&&(v.media.fmts=S.map(y=>y.payloadType.toString(10)),v.attributes.payloads=S,v.attributes.extmaps=m.videoExtensions),v.media.mediaType==="audio"&&(v.media.fmts=I.map(y=>y.payloadType.toString(10)),v.attributes.payloads=I,v.attributes.extmaps=m.audioExtensions,Lo(v));this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}toString(){return jt.print(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,r,i){n=n.replace(/ /g,"-");const{ssrcs:a,ssrcGroups:c}=mi(t,this.cname,L("SYNC_GROUP")?n:void 0),l=this.findPreloadMediaDesc(a);if(l){if(yt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,l.attributes.mid),i&&(i.twcc||i.remb)){const u=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(l,i),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{const u=this.findAvailableMediaIndex(e,a,r);let p;return u===-1?(p=this.createOrRecycleSendMedia(e,a,c,"sendonly",r,i),this.updateBundleMids()):(p=At(this.sessionDesc.mediaDescriptions[u]),p.attributes.direction="sendonly",p.attributes.ssrcs=a,p.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(p,i)),yt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,p.attributes.mid),{needExchangeSDP:!0,mid:p.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const r=[];return e.forEach(i=>{const a=i._mediaStreamTrack.kind,c=this.findAvailableRecvMediaIndex(a);let l,u=!1;c===-1?(u=!0,l=this.createOrRecycleRecvMedia(i,[],"recvonly",t,n),this.updateBundleMids()):(l=At(this.sessionDesc.mediaDescriptions[c]),l.attributes.direction="recvonly"),r.push({mid:l.attributes.mid,needCreateTransceiver:u})}),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:r,port:i,type:a,relatedAddress:c,relatedPort:l,priority:u}=new RTCIceCandidate(e),p={foundation:t??"",componentId:"1",transport:n??"",priority:u?u+"":"",connectionAddress:r??"",port:i?i+"":"",type:a?a+"":"",relAddr:c??"",relPort:l?l+"":"",extension:{}};this.candidates.some(f=>f.priority===p.priority&&f.connectionAddress===p.connectionAddress&&f.port===p.port)||(this._candidates.push(p),this.sessionDesc.mediaDescriptions.forEach(f=>{f.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,i){const a=e._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,l=zc(a,c,this.localCapabilities.send,a===ye.AUDIO?i:r),u=a===ye.VIDEO?c.videoExtensions:c.audioExtensions,p="".concat(++this.currentMidIndex);let f={media:{mediaType:a,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};f=this.mungRecvMediaDsec(f,e);const m=this.findFirstClosedMedia(a);if(m){const E=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[E]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>ue(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>ue(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(yt()){if(i){const a=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(a||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!a||a!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=At(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,r,i,a){const c=this.rtpCapabilities.send,l=e===ye.VIDEO?c.videoCodecs:c.audioCodecs,u=e===ye.VIDEO?c.videoExtensions:c.audioExtensions;yt()&&(i="".concat(++this.currentMidIndex));let p={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};p=this.mungSendMediaDesc(p,a);const f=this.findFirstClosedMedia(e);if(f){const m=this.sessionDesc.mediaDescriptions.indexOf(f);this.sessionDesc.mediaDescriptions[m]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}mungRecvMediaDsec(e,t,n){const r=At(e);return e_(r),Aa(r,t),t_(r,t),Oy(r),Il(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=At(e);return Il(n,t,this.localCapabilities.recv),Lo(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(n!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>yt()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const CX=["sdp"];var Pt;function e2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Oa(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?e2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let t2=(Pt=class xl extends x1{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),w(this,"direction",void 0),w(this,"name",void 0),w(this,"store",void 0),w(this,"spec",void 0),w(this,"peerConnection",void 0),w(this,"initialOffer",void 0),w(this,"transport",void 0),w(this,"statsFilter",void 0),w(this,"localCandidateCount",0),w(this,"_isInRestartIce",!1),w(this,"mutex",new On("P2PConnection-mutex")),w(this,"onLocalCandidate",void 0),w(this,"remoteSDP",void 0),w(this,"pendingCandidates",[]),w(this,"localCapabilities",void 0),w(this,"isReady",!1),w(this,"restartCnt",0),w(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.peerConnection=new RTCPeerConnection(xl.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??Er.SEND_ONLY,this.name=this.direction===Er.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=$m(this.peerConnection,L("STATS_UPDATE_INTERVAL"),void 0,yt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await Dy();if(this.localCapabilities=bl(n),t){const{sdp:r}=t,i=SX(t,CX),a=function(){const f={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},m=Mh(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(so(m,f,"videoExtensions",E,S,I),so(m,f,"videoCodecs",E,S,I),so(m,f,"audioExtensions",E,S,I),so(m,f,"audioCodecs",E,S,I),L("RAISE_H264_BASELINE_PRIORITY")){const v=I.videoCodecs.findIndex(y=>y.rtpMap&&y.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&y.fmtp&&y.fmtp.parameters["profile-level-id"]==="42001f");if(v!==-1){const y=I.videoCodecs.findIndex(b=>b.rtpMap&&b.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(y<v){T.debug("raising H264 baseline profile priority");const b=I.videoCodecs[v];I.videoCodecs.splice(v,1),I.videoCodecs.splice(y,0,b)}y!==-1&&L("FILTER_SEND_H264_BASELINE")&&(E.videoCodecs=E.videoCodecs.filter(b=>!(b.rtpMap&&b.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&b.fmtp&&b.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:E,recv:S,sendrecv:I}}({},{},r);this.remoteSDP=new $k({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:a,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const c=await this.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const l=Po(c.sdp);await this.peerConnection.setLocalDescription(c);const u=await Zk({},{},c.sdp);this.localCapabilities=bl(u);const p=this.peerConnection.getTransceivers()[0];return p!=null&&p.receiver&&p.receiver.transport&&this.tryBindTransportEvents(p.receiver.transport),Oa(Oa({},l),{},{sdp:c.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Po(r.sdp);return this.initialOffer=r,Oa(Oa({},i),{},{sdp:r.sdp})}}catch(n){throw new J(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:r,dtlsParameters:i}=t,a=await Zk({},{},n);this.remoteSDP=new $k({remoteIceParameters:r,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:a,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const c=this.peerConnection.getTransceivers()[0];c!=null&&c.sender&&c.sender.transport&&this.tryBindTransportEvents(c.sender.transport)}catch(n){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new J(O.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,r){var i=this;return qr(function*(){const a=yield Be(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=i.remoteSDP.receive(t,n,r);t.forEach((y,b)=>{if(l[b].needCreateTransceiver){const D=i.peerConnection.addTransceiver(y._mediaStreamTrack,{direction:"sendonly"});c.push(D),y._updateRtpTransceiver(D)}else{const D=i.peerConnection.getTransceivers().find(U=>U.mid===l[b].mid);if(!D)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(l[b].mid));c.push(D),y._updateRtpTransceiver(D)}}),yt()&&L("SIMULCAST")===!0&&(yield Be(i.applySimulcastForFirefox(c,t)));const u=l.map(y=>y.mid),p=yield Be(i.peerConnection.createOffer()),f=i.mungSendOfferSDP(p.sdp,t,u),m=jt.parse(f),E=u.map(y=>{const b=m.mediaDescriptions.find(D=>D.attributes.mid===y);if(!b)throw new Error("Cannot extract ssrc from mediaDescription.");return Ay(b,L("USE_PUB_RTX"))}),S=c.map((y,b)=>{const D=u[b];return{localSSRC:E[b],id:D}});yield Be(i.peerConnection.setLocalDescription({type:"offer",sdp:f}));try{yield S}catch(y){const b=i.remoteSDP.toString();throw yield Be(i.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Be(i.peerConnection.setRemoteDescription({type:"answer",sdp:b})),yield Be(i.stopSending(u,!0)),y}yield Be(i.applySimulcastEncodings(c,t)),yield Be(i.applySendEncodings(c,t));const I=i.remoteSDP.toString(),v=i.logSDPExchange(f,"offer","local","send");return v==null||v(I),yield Be(i.setRemoteDescription({type:"answer",sdp:I})),c.map((y,b)=>{const D=u[b];return{localSSRC:E[b],id:D}})}catch(c){throw c instanceof J?c:new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(u=>t.indexOf(u.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));i.map(u=>{var p;u.direction="inactive",(p=u.stop)===null||p===void 0||p.call(u)});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const l=this.remoteSDP.toString();c==null||c(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(t,n,r,i);if(c){const u=this.remoteSDP.toString(),p=this.logSDPExchange(u,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:u});const f=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(f.sdp,a,t);p==null||p(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(u=>u.mid===a);if(!l||l.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,mid:l.mid,transceiver:l}}catch(a){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async mockReceive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(t,n,r,i);if(c){const l=this.remoteSDP.toString(),u=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});const p=await this.peerConnection.createAnswer(),f=this.mungReceiveAnswerSDP(p.sdp,a,t);u==null||u(f||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:f}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(a){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===Ac.Auto&&(this.store.p2pTransport=Ac.SdRtn,Ze().supportPCSetConfiguration&&this.peerConnection.setConfiguration(xl.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Ze().supportPCSetConfiguration&&this.peerConnection.setConfiguration(xl.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:r}=Po(n.sdp);return this.store.descriptionStart(),this.direction===Er.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Er.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:r}=Po(n.sdp);return await this.peerConnection.setLocalDescription(n),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const a=this.remoteSDP.toString(),c=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),c==null||c(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(r){throw new J(O.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?yt()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:Oa(Oa({},Es),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Oa(Oa({},Es),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;ue(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i={iceServers:[]};var a;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Yd(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...xl.turnServerConfigToIceServers(t.turnServer.servers,n,r)),L("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...xl.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),ue(a=[Ac.Relay,Ac.SdRtn]).call(a,n)&&(i.iceTransportPolicy="relay"),L("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(i.iceTransportPolicy="relay")}))),L("ENABLE_ENCODED_TRANSFORM")&&Ze().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),T.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=[],a=t.filter(l=>l.tcpport);T.debug("P2PConnection turnServers is ".concat(a,", current index is ").concat(r));const c=a.length>r?a[r]:a[0];switch(n){case Ac.SdRtn:const l=t.filter(p=>{var f;return ue(f=p.username).call(f,"glb:")&&p.turnServerURL==p.turnServerURL}),u=l.length>r?l[r]:l[0];u&&(i.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(Ta(u.turnServerURL),":").concat(u.tcpport,"?transport=udp")}),i.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(Ta(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}));break;case Ac.Relay:c&&(i.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),i.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Ta(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;default:c&&(i.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),i.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Ta(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}),i.push({username:c.username,credential:c.password,credentialType:"password",urls:"stun:".concat(c.turnServerURL,":").concat(c.tcpport)}))}return i}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in r?r.error:r)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const r=t==null?void 0:t.iceTransport.state;var i;r&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,r))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:r,remote:i}=n.getSelectedCandidatePair();T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find(f=>f.track===t._mediaStreamTrack)),!n)return T.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ze().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},a={};switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(t._encoderConfig){var c;const{bitrateMax:f,frameRate:m,scaleResolutionDownBy:E}=t._encoderConfig;f&&(a.maxBitrate=1e3*f),ue(c=t._hints).call(c,Ot.LOW_STREAM)&&(m&&(a.maxFramerate=Lr(m)),E&&E>=1&&(a.scaleResolutionDownBy=E))}if(L("DSCP_TYPE")&&pa()){var l;const f=L("DSCP_TYPE");ue(l=["very-low","low","medium","high"]).call(l,f)&&(a.networkPriority=f)}const u=n.getParameters(),p=(r=u.encodings)===null||r===void 0?void 0:r[0];yt()&&!p&&(i.encodings=[a]),p&&Object.assign(p,a),Object.assign(u,i),T.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(u.encodings))),await n.setParameters(u)}async applySendEncodings(t,n){try{if(!Ze().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],a=n[r];a instanceof wt&&!this.isVP8Simulcast(a)&&await this.updateRtpSenderEncodings(a,i.sender)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const i=jt.parse(t);return n.forEach((a,c)=>{const l=r[c],u=i.mediaDescriptions.find(p=>p.attributes.mid===l);u&&(Aa(u,a),Ny(u,a,this.store.codec))}),jt.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let u=0;u<t.length;u++){var r,i,a,c,l;const p=t[u],f=n[u];if(f instanceof wt&&!ue(r=f._hints).call(r,Ot.LOW_STREAM)&&(i=f._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((a=f._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(c=f._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=f._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const m={},E={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const S=p.sender.getParameters();await p.sender.setParameters(Object.assign(S,m))}}}async applySimulcastEncodings(t,n){if(!yt()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof wt&&this.isVP8Simulcast(i)){const a=t[r],c={},l={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const u=a.sender.getParameters();await a.sender.setParameters(Object.assign(u,c))}}}isVP8Simulcast(t){var n,r,i,a,c;return!!(t instanceof wt&&L("SIMULCAST")&&this.store.codec==="vp8"&&!ue(n=t._hints).call(n,Ot.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(a=t._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=t._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(L("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",r==="local"?"remote":"local",i)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const a=this.remoteSDP.toString();i==null||i(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async c=>{c.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const a=this.remoteSDP.toString();i==null||i(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var r,i;if(n=(r=n)!==null&&r!==void 0?r:(i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp){var a;const c=(a=jt.parse(n).mediaDescriptions.find(l=>l.attributes.mid===t))===null||a===void 0?void 0:a.attributes.ssrcs;return c==null?void 0:c[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),ue(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,r){const i=jt.parse(t),a=i.mediaDescriptions.find(c=>c.attributes.mid===n);return a&&r===ye.AUDIO&&a.media.mediaType==="audio"&&Lo(a),jt.print(i)}},se(Pt.prototype,"establish",[ao],Object.getOwnPropertyDescriptor(Pt.prototype,"establish"),Pt.prototype),se(Pt.prototype,"connect",[ao],Object.getOwnPropertyDescriptor(Pt.prototype,"connect"),Pt.prototype),se(Pt.prototype,"receive",[ao],Object.getOwnPropertyDescriptor(Pt.prototype,"receive"),Pt.prototype),se(Pt.prototype,"mockReceive",[ao],Object.getOwnPropertyDescriptor(Pt.prototype,"mockReceive"),Pt.prototype),se(Pt.prototype,"stopReceiving",[ao],Object.getOwnPropertyDescriptor(Pt.prototype,"stopReceiving"),Pt.prototype),se(Pt.prototype,"restartICE",[ao],Object.getOwnPropertyDescriptor(Pt.prototype,"restartICE"),Pt.prototype),se(Pt.prototype,"close",[ao],Object.getOwnPropertyDescriptor(Pt.prototype,"close"),Pt.prototype),se(Pt.prototype,"updateEncoderConfig",[ao],Object.getOwnPropertyDescriptor(Pt.prototype,"updateEncoderConfig"),Pt.prototype),se(Pt.prototype,"updateSendParameters",[ao],Object.getOwnPropertyDescriptor(Pt.prototype,"updateSendParameters"),Pt.prototype),se(Pt.prototype,"replaceTrack",[ao],Object.getOwnPropertyDescriptor(Pt.prototype,"replaceTrack"),Pt.prototype),se(Pt.prototype,"muteLocal",[ao],Object.getOwnPropertyDescriptor(Pt.prototype,"muteLocal"),Pt.prototype),se(Pt.prototype,"unmuteLocal",[ao],Object.getOwnPropertyDescriptor(Pt.prototype,"unmuteLocal"),Pt.prototype),Pt);function ao(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,a=await i.lock("From P2PConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await r.apply(this,l)}finally{a()}},n}function Ly(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=Lr(t.width),r.height=Lr(t.height);const i=Lr(t.framerate||15);document.body.append(n),document.body.append(r);let a=e._mediaStreamTrack;n.srcObject=new MediaStream([a]),n.play();const c=r.getContext("2d");if(!c)throw new B(O.UNEXPECTED_ERROR,"can not get canvas context");const l=Ze(),u=r.captureStream(l.supportRequestFrame?0:i).getVideoTracks()[0];u.canvas||(u.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const f=n.videoWidth,m=n.videoHeight/f,E=r.width*m;Math.abs(E-r.height)>=2&&(T.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(E)),r.height=E)}c.drawImage(n,0,0,r.width,r.height),u.requestFrame&&u.requestFrame(),a!==e._mediaStreamTrack&&(a=e._mediaStreamTrack,n.srcObject=new MediaStream([a]))},r.stopCapture=fy(()=>r.startCapture&&r.startCapture(),i);const p=u.stop;return u.stop=()=>{p.call(u),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),T.debug("clean low stream renderer")},u}var r_=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(r_||{}),In=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e}(In||{}),Yc=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(Yc||{}),tr=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e}(tr||{}),qc=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(qc||{}),n2=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(n2||{}),Na=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e}(Na||{}),co=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e}(co||{}),r2=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(r2||{}),Di=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e}(Di||{});const Bs=1e3,Jc=3;function He(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function i2(e){const t={[Di.CONN_TYPE]:0,[Di.RTT]:e.rtt};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[Di.CONN_TYPE]=1),n==="tcp"&&(t[Di.CONN_TYPE]=3),n==="tls"&&(t[Di.CONN_TYPE]=4);break}case"srflx":t[Di.CONN_TYPE]=2}return t}function o2(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class s2 extends xt{constructor(t){super(),w(this,"store",void 0),w(this,"uploadWRTCStatsTimer",void 0),w(this,"uploadOutboundDenoiserStatsTimer",void 0),w(this,"uploadExtStatsTimer",void 0),w(this,"uploadExtUsageStatsTimer",void 0),w(this,"uploadInboundExtStatsTimer",void 0),w(this,"requestStats",void 0),w(this,"requestTransportStats",void 0),w(this,"requestLocalMedia",void 0),w(this,"requestRemoteMedia",void 0),w(this,"requestAllTracks",void 0),w(this,"requestVideoIsReady",void 0),w(this,"requestUploadStats",void 0),w(this,"requestUpload",void 0),w(this,"uploadOutboundStarted",!1),w(this,"uploadInboundStarted",!1),w(this,"uploadTransportStarted",!1),w(this,"uploadExtensionUsageStarted",!1),w(this,"lastRecvStats",void 0),w(this,"lastSendStats",void 0),w(this,"lastFullRecvStats",void 0),w(this,"lastFullSendStats",void 0),w(this,"needUploadRenderFreezeTime",!0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;let n,r;if(this.uploadTransportStarted&&(n=this.requestStats(),this.store.useP2P&&(r=this.requestStats(!0))),!n&&this.uploadOutboundStarted&&(n=this.requestStats()),!r&&this.uploadInboundStarted&&(r=this.requestStats(!0)),n||r){const i={};if(this.uploadTransportStarted&&n){const a=this.getTransportStats(n,r,t);a&&(i.misc=[a])}if(this.uploadOutboundStarted&&n){const a=this.getOutboundStats(n,t?this.lastSendStats:this.lastFullSendStats,t);a&&(i.outbound=[a])}if(this.uploadInboundStarted&&r){const a=this.getInboundStats(r,t?this.lastRecvStats:this.lastFullRecvStats,t);a&&(i.inbound=a)}this.requestUploadStats(i)}this.lastRecvStats=r,this.lastSendStats=n,t||(this.lastFullRecvStats=r,this.lastFullSendStats=n)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(t!==Jc),++t===Jc+1&&(t=1)},Bs)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(t,n,r){if(!this.requestStats)return;if(r)return t.rtt==null?void 0:{addition:{[Di.RTT]:t.rtt,[Di.CONN_TYPE]:void 0}};const i=i2(t);if(this.store.useP2P){if(n){const a=i2(n);i[Di.CONN_TYPE]+=a[Di.CONN_TYPE]<<3}i[Di.CONN_TYPE]+=110}else i[Di.CONN_TYPE]+=100;return{addition:i}}getOutboundStats(t,n,r){if(!this.requestUploadStats||!this.requestLocalMedia)return;const i=this.requestLocalMedia();if(!i||i.length===0)return;let a,c,l;return i.forEach(u=>{let[p,{track:f,ssrcs:m}]=u;switch(p){case re.LocalVideoLowTrack:case re.LocalVideoTrack:if(p===re.LocalVideoTrack){const E=function(v,y,b,D,U){const F=y.videoSend.find(_e=>_e.ssrc===v);if(!F)return;const W={},{sentFrame:q,inputFrame:Q}=F;if(Q&&q){const _e=Q.frameRate,Qe=q.frameRate;W[In.FREEZE]=function(ct,Nt){let dn=!0;return dn=!(ct<=5)&&(ct<=10?Nt<3:ct<=20?Nt<4:Nt<5),dn}(_e,Qe)?1:0}if(He(W,In.QP_SUM,F.qpSumPerFrame),U)return W;switch(q&&(He(W,In.HEIGHT,q.height),He(W,In.WIDTH,q.width),He(W,In.FRAME_RATE,q.frameRate)),W[In.DISABLED]=D._originMediaStreamTrack&&!D._originMediaStreamTrack.enabled||D._mediaStreamTrack&&!D._mediaStreamTrack.enabled?1:0,F.adaptionChangeReason){case"none":W[In.ADAPTATION]=0;break;case"cpu":W[In.ADAPTATION]=1;break;case"bandwidth":W[In.ADAPTATION]=2;break;case"other":W[In.ADAPTATION]=3}let ee=0;F.adaptionChangeReason&&(ee+=o2(F.adaptionChangeReason)),y.qualityLimitationReason&&(ee+=o2(y.qualityLimitationReason)<<3),W[In.ADAPTATION]=ee,W[In.PLAYER_STATUS]=hy[D._player?D._player.videoElementStatus:"uninit"],He(W,In.NACKS,F.nacksCount),He(W,In.PLIS,F.plisCount),He(W,In.FIRS,F.firsCount),He(W,In.AVG_ENCODE,F.avgEncodeMs);const ne=b&&b.videoSend.find(_e=>_e.ssrc===v);if(ne){let _e=U?Bs:Bs*Jc;ne.timestamp&&F.timestamp&&(_e=F.timestamp-ne.timestamp),ne.packets!=null&&F.packets!=null&&He(W,In.PACKAGE_RATE,1e3*(F.packets-ne.packets)/_e),F.packetsLost!=null&&ne.packetsLost!=null&&He(W,In.PACKAGE_LOST,F.packetsLost-ne.packetsLost),ne.bytes!=null&&F.bytes!=null&&He(W,In.BITRATE,8*(F.bytes-ne.bytes)/_e)}return W}(m[0].ssrcId,t,n,f,r),S=r?null:function(v,y,b){const D=y.videoSend.find(ee=>ee.ssrc===v);if(!D)return null;const U={},F=D.inputFrame,W=F&&F.height||b&&b.videoHeight||0,q=F&&F.width||b&&b.videoWidth||0,Q=F&&F.frameRate||0;return He(U,r_.HEIGHT,W),He(U,r_.WIDTH,q),He(U,r_.FRAME_RATE,Q),U}(m[0].ssrcId,t,f),I=r?null:function(v){const y={};return He(y,In.RETRANSMIT,v.bitrate.retransmit),He(y,In.TARGET_ENCODED,v.bitrate.targetEncoded),He(y,In.ACTUAL_ENCODED,v.bitrate.actualEncoded),He(y,In.TRANSMIT,v.bitrate.transmit),He(y,In.BANDWIDTH,v.sendBandwidth),y}(t);c=Object.assign({},E,S,I)}else l=r?void 0:function(E,S,I){const v=S.videoSend.find(D=>D.ssrc===E);if(!v)return;const y={},b=v.sentFrame;if(b&&(He(y,Yc.HEIGHT,b.height),He(y,Yc.WIDTH,b.width),He(y,Yc.FRAME_RATE,b.frameRate)),I){const D=I.videoSend.find(U=>U.ssrc===E);if(D){let U=Bs*Jc;D.timestamp&&v.timestamp&&(U=v.timestamp-D.timestamp),D.packets!=null&&v.packets!=null&&He(y,Yc.PACKAGE_RATE,1e3*(v.packets-D.packets)/U),v.packetsLost!=null&&D.packetsLost!=null&&He(y,Yc.PACKAGE_LOST,v.packetsLost-D.packetsLost),D.bytes!=null&&v.bytes!=null&&He(y,Yc.BITRATE,8*(v.bytes-D.bytes)/U)}}return y}(m[0].ssrcId,t,n);break;case re.LocalAudioTrack:a=r?void 0:function(E,S,I,v){const y=S.audioSend.find(W=>W.ssrc===E);if(!y)return;const b={};b[Na.DISABLED]=v._originMediaStreamTrack&&!v._originMediaStreamTrack.enabled||v._mediaStreamTrack&&!v._mediaStreamTrack.enabled?1:0;const D=100*v._source.getAccurateVolumeLevel(),U=y.inputLevel;if(U!=null){const W=Math.ceil(50*Math.log10(100*U+1));He(b,Na.LEVEL,W)}He(b,n2.PCM_LEVEL,D),He(b,Na.AEC_RETURN_LOSS,y.aecReturnLoss),He(b,Na.AEC_RETURN_LOSS_ENH,y.aecReturnLossEnhancement),b[Na.FREEZE]=0;const F=I&&I.audioSend.find(W=>W.ssrc===E);if(F){let W=Bs*Jc;F.timestamp&&y.timestamp&&(W=y.timestamp-F.timestamp),F.bytes!=null&&y.bytes!=null&&He(b,Na.BITRATE,8*(y.bytes-F.bytes)/W),F.packets!=null&&y.packets!=null&&He(b,Na.PACKAGE_RATE,1e3*(y.packets-F.packets)/W)}return b}(m[0].ssrcId,t,n,f)}}),{high:c,low:l,audio:a}}getInboundStats(t,n,r){if(!this.requestRemoteMedia)return;const i=this.requestRemoteMedia()||[],a=[];return i.forEach(c=>{let[l,u]=c;const p={peer:l.uid};if(u.has(ye.VIDEO)&&l.videoTrack){const f=l._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(l._videoSSRC)||!1,m=l.videoTrack?function(E,S,I,v,y,b,D){var U;const F=S.videoRecv.find(Qe=>Qe.ssrc===E);if(!F)return;const W={},{receivedFrame:q,outputFrame:Q,decodeFrameRate:ee}=F,ne=I&&I.videoRecv.find(Qe=>Qe.ssrc===E);if(W[tr.FREEZE]=y&&xh.isRemoteVideoFreeze(v,F,ne)?1:0,He(W,qc.FRAME_RATE_DECODE,ee),He(W,tr.QP_SUM,F.qpSumPerFrame),F.framesRateFirefox&&He(W,tr.FRAME_RATE,F.framesRateFirefox),q&&He(W,tr.FRAME_RATE,q.frameRate),ne){const Qe=S.timestamp-I.timestamp||(D?Bs:Jc*Bs);F.packetsLost!=null&&ne.packetsLost!=null&&He(W,tr.PACKAGE_LOST,F.packetsLost-ne.packetsLost),ne.bytes!=null&&F.bytes!=null&&He(W,tr.BITRATE,8*(F.bytes-ne.bytes)/Qe),ne.packets!=null&&F.packets!=null&&He(W,tr.PACKAGE_RATE,1e3*(F.packets-ne.packets)/Qe)}if(D)return W;q?(He(W,tr.HEIGHT,q.height),He(W,tr.WIDTH,q.width)):v&&(He(W,tr.HEIGHT,v._videoHeight||0),He(W,tr.WIDTH,v._videoWidth||0)),Q&&He(W,qc.FRAME_RATE_OUTPUT,Q.frameRate);const _e=(U=v._player)===null||U===void 0?void 0:U.rendFrameRate.toFixed(0);if(_e&&He(W,qc.FRAME_RATE_RENDER,+_e),He(W,tr.JITTER_BUFFER,F.jitterBufferMs),He(W,tr.CURRENT_DELAY,F.currentDelayMs),He(W,tr.FIRS,F.firsCount),He(W,tr.NACKS,F.nacksCount),He(W,tr.PLIS,F.plisCount),v){W[tr.DISABLED]=v._originMediaStreamTrack.enabled&&v._mediaStreamTrack.enabled?0:1;const Qe=v._player;if(Qe){const{freezeTimeCounterList:ct,renderFreezeAccTime:Nt,videoElementStatus:dn}=Qe;if(ct&&ct.length>0&&He(W,qc.FREEZE_TIME,ct.splice(0,1)[0]),b&&Fs.visibility==="visible"&&dn===dr.PLAYING&&Ze().supportRequestVideoFrameCallback){const Gt=Math.min(6e3,Nt);Qe.renderFreezeAccTime=Math.max(0,Nt-Gt),He(W,qc.FREEZE_TIME_RENDER,Gt)}if(typeof F.totalFreezesDuration=="number"){const Gt=ne&&ne.totalFreezesDuration?F.totalFreezesDuration-ne.totalFreezesDuration:F.totalFreezesDuration;He(W,qc.FREEZE_DURATION,1e3*Gt)}}}if(W[tr.PLAYER_STATUS]=hy[v._player?v._player.videoElementStatus:"uninit"],ne&&F.totalInterFrameDelay!==void 0&&F.totalSquaredInterFrameDelay!==void 0&&ne.totalInterFrameDelay!==void 0&&ne.totalSquaredInterFrameDelay!==void 0){const Qe=F.totalInterFrameDelay-ne.totalInterFrameDelay,ct=F.totalSquaredInterFrameDelay-ne.totalSquaredInterFrameDelay,Nt=F.framesDecodeCount-ne.framesDecodeCount,dn=Qe/Nt*1e3,Gt=Math.round(1e3*Math.sqrt((ct-Math.pow(Qe,2)/Nt)/Nt));!isNaN(Gt)&&dn+Gt>Math.max(3*dn,dn+150)&&(W[tr.I_FRAME_DELAY]=Gt)}return W}(l._videoSSRC,t,n,l.videoTrack,f===!0,this.needUploadRenderFreezeTime,r):void 0;m&&(p.video=m)}if(u.has(ye.AUDIO)&&l.audioTrack){const f=l.audioTrack?function(m,E,S,I,v){const y=E.audioRecv.find(ne=>ne.ssrc===m);if(!y)return;const b={},D=S&&S.audioRecv.find(ne=>ne.ssrc===m),{receivedFrames:U,droppedFrames:F}=y;var W,q;if(He(b,co.JITTER,y.jitterMs),U!=null&&F!=null&&(b[co.FREEZE]=(q=F,(W=U)===0||100*q/W>20?1:0)),D){const ne=E.timestamp-S.timestamp||(v?Bs:Bs*Jc);y.packets!=null&&D.packets!=null&&He(b,co.PACKAGE_RATE,1e3*(y.packets-D.packets)/ne),D.bytes!=null&&y.bytes!=null&&He(b,co.BITRATE,8*(y.bytes-D.bytes)/ne),y.packetsLost!=null&&D.packetsLost!=null&&He(b,co.PACKAGE_LOST,y.packetsLost-D.packetsLost)}if(v)return b;const Q=100*I._source.getAccurateVolumeLevel(),ee=y.outputLevel;if(ee!=null){const ne=Math.ceil(50*Math.log10(100*ee+1));He(b,r2.LEVEL,ne)}if(He(b,co.PCM_LEVEL,Q),I&&(b[co.DISABLED]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1),He(b,co.JITTER_BUFFER,y.jitterBufferMs),He(b,co.CURRENT_DELAY,y.jitterBufferMs),b[co.PLAYER_STATUS]=hy[Ir.getPlayerState(I.getTrackId())],D){const ne=y.concealedSamples-D.concealedSamples;ne>0&&He(b,co.CONCEALED_SAMPLES,ne)}return b}(l._audioSSRC,t,n,l.audioTrack,r):void 0;f&&(p.audio=f)}(p.video||p.audio)&&a.push(p)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,a}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof qm);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(Nc.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,r]=t;r.has(ye.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}),r.has(ye.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),r={connectionInterval:L("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let i=[];const a=this.requestAllTracks&&this.requestAllTracks()||[];for(const p of a)!p.muted&&p.enabled&&(i=i.concat(await p.getProcessorUsage()));const c=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[p,f]of c)f.has(ye.VIDEO)&&p.videoTrack&&(i=i.concat(await p.videoTrack.getProcessorUsage())),f.has(ye.AUDIO)&&p.audioTrack&&(i=i.concat(await p.audioTrack.getProcessorUsage()));if(i.length===0)return;r.details=function(p,f){const m={};for(const{id:v,value:y,level:b,direction:D}of p){var E;const U=(E=f.get(v))!==null&&E!==void 0?E:0,F=y===2?U+L("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:U;var S,I;f.set(v,F),m[v]?(y===2&&(m[v].value=y),b>m[v].level&&(m[v].level=b),D==="remote"&&(m[v].remoteUidCount+=1),m[v].totalTs=(S=f.get(v))!==null&&S!==void 0?S:0):m[v]={value:y,level:b,remoteUidCount:D==="local"?0:1,totalTs:(I=f.get(v))!==null&&I!==void 0?I:0}}return Object.keys(m).map(v=>{const{level:y,value:b,totalTs:D}=m[v];return{id:v,level:y,value:b,totalTs:D}})}(i,t);const l=Date.now(),u=l>n?l:n+1;this.requestUpload&&this.requestUpload(Nc.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:u})},L("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class Da{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){w(this,"uid",void 0),w(this,"_uintid",void 0),w(this,"_trust_in_room_",!0),w(this,"_trust_audio_enabled_state_",!0),w(this,"_trust_video_enabled_state_",!0),w(this,"_trust_audio_mute_state_",!0),w(this,"_trust_video_mute_state_",!0),w(this,"_audio_muted_",!1),w(this,"_video_muted_",!1),w(this,"_audio_enabled_",!0),w(this,"_video_enabled_",!0),w(this,"_audio_added_",!1),w(this,"_video_added_",!1),w(this,"_is_pre_created",!1),w(this,"_video_pre_subscribed",!1),w(this,"_audio_pre_subscribed",!1),w(this,"_trust_video_stream_added_state_",!0),w(this,"_trust_audio_stream_added_state_",!0),w(this,"_audioTrack",void 0),w(this,"_videoTrack",void 0),w(this,"_dataChannels",[]),w(this,"_audioSSRC",void 0),w(this,"_videoSSRC",void 0),w(this,"_audioOrtc",void 0),w(this,"_videoOrtc",void 0),w(this,"_cname",void 0),w(this,"_rtxSsrcId",void 0),w(this,"_videoMid",void 0),w(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}let ko=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});function RX(e,t){var n;let r;switch(t){case re.LocalAudioTrack:r=ut.Audio;break;case re.LocalVideoTrack:r=ue(n=e._hints).call(n,Ot.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalVideoLowTrack:r=ut.Low}return r}function ky(e){const t=Ze();if(e.some(n=>n._bypassWebAudio))throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function My(e,t){ky(e);const n=new gn;return e.forEach(r=>n.addAudioTrack(r)),n}var a2,c2,d2,l2,u2,h2,p2,f2,m2,_2,E2,Vt;function g2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function i_(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?g2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Jr=(a2=Mo(ko.SEND_ONLY),c2=Mo(ko.SEND_ONLY),d2=Mo(),l2=Mo(ko.RECEIVE_ONLY),u2=Mo(ko.RECEIVE_ONLY),h2=Mo(ko.RECEIVE_ONLY),p2=Mo(ko.RECEIVE_ONLY),f2=Mo(ko.RECEIVE_ONLY),m2=Mo(ko.RECEIVE_ONLY),_2=Mo(),E2=Mo(ko.RECEIVE_ONLY),Vt=class extends xt{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Ne.StateChange,t,this._state)}constructor(e,t){super(),w(this,"store",void 0),w(this,"statsUploader",void 0),w(this,"sendConnection",void 0),w(this,"recvConnection",void 0),w(this,"localTrackMap",new Map),w(this,"remoteUserMap",new Map),w(this,"localDataChannels",[]),w(this,"pendingLocalTracks",[]),w(this,"pendingRemoteTracks",[]),w(this,"statsCollector",void 0),w(this,"dtlsFailedCount",0),w(this,"sendMutex",new On("P2PChannel2-send-mutex")),w(this,"recvMutex",new On("P2PChannel2-recv-mutex")),w(this,"_state",ht.Disconnected),w(this,"_restartStates",["disconnected","failed"]),w(this,"reconnectInterval",void 0),w(this,"uploadUnplinkStarted",!1),w(this,"uploadDownlinkStarted",!1),w(this,"uplinkStateUploadInterval",void 0),w(this,"downlinkStatsUploadInterval",void 0),w(this,"handleMuteLocalTrack",async(n,r,i)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==ht.Connected)return void i(new J(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const u=this.filterTobeMutedTracks(n);if(u.length===0)return void r();const p=u.find(S=>S[0]==="videoLowTrack");p&&p[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(u.map(S=>{let[,{id:I}]=S;return I}));let f=!1;var c,l;n.trackMediaType==="video"?f=!((c=this.localTrackMap.get(re.LocalAudioTrack))===null||c===void 0||!c.track._muted):f=((l=this.localTrackMap.get(re.LocalVideoTrack))===null||l===void 0?void 0:l.id)===void 0;const m=this.createMuteMessage(u);await Ct(this,Ne.RequestMuteLocal,m);const E=n.trackMediaType==="video"?Sa.MUTE_LOCAL_VIDEO:Sa.MUTE_LOCAL_AUDIO;await Ct(this,Ne.RequestP2PMuteLocal,{action:E,message:m,isMuteAll:f}),r()}catch(u){i(u)}finally{a()}}),w(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==ht.Connected)return void i(new J(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void r();await this.sendConnection.unmuteLocal(c.map(p=>{let[,{id:f}]=p;return f}));const l=this.createUnmuteMessage(c),u=n.trackMediaType==="video"?Sa.UNMUTE_LOCAL_VIDEO:Sa.UNMUTE_LOCAL_AUDIO;await Ct(this,Ne.RequestP2PMuteLocal,{action:u,message:l}),r()}catch(c){i(c)}finally{a()}}),w(this,"handleUpdateVideoEncoder",async(n,r,i)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const c=this.localTrackMap.get(re.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==n||this.state!==ht.Connected)return void r();const{id:l,track:u}=c;l&&(await this.sendConnection.updateSendParameters(l,u),await this.sendConnection.updateEncoderConfig(l,u),this.emit(Ne.UpdateVideoEncoder,u)),r()}catch(c){i(c)}finally{a()}}),w(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(re.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==n||this.state!==ht.Connected)return void r();const{id:l,track:u}=c;l&&await this.sendConnection.updateSendParameters(l,u),r()}catch(c){i(c)}finally{a()}}),w(this,"handleReplaceTrack",async(n,r,i,a)=>{let c;T.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof a=="boolean"&&a||(c=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var l;const p=Array.from(this.localTrackMap.entries()).find(f=>{let[,{track:m}]=f;return n===m});if(!this.sendConnection||!p||p[1].id===void 0||this.state!==ht.Connected)return void r();if(await((l=this.sendConnection)===null||l===void 0?void 0:l.replaceTrack(n,p[1].id)),p[0]===re.LocalVideoTrack&&Ze().supportDualStreamEncoding){const f=this.localTrackMap.get(re.LocalVideoLowTrack);if(f){const m=n._mediaStreamTrack.clone();f.track._originMediaStreamTrack.stop(),f.track._mediaStreamTrack=m,f.track._originMediaStreamTrack=m,await new ce((E,S)=>{this.handleReplaceTrack(f.track,E,S,!0)})}}r()}catch(p){i(p)}finally{var u;(u=c)===null||u===void 0||u()}}),w(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),w(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),w(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),w(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new s2(e),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},L("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new J(O.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e,t,n,r,i,a){throw new J(O.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new t2(e,this.store,Er.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=ht.New,this.sendConnection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new t2(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new J(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ht.Connected}async addRemoteCandidate(e,t){if(t===Er.RECEIVE_ONLY){if(!this.sendConnection)throw new J(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new J(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var r=this;return qr(function*(){const i=yield Be(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==ht.Connected){r.throwIfTrackTypeNotMatch(e);const p=e.filter(f=>r.pendingLocalTracks.indexOf(f)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(p))}r.store.pubId=r.store.pubId+1,Zn.markPublishStart(r.store.clientId,r.store.pubId);const a=r.filterTobePublishedTracks(e,t,n);if(a.length===0)return void(yield Be(r.tryToUnmuteAudio(e)));a.forEach(p=>{let{track:f,type:m}=p;const E=Date.now();r.store.publish(f.getTrackId(),m===re.LocalAudioTrack?"audio":"video",E)}),r.bindLocalTrackEvents(a);const c=yield Be(r.sendConnection.send(a.map(p=>{let{track:f}=p;return f}),r.store.codec,r.store.audioCodec)),l=(yield Be(c.next())).value,u=r.createGatewayPublishMessage(a,l);try{yield u}catch(p){throw c.throw(p),(p==null?void 0:p.code)===O.WS_ABORT&&a.forEach(f=>{let{track:m}=f;r.pendingLocalTracks.indexOf(m)===-1&&r.pendingLocalTracks.push(m)}),r.unbindLocalTrackEvents(a),p}yield Be(c.next()),a.forEach(p=>{let{type:f}=p;r.statsCollector.addLocalStats(f)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(a,l),a.forEach(p=>{let{track:f,type:m}=p;const E=Date.now();r.store.publish(f.getTrackId(),m===re.LocalAudioTrack?"audio":"video",void 0,E)}),r.startUploadUplinkState()}finally{i()}})()}async unpublish(e){if(!this.sendConnection||this.state!==ht.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i=>!ue(e).call(e,i)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(i=>i[0]==="videoLowTrack");n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(i=>{let[,{id:a}]=i;return a})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[a,{track:c}]=i;return{type:a,track:c}})),t.forEach(i=>{let[a]=i;this.statsCollector.removeLocalStats(a)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===ht.Connected)return n&&n[1].track.close(),r;e.forEach(i=>{const a=this.pendingLocalTracks.indexOf(i);a!==-1&&this.pendingLocalTracks.splice(a,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[i,{track:a,ssrcs:c}]=r;const l={stream_type:RX(a,i),ssrcs:c};a._muted||!a._enabled?t.push(l):n.push(l)}),t.length>0&&t.forEach(r=>{Ct(this,Ne.RequestMuteLocal,[r])}),n.length>0&&n.forEach(r=>{Ct(this,Ne.RequestUnmuteLocal,[r])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return qr(function*(){throw new J(O.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(T.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await hn(this,Ne.RequestRePublish,this.pendingLocalTracks),this.emit(Ne.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new J(O.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,r){var i;if(!this.recvConnection)throw new J(O.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(e))!==null&&i!==void 0&&i.has(t))return;const{track:a,mid:c,transceiver:l}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===ye.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new wl(a,e.uid,e._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),l&&e._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new Rl(a,e.uid,e._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),l&&e._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._videoTrack));const u=this.remoteUserMap.get(e);u?u.set(t,c):this.remoteUserMap.set(e,new Map([[t,c]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const p=this.pendingRemoteTracks.findIndex(f=>{let{user:m,kind:E}=f;return m.uid===e.uid&&t===E});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(Ne.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,r){if(!this.recvConnection)throw new J(O.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(a=>{let{user:c,kind:l}=a;return t!==void 0?c.uid===e.uid&&t===l:c.uid===e.uid});if(r.forEach(a=>{const c=this.pendingRemoteTracks.indexOf(a);this.pendingRemoteTracks.splice(c,1)}),this.recvConnection||n||r.forEach(a=>{let{kind:c}=a;var l;if(c===ye.AUDIO)(l=e._audioTrack)===null||l===void 0||l._destroy(),e._audioTrack=void 0;else if(c===ye.VIDEO){var u;(u=e._videoTrack)===null||u===void 0||u._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(e,t);i.length!==0&&(await this.recvConnection.stopReceiving(i.map(a=>{let[,{id:c}]=a;return c})),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(a=>{let[c,{kind:l}]=a;var u,p;if(l===ye.VIDEO&&c._videoSSRC&&((u=this.recvConnection)===null||u===void 0||u.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===ye.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),n||((p=c._videoTrack)===null||p===void 0||p._destroy(),c._videoTrack=void 0);else if(l===ye.AUDIO){var f;this.unbindRemoteTrackEvents(c._audioTrack),!n&&((f=c._audioTrack)===null||f===void 0||f._destroy(),c._audioTrack=void 0)}}),i.forEach(a=>{let[,{kind:c}]=a;Ct(this,Ne.RequestP2PMuteRemote,c)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[ye.VIDEO,ye.AUDIO].forEach(r=>{n.has(r)?Ct(this,Ne.RequestP2PUnmuteRemote,r):Ct(this,Ne.RequestP2PMuteRemote,r)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new J(O.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new J(O.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new J(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new J(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===ye.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||T.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(re.LocalAudioTrack);if((t==null?void 0:t.track)instanceof gn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==re.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===re.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===re.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}reportPublishEvent(e,t,n,r,i){if(e){const c=this.localTrackMap.get(re.LocalAudioTrack),l=r?this.localTrackMap.get(re.LocalVideoLowTrack):this.localTrackMap.get(re.LocalVideoTrack);Ce.publish(this.store.sessionId,{eventElapse:Zn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(Ot.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var a;n||(n=[]);const c=n.find(u=>u instanceof qt),l=r?(a=this.localTrackMap.get(re.LocalVideoTrack))===null||a===void 0?void 0:a.track:n.find(u=>u instanceof wt);Ce.publish(this.store.sessionId,{eventElapse:Zn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(Ot.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===ye.VIDEO?n._videoSSRC:n._audioSSRC;i&&Ce.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===ye.VIDEO,audio:r===ye.AUDIO,peerid:n.uid,subscribeRequestid:r===ye.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Zn.measureFromSubscribeStart(this.store.clientId,i)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new On("P2PChannel2-send-mutex"),this.sendMutex=new On("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(re.LocalAudioTrack);if((e==null?void 0:e.track)instanceof gn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=ht.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(re.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(re.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof wt||t&&t.track instanceof qt?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(ii(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(re.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Mu(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(T.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=ht.Reconnecting,L("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case re.LocalVideoTrack:ue(t=r._hints).call(t,Ot.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case re.LocalAudioTrack:r instanceof gn?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case re.LocalVideoLowTrack:}}),this.emit(Ne.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(ii(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(Ne.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),T.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof Da?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,r;if(e===Er.SEND_ONLY){if(!this.sendConnection)throw new J(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new J(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const i=await r.restartICE(t);return r.isInRestartIce=!1,i}{const i=await r.restartICE();if(i){const a=await hn(this,Ne.RequestP2PRestartICE,{direction:Er.RECEIVE_ONLY,iceParameter:i});await r.restartICE(a),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(re.LocalVideoTrack),n=this.localTrackMap.get(re.LocalAudioTrack),r=e.videoSend.find(S=>{var I;return S.ssrc===(t==null||(I=t.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)}),i=e.audioSend.find(S=>{var I;return S.ssrc===(n==null||(I=n.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)});if(!r||!i)return 1;const a=zr(this,Ne.NeedSignalRTT),c=r?r.rttMs:void 0,l=i?i.rttMs:void 0,u=c&&l?(c+l)/2:c||l,p=(u&&a?(u+a)/2:u||a)||0,f=100*e.sendPacketLossRate*.7/50+.3*p/1500,m=f<.17?1:f<.36?2:f<.59?3:f<.1?4:5,E=t==null?void 0:t.track;if(E&&E._encoderConfig&&E._hints.indexOf(Ot.SCREEN_TRACK)===-1){const S=E._encoderConfig.bitrateMax,I=e.bitrate.actualEncoded;if(S&&I){const v=(1e3*S-I)/(1e3*S);return w1[v<.15?0:v<.3?1:v<.45?2:v<.6?3:4][m]}}return m}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,a=r._videoSSRC,c=e.audioRecv.find(I=>I.ssrc===i),l=e.videoRecv.find(I=>I.ssrc===a);if(!c&&!l)return void(t+=1);const u=zr(this,Ne.NeedSignalRTT),p=e.rtt,f=(p&&u?(p+u)/2:p||u)||0,m=c?c.jitterMs:void 0,E=e.recvPacketLossRate;let S=.7*E*100/50+.3*f/1500;m&&(S=.6*E*100/50+.2*f/1500+.2*m/400),t+=S<.1?1:S<.17?2:S<.36?3:S<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ce((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const r=[],i=Ze(),a=this.getAllTracks();e=qd(e=e.filter(u=>a.indexOf(u)===-1));let c=!1,l=!1;for(const u of e){if(u instanceof wt&&(this.localTrackMap.has(re.LocalVideoTrack)||c?new J(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:u,type:re.LocalVideoTrack}),c=!0),t)){const p=this.getLowVideoTrack(u,n);r.push({track:p,type:re.LocalVideoLowTrack})}if(u instanceof qt){const p=this.localTrackMap.get(re.LocalAudioTrack);if(p){if(!(p.track instanceof gn))throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0)}else if(l){const f=r.find(m=>{let{type:E}=m;return E===re.LocalAudioTrack});if(!(f.track instanceof gn))throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(u)}else{if(!i.webAudioMediaStreamDest||u instanceof gn||u._bypassWebAudio)r.push({track:u,type:re.LocalAudioTrack});else{const f=new gn;f.addAudioTrack(u),r.push({track:f,type:re.LocalAudioTrack})}l=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=qd(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof qt){const i=this.localTrackMap.get(re.LocalAudioTrack);if(!i)continue;i.track instanceof gn?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([re.LocalAudioTrack,i]),i.track.close())):t.push([re.LocalAudioTrack,i])}if(r instanceof wt){const i=this.localTrackMap.get(re.LocalVideoTrack);if(!i)continue;t.push([re.LocalVideoTrack,i]);const a=this.localTrackMap.get(re.LocalVideoLowTrack);a&&t.push([re.LocalVideoLowTrack,a])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case re.LocalVideoTrack:n.addListener(me.GET_STATS,this.handleGetLocalVideoStats),n.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(me.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case re.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case re.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof gn?e.trackList.forEach(n=>{n.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(me.GET_STATS,this.handleGetLocalAudioStats),n.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(me.GET_STATS,this.handleGetLocalAudioStats),e.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(me.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case re.LocalVideoTrack:n.off(me.GET_STATS,this.handleGetLocalVideoStats),n.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(me.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case re.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case re.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof gn?e.trackList.forEach(t=>{t.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(me.GET_STATS,this.handleGetLocalAudioStats),t.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(me.GET_STATS,this.handleGetLocalAudioStats),e.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Rl&&t.addListener(me.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof wl&&t.addListener(me.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(me.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(ye.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(ye.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var i;let a,{track:c,type:l}=n;switch(l){case re.LocalAudioTrack:a=ut.Audio;break;case re.LocalVideoTrack:a=ue(i=c._hints).call(i,Ot.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalVideoLowTrack:a=ut.Low}return{kind:l===re.LocalAudioTrack?ye.AUDIO:ye.VIDEO,stream_type:a,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:c.muted||!c.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[i,{track:a,ssrcs:c,id:l}]=t;switch(i){case re.LocalVideoTrack:r=ue(n=a._hints).call(n,Ot.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalAudioTrack:r=ut.Audio;break;case re.LocalVideoLowTrack:r=ut.Low}return{stream_type:r,ssrcs:c,mid:l}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:i,type:a}=n;this.localTrackMap.set(a,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Ne.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),ue(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Rn(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Ce.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Kt.TRACER}).onSuccess(),this.emit(Ne.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(ii(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(Tl.FIRST_FRAME_DECODED),Ce.firstRemoteFrame(this.store.sessionId,Nn.FIRST_AUDIO_DECODE,Bt.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Zn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(ii(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===t);r&&Ce.firstRemoteFrame(this.store.sessionId,Nn.FIRST_AUDIO_RECEIVED,Bt.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Zn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;const r=Array.from(ii(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&Ce.firstRemoteFrame(this.store.sessionId,Nn.FIRST_VIDEO_RECEIVED,Bt.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Zn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(Ne.ConnectionTypeChange,r),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(va(n))," -> ").concat(JSON.stringify(va(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(va(n))," -> ").concat(JSON.stringify(va(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Ne.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Er.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,T.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Er.SEND_ONLY?this.restartICE(e):hn(this,Ne.RequestP2PRestartICE,{direction:Er.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(re.LocalAudioTrack);if(e instanceof qt&&(n==null?void 0:n.track)instanceof gn)return n.track.isActive||t.push([re.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:a}]=i;return e===a});if(r&&(t.push(r),r[0]===re.LocalVideoTrack)){const i=this.localTrackMap.get(re.LocalVideoLowTrack);i&&t.push([re.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(re.LocalAudioTrack);if(e instanceof qt&&(n==null?void 0:n.track)instanceof gn)return n.track.isActive&&t.push([re.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:a}]=i;return e===a});if(r)if(r[0]===re.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(re.LocalVideoLowTrack);i&&t.push([re.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[i,{track:a,ssrcs:c,id:l}]=t;switch(i){case re.LocalAudioTrack:r=ut.Audio;break;case re.LocalVideoTrack:r=ue(n=a._hints).call(n,Ot.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalVideoLowTrack:r=ut.Low}return{stream_type:r,ssrcs:c,mid:l}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[i,{track:a,ssrcs:c,id:l}]=t;switch(i){case re.LocalAudioTrack:r=ut.Audio;break;case re.LocalVideoTrack:r=ue(n=a._hints).call(n,Ot.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalVideoLowTrack:r=ut.Low}return{stream_type:r,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[a,c]=i;n.push([e,{kind:a,id:c}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:i,id:a}]=n;switch(i){case ye.VIDEO:return void(r._videoSSRC&&t.push({stream_type:ye.VIDEO,ssrcId:r._videoSSRC}));case ye.AUDIO:return void(r._audioSSRC&&t.push({stream_type:ye.AUDIO,ssrcId:r._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(re.LocalVideoTrack),n=this.localTrackMap.get(re.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof qt){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const r=this.createUnmuteMessage(n);return void await Ct(this,Ne.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Ne.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Ne.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Rn(am(this.dtlsFailedCount,sn)),this.emit(Ne.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(re.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof wt)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof wt).length>1)throw new J(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof qt).length>1&&(e.some(t=>t instanceof qt&&t._bypassWebAudio)||!Ze().webAudioMediaStreamDest))throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof wt&&this.pendingLocalTracks.some(n=>n instanceof wt))throw new J(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof qt&&this.pendingLocalTracks.some(n=>n instanceof qt)&&(!Ze().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof qt&&n._bypassWebAudio)))throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!L("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ze().supportDualStreamEncoding,r=i_(i_({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():Ly(e,r);const a=Rt(8,"track-low-"),c=new wt(i,i_(i_({},n&&{scaleResolutionDownBy:dv(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,a);return c.on(Wc.TRANSCEIVER_UPDATED,l=>{e._updateRtpTransceiver(l,gl.LOW_STREAM)}),c._hints.push(Ot.LOW_STREAM),e.addListener(me.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var i;const a=Array.from(ii(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===e);if(a){r||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(u=>u.userId===a.uid&&u.type==="video");Ce.firstRemoteVideoDecode(this.store.sessionId,Nn.FIRST_VIDEO_DECODE,Bt.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:t,videoheight:n,subscribeElapse:Zn.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const a=await this.recvConnection.getRemoteSSRC(i);return a!==void 0&&a!==n}resetConnection(e){T.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(e)),this.state===ht.Connected?(T.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}async publishDataChannel(e){throw new J(O.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new J(O.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new J(O.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new J(O.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new J(O.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new J(O.NOT_SUPPORTED)}async preConnect(e,t,n,r,i,a){throw new J(O.NOT_SUPPORTED)}getEstablishParams(){throw new J(O.NOT_SUPPORTED)}async reSubscribe(e){throw new J(O.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new J(O.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===re.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,gl.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},se(Vt.prototype,"p2pConnect",[a2],Object.getOwnPropertyDescriptor(Vt.prototype,"p2pConnect"),Vt.prototype),se(Vt.prototype,"unpublish",[c2],Object.getOwnPropertyDescriptor(Vt.prototype,"unpublish"),Vt.prototype),se(Vt.prototype,"unpublishLowStream",[d2],Object.getOwnPropertyDescriptor(Vt.prototype,"unpublishLowStream"),Vt.prototype),se(Vt.prototype,"subscribe",[l2],Object.getOwnPropertyDescriptor(Vt.prototype,"subscribe"),Vt.prototype),se(Vt.prototype,"mockSubscribe",[u2],Object.getOwnPropertyDescriptor(Vt.prototype,"mockSubscribe"),Vt.prototype),se(Vt.prototype,"unsubscribe",[h2],Object.getOwnPropertyDescriptor(Vt.prototype,"unsubscribe"),Vt.prototype),se(Vt.prototype,"muteRemote",[p2],Object.getOwnPropertyDescriptor(Vt.prototype,"muteRemote"),Vt.prototype),se(Vt.prototype,"unmuteRemote",[f2],Object.getOwnPropertyDescriptor(Vt.prototype,"unmuteRemote"),Vt.prototype),se(Vt.prototype,"hasRemoteMediaWithLock",[m2],Object.getOwnPropertyDescriptor(Vt.prototype,"hasRemoteMediaWithLock"),Vt.prototype),se(Vt.prototype,"disconnectForReconnect",[_2],Object.getOwnPropertyDescriptor(Vt.prototype,"disconnectForReconnect"),Vt.prototype),se(Vt.prototype,"remoteMediaSsrcChanged",[E2],Object.getOwnPropertyDescriptor(Vt.prototype,"remoteMediaSsrcChanged"),Vt.prototype),Vt);function Mo(e){return function(t,n,r){const i=t[n];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];switch(e){case ko.SEND_ONLY:{const u=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,c)}finally{u()}}case ko.RECEIVE_ONLY:{const u=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,c)}finally{u()}}default:{const u=await this.sendMutex.lock("From P2PChannel2.".concat(n)),p=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,c)}finally{u(),p()}}}},r}}function S2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Xc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?S2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class xh{constructor(t){w(this,"store",void 0),w(this,"onStatsException",void 0),w(this,"onUploadPublishDuration",void 0),w(this,"onStatsChanged",void 0),w(this,"localStats",new Map),w(this,"remoteStats",new Map),w(this,"updateStatsInterval",void 0),w(this,"trafficStats",void 0),w(this,"trafficStatsPeerList",[]),w(this,"uplinkStats",void 0),w(this,"exceptionMonitor",void 0),w(this,"p2pChannel",void 0),w(this,"scalabilityMode",iY.L1T1),w(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new sX,this.exceptionMonitor.on("exception",(n,r,i)=>{this.onStatsException&&this.onStatsException(n,r,i)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(re.LocalAudioTrack)||Xc({},ly)}getLocalVideoTrackStats(){return this.localStats.get(re.LocalVideoTrack)||Xc({},uy)}getRemoteAudioTrackStats(t){const n=(a,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(u=>u.peer_uid===a);return l&&(c.publishDuration=l.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},r={};if(t){var i;const a=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.audioStats;a&&(r[t]=n(t,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[c,{audioStats:l}]=a;l&&(r[c]=n(c,l))});return r}getRemoteNetworkQualityStats(t){const n={};if(t){var r;const i=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;i&&(n[t]=i)}else Array.from(this.remoteStats.entries()).forEach(i=>{let[a,{networkStats:c}]=i;c&&(n[a]=c)});return n}getRemoteVideoTrackStats(t){const n=(a,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(u=>u.peer_uid===a);return l&&(c.publishDuration=l.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},r={};if(t){var i;const a=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.videoStats;a&&(r[t]=n(t,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[c,{videoStats:l}]=a;l&&(r[c]=n(c,l))});return r}getRTCStats(){let t=0,n=0,r=0,i=0;const a=this.localStats.get(re.LocalAudioTrack);a&&(t+=a.sendBytes,n+=a.sendBitrate);const c=this.localStats.get(re.LocalVideoTrack);c&&(t+=c.sendBytes,n+=c.sendBitrate);const l=this.localStats.get(re.LocalVideoLowTrack);l&&(t+=l.sendBytes,n+=l.sendBitrate),this.remoteStats.forEach(p=>{let{audioStats:f,videoStats:m}=p;f&&(r+=f.receiveBytes,i+=f.receiveBitrate),m&&(r+=m.receiveBytes,i+=m.receiveBitrate)});let u=1;return this.trafficStats&&(u+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:u,SendBitrate:n,SendBytes:t,RecvBytes:r,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var r;const i=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(n.peer_uid),a=i!=null&&i.videoSSRC?Zn.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,c=i!=null&&i.audioSSRC?Zn.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,a>c?a:c),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&T.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,r){if(!t)return!1;const i=!!r&&n.framesDecodeFreezeTime>r.framesDecodeFreezeTime,a=!r||n.framesDecodeCount>r.framesDecodeCount;return i||!a}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[r,i]=n;switch(r){case re.LocalVideoTrack:case re.LocalVideoLowTrack:{const c=i,l=Xc({},uy),u=t.getStats(),p=t.getLocalMedia(r);if(u){const f=u.videoSend.find(m=>m.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(f){const m=t.getLocalVideoSize(),E=t.getEncoderConfig(re.LocalVideoTrack);f.codec!=="H264"&&f.codec!=="H265"&&f.codec!=="VP8"&&f.codec!=="VP9"&&f.codec!=="AV1X"&&f.codec!=="AV1"||(l.codecType=f.codec),l.sendBytes=f.bytes,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0,f.inputFrame?(l.captureFrameRate=f.inputFrame.frameRate,l.captureResolutionHeight=f.inputFrame.height,l.captureResolutionWidth=f.inputFrame.width):m&&(l.captureResolutionWidth=m.width,l.captureResolutionHeight=m.height),f.sentFrame?(l.sendFrameRate=f.sentFrame.frameRate,l.sendResolutionHeight=f.sentFrame.height,l.sendResolutionWidth=f.sentFrame.width):m&&(l.sendResolutionWidth=m.width,l.sendResolutionHeight=m.height),f.avgEncodeMs&&(l.encodeDelay=f.avgEncodeMs),E&&E.bitrateMax&&(l.targetSendBitrate=1e3*E.bitrateMax),l.sendPackets=f.packets,l.sendPacketsLost=f.packetsLost,l.sendJitterMs=f.jitterMs,l.sendRttMs=f.rttMs,l.totalDuration=c?c.totalDuration+1:1,l.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(f)&&(l.totalFreezeTime+=1),f.scalabilityMode&&this.scalabilityMode!==f.scalabilityMode&&(T.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(f.scalabilityMode)),this.scalabilityMode=f.scalabilityMode)}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var a;this.localStats.set(r,l),((c==null?void 0:c.sendResolutionWidth)!==l.sendResolutionWidth||(c==null?void 0:c.sendResolutionHeight)!==l.sendResolutionHeight)&&((a=this.onStatsChanged)===null||a===void 0||a.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&p&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,p.track,l);break}case re.LocalAudioTrack:{const c=i,l=Xc({},ly),u=t.getStats(),p=t.getLocalMedia(r);if(u){const f=u.audioSend.find(m=>m.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(f){if(f.codec!=="opus"&&f.codec!=="aac"&&f.codec!=="PCMU"&&f.codec!=="PCMA"&&f.codec!=="G722"||(l.codecType=f.codec),f.inputLevel)l.sendVolumeLevel=Math.round(32767*f.inputLevel);else{const m=t.getLocalAudioVolume();m&&(l.sendVolumeLevel=Math.round(32767*m))}l.sendBytes=f.bytes,l.sendPackets=f.packets,l.sendPacketsLost=f.packetsLost,l.sendJitterMs=f.jitterMs,l.sendRttMs=f.rttMs,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0}}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(re.LocalAudioTrack,l),l&&p&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,p.track,l);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var r,i;let[a,{videoStats:c,audioStats:l,videoPcStats:u}]=n;const p=l,f=c,m=u,E=Xc({},PP),S=Xc({},LP),I=Xc({},qJ),{audioTrack:v,videoTrack:y,audioSSRC:b,videoSSRC:D}=t.getRemoteMedia(a);let U;U=t instanceof Jr?t.getStats(!0):t.getStats();const F=(r=U)===null||r===void 0?void 0:r.audioRecv.find(Q=>Q.ssrc===b),W=(i=U)===null||i===void 0?void 0:i.videoRecv.find(Q=>Q.ssrc===D),q=this.trafficStats&&this.trafficStats.peer_delay.find(Q=>Q.peer_uid===a);if(F&&(F.codec!=="opus"&&F.codec!=="aac"&&F.codec!=="PCMU"&&F.codec!=="PCMA"&&F.codec!=="G722"||(E.codecType=F.codec),F.outputLevel?E.receiveLevel=Math.round(32767*F.outputLevel):v&&(E.receiveLevel=Math.round(32767*v.getVolumeLevel())),E.receiveBytes=F.bytes,E.receivePackets=F.packets,E.receivePacketsLost=F.packetsLost,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.receiveBitrate=p?8*Math.max(0,E.receiveBytes-p.receiveBytes):0,E.totalDuration=p?p.totalDuration+1:1,E.totalFreezeTime=p?p.totalFreezeTime:0,E.freezeRate=E.totalFreezeTime/E.totalDuration,E.receiveDelay=F.jitterBufferMs,E.totalDuration>10&&xh.isRemoteAudioFreeze(v)&&(E.totalFreezeTime+=1)),W){W.codec!=="H264"&&W.codec!=="H265"&&W.codec!=="VP8"&&W.codec!=="VP9"&&W.codec!=="AV1X"&&W.codec!=="AV1"||(S.codecType=W.codec),S.receiveBytes=W.bytes,S.receiveBitrate=f?8*Math.max(0,S.receiveBytes-f.receiveBytes):0,S.decodeFrameRate=W.decodeFrameRate<0?0:W.decodeFrameRate,S.renderFrameRate=W.decodeFrameRate<0?0:W.decodeFrameRate,W.outputFrame&&(S.renderFrameRate=W.outputFrame.frameRate),W.receivedFrame?(S.receiveFrameRate=W.receivedFrame.frameRate,S.receiveResolutionHeight=W.receivedFrame.height,S.receiveResolutionWidth=W.receivedFrame.width):y&&(S.receiveResolutionHeight=y._videoHeight||0,S.receiveResolutionWidth=y._videoWidth||0),W.framesRateFirefox!==void 0&&(S.receiveFrameRate=Math.round(W.framesRateFirefox)),S.receivePackets=W.packets,S.receivePacketsLost=W.packetsLost,S.packetLossRate=S.receivePacketsLost/(S.receivePackets+S.receivePacketsLost),S.totalDuration=f?f.totalDuration+1:1,S.totalFreezeTime=f?f.totalFreezeTime:0,S.receiveDelay=W.jitterBufferMs||0;const Q=!!D&&t.getRemoteVideoIsReady(D);y&&Q&&xh.isRemoteVideoFreeze(y,W,m)&&(S.totalFreezeTime+=1),S.freezeRate=S.totalFreezeTime/S.totalDuration}q&&(E.end2EndDelay=q.B_ad,S.end2EndDelay=q.B_vd,E.transportDelay=q.B_ed,S.transportDelay=q.B_ed,E.currentPacketLossRate=q.B_ealr4/100,S.currentPacketLossRate=q.B_evlr4/100,I.uplinkNetworkQuality=q.B_punq?q.B_punq:0,I.downlinkNetworkQuality=q.B_pdnq?q.B_pdnq:0),this.remoteStats.set(a,{audioStats:E,videoStats:S,videoPcStats:W,networkStats:I}),v&&this.exceptionMonitor.setRemoteAudioStats(v,E),y&&this.exceptionMonitor.setRemoteVideoStats(y,S)})}}function T2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Uh(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?T2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class wX extends xt{constructor(t,n,r,i){super(),w(this,"spec",void 0),w(this,"token",void 0),w(this,"websocket",void 0),w(this,"pingpongTimer",void 0),w(this,"reconnectMode","retry"),w(this,"serviceMode",void 0),w(this,"reqId",0),w(this,"commandReqId",0),w(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),w(this,"handleWebSocketMessage",a=>{if(!a.data)return;const c=JSON.parse(a.data);c.requestId?this.emit("@".concat(c.requestId,"-").concat(c.sid),c):this.serviceMode===Dn.INJECT?this.emit(as.INJECT_STREAM_STATUS,c):(Ce.workerEvent(this.spec.sid,{actionType:"status",serverCode:c.code,workerType:this.serviceMode===Dn.TRANSCODE?1:2}),this.emit(as.PUBLISH_STREAM_STATUS,c))}),this.spec=n,this.token=t,this.serviceMode=i,this.websocket=new ih("live-streaming",r),this.websocket.on(ke.CONNECTED,this.handleWebSocketOpen),this.websocket.on(ke.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(ke.REQUEST_NEW_URLS,(a,c)=>{hn(this,as.REQUEST_NEW_ADDRESS).then(a).catch(c)}),this.websocket.on(ke.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,r,i){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const a=this.commandReqId,c=this.reqId;if(!c||!this.websocket)throw new B(O.UNEXPECTED_ERROR);const l=Uh({command:t,sdkVersion:wi==="4.21.0"?"0.0.1":wi,seq:c,requestId:c,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new B(O.WS_DISCONNECT);const u=()=>new ce((E,S)=>{this.websocket.once(ke.CLOSED,()=>S(new B(O.WS_ABORT))),this.websocket.once(ke.CONNECTED,E)});this.websocket.state!=="connected"&&await u(),l.clientRequest&&(l.clientRequest.workerToken=this.token);const p=new ce((E,S)=>{const I=()=>{S(new B(O.WS_ABORT))};this.websocket.once(ke.RECONNECTING,I),this.websocket.once(ke.CLOSED,I),this.once("@".concat(c,"-").concat(this.spec.sid),v=>{E(v)})});i&&Ce.workerEvent(this.spec.sid,Uh(Uh({},i),{},{requestId:a,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const f=Date.now();this.websocket.sendMessage(l);let m=null;try{m=await p}catch(E){if(this.websocket.state==="closed")throw E;return await u(),await this.request(t,n,r)}return i&&Ce.workerEvent(this.spec.sid,Uh(Uh({},i),{},{requestId:a,actionType:"response",payload:JSON.stringify(m.serverResponse),serverCode:m.code,success:m.code===200,responseTime:Date.now()-f})),m.code!==200&&this.handleResponseError(m),m}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=wi==="4.21.0"?"0.0.1":wi;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case En.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void T.warning("live stream response already exists stream");case En.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case En.LIVE_STREAM_RESPONSE_BAD_STREAM:case En.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new B(O.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case En.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case En.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new B(O.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case En.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new B(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(as.WARNING,n,t.serverResponse.url)}case En.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new B(O.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(as.WARNING,n,t.serverResponse.url)}case En.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case En.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new B(O.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case En.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new B(O.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(as.WARNING,n,t.serverResponse.url)}case En.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case En.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case En.LIVE_STREAM_RESPONSE_WORKER_LOST:case En.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case En.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case En.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new B(O.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(om)},6e3)}}function v2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function br(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?v2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class IX extends xt{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:sn,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:sn;super(),w(this,"onLiveStreamWarning",void 0),w(this,"onLiveStreamError",void 0),w(this,"onInjectStatusChange",void 0),w(this,"spec",void 0),w(this,"retryTimeout",1e4),w(this,"connection",void 0),w(this,"httpRetryConfig",void 0),w(this,"wsRetryConfig",void 0),w(this,"streamingTasks",new Map),w(this,"isStartingStreamingTask",!1),w(this,"taskMutex",new On("live-streaming")),w(this,"cancelToken",Rr.CancelToken.source()),w(this,"transcodingConfig",void 0),w(this,"injectConfig",br({},aY)),w(this,"injectLoopTimes",0),w(this,"uapResponse",void 0),w(this,"lastTaskId",1),w(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=br(br({},sY),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(T.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(c=>br(br(br({},oY),c),{},{zOrder:c.zOrder?c.zOrder+1:1}))),function(c){Ht(c.width)||St(c.width,"config.width",0,1e4),Ht(c.height)||St(c.height,"config.height",0,1e4),Ht(c.videoBitrate)||St(c.videoBitrate,"config.videoBitrate",1,1e6),Ht(c.videoFrameRate)||St(c.videoFrameRate,"config.videoFrameRate"),Ht(c.lowLatency)||Ns(c.lowLatency,"config.lowLatency"),Ht(c.audioSampleRate)||Sn(c.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Ht(c.audioBitrate)||St(c.audioBitrate,"config.audioBitrate",1,128),Ht(c.audioChannels)||Sn(c.audioChannels,"config.audioChannels",[1,2,3,4,5]),Ht(c.videoGop)||St(c.videoGop,"config.videoGop"),Ht(c.videoCodecProfile)||Sn(c.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Ht(c.userCount)||St(c.userCount,"config.userCount",0,17),Ht(c.backgroundColor)||St(c.backgroundColor,"config.backgroundColor",0,16777215),Ht(c.userConfigExtraInfo)||Mn(c.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),c.transcodingUsers&&!Ht(c.transcodingUsers)&&(Ds(c.transcodingUsers,"config.transcodingUsers"),c.transcodingUsers.forEach((l,u)=>{pm(l.uid),Ht(l.x)||St(l.x,"transcodingUser[".concat(u,"].x"),0,1e4),Ht(l.y)||St(l.y,"transcodingUser[".concat(u,"].y"),0,1e4),Ht(l.width)||St(l.width,"transcodingUser[".concat(u,"].width"),0,1e4),Ht(l.height)||St(l.height,"transcodingUser[".concat(u,"].height"),0,1e4),Ht(l.zOrder)||St(l.zOrder-1,"transcodingUser[".concat(u,"].zOrder"),0,100),Ht(l.alpha)||St(l.alpha,"transcodingUser[".concat(u,"].alpha"),0,1,!1)})),Ht(c.watermark)||ov(c.watermark,"watermark"),Ht(c.backgroundImage)||ov(c.backgroundImage,"backgroundImage"),c.images&&!Ht(c.images)&&(Ds(c.images,"config.images"),c.images.forEach((l,u)=>{ov(l,"images[".concat(u,"]"))}))}(n);const r=[];n.images&&r.push(...n.images.map(c=>br(br(br({},iv),c),{},{zOrder:255}))),n.backgroundImage&&(r.push(br(br(br({},iv),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(br(br(br({},iv),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(c=>br({},c)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const i=(n.userConfigs||[]).map(c=>typeof c.uid=="number"?ce.resolve(c.uid):oD(c.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await ce.all(i)).forEach((c,l)=>{n.userConfigs&&n.userConfigs[l]&&(n.userConfigs[l].uid=c)}),this.transcodingConfig=n,this.connection)try{var a;const c=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Io(a=this.streamingTasks).call(a)).map(l=>l.taskId).join("#")});T.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(c.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(c){if(!c.data||!c.data.retry)throw c;c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(l=>{T.warning("[".concat(this.spec.clientId,"] live streaming receive error"),c.toString(),"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,c).then(()=>{T.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(l.url," success"))}).catch(u=>{T.error("[".concat(this.spec.clientId,"] live streaming republish failed"),l.url,u.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,u)})})}}setInjectStreamConfig(t,n){this.injectConfig=Object.assign({},this.injectConfig,t),this.injectLoopTimes=n}async startLiveStreamingTask(t,n,r){var i;if(Array.from(Io(i=this.streamingTasks).call(i)).find(p=>p.mode===Dn.INJECT)&&n===Dn.INJECT)return new B(O.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&n===Dn.TRANSCODE)throw new B(O.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let c={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};T.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const l=await this.taskMutex.lock();if(!this.connection&&r)return void l();if(this.streamingTasks.get(t)&&!r)return l(),new B(O.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(p){throw l(),p}switch(n){case Dn.TRANSCODE:c.transcodingConfig=br({},this.transcodingConfig);break;case Dn.RAW:break;case Dn.INJECT:c={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:t,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const u=this.lastTaskId++;try{const p=new ce((m,E)=>{Rn(this.retryTimeout).then(()=>{if(r)return E(r);const S=this.statusError.get(t);return S?(this.statusError.delete(t),E(S)):void 0})}),f=await ce.race([this.connection.request("request",{clientRequest:c},!0,{url:t,command:"PublishStream",workerType:n===Dn.TRANSCODE?1:2,requestByUser:!r,tid:u.toString()}),p]);this.isStartingStreamingTask=!1,T.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(f.code)),this.streamingTasks.set(t,{clientRequest:c,mode:n,url:t,taskId:u}),l()}catch(p){if(l(),this.isStartingStreamingTask=!1,!p.data||!p.data.retry||r)throw p;return p.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,p)):await this.startLiveStreamingTask(t,n,p)}}stopLiveStreamingTask(t){return new ce((n,r)=>{const i=this.streamingTasks.get(t);if(!i||!this.connection)return new B(O.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const a=i.mode;i.abortTask=()=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:a===Dn.INJECT?"UninjectStream":"UnpublishStream",url:i.url}},!1,{url:t,command:"UnPublishStream",workerType:a===Dn.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(c=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(c.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&a!==Dn.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),n(),a===Dn.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(Zd.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,t)}).catch(r)})}async controlInjectStream(t,n,r,i){const a=this.streamingTasks.get(t);if(!a||!this.connection||a.mode!==Dn.INJECT)throw new B(O.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:n,audioVolume:r,position:i}})).serverResponse}resetAllTask(){var t;const n=Array.from(Io(t=this.streamingTasks).call(t));this.terminate();for(const r of n)this.startLiveStreamingTask(r.url,r.mode).catch(i=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,i)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Rr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new B(O.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await hn(this,fm.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new wX(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(as.WARNING,(r,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,r)),this.connection.on(as.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(as.INJECT_STREAM_STATUS,r=>this.handleInjectStreamServerStatus(r)),this.connection.on(as.REQUEST_NEW_ADDRESS,(r,i)=>{if(!this.connection)return i(new B(O.UNEXPECTED_ERROR,"can not get new live streaming address list"));hn(this,fm.REQUEST_WORKER_MANAGER_LIST,t).then(a=>{this.uapResponse=a,r(a.addressList)}).catch(i)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),i=t.reason;switch(t.code){case En.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const c=new B(O.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return T.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,c);if(!this.isStartingStreamingTask)return;this.statusError.set(n,c)}case En.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const c=new B(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,c)}case En.LIVE_STREAM_RESPONSE_WORKER_LOST:case En.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var a;if(!this.connection)return;this.connection.tryNextAddress();const c=Array.from(Io(a=this.streamingTasks).call(a));for(const l of c)l.abortTask?l.abortTask():(T.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{T.debug("[".concat(this.spec.clientId,"] republish live stream success"),l.url)}).catch(u=>{T.error(u.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,u)}));return}}}handleInjectStreamServerStatus(t){const n=Number(t.uid),r=t.serverStatus&&t.serverStatus.url;switch(t.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(Zd.INJECT_STREAM_STATUS_START_SUCCESS,n,r));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(Zd.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,n,r),void this.streamingTasks.delete(r);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(Zd.INJECT_STREAM_STATUS_START_UNAUTHORIZED,n,r),void this.streamingTasks.delete(r);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(Zd.INJECT_STREAM_STATUS_BROKEN,n,r),void this.streamingTasks.delete(r);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(Zd.INJECT_STREAM_STATUS_START_TIMEOUT,n,r),void this.streamingTasks.delete(r);default:return void T.debug("inject stream server status",t)}}hasUrl(t){return this.streamingTasks.has(t)}}class y2{constructor(){w(this,"destChannelMediaInfos",new Map),w(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){L1(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){L1(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){hm(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function C2(e){if(!(e instanceof y2))return new B(O.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new B(O.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new B(O.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class bX extends xt{constructor(t,n,r){super(),w(this,"ws",void 0),w(this,"requestId",1),w(this,"heartBeatTimer",void 0),w(this,"joinInfo",void 0),w(this,"clientId",void 0),w(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),w(this,"onClose",i=>{this.emit("close"),this.dispose()}),w(this,"onMessage",i=>{const a=JSON.parse(i.data);if(!a||a.command!=="serverResponse"||!a.requestId)return a&&a.command==="serverStatus"&&a.serverStatus&&a.serverStatus.command?(this.emit("status",a.serverStatus),void this.emit(a.serverStatus.command,a.serverStatus)):void 0;this.emit("req_".concat(a.requestId),a)}),this.joinInfo=t,this.clientId=n,this.ws=new ih("cross-channel-".concat(this.clientId),r),this.ws.on(ke.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(ke.CONNECTED,this.onOpen),this.ws.on(ke.ON_MESSAGE,this.onMessage),this.ws.on(ke.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new ce((n,r)=>{const i=window.setTimeout(()=>{r(new B(O.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,a=>{window.clearTimeout(i),a.state&&a.state!==0?r(new B(O.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),r(new B(O.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new B(O.WS_DISCONNECT);const n=()=>new ce((c,l)=>{this.ws.once(ke.CLOSED,()=>l(new B(O.WS_ABORT))),this.ws.once(ke.CONNECTED,c)});this.ws.state!=="connected"&&await n();const r=this.sendMessage(t),i=new ce((c,l)=>{const u=()=>{l(new B(O.WS_ABORT))};this.ws.once(ke.RECONNECTING,u),this.ws.once(ke.CLOSED,u),this.once("req_".concat(r),c),Rn(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(ke.RECONNECTING,u),this.ws.off(ke.CLOSED,u),l(new B(O.TIMEOUT,"cross channel ws request timeout"))})}),a=await i;if(!a||a.code!==200)throw new B(O.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(a)));return a}async connect(t){this.ws.removeAllListeners(ke.REQUEST_NEW_URLS),this.ws.on(ke.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class AX extends xt{set state(t){t!==this._state&&(t!==Pr.RELAY_STATE_FAILURE&&(this.errorCode=$d.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,r,i,a){super(),w(this,"joinInfo",void 0),w(this,"sid",void 0),w(this,"clientId",void 0),w(this,"cancelToken",Rr.CancelToken.source()),w(this,"workerToken",void 0),w(this,"requestId",0),w(this,"signal",void 0),w(this,"prevChannelMediaConfig",void 0),w(this,"httpRetryConfig",void 0),w(this,"_resolution",void 0),w(this,"_state",Pr.RELAY_STATE_IDLE),w(this,"errorCode",$d.RELAY_OK),w(this,"onStatus",c=>{T.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(c))),c&&c.command&&(c.command==="onAudioPacketReceived"&&this.emit("event",Ps.PACKET_RECEIVED_AUDIO_FROM_SRC),c.command==="onVideoPacketReceived"&&this.emit("event",Ps.PACKET_RECEIVED_VIDEO_FROM_SRC),c.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=$d.SRC_TOKEN_EXPIRED,this.state=Pr.RELAY_STATE_FAILURE),c.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=$d.DEST_TOKEN_EXPIRED,this.state=Pr.RELAY_STATE_FAILURE))}),w(this,"onReconnect",async()=>{T.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Ps.NETWORK_DISCONNECTED),this.state=Pr.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(c=>{this.state!==Pr.RELAY_STATE_IDLE&&(T.error("auto restart channel media relay failed",c.toString()),this.errorCode=$d.SERVER_CONNECTION_LOST,this.state=Pr.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=$u(),this.signal=new bX(this.joinInfo,this.clientId,r),this.httpRetryConfig=i,this._resolution=a}async startChannelMediaRelay(t){if(this.state!==Pr.RELAY_STATE_IDLE)throw new B(O.INVALID_OPERATION);this.state=Pr.RELAY_STATE_CONNECTING,await this.connect(),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new B(O.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new B(O.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new B(O.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Pr.RELAY_STATE_RUNNING)throw new B(O.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Pr.RELAY_STATE_RUNNING)throw new B(O.INVALID_OPERATION);const n=this.genMessage(gr.SetVideoProfile);await this.signal.request(n),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),T.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Pr.RELAY_STATE_IDLE,this.dispose()}dispose(){T.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Rr.CancelToken.source(),this.state=Pr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await bY(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Ps.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(gr.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const r=this.genMessage(gr.SetSdkProfile,t);await this.signal.request(r),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i=this.genMessage(gr.SetSourceChannel,t);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Ps.PACKET_JOINED_SRC_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const a=this.genMessage(gr.SetSourceUserId,t);await this.signal.request(a),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const c=this.genMessage(gr.SetDestChannel,t);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Ps.PACKET_JOINED_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const l=this.genMessage(gr.StartPacketTransfer,t);await this.signal.request(l),this.emit("event",Ps.PACKET_SENT_TO_DEST_CHANNEL),this.state=Pr.RELAY_STATE_RUNNING,T.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(gr.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",Ps.PACKET_UPDATE_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(gr.StopPacketTransfer);await this.signal.request(t),T.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const r=[],i=[],a=[];this.requestId+=1;const c={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:wi,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};c.sdkVersion==="4.21.0"&&(c.sdkVersion="0.0.1");let l=null,u=null;switch(t){case gr.SetSdkProfile:return c.clientRequest={command:"SetSdkProfile",type:"multi_channel"},c;case gr.SetSourceChannel:if(u=n&&n.getSrcChannelMediaInfo(),!u)throw new B(O.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceChannel",uid:"0",channelName:u.channelName,token:u.token||this.joinInfo.appId},c;case gr.SetSourceUserId:if(u=n&&n.getSrcChannelMediaInfo(),!u)throw new B(O.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceUserId",uid:u.uid+""},c;case gr.SetDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new B(O.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(p=>{r.push(p.channelName),i.push(p.uid+""),a.push(p.token||this.joinInfo.appId)}),c.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:a},c;case gr.StartPacketTransfer:return c.clientRequest={command:"StartPacketTransfer"},c;case gr.Reconnect:return c.clientRequest={command:"Reconnect"},c;case gr.StopPacketTransfer:return c.clientRequest={command:"StopPacketTransfer"},c;case gr.UpdateDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new B(O.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(p=>{r.push(p.channelName),i.push(p.uid+""),a.push(p.token||this.joinInfo.appId)}),c.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:a},c;case gr.SetVideoProfile:c.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return c}}function o_(e){var t={},n=!1;function r(i,a){return n=!0,{done:!1,value:new yy(a=new Cy(function(c){c(e[i](a))}),1)}}return t[Fd!==void 0&&KO||"@@iterator"]=function(){return this},t.next=function(i){return n?(n=!1,i):r("next",i)},typeof e.throw=="function"&&(t.throw=function(i){if(n)throw n=!1,i;return r("throw",i)}),typeof e.return=="function"&&(t.return=function(i){return n?(n=!1,i):r("return",i)}),t}var R2=_(kk);function w2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function I2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?w2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var It;function b2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function A2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?b2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Al=(It=class tp extends _m{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return ue(n=Object.keys(Xd)).call(n,t)}))]}constructor(t,n){super(t,n),w(this,"store",void 0),w(this,"peerConnection",void 0),w(this,"remoteSDP",void 0),w(this,"initialOffer",void 0),w(this,"statsFilter",void 0),w(this,"useRTX",!1),w(this,"localCapabilities",void 0),w(this,"localCandidateCount",0),w(this,"allCandidatesReceived",!1),w(this,"establishPromise",void 0),w(this,"mutex",new On("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(tp.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=$m(this.peerConnection,L("STATS_UPDATE_INTERVAL"),void 0,yt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Po(t.sdp),r=Mh(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:L("FILTER_VIDEO_FEC"),filterAudioFec:L("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=t,A2(A2({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new J(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,n,r,i,a,c){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(u){w(this,"sessionDesc",void 0),w(this,"localCapabilities",void 0),w(this,"rtpCapabilities",void 0),w(this,"candidates",void 0),w(this,"iceParameters",void 0),w(this,"dtlsParameters",void 0),w(this,"setup",void 0),w(this,"currentMidIndex",void 0),w(this,"cname",void 0),u=At(u);const{remoteIceParameters:p,remoteDtlsParameters:f,candidates:m,remoteRTPCapabilities:E,remoteSetup:S,localCapabilities:I,sdkCodec:v,cname:y}=u,b=jt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=E,this.candidates=m,this.iceParameters=p,this.dtlsParameters=f,this.setup=S,this.localCapabilities=I,this.cname=y;for(let D=0;D<b.mediaDescriptions.length;D++){const U=b.mediaDescriptions[D];if(U.attributes.iceUfrag=p.iceUfrag,U.attributes.icePwd=p.icePwd,U.attributes.fingerprints=f.fingerprints,U.attributes.candidates=m,U.attributes.setup=S,U.media.mediaType==="video"){U.media.fmts=E.videoCodecs.map(W=>W.payloadType.toString(10));let F=E.videoCodecs.filter(W=>{var q,Q;return(q=W.rtpMap)===null||q===void 0?void 0:ue(Q=q.encodingName.toLowerCase()).call(Q,v)});F.length===0&&(F=E.videoCodecs),U.attributes.payloads=F,U.attributes.extmaps=E.videoExtensions}U.media.mediaType==="audio"&&(U.media.fmts=E.audioCodecs.map(F=>F.payloadType.toString(10)),U.attributes.payloads=E.audioCodecs,U.attributes.extmaps=E.audioExtensions),b.mediaDescriptions[D]=this.mungMediaDesc(U)}this.sessionDesc=b,this.currentMidIndex=b.mediaDescriptions.length-1}toString(){return jt.print(this.sessionDesc)}send(u,p,f){const{ssrcs:m,ssrcGroups:E}=mi(p,this.cname),S=this.sessionDesc.mediaDescriptions.find(y=>u===ye.VIDEO?y.media.mediaType==="video":y.media.mediaType==="audio"),I=m[0].attributes.label,v=m[0].attributes.mslabel;return S.attributes.ssrcs=S.attributes.ssrcs.concat(m),S.attributes.ssrcGroups=S.attributes.ssrcGroups.concat(E),{id:I,mslabel:v}}batchSend(u){return u.map(p=>{let{kind:f,ssrcMsg:m}=p;return this.send(f,m,void 0)})}stopSending(u){this.sessionDesc.mediaDescriptions.forEach(p=>{const f=[],m=[],E=[];p.attributes.ssrcs.forEach(S=>{ue(u).call(u,S.attributes.label||"")?E.push(S):f.push(S)}),p.attributes.ssrcGroups.forEach(S=>{var I;ue(I=E.map(v=>v.ssrcId)).call(I,S.ssrcIds[0])||m.push(S)}),p.attributes.ssrcs=f,p.attributes.ssrcGroups=m})}mute(u){const p=this.sessionDesc.mediaDescriptions.find(f=>f.attributes.mid===u);if(!p)throw new Error("mediaDescription not found with ".concat(u," in remote SDP when calling RemoteSDP.mute."));p.attributes.direction="inactive"}unmute(u){const p=this.sessionDesc.mediaDescriptions.find(f=>f.attributes.mid===u);if(!p)throw new Error("mediaDescription not found with ".concat(u," in remote SDP when calling RemoteSDP.unmute."));p.attributes.direction="sendonly"}receive(u,p,f){u.forEach((m,E)=>{const S=m._mediaStreamTrack,I=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===S.kind),v=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[I],m);this.sessionDesc.mediaDescriptions[I]=v})}stopReceiving(u){}updateCandidates(u){u===ar.TCP?this.candidates.forEach(p=>{this.candidates.findIndex(f=>f.transport==="tcp"&&f.connectionAddress===p.connectionAddress&&f.port===p.port)===-1&&this.candidates.push(I2(I2({},p),{},{foundation:"tcpcandidate",priority:Number(p.priority)-1+"",transport:"tcp",port:Number(p.port)+90+""}))}):this.candidates=this.candidates.filter(p=>p.transport!=="tcp");for(const p of this.sessionDesc.mediaDescriptions)p.attributes.candidates=this.candidates}restartICE(u){u=At(u),this.iceParameters=u,this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.iceUfrag=u.iceUfrag,p.attributes.icePwd=u.icePwd})}predictReceivingMids(u){const p=[];for(let f=0;f<u;f++)p.push((this.currentMidIndex+f+1).toString(10));return p}mungRecvMediaDsec(u,p){const f=At(u);return Aa(f,p),t_(f,p),f}updateRecvMedia(u,p){const f=this.sessionDesc.mediaDescriptions.findIndex(m=>m.attributes.mid===u);if(f!==-1){const m=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[f],p);this.sessionDesc.mediaDescriptions[f]=m}}bumpMid(u){this.currentMidIndex+=u}updateTrackLabel(u,p,f){const m=this.sessionDesc.mediaDescriptions.find(S=>u===ye.VIDEO?S.attributes.mid==="video":S.attributes.mid==="audio");if(m){const S=m.attributes.ssrcs.find(I=>I.attributes.label===p);var E;S&&(S.attributes.label=f,(E=S.attributes.msid)===null||E===void 0||E.replace(p,f))}}mungMediaDesc(u){const p=At(u);return e_(p),function(f){const m=f.attributes.extmaps.find(E=>E.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");m&&f.attributes.extmaps.splice(f.attributes.extmaps.indexOf(m),1),f.attributes.payloads.forEach(E=>{const S=E.rtcpFeedbacks.findIndex(I=>I.type==="transport-cc");S!==-1&&E.rtcpFeedbacks.splice(S,1)})}(p),p}getSSRC(u){for(const p of this.sessionDesc.mediaDescriptions)for(const f of p.attributes.ssrcs)if(f.attributes.label===u)return[f]}}({remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i.send,remoteSetup:a,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:c});const l=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(l){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(l.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new J(O.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}send(t,n){var r=this;return qr(function*(){const i=yield Be(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const a=t.map(E=>r.peerConnection.addTrack(E._mediaStreamTrack)),c=yield Be(r.peerConnection.createOffer()),l=jt.parse(c.sdp),u=t.map(E=>{const S=E._mediaStreamTrack,I=l.mediaDescriptions.find(v=>v.attributes.mid===S.kind);if(!I)throw new Error("Cannot extract ssrc from mediaDescription.");return function(v,y,b){const D=v.attributes.ssrcs.filter(F=>F.attributes.label===y),U=v.attributes.ssrcGroups;if(D.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(U&&D.length>1){const F=U.find(W=>W.ssrcIds.indexOf(D[0].ssrcId)!==-1);return F?[{ssrcId:F.ssrcIds[0],rtx:b?F.ssrcIds[1]:void 0}]:[{ssrcId:D[0].ssrcId}]}return[{ssrcId:D[0].ssrcId}]}(I,S.id,r.useRTX)});let p;try{p=yield u}catch(E){throw a.forEach(S=>{Cn()&&S.replaceTrack(null),r.peerConnection.removeTrack(S)}),E}const f=r.mungSendOfferSDP(c.sdp,t);r.remoteSDP.receive(t,n,p);const m=r.remoteSDP.toString();return yield Be(r.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Be(r.applySendEncodings(a,t)),yield Be(r.peerConnection.setRemoteDescription({type:"answer",sdp:m})),t.map((E,S)=>{const I=E._mediaStreamTrack.id;return{localSSRC:u[S],id:I}})}catch(a){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{i()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(a=>{var c;return t.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(a=>{Cn()&&a.replaceTrack(null),this.peerConnection.removeTrack(a)});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:a,mslabel:c}=this.remoteSDP.send(t,n,i),l=new ce((f,m)=>{const E=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(a)))},1e4),S=I=>{const v=tt();if((v.name==="Safari"&&Number(v.version)===11||Xn())&&I.track.id!==a&&I.streams[0].id===c){var y;const b=I.streams[0].getTracks()[0];return(y=this.remoteSDP)===null||y===void 0||y.updateTrackLabel(t,a,I.track.id),this.peerConnection.removeEventListener("track",S),clearTimeout(E),void f(b)}if(I.track.id===a)return this.peerConnection.removeEventListener("track",S),clearTimeout(E),void f(I.track)};this.peerConnection.addEventListener("track",S)}),u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const p=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(p),{track:await l,id:a}}catch(a){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(n){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(r=>{var i;return t.indexOf(((i=r.track)===null||i===void 0?void 0:i.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(r=>{if(Cn()&&r.track)r.track.enabled=!1;else{const i=r.getParameters();i.encodings.forEach(a=>a.active=!1),r.setParameters(i)}})}catch(n){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(a=>{var c;return t.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async a=>{if(Cn()&&a.track)a.track.enabled=!0;else{const c=a.getParameters();c.encodings.forEach(l=>l.active=!0),await a.setParameters(c)}});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return qr(function*(){const r=yield Be(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ze().supportPCSetConfiguration){const u=n.peerConnection.getConfiguration(),p=t===ar.RELAY?"relay":"all";u.iceTransportPolicy!==p&&(T.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(u.iceTransportPolicy,"] to [").concat(p,"]")),u.iceTransportPolicy=p,n.peerConnection.setConfiguration(u))}else if(t===ar.RELAY)return;t!==ar.RELAY&&n.remoteSDP.updateCandidates(t);const i=yield Be(n.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=Po(i.sdp),{remoteIceParameters:c}=yield a.iceParameters;n.remoteSDP.restartICE(c);const l=n.remoteSDP.toString();yield Be(n.peerConnection.setLocalDescription(i)),yield Be(n.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(i){T.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const a=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(r){throw new J(O.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getSenders().filter(i=>{var a;return((a=i.track)===null||a===void 0?void 0:a.id)===t});r.length===1&&await this.applySendEncodings(r,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getSenders().find(i=>{var a;return((a=i.track)===null||a===void 0?void 0:a.id)===n});r&&await r.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new J(O.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new J(O.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},L("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Yd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...tp.turnServerConfigToIceServers(t.turnServer.servers)),L("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...tp.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find(p=>{var f;return((f=p.track)===null||f===void 0?void 0:f.id)===t._mediaStreamTrack.id})),!n)return T.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Ze().supportSetRtpSenderParameters)return T.warn("Browser not support set rtp-sender parameters");const i={},a={};if(t instanceof wt)switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(L("DSCP_TYPE")&&pa()){var c;const p=L("DSCP_TYPE");ue(c=["very-low","low","medium","high"]).call(c,p)&&(a.networkPriority=p)}const l=n.getParameters(),u=(r=l.encodings)===null||r===void 0?void 0:r[0];u&&Object.assign(u,a),Object.assign(l,i),T.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await n.setParameters(l)}async applySendEncodings(t,n){try{if(!Ze().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],a=n[r];i&&a&&await this.updateRtpSenderEncodings(a,i)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const r=jt.parse(t);return n.forEach((i,a)=>{const c=i._mediaStreamTrack,l=r.mediaDescriptions.find(u=>u.attributes.mid===c.kind);l&&Aa(l,i)}),jt.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((a,c)=>{let{id:l,mslabel:u}=a;const{kind:p}=t[c];return new ce((f,m)=>{const E=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(l)))},1e4),S=I=>{const v=tt();if(v.name==="Safari"&&Number(v.version)===11&&I.track.id!==l&&I.streams[0].id===u){var y;const b=I.streams[0].getTracks()[0];return(y=this.remoteSDP)===null||y===void 0||y.updateTrackLabel(p,l,I.track.id),this.peerConnection.removeEventListener("track",S),clearTimeout(E),void f({track:b,id:l})}if(I.track.id===l)return this.peerConnection.removeEventListener("track",S),clearTimeout(E),void f({track:I.track,id:l})};this.peerConnection.addEventListener("track",S)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await ce.all(n)}catch(n){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Ze().supportPCSetConfiguration){const n=tp.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},se(It.prototype,"connect",[Pi],Object.getOwnPropertyDescriptor(It.prototype,"connect"),It.prototype),se(It.prototype,"stopSending",[Pi],Object.getOwnPropertyDescriptor(It.prototype,"stopSending"),It.prototype),se(It.prototype,"receive",[Pi],Object.getOwnPropertyDescriptor(It.prototype,"receive"),It.prototype),se(It.prototype,"stopReceiving",[Pi],Object.getOwnPropertyDescriptor(It.prototype,"stopReceiving"),It.prototype),se(It.prototype,"muteRemote",[Pi],Object.getOwnPropertyDescriptor(It.prototype,"muteRemote"),It.prototype),se(It.prototype,"unmuteRemote",[Pi],Object.getOwnPropertyDescriptor(It.prototype,"unmuteRemote"),It.prototype),se(It.prototype,"muteLocal",[Pi],Object.getOwnPropertyDescriptor(It.prototype,"muteLocal"),It.prototype),se(It.prototype,"unmuteLocal",[Pi],Object.getOwnPropertyDescriptor(It.prototype,"unmuteLocal"),It.prototype),se(It.prototype,"close",[Pi],Object.getOwnPropertyDescriptor(It.prototype,"close"),It.prototype),se(It.prototype,"updateEncoderConfig",[Pi],Object.getOwnPropertyDescriptor(It.prototype,"updateEncoderConfig"),It.prototype),se(It.prototype,"updateSendParameters",[Pi],Object.getOwnPropertyDescriptor(It.prototype,"updateSendParameters"),It.prototype),se(It.prototype,"replaceTrack",[Pi],Object.getOwnPropertyDescriptor(It.prototype,"replaceTrack"),It.prototype),se(It.prototype,"getRemoteSSRC",[Pi],Object.getOwnPropertyDescriptor(It.prototype,"getRemoteSSRC"),It.prototype),It);function Pi(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,a=await i.lock("Locking from P2PConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await r.apply(this,l)}finally{a()}},n}function O2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Pa(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?O2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const jh="9",N2=4e4;function D2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ws(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?D2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let s_=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({});var Ol=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Ol||{});const a_=new Map;function P2(e,t,n,r){let{scale:i}=e;if(i===0&&r===Ol.UP||i>=t.length-1&&r===Ol.DOWN)return e;let a=Ws(Ws({},e),{},{scale:r===Ol.DOWN?++i:--i});switch(n){case"maintain-framerate":a=Ws(Ws({},a),t[i].motion);break;case"maintain-resolution":a=Ws(Ws({},a),t[i].detail);break;case"balanced":a=Ws(Ws({},a),t[i].balanced)}return a}function L2(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:k2(t)};a_.set(e,n)}else a_.delete(e)}function k2(e){const t=Ws({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:a}=t,{MIN_FRAME_RATE:c,MAX_THRESHOLD_FRAMERATE:l,MAX_SCALE:u,BITRATE_MIN_THRESHOLD:p,BITRATE_MAX_THRESHOLD:f,BWE_SCALE_UP_THRESHOLD:m,BWE_SCALE_DOWN_THRESHOLD:E,PERF_SCALE_DOWN_THRESHOLD:S,PERF_SCALE_UP_THRESHOLD:I,BALANCE_BITRATE_FACTOR:v,BALANCE_FRAMERATE_FACTOR:y,BALANCE_RESOLUTION_FACTOR:b,MOTION_RESOLUTION_FACTOR:D,MOTION_BITRATE_FACTOR:U,DETAIL_FRAMERATE_FACTOR:F,DETAIL_BITRATE_FACTOR:W}=JT,q=Math.min(t.frameRate,l),Q=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(E,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(S,1)*q),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:a},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:a},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:a}}];for(let ee=1;ee<=u;ee++){const ne={bwe_up:Math.round(Math.pow(m,ee)*n),bwe_down:Math.round(Math.pow(E,ee+1)*n),fps_up:Math.round(Math.pow(I,ee)*q),fps_down:Math.round(Math.pow(S,ee+1)*q)},_e={scaleResolutionDownBy:i/Math.pow(b,ee),frameRate:Math.max(Math.round(Math.pow(y,ee)*r),c),bitrateMax:Math.max(Math.round(Math.pow(v,ee)*n),f),bitrateMin:Math.max(Math.round(Math.pow(v,ee)*a),p)},Qe={scaleResolutionDownBy:i/Math.pow(D,ee),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(U,ee)*n),f),bitrateMin:Math.max(Math.round(Math.pow(U,ee)*a),p)},ct={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(F,ee)*r),c),bitrateMax:Math.max(Math.round(Math.pow(W,ee)*n),f),bitrateMin:Math.max(Math.round(Math.pow(W,ee)*a),p)};Q.push({scale:ee,threshold:ne,balanced:_e,motion:Qe,detail:ct})}return Q}function OX(e,t,n,r,i,a){const c=a_.get(e)||{overUse:0,underUse:0,adaptationList:k2(i)},{adaptationList:l}=c;a_.set(e,c);const{OVERUSE_TIMES_THRESHOLD:u,UNDERUSE_TIMES_THRESHOLD:p}=JT,{scale:f}=r;let m,E;return typeof t=="number"&&t>0&&function(S,I,v,y){if(I>=v.length)return!1;let{threshold:{fps_down:b}}=v[I];return L("FORCE_AG_HIGH_FRAMERATE")&&y==="maintain-framerate"&&(b=v[0].threshold.fps_down),S<b}(t,f,l,a)&&(c.overUse++,E=s_.CPU,c.overUse>u)||typeof n=="number"&&n>0&&function(S,I,v){if(I>=v.length)return!1;const{threshold:{bwe_down:y}}=v[I];return S<y}(n,f,l)&&(c.overUse++,E=s_.BANDWIDTH,c.overUse>u)?(c.overUse=0,c.underUse=0,m=P2(r,l,a,Ol.DOWN),[m,E]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(S,I,v,y){if(I===0)return;let{threshold:{fps_up:b}}=v[I];return L("FORCE_AG_HIGH_FRAMERATE")&&y==="maintain-framerate"&&(b=v[1].threshold.fps_up),S>b}(t,f,l,a)&&function(S,I,v){if(I===0)return;const{threshold:{bwe_up:y}}=v[I];return S>y}(n,f,l)&&(c.underUse++,c.underUse>p&&(c.overUse=0,c.underUse=0,m=P2(r,l,a,Ol.UP),m.scale===0&&(E=s_.NONE))),[m,E])}function M2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function xy(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?M2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function NX(e){var t;return!!L("ENABLE_AG_ADAPTATION")&&!!(e instanceof Ty||ue(t=e._hints).call(t,Ot.CUSTOM_TRACK))&&(!!L("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const r=tt();if(r.os!==yn.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return Number(i[0])>=n}(14)&&KN(17,4)||HN(14)&&zN(17,4)))}const c_=new Map;function d_(e){const t=c_.get(e);if(t){const{timer:n,adaptationFunc:r,originConfig:i}=t;window.clearTimeout(n),r(i),c_.delete(e)}L2(e)}var rt;function x2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function La(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?x2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let xo=(rt=class np extends _m{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return ue(n=Object.keys(Xd)).call(n,t)}))]}constructor(t,n){super(t,n),w(this,"store",void 0),w(this,"peerConnection",void 0),w(this,"id",Rt(5,"connection-")),w(this,"remoteSDP",void 0),w(this,"initialOffer",void 0),w(this,"transportEventReceiver",void 0),w(this,"statsFilter",void 0),w(this,"useXR",L("USE_XR")),w(this,"localCapabilities",void 0),w(this,"remoteCodecs",void 0),w(this,"localCandidateCount",0),w(this,"allCandidatesReceived",!1),w(this,"dataStreamChannelMap",new Map),w(this,"establishPromise",void 0),w(this,"recoveredDataChannelIds",[]),w(this,"currentDataChannelId",1),w(this,"mutex",new On("P2PConnection-mutex")),w(this,"qualityLimitationReason",s_.NONE),this.store=n,this.peerConnection=new RTCPeerConnection(np.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=$m(this.peerConnection,L("STATS_UPDATE_INTERVAL"),void 0,yt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void T.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const a=this.remoteSDP.toString();i==null||i(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}else T.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Po(t.sdp),r=await Dy({filterRTX:!L("USE_PUB_RTX")&&!L("USE_SUB_RTX"),filterVideoFec:L("FILTER_VIDEO_FEC"),filterAudioFec:L("FILTER_AUDIO_FEC"),filterVideoCodec:L("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=bl(r),this.initialOffer=t,La(La({},n),{},{rtpCapabilities:r,offerSDP:t.sdp})}catch(t){throw new J(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,n,r,i,a,c){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{get localCapabilities(){return At(this._localCapabilities)}get rtpCapabilities(){return At(this._rtpCapabilities)}get candidates(){return At(this._candidates)}get iceParameters(){return At(this._iceParameters)}get dtlsParameters(){return At(this._dtlsParameters)}constructor(S){w(this,"sessionDesc",void 0),w(this,"_localCapabilities",void 0),w(this,"_rtpCapabilities",void 0),w(this,"_candidates",void 0),w(this,"_iceParameters",void 0),w(this,"_dtlsParameters",void 0),w(this,"setup",void 0),w(this,"currentMidIndex",void 0),w(this,"cname",void 0),w(this,"firefoxSsrcMidMap",new Map),S=At(S);const{remoteIceParameters:I,remoteDtlsParameters:v,candidates:y,remoteRTPCapabilities:b,remoteSetup:D,localCapabilities:U,cname:F}=S,W=jt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=b,this._candidates=y,this._iceParameters=I,this._dtlsParameters=v,this._localCapabilities=U,this.setup=D,this.cname=F;const q=this.rtpCapabilities.send;for(const Q of W.mediaDescriptions){if(Q.attributes.iceUfrag=I.iceUfrag,Q.attributes.icePwd=I.icePwd,Q.attributes.fingerprints=v.fingerprints,Q.attributes.candidates=y,Q.attributes.setup=D,Q.media.mediaType==="video"&&(Q.media.fmts=q.videoCodecs.map(ee=>ee.payloadType.toString(10)),Q.attributes.payloads=q.videoCodecs,Q.attributes.extmaps=q.videoExtensions,L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:ee,ssrcGroups:ne}=mi([{ssrcId:N2,rtx:L("USE_SUB_RTX")?40001:void 0}],this.cname);Q.attributes.ssrcs=ee,Q.attributes.ssrcGroups=ne}if(Q.media.mediaType==="audio"&&(Q.media.fmts=q.audioCodecs.map(ee=>ee.payloadType.toString(10)),Q.attributes.payloads=q.audioCodecs,Q.attributes.extmaps=q.audioExtensions,Lo(Q),L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:ee,ssrcGroups:ne}=mi([{ssrcId:2e4}],this.cname);Q.attributes.ssrcs=ee,Q.attributes.ssrcGroups=ne}}this.sessionDesc=W,this.currentMidIndex=W.mediaDescriptions.length-1}preloadRemoteMedia(){const S=L("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const I=this.candidates,v=this.dtlsParameters,y=this.iceParameters,b=this.rtpCapabilities.send;for(let D=1;D<S;D++){const U=2*D+2e4,F=2*D+N2,{ssrcs:W,ssrcGroups:q}=mi([{ssrcId:U}],this.cname),{ssrcs:Q,ssrcGroups:ee}=mi([{ssrcId:F,rtx:L("USE_SUB_RTX")?F+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:jh,protos:["UDP","TLS","RTP","SAVPF"],fmts:b.videoCodecs.map(ne=>ne.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:y.iceUfrag,icePwd:y.icePwd,unrecognized:[],candidates:I,extmaps:b.videoExtensions,fingerprints:v.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Q,ssrcGroups:ee,rtcpFeedbackWildcards:[],payloads:b.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*D)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:jh,protos:["UDP","TLS","RTP","SAVPF"],fmts:b.audioCodecs.map(ne=>ne.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:y.iceUfrag,icePwd:y.icePwd,unrecognized:[],candidates:I,extmaps:b.audioExtensions,fingerprints:v.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:W,ssrcGroups:q,rtcpFeedbackWildcards:[],payloads:b.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*D+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return jt.print(this.sessionDesc)}send(S,I,v,y){const{ssrcs:b,ssrcGroups:D}=mi(I,this.cname,L("SYNC_GROUP")?v:void 0),U=this.findPreloadMediaDesc(b);if(U){if(yt()&&this.firefoxSsrcMidMap.set(b[0].ssrcId,U.attributes.mid),y&&(y.twcc||y.remb)){const F=this.sessionDesc.mediaDescriptions.indexOf(U);return this.sessionDesc.mediaDescriptions[F]=this.mungSendMediaDesc(U,y),{mid:U.attributes.mid,needExchangeSDP:!0}}return{mid:U.attributes.mid,needExchangeSDP:!1}}{const F=this.findAvailableMediaIndex(S,b);let W;return F===-1||F===1&&(Cn()||qN())||F===0&&L("USE_SUB_RTX")||JN()?(W=this.createOrRecycleSendMedia(S,b,D,"sendonly",y),this.updateBundleMids()):(W=At(this.sessionDesc.mediaDescriptions[F]),W.attributes.direction="sendonly",W.attributes.ssrcs=b,W.attributes.ssrcGroups=D,this.sessionDesc.mediaDescriptions[F]=this.mungSendMediaDesc(W,y)),yt()&&this.firefoxSsrcMidMap.set(b[0].ssrcId,W.attributes.mid),{mid:W.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:S,needExchangeSDP:I}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:S.attributes.mid,needExchangeSDP:I}}batchSend(S){const I=S.map(b=>{let{kind:D,ssrcMsg:U,mslabel:F}=b;return this.send(D,U,F)}),v=[];let y=!1;return I.forEach(b=>{let{mid:D,needExchangeSDP:U}=b;U&&(y=!0),v.push(D)}),{mids:v,needExchangeSDP:y}}stopSending(S){const I=this.sessionDesc.mediaDescriptions.filter(v=>v.attributes.mid&&S.indexOf(v.attributes.mid)!==-1);if(I.length!==S.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");I.forEach(v=>{v.attributes.mid==="0"||yt()||JN()?v.attributes.ssrcs=[]:(v.attributes.ssrcs=[],v.attributes.direction="inactive",v.media.port="0")}),this.updateBundleMids()}mute(S){const I=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===S);if(!I)throw new Error("mediaDescription not found with ".concat(S," in remote SDP when calling RemoteSDP.mute."));I.attributes.direction="inactive"}unmute(S){const I=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===S);if(!I)throw new Error("mediaDescription not found with ".concat(S," in remote SDP when calling RemoteSDP.unmute."));I.attributes.direction="sendonly"}muteRemote(S){const I=this.sessionDesc.mediaDescriptions.filter(v=>ue(S).call(S,v.attributes.mid||""));if(I.length!==S.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");I.forEach(v=>{v.attributes.direction="inactive"})}unmuteRemote(S){const I=this.sessionDesc.mediaDescriptions.filter(v=>ue(S).call(S,v.attributes.mid||""));if(I.length!==S.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");I.forEach(v=>{v.attributes.direction="recvonly"})}receive(S,I,v,y){S.forEach((b,D)=>{this.createOrRecycleRecvMedia(b,[],"recvonly",I,v,y[D])}),this.updateBundleMids()}stopReceiving(S){const I=this.sessionDesc.mediaDescriptions.filter(v=>S.indexOf(v.attributes.mid)!==-1);if(I.length!==S.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");I.forEach(v=>{v.media.port="0",v.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(S){const I=this._candidates.filter(v=>v.transport==="udp");if(S===ar.TCP){if(I.length===0)return;if(L("TCP_CANDIDATE_ONLY")){const v=this._candidates.filter(y=>y.transport==="tcp");I.forEach(y=>{v.findIndex(b=>b.connectionAddress===y.connectionAddress)===-1&&v.push(Pa(Pa({},y),{},{foundation:"tcpcandidate",priority:Number(y.priority)-1+"",transport:"tcp",port:Number(y.port)+90+""}))}),this._candidates=v}else{const v=[];I.forEach(y=>{v.push(Pa(Pa({},y),{},{foundation:"tcpcandidate",priority:Number(y.priority)-1+"",transport:"tcp",port:Number(y.port)+90+""}))}),this._candidates=[...I,...v]}}else if(S===ar.RELAY){if(I.length!==0)return;{const v=this._candidates.filter(y=>y.transport==="tcp");v.forEach(y=>{I.push(Pa(Pa({},y),{},{foundation:"udpcandidate",priority:Number(y.priority)+1+"",transport:"udp",port:Number(y.port)-90+""}))}),this._candidates=[...I,...v]}}else I.length===0?(this._candidates.filter(v=>v.transport==="tcp").forEach(v=>{I.push(Pa(Pa({},v),{},{foundation:"udpcandidate",priority:Number(v.priority)+1+"",transport:"udp",port:Number(v.port)-90+""}))}),this._candidates=I):this._candidates=this._candidates.filter(v=>v.transport!=="tcp");for(const v of this.sessionDesc.mediaDescriptions)v.attributes.candidates=this.candidates}restartICE(S){S=At(S),this._iceParameters=S,this.sessionDesc.mediaDescriptions.forEach(I=>{I.attributes.iceUfrag=S.iceUfrag,I.attributes.icePwd=S.icePwd})}predictReceivingMids(S){const I=[];for(let v=0;v<S;v++)I.push((this.currentMidIndex+v+1).toString(10));return I}findAvailableMediaIndex(S,I){return this.sessionDesc.mediaDescriptions.findIndex(v=>{const y=v.media.mediaType===S&&v.media.port!=="0"&&(v.attributes.direction==="sendonly"||v.attributes.direction==="sendrecv")&&v.attributes.ssrcs.length===0;if(yt()){if(y){const b=this.firefoxSsrcMidMap.get(I[0].ssrcId);return!(b||v.attributes.mid!=="0"&&v.attributes.mid!=="1")||!(!b||b!==v.attributes.mid)}return!1}return y})}createOrRecycleDataChannel(){for(const v of this.sessionDesc.mediaDescriptions)if(v.media.mediaType==="application")return{mediaDesc:v,needExchangeSDP:!1};this.currentMidIndex+=1;const S="".concat(this.currentMidIndex),I={media:{mediaType:"application",port:jh,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(S),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(I),{mediaDesc:I,needExchangeSDP:!0}}createOrRecycleRecvMedia(S,I,v,y,b,D){const U=S._mediaStreamTrack.kind,F=this.rtpCapabilities.recv,W=zc(U,F,this.localCapabilities.send,U===ye.VIDEO?y:b),q=U===ye.VIDEO?F.videoExtensions:F.audioExtensions;this.currentMidIndex+=1;const Q="".concat(this.currentMidIndex);let ee={media:{mediaType:U,port:jh,protos:["UDP","TLS","RTP","SAVPF"],fmts:W.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:q,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:I,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:W,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:v,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Q)}};ee=this.mungRecvMediaDsec(ee,S,D);const ne=this.findFirstClosedMedia(U);if(ne){const _e=this.sessionDesc.mediaDescriptions.indexOf(ne);this.sessionDesc.mediaDescriptions[_e]=ee}else this.sessionDesc.mediaDescriptions.push(ee);return ee}updateRemoteCodec(S,I,v){const y=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(ee=>ee.rtpMap&&ee.rtpMap.encodingName.toLowerCase()||"").filter(ee=>{var ne;return ue(ne=Object.keys(Xd)).call(ne,ee)}))],b=new Set(I);if(y.every(ee=>b.has(ee)))return T.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(I)),!1;const D=this._rtpCapabilities.recv.videoCodecs.filter(ee=>I.some(ne=>{var _e;return ue(_e=ee.rtpMap&&ee.rtpMap.encodingName.toLowerCase()||"").call(_e,ne)}));if(D.length===0)return T.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(y," codecs: ").concat(I)),!1;const U=[...new Set(D.map(ee=>ee.rtpMap&&ee.rtpMap.encodingName.toLowerCase()||""))];let F;if(T.debug("updateRemoteCodec, from ".concat(y," to ").concat(U)),S.length===0)F=this.sessionDesc.mediaDescriptions.filter(ee=>ee.media.mediaType==="video"&&ee.attributes.direction==="recvonly");else if(F=this.sessionDesc.mediaDescriptions.filter(ee=>ee.attributes.mid&&ue(S).call(S,ee.attributes.mid)&&ee.attributes.direction==="recvonly"),F.length!==S.length)return T.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(S,", codecs: ").concat(I)),!1;if(L("USE_PUB_RTX")||L("USE_SUB_RTX")){const ee=Py(D,this.rtpCapabilities.recv.videoCodecs);D.push(...ee)}this._rtpCapabilities.recv.videoCodecs=D;const W=this.localCapabilities.send,q=this.rtpCapabilities.recv,Q=zc(ye.VIDEO,q,W,v);return F.forEach(ee=>{const ne=Q.map(_e=>_e.payloadType.toString(10));T.debug("updateRemoteCodec mid: ".concat(ee.attributes.mid,", from ").concat(ee.attributes.payloads," to ").concat(Q)),ee.attributes.payloads=Q,ee.media.fmts=ne}),!0}createOrRecycleSendMedia(S,I,v,y,b){const D=this.rtpCapabilities.send,U=S===ye.VIDEO?D.videoCodecs:D.audioCodecs,F=S===ye.VIDEO?D.videoExtensions:D.audioExtensions;this.currentMidIndex+=1;const W="".concat(this.currentMidIndex);let q={media:{mediaType:S,port:jh,protos:["UDP","TLS","RTP","SAVPF"],fmts:U.map(ee=>ee.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:F,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:I,ssrcGroups:v,rtcpFeedbackWildcards:[],payloads:U,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:y,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(W)}};q=this.mungSendMediaDesc(q,b);const Q=this.findFirstClosedMedia(S);if(Q){const ee=this.sessionDesc.mediaDescriptions.indexOf(Q);this.sessionDesc.mediaDescriptions[ee]=q}else this.sessionDesc.mediaDescriptions.push(q);return q}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(S=>S.media.port!=="0").map(S=>S.attributes.mid)}mungRecvMediaDsec(S,I,v){const y=At(S);return e_(y),Aa(y,I),t_(y,I),Oy(y),Il(y,v,this.localCapabilities.send),y}mungSendMediaDesc(S,I){const v=At(S);return Il(v,I,this.localCapabilities.recv),Lo(v),v}updateRecvMedia(S,I){const v=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===S);if(v!==-1){const y=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[v],I);this.sessionDesc.mediaDescriptions[v]=y}}bumpMid(S){this.currentMidIndex+=S}findFirstClosedMedia(S){return this.sessionDesc.mediaDescriptions.find(I=>yt()?I.media.port==="0"&&I.media.mediaType===S:I.media.port==="0")}findPreloadMediaDesc(S){return this.sessionDesc.mediaDescriptions.find(I=>{var v;return((v=I.attributes)===null||v===void 0||(v=v.ssrcs[0])===null||v===void 0?void 0:v.ssrcId)===S[0].ssrcId})}getSSRC(S){var I;return(I=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===S))===null||I===void 0?void 0:I.attributes.ssrcs}}({remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:a,localCapabilities:this.localCapabilities,cname:c}),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const l=this.remoteSDP.toString(),u=jt.parse(this.initialOffer.sdp),p=u.mediaDescriptions.find(S=>S.media.mediaType==="audio");p&&Lo(p),this.useXR&&n_(u);const f=jt.print(u),m=this.logSDPExchange(f||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:f}),m==null||m(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l});const E=this.peerConnection.getTransceivers()[0];if(E!=null&&E.receiver&&this.tryBindTransportEvents(E.receiver),L("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const S=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:S});const I=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(I)}}catch(l){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(l.toString()))}}send(t,n,r){var i=this;return qr(function*(){const a=yield Be(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[];t.forEach(v=>{const y=i.peerConnection.addTransceiver(v._mediaStreamTrack,{direction:"sendonly"});c.push(y),v._updateRtpTransceiver(y)}),yt()&&L("SIMULCAST")===!0&&(yield Be(i.applySimulcastForFirefox(c,t)));const l=yield Be(i.peerConnection.createOffer()),u=i.remoteSDP.predictReceivingMids(t.length),p=i.mungSendOfferSDP(l.sdp,t,u),f=jt.parse(p),m=u.map(v=>{const y=f.mediaDescriptions.find(b=>b.attributes.mid===v);if(!y)throw new Error("Cannot extract ssrc from mediaDescription.");return Ay(y,L("USE_PUB_RTX"))});let E;try{E=yield m}catch(v){E=[],i.remoteSDP.receive(t,n,r,E);const y=i.remoteSDP.toString();throw yield Be(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Be(i.peerConnection.setRemoteDescription({type:"answer",sdp:y})),yield Be(i.stopSending(u,!0)),v}i.remoteSDP.receive(t,n,r,E);const S=i.remoteSDP.toString(),I=i.logSDPExchange(p,"offer","local","send");return yield Be(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Be(i.applySimulcastEncodings(c,t)),yield Be(i.applySendEncodings(c,t)),I==null||I(S),yield Be(i.peerConnection.setRemoteDescription({type:"answer",sdp:S})),c.map((v,y)=>{const b=u[y];return{localSSRC:m[y],id:b,transceiver:v}})}catch(c){throw c instanceof J?c:new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")T.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const a=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof a!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:a,negotiated:!0,ordered:!1,maxRetransmits:L("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}n.forEach(a=>{a._updateOriginDataChannel(r)});const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),T.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else T.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof J?r:new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof J?n:new J(O.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(u=>t.indexOf(u.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(u=>{var p;d_(this.id+u.mid),u.direction="inactive",(p=u.stop)===null||p===void 0||p.call(u)});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(t,n,r,i);if(c){const u=this.remoteSDP.toString(),p=this.logSDPExchange(u,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const f=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(f.sdp,a,t);p==null||p(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(u=>u.mid===a);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:a,transceiver:l}}catch(a){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);if(r){const i=this.remoteSDP.toString(),a=this.logSDPExchange(i,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c),T.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return n.map(i=>{const a=this.peerConnection.getTransceivers().find(c=>c.mid===i);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:i,transceiver:a}})}catch(n){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const a=this.remoteSDP.toString();i==null||i(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,l)=>{c.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const a=this.remoteSDP.toString();i==null||i(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return qr(function*(){const r=yield Be(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ze().supportPCSetConfiguration){const p=n.peerConnection.getConfiguration(),f=t===ar.RELAY?"relay":"all";p.iceTransportPolicy!==f&&(T.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(p.iceTransportPolicy,"] to [").concat(f,"]")),p.iceTransportPolicy=f,n.peerConnection.setConfiguration(p))}else if(t===ar.RELAY)return;n.remoteSDP.updateCandidates(t);const i=yield Be(n.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=Po(i.sdp),{remoteIceParameters:c}=yield a.iceParameters;n.remoteSDP.restartICE(c);const l=n.remoteSDP.toString(),u=n.logSDPExchange(i.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Be(n.peerConnection.setLocalDescription(i)),u==null||u(l),yield Be(n.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(i){T.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{d_(this.id+n.mid)}),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return La(La({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const a=this.remoteSDP.toString(),c=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),c==null||c(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(r){throw new J(O.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?yt()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:La(La({},Es),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:La(La({},Es),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},L("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Yd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...np.turnServerConfigToIceServers(t.turnServer.servers)),L("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...np.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),L("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),L("ENABLE_ENCODED_TRANSFORM")&&Ze().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Ta(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!L("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var i;n!=null&&n.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,n.state))},n.onerror=i=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in i?i.error:i)};const r=n.iceTransport;r&&(r.onstatechange=()=>{const i=n==null?void 0:n.iceTransport.state;var a;i&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:i,remote:a}=r.getSelectedCandidatePair();T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r,i;if(n||(n=this.peerConnection.getSenders().find(y=>y.track===t._mediaStreamTrack)),!n)return T.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ze().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const a={},c={};switch(t._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;case"balanced":a.degradationPreference="balanced"}const l=function(v,y){return v.getTransceivers().find(b=>b.sender.track===y||b.receiver.track===y)}(this.peerConnection,t._mediaStreamTrack),u=$J(t);if(NX(t)&&l&&n&&u&&this.getLocalVideoStats&&ue(r=["vp8","vp9"]).call(r,this.store.codec)){var p;const v=a.degradationPreference||(ue(p=t._hints).call(p,Ot.CUSTOM_TRACK)?L("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(y,b,D,U,F,W){if(d_(y),U!=="balanced"&&U!=="maintain-framerate"&&U!=="maintain-resolution")return;let q=-1;L2(y,b);const Q=window.setInterval(()=>{const ne=c_.get(y);if(!L("ENABLE_AG_ADAPTATION")||!ne)return void d_(y);const _e=W();if(_e.sendPackets>0&&_e.OutgoingAvailableBandwidth>0){if(q===-1)return void(q=Date.now());if(Date.now()-q<1e3)return;const Qe=_e.sendFrameRate,ct=_e.OutgoingAvailableBandwidth,[Nt,dn]=OX(y,Qe,ct,ne.adaptationConfig,b,U);dn&&(D.qualityLimitationReason=dn),Nt&&ne.adaptationConfig.scale!==Nt.scale&&(T.debug("[".concat(y,"] applyAdaptation: ").concat(D.qualityLimitationReason,`
           sendFps `).concat(Qe,", bwe ").concat(ct,", switch from ").concat(ne.adaptationConfig.scale," to ").concat(Nt.scale," ")),ne.adaptationConfig=xy(xy({},ne.adaptationConfig),Nt),F(Nt))}},L("CHECK_LOCAL_STATS_INTERVAL")),ee=xy({},b);c_.set(y,{timer:Q,adaptationConfig:ee,originConfig:b,adaptationFunc:F}),T.debug("[".concat(y,"] start adaptation, originConfig: ").concat(JSON.stringify(b),", degradationPreference: ").concat(U))})(this.id+l.mid,u,this,v,y=>{n&&this.updateAdaptation(n,y)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var f;const{bitrateMax:v,frameRate:y,scaleResolutionDownBy:b}=t._encoderConfig;v&&(c.maxBitrate=1e3*v),(ue(f=t._hints).call(f,Ot.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(y&&(c.maxFramerate=Lr(y)),b&&b>=1&&(c.scaleResolutionDownBy=b))}const{maxFramerate:m}=L("ENCODER_CONFIG_LIMIT");if(m&&typeof m=="number"&&(c.maxFramerate=c.maxFramerate?Math.min(c.maxFramerate,m):m),L("DSCP_TYPE")&&pa()){var E;const v=L("DSCP_TYPE");ue(E=["very-low","low","medium","high"]).call(E,v)&&(c.networkPriority=v)}const S=n.getParameters(),I=(i=S.encodings)===null||i===void 0?void 0:i[0];yt()&&!I&&(a.encodings=[c]),I&&Object.assign(I,c),Object.assign(S,a),T.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(S.encodings))),await n.setParameters(S)}async updateAdaptation(t,n){var r,i;if(!t)return T.debug("[updateAdaptation] no rtpSender found");if(!Ze().supportSetRtpSenderParameters)return T.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const a={},{bitrateMax:c,frameRate:l,scaleResolutionDownBy:u}=n;c&&(a.maxBitrate=1e3*c),l&&(a.maxFramerate=Lr(l)),u&&u>=1&&ue(r=["vp8","vp9"]).call(r,this.store.codec)&&(a.scaleResolutionDownBy=u);const p=t.getParameters(),f=(i=p.encodings)===null||i===void 0?void 0:i[0];f&&Object.assign(f,a),Object.assign(p,{});try{await t.setParameters(p),T.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(p.encodings)))}catch(m){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?T.debug("[updateAdaptation] peerConnection not connected}"):T.debug("[updateAdaptation] updateRtpSenderEncodings failed",m):T.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!Ze().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],a=n[r];a instanceof wt&&!this.isVP8Simulcast(a)&&await this.updateRtpSenderEncodings(a,i.sender)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const i=jt.parse(t);return n.forEach((a,c)=>{const l=r[c],u=i.mediaDescriptions.find(p=>p.attributes.mid===l);u&&(Aa(u,a),Ny(u,a,this.store.codec))}),jt.print(i)}mungReceiveAnswerSDP(t,n,r){const i=jt.parse(t),a=i.mediaDescriptions.find(c=>c.attributes.mid===n);return a&&(r===ye.AUDIO&&a.media.mediaType==="audio"&&Lo(a),this.useXR&&n_(i)),jt.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let u=0;u<t.length;u++){var r,i,a,c,l;const p=t[u],f=n[u];if(f instanceof wt&&!ue(r=f._hints).call(r,Ot.LOW_STREAM)&&(i=f._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((a=f._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(c=f._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=f._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const m={},E={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const S=p.sender.getParameters();await p.sender.setParameters(Object.assign(S,m))}}}async applySimulcastEncodings(t,n){if(!yt()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof wt&&this.isVP8Simulcast(i)){const a=t[r],c={},l={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const u=a.sender.getParameters();await a.sender.setParameters(Object.assign(u,c))}}}isVP8Simulcast(t){var n,r,i,a,c;return!!(t instanceof wt&&L("SIMULCAST")&&this.store.codec==="vp8"&&!ue(n=t._hints).call(n,Ot.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(a=t._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=t._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(L("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",r==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Ze().supportPCSetConfiguration){const n=np.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},se(rt.prototype,"updateRemoteRTPCapabilities",[kr],Object.getOwnPropertyDescriptor(rt.prototype,"updateRemoteRTPCapabilities"),rt.prototype),se(rt.prototype,"connect",[kr],Object.getOwnPropertyDescriptor(rt.prototype,"connect"),rt.prototype),se(rt.prototype,"createDataChannels",[kr],Object.getOwnPropertyDescriptor(rt.prototype,"createDataChannels"),rt.prototype),se(rt.prototype,"receive",[kr],Object.getOwnPropertyDescriptor(rt.prototype,"receive"),rt.prototype),se(rt.prototype,"batchReceive",[kr],Object.getOwnPropertyDescriptor(rt.prototype,"batchReceive"),rt.prototype),se(rt.prototype,"stopReceiving",[kr],Object.getOwnPropertyDescriptor(rt.prototype,"stopReceiving"),rt.prototype),se(rt.prototype,"muteRemote",[kr],Object.getOwnPropertyDescriptor(rt.prototype,"muteRemote"),rt.prototype),se(rt.prototype,"unmuteRemote",[kr],Object.getOwnPropertyDescriptor(rt.prototype,"unmuteRemote"),rt.prototype),se(rt.prototype,"muteLocal",[kr],Object.getOwnPropertyDescriptor(rt.prototype,"muteLocal"),rt.prototype),se(rt.prototype,"unmuteLocal",[kr],Object.getOwnPropertyDescriptor(rt.prototype,"unmuteLocal"),rt.prototype),se(rt.prototype,"close",[kr],Object.getOwnPropertyDescriptor(rt.prototype,"close"),rt.prototype),se(rt.prototype,"updateEncoderConfig",[kr],Object.getOwnPropertyDescriptor(rt.prototype,"updateEncoderConfig"),rt.prototype),se(rt.prototype,"updateSendParameters",[kr],Object.getOwnPropertyDescriptor(rt.prototype,"updateSendParameters"),rt.prototype),se(rt.prototype,"replaceTrack",[kr],Object.getOwnPropertyDescriptor(rt.prototype,"replaceTrack"),rt.prototype),se(rt.prototype,"updateAdaptation",[kr],Object.getOwnPropertyDescriptor(rt.prototype,"updateAdaptation"),rt.prototype),se(rt.prototype,"getRemoteSSRC",[kr],Object.getOwnPropertyDescriptor(rt.prototype,"getRemoteSSRC"),rt.prototype),rt);function kr(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,a=await i.lock("From P2PConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await r.apply(this,l)}finally{a()}},n}function U2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function j2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?U2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const V2=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,l_="9",Uy=2e4,jy=4e4;class DX{get localCapabilities(){return At(this._localCapabilities)}get rtpCapabilities(){return At(this._rtpCapabilities)}get candidates(){return At(this._candidates)}get iceParameters(){return At(this._iceParameters)}get dtlsParameters(){return At(this._dtlsParameters)}constructor(t){w(this,"sessionDesc",void 0),w(this,"_localCapabilities",void 0),w(this,"_rtpCapabilities",void 0),w(this,"_candidates",void 0),w(this,"_iceParameters",void 0),w(this,"_dtlsParameters",void 0),w(this,"setup",void 0),w(this,"currentMidIndex",void 0),w(this,"cname",void 0),w(this,"firefoxSsrcMidMap",new Map),t=At(t);const{remoteIceParameters:n,remoteDtlsParameters:r,candidates:i,remoteRTPCapabilities:a,remoteSetup:c,localCapabilities:l,cname:u}=t,p=jt.parse(V2);this._rtpCapabilities=a,this._candidates=i,this._iceParameters=n,this._dtlsParameters=r,this._localCapabilities=l,this.setup=c,this.cname=u;const f=this.rtpCapabilities.send;for(const m of p.mediaDescriptions){if(m.attributes.iceUfrag=n.iceUfrag,m.attributes.icePwd=n.icePwd,m.attributes.fingerprints=r.fingerprints,m.attributes.candidates=i,m.attributes.setup=c,m.media.mediaType==="application"&&(m.attributes.sctpPort="5000"),m.media.mediaType==="video"&&(m.media.fmts=f.videoCodecs.map(E=>E.payloadType.toString(10)),m.attributes.payloads=f.videoCodecs,m.attributes.extmaps=f.videoExtensions,L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:E,ssrcGroups:S}=mi([{ssrcId:jy,rtx:L("USE_SUB_RTX")?40001:void 0}],this.cname);m.attributes.ssrcs=E,m.attributes.ssrcGroups=S}if(m.media.mediaType==="audio"&&(m.media.fmts=f.audioCodecs.map(E=>E.payloadType.toString(10)),m.attributes.payloads=f.audioCodecs,m.attributes.extmaps=f.audioExtensions,Lo(m),L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:E,ssrcGroups:S}=mi([{ssrcId:Uy}],this.cname);m.attributes.ssrcs=E,m.attributes.ssrcGroups=S}}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}updateRemoteRTPCapabilities(t){const n=jt.parse(V2);this._rtpCapabilities=t;const r=this.rtpCapabilities.send;for(const i of n.mediaDescriptions){if(i.attributes.iceUfrag=this._iceParameters.iceUfrag,i.attributes.icePwd=this._iceParameters.icePwd,i.attributes.fingerprints=this._dtlsParameters.fingerprints,i.attributes.candidates=this._candidates,i.attributes.setup=this.setup,i.media.mediaType==="application"&&(i.attributes.sctpPort="5000"),i.media.mediaType==="video"&&(i.media.fmts=r.videoCodecs.map(a=>a.payloadType.toString(10)),i.attributes.payloads=r.videoCodecs,i.attributes.extmaps=r.videoExtensions,L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:a,ssrcGroups:c}=mi([{ssrcId:jy,rtx:L("USE_SUB_RTX")?40001:void 0}],this.cname);i.attributes.ssrcs=a,i.attributes.ssrcGroups=c}if(i.media.mediaType==="audio"&&(i.media.fmts=r.audioCodecs.map(a=>a.payloadType.toString(10)),i.attributes.payloads=r.audioCodecs,i.attributes.extmaps=r.audioExtensions,L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:a,ssrcGroups:c}=mi([{ssrcId:Uy}],this.cname);i.attributes.ssrcs=a,i.attributes.ssrcGroups=c}}this.sessionDesc=n,this.currentMidIndex=n.mediaDescriptions.length-1}preloadRemoteMedia(t){this.rtpCapabilities;const n=this.candidates,r=this.dtlsParameters,i=this.iceParameters,a=this.rtpCapabilities.send;for(let c=1;c<t;c++){const l=2*c+Uy,u=2*c+jy,{ssrcs:p,ssrcGroups:f}=mi([{ssrcId:l}],this.cname),{ssrcs:m,ssrcGroups:E}=mi([{ssrcId:u,rtx:L("USE_SUB_RTX")?u+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:l_,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.videoCodecs.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:n,extmaps:a.videoExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:m,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:a.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*c-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:l_,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.audioCodecs.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:n,extmaps:a.audioExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:f,rtcpFeedbackWildcards:[],payloads:a.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*c)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return jt.print(this.sessionDesc)}send(t,n,r,i){const{ssrcs:a,ssrcGroups:c}=mi(n,this.cname,L("SYNC_GROUP")?r:void 0),l=this.findPreloadMediaDesc(a);if(l){if(yt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,l.attributes.mid),i&&(i.twcc||i.remb)){const u=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(l,i),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{const u=this.findAvailableMediaIndex(t,a);let p;return u===-1||Cn()||Xn()||qN()||u===0&&L("USE_SUB_RTX")?(p=this.createOrRecycleSendMedia(t,a,c,"sendonly",i),this.updateBundleMids()):(p=At(this.sessionDesc.mediaDescriptions[u]),p.attributes.direction="sendonly",p.attributes.ssrcs=a,p.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(p,i)),yt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,p.attributes.mid),{mid:p.attributes.mid,needExchangeSDP:!0}}}batchSend(t){const n=t.map(a=>{let{kind:c,ssrcMsg:l,mslabel:u}=a;return this.send(c,l,u)}),r=[];let i=!1;return n.forEach(a=>{let{mid:c,needExchangeSDP:l}=a;l&&(i=!0),r.push(c)}),{mids:r,needExchangeSDP:i}}stopSending(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&t.indexOf(r.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(r=>{r.attributes.mid==="0"||yt()||Cn()||Xn()?r.attributes.ssrcs=[]:(r.attributes.ssrcs=[],r.attributes.direction="inactive",r.media.port="0")}),this.updateBundleMids()}mute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}muteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>ue(t).call(t,r.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>ue(t).call(t,r.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(r=>{r.attributes.direction="recvonly"})}receive(t,n,r,i){t.forEach((a,c)=>{this.createOrRecycleRecvMedia(a,[],"recvonly",n,r,i[c])}),this.updateBundleMids()}stopReceiving(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>t.indexOf(r.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(t){t===ar.TCP?this._candidates.forEach(n=>{this._candidates.findIndex(r=>r.transport==="tcp"&&r.connectionAddress===n.connectionAddress&&r.port===n.port)===-1&&this._candidates.push(j2(j2({},n),{},{foundation:"tcpcandidate",priority:Number(n.priority)-1+"",transport:"tcp",port:Number(n.port)+90+""}))}):this._candidates=this._candidates.filter(n=>n.transport!=="tcp");for(const n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(t){t=At(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let r=0;r<t;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}findAvailableMediaIndex(t,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(yt()){if(i){const a=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(a||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!a||a!==r.attributes.mid)}return!1}return i})}createOrRecycleRecvMedia(t,n,r,i,a,c){const l=t._mediaStreamTrack.kind,u=this.rtpCapabilities.recv,p=zc(l,u,this.localCapabilities.send,l===ye.VIDEO?i:a),f=l===ye.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;const m="".concat(this.currentMidIndex);let E={media:{mediaType:l,port:l_,protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(I=>I.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:f,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};E=this.mungRecvMediaDsec(E,t,c);const S=this.findFirstClosedMedia(l);if(S){const I=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[I]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}updateRemoteCodec(t,n,r){const i=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(E=>E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"").filter(E=>{var S;return ue(S=Object.keys(Xd)).call(S,E)}))],a=new Set(n);if(i.every(E=>a.has(E)))return T.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(n)),!1;const c=this._rtpCapabilities.recv.videoCodecs.filter(E=>n.some(S=>{var I;return ue(I=E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"").call(I,S)}));if(c.length===0)return T.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(i," codecs: ").concat(n)),!1;const l=[...new Set(c.map(E=>E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||""))];let u;if(T.debug("updateRemoteCodec, from ".concat(i," to ").concat(l)),t.length===0)u=this.sessionDesc.mediaDescriptions.filter(E=>E.media.mediaType==="video"&&E.attributes.direction==="recvonly");else if(u=this.sessionDesc.mediaDescriptions.filter(E=>E.attributes.mid&&ue(t).call(t,E.attributes.mid)&&E.attributes.direction==="recvonly"),u.length!==t.length)return T.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(t,", codecs: ").concat(n)),!1;this._rtpCapabilities.recv.videoCodecs=c;const p=this.localCapabilities.send,f=this.rtpCapabilities.recv,m=zc(ye.VIDEO,f,p,r);return u.forEach(E=>{const S=m.map(I=>I.payloadType.toString(10));T.debug("updateRemoteCodec mid: ".concat(E.attributes.mid,", from ").concat(E.attributes.payloads," to ").concat(m)),E.attributes.payloads=m,E.media.fmts=S}),!0}createOrRecycleSendMedia(t,n,r,i,a){const c=this.rtpCapabilities.send,l=t===ye.VIDEO?c.videoCodecs:c.audioCodecs,u=t===ye.VIDEO?c.videoExtensions:c.audioExtensions;this.currentMidIndex+=1;const p="".concat(this.currentMidIndex);let f={media:{mediaType:t,port:l_,protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};f=this.mungSendMediaDesc(f,a);const m=this.findFirstClosedMedia(t);if(m){const E=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[E]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,n,r){const i=At(t);return e_(i),Aa(i,n),t_(i,n),Oy(i),Il(i,r,this.localCapabilities.send),i}mungSendMediaDesc(t,n){const r=At(t);return Il(r,n,this.localCapabilities.recv),Lo(r),r}updateRecvMedia(t,n){const r=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(r!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=i}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(n=>yt()?n.media.port==="0"&&n.media.mediaType===t:n.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(n=>{var r;return((r=n.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===t[0].ssrcId})}getSSRC(t){var n;return(n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t))===null||n===void 0?void 0:n.attributes.ssrcs}}var it;function F2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function u_(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?F2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let PX=(it=class nE extends _m{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){let t;return this.localCapabilities&&(t=bl(this.localCapabilities)),[...new Set(t&&t.send.videoCodecs.map(n=>n.rtpMap&&n.rtpMap.encodingName.toLowerCase()||"").filter(n=>{var r;return ue(r=Object.keys(Xd)).call(r,n)}))]}constructor(t,n,r){super(t,n),w(this,"store",void 0),w(this,"peerConnection",void 0),w(this,"remoteSDP",void 0),w(this,"initialOffer",void 0),w(this,"transportEventReceiver",void 0),w(this,"statsFilter",void 0),w(this,"useXR",L("USE_XR")),w(this,"localCapabilities",void 0),w(this,"localCandidateCount",0),w(this,"allCandidatesReceived",!1),w(this,"remoteCodecs",void 0),w(this,"dataStreamChannelMap",new Map),w(this,"establishPromise",void 0),w(this,"mutex",new On("NVExtentionsConnection-mutex")),w(this,"rtcMedia",void 0),this.store=n,this.peerConnection=r,this.statsFilter=$m(this.peerConnection,L("STATS_UPDATE_INTERVAL"),void 0,yt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(t){try{const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Po(n.sdp),i=await Dy({filterRTX:!L("USE_PUB_RTX")&&!L("USE_SUB_RTX"),filterVideoFec:L("FILTER_VIDEO_FEC"),filterAudioFec:L("FILTER_AUDIO_FEC"),filterVideoCodec:L("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=i,this.initialOffer=n,u_(u_({},r),{},{rtpCapabilities:i,offerSDP:n.sdp})}catch(n){throw new B(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t,n,r,i,a,c){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new DX({remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:a,localCapabilities:bl(this.localCapabilities),cname:c});const l=this.remoteSDP.toString(),u=jt.parse(this.initialOffer.sdp),p=u.mediaDescriptions.find(E=>E.media.mediaType==="audio");p&&Lo(p),this.useXR&&n_(u);const f=jt.print(u),m=this.logSDPExchange(f||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:f}),m==null||m(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(l){throw new B(O.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(l.toString()))}}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void T.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const a=this.remoteSDP.toString();i==null||i(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}else T.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async updateRemoteConnect(t){var n,r,i,a;(n=this.remoteSDP)===null||n===void 0||n.updateRemoteRTPCapabilities(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&((a=this.remoteSDP)===null||a===void 0||a.updateRemoteCodec([],this.remoteCodecs,this.store.codec)),(r=this.remoteSDP)===null||r===void 0||r.preloadRemoteMedia(2);const c=(i=this.remoteSDP)===null||i===void 0?void 0:i.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:c});const l=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(l),T.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(t,n,r){var i=this;return qr(function*(){const a=yield Be(i.mutex.lock("From NVExtentionsConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const c=[];t.forEach(v=>{const y=i.peerConnection.addTransceiver(v._mediaStreamTrack,{direction:"sendonly"});c.push(y)}),yt()&&L("SIMULCAST")===!0&&(yield Be(i.applySimulcastForFirefox(c,t)));const l=yield Be(i.peerConnection.createOffer()),u=i.remoteSDP.predictReceivingMids(t.length),p=i.mungSendOfferSDP(l.sdp,t,u),f=jt.parse(p),m=u.map(v=>{const y=f.mediaDescriptions.find(b=>b.attributes.mid===v);if(!y)throw new Error("Cannot extract ssrc from mediaDescription.");return Ay(y,L("USE_PUB_RTX"))});let E;try{E=yield m}catch(v){E=[],i.remoteSDP.receive(t,n,r,E);const y=i.remoteSDP.toString();throw yield Be(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Be(i.peerConnection.setRemoteDescription({type:"answer",sdp:y})),yield Be(i.stopSending(u,!0)),v}i.remoteSDP.receive(t,n,r,E);const S=i.remoteSDP.toString(),I=i.logSDPExchange(p,"offer","local","send");return yield Be(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Be(i.applySimulcastEncodings(c,t)),yield Be(i.applySendEncodings(c,t)),I==null||I(S),yield Be(i.peerConnection.setRemoteDescription({type:"answer",sdp:S})),c.map((v,y)=>{const b=u[y];return{localSSRC:m[y],id:b,transceiver:v}})}catch(c){throw c instanceof B?c:new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(u=>t.indexOf(u.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");i.map(u=>{var p;u.direction="inactive",(p=u.stop)===null||p===void 0||p.call(u)});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);return r&&r.readyState==="open"?T.debug("[P2PConnection] Channels are already available and can be reused directly."):(r=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:L("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)),void n.forEach(i=>{i._updateOriginDataChannel(r)})}catch(r){throw r instanceof B?r:new B(O.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n==null||n.close(),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof B?n:new B(O.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(n.toString()))}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(t,n,r,i);if(c){const u=this.remoteSDP.toString(),p=this.logSDPExchange(u,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const f=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(f.sdp,a,t);p==null||p(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),T.debug("[NVExtentionsConnection] receive ".concat(t," by exchanging SDP."))}else T.debug("[NVExtentionsConnection] receive ".concat(t," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(u=>u.mid===a);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:a}}catch(a){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(a.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);if(r){const i=this.remoteSDP.toString(),a=this.logSDPExchange(i,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c),T.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else T.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return n.map(i=>{const a=this.peerConnection.getTransceivers().find(c=>c.mid===i);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:i}})}catch(n){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const a=this.remoteSDP.toString();i==null||i(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,l)=>{c.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const a=this.remoteSDP.toString();i==null||i(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return qr(function*(){const r=yield Be(n.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ze().supportPCSetConfiguration){const p=n.peerConnection.getConfiguration(),f=t===ar.RELAY?"relay":"all";p.iceTransportPolicy!==f&&(T.debug("restartICE change iceTransportPolicy from [".concat(p.iceTransportPolicy,"] to [").concat(f,"]")),p.iceTransportPolicy=f,n.peerConnection.setConfiguration(p))}else if(t===ar.RELAY)return;t!==ar.RELAY&&n.remoteSDP.updateCandidates(t);const i=yield Be(n.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=Po(i.sdp),{remoteIceParameters:c}=yield a.iceParameters;n.remoteSDP.restartICE(c);const l=n.remoteSDP.toString(),u=n.logSDPExchange(i.sdp||"","offer","local","restartICE");yield Be(n.peerConnection.setLocalDescription(i)),u==null||u(l),yield Be(n.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(i){T.warning("restart ICE failed, abort operation",i)}finally{r()}})()}close(){var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const a=this.remoteSDP.toString(),c=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),c==null||c(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(r){throw new B(O.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?yt()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}getP2PConnectionParams(){var t;if((t=this.peerConnection.currentLocalDescription)===null||t===void 0||!t.sdp||!this.localCapabilities)throw new Error;return u_(u_({},Po(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},L("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Yd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...nE.turnServerConfigToIceServers(t.turnServer.servers)),L("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...nE.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),L("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Ta(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!L("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}async applySendEncodings(t,n){try{if(!Ze().supportSetRtpSenderParameters||t.length!==n.length)return;for(let m=0;m<t.length;m++){const E=t[m],S=n[m];if(S&&S instanceof wt){var r,i,a;if(this.isVP8Simulcast(S))continue;const I={},v={};switch(S._optimizationMode){case"motion":I.degradationPreference="maintain-framerate";break;case"detail":I.degradationPreference="maintain-resolution";break;default:I.degradationPreference="balanced"}var c,l,u,p;if((r=S._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&(v.maxBitrate=1e3*((c=S._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)),ue(i=S._hints).call(i,Ot.LOW_STREAM)&&((l=S._encoderConfig)!==null&&l!==void 0&&l.frameRate&&(v.maxFramerate=Lr(S._encoderConfig.frameRate)),(u=S._encoderConfig)!==null&&u!==void 0&&u.scaleResolutionDownBy&&((p=S._encoderConfig)===null||p===void 0?void 0:p.scaleResolutionDownBy)>1&&(v.scaleResolutionDownBy=S._encoderConfig.scaleResolutionDownBy)),L("DSCP_TYPE")&&pa()){var f;const D=L("DSCP_TYPE");ue(f=["very-low","low","medium","high"]).call(f,D)&&(v.networkPriority=D)}const y=E.sender.getParameters(),b=(a=y.encodings)===null||a===void 0?void 0:a[0];yt()&&!b&&(I.encodings=[v]),b&&Object.assign(b,v),Object.assign(y,I),await E.sender.setParameters(y)}}}catch{T.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,n,r){const i=jt.parse(t);return n.forEach((a,c)=>{const l=r[c],u=i.mediaDescriptions.find(p=>p.attributes.mid===l);u&&(Aa(u,a),Ny(u,a,this.store.codec))}),jt.print(i)}mungReceiveAnswerSDP(t,n,r){const i=jt.parse(t),a=i.mediaDescriptions.find(c=>c.attributes.mid===n);return a&&r===ye.AUDIO&&a.media.mediaType==="audio"&&Lo(a),this.useXR&&n_(i),jt.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let u=0;u<t.length;u++){var r,i,a,c,l;const p=t[u],f=n[u];if(f instanceof wt&&!ue(r=f._hints).call(r,Ot.LOW_STREAM)&&(i=f._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((a=f._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(c=f._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=f._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const m={},E={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const S=p.sender.getParameters();await p.sender.setParameters(Object.assign(S,m))}}}async applySimulcastEncodings(t,n){if(!yt()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof wt&&this.isVP8Simulcast(i)){const a=t[r],c={},l={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const u=a.sender.getParameters();await a.sender.setParameters(Object.assign(u,c))}}}isVP8Simulcast(t){var n,r,i,a,c;return!!(t instanceof wt&&L("SIMULCAST")&&this.store.codec==="vp8"&&!ue(n=t._hints).call(n,Ot.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(a=t._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=t._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(L("SDP_LOGGING"))return T.upload("exchanging ".concat(r," ").concat(n," SDP during NVExtentionsConnection.").concat(i,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",r==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Ze().supportPCSetConfiguration){const n=nE.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},se(it.prototype,"connect",[Mr],Object.getOwnPropertyDescriptor(it.prototype,"connect"),it.prototype),se(it.prototype,"updateRemoteRTPCapabilities",[Mr],Object.getOwnPropertyDescriptor(it.prototype,"updateRemoteRTPCapabilities"),it.prototype),se(it.prototype,"updateRemoteConnect",[Mr],Object.getOwnPropertyDescriptor(it.prototype,"updateRemoteConnect"),it.prototype),se(it.prototype,"createDataChannels",[Mr],Object.getOwnPropertyDescriptor(it.prototype,"createDataChannels"),it.prototype),se(it.prototype,"receive",[Mr],Object.getOwnPropertyDescriptor(it.prototype,"receive"),it.prototype),se(it.prototype,"batchReceive",[Mr],Object.getOwnPropertyDescriptor(it.prototype,"batchReceive"),it.prototype),se(it.prototype,"stopReceiving",[Mr],Object.getOwnPropertyDescriptor(it.prototype,"stopReceiving"),it.prototype),se(it.prototype,"muteRemote",[Mr],Object.getOwnPropertyDescriptor(it.prototype,"muteRemote"),it.prototype),se(it.prototype,"unmuteRemote",[Mr],Object.getOwnPropertyDescriptor(it.prototype,"unmuteRemote"),it.prototype),se(it.prototype,"muteLocal",[Mr],Object.getOwnPropertyDescriptor(it.prototype,"muteLocal"),it.prototype),se(it.prototype,"unmuteLocal",[Mr],Object.getOwnPropertyDescriptor(it.prototype,"unmuteLocal"),it.prototype),se(it.prototype,"close",[Mr],Object.getOwnPropertyDescriptor(it.prototype,"close"),it.prototype),se(it.prototype,"updateEncoderConfig",[Mr],Object.getOwnPropertyDescriptor(it.prototype,"updateEncoderConfig"),it.prototype),se(it.prototype,"updateSendParameters",[Mr],Object.getOwnPropertyDescriptor(it.prototype,"updateSendParameters"),it.prototype),se(it.prototype,"replaceTrack",[Mr],Object.getOwnPropertyDescriptor(it.prototype,"replaceTrack"),it.prototype),se(it.prototype,"getRemoteSSRC",[Mr],Object.getOwnPropertyDescriptor(it.prototype,"getRemoteSSRC"),it.prototype),it);function Mr(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,a=await i.lock("From NVExtentionsConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await r.apply(this,l)}finally{a()}},n}var pt;function B2(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=R2,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new h_(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function h_(e){function t(n){if(Object(n)!==n)return ce.reject(new TypeError(n+" is not an object."));var r=n.done;return ce.resolve(n.value).then(function(i){return{value:i,done:r}})}return h_=function(n){this.s=n,this.n=n.next},h_.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?ce.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?ce.reject(n):t(r.apply(this.s,arguments))}},new h_(e)}let ka=(pt=class rE extends _m{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(t,n){super(t,n),w(this,"store",void 0),w(this,"peerConnection",void 0),w(this,"cname",void 0),w(this,"mutex",new On("DataChannelConnection-mutex")),w(this,"dataChannel",void 0),w(this,"_p2pConnection",void 0),w(this,"establishPromise",void 0),w(this,"_nvMedia",void 0),this.store=n,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(rE.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new PX(t,n,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var t;const n=(t=this._nvMedia)===null||t===void 0?void 0:t.getLocalRtpCapabilities();return await this._p2pConnection.establish(n)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(t,n,r,i,a,c){return this.cname=c,await this._p2pConnection.connect(t,n,r,i,a,c),await new ce((l,u)=>{const p=setTimeout(()=>{this.closeSignal(),u(new B(O.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(r))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(p),void l()},this.dataChannel.onerror=f=>{this.closeSignal(),u(f)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(t,n){return this._p2pConnection.updateRemoteRTPCapabilities(t,n)}send(t,n,r){var i=this;return qr(function*(){const a=yield Be(i.mutex.lock("From DataChannelConnection.send"));try{return yield*o_(B2(i._p2pConnection.send(t,n,r)))}finally{a()}})()}async stopSending(t,n){return this._p2pConnection.stopSending(t,n)}async createDataChannels(t,n){return this._p2pConnection.createDataChannels(t,n)}async stopDataChannels(t){return this._p2pConnection.stopDataChannels(t)}async receive(t,n,r,i){return this._nvMedia?(T.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,n,this.cname)):(T.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,n,r,i))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var n=this;return qr(function*(){return yield*o_(B2(n._p2pConnection.restartICE(t)))})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var n;(n=this._nvMedia)===null||n===void 0||n.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,n){return await this._p2pConnection.updateEncoderConfig(t,n)}async updateSendParameters(t,n){return await this._p2pConnection.updateSendParameters(t,n)}setStatsRemoteVideoIsReady(t,n){this._p2pConnection.setStatsRemoteVideoIsReady(t,n)}async replaceTrack(t,n){return await this._p2pConnection.replaceTrack(t,n)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,n,r,i){if(L("SDP_LOGGING"))return T.upload("exchanging ".concat(r," ").concat(n," SDP during DataChannelConnection.").concat(i,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",r==="local"?"remote":"local",i)}:void 0}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Yd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...rE.turnServerConfigToIceServers(t.turnServer.servers)),L("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...rE.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),L("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Ta(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!L("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var n;return(n=this.onICEConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var n;return(n=this.onConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var n;return(n=this.onDTLSTransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var n;return(n=this.onDTLSTransportError)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var n;return(n=this.onICETransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var n;return(n=this.onFirstAudioReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var n;return(n=this.onFirstVideoReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var n;return(n=this.onFirstAudioDecoded)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,n,r)=>{var i;return(i=this.onFirstVideoDecoded)===null||i===void 0?void 0:i.call(this,t,n,r)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var n;return(n=this.onFirstVideoDecodedTimeout)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,n)=>{var r;return(r=this.onSelectedLocalCandidateChanged)===null||r===void 0?void 0:r.call(this,t,n)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,n)=>{var r;return(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0?void 0:r.call(this,t,n)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}},se(pt.prototype,"connect",[_i],Object.getOwnPropertyDescriptor(pt.prototype,"connect"),pt.prototype),se(pt.prototype,"updateRemoteRTPCapabilities",[_i],Object.getOwnPropertyDescriptor(pt.prototype,"updateRemoteRTPCapabilities"),pt.prototype),se(pt.prototype,"createDataChannels",[_i],Object.getOwnPropertyDescriptor(pt.prototype,"createDataChannels"),pt.prototype),se(pt.prototype,"receive",[_i],Object.getOwnPropertyDescriptor(pt.prototype,"receive"),pt.prototype),se(pt.prototype,"stopReceiving",[_i],Object.getOwnPropertyDescriptor(pt.prototype,"stopReceiving"),pt.prototype),se(pt.prototype,"muteRemote",[_i],Object.getOwnPropertyDescriptor(pt.prototype,"muteRemote"),pt.prototype),se(pt.prototype,"unmuteRemote",[_i],Object.getOwnPropertyDescriptor(pt.prototype,"unmuteRemote"),pt.prototype),se(pt.prototype,"muteLocal",[_i],Object.getOwnPropertyDescriptor(pt.prototype,"muteLocal"),pt.prototype),se(pt.prototype,"unmuteLocal",[_i],Object.getOwnPropertyDescriptor(pt.prototype,"unmuteLocal"),pt.prototype),se(pt.prototype,"close",[_i],Object.getOwnPropertyDescriptor(pt.prototype,"close"),pt.prototype),se(pt.prototype,"updateEncoderConfig",[_i],Object.getOwnPropertyDescriptor(pt.prototype,"updateEncoderConfig"),pt.prototype),se(pt.prototype,"updateSendParameters",[_i],Object.getOwnPropertyDescriptor(pt.prototype,"updateSendParameters"),pt.prototype),se(pt.prototype,"replaceTrack",[_i],Object.getOwnPropertyDescriptor(pt.prototype,"replaceTrack"),pt.prototype),se(pt.prototype,"getRemoteSSRC",[_i],Object.getOwnPropertyDescriptor(pt.prototype,"getRemoteSSRC"),pt.prototype),pt);function _i(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,a=await i.lock("From DataChannelConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await r.apply(this,l)}finally{a()}},n}var Ge;function W2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function gs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?W2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function G2(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=R2,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new p_(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function p_(e){function t(n){if(Object(n)!==n)return ce.reject(new TypeError(n+" is not an object."));var r=n.done;return ce.resolve(n.value).then(function(i){return{value:i,done:r}})}return p_=function(n){this.s=n,this.n=n.next},p_.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?ce.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?ce.reject(n):t(r.apply(this.s,arguments))}},new p_(e)}let f_=(Ge=class extends xt{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Ne.StateChange,t,this._state)}constructor(e,t){super(),w(this,"store",void 0),w(this,"statsUploader",void 0),w(this,"connection",void 0),w(this,"localTrackMap",new Map),w(this,"remoteUserMap",new Map),w(this,"localDataChannels",[]),w(this,"remoteDataChannelMap",new Map),w(this,"pendingLocalTracks",[]),w(this,"pendingRemoteTracks",[]),w(this,"pendingLocalDataChannels",[]),w(this,"pendingRemoteDataChannels",[]),w(this,"statsCollector",void 0),w(this,"isPlanB",!1),w(this,"shouldForwardP2PCreation",void 0),w(this,"iceFailedCount",0),w(this,"dtlsFailedCount",0),w(this,"mutex",new On("P2PChannel-mutex")),w(this,"_state",ht.Disconnected),w(this,"_pcStatsUploadType",L("NEW_ICE_RESTART")?Ls.FIRST_CONNECTION:Ls.OLD_FIRST_CONNECTION),w(this,"_isInRestartIce",!1),w(this,"_isStartRestartIce",!1),w(this,"_restartStates",["disconnected","failed"]),w(this,"_restartTimer",void 0),w(this,"_isFirstConnected",!0),w(this,"handleMuteLocalTrack",async(n,r,i)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==ht.Connected)return void i(new J(O.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const c=this.filterTobeMutedTracks(n);if(c.length===0)return void r();const l=c.find(p=>p[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(c.map(p=>{let[,{id:f}]=p;return f}));const u=this.createMuteMessage(c);await Ct(this,Ne.RequestMuteLocal,u),r()}catch(c){i(c)}finally{a()}}),w(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==ht.Connected)return void i(new J(O.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void r();const l=c.find(p=>p[0]==="videoLowTrack");if(l){const p=l[1];if(p.track._originMediaStreamTrack.stop(),!L("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ze().supportDualStreamEncoding){const f=n._mediaStreamTrack.clone();p.track._mediaStreamTrack=f,p.track._originMediaStreamTrack=f}else{const f=Ly(n,wc(this,Ne.RequestLowStreamParameter));p.track._mediaStreamTrack=f,p.track._originMediaStreamTrack=f}await new ce((f,m)=>{this.handleReplaceTrack(p.track,f,m,!0)})}await this.connection.unmuteLocal(c.map(p=>{let[,{id:f}]=p;return f}));const u=this.createUnmuteMessage(c);await Ct(this,Ne.RequestUnmuteLocal,u),r()}catch(c){i(c)}finally{a()}}),w(this,"handleUpdateVideoEncoder",async(n,r,i)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const c=this.localTrackMap.get(re.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==ht.Connected)return void r();const{id:l,track:u}=c;await this.connection.updateSendParameters(l,u),await this.connection.updateEncoderConfig(l,u),this.emit(Ne.UpdateVideoEncoder,u),r()}catch(c){i(c)}finally{a()}}),w(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(re.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==ht.Connected)return void r();const{id:l,track:u}=c;await this.connection.updateSendParameters(l,u),r()}catch(c){i(c)}finally{a()}}),w(this,"handleReplaceMixingTrack",async(n,r,i,a)=>{if(!this.connection||this.state!==ht.Connected)return void r();const c=My([n]);let l;T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(c.getTrackId(),"]")),typeof a=="boolean"&&a||(l=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,c),r()}catch(p){i(p)}finally{var u;(u=l)===null||u===void 0||u()}}),w(this,"handleReplaceTrack",async(n,r,i,a)=>{let c;T.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof a=="boolean"&&a||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;const p=Array.from(this.localTrackMap.entries()).find(f=>{let[,{track:m}]=f;return n===m});if(!this.connection||!p||this.state!==ht.Connected)return void r();if(await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(n,p[1].id)),this.isPlanB){const f=p[1];f.id=n._mediaStreamTrack.id,this.localTrackMap.set(p[0],f)}if(p[0]===re.LocalVideoTrack&&!L("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ze().supportDualStreamEncoding){const f=this.localTrackMap.get(re.LocalVideoLowTrack);if(f){const m=n._mediaStreamTrack.clone();f.track._originMediaStreamTrack.stop(),f.track._mediaStreamTrack=m,f.track._originMediaStreamTrack=m,await new ce((E,S)=>{this.handleReplaceTrack(f.track,E,S,!0)})}}r()}catch(p){i(p)}finally{var u;(u=c)===null||u===void 0||u()}}),w(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),w(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),w(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),w(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),w(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new s2(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!Ze().supportUnifiedPlan||L("CHROME_FORCE_PLAN_B")&&pa(),this.shouldForwardP2PCreation=L("FORWARD_P2P_CREATION")&&Ze().supportPCSetConfiguration&&jT(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new ka({},this.store):this.isPlanB?new Al({},this.store):new xo({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=ht.New;const r=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new ka(e,this.store):this.isPlanB?new Al(e,this.store):new xo(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new J(O.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=L("NEW_ICE_RESTART")?Ls.FIRST_CONNECTION:Ls.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e,t,n,r,i,a){if(!this.connection)throw new J(O.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof ka?this.connection.updateRemoteConnect(r):(this.store.peerConnectionStart(),await this.connection.connect(e,t,n,r,i,a),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ht.Connected)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(i=>{var a;let[c]=i;return ue(a=[re.LocalVideoLowTrack,re.LocalVideoTrack]).call(a,c)}),n=t.map(i=>{let[,{id:a}]=i;return a}),r=t.map(i=>{let[a]=i;return a});if(this.connection instanceof xo){if(Ce.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!ue(e).call(e,this.store.codec)){const i=["vp9","vp8","h264"].find(a=>ue(e).call(e,a));i&&(this.store.codec=i,T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async preConnect(e,t,n,r,i,a){if(!this.connection)throw new J(O.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const c=await this.connection.connect(e,t,n,r,i,a);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ht.Connected,c}getEstablishParams(){if(this.connection instanceof ka)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}async publishDataChannel(e){if(!this.connection||this.state!==ht.Connected){if(this.state===ht.Disconnected)throw new J(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return void e.forEach(n=>{var r;ue(r=this.pendingLocalDataChannels).call(r,n)||this.pendingLocalDataChannels.push(n)})}const t=this.filterTobePublishedDataChannels(e);t.length!==0&&(t.forEach(n=>{const r=Date.now();this.store.publish(n.id.toString(),"datachannel",r)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);const r=Date.now();this.store.publish(n.id+"","datachannel",void 0,r)}))}publish(e,t,n){var r=this;return qr(function*(){const i=yield Be(r.mutex.lock("From P2PChannel.publish"));try{if(!r.connection||r.state!==ht.Connected){if(r.state===ht.Disconnected)throw new J(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const c=e.filter(l=>r.pendingLocalTracks.indexOf(l)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(c))}r.store.pubId=r.store.pubId+1,Zn.markPublishStart(r.store.clientId,r.store.pubId);const a=r.filterTobePublishedTracks(e,t,n);if(a.length===0)return void(yield Be(r.tryToUnmuteAudio(e)));yield*o_(G2(r.doPublish(r.connection,a)))}finally{i()}})()}doPublish(e,t){var n=this;return qr(function*(){t.forEach(m=>{let{track:E,type:S}=m;const I=Date.now();n.store.publish(E.getTrackId(),S===re.LocalAudioTrack?"audio":"video",I)}),n.bindLocalTrackEvents(t);const r=t.map(m=>{let{track:E}=m;return E}),i=yield Be(e.send(t.map(m=>{let{track:E}=m;return E}),n.store.codec,n.store.audioCodec)),a=(yield Be(i.next())).value,c=n.createGatewayPublishMessage(t,a);let l;try{l=yield c}catch(m){throw i.throw(m),(m==null?void 0:m.code)===O.WS_ABORT&&t.forEach(E=>{let{track:S}=E;n.pendingLocalTracks.indexOf(S)===-1&&n.pendingLocalTracks.push(S)}),n.unbindLocalTrackEvents(t),m}const u=n.mapPubResToRemoteConfig(c,l),p=(yield Be(i.next(u))).value,f=L("ENABLE_VIDEO_SEI");r.forEach(async m=>{const E=m.getRTCRtpTransceiver();E&&f&&(m.trackMediaType===ye.VIDEO?await iX(E.sender,m):m.trackMediaType===ye.AUDIO&&await async function(S){if(!Ze().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(Xm.has(S)||!S.track)return;const I={track:S.track};if(ha()){if(!S.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let y=null;try{y=S.createEncodedStreams()}catch(D){return void T.error("create audio-encoded-streams error",D&&D.message)}const b=new TransformStream({transform(D,U){I.controller||(I.controller=U),S.track&&S.track.id!==I.track.id&&(T.debug("audio track changed: ".concat(I.track.id," => ").concat(S.track.id)),I.track.removeEventListener("ended",v),I.track=S.track,I.track.addEventListener("ended",v)),U.enqueue(D)}});y.readable.pipeThrough(b).pipeTo(y.writable)}else if(Cn()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const y=Jm(),b=new MessageChannel;await new ce(U=>y.onmessage=F=>{F.data==="registered"&&U(void 0)});const D=new RTCRtpScriptTransform(y,{name:"tx",port:b.port2},[b.port2]);S.transform=D,await new ce(U=>y.onmessage=F=>{F.data==="started"&&U(void 0)}),b.port1.onmessage=U=>{var F;U.data.transformed&&S.track&&((F=S.track)===null||F===void 0?void 0:F.id)!==I.track.id&&(T.debug("audio track changed: ".concat(I.track.id," => ").concat(S.track.id)),I.track.removeEventListener("ended",v),I.track=S.track,I.track.addEventListener("ended",v))},I.worker=y}function v(){if(S.track){if(this.id!==S.track.id)return;S.track.removeEventListener("ended",v)}const y=Xm.get(S);if(y){Xm.delete(S);try{var b,D;(b=y.controller)===null||b===void 0||b.terminate(),(D=y.worker)===null||D===void 0||D.terminate()}catch(U){T.warning(U&&U.message)}}}Xm.set(S,I),S.track.addEventListener("ended",v)}(E.sender))}),t.forEach(m=>{let{type:E}=m;n.statsCollector.addLocalStats(E)}),n.assignLocalTracks(t,p),n.statsUploader.startUploadOutboundStats(),t.forEach(m=>{let{track:E,type:S}=m;const I=Date.now();n.store.publish(E.getTrackId(),S===re.LocalAudioTrack?"audio":"video",void 0,I)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n)return;if(!(n.track instanceof wt))return T.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof xo||this.connection instanceof Al))return T.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:r}=n,i=function(a,c){const l={};return a.height&&a.width&&(l.scaleResolutionDownBy=dv(a,c)),l.maxFramerate=a.framerate?Lr(a.framerate):void 0,l.maxBitrate=a.bitrate?1e3*a.bitrate:void 0,l}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==re.LocalVideoLowTrack||!L("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ze().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const a=r._originMediaStreamTrack;if(!a.canvas)return T.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(c,l){const u=c.canvas;l.width&&(u.width=Lr(l.width)),l.height&&(u.height=Lr(l.height)),l.framerate&&(u.stopCapture&&u.stopCapture(),u.stopCapture=fy(()=>{!u.startCapture&&u.stopCapture&&u.stopCapture(),u.startCapture&&u.startCapture()},Lr(l.framerate)))})(a,e)}i.maxBitrate!=null&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),T.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return qr(function*(){if(!t.connection||t.state!==ht.Connected)return;const n=yield Be(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const i=t.localTrackMap.get(re.LocalVideoTrack);if(!i)throw new J(O.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(re.LocalVideoLowTrack))throw new J(O.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const a=[{track:t.getLowVideoTrack(i.track,e),type:re.LocalVideoLowTrack}];if(yield*o_(G2(t.doPublish(t.connection,a))),i.track.muted||!i.track.enabled){var r;const c=(r=t.localTrackMap.get(re.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;c!==void 0&&(yield Be(t.connection.muteLocal([c])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(T.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await hn(this,Ne.RequestRePublish,this.pendingLocalTracks),this.emit(Ne.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(T.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await hn(this,Ne.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:r}=this.pendingRemoteTracks[t];(r!==ye.AUDIO||n._audio_added_&&n._audioSSRC)&&(r!==ye.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await hn(this,Ne.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===ye.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(Ne.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==ht.Connected)return void e.forEach(r=>{const i=this.pendingLocalTracks.indexOf(r);i!==-1&&this.pendingLocalTracks.splice(i,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(r=>r[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==ht.Connected)return void e.forEach(n=>{const r=this.pendingLocalDataChannels.indexOf(n);r!==-1&&this.pendingLocalDataChannels.splice(r,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{const r=this.localDataChannels.indexOf(n);r!==-1&&this.localDataChannels.splice(r,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==ht.Connected)return;const e=this.localTrackMap.get(re.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[re.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(r=>{let[,{id:i}]=r;return i})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[i,{track:a}]=r;return{type:i,track:a}})),t.forEach(r=>{let[i]=r;this.statsCollector.removeLocalStats(i)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==ht.Connected)throw new J(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(r=>{var i;return!((i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.get(r.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(r=>{var i;this.remoteDataChannelMap.has(e)?(i=this.remoteDataChannelMap.get(e))===null||i===void 0||i.set(r.id,r):this.remoteDataChannelMap.set(e,new Map([[r.id,r]]));const a=this.pendingRemoteDataChannels.findIndex(c=>{let{user:l,id:u}=c;return l.uid===e.uid&&u===r.id});a!==-1&&this.pendingRemoteDataChannels.splice(a,1)}),n.map(r=>r.id)}async subscribe(e,t,n,r,i){var a;if(!this.connection||this.state!==ht.Connected)throw new J(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((a=this.remoteUserMap.get(e))!==null&&a!==void 0&&a.has(t))return;let c,l,u;if(i){const m=i.find(S=>{let{stream_type:I}=S;return I===t});if(!m)throw new J(O.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const E=await this.connection.receive(t,m.ssrcs,String(e._uintid),m.attributes);this.connection instanceof xo&&(u=E.transceiver),c=E.track,l=E.id}else{const m=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof xo&&(u=m.transceiver),c=m.track,l=m.id}t===ye.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(c):(e._audioTrack=new wl(c,e.uid,e._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),u&&e._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(c):(e._videoTrack=new Rl(c,e.uid,e._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),u&&e._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._videoTrack)),L("ENABLE_VIDEO_SEI")&&u&&(t==ye.VIDEO?await oX(u.receiver,{onSei:m=>{var E;(E=e._videoTrack)===null||E===void 0||E._onSei(m)}}):t==ye.AUDIO&&await async function(m){if(!Ze().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(Qm.has(m))return;const E={track:m.track};if(ha()){if(!m.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let I=null;try{I=m.createEncodedStreams()}catch(y){return void T.error("create audio-encoded-streams error",y&&y.message)}const v=new TransformStream({transform(y,b){E.controller||(E.controller=b),m.track&&m.track.id!==E.track.id&&(T.debug("audio track changed: ".concat(E.track.id," => ").concat(m.track.id)),E.track.removeEventListener("ended",S),E.track=m.track,E.track.addEventListener("ended",S)),b.enqueue(y)}});I.readable.pipeThrough(v).pipeTo(I.writable)}else if(Cn()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const I=Jm(),v=new MessageChannel;await new ce(b=>I.onmessage=D=>{D.data==="registered"&&b(void 0)});const y=new RTCRtpScriptTransform(I,{name:"rx",port:v.port2},[v.port2]);m.transform=y,await new ce(b=>I.onmessage=D=>{D.data==="started"&&b(void 0)}),v.port1.onmessage=b=>{var D;b.data.transformed&&m.track&&((D=m.track)===null||D===void 0?void 0:D.id)!==E.track.id&&(T.debug("audio track changed: ".concat(E.track.id," => ").concat(m.track.id)),E.track.removeEventListener("ended",S),E.track=m.track,E.track.addEventListener("ended",S))},E.worker=I}function S(){m.track.removeEventListener("ended",S),function(I){const v=Qm.get(I);if(v){Qm.delete(I);try{var y,b;(y=v.controller)===null||y===void 0||y.terminate(),(b=v.worker)===null||b===void 0||b.terminate()}catch(D){T.warning(D&&D.message)}}}(m)}Qm.set(m,E),m.track.addEventListener("ended",S)}(u.receiver));const p=this.remoteUserMap.get(e);p?p.set(t,l):this.remoteUserMap.set(e,new Map([[t,l]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const f=this.pendingRemoteTracks.findIndex(m=>{let{user:E,kind:S}=m;return E.uid===e.uid&&t===S});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(Ne.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==ht.Connected)throw new J(O.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(n=>{var r;let{user:i,mediaType:a}=n;return!((r=this.remoteUserMap.get(i))!==null&&r!==void 0&&r.has(a))});const t=await this.connection.batchReceive(e.map(n=>{let{user:r,mediaType:i,ssrcId:a,rtxSsrcId:c}=n;return{kind:i,ssrcMsg:[{ssrcId:a,rtx:c}],mslabel:String(r._uintid)}}));e.forEach((n,r)=>{let{user:i,mediaType:a}=n;const{track:c,id:l,transceiver:u}=t[r];a===ye.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(c):(i._audioTrack=new wl(c,i.uid,i._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),u&&i._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(c):(i._videoTrack=new Rl(c,i.uid,i._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),u&&i._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(i,i._videoTrack));const p=this.remoteUserMap.get(i);p?p.set(a,l):this.remoteUserMap.set(i,new Map([[a,l]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();const f=this.pendingRemoteTracks.findIndex(m=>{let{user:E,kind:S}=m;return E.uid===i.uid&&a===S});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(Ne.MediaReconnectEnd,i.uid))})}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:u}=c;return t!==void 0?l.uid===e.uid&&t===u:l.uid===e.uid});if(r.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===ht.Connected||n||r.forEach(c=>{let{kind:l}=c;var u;if(l===ye.AUDIO)(u=e._audioTrack)===null||u===void 0||u._destroy(),e._audioTrack=void 0;else if(l===ye.VIDEO){var p;(p=e._videoTrack)===null||p===void 0||p._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==ht.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(i.length===0)return;await this.connection.stopReceiving(i.map(c=>{let[,{id:l}]=c;return l}));const a=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(c=>{let[l,{kind:u}]=c;var p,f;if(u===ye.VIDEO&&l._videoSSRC&&((p=this.connection)===null||p===void 0||p.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),u===ye.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),n||((f=l._videoTrack)===null||f===void 0||f._destroy(),l._videoTrack=void 0);else if(u===ye.AUDIO){var m;this.unbindRemoteTrackEvents(l._audioTrack),!n&&((m=l._audioTrack)===null||m===void 0||m._destroy(),l._audioTrack=void 0)}}),a}async unsubscribeDataChannel(e,t){if(t.forEach(i=>{const a=this.pendingRemoteDataChannels.findIndex(c=>c.id===i.id);a!==-1&&this.pendingRemoteDataChannels.splice(a,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(i=>{i._close()});const r=this.remoteDataChannelMap.get(e);return n.forEach(i=>{r&&r.delete(i.id)}),r&&r.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(i=>i.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:i,mediaType:a}of e){const c=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:p}=l;return a!==void 0?u.uid===i.uid&&a===p:u.uid===i.uid});c.forEach(l=>{const u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),t=t.concat(c)}if(!this.connection||this.state!==ht.Connected)return void t.forEach(i=>{let{user:a,kind:c}=i;var l;if(c===ye.AUDIO)(l=a._audioTrack)===null||l===void 0||l._destroy(),a._audioTrack=void 0;else if(c===ye.VIDEO){var u;(u=a._videoTrack)===null||u===void 0||u._destroy(),a._videoTrack=void 0}});const n=yo(e).call(e,(i,a)=>{let{user:c,mediaType:l}=a;const u=this.filterTobeUnSubscribedTracks(c,l);return i.concat(u)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(i=>{let[,{id:a}]=i;return a}));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(i=>{let[a,{kind:c}]=i;var l,u;if(c===ye.VIDEO&&a._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),c===ye.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),(u=a._videoTrack)===null||u===void 0||u._destroy(),a._videoTrack=void 0;else if(c===ye.AUDIO){var p;this.unbindRemoteTrackEvents(a._audioTrack),(p=a._audioTrack)===null||p===void 0||p._destroy(),a._audioTrack=void 0}}),r}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void T.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===ye.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||T.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(re.LocalAudioTrack);if((t==null?void 0:t.track)instanceof gn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==re.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===re.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===re.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,i){if(e){const c=this.localTrackMap.get(re.LocalAudioTrack),l=r?this.localTrackMap.get(re.LocalVideoLowTrack):this.localTrackMap.get(re.LocalVideoTrack);Ce.publish(this.store.sessionId,{eventElapse:Zn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(Ot.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var a;n||(n=[]);const c=n.find(u=>u instanceof qt),l=r?(a=this.localTrackMap.get(re.LocalVideoTrack))===null||a===void 0?void 0:a.track:n.find(u=>u instanceof wt);Ce.publish(this.store.sessionId,{eventElapse:Zn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(Ot.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===ye.VIDEO?n._videoSSRC:n._audioSSRC;i&&Ce.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===ye.VIDEO,audio:r===ye.AUDIO,peerid:n.uid,subscribeRequestid:r===ye.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Zn.measureFromSubscribeStart(this.store.clientId,i)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new On("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new ka({},this.store):this.isPlanB?new Al({},this.store):new xo({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(re.LocalAudioTrack);if((e==null?void 0:e.track)instanceof gn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=ht.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(re.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(re.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof wt||t&&t.track instanceof qt?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(ii(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(re.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Mu(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.connection&&(T.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=ht.Reconnecting,L("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new ka({},this.store):this.isPlanB?new Al({},this.store):new xo({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case re.LocalVideoTrack:ue(t=r._hints).call(t,Ot.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case re.LocalAudioTrack:r instanceof gn?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case re.LocalVideoLowTrack:}}),this.emit(Ne.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(ii(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(Ne.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(ii(n).call(n)).forEach(r=>{this.setPendingRemoteDataChannel(t,r)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),T.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:r,id:i}=n;if((e instanceof Da?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof Da?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return qr(function*(){if(!t.connection||t.state!==ht.Connected||t.connection instanceof ka)return;const n=yield Be(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield Be(t.connection.restartICE(e));const a=yield Be(r.next());if(a.done)return;const c=a.value,l=yield c;switch(t.reportPCDisconnectedOrFailed(e),e){case ar.TCP:t._pcStatsUploadType=Ls.TCP_RESTART;break;case ar.RELAY:t._pcStatsUploadType=Ls.RELAY_RESTART;break;default:t._pcStatsUploadType=Ls.OLD_RESTART}t._isInRestartIce=!0,r.next(l)}catch(a){var i;(i=r)===null||i===void 0||i.throw(a)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(re.LocalVideoTrack),n=this.localTrackMap.get(re.LocalAudioTrack),r=e.videoSend.find(S=>S.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),i=e.audioSend.find(S=>S.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!r||!i)return 1;const a=zr(this,Ne.NeedSignalRTT),c=r?r.rttMs:void 0,l=i?i.rttMs:void 0,u=c&&l?(c+l)/2:c||l,p=(u&&a?(u+a)/2:u||a)||0,f=100*e.sendPacketLossRate*.7/50+.3*p/1500,m=f<.17?1:f<.36?2:f<.59?3:f<.1?4:5,E=t==null?void 0:t.track;if(E&&E._encoderConfig&&E._hints.indexOf(Ot.SCREEN_TRACK)===-1){const S=E._encoderConfig.bitrateMax,I=e.bitrate.actualEncoded;if(S&&I){const v=(1e3*S-I)/(1e3*S);return w1[v<.15?0:v<.3?1:v<.45?2:v<.6?3:4][m]}}return m}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,a=r._videoSSRC,c=e.audioRecv.find(I=>I.ssrc===i),l=e.videoRecv.find(I=>I.ssrc===a);if(!c&&!l)return void(t+=1);const u=zr(this,Ne.NeedSignalRTT),p=e.rtt,f=(p&&u?(p+u)/2:p||u)||0,m=c?c.jitterMs:void 0,E=e.recvPacketLossRate;let S=.7*E*100/50+.3*f/1500;m&&(S=.6*E*100/50+.2*f/1500+.2*m/400),t+=S<.1?1:S<.17?2:S<.36?3:S<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ce((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(T.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==ht.Connected)return;const r=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:c}]=a;return e===c});if(!r)return;const i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,r[1].id)),this.isPlanB){const a=r[1];a.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,a)}if(i===re.LocalVideoTrack&&!L("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ze().supportDualStreamEncoding){const a=this.localTrackMap.get(re.LocalVideoLowTrack);if(a){const c=e._mediaStreamTrack.clone();a.track._originMediaStreamTrack.stop(),a.track._mediaStreamTrack=c,a.track._originMediaStreamTrack=c,await new ce((l,u)=>{this.handleReplaceTrack(a.track,l,u,!0)})}}}filterTobePublishedTracks(e,t,n){const r=[],i=this.getAllTracks();e=qd(e=e.filter(u=>i.indexOf(u)===-1));let a,c=!1;const l=this.localTrackMap.get(re.LocalAudioTrack);for(const u of e){if(u instanceof wt&&(this.localTrackMap.has(re.LocalVideoTrack)||c?new J(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:u,type:re.LocalVideoTrack}),c=!0),t)){const p=this.getLowVideoTrack(u,n);r.push({track:p,type:re.LocalVideoLowTrack})}if(u instanceof qt)if(l){const p=l.track;if(p instanceof gn)ky([u]),p.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0);else{const f=My([p,u]);T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(f.getTrackId(),"]")),this.replaceTrack(p,f)}}else a instanceof gn?(ky([u]),a.addAudioTrack(u)):a||!u._useAudioElement&&Ze().webAudioMediaStreamDest&&!u._bypassWebAudio?a=My(a?[u,a]:[u]):a=u}return a&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(a.getTrackId(),"]")),r.push({track:a,type:re.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=qd(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof qt){const i=this.localTrackMap.get(re.LocalAudioTrack);if(!i)continue;i.track instanceof gn?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([re.LocalAudioTrack,i]),i.track.close())):t.push([re.LocalAudioTrack,i])}if(r instanceof wt){const i=this.localTrackMap.get(re.LocalVideoTrack);if(!i)continue;t.push([re.LocalVideoTrack,i]);const a=this.localTrackMap.get(re.LocalVideoLowTrack);a&&t.push([re.LocalVideoLowTrack,a])}}return t}filterTobePublishedDataChannels(e){return e=(e=qd(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=qd(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case re.LocalVideoTrack:n.addListener(me.GET_STATS,this.handleGetLocalVideoStats),n.addListener(me.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(me.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case re.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case re.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof gn?e.trackList.forEach(n=>{n.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(me.GET_STATS,this.handleGetLocalAudioStats),n.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(me.GET_STATS,this.handleGetLocalAudioStats),e.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(me.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case re.LocalVideoTrack:n.off(me.GET_STATS,this.handleGetLocalVideoStats),n.off(me.GET_RTC_STATS,this.handleGetRTCStats),n.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(me.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case re.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case re.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof gn?e.trackList.forEach(t=>{t.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(me.GET_STATS,this.handleGetLocalAudioStats),t.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(me.GET_STATS,this.handleGetLocalAudioStats),e.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(me.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Rl&&t.addListener(me.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof wl&&t.addListener(me.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(me.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(ye.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(ye.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var i;let a,c,{track:l,type:u}=n;switch(u){case re.LocalAudioTrack:a=ut.Audio,c={dtx:l instanceof qm&&l._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case re.LocalVideoTrack:a=ue(i=l._hints).call(i,Ot.SCREEN_TRACK)?ut.Screen:ut.High,c=gs(gs({},H1(l)),{},{codec:this.store.codec});break;case re.LocalVideoLowTrack:a=ut.Low,c=gs(gs({},H1(l)),{},{codec:this.store.codec})}return{stream_type:a,attributes:c,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[i,{track:a,ssrcs:c,id:l}]=t;switch(i){case re.LocalVideoTrack:r=ue(n=a._hints).call(n,Ot.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalAudioTrack:r=ut.Audio;break;case re.LocalVideoLowTrack:r=ut.Low}return{stream_type:r,ssrcs:c,mid:l}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:i,type:a}=n;this.localTrackMap.set(a,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Ne.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),L("NEW_ICE_RESTART")){var n;if(ue(n=this._restartStates).call(n,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const r=c=>{(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")&&(T.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(c)),zr(this,Ne.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ne.RequestRestartICE,c))},i=()=>{e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="checking"&&e.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),T.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Ne.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},a=L("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(L("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ze().supportPCSetConfiguration)r(ar.RELAY),this._restartTimer=window.setTimeout(i,a);else if(yt())r(ar.UDP),this._restartTimer=window.setTimeout(i,4e3);else{if(r(ar.TCP),Ze().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{r(ar.RELAY),this._restartTimer=window.setTimeout(i,a)},a));this._restartTimer=window.setTimeout(i,a)}},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&L("ICE_RESTART")&&zr(this,Ne.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ne.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(Ne.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(Ne.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Ce.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Kt.TRACER}).onSuccess(),this.emit(Ne.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(ii(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(Tl.FIRST_FRAME_DECODED),Ce.firstRemoteFrame(this.store.sessionId,Nn.FIRST_AUDIO_DECODE,Bt.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Zn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(ii(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===t);r&&Ce.firstRemoteFrame(this.store.sessionId,Nn.FIRST_AUDIO_RECEIVED,Bt.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Zn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;const r=Array.from(ii(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&Ce.firstRemoteFrame(this.store.sessionId,Nn.FIRST_VIDEO_RECEIVED,Bt.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Zn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(Ne.ConnectionTypeChange,r),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(va(n))," -> ").concat(JSON.stringify(va(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(va(n))," -> ").concat(JSON.stringify(va(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return gs(gs({},t),n)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(re.LocalAudioTrack);if(e instanceof qt&&(n==null?void 0:n.track)instanceof gn)return n.track.isActive||t.push([re.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:a}]=i;return e===a});if(r&&(t.push(r),r[0]===re.LocalVideoTrack)){const i=this.localTrackMap.get(re.LocalVideoLowTrack);i&&t.push([re.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(re.LocalAudioTrack);if(e instanceof qt&&(n==null?void 0:n.track)instanceof gn)return n.track.isActive&&t.push([re.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:a}]=i;return e===a});if(r)if(r[0]===re.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(re.LocalVideoLowTrack);i&&t.push([re.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[i,{track:a,ssrcs:c,id:l}]=t;switch(i){case re.LocalAudioTrack:r=ut.Audio;break;case re.LocalVideoTrack:r=ue(n=a._hints).call(n,Ot.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalVideoLowTrack:r=ut.Low}return{stream_type:r,ssrcs:c,mid:l}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[i,{track:a,ssrcs:c,id:l}]=t;switch(i){case re.LocalAudioTrack:r=ut.Audio;break;case re.LocalVideoTrack:r=ue(n=a._hints).call(n,Ot.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalVideoLowTrack:r=ut.Low}return{stream_type:r,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[a,c]=i;n.push([e,{kind:a,id:c}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(r=>{var i;(i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.has(r.id)&&n.push(r)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:i,id:a}]=n;switch(i){case ye.VIDEO:return void(r._videoSSRC&&t.push({stream_type:ye.VIDEO,ssrcId:r._videoSSRC}));case ye.AUDIO:return void(r._audioSSRC&&t.push({stream_type:ye.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[r,{kind:i}]=n;if(t.has(r)){let a=t.get(r);i===ye.VIDEO?a|=wn.Video:a|=wn.Audio,t.set(r,a)}else i===ye.VIDEO?t.set(r,wn.Video):t.set(r,wn.Audio)}),{users:Array.from(t.entries()).map(n=>{let[r,i]=n;return{stream_id:r.uid,stream_type:i}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(re.LocalVideoTrack),n=this.localTrackMap.get(re.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t){return e.map((n,r)=>{var i;let{stream_type:a}=n;return(i=t.find(c=>{let{stream_type:l}=c;return a===l}))===null||i===void 0?void 0:i.attributes})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof qt){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(r.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map(a=>{let[,{id:c}]=a;return c})));const i=this.createUnmuteMessage(r);return void await Ct(this,Ne.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Ne.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Ne.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Rn(am(this.dtlsFailedCount,sn)),this.emit(Ne.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await hn(this,Ne.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Ne.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(re.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof wt)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof wt).length>1)throw new J(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof qt).length>1&&(e.some(t=>t instanceof qt&&t._bypassWebAudio)||!Ze().webAudioMediaStreamDest))throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof wt&&this.pendingLocalTracks.some(n=>n instanceof wt))throw new J(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof qt&&this.pendingLocalTracks.some(n=>n instanceof qt)&&(!Ze().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof qt&&n._bypassWebAudio)))throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!L("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ze().supportDualStreamEncoding,r=gs(gs({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():Ly(e,r);const a=Rt(8,"track-low-"),c=new wt(i,gs(gs({},n&&{scaleResolutionDownBy:dv(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,a);return c.on(Wc.TRANSCEIVER_UPDATED,l=>{e._updateRtpTransceiver(l,gl.LOW_STREAM)}),c._hints.push(Ot.LOW_STREAM),e.on("sei-to-send",l=>{c.emit("sei-to-send",l)}),e.addListener(me.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof xo){var i,a,c,l;const u=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:p,dtlsTransportState:f,peerConnectionState:m}=this.connection,{local:E,remote:S}=await this.connection.getSelectedCandidatePair();Ce.pcStats(this.store.sessionId,{startTime:u,eventElapse:e-u||0,iceconnectionsate:p,dtlsstate:f,connectionstate:m,intSucc:t?1:2,error:r,selectedLocalCandidateProtocol:(i=E==null?void 0:E.protocol)!==null&&i!==void 0?i:"",selectedLocalCandidateType:(a=E.candidateType)!==null&&a!==void 0?a:"",selectedLocalCandidateAddress:"".concat(E.address,":").concat(E.port),selectedRemoteCandidateProtocol:(c=S.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(l=S.candidateType)!==null&&l!==void 0?l:"",selectedRemoteCandidateAddress:"".concat(S.address,":").concat(S.port),restartCnt:n})}}reportVideoFirstFrameDecoded(e,t,n,r){var i;const a=Array.from(ii(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===e);if(a){r||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(u=>u.userId===a.uid&&u.type==="video");Ce.firstRemoteVideoDecode(this.store.sessionId,Nn.FIRST_VIDEO_DECODE,Bt.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:t,videoheight:n,subscribeElapse:Zn.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const a=await this.connection.getRemoteSSRC(i);return a!==void 0&&a!==n}resetConnection(e){T.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(e)),this.state===ht.Connected?(T.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=e===k1.datachannel?new ka({},this.store):this.isPlanB?new Al({},this.store):new xo({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===re.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,gl.LOW_STREAM):n._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof xo&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===Ls.TCP_RESTART&&e===ar.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,Ls.DISCONNECTED_OR_FAILED)))}},se(Ge.prototype,"startP2PConnection",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"startP2PConnection"),Ge.prototype),se(Ge.prototype,"connect",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"connect"),Ge.prototype),se(Ge.prototype,"updateRemoteRTPCapabilities",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"updateRemoteRTPCapabilities"),Ge.prototype),se(Ge.prototype,"preConnect",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"preConnect"),Ge.prototype),se(Ge.prototype,"publishDataChannel",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"publishDataChannel"),Ge.prototype),se(Ge.prototype,"unpublish",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"unpublish"),Ge.prototype),se(Ge.prototype,"unpublishDataChannel",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"unpublishDataChannel"),Ge.prototype),se(Ge.prototype,"unpublishLowStream",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"unpublishLowStream"),Ge.prototype),se(Ge.prototype,"subscribeDataChannel",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"subscribeDataChannel"),Ge.prototype),se(Ge.prototype,"subscribe",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"subscribe"),Ge.prototype),se(Ge.prototype,"massSubscribe",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"massSubscribe"),Ge.prototype),se(Ge.prototype,"unsubscribe",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"unsubscribe"),Ge.prototype),se(Ge.prototype,"unsubscribeDataChannel",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"unsubscribeDataChannel"),Ge.prototype),se(Ge.prototype,"massUnsubscribe",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"massUnsubscribe"),Ge.prototype),se(Ge.prototype,"muteRemote",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"muteRemote"),Ge.prototype),se(Ge.prototype,"unmuteRemote",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"unmuteRemote"),Ge.prototype),se(Ge.prototype,"hasRemoteMediaWithLock",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"hasRemoteMediaWithLock"),Ge.prototype),se(Ge.prototype,"disconnectForReconnect",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"disconnectForReconnect"),Ge.prototype),se(Ge.prototype,"updateBitrateLimit",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"updateBitrateLimit"),Ge.prototype),se(Ge.prototype,"remoteMediaSsrcChanged",[nr],Object.getOwnPropertyDescriptor(Ge.prototype,"remoteMediaSsrcChanged"),Ge.prototype),Ge);function nr(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,a=await i.lock("From P2PChannel.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await r.apply(this,l)}finally{a()}},n}function LX(e){let t=z2();return function(n,r){let i=n.appId;i!==void 0&&(ft(r,10),Ss(r,i));let a=n.cid;a!==void 0&&(ft(r,16),ft(r,a));let c=n.cname;c!==void 0&&(ft(r,26),Ss(r,c));let l=n.deviceId;l!==void 0&&(ft(r,34),Ss(r,l));let u=n.elapse;u!==void 0&&(ft(r,40),Ma(r,u));let p=n.fileSize;p!==void 0&&(ft(r,48),Ma(r,Nl(p)));let f=n.height;f!==void 0&&(ft(r,56),Ma(r,Nl(f)));let m=n.jpg;m!==void 0&&(ft(r,66),ft(r,m.length),function(uo,te){let oe=Dl(uo,te.length);uo.bytes.set(te,oe)}(r,m));let E=n.networkType;E!==void 0&&(ft(r,72),Ma(r,Nl(E)));let S=n.osType;S!==void 0&&(ft(r,80),Ma(r,Nl(S)));let I=n.requestId;I!==void 0&&(ft(r,90),Ss(r,I));let v=n.sdkVersion;v!==void 0&&(ft(r,98),Ss(r,v));let y=n.sequence;y!==void 0&&(ft(r,104),Ma(r,Nl(y)));let b=n.sid;b!==void 0&&(ft(r,114),Ss(r,b));let D=n.timestamp;D!==void 0&&(ft(r,120),Ma(r,D));let U=n.uid;U!==void 0&&(ft(r,128),ft(r,U));let F=n.vid;F!==void 0&&(ft(r,136),ft(r,F));let W=n.width;W!==void 0&&(ft(r,144),Ma(r,Nl(W)));let q=n.service;q!==void 0&&(ft(r,152),ft(r,q));let Q=n.callbackData;Q!==void 0&&(ft(r,162),Ss(r,Q));let ee=n.jpgEncryption;ee!==void 0&&(ft(r,168),ft(r,ee));let ne=n.requestType;ne!==void 0&&(ft(r,176),ft(r,ne));let _e=n.scorePorn;_e!==void 0&&(ft(r,185),Gy(r,_e));let Qe=n.scoreSexy;Qe!==void 0&&(ft(r,193),Gy(r,Qe));let ct=n.scoreNeutral;ct!==void 0&&(ft(r,201),Gy(r,ct));let Nt=n.scene;Nt!==void 0&&(ft(r,208),ft(r,Nt));let dn=n.ossFilePrefix;dn!==void 0&&(ft(r,218),Ss(r,dn));let Gt=n.serviceVendor;if(Gt!==void 0)for(let uo of Gt){ft(r,226);let te=z2();xX(uo,te),ft(r,te.limit),FX(r,te),VX(te)}}(e,t),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(t)}function kX(e){return function(n){let r={};e:for(;!Y2(n);){let i=Ts(n);switch(i>>>3){case 0:break e;case 1:r.code=Ts(n);break;case 2:r.msg=q2(n,Ts(n));break;case 3:{let a=UX(n);r.data=MX(n),n.limit=a;break}default:H2(n,7&i)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function MX(e){let t={};e:for(;!Y2(e);){let n=Ts(e);switch(n>>>3){case 0:break e;case 1:t.requestId=q2(e,Ts(e));break;case 2:t.requestType=Ts(e)>>>0;break;case 3:t.scorePorn=Wy(e);break;case 4:t.scoreSexy=Wy(e);break;case 5:t.scoreNeutral=Wy(e);break;case 6:t.requestScene=Ts(e)>>>0;break;case 7:t.scene=Ts(e)>>>0;break;default:H2(e,7&n)}}return t}function xX(e,t){let n=e.service;n!==void 0&&(ft(t,8),ft(t,n));let r=e.vendor;r!==void 0&&(ft(t,16),ft(t,r));let i=e.token;i!==void 0&&(ft(t,26),Ss(t,i));let a=e.callbackUrl;a!==void 0&&(ft(t,34),Ss(t,a))}function UX(e){let t=Ts(e),n=e.limit;return e.limit=e.offset+t,n}function H2(e,t){switch(t){case 0:for(;128&J2(e););break;case 2:Fy(e,Ts(e));break;case 5:Fy(e,4);break;case 1:Fy(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let jX=new Float32Array(1);new Uint8Array(jX.buffer);let Vy=new Float64Array(1),xr=new Uint8Array(Vy.buffer);function Nl(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let K2=[];function z2(){const e=K2.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function VX(e){K2.push(e)}function Fy(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function Y2(e){return e.offset>=e.limit}function Dl(e,t){let n=e.bytes,r=e.offset,i=e.limit,a=r+t;if(a>n.length){let c=new Uint8Array(2*a);c.set(n),e.bytes=c}return e.offset=a,a>i&&(e.limit=a),r}function By(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function q2(e,t){let n=By(e,t),r=String.fromCharCode,i=e.bytes,a="�",c="";for(let l=0;l<t;l++){let u,p,f,m,E=i[l+n];128&E?(224&E)==192?l+1>=t?c+=a:(u=i[l+n+1],(192&u)!=128?c+=a:(m=(31&E)<<6|63&u,m<128?c+=a:(c+=r(m),l++))):(240&E)==224?l+2>=t?c+=a:(u=i[l+n+1],p=i[l+n+2],(49344&(u|p<<8))!=32896?c+=a:(m=(15&E)<<12|(63&u)<<6|63&p,m<2048||m>=55296&&m<=57343?c+=a:(c+=r(m),l+=2))):(248&E)==240?l+3>=t?c+=a:(u=i[l+n+1],p=i[l+n+2],f=i[l+n+3],(12632256&(u|p<<8|f<<16))!=8421504?c+=a:(m=(7&E)<<18|(63&u)<<12|(63&p)<<6|63&f,m<65536||m>1114111?c+=a:(m-=65536,c+=r(55296+(m>>10),56320+(1023&m)),l+=3))):c+=a:c+=r(E)}return c}function Ss(e,t){let n=t.length,r=0;for(let c=0;c<n;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+t.charCodeAt(++c)-56613888),r+=l<128?1:l<2048?2:l<65536?3:4}ft(e,r);let i=Dl(e,r),a=e.bytes;for(let c=0;c<n;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+t.charCodeAt(++c)-56613888),l<128?a[i++]=l:(l<2048?a[i++]=l>>6&31|192:(l<65536?a[i++]=l>>12&15|224:(a[i++]=l>>18&7|240,a[i++]=l>>12&63|128),a[i++]=l>>6&63|128),a[i++]=63&l|128)}}function FX(e,t){let n=Dl(e,t.limit),r=e.bytes,i=t.bytes;for(let a=0,c=t.limit;a<c;a++)r[a+n]=i[a]}function J2(e){return e.bytes[By(e,1)]}function X2(e,t){let n=Dl(e,1);e.bytes[n]=t}function Wy(e){let t=By(e,8),n=e.bytes;return xr[0]=n[t++],xr[1]=n[t++],xr[2]=n[t++],xr[3]=n[t++],xr[4]=n[t++],xr[5]=n[t++],xr[6]=n[t++],xr[7]=n[t++],Vy[0]}function Gy(e,t){let n=Dl(e,8),r=e.bytes;Vy[0]=t,r[n++]=xr[0],r[n++]=xr[1],r[n++]=xr[2],r[n++]=xr[3],r[n++]=xr[4],r[n++]=xr[5],r[n++]=xr[6],r[n++]=xr[7]}function Ts(e){let t,n=0,r=0;do t=J2(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function ft(e,t){for(t>>>=0;t>=128;)X2(e,127&t|128),t>>>=7;X2(e,t)}function Ma(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,a=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,c=Dl(e,a),l=e.bytes;switch(a){case 10:l[c+9]=i>>>7&1;case 9:l[c+8]=a!==9?128|i:127&i;case 8:l[c+7]=a!==8?r>>>21|128:r>>>21&127;case 7:l[c+6]=a!==7?r>>>14|128:r>>>14&127;case 6:l[c+5]=a!==6?r>>>7|128:r>>>7&127;case 5:l[c+4]=a!==5?128|r:127&r;case 4:l[c+3]=a!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=a!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=a!==2?n>>>7|128:n>>>7&127;case 1:l[c]=a!==1?128|n:127&n}}function Q2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}const BX=new Map([["moderation",1],["supervise",2]]);class m_ extends xt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Pn.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=yo(n=t.map(r=>BX.get(r)||0)).call(n,(r,i)=>r+i),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),w(this,"name","AgoraRTCVideoContentInspect"),w(this,"_connectionState",qi.CONNECTING),w(this,"_innerConnectionState",void 0),w(this,"sequence",0),w(this,"inspectStartTime",void 0),w(this,"workerManagerConnection",void 0),w(this,"workerConnection",void 0),w(this,"workerMessageLengthLimit",void 0),w(this,"inspectIntervalMinimum",void 0),w(this,"qualityRatio",void 0),w(this,"_connectInfo",void 0),w(this,"_cancelTokenSource",Rr.CancelToken.source()),w(this,"_retryConfig",void 0),w(this,"wmSequence",0),w(this,"inspectInterval",void 0),w(this,"inspectTimer",null),w(this,"ossFilePrefix",void 0),w(this,"extraInfo",void 0),w(this,"_inspectType",void 0),w(this,"_inspectMode",void 0),w(this,"_quality",1),w(this,"qualityTimer",null),w(this,"_inspectId",void 0),w(this,"_needWorkUrlOnly",!1),w(this,"inspectImage",()=>{if(this.connectionState!==qi.CONNECTED)throw new B(O.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===qi.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Rt(5,"inspect-"),this.workerMessageLengthLimit=L("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=L("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=L("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new ih("worker-manager-"+this._inspectId,sn),this.on(Pn.STATE_CHANGE,(n,r)=>{this._innerConnectionState=n,T.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Ji[n]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new ih("worker-"+this._inspectId,sn),this.handleWorkerEvents()}async init(t,n){this.emit(Pn.STATE_CHANGE,Ji.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new ce((i,a)=>{this.on(Pn.CONNECTION_STATE_CHANGE,(c,l)=>{l===qi.CONNECTED&&i()}),this.requestAP(t,r,n).then(c=>{this.connectWorkerManager(c)}).catch(c=>{a(c)})})}async requestAP(t,n,r){const i=L("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),a=await function(l,u,p,f){let{appId:m,areaCode:E,cname:S,sid:I,token:v,uid:y}=u;rl++;const b="image_moderation_api",D={service_name:b,json_body:JSON.stringify({appId:m,areaCode:E,cname:S,command:"allocateEdge",requestId:rl,seq:rl,sid:I,token:v,ts:Date.now(),uid:y+""})};let U,F,W=l[0];return wo(async()=>{U=Date.now();const q=await Oo(W,{data:D,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(F=Date.now()-U,q.code!==0){const _e=new B(O.UNEXPECTED_RESPONSE,"image inspect ap error, code"+q.code,{retry:!0,responseTime:F});throw T.error(_e.toString()),_e}const Q=JSON.parse(q.json_body);if(Q.code!==200){const _e=new B(O.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Q.code,", reason: ").concat(Q.reason),{code:Q.code,responseTime:F});throw T.error(_e.toString()),_e}if(!Q.servers||!Array.isArray(Q.servers)||Q.servers.length===0){const _e=new B(O.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Q.code,responseTime:F});throw T.error(_e.toString()),_e}const ee=L("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ne=L("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Q.servers.map(_e=>{let{address:Qe,wss:ct}=_e;if(Qe&&ct)return"wss://".concat(Qe.replace(/\./g,"-"),".").concat(ee,":").concat(ne||ct)}).filter(_e=>!!_e),workerToken:Q.workerToken,vid:Q.vid,responseTime:F}},(q,Q)=>(Ce.apworkerEvent(I,{success:!0,sc:200,serviceName:b,responseDetail:JSON.stringify(q.addressList),firstSuccess:Q===0,responseTime:F,serverIp:l[Q%l.length]}),!1),(q,Q)=>(Ce.apworkerEvent(I,{success:!1,sc:q.data&&q.data.code||200,serviceName:b,responseTime:F,serverIp:l[Q%l.length]}),!!(q.code!==O.OPERATION_ABORTED&&q.code!==O.UNEXPECTED_RESPONSE||q.data&&q.data.retry)&&(W=l[(Q+1)%l.length],!0)),f)}(i,t,n,r);this.emit(Pn.STATE_CHANGE,Ji.AP_CONNECTED);const{addressList:c}=a;return this.wmSequence++,c}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Pn.STATE_CHANGE,Ji.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(ke.CONNECTED,async()=>{this.emit(Pn.STATE_CHANGE,Ji.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.21.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(ke.CLOSED,()=>{this._innerConnectionState<Ji.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(ke.FAILED,()=>{this._innerConnectionState<Ji.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(ke.RECONNECTING,()=>{this._innerConnectionState<Ji.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(ke.ON_MESSAGE,async t=>{this.emit(Pn.STATE_CHANGE,Ji.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const r=JSON.parse(t.data);if(r.code!==200)throw T.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new B(O.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&n))throw T.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new B(O.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{const i=L("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,a=n.replace(/:\d+\/?$/,":".concat(i));this.emit(Pn.STATE_CHANGE,Ji.CONNECT_WORKER,a),this._needWorkUrlOnly?this.emit(Pn.REQUEST_NEW_WORKER_URL,a):await this.connectWorker(a)}}),this.workerManagerConnection.on(ke.WILL_RECONNECT,(t,n,r)=>{r(t)}),this.workerManagerConnection.on(ke.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(ke.CONNECTED,async()=>{this.emit(Pn.STATE_CHANGE,Ji.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=qi.CONNECTED}),this.workerConnection.on(ke.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const r=kX(new Uint8Array(t.data));if(L("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&T.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Pn.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var n;const i={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},a=yo(n=Object.keys(i)).call(n,(l,u)=>i[l]>i[u]?l:u,"porn"),c=Object.keys(i).find(l=>l===a);this.emit(Pn.INSPECT_RESULT,c)}else this.emit(Pn.INSPECT_RESULT,void 0,new B(O.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(Pn.INSPECT_RESULT,void 0,new B(O.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else T.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Pn.INSPECT_RESULT,void 0,new B(O.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(ke.CLOSED,()=>{this.connectionState=qi.CLOSED}),this.workerConnection.on(ke.FAILED,()=>{this.connectionState=qi.CLOSED}),this.workerConnection.on(ke.RECONNECTING,()=>{this.connectionState=this.connectionState===qi.CONNECTED?qi.RECONNECTING:qi.CONNECTING}),this.workerConnection.on(ke.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this.workerConnection.on(ke.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(Pn.REQUEST_NEW_WORKER_URL,r=>{t([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{n(r)})})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){this.sequence++;const t=zr(this,Pn.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Pn.INSPECT_RESULT,void 0,new B(O.INVALID_OPERATION,"Only the track being played can be inspected"));const r=await this.generateRequestData(t,n);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(Pn.INSPECT_RESULT,void 0,new B(O.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:r,cname:i,cid:a,vid:c,sid:l,uid:u}=n;const p=Date.now(),f=await t.getCurrentFrameImage("image/jpeg",this.quality),m=await ZP(f,r,i),E=this.sequence+"-"+a+"-"+u+"-"+p+"-"+Rt(12,""),S={appId:r,cid:a,cname:i,deviceId:"",elapse:m_.intToLong(Number(p-this.inspectStartTime)),fileSize:m.byteLength,jpgEncryption:2,height:f.height,width:f.width,jpg:m,networkType:6,osType:7,requestId:E,sdkVersion:"4.21.0",sequence:this.sequence,sid:l,timestamp:m_.intToLong(p),uid:u,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete S.callbackData,this.ossFilePrefix===void 0&&delete S.ossFilePrefix;const I=LX(S);if(I.byteLength<this.workerMessageLengthLimit){if(L("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const v=function(y){for(var b=1;b<arguments.length;b++){var D=arguments[b]!=null?arguments[b]:{};b%2?Q2(Object(D),!0).forEach(function(U){w(y,U,D[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(D)):Q2(Object(D)).forEach(function(U){Object.defineProperty(y,U,Object.getOwnPropertyDescriptor(D,U))})}return y}({},S);delete v.jpg,T.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(v))}return I}{const v=this.quality*this.qualityRatio;return this.quality=v,await this.generateRequestData(t,{appId:r,cname:i,cid:a,vid:c,sid:l,uid:u})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Rr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=qi.CLOSED,this.emit(Pn.STATE_CHANGE,Ji.CLOSED)}}function WX(e){let t=function(){const n=KX.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,r){let i=n.appId;i!==void 0&&(cn(r,10),xa(r,i));let a=n.cid;a!==void 0&&(cn(r,16),cn(r,a));let c=n.cname;c!==void 0&&(cn(r,26),xa(r,c));let l=n.deviceId;l!==void 0&&(cn(r,34),xa(r,l));let u=n.elapse;u!==void 0&&(cn(r,40),Ua(r,u));let p=n.fileSize;p!==void 0&&(cn(r,48),Ua(r,Pl(p)));let f=n.height;f!==void 0&&(cn(r,56),Ua(r,Pl(f)));let m=n.jpg;m!==void 0&&(cn(r,66),cn(r,m.length),$2(r,m));let E=n.networkType;E!==void 0&&(cn(r,72),Ua(r,Pl(E)));let S=n.osType;S!==void 0&&(cn(r,80),Ua(r,Pl(S)));let I=n.requestId;I!==void 0&&(cn(r,90),xa(r,I));let v=n.sdkVersion;v!==void 0&&(cn(r,98),xa(r,v));let y=n.sequence;y!==void 0&&(cn(r,104),Ua(r,Pl(y)));let b=n.sid;b!==void 0&&(cn(r,114),xa(r,b));let D=n.timestamp;D!==void 0&&(cn(r,120),Ua(r,D));let U=n.uid;U!==void 0&&(cn(r,128),cn(r,U));let F=n.vid;F!==void 0&&(cn(r,136),cn(r,F));let W=n.width;W!==void 0&&(cn(r,144),Ua(r,Pl(W)));let q=n.service;q!==void 0&&(cn(r,152),cn(r,q));let Q=n.callbackData;Q!==void 0&&(cn(r,162),cn(r,Q.length),$2(r,Q));let ee=n.ticket;ee!==void 0&&(cn(r,170),xa(r,ee));let ne=n.vendorConfigs;ne!==void 0&&(cn(r,178),xa(r,ne))}(e,t),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(t)}function GX(e){return function(n){let r={};e:for(;!zX(n);){let i=Vh(n);switch(i>>>3){case 0:break e;case 1:r.code=Vh(n);break;case 2:r.msg=eM(n,Vh(n));break;case 3:r.requestId=eM(n,Vh(n));break;case 4:r.timestamp=YX(n,!1);break;default:HX(n,7&i)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function HX(e,t){switch(t){case 0:for(;128&lo(e););break;case 2:Hy(e,Vh(e));break;case 5:Hy(e,4);break;case 1:Hy(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Pl(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let KX=[];function Hy(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function zX(e){return e.offset>=e.limit}function __(e,t){let n=e.bytes,r=e.offset,i=e.limit,a=r+t;if(a>n.length){let c=new Uint8Array(2*a);c.set(n),e.bytes=c}return e.offset=a,a>i&&(e.limit=a),r}function Z2(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function $2(e,t){let n=__(e,t.length);e.bytes.set(t,n)}function eM(e,t){let n=Z2(e,t),r=String.fromCharCode,i=e.bytes,a="�",c="";for(let l=0;l<t;l++){let u,p,f,m,E=i[l+n];128&E?(224&E)==192?l+1>=t?c+=a:(u=i[l+n+1],(192&u)!=128?c+=a:(m=(31&E)<<6|63&u,m<128?c+=a:(c+=r(m),l++))):(240&E)==224?l+2>=t?c+=a:(u=i[l+n+1],p=i[l+n+2],(49344&(u|p<<8))!=32896?c+=a:(m=(15&E)<<12|(63&u)<<6|63&p,m<2048||m>=55296&&m<=57343?c+=a:(c+=r(m),l+=2))):(248&E)==240?l+3>=t?c+=a:(u=i[l+n+1],p=i[l+n+2],f=i[l+n+3],(12632256&(u|p<<8|f<<16))!=8421504?c+=a:(m=(7&E)<<18|(63&u)<<12|(63&p)<<6|63&f,m<65536||m>1114111?c+=a:(m-=65536,c+=r(55296+(m>>10),56320+(1023&m)),l+=3))):c+=a:c+=r(E)}return c}function xa(e,t){let n=t.length,r=0;for(let c=0;c<n;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+t.charCodeAt(++c)-56613888),r+=l<128?1:l<2048?2:l<65536?3:4}cn(e,r);let i=__(e,r),a=e.bytes;for(let c=0;c<n;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+t.charCodeAt(++c)-56613888),l<128?a[i++]=l:(l<2048?a[i++]=l>>6&31|192:(l<65536?a[i++]=l>>12&15|224:(a[i++]=l>>18&7|240,a[i++]=l>>12&63|128),a[i++]=l>>6&63|128),a[i++]=63&l|128)}}function lo(e){return e.bytes[Z2(e,1)]}function tM(e,t){let n=__(e,1);e.bytes[n]=t}function Vh(e){let t,n=0,r=0;do t=lo(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function cn(e,t){for(t>>>=0;t>=128;)tM(e,127&t|128),t>>>=7;tM(e,t)}function YX(e,t){let n,r=0,i=0,a=0;return n=lo(e),r=127&n,128&n&&(n=lo(e),r|=(127&n)<<7,128&n&&(n=lo(e),r|=(127&n)<<14,128&n&&(n=lo(e),r|=(127&n)<<21,128&n&&(n=lo(e),i=127&n,128&n&&(n=lo(e),i|=(127&n)<<7,128&n&&(n=lo(e),i|=(127&n)<<14,128&n&&(n=lo(e),i|=(127&n)<<21,128&n&&(n=lo(e),a=127&n,128&n&&(n=lo(e),a|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|a<<24,unsigned:t}}function Ua(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,a=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,c=__(e,a),l=e.bytes;switch(a){case 10:l[c+9]=i>>>7&1;case 9:l[c+8]=a!==9?128|i:127&i;case 8:l[c+7]=a!==8?r>>>21|128:r>>>21&127;case 7:l[c+6]=a!==7?r>>>14|128:r>>>14&127;case 6:l[c+5]=a!==6?r>>>7|128:r>>>7&127;case 5:l[c+4]=a!==5?128|r:127&r;case 4:l[c+3]=a!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=a!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=a!==2?n>>>7|128:n>>>7&127;case 1:l[c]=a!==1?128|n:127&n}}const nM={},rM={},E_=4294967296,qX=E_*E_,iM=qX/2;sM(0,!0);const oM=sM(0),JX=Fh(0,-2147483648,!1),XX=Fh(-1,2147483647,!1);function sM(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=rM[e],r)?r:(n=Fh(e,0,!0),i&&(rM[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=nM[e],r)?r:(n=Fh(e,e<0?-1:0,!1),i&&(nM[e]=n),n)}function Fh(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function QX(e,t){if(isNaN(e))return oM;{if(e<=-iM)return JX;if(e+1>=iM)return XX}return e<0?oM:Fh(e%E_|0,e/E_|0,t)}function aM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class Ky extends xt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(bo.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),w(this,"name","AgoraRTCImageModeration"),w(this,"_connectionState",bi.CONNECTING),w(this,"_sequence",0),w(this,"_moderationStartTime",void 0),w(this,"_workerConnection",void 0),w(this,"_workerMessageLengthLimit",void 0),w(this,"_qualityRatio",void 0),w(this,"_connectInfo",void 0),w(this,"_cancelTokenSource",Rr.CancelToken.source()),w(this,"_retryConfig",void 0),w(this,"_moderationInterval",void 0),w(this,"_moderationTimer",null),w(this,"_moderationMode",1),w(this,"_quality",1),w(this,"_qualityTimer",null),w(this,"_ticket",void 0),w(this,"_moderationIntervalMinimum",void 0),w(this,"_uploadFailedNum",0),w(this,"_uploadNum",0),w(this,"_uploadTimer",null),w(this,"_extraInfo",void 0),w(this,"_vendor",""),w(this,"_encoder",new TextEncoder),w(this,"_moderationId",void 0),w(this,"inspectImage",()=>{if(this.connectionState!==bi.CONNECTED)throw new B(O.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===bi.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Rt(5,"image-moderation-"),this._workerMessageLengthLimit=L("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=L("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=L("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new ih("worker-"+this._moderationId,sn),this.on(bo.STATE_CHANGE,(r,i)=>{T.debug("[".concat(this._moderationId,"] Moderation operation :").concat(el[r]," ").concat(i||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(bo.STATE_CHANGE,el.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new ce((i,a)=>{this.on(bo.CONNECTION_STATE_CHANGE,(c,l)=>{c===bi.CONNECTED&&i()}),this.requestAP(t,r,n).then(c=>{this.connectWorker(c)}).catch(c=>{a(c)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),T.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===bi.CONNECTED&&this.inspectImage()}async requestAP(t,n,r){const i=L("WEBCS_DOMAIN").map(u=>"https://".concat(u,"/api/v1")),a=await function(u,p,f,m){let{appId:E,areaCode:S,cname:I,sid:v,token:y,uid:b}=p;rl++;const D="moderation_plugin",U={service_name:D,json_body:JSON.stringify({appId:E,areaCode:S,cname:I,command:"allocateEdge",requestId:rl,seq:rl,sid:v,appToken:y,ts:Date.now(),uid:b+""})};let F,W,q=u[0];return wo(async()=>{F=Date.now();const Q=await Oo(q,{data:U,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(W=Date.now()-F,Q.code!==0){const _e=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Q.code,{retry:!0,responseTime:W});throw T.error(_e.toString()),_e}const ee=JSON.parse(Q.json_body);if(ee.code!==200){const _e=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(ee.code,", reason: ").concat(ee.reason),{code:ee.code,responseTime:W});throw T.error(_e.toString()),_e}if(!ee.servers||!Array.isArray(ee.servers)||ee.servers.length===0){const _e=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:ee.code,responseTime:W});throw T.error(_e.toString()),_e}if(!ee.servers.some(_e=>!!_e.wss)){const _e=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:ee.code,responseTime:W});throw T.error(_e.toString()),_e}const ne=L("IMAGE_MODERATION_WORKER_HOST");return{addressList:ee.servers.map(_e=>{let{address:Qe,wss:ct}=_e;if(Qe&&ct)return"wss://".concat(Qe.replace(/\./g,"-"),".").concat(ne,":").concat(ct,"/moderation")}).filter(_e=>!!_e),workerToken:ee.workerToken,vid:ee.vid,ticket:ee.appTicket,responseTime:W}},(Q,ee)=>(Ce.apworkerEvent(v,{success:!0,sc:200,serviceName:D,responseDetail:JSON.stringify(Q.addressList),firstSuccess:ee===0,responseTime:W,serverIp:u[ee%u.length]}),!1),(Q,ee)=>(Ce.apworkerEvent(v,{success:!1,sc:Q.data&&Q.data.code||200,serviceName:D,responseTime:W,serverIp:u[ee%u.length]}),!!(Q.code!==O.OPERATION_ABORTED&&Q.code!==O.UNEXPECTED_RESPONSE||Q.data&&Q.data.retry)&&(q=u[(ee+1)%u.length],!0)),m)}(i,t,n,r);this.emit(bo.STATE_CHANGE,el.AP_CONNECTED);const{addressList:c,ticket:l}=a;return this._ticket=l,c}async connectWorker(t){this.emit(bo.STATE_CHANGE,el.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(ke.CONNECTED,async()=>{this.emit(bo.STATE_CHANGE,el.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=bi.CONNECTED}),this._workerConnection.on(ke.CLOSED,()=>{this.connectionState=bi.CLOSED}),this._workerConnection.on(ke.FAILED,()=>{this.connectionState=bi.CLOSED}),this._workerConnection.on(ke.RECONNECTING,()=>{this.connectionState=this.connectionState===bi.CONNECTED?bi.RECONNECTING:bi.CONNECTING}),this._workerConnection.on(ke.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=GX(new Uint8Array(t.data));L("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,T.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Ce.reportApiInvoke(this._connectInfo.sid||null,{name:un.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:Kt.TRACER}).onError(new B(O.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},L("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else T.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(ke.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this._workerConnection.on(ke.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=zr(this,bo.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(L("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being played can be inspected"));this._sequence++;const r=await this.generateRequestData(t,n);this._workerConnection.sendMessage(r,!0,!0)}else L("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:r,cname:i,cid:a,vid:c,sid:l,uid:u}=n;const p=Date.now(),f=await t.getCurrentFrameImage("image/jpeg",this.quality),m=await ZP(f,r,i),E=this._sequence+"-"+a+"-"+u+"-"+p+"-"+Rt(12,""),S={appId:r,cid:a,cname:i,deviceId:"",elapse:Ky.intToLong(Number(p-this._moderationStartTime)),fileSize:f.buffer.byteLength,height:f.height,width:f.width,jpg:m,networkType:6,osType:7,requestId:E,sdkVersion:"4.21.0",sequence:this._sequence,sid:l,timestamp:QX(p),uid:u,vid:c,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete S.callbackData;const I=WX(S);if(I.byteLength<this._workerMessageLengthLimit){if(L("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const v=function(y){for(var b=1;b<arguments.length;b++){var D=arguments[b]!=null?arguments[b]:{};b%2?aM(Object(D),!0).forEach(function(U){w(y,U,D[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(D)):aM(Object(D)).forEach(function(U){Object.defineProperty(y,U,Object.getOwnPropertyDescriptor(D,U))})}return y}({},S);delete v.jpg,T.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(v))}return I}{const v=this.quality*this._qualityRatio;return this.quality=v,await this.generateRequestData(t,{appId:r,cname:i,cid:a,vid:c,sid:l,uid:u})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Rr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=bi.CLOSED,this.emit(bo.STATE_CHANGE,el.CLOSED)}}function cM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function dM(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?cM(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cM(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const ZX=Date.now(),$X=20,zy=new Map,g_=new Map;async function lM(e){const t=zy.get(e),n=Array.isArray(t)&&t[t.length-1],r=g_.get(e);if(!n)return void(r.isSyncing=!1);const i={uid:n.uid,payload:n.payload};r.firstRecvTs===0&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const a=n.sendTs-r.firstSendTs,c=a-(Date.now()-r.firstRecvTs);c>0&&(r.firstRecvTs=Date.now()-a);let l=n.mediaDelay+c;l<=0?(t.pop(),uM(n.context,i),l=0):l=Math.min(l,$X),setTimeout(()=>t.length&&lM(e),l)}function uM(e,t){e.safeEmit(Je.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function eQ(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return uM(n,{uid:e.uid,payload:e.payload});const r="".concat(n.id,"-").concat(e.uid),i=zy.get(r)||[],a=i.findIndex(p=>e.sendTs>=p.sendTs),c=dM(dM({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});a===-1?i.push(c):i.splice(a,0,c),zy.set(r,i);let l=!1;var u;g_.has(r)?l=!((u=g_.get(r))===null||u===void 0||!u.isSyncing):g_.set(r,{isSyncing:l,firstRecvTs:0,firstSendTs:0}),l||lM(r)}const tQ=tt().name;function hM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function pM(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hM(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hM(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const Ll="websdk_ng_cache_parameter",nQ=L("MAX_PRELOAD_ASYNC_LENGTH"),rQ=1e4,Qc=new Map,Zc=[];let Yy=null,qy=0,Jy=0;const S_=new Map,iQ=function(e,t){const n=[];let r=0;const i=async()=>{const a=n.shift();a&&await a(),n.length>0&&r<t?i():r--};return async function(){for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return new ce(async(u,p)=>{n.push(async()=>{try{const f=await e(...c);u(f)}catch(f){p(f)}}),r<t&&(r++,i())})}}(fM,nQ),Xy=Rr.CancelToken.source();async function fM(e,t,n,r,i){try{if(!L("ENABLE_PRELOAD"))return;if(!Ze().supportWebCrypto)return void fa(()=>{T.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new J(O.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Mn(n,"token",1,2047),Mn(e,"appid",1,2047),hm(t),r&&pm(r);const a=$u();T.debug("preload channel ".concat(t,", uid is ").concat(r));const c={appId:e,cname:t,token:n||e,uid:typeof r!="string"?r:null,sid:a,proxyServer:i};let l,u;typeof r=="string"?(c.stringUid=r,[u,l]=await ce.all([wY(r,{sid:a,appId:e},Xy.token),sD(pM(pM({},c),{},{token:n||e,uid:0}),Xy.token)]),c.uid=u.uid,l.gatewayInfo.uid=c.uid,l.gatewayInfo.res.uid=c.uid):l=await sD(c,Xy.token);const p={sid:a,appId:e,cname:t,token:n||e,uid:c.stringUid||r,intUid:c.uid||l.gatewayInfo.uid,stringUid:c.stringUid,ts:Date.now(),sua:u,ap:l};await async function(f){let m;try{f.uid&&_M({appId:f.appId,cname:f.cname,token:f.token,uid:f.uid,stringUid:f.stringUid});const E=TM(f),S=await async function(v,y){try{const b=await window.crypto.subtle.importKey("raw",l1(y),"AES-GCM",!1,["encrypt"]),D=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},b,bc(window.btoa(JSON.stringify(v))));return ma(new Uint8Array(D))}catch{return}}(f,f.token||f.appId);if(!S)return;m=SM(Ll);const I=m?JSON.parse(m):[];I.push({[E]:S}),I.length>L("AP_CACHE_NUM")&&I.shift(),T_(Ll,JSON.stringify(I))}catch(E){T.warn("Error caching server parameters:",E.message),T_(Ll,"")}}(p),qy++}catch(a){throw Jy++,function(c){Yy||(Yy=window.setTimeout(()=>{let u="";S_.forEach((p,f)=>{u+="".concat(f,": ").concat(p," ;")}),Ce.reportApiInvoke(null,{name:un.PRELOAD,options:{success:qy,failed:Jy,err:u}}).onError(c),qy=0,Jy=0,S_.clear(),Yy=null},rQ));const l=S_.get(c.code)||0;S_.set(c.code,l+1)}(a),a}}async function mM(e){try{const t=_M(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await async function(r,i){try{const a=await window.crypto.subtle.importKey("raw",l1(i),"AES-GCM",!1,["decrypt"]),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},a,bc(r));return JSON.parse(window.atob(ma(new Uint8Array(c))))}catch{return}}(t,e.token||e.appId);if(!n||!function(r,i){return r.cname===i.cname&&r.appId===i.appId&&r.token===i.token?i.stringUid?r.stringUid===i.stringUid:typeof i.uid=="number"?r.uid===i.uid:r.uid==i.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<L("AP_CACHE_LIFETIME"))return n}catch(t){T.warn("Error get preloadInfo",t.message)}}function _M(e){let t;try{if(t=SM(Ll),!t)return;const n=JSON.parse(t),r=TM(e),i=function(c,l){for(let u=c.length-1;u>=0;u--)if(l(c[u]))return u;return-1}(n,c=>r in c);if(i===-1)return;const a=n.splice(i,1)[0];return T_(Ll,JSON.stringify(n)),a[r]}catch(n){T.warn("Error delete preload info: ".concat(t),n.message),T_(Ll,"")}}function Qy(e){if(e){let t=Qc.get(e);t&&(window.clearTimeout(t),t=null,Qc.delete(e)),ue(Zc).call(Zc,e)||e.cloudProxyServer!=="disabled"||Zc.push(e)}if(Qc.size<L("AP_CACHE_NUM")&&Zc.length>0){const t=Zc.shift();Qc.set(t,window.setTimeout(async()=>{const{appId:n,cname:r,token:i,uid:a,proxyServer:c}=t;try{await iQ(n,r,i,a,c),Qc.has(t)&&Qy(t)}catch(l){T.warn("update preload failed",l.message),EM(t)}},L("AP_UPDATE_INTERVAL")))}}function EM(e){const t=Zc.indexOf(e);t!==-1&&Zc.splice(t,1);let n=Qc.get(e);n&&(window.clearTimeout(n),n=null,Qc.delete(e),Qy())}function gM(e,t){const n=e.sua,r=e.ap;t&&n&&Ce.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),Ce.reportResourceTiming(e.ap.url,e.sid),Ce.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(i=>i.ip).join(","),eventType:"disabled",unilbsServerIds:[an.CHOOSE_SERVER,an.CLOUD_PROXY_FALLBACK].toString()}),Ce.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(i=>i.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[an.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function SM(e){return window.atob(window.localStorage.getItem(e)||"")}function T_(e,t){window.localStorage.setItem(e,window.btoa(t))}function TM(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),E1(t)}var vM,yM,CM,RM,wM,IM,bM,AM,OM,NM,DM,PM,LM,kM,MM,xM,UM,jM,VM,FM,BM,WM,GM,HM,KM,zM,YM,qM,JM,XM,QM,ZM,$M,ex,tx,nx,rx,ix,ox,sx,ax,cx,he;function dx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Li(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dx(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dx(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}On.setLogger(T);let oQ=(vM=Oe(),yM=Oe({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof vl))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),CM=Oe({argsMap:(e,t)=>(t||(t=[]),t instanceof Pk?[t.getChannelId()]:(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())))}),RM=Oe({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),wM=Oe({argsMap:(e,t,n)=>[t,n]}),IM=Oe({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:i}=n;return[r==null?void 0:r.uid,i]})}),bM=Oe({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),AM=Oe({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:i}=n;return{uid:r==null?void 0:r.uid,mediaType:i}})}),OM=Oe(),NM=Oe(),DM=Oe(),PM=Oe(),LM=Oe(),kM=Oe(),MM=Oe(),xM=Oe(),UM=Oe(),jM=Oe(),VM=Oe(),FM=Oe(),BM=Oe(),WM=Oe(),GM=Oe({argsMap:(e,t)=>[t]}),HM=Oe(),KM=Oe(),zM=Oe(),YM=Oe(),qM=Oe(),JM=Oe(),XM=Oe(),QM=Oe(),ZM=Oe(),$M=Oe(),ex=Oe({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),tx=Oe(),nx=Oe(),rx=Oe(),ix=Oe(),ox=Oe(),sx=Oe(),ax=Oe({reportResult:!0}),cx=Oe(),he=class extends xt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),w(this,"store",void 0),w(this,"_uid",void 0),w(this,"_channelName",void 0),w(this,"_uintUid",void 0),w(this,"_users",[]),w(this,"_config",void 0),w(this,"_clientId",void 0),w(this,"_appId",void 0),w(this,"_sessionId",null),w(this,"_key",void 0),w(this,"_rtmConfig",{}),w(this,"_joinInfo",void 0),w(this,"_gateway",void 0),w(this,"_statsCollector",void 0),w(this,"_configDistribute",void 0),w(this,"_leaveMutex",new On("client-leave")),w(this,"_publishMutex",new On("client-publish")),w(this,"_renewTokenMutex",new On("client-renewtoken")),w(this,"_subscribeMutex",new On("client-subscribe")),w(this,"_encryptionMode","none"),w(this,"_encryptionSecret",null),w(this,"_encryptionSalt",null),w(this,"_encryptDataStream",!1),w(this,"_encryptDataStreamKey",null),w(this,"_encryptDataStreamIv",null),w(this,"_proxyServer",void 0),w(this,"_turnServer",{servers:[],mode:"auto"}),w(this,"_cloudProxyServerMode","disabled"),w(this,"_isDualStreamEnabled",!1),w(this,"_defaultStreamFallbackType",void 0),w(this,"_lowStreamParameter",void 0),w(this,"_streamFallbackTypeCacheMap",new Map),w(this,"_remoteStreamTypeCacheMap",new Map),w(this,"_axiosCancelSource",Rr.CancelToken.source()),w(this,"_audioVolumeIndicationInterval",void 0),w(this,"_networkQualityInterval",void 0),w(this,"_userOfflineTimeout",void 0),w(this,"_streamRemovedTimeout",void 0),w(this,"_injectStreamingClient",void 0),w(this,"_liveTranscodeStreamingClient",void 0),w(this,"_liveRawStreamingClient",void 0),w(this,"_channelMediaRelayClient",void 0),w(this,"_networkQualitySensitivity","normal"),w(this,"_p2pChannel",void 0),w(this,"_useLocalAccessPoint",!1),w(this,"_setLocalAPVersion",void 0),w(this,"_joinAndNotLeaveYet",!1),w(this,"_numberOfJoinCount",0),w(this,"_remoteDefaultVideoStreamType",void 0),w(this,"_inspect",void 0),w(this,"_moderation",void 0),w(this,"_license",void 0),w(this,"_pendingPublishedUsers",[]),w(this,"ntpAlignErrorCount",0),w(this,"remoteInboundOffset",0),w(this,"_handleLocalTrackEnable",(n,r,i)=>{this.publish(n,!1).then(r).catch(i)}),w(this,"_handleLocalTrackDisable",(n,r,i)=>{this.unpublish(n).then(r).catch(i)}),w(this,"_handleUserOnline",n=>{if(L("BLOCK_LOCAL_CLIENT")&&Oc(n.uid,this.channelName))return void T.debug("[".concat(n.uid,"] will be ignored in local"));this.isStringUID&&typeof n.uid!="string"&&T.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const r=this._users.find(i=>i.uid===n.uid);if(r)r._trust_in_room_=!0,r._is_pre_created&&(r._is_pre_created=!1,this.safeEmit(Je.USER_JOINED,r));else{const i=new Da(n.uid,n.uint_id||n.uid);this._users.push(i),T.debug("[".concat(this._clientId,"] user online"),n.uid),this.safeEmit(Je.USER_JOINED,i)}}),w(this,"_handleUserOffline",n=>{if(L("BLOCK_LOCAL_CLIENT")&&Oc(n.uid,this.channelName))return;const r=this._users.find(i=>i.uid===n.uid);r&&(this._handleRemoveStream(n),this._handleRemoveDataChannels(n),r._audio_pre_subscribed||r._video_pre_subscribed?r._is_pre_created=!0:rm(this._users,r),this._remoteStreamTypeCacheMap.delete(r.uid),this._streamFallbackTypeCacheMap.delete(r.uid),T.debug("[".concat(this._clientId,"] user offline"),n.uid,"reason:",n.reason),this.safeEmit(Je.USER_LEAVED,r,n.reason))}),w(this,"_handleAddAudioOrVideoStream",(n,r,i,a,c,l,u)=>{if(L("BLOCK_LOCAL_CLIENT")&&Oc(r,this.channelName))return;const p=this._users.find(m=>m.uid===r);if(!p)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(n)),this.store.subscribe(p.uid,n,void 0,void 0,void 0,Date.now());const f=n==="audio"?p.hasAudio:p.hasVideo;p._uintid||(p._uintid=c||r),n==="audio"?p._trust_audio_stream_added_state_=!0:p._trust_video_stream_added_state_=!0,n==="audio"?(p._audio_added_=!0,i!==void 0&&(p._audioSSRC=i),a!==void 0&&(p._cname=a),l&&(p._audioOrtc=l)):(p._video_added_=!0,i!==void 0&&(p._videoSSRC=i),a!==void 0&&(p._cname=a),u!==void 0&&(p._rtxSsrcId=u),l&&(p._videoOrtc=l)),(n==="audio"?p.hasAudio:p.hasVideo)&&!f&&(T.info("[".concat(this._clientId,"] remote user ").concat(p.uid," published ").concat(n)),this.safeEmit(Je.USER_PUBLISHED,p,n)),n==="video"?Ce.onGatewayStream(this._sessionId,Nn.ON_ADD_VIDEO_STREAM,Bt.ON_ADD_VIDEO_STREAM,{peer:c||r,ssrc:p._videoSSRC}):Ce.onGatewayStream(this._sessionId,Nn.ON_ADD_AUDIO_STREAM,Bt.ON_ADD_AUDIO_STREAM,{peer:c||r,ssrc:p._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(p,n,i).then(m=>{if(m&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(p.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof f_))return this._p2pChannel.unsubscribe(p,n,!0).then(()=>this._subscribe(p,n,!0).catch(E=>{T.error("[".concat(this._clientId,"] resubscribe error"),E.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(p,n)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(p.uid," after reconnect.")),this._subscribe(p,n,!0).catch(m=>{T.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),w(this,"_handleRemoveStream",n=>{if(L("BLOCK_LOCAL_CLIENT")&&Oc(n.uid,this.channelName))return;const r=this._users.find(a=>a.uid===n.uid);if(!r)return void T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));T.debug("[".concat(this._clientId,"] stream removed with uid ").concat(n.uid));let i=()=>{};r.hasAudio&&r.hasVideo?i=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(Je.USER_UNPUBLISHED,r,"audio"),T.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(Je.USER_UNPUBLISHED,r,"video")}:r.hasVideo?i=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(Je.USER_UNPUBLISHED,r,"video")}:r.hasAudio&&(i=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(Je.USER_UNPUBLISHED,r,"audio")}),r._video_pre_subscribed||r._audio_pre_subscribed||(r._trust_audio_stream_added_state_=!0,r._trust_video_stream_added_state_=!0,r._audio_added_=!1,r._video_added_=!1,this._p2pChannel instanceof f_&&this._p2pChannel.unsubscribe(r).then(a=>{if(a)return this._gateway.unsubscribe(a,r.uid)}),r._audioSSRC=void 0,r._videoSSRC=void 0,r._audioOrtc=void 0,r._videoOrtc=void 0,r._rtxSsrcId=void 0),Ce.onGatewayStream(this._sessionId,Nn.ON_REMOVE_STREAM,Bt.ON_REMOVE_STREAM,{peer:n.uint_id||n.uid}),i()}),w(this,"_handleSetStreamLocalEnable",(n,r,i)=>{if(L("BLOCK_LOCAL_CLIENT")&&Oc(r,this.channelName))return;const a=this._users.find(u=>u.uid===r);if(!a)return void T.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));T.debug("[".concat(this._clientId,"] local ").concat(n," ").concat(i?"enabled":"disabled"," with uid ").concat(r));const c=n==="audio"?a.hasAudio:a.hasVideo;if(n==="audio"){a._trust_audio_enabled_state_=!0;const u=a._audio_enabled_;if(a._audio_enabled_=i,a._audio_enabled_===u)return;{const p=a._audio_enabled_?"enable-local-audio":"disable-local-audio";T.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(r,", msg: ").concat(p)),this.safeEmit(Je.USER_INFO_UPDATED,r,p)}}else{a._trust_video_enabled_state_=!0;const u=a._video_enabled_;if(a._video_enabled_=i,a._video_enabled_===u)return;{const p=a._video_enabled_?"enable-local-video":"disable-local-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(p)),this.safeEmit(Je.USER_INFO_UPDATED,r,p)}}const l=n==="audio"?a.hasAudio:a.hasVideo;return c!==l?!c&&l?(T.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(n)),void this.safeEmit(Je.USER_PUBLISHED,a,n)):(n==="video"&&a._videoTrack&&a._videoTrack._destroy(),n==="audio"&&a._audioTrack,this._p2pChannel.muteRemote(a,n),T.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(n)),void this.safeEmit(Je.USER_UNPUBLISHED,a,n)):void 0}),w(this,"_handleMuteStream",(n,r,i)=>{if(L("BLOCK_LOCAL_CLIENT")&&Oc(n,this.channelName))return;T.debug("[".concat(this._clientId,"] receive mute message"),n,r,i);const a=this._users.find(u=>u.uid===n);if(!a)return void T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(n));const c=r==="audio"?a.hasAudio:a.hasVideo;if(r==="audio"){a._trust_audio_mute_state_=!0;const u=a._audio_muted_;if(a._audio_muted_=i,a._audio_muted_===u)return;{const p=a._audio_muted_?"mute-audio":"unmute-audio";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(p)),this.safeEmit(Je.USER_INFO_UPDATED,n,p)}}else{a._trust_video_mute_state_=!0;const u=a._video_muted_;if(a._video_muted_=i,a._video_muted_===u)return;{const p=a._video_muted_?"mute-video":"unmute-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(p)),this.safeEmit(Je.USER_INFO_UPDATED,n,p)}}const l=r==="audio"?a.hasAudio:a.hasVideo;if(c!==l){if(!c&&l)return(r==="audio"?a._audioSSRC:a._videoSSRC)?(T.info("[".concat(this._clientId,"] remote user ").concat(n," published ").concat(r)),void this.safeEmit(Je.USER_PUBLISHED,a,r)):void T.warning("[".concat(this._clientId,"] remote user ").concat(n," receive ").concat(r," unmute message  before add stream message, ").concat(r," SSRC doesn't exist yet."));r==="video"&&a._videoTrack&&!a._video_pre_subscribed&&a._videoTrack._destroy(),r==="audio"&&a._audioTrack,this._p2pChannel.muteRemote(a,r),T.info("[".concat(this._clientId,"] remote user ").concat(n," unpublished ").concat(r)),this.safeEmit(Je.USER_UNPUBLISHED,a,r)}}),w(this,"_handleP2PLost",async n=>{T.debug("[".concat(this._clientId,"] receive p2p lost"),n),parseInt(n.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():T.warning("[".concat(this._clientId,"] P2PLost stream not found"),n)}),w(this,"_handleTokenWillExpire",()=>{T.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Je.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),w(this,"_handleBeforeUnload",n=>{n.type==="beforeunload"&&n.returnValue!==void 0&&n.returnValue!==""||(this.leave(),T.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),w(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Je.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const n={downlinkNetworkQuality:0,uplinkNetworkQuality:0};n.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),n.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Je.NETWORK_QUALITY,n)}),w(this,"_handleP2PAddAudioOrVideoStream",(n,r,i,a)=>{const c=this._users.find(u=>u.uid===r);if(!c)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(n)),this.store.subscribe(c.uid,n,void 0,void 0,void 0,Date.now());const l=n==="audio"?c.hasAudio:c.hasVideo;n==="audio"?c._trust_audio_stream_added_state_=!0:c._trust_video_stream_added_state_=!0,n==="audio"?(c._audio_added_=!0,i!==void 0&&(c._audioSSRC=i),a!==void 0&&(c._audioMid=a)):(c._video_added_=!0,i!==void 0&&(c._videoSSRC=i),a!==void 0&&(c._videoMid=a)),(n==="audio"?c.hasAudio:c.hasVideo)&&!l&&(T.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published ").concat(n)),this.safeEmit(Je.USER_PUBLISHED,c,n)),this._p2pChannel.hasPendingRemoteMedia(c,n)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(c.uid," after reconnect.")),this._subscribe(c,n,!0).catch(u=>{T.error("[".concat(this._clientId,"] resubscribe error"),u.toString())}))}),this._config=e,this._clientId=Rt(5,"client-"),this.store=new dz(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),T.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(wi," build: ").concat(XT,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{c1(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(n){T.warning("[".concat(this._clientId,"] ").concat(n.toString()))}this._statsCollector=new xh(this.store),this._statsCollector.onStatsException=(n,r,i)=>{T.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(n,", msg: ").concat(r,", uid: ").concat(i)),this.safeEmit(Je.EXCEPTION,{code:n,msg:r,uid:i})},this._statsCollector.onUploadPublishDuration=(n,r,i,a)=>{const c=this._users.find(l=>l.uid===n);c&&Ce.peerPublishStatus(this._sessionId,{subscribeElapse:a,audioPublishDuration:r,videoPublishDuration:i,peer:c._uintid})},this.store.useDataChannel=Ze().supportDataChannel&&L("SIGNAL_CHANNEL"),this.store.useP2P=e.mode==="p2p",this._gateway=new SY(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||sn,httpRetryConfig:e.httpRetryConfig||sn,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new OY,this.store.useP2P?(this._p2pChannel=new Jr(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new f_(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,i){let a=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],c=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Tt("JOIN_GATEWAY_USE_443PORT_ONLY",a),Tt("JOIN_GATEWAY_USE_DUAL_DOMAIN",c);const l=this._gateway.signal.websocket;return l instanceof rh&&(l.use443PortOnly=a,l.tryDoubleDomain=c),async function(u,p,f){Zf.get(u)||Zf.set(u,[]),$f.get(u)||$f.set(u,p),os.get(u)||os.set(u,0);const m=Zf.get(u),E=$f.get(u);if(!m||!E)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(os.get(u)===E){const b=Ju();m.push(b),await b.promise}os.set(u,os.get(u)+1);for(var S=arguments.length,I=new Array(S>3?S-3:0),v=3;v<S;v++)I[v-3]=arguments[v];const y=await f(...I);return os.set(u,os.get(u)-1),os.get(u)===E-1&&m.length>0&&(m[0].resolve(),m.shift()),os.get(u)===0&&(Zf.set(u,[]),$f.set(u,0),os.set(u,0)),y}("client.join",L("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,i)}async join(e,t,n,r,i){const a=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const c=(cm||cm||(cm=(window.location.protocol.split(":")[0]||"").toUpperCase(),cm))==="HTTPS",l=g1()?window.isSecureContext:"Browser Not Support";(!g1()&&!c||!window.isSecureContext)&&T.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),T.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Ce.setAppId(e);try{if(!n&&n!==null)throw new B(O.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Mn(n,"token",1,2047),Mn(e,"appid",1,2047),hm(t),r&&pm(r),i&&Mn(i,"optionalInfo",1,2047)}catch(v){throw Ce.reportApiInvoke($u(),{name:un.JOIN,options:[e,t,n,r],states:{isHttps:c,isSecureContext:l},tag:Kt.TRACER}).onError(v),v}const u=await mM({appId:e,cname:t,uid:r,stringUid:typeof r=="string"?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode}),p=(u==null?void 0:u.sid)||$u(),f=Ce.reportApiInvoke(p,{name:un.JOIN,options:[e,t,n,r],states:{isHttps:c,isSecureContext:l},tag:Kt.TRACER});if(T.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(a)),this._leaveMutex.isLocked&&(T.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),T.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const v=new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw f.onError(v),v}this._sessionId||(this._sessionId=p,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const m=Li(Li({},this._rtmConfig),{},{clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!u},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(m.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(m.stringUid=r,this._uintUid?(m.uid=this._uintUid,this._uintUid=void 0):m.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(m.aesmode=this._encryptionMode,m.aespassword=await(async v=>{const y=function(F){const W=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),q=new Uint8Array(new ArrayBuffer(W.length));for(let Q=0;Q<W.length;Q+=1)q[Q]=W.charCodeAt(Q);return q}(),b=await window.crypto.subtle.importKey("spki",y,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),D=BT(v),U=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},b,D);return function(F){let W="";for(let q=0;q<F.length;q+=1)W+=String.fromCharCode(F[q]);return window.btoa(W)}(new Uint8Array(U))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(m.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const v=new TextEncoder,y=L("USE_PURE_ENCRYPTION_MASTER_KEY")?v.encode(m.appId+this._encryptionSecret+this._encryptionSecret):v.encode(m.appId+m.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(b,D,U){const F=await window.crypto.subtle.importKey("raw",D,"PBKDF2",!1,["deriveBits","deriveKey"]),W=b==="aes-128-gcm2"?128:256,q=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:T1,hash:"SHA-256",salt:U},F,W+lz);return new Uint8Array(q).subarray(W/8)}(this._encryptionMode,y,bc(this._encryptionSalt)),this._encryptDataStreamKey=await async function(b,D,U){const F=await window.crypto.subtle.importKey("raw",D,"PBKDF2",!1,["deriveBits","deriveKey"]),W=b==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:T1,hash:"SHA-256",salt:U},F,{name:"AES-GCM",length:W},!0,["encrypt","decrypt"])}(this._encryptionMode,y,bc(this._encryptionSalt))}else l?T.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):T.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,T.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:m.stringUid,preload:m.preload});const E=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&E===this._sessionId&&Ce.joinChannelTimeout(this._sessionId,5)},5e3);try{var S;let v;const y=m.cloudProxyServer;if(ue(S=["proxy3","proxy4","proxy5"]).call(S,y)){const W=L("PROXY_SERVER_TYPE3");Array.isArray(W)?m.proxyServer=W[0]:m.proxyServer=W}if(Ce.setProxyServer(m.proxyServer),T.setProxyServer(m.proxyServer),this.store.requestAPStart(),u){if(T.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(m.stringUid?", ".concat(m.stringUid," => ").concat(u.intUid):""," ")),m.stringUid&&!m.uid&&(m.uid=u.intUid),v={gatewayInfo:u.ap.gatewayInfo},L("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&m.turnServer.mode==="auto")if(u.ap.proxyInfo.addresses.length===0)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const W=(await z1(u.ap.proxyInfo,u.ap.gatewayInfo.uid)).map(q=>({turnServerURL:q.address,tcpport:q.tcpport||Gn.tcpport,udpport:q.udpport||Gn.udpport,username:q.username||Gn.username,password:q.password||Gn.password,forceturn:!1,security:!0}));m.turnServer={mode:"manual",servers:W}}gM(u,m.stringUid)}else{if(m.stringUid&&!m.uid){let W;[W,v]=await ce.all([oD(m.stringUid,m,this._axiosCancelSource.token,this._config.httpRetryConfig||sn,this.store),iD(m,this._axiosCancelSource.token,this._config.httpRetryConfig||sn,!0,this.store)]),T.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(m.stringUid," => ").concat(W)),m.uid=W,v.gatewayInfo.uid=W,v.gatewayInfo.res.uid=W}else v=await iD(m,this._axiosCancelSource.token,this._config.httpRetryConfig||sn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(m,this._axiosCancelSource.token),this._configDistribute.on(sv.UPDATE_BITRATE_LIMIT,W=>{this._p2pChannel.updateBitrateLimit(W)})},0),this._key=n||e;const b=v.gatewayInfo,D=m.uid?m.uid:b.uid;this._joinInfo=Li(Li({},m),{},{cid:b.cid,uid:D,vid:b.vid,apResponse:b.res,uni_lbs_ip:b.uni_lbs_ip,gatewayAddrs:b.gatewayAddrs}),this.store.intUid=D;const U=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));f.onSuccess(U),this._appId=e,this._channelName=m.cname,this._uid=U,this.store.uid=U,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Cn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const F=m.stringUid?"string uid: ".concat(m.stringUid,",uid: ").concat(m.uid):"uid: ".concat(this._uid);return T.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(F)),setTimeout(()=>{T.startUpload()},5e3),this.store.joinEnd(),I=this,ue(Ea).call(Ea,I)||Ea.push(I),this._cloudProxyServerMode==="disabled"&&Ze().supportWebCrypto&&L("ENABLE_PRELOAD")&&Qy(this._joinInfo),U}catch(v){const y=Array.isArray(v)?v[0]:v;throw y&&y.code===O.OPERATION_ABORTED?T.warning("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),y):T.error("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),y),y.code!==O.OPERATION_ABORTED&&this._numberOfJoinCount===a&&(this._gateway.state="DISCONNECTED",this._reset()),f.onError(y),y}var I}_joinGateway(){if(!this._joinInfo||!this._key)throw new B(O.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!L("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(e=>e).catch(e=>{if(e.code===O.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,qe.FALLBACK),e;if(e.code===O.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,qe.FALLBACK),e;throw e}).then(e=>{if(e instanceof B){if(e.code===O.INIT_WEBSOCKET_TIMEOUT){if(T.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new B(O.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const t=L("PROXY_SERVER_TYPE3");if(Array.isArray(t))if(this._joinInfo.apUrl){const r=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),i=r.slice(r.length-2).join(".");t.forEach(a=>{this._joinInfo&&ue(a).call(a,i)&&(this._joinInfo.proxyServer=a)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=t[0])}else this._joinInfo.proxyServer=t[0];else this._joinInfo.proxyServer=t;const n=L("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return n&&n[1]&&n[1]!=="443"&&T.setProxyServer(this._joinInfo.proxyServer),L("STATS_COLLECTOR_PORT").toString()!=="443"&&Ce.setProxyServer(this._joinInfo.proxyServer),Ce.reportApiInvoke(this._sessionId,{name:un.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:Kt.TRACER}).onSuccess(),this.safeEmit(Je.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),L("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(r=>{"forceturn"in r&&(r.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(T.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new B(O.INVALID_OPERATION);return Ce.reportApiInvoke(this._sessionId,{name:un.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:Kt.TRACER}).onSuccess(),this._joinGateway()}return e}).then(e=>e)}async leave(){T.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Cn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const n=Ea.indexOf(t);n!==-1&&Ea.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return T.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED"),T.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof vl))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new B(O.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new B(O.INVALID_OPERATION,"audience can not publish stream");for(const i of n){if(!(i instanceof vl))throw new B(O.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new B(O.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}T.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(i=>{const a=this._configDistribute.getBitrateLimit();i instanceof wt&&a&&i.setBitrateLimit(a.uplink)});try{await this._publishHighStream(n),T.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw T.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{r()}}async _publishDataChannel(e){St(e.id,"id",0,65535,!0),Ns(e.ordered,"ordered"),Mn(e.metadata,"metadata",0,512),T.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(r=>r.id===e.id)!==-1)throw new B(O.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&L("FORCE_TURN")&&!L("TURN_ENABLE_TCP")&&!L("TURN_ENABLE_UDP"))throw new B(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=new Pk(e);if(await this._p2pChannel.publishDataChannel([n]),!this._p2pChannel.isP2PDisconnected()){if(typeof n._originDataChannelId!="number")throw T.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new B(O.CREATE_DATACHANNEL_ERROR);try{const r={streamId:e.id,ordered:e.ordered,maxRetransmits:L("DATASTREAM_MAX_RETRANSMITS"),metadata:e.metadata,channelId:n._originDataChannelId};await this._gateway.publishDataChannel(this._uid,r,!0),await n._waitTillOpen()}catch(r){if(r.code!==O.DISCONNECT_P2P)throw r}}return T.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw T.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof vl))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);T.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(r=>"".concat(r.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this._p2pChannel instanceof Jr){const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.sendExtensionMessage($t.UNPUBLISH,{unpubMsg:r},!0)}else{const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.unpublish(r,this._uid),T.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(i=>"".concat(i.getTrackId()))))}}catch(r){throw T.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),T.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),T.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(r=>"".concat(r.id))))}catch(n){throw T.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof Da)){const r=this.remoteUsers.find(i=>i.uid===e);if(!r)throw new B(O.INVALID_REMOTE_USER,"user is not in the channel");e=r}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(Sn(t,"mediaType",["audio","video"]),this._p2pChannel instanceof Jr)throw new B(O.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===ye.AUDIO,r=t===ye.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:a,ortc:c,rtxSsrcId:l,cname:u,uint_id:p}=await this._gateway.presubscribe(e,t,!0);if(a==null)throw new B(O.UNEXPECTED_RESPONSE,"no ssrc id");let f=this._users.find(E=>E.uid===e);f||(f=new Da(e,p||e),f._is_pre_created=!0,this._users.push(f)),u&&(f._cname=u),f._uintid||(f._uintid=p||e),n&&(f._audioSSRC=a,f._audio_pre_subscribed=!0,c&&(f._audioOrtc=c)),r&&(f._videoSSRC=a,f._video_pre_subscribed=!0,c&&(f._videoOrtc=c),l!=null&&(f._rtxSsrcId=l)),T.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(a)),await this._p2pChannel.subscribe(f,t,a,l,c);const m=n?f._audioTrack:f._videoTrack;if(!m)throw new B(O.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(f._trust_audio_stream_added_state_=!0,f._audio_added_=!0),r&&(f._trust_video_stream_added_state_=!0,f._video_added_=!0),m}catch(a){throw T.error("[".concat(this._clientId,"] presub user ").concat(e," error"),a),a}finally{i()}}async _subscribeDataChannel(e,t){var n;if(St(t,"channelId",0,65535,!0),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===e))throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new B(O.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new B(O.INVALID_REMOTE_USER,"user is not published");const i=(n=e._dataChannels)===null||n===void 0?void 0:n.find(l=>l.id===t);if(!i)throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new B(O.REMOTE_USER_IS_NOT_PUBLISHED);const a=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const l=await this._p2pChannel.subscribeDataChannel(e,[i]);if(l&&ue(l).call(l,i.id))try{var c;if(typeof i._originDataChannelId!="number")throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new B(O.CREATE_DATACHANNEL_ERROR);const u={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(c=i.metadata)!==null&&c!==void 0?c:""};await this._gateway.subscribeDataChannel(e.uid,u,!0),await i._waitTillOpen()}catch(u){if((u==null?void 0:u.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),u;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return T.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{a()}}async _p2pSubscribe(e,t,n){if(Sn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(a=>a===e)){const a=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),a}if(!e.hasAudio&&!e.hasVideo){const a=new B(O.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),a}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const a=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),a}const i=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const c=t==="audio"?e._audioSSRC:e._videoSSRC,l=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this._p2pChannel instanceof Jr&&await this._p2pChannel.subscribe(e,t,c,l)}catch(c){throw c}T.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(c=>{T.warning("[".concat(this._clientId,"] auto set fallback failed"),c)});const a=t==="audio"?e._audioTrack:e._videoTrack;if(!a)throw new B(O.UNEXPECTED_ERROR,"can not find remote track in user object");return a}catch(a){throw T.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),a),a}finally{i()}}async _subscribe(e,t,n){if(this._p2pChannel instanceof Jr)return this._p2pSubscribe(e,t);if(Sn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(p=>p===e)){const p=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),p}if(!e.hasAudio&&!e.hasVideo){const p=new B(O.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),p}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const p=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),p}let i=t==="audio"?e._audioSSRC:e._videoSSRC,a=t==="audio"?e._audioOrtc:e._videoOrtc,c=t==="video"?e._rtxSsrcId:void 0,l={stream_type:t==="audio"?ye.AUDIO:ye.VIDEO,ssrcId:i};const u=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const f=t==="audio"?e._audioSSRC:e._videoSSRC;f!==void 0&&f!==i&&(i=f,a=t==="audio"?e._audioOrtc:e._videoOrtc,c=t==="video"?e._rtxSsrcId:void 0,l={stream_type:t==="audio"?ye.AUDIO:ye.VIDEO,ssrcId:i}),Zn.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,c,a);try{await this._gateway.subscribe(e.uid,l,!0)}catch(m){if((m==null?void 0:m.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),m;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(f){throw this._p2pChannel.reportSubscribeEvent(!1,f==null?void 0:f.code,e,t),f}T.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(f=>{T.warning("[".concat(this._clientId,"] auto set fallback failed"),f)});const p=t==="audio"?e._audioTrack:e._videoTrack;if(!p)throw new B(O.UNEXPECTED_ERROR,"can not find remote track in user object");return p}catch(p){throw T.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),p),p}finally{u()}}async massSubscribe(e){if(Ds(e,"subscribeList"),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(l=>{let{user:u,mediaType:p}=l;return"user: ".concat(u==null?void 0:u.uid,", mediaType: ").concat(p)}).join("; ")));const i=(e=[...e]).map(l=>{let{user:u,mediaType:p}=l;return{user:u,mediaType:p}}),a=await this._p2pChannel.globalLock();try{var c;for(let u=e.length-1;u>=0;u--){const p=e[u],{user:f,mediaType:m}=p;if(Sn(m,"mediaType",["audio","video"]),!f){const v=new B(O.INVALID_PARAMS,"user property does not exist in subscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),v}if(!this._users.find(v=>v===f)){const v=new B(O.INVALID_REMOTE_USER,"user is not in the channel");T.error("[".concat(this._clientId,"] can not massSubscribe ").concat(f.uid,", this user is not in the channel")),i[u].error=v,e.splice(u,1);continue}if(m==="audio"&&(!f.hasAudio||f._audioSSRC===void 0)||m==="video"&&(!f.hasVideo||f._videoSSRC===void 0)){const v=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);T.error("[".concat(this._clientId,"] can not subscribe ").concat(f.uid," with mediaType ").concat(m,", remote user is not published")),i[u].error=v,e.splice(u,1);continue}const S=wn.Video|wn.LwoVideo,I=n.get(f);if(I){if(m==="video"?I&S:I&wn.Audio){e.splice(u,1),T.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(f.uid,", mediaType:").concat(m," twice"));continue}n.set(f,I|(m==="video"?S:wn.Audio))}else n.set(f,m==="video"?S:wn.Audio)}for(let u=e.length-1;u>=0;u--){const p=e[u],{user:f,mediaType:m}=p,E=wn.Video|wn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(f,m)){await this._p2pChannel.unmuteRemoteNoLock(f,m);const S=n.get(f);n.set(f,m==="video"?S^E:S^wn.Audio),e.splice(u,1)}}this.store.massSubscribe(e.map(u=>({userId:u.user.uid,type:u.mediaType})),t);const l=yo(c=Array.from(n.entries())).call(c,(u,p)=>{let[f,m]=p;if(m===0)return u;const E={stream_id:f.uid,stream_type:m};return m&wn.Audio&&(E.audio_ssrc=f._audioSSRC),m&wn.Video&&(E.video_ssrc=f._videoSSRC),u.push(E),u},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(p=>{let{user:f,mediaType:m}=p;return{user:f,mediaType:m,ssrcId:m===ye.VIDEO?f._videoSSRC:f._audioSSRC,rtxSsrcId:m===ye.VIDEO?f._rtxSsrcId:void 0}}));const u=new Map;if(l.length>0){const p=await this._gateway.subscribeAll(l,!0);((p==null?void 0:p.users)||[]).forEach(f=>{let{stream_id:m,video_error_code:E,audio_error_code:S,error_code:I}=f;(E||S||I)&&u.set(m,{video_error_code:E,audio_error_code:S,error_code:I})})}if(Array.from(u.entries()).length>0){const p=[];Array.from(u.entries()).forEach(f=>{let[m,E]=f;const S=this.remoteUsers.find(I=>I.uid===m);if(S){let I;E.error_code||E.video_error_code&&E.audio_error_code?I=void 0:E.video_error_code?I=ye.VIDEO:E.audio_error_code&&(I=ye.AUDIO),p.push({user:S,mediaType:I})}}),p.length>0&&await this._p2pChannel.massUnsubscribeNoLock(p)}for(const p of i){const f=u.get(p.user.uid);if(f){const m=f.error_code||p.mediaType==="audio"&&f.audio_error_code||p.mediaType==="video"&&f.video_error_code;if(m){const E=Dc(m);T.error("user:".concat(p.user.uid," mediaType:").concat(p.mediaType," has massSubscribe error ").concat(E.desc)),p.error=new B(O.SUBSCRIBE_FAILED,"code ".concat(m,": ").concat(E.desc))}}p.error||(p.mediaType==="video"?p.track=p.user.videoTrack:p.track=p.user.audioTrack)}return this.store.massSubscribe(i.filter(p=>!p.error).map(p=>({userId:p.user.uid,type:p.mediaType})),void 0,Date.now()),i.forEach(p=>{var f;Ce.subscribe(this.store.sessionId,{succ:!!p.error,ec:((f=p.error)===null||f===void 0?void 0:f.code)||null,video:p.mediaType===ye.VIDEO,audio:p.mediaType===ye.AUDIO,peerid:p.user.uid,subscribeRequestid:p.mediaType===ye.VIDEO?p.user._videoSSRC:p.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t)},!0)}),T.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(p=>{let{user:f,mediaType:m}=p;return"user: ".concat(f==null?void 0:f.uid,", mediaType: ").concat(m)}).join("; "))),i}catch(u){throw await this._p2pChannel.massUnsubscribeNoLock(e),u}}finally{a(),r()}}async unsubscribe(e,t,n){if(!(e instanceof Da)){const a=this.remoteUsers.find(c=>c.uid===e);if(!a)throw new B(O.INVALID_REMOTE_USER,"user is not in the channel");e=a}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&Sn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(a=>a===e)){const a=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),a}T.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const i=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof Jr)await this._p2pChannel.unsubscribe(e,t);else{const a=await this._p2pChannel.unsubscribe(e,t);a&&await this._gateway.unsubscribe(a,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&rm(this._users,e),T.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(a){if(a.code===O.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),a.toString()),a}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&St(t,"id",0,65535,!0),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i=>i===e)){const i=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),i}let r;if(typeof t=="number"){const i=e._dataChannels.find(a=>a.id===t);i&&(r=[i])}else r=e._dataChannels;if(r===void 0){const i=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),i}T.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(i=>i.id)));try{const i=await this._p2pChannel.unsubscribeDataChannel(e,r);i&&await this._gateway.unsubscribeDataChannel(i,e.uid),T.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===O.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}}async massUnsubscribe(e){if(Ds(e,"unsubscribeList"),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");T.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:r,mediaType:i}=n;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(i,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:i}=e[n];if(!r){const l=new B(O.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),l}if(Sn(i,"mediaType",["video","audio",void 0]),!this._users.find(l=>l===r)){T.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const c=wn.Video|wn.LwoVideo;if(t.has(r)){const l=t.get(r);let u;switch(i){case"video":u=l&c;break;case"audio":u=l&wn.Audio;break;default:u=l&(wn.Audio|c)}if(u){T.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?i==="audio"?t.set(r,l|wn.Audio):i==="video"&&t.set(r,l|c):t.set(r,l|wn.Audio|c)}else i?i==="audio"?t.set(r,wn.Audio):i==="video"&&t.set(r,c):t.set(r,wn.Audio|c)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),T.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(r=>{let{user:i,mediaType:a}=r;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(a,";")}).join()))}catch(n){if(n.code===O.DISCONNECT_P2P)return void T.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw T.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new J(O.INVALID_PARAMS);Ht(n.width)||VT(n.width,"streamParameter.width"),Ht(n.height)||VT(n.height,"streamParameter.height"),Ht(n.framerate)||VT(n.framerate,"streamParameter.framerate"),Ht(n.bitrate)||St(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&T.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),T.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,re.LocalVideoLowTrack)}async enableDualStream(){if(!Ze().supportDualStream)throw Ce.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new B(O.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new B(O.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Ce.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,Ce.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),T.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(re.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Ce.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,Ce.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),T.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(n){Sn(n,"role",["audience","host"])}(e),t&&c1(t),this.mode==="rtc"||this.mode==="p2p")throw T.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new B(O.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new B(O.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new B(O.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,T.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Mn(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new B(O.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Ce.setProxyServer(this._proxyServer),T.setProxyServer(this._proxyServer),T.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new B(O.INVALID_OPERATION,"You have already set the proxy")}if(Yd(e))return this._turnServer={servers:e,mode:"original-manual"},void T.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>a1(n)),this._turnServer={servers:e,mode:"manual"},T.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"you should set license before join channel");if(Mn(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new B(O.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,T.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new B(O.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new B(O.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new B(O.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Stop proxy server after leave channel");Ce.setProxyServer(),T.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new B(O.INVALID_PARAMS,"accessPoints is required.");Ds(e.accessPoints.serverList,"accessPoints.serverList"),Mn(e.accessPoints.domain,"accessPoints.domain");const t=(E,S)=>{St(E,S,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new B(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");L("CLOSE_AFB_FOR_LOCAL_AP")&&(Tt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Tt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,a=e.accessPoints.serverList.map(E=>r.test(E)?"".concat(E.replace(/\./g,"-"),".").concat(i):E),c=a.map(E=>"".concat(E,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Tt("WEBCS_DOMAIN",c),Tt("WEBCS_DOMAIN_BACKUP_LIST",c),Tt("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Ds(e.report.hostname,"report.hostname"),Tt("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Tt("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Tt("EVENT_REPORT_DOMAIN",a[0]),Tt("EVENT_REPORT_BACKUP_DOMAIN",a[1]||a[0]));let l=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),l=e.report.port),Tt("STATS_COLLECTOR_PORT",l),e.report?Tt("ENABLE_EVENT_REPORT",!0):Tt("ENABLE_EVENT_REPORT",!1);let u="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Ds(e.log.hostname,"log.hostname"),u=e.log.hostname[0]):u=a[0];let p=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),p=e.log.port),Tt("LOG_UPLOAD_SERVER","".concat(u,":").concat(p));let f=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Ds(e.cds.hostname,"cds.hostname"),f=e.cds.hostname):f=a;let m=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),m=e.cds.port),Tt("CDS_AP",f.map(E=>"".concat(E,":").concat(m))),e.cds?Tt("ENABLE_CONFIG_DISTRIBUTE",!0):Tt("ENABLE_CONFIG_DISTRIBUTE",!1),T.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Ds(e,"serverList"),Mn(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new B(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(r=>n.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Tt("WEBCS_DOMAIN",e),Tt("WEBCS_DOMAIN_BACKUP_LIST",e),Tt("GATEWAY_DOMAINS",[t]),Tt("EVENT_REPORT_DOMAIN",e[0]),Tt("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Tt("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),T.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Sn(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw T.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else T.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Sn(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(r=>r.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw T.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Sn(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw T.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,r){(function(a){Sn(a,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Mn(t,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(ue(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new B(O.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new B(O.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(Ns(r,"encryptDataStream"),!ue(i).call(i,e))throw new B(O.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||T.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=ma(n))}async renewToken(e){if(Mn(e,"token",1,2047),!this._key||!this._joinInfo)throw new B(O.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(L("USE_NEW_TOKEN")){T.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r=await AY(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||sn);T.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:r})}else T.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});T.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,T.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?T.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Je.VOLUME_INDICATOR,e)},L("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new B(O.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new B(O.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new B(O.LIVE_STREAMING_TASK_CONFLICT);const n=t?Dn.TRANSCODE:Dn.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(Dn.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new B(O.INVALID_PARAMS,"can not find live streaming url to stop");await ce.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async addInjectStreamUrl(e,t){if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const n=this._createLiveStreamingClient(Dn.INJECT);n.setInjectStreamConfig(t,0),await n.startLiveStreamingTask(e,Dn.INJECT)}async removeInjectStreamUrl(){var e;const t=this._createLiveStreamingClient(Dn.INJECT),n=Array.from(Io(e=t.streamingTasks).call(e)).find(r=>r.mode===Dn.INJECT);if(!this._joinInfo||!n)throw new B(O.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await t.stopLiveStreamingTask(n.url)}async startChannelMediaRelay(e){C2(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){C2(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const i=new TextEncoder;e.payload=i.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ue(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(i,a,c){var l;const u=yo(l=Array.from(c)).call(l,(v,y)=>v+y,0),p={serverTs:0,seq:uz++,length:c.length,checkSum:u},f=new Uint8Array(_1(u,2)),m=new ArrayBuffer(Qd),E=new DataView(m);E.setUint32(0,p.serverTs),E.setUint16(4,p.seq),E.setUint16(6,p.length),E.setUint16(8,p.checkSum);const S=16-c.length%16;c=u1(c,new Uint8Array(S));const I=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:S1,additionalData:f},a,c);return u1(new Uint8Array(m),new Uint8Array(I))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new B(O.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(we.DATA_STREAM,{payload:ma(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-ZX},!n)}sendMetadata(e){if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new B(O.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(we.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:ma(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(pz),!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not send custom report, not joined");await Ce.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){Sn(t.spatialLayer,"spatialLayer",[0,1,2,3]),Sn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw T.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(Ns(t,"apRTM"),St(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,T.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(T.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Rr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&EM(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new On("client-publish"),this._subscribeMutex=new On("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const r=e||$u();e?T.debug("[".concat(this._clientId,"] new Session ").concat(r)):T.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r;const a={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1};t?Ce.sessionInit(this._sessionId,Li({cname:t.channel,appid:t.appId,preload:t.preload},a)):this._joinInfo?Ce.sessionInit(this._sessionId,Li({cname:this._joinInfo.cname,appid:this._joinInfo.appId,preload:!!this._joinInfo.recoverPreloadCache},a)):this._gateway.joinInfo&&Ce.sessionInit(this._sessionId,Li({cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId},a)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&L("FORCE_TURN")&&!L("TURN_ENABLE_TCP")&&!L("TURN_ENABLE_UDP"))throw new B(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");T.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof Jr){const r=(await n.next()).value;if(r){try{await this._gateway.sendExtensionMessage($t.PUBLISH,r,!0)}catch(i){throw n.throw(i),i}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(a){if(a.code!==O.DISCONNECT_P2P)throw n.throw(a),a}await n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const i of e)i instanceof wt&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig),!i.muted&&i.enabled||await this._p2pChannel.muteLocalTrack(i)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===O.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));T.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(a){if(a.code!==O.DISCONNECT_P2P)throw n.throw(a),a}n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===O.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new B(O.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const t=()=>new IX(this._joinInfo,this._config.websocketRetryConfig||sn,this._config.httpRetryConfig||sn),n=r=>{r.onLiveStreamError=(i,a)=>{Ce.reportApiInvoke(this._sessionId,{name:un.ON_LIVE_STREAM_ERROR,options:[i,a],tag:Kt.TRACER}).onSuccess(),this.safeEmit(Je.LIVE_STREAMING_ERROR,i,a)},r.onLiveStreamWarning=(i,a)=>{Ce.reportApiInvoke(this._sessionId,{name:un.ON_LIVE_STREAM_WARNING,options:[i,a],tag:Kt.TRACER}).onSuccess(),this.safeEmit(Je.LIVE_STREAMING_WARNING,i,a)},r.on(fm.REQUEST_WORKER_MANAGER_LIST,(i,a,c)=>{if(!this._joinInfo)return c(new B(O.INVALID_OPERATION,"can not find join info to get worker manager"));cD(i,this._joinInfo,this._axiosCancelSource.token,sn).then(a).catch(c)})};switch(e){case Dn.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=t(),n(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Dn.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=t(),n(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Dn.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=t(),this._injectStreamingClient.on(fm.REQUEST_WORKER_MANAGER_LIST,(r,i,a)=>{if(!this._joinInfo)return a(new B(O.INVALID_OPERATION,"can not find join info to get worker manager"));cD(r,this._joinInfo,this._axiosCancelSource.token,sn).then(i).catch(a)}),this._injectStreamingClient.onInjectStatusChange=(r,i,a)=>{this.safeEmit(Je.INJECT_STREAM_STATUS,r,i,a)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new B(O.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:t}=this.getLocalVideoStats(),n={width:e,height:t};this._channelMediaRelayClient=new AX(this._joinInfo,this._clientId,this._config.websocketRetryConfig||sn,this._config.httpRetryConfig||sn,n),this._channelMediaRelayClient.on("state",r=>{r===Pr.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(Je.CHANNEL_MEDIA_RELAY_STATE,r)}),this._channelMediaRelayClient.on("event",r=>{this.safeEmit(Je.CHANNEL_MEDIA_RELAY_EVENT,r)}),this._statsCollector.onStatsChanged=(r,i)=>{var a;r==="resolution"&&((a=this._channelMediaRelayClient)===null||a===void 0||a.setVideoProfile(i))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:r}=e,i=[];Array.isArray(n)&&n.length>0&&n.forEach(a=>{const{uid:c,stream_id:l,ordered:u,max_retrans_times:p,metadata:f}=a,m=this._users.find(E=>E._uintid===c);if(!m)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(T.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(c)),ue(i).call(i,m)||i.push(m),m._uintid||(m._uintid=c),m._dataChannels.findIndex(E=>E.id===a.stream_id)===-1){const E={id:l,ordered:!!u,maxRetransmits:p,metadata:f},S=new rX(E);m._dataChannels.push(S),T.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published datachannel")),t||this.safeEmit(Je.USER_PUBLISHED,m,"datachannel",E)}this._p2pChannel.hasPendingRemoteDataChannel(m,a.stream_id)&&(T.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(m.uid," after reconnect.")),this._subscribeDataChannel(m,a.stream_id).catch(E=>{T.error("[".concat(this._clientId,"] resubscribe datachannel error"),E.toString())}))}),t&&(this.safeEmit(Je.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(a=>{const{uid:c,stream_id:l}=a,u=this._users.find(f=>f._uintid===c);if(!u)return void T.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const p=u._dataChannels.find(f=>f.id===a.stream_id);p&&(T.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(c)),this._p2pChannel.unsubscribeDataChannel(u,[p]).then(f=>{if(u._dataChannels=u._dataChannels.filter(m=>m!==p),f)return this._gateway.unsubscribeDataChannel(f,u.uid)}),T.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished datachannel ,id:").concat(p.id)),this.safeEmit(Je.USER_UNPUBLISHED,u,"datachannel",p._config))})}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){T.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(r=>{this.safeEmit(Je.USER_UNPUBLISHED,t,"datachannel",r._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(r=>{if(r)return this._gateway.unsubscribeDataChannel(r,t.uid)}),n()}}else T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Zt.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Zt.CONNECTION_STATE_CHANGE,(e,t,n)=>{var r;if(n===qe.FALLBACK)return;const i=()=>{this.safeEmit(Je.CONNECTION_STATE_CHANGE,e,t,n)};if(Ce.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:un.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:Kt.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),T.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void i();if(e==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._is_pre_created||(c._audio_pre_subscribed||(c._audioSSRC=void 0,c._audioOrtc=void 0),c._video_pre_subscribed||(c._videoSSRC=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),c._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var a;this._streamFallbackTypeCacheMap.forEach((c,l)=>{this._gateway.setStreamFallbackOption(l,c).catch(u=>{T.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),u)})}),this._remoteStreamTypeCacheMap.forEach((c,l)=>{this._gateway.setRemoteVideoStreamType(l,c).catch(u=>{T.warning("[".concat(this._clientId,"] auto set remote stream type failed"),u)})}),this._remoteDefaultVideoStreamType!==void 0&&((a=this._joinInfo)===null||a===void 0?void 0:a.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{T.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{T.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{T.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,ye.AUDIO,!1)),c._trust_video_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,ye.VIDEO,!1)),c._trust_audio_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(T.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3))}i()}),this._gateway.on(Zt.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new B(O.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;this._joinInfo.recoverPreloadCache?(n=this._joinInfo.recoverPreloadCache.ap,gM(this._joinInfo.recoverPreloadCache),this._joinInfo.recoverPreloadCache=void 0):n=await Sv(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||sn,this.store),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const r=[];n.gatewayInfo.gatewayAddrs.forEach(i=>{let{address:a}=i;const[c,l]=a.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:c,port:l}):r.push({host:c,port:l})}),e(r)}catch(n){t(n)}}),this._gateway.on(Zt.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Je.NETWORK_QUALITY,e)}),this._gateway.on(Zt.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Je.STREAM_TYPE_CHANGED,e,t),Ce.reportApiInvoke(this._sessionId,{name:un.STREAM_TYPE_CHANGE,options:[e,t],tag:Kt.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(Zt.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Zt.NEED_RENEW_SESSION,async e=>{if(e==="recover"&&this._joinInfo){const t=await mM(Li(Li({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));this._joinInfo.recoverPreloadCache=t,this._startSession(t==null?void 0:t.sid)}else this._startSession()}),this._gateway.on(Zt.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{t(await this._p2pChannel.startP2PConnection(e))}catch(r){n(r)}}),this._gateway.on(Zt.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;const{dtlsParameters:n,iceParameters:r,candidates:i,rtpCapabilities:a,setup:c,cname:l}=Qk(e.ortc,t);this._p2pChannel.connect(r,n,i,a,c,l)}),this._gateway.on(Zt.REQUEST_DC_CONNECTION_PARAMS,e=>{e(this._p2pChannel.getEstablishParams())}),this._gateway.on(Zt.RESET_SIGNAL,e=>{this._p2pChannel.resetConnection(e),this._handleGatewaySignalEvents()}),this._gateway.on(Zt.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(Zt.DATACHANNEL_PRECONNECT,async(e,t,n,r)=>{var i,a,c,l,u,p;await this._p2pChannel.startP2PConnection({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},!0);const f=function(m,E){let S;return E&&E.ip&&typeof E.port=="number"?(S=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:E.ip,port:E.port.toString(),type:"host",extension:{}}],T.debug("Using remote candidate from AP ".concat(E.ip,":").concat(E.port)),E.ip6&&(S.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:E.ip6,port:E.port.toString(),type:"host",extension:{}}),T.debug("Using IPV6 remote candidate from AP ".concat(E.ip6,":").concat(E.port)))):S=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:m.ip,port:m.port.toString(),type:"host",extension:{}}],S}(e,t);return this._p2pChannel.preConnect({iceUfrag:"".concat((a=this._joinInfo)===null||a===void 0?void 0:a.apResponse.cid,"_").concat((c=this._joinInfo)===null||c===void 0?void 0:c.apResponse.cert),icePwd:"".concat((l=this._joinInfo)===null||l===void 0?void 0:l.apResponse.cid,"_").concat((u=this._joinInfo)===null||u===void 0?void 0:u.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(p=L("FINGERPRINT"))!==null&&p!==void 0?p:e.fingerprint}]},f,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(n).catch(r)})}_handleGatewaySignalEvents(){this._gateway.signal.on(Ue.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Ue.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Ue.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(Ue.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Ue.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Ue.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams,deleted:[]},!0)}),this._gateway.signal.on(Ue.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Ue.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Ue.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,ye.AUDIO,!0)),this._gateway.signal.on(Ue.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,ye.AUDIO,!1)),this._gateway.signal.on(Ue.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,ye.VIDEO,!0)),this._gateway.signal.on(Ue.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,ye.VIDEO,!1)),this._gateway.signal.on(Ue.RECEIVE_METADATA,e=>{const t=bc(e.metadata);this.safeEmit(Je.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Ue.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=bc(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ue(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<Qd)throw new B(O.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Qd));n=await async function(a,c,l){const u=l.subarray(0,Qd),p=u.slice(8,Qd),f=(p[0]<<8)+p[1],m=(u[6]<<8)+u[7],E=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:a,tagLength:S1,additionalData:new Uint8Array(_1(f,2))},c,l.subarray(Qd));return new Uint8Array(E).subarray(0,m)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let r=0;if(e.ordered||e.syncWithAudio){const i=this._p2pChannel.getStats(),a=this.remoteUsers.find(l=>l.uid===e.uid),c=i==null?void 0:i.audioRecv.find(l=>l.ssrc===(a==null?void 0:a._audioSSRC));r=c==null?void 0:c.jitterBufferMs}r==null&&(r=0),eQ(Li(Li({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Ue.ON_CRYPT_ERROR,()=>{fa(()=>{T.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Je.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Ue.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{T.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,qe.TOKEN_EXPIRE),this.safeEmit(Je.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Ue.ON_STREAM_FALLBACK_UPDATE,e=>{T.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Je.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Ue.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),T.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Ue.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Ue.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Ee.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case we.PUBLISH:{if(!t)return;const i=t.ortc;if(i){var n,r;const a=i.some(u=>{let{stream_type:p}=u;return p===ut.Audio}),c=i.some(u=>{let{stream_type:p}=u;return p!==ut.Audio}),l=i.some(u=>{let{stream_type:p}=u;return p===ut.Screen||p===ut.ScreenLow});t.state==="offer"&&Ce.publish(this._joinInfo.sid,{eventElapse:Zn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:O.TIMEOUT,audio:a,video:c,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:l,audioName:a?(n=i.find(u=>{let{stream_type:p}=u;return p===ut.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:c?(r=i.find(u=>{let{stream_type:p}=u;return p!==ut.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case we.SUBSCRIBE:t&&Ce.subscribe(this._joinInfo.sid,{succ:!1,ec:O.TIMEOUT,audio:t.stream_type===ye.AUDIO,video:t.stream_type===ye.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Zn.measureFromSubscribeStart(this.store.clientId,t.ssrcId)})}}),this._gateway.signal.on(Ue.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Ue.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;L("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(r=>!Oc(r.string_id||r.stream_id,this.channelName)));const t=[],n=[];for(const r of e.users){let i=this._users.find(f=>f._uintid===r.stream_id);i?i._trust_in_room_=!0:(i=new Da(r.string_id||r.stream_id,r.stream_id),this._users.push(i),this.getListeners(Je.PUBLISHED_USER_LIST).length===0&&(T.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Je.USER_JOINED,i)));const a=wn.Audio&r.stream_type,c=(wn.Video|wn.LwoVideo)&r.stream_type,l=(65280&r.stream_type)!=0,u=a&&i.hasAudio,p=c&&i.hasVideo;c&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=r.video_ssrc,i._rtxSsrcId=r.video_rtx),a&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=r.audio_ssrc),a&&!u&&this.getListeners(Je.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(Je.USER_PUBLISHED,i,"audio")),c&&!p&&this.getListeners(Je.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(Je.USER_PUBLISHED,i,"video")),(a&&!u||c&&!p||l)&&t.push(i),c&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&n.push({user:i,mediaType:"video"}),a&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&n.push({user:i,mediaType:"audio"})}n.length>0&&(T.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(r=>{T.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(Je.PUBLISHED_USER_LIST).length>0?L("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(T.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(r=>r.uid).join(", "))),this.safeEmit(Je.PUBLISHED_USER_LIST,t)):T.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(Ue.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof f_&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var r;return ue(r=Object.keys(Xd)).call(r,n)}))})}_handleP2PEvents(){this._gateway.signal.on(Ue.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on($t.PUBLISH,(e,t,n)=>{const{uid:r}=e;e.forEach(i=>{const{kind:a,ssrcs:c,mid:l,isMuted:u}=i;this._handleP2PAddAudioOrVideoStream(a,r,c[0].ssrcId,l);const p=this._users.find(f=>f.uid===r);return p&&this._p2pChannel instanceof Jr?this._p2pChannel.mockSubscribe(p,a,c[0].ssrcId,l).then(()=>{t()}).catch(n):t(),this._handleMuteStream(r,a,!!u)})}),this._gateway.signal.on($t.CALL,async(e,t,n)=>{if(this._p2pChannel instanceof Jr)try{var r;t(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},e))}catch(i){n(i)}}),this._gateway.signal.on(Ee.P2P_CONNECTION,async e=>{this._p2pChannel instanceof Jr&&await this._p2pChannel.p2pConnect(e)}),this._gateway.signal.on($t.UNPUBLISH,async(e,t,n)=>{if(this._p2pChannel instanceof Jr){const{unpubMsg:r,uid:i}=e,a=this._users.find(c=>c.uid===i);if(!a)return T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{r.forEach(async c=>{let{stream_type:l}=c;const u=l===ut.Audio?ye.AUDIO:ye.VIDEO;await this._p2pChannel.unsubscribe(a,u),this._handleMuteStream(i,u,!0)}),t()}catch(c){n(c)}}}),this._gateway.signal.on($t.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case Sa.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,ye.VIDEO,!0);break;case Sa.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,ye.AUDIO,!0);break;case Sa.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,ye.VIDEO,!1);break;case Sa.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,ye.AUDIO,!1)}}),this._gateway.signal.on($t.RESTART_ICE,async(e,t,n)=>{if(this._p2pChannel instanceof Jr)try{const{direction:r,iceParameter:i}=e;r!==Er.SEND_ONLY||i?t(await this._p2pChannel.restartICE(r,i)):(this._p2pChannel.handleDisconnect(r),t())}catch(r){n(r)}}),this._gateway.signal.on($t.CANDIDATE,e=>{if(this._p2pChannel instanceof Jr){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(Ne.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:r}=e;t(await this._gateway.sendExtensionMessage($t.RESTART_ICE,e,r===Er.SEND_ONLY))}catch(r){n(r)}}),this._p2pChannel.on(Ne.LocalCandidate,e=>{this._gateway.sendExtensionMessage($t.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Ne.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage($t.CONTROL,e,!0),t()}catch(r){n(r)}}),this._p2pChannel.on(Ne.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===O.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Ne.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===O.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Ne.StateChange,(e,t)=>{t===ht.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Ne.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===O.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Ne.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===O.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Ne.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(Ne.RequestRePublishDataChannel,(e,t,n)=>{ce.all(e.map(async r=>{await this._p2pChannel.publishDataChannel([r]);const i={streamId:r.id,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:r.metadata,channelId:r._originDataChannelId};try{await this._gateway.publishDataChannel(this._uid,i,!0)}catch(a){if(a.code!==O.DISCONNECT_P2P)throw a}})).then(t).catch(n)}),this._p2pChannel.on(Ne.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:r,kind:i}of e)i===ye.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");t()}catch(r){n(r)}}),this._p2pChannel.on(Ne.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Ne.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Ne.MediaReconnectStart,e=>{this.safeEmit(Je.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Ne.MediaReconnectEnd,e=>{this.safeEmit(Je.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Ne.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Ne.RequestRestartICE,async e=>{if(this._p2pChannel instanceof Jr)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(c){return void t.throw(c)}const{iceParameters:a}=function(c){const l=c.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}}(i);await t.next({remoteIceParameters:a})}),this._p2pChannel.on(Ne.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Ne.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:a}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),{dtlsParameters:c,iceParameters:l,candidates:u,rtpCapabilities:p,setup:f,cname:m}=Qk(i,a);await this._p2pChannel.connect(l,c,u,p,f,m),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Ne.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(Ne.P2PLost,()=>{this.safeEmit(Je.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Ne.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Ne.ConnectionTypeChange,e=>{this.safeEmit(Je.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Ne.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Ne.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!e)throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!e.inspectType||!Array.isArray(e.inspectType))throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const t=[...new Set(e.inspectType)];t.forEach(n=>{var r;if(!ue(r=["supervise","moderation"]).call(r,n))throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(n," is not a valid inspect type."))}),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const t=new m_(e);this._inspect=t,this.handleVideoInspectEvents(this._inspect),await t.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},sn)}catch(t){throw Array.isArray(t)?t[0]:t}}async disableContentInspect(){if(!this._inspect)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Ns(e,"enabled"),e){if(!t)throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(St(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] config.extraInfo length cannot exceed 1024 bytes"));if(t&&t.vendor&&t.vendor.length>1024)throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] config.vendor length cannot exceed 1024 bytes"));if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(t);const n=new Ky(t);this._moderation=n,this.handleImageModerationEvents(this._moderation),await n.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},sn)}catch(n){throw Array.isArray(n)?n[0]:n}}else{if(!this._moderation)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(n){throw Array.isArray(n)?n[0]:n}}}setP2PTransport(e){if(function(t){Sn(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new B(O.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,T.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}handleImageModerationEvents(e){e.on(bo.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Je.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===bi.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new B(O.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(bo.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}handleVideoInspectEvents(e){e.on(Pn.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Je.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===qi.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Je.CONTENT_INSPECT_ERROR,new B(O.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Pn.INSPECT_RESULT,(t,n)=>{var r;if((n==null?void 0:n.code)===O.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return T.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(Je.CONTENT_INSPECT_RESULT,t,n)}),e.on(Pn.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return T.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Ns(e,"enabled"),Tt("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},se(he.prototype,"leave",[vM],Object.getOwnPropertyDescriptor(he.prototype,"leave"),he.prototype),se(he.prototype,"publish",[yM],Object.getOwnPropertyDescriptor(he.prototype,"publish"),he.prototype),se(he.prototype,"unpublish",[CM],Object.getOwnPropertyDescriptor(he.prototype,"unpublish"),he.prototype),se(he.prototype,"subscribe",[RM],Object.getOwnPropertyDescriptor(he.prototype,"subscribe"),he.prototype),se(he.prototype,"presubscribe",[wM],Object.getOwnPropertyDescriptor(he.prototype,"presubscribe"),he.prototype),se(he.prototype,"massSubscribe",[IM],Object.getOwnPropertyDescriptor(he.prototype,"massSubscribe"),he.prototype),se(he.prototype,"unsubscribe",[bM],Object.getOwnPropertyDescriptor(he.prototype,"unsubscribe"),he.prototype),se(he.prototype,"massUnsubscribe",[AM],Object.getOwnPropertyDescriptor(he.prototype,"massUnsubscribe"),he.prototype),se(he.prototype,"setLowStreamParameter",[OM],Object.getOwnPropertyDescriptor(he.prototype,"setLowStreamParameter"),he.prototype),se(he.prototype,"enableDualStream",[NM],Object.getOwnPropertyDescriptor(he.prototype,"enableDualStream"),he.prototype),se(he.prototype,"disableDualStream",[DM],Object.getOwnPropertyDescriptor(he.prototype,"disableDualStream"),he.prototype),se(he.prototype,"setClientRole",[PM],Object.getOwnPropertyDescriptor(he.prototype,"setClientRole"),he.prototype),se(he.prototype,"setProxyServer",[LM],Object.getOwnPropertyDescriptor(he.prototype,"setProxyServer"),he.prototype),se(he.prototype,"setTurnServer",[kM],Object.getOwnPropertyDescriptor(he.prototype,"setTurnServer"),he.prototype),se(he.prototype,"setLicense",[MM],Object.getOwnPropertyDescriptor(he.prototype,"setLicense"),he.prototype),se(he.prototype,"startProxyServer",[xM],Object.getOwnPropertyDescriptor(he.prototype,"startProxyServer"),he.prototype),se(he.prototype,"stopProxyServer",[UM],Object.getOwnPropertyDescriptor(he.prototype,"stopProxyServer"),he.prototype),se(he.prototype,"setLocalAccessPointsV2",[jM],Object.getOwnPropertyDescriptor(he.prototype,"setLocalAccessPointsV2"),he.prototype),se(he.prototype,"setLocalAccessPoints",[VM],Object.getOwnPropertyDescriptor(he.prototype,"setLocalAccessPoints"),he.prototype),se(he.prototype,"setRemoteDefaultVideoStreamType",[FM],Object.getOwnPropertyDescriptor(he.prototype,"setRemoteDefaultVideoStreamType"),he.prototype),se(he.prototype,"setRemoteVideoStreamType",[BM],Object.getOwnPropertyDescriptor(he.prototype,"setRemoteVideoStreamType"),he.prototype),se(he.prototype,"setStreamFallbackOption",[WM],Object.getOwnPropertyDescriptor(he.prototype,"setStreamFallbackOption"),he.prototype),se(he.prototype,"setEncryptionConfig",[GM],Object.getOwnPropertyDescriptor(he.prototype,"setEncryptionConfig"),he.prototype),se(he.prototype,"renewToken",[HM],Object.getOwnPropertyDescriptor(he.prototype,"renewToken"),he.prototype),se(he.prototype,"enableAudioVolumeIndicator",[KM],Object.getOwnPropertyDescriptor(he.prototype,"enableAudioVolumeIndicator"),he.prototype),se(he.prototype,"startLiveStreaming",[zM],Object.getOwnPropertyDescriptor(he.prototype,"startLiveStreaming"),he.prototype),se(he.prototype,"setLiveTranscoding",[YM],Object.getOwnPropertyDescriptor(he.prototype,"setLiveTranscoding"),he.prototype),se(he.prototype,"stopLiveStreaming",[qM],Object.getOwnPropertyDescriptor(he.prototype,"stopLiveStreaming"),he.prototype),se(he.prototype,"addInjectStreamUrl",[JM],Object.getOwnPropertyDescriptor(he.prototype,"addInjectStreamUrl"),he.prototype),se(he.prototype,"removeInjectStreamUrl",[XM],Object.getOwnPropertyDescriptor(he.prototype,"removeInjectStreamUrl"),he.prototype),se(he.prototype,"startChannelMediaRelay",[QM],Object.getOwnPropertyDescriptor(he.prototype,"startChannelMediaRelay"),he.prototype),se(he.prototype,"updateChannelMediaRelay",[ZM],Object.getOwnPropertyDescriptor(he.prototype,"updateChannelMediaRelay"),he.prototype),se(he.prototype,"stopChannelMediaRelay",[$M],Object.getOwnPropertyDescriptor(he.prototype,"stopChannelMediaRelay"),he.prototype),se(he.prototype,"sendCustomReportMessage",[ex],Object.getOwnPropertyDescriptor(he.prototype,"sendCustomReportMessage"),he.prototype),se(he.prototype,"pickSVCLayer",[tx],Object.getOwnPropertyDescriptor(he.prototype,"pickSVCLayer"),he.prototype),se(he.prototype,"setRTMConfig",[nx],Object.getOwnPropertyDescriptor(he.prototype,"setRTMConfig"),he.prototype),se(he.prototype,"enableContentInspect",[rx],Object.getOwnPropertyDescriptor(he.prototype,"enableContentInspect"),he.prototype),se(he.prototype,"disableContentInspect",[ix],Object.getOwnPropertyDescriptor(he.prototype,"disableContentInspect"),he.prototype),se(he.prototype,"setImageModeration",[ox],Object.getOwnPropertyDescriptor(he.prototype,"setImageModeration"),he.prototype),se(he.prototype,"setP2PTransport",[sx],Object.getOwnPropertyDescriptor(he.prototype,"setP2PTransport"),he.prototype),se(he.prototype,"getJoinChannelServiceRecords",[ax],Object.getOwnPropertyDescriptor(he.prototype,"getJoinChannelServiceRecords"),he.prototype),se(he.prototype,"setPublishAudioFilterEnabled",[cx],Object.getOwnPropertyDescriptor(he.prototype,"setPublishAudioFilterEnabled"),he.prototype),he);class Bh{constructor(t,n){w(this,"id",0),w(this,"element",void 0),w(this,"peerPair",void 0),w(this,"context",void 0),w(this,"audioPlayerElement",void 0),w(this,"audioTrack",void 0),Bh.count+=1,this.id=Bh.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(r,i)=>{const a=i==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(a),r.iceGatheringState==="complete"?r.localDescription:new ce(c=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&c(r.localDescription)}})},n=async(r,i)=>await r.setRemoteDescription(i);try{const r=await t(this.peerPair[0],"offer");await n(this.peerPair[1],r);const i=await t(this.peerPair[1],"answer");await n(this.peerPair[0],i)}catch(r){throw new B(O.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(i){throw new B(O.LOCAL_AEC_ERROR,i.toString()).print()}if(!n)throw new B(O.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=n.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){T.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var lx,v_;w(Bh,"count",0);const sQ=window.AudioContext||window.webkitAudioContext,aQ=new(lx=Oe({report:Ce}),se((v_=class{constructor(){w(this,"units",[]),w(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return T.debug("the system does not need to process local aec"),-1;this.context||(this.context=new sQ);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new Bh(e,this.context),this.units.push(t)),t.startEchoCancellation(),T.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return tt().name!==lt.SAFARI}}).prototype,"processExternalMediaAEC",[lx],Object.getOwnPropertyDescriptor(v_.prototype,"processExternalMediaAEC"),v_.prototype),v_);function ux(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function hx(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ux(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ux(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const Zy=window||document;function px(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!Zy)return;const n=fn._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=i=>{if(!(i&&i.blockedURI&&(fn.onSecurityPolicyViolation||fn.getListeners(cs.SECURITY_POLICY_VIOLATION).length>0)))return;const a=i.blockedURI;L("CSP_DETECTED_HOSTNAME_LIST").some(c=>ue(a).call(a,c))&&(fn.onSecurityPolicyViolation&&typeof fn.onSecurityPolicyViolation=="function"&&fn.onSecurityPolicyViolation(i),fn.getListeners(cs.SECURITY_POLICY_VIOLATION).length>0&&fn.safeEmit(cs.SECURITY_POLICY_VIOLATION,i))};n&&Zy.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||fn.getListeners(cs.SECURITY_POLICY_VIOLATION).length>0)&&Zy.addEventListener("securitypolicyviolation",r),fn._cspEventHandlerPointer=r}Tt("PROCESS_ID","process-".concat(Rt(8,""),"-").concat(Rt(4,""),"-").concat(Rt(4,""),"-").concat(Rt(4,""),"-").concat(Rt(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void T.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();T.debug("Loading global parameters from cache",t),Object.keys(t).forEach(r=>{if(Object.prototype.hasOwnProperty.call(_n,r)){const{value:i,expires:a}=t[r];if(a&&a<=n)return;_a[r]=i,_n[r]=i}})}catch(t){T.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(_a.AREAS)&&_a.AREAS.length>0&&pv(_a.AREAS,!0);const fx=(e,t,n)=>{T.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Tt(e,t,n)},fn=function(e){const t=new xt,n=e,r={getListeners:t.getListeners.bind(t),on:(i,a)=>(function(c,l){c===cs.SECURITY_POLICY_VIOLATION&&px(l,!0)}(i,a),t.on.bind(t)(i,a)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return hx(hx({},n),r)}({__TRACK_LIST__:El,VERSION:wi,BUILD:XT,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:fx,getParameter:L,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(r){let i;return Ze().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),i=(await r.createOffer()).sdp):i=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i}(t);if(!n)return e;t.close(),t=null,e=function(r){const i={video:[],audio:[]};return r.match(/ VP8/i)&&i.video.push("VP8"),r.match(/ VP9/i)&&i.video.push("VP9"),r.match(/ AV1/i)&&i.video.push("AV1"),r.match(/ H264/i)&&i.video.push("H264"),r.match(/ H265/i)&&i.video.push("H265"),r.match(/ opus/i)&&i.audio.push("OPUS"),r.match(/ PCMU/i)&&i.audio.push("PCMU"),r.match(/ PCMA/i)&&i.audio.push("PCMA"),r.match(/ G722/i)&&i.audio.push("G722"),i}(n)}catch(t){throw new B(O.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=Ce.reportApiInvoke(null,{name:un.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Kt.TRACER});let t=!1;try{const a=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l=window.WebSocket;t=!!(a&&c&&l),t&&jT()&&function(u){const p=tt();return!(p.name!==lt.CHROME||!p.osVersion)&&Number(p.version)<u}(75)&&new a().close()}catch(a){return T.error("check system requirement failed: ",a),!1}let n=!1;const r=tt();r.name===lt.CHROME&&Number(r.version)>=58&&(Ro.engine.name!=="WebKit"||function(){const a=tt();if(tm()){if(a.os===yn.MAC_OS)return!0;if(a.os===yn.IOS){const c=Ro.os.version&&Ro.os.version.split(".");if(c&&Number(c[0])===14&&c[1]&&Number(c[1])>=3||c&&Number(c[0])>14)return!0}}return!1}())&&(n=!0),(r.name===lt.FIREFOX&&Number(r.version)>=56||r.name===lt.OPERA&&Number(r.version)>=45||r.name===lt.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(Xn()||zi())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||QN()||tt().name===lt.QQ)&&(n=!0),T.debug("checkSystemRequirements, api:",t,"browser",n);const i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return hi.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return hi.getRecordingDevices(e)},getCameras:function(e){return hi.getCamerasDevices(e)},getElectronScreenSources:BP,getPlaybackDevices:function(e){return hi.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Ce.reportApiInvoke(null,{name:un.CREATE_CLIENT,options:[t],tag:Kt.TRACER});try{(function(r){Sn(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Sn(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&Sn(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&Mn(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&a1(r.turnServer),r.httpRetryConfig!==void 0&&s1(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&s1(r.websocketRetryConfig)})(t)}catch(r){throw n.onError(r),r}return(KN(16,0)||zN(16,0))&&(t.codec==="vp9"&&(t.codec="vp8",T.debug("browser not support vp9, force use vp8")),Tt("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),n.onSuccess(),new oQ(Li(Li({forceWaitGatewayResponse:!0},t),{},{role:ue(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=L("CAMERA_CAPTURE_CONFIG"),n=Ce.reportApiInvoke(null,{tag:Kt.TRACER,name:un.CREATE_CAM_VIDEO_TRACK,options:[Ut({},e),t]});t&&(e.encoderConfig=t);const r=Ym(e),i=Rt(8,"track-cam-");let a=null;const c=e.encoderConfig==="720p_auto";T.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{a=(await ui({video:r},i)).getVideoTracks()[0]||null}catch(u){throw n.onError(u),u}if(!a){const u=new J(O.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(u),u.throw(T)}e.optimizationMode&&vy(i,a,e,fs(e.encoderConfig));const l=new Ty(a,e,r,e.scalabiltyMode?Gm(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return c&&l.startMonitorStats(),n.onSuccess(l.getTrackId()),T.info("create camera video success, trackId:",i),l},createCustomVideoTrack:function(e){const t=Ce.reportApiInvoke(null,{tag:Kt.TRACER,name:un.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new wt(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Gm(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,Rt(8,"track-cus-"),[Ot.CUSTOM_TRACK]);return t.onSuccess(n.getTrackId()),T.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=Ce.reportApiInvoke(null,{tag:Kt.TRACER,name:un.CREATE_SCREEN_VIDEO_TRACK,options:[Ut({},e),t]}),r=e.encoderConfig==="720p_auto";e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const i=function(m){const E={};m.screenSourceType&&(E.mediaSource=m.screenSourceType),m.extensionId&&ha()&&(E.extensionId=m.extensionId);const{displaySurface:S,selfBrowserSurface:I,surfaceSwitching:v,systemAudio:y}=m;(xT(107)||GN(107)||YN(93))&&(S&&(Sn(S,"displaySurface",["browser","window","monitor"]),E.displaySurface=S),I?(Sn(I,"selfBrowserSurface",["exclude","include"]),E.selfBrowserSurface=I):E.selfBrowserSurface="include",v&&(Sn(v,"surfaceSwitching",["exclude","include"]),E.surfaceSwitching=v)),(xT(105)||GN(105)||YN(91))&&y&&(Sn(y,"systemAudio",["exclude","include"]),E.systemAudio=y),m.electronScreenSourceId&&(E.sourceId=m.electronScreenSourceId);const b=m.encoderConfig?dy(m.encoderConfig):null;return E.mandatory={chromeMediaSource:"desktop",maxWidth:b?b.width:void 0,maxHeight:b?b.height:void 0},b&&(b.frameRate&&(typeof b.frameRate=="number"?(E.mandatory.maxFrameRate=b.frameRate,E.mandatory.minFrameRate=b.frameRate):(E.mandatory.maxFrameRate=b.frameRate.max||b.frameRate.ideal||b.frameRate.exact||void 0,E.mandatory.minFrameRate=b.frameRate.min||b.frameRate.ideal||b.frameRate.exact||void 0),E.frameRate=b.frameRate),b.width&&(E.width=b.width),b.height&&(E.height=b.height)),E}(e),a=Rt(8,"track-scr-v-");let c=null,l=null;const u=Ze();if(!u.supportShareAudio&&t==="enable"){const m=new J(O.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(m),m.throw(T)}T.info("start create screen video track with config",e,"withAudio",t,"trackId",a);try{const m=await ui({screen:i,screenAudio:t==="auto"?u.supportShareAudio:t==="enable"},a);c=m.getVideoTracks()[0]||null,l=m.getAudioTracks()[0]||null}catch(m){throw n.onError(m),m}if(!c){const m=new J(O.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(m),m.throw(T)}if(!l&&t==="enable"){c&&c.stop();const m=new J(O.SHARE_AUDIO_NOT_ALLOWED);return n.onError(m),m.throw(T)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(vy(a,c,e,e.encoderConfig&&dy(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const p=new wt(c,e.encoderConfig?dy(e.encoderConfig):{},e.scalabiltyMode?Gm(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,a,[Ot.SCREEN_TRACK]);if(r&&p.startMonitorStats(),!l)return n.onSuccess(p.getTrackId()),T.info("create screen video track success","video:",p.getTrackId()),p;const f=new qt(l,void 0,Rt(8,"track-scr-a-"),!1);return n.onSuccess([p.getTrackId(),f.getTrackId()]),T.info("create screen video track success","video:",p.getTrackId(),"audio:",f.getTrackId()),[p,f]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=L("CAMERA_CAPTURE_CONFIG"),r=Ce.reportApiInvoke(null,{tag:Kt.TRACER,name:un.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const i=t.encoderConfig==="720p_auto",a=Ym(t),c=QP(e),l=Rt(8,"track-mic-"),u=Rt(8,"track-cam-");let p=null,f=null;T.info("start create camera video track(".concat(u,") and microphone audio track(").concat(l,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const S=await ui({audio:c,video:a},"".concat(l,"-").concat(u));p=S.getAudioTracks()[0],f=S.getVideoTracks()[0]}catch(S){throw r.onError(S),S}if(!p||!f){const S=new J(O.UNEXPECTED_ERROR,"can not find tracks in media stream");return r.onError(S),S.throw(T)}t.optimizationMode&&vy(u,f,t,fs(t.encoderConfig));const m=new qm(p,e,c,l),E=new Ty(f,t,a,t.scalabiltyMode?Gm(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,u);return i&&E.startMonitorStats(),r.onSuccess([m.getTrackId(),E.getTrackId()]),T.info("create camera video track(".concat(u,") and microphone audio track(").concat(l,") success")),[m,E]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Ce.reportApiInvoke(null,{tag:Kt.TRACER,name:un.CREATE_MIC_AUDIO_TRACK,options:[e]}),n=QP(e),r=Rt(8,"track-mic-");let i=null;T.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{i=(await ui({audio:n},r)).getAudioTracks()[0]||null}catch(c){throw t.onError(c),c}if(!i){const c=new J(O.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(c),c.throw(T)}const a=new qm(i,e,n,r);return t.onSuccess(a.getTrackId()),T.info("create microphone audio track success, trackId:",r),a},createCustomAudioTrack:function(e){const t=Ce.reportApiInvoke(null,{tag:Kt.TRACER,name:un.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new qt(e.mediaStreamTrack,e.encoderConfig?Hm(e.encoderConfig):{},Rt(8,"track-cus-"),!1);return T.info("create custom audio track success with config",e,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:r}=e;let{source:i}=e;const a={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":i,cacheOnlineFile:n,encoderConfig:r},c=Ce.reportApiInvoke(null,{tag:Kt.TRACER,name:un.CREATE_BUFFER_AUDIO_TRACK,options:[a]});if(L("DISABLE_WEBAUDIO"))throw new J(O.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const l=Rt(8,"track-buf-");T.info("start create buffer source audio track with config",JSON.stringify(a),"trackId",l);const u=i;if(!(i instanceof AudioBuffer))try{i=await async function(m,E){let S=null;if(typeof m=="string"){const v=UL.get(m);if(v)return T.debug("use cached audio resource: ",m),v;try{S=(await wo(()=>Rr.get(m,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(y){throw new J(O.FETCH_AUDIO_FILE_FAILED,y.toString())}}else S=await new ce((y,b)=>{const D=new FileReader;D.onload=U=>{U.target?y(U.target.result):b(new J(O.READ_LOCAL_AUDIO_FILE_ERROR))},D.onerror=()=>{b(new J(O.READ_LOCAL_AUDIO_FILE_ERROR))},D.readAsArrayBuffer(m)});const I=await function(v){const y=yl();return new ce((b,D)=>{y.decodeAudioData(v,U=>{b(U)},U=>{D(new J(O.DECODE_AUDIO_FILE_FAILED,U.toString()))})})}(S);return typeof m=="string"&&E&&UL.set(m,I),I}(i,n)}catch(m){return c.onError(m),m.throw(T)}const p=new tX(i),f=new eX(u,p,r?Hm(r):{},l);return T.info("create buffer source audio track success, trackId:",l),c.onSuccess(f.getTrackId()),f},setAppType:function(e){if(T.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw T.debug("Invalid appType"),new B(O.INVALID_PARAMS,"invalid app type",e);Tt("APP_TYPE",Math.floor(e))},setLogLevel:function(e){T.setLogLevel(e)},enableLogUpload:function(){L("USE_NEW_LOG")?Tt("UPLOAD_LOG",!0):T.enableLogUpload()},disableLogUpload:function(){L("USE_NEW_LOG")?Tt("UPLOAD_LOG",!1):T.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new y2},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Ce.reportApiInvoke(null,{tag:Kt.TRACER,name:un.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof qt||e instanceof wl)){const u=new B(O.INVALID_TRACK,"the parameter is not a audio track");return n.onError(u),u.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof qt?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let a=i,c=i;const l=Date.now();return new ce(u=>{const p=setInterval(()=>{const f=e.getVolumeLevel();a=f>a?f:a,c=f<c?f:c;const m=a-c>1e-4,E=Date.now()-l;if(m||E>t){clearInterval(p);const S=m,I={duration:E,deviceLabel:r,maxVolumeLevel:a,result:S};T.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(I))),n.onSuccess(I),u(S)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Ce.reportApiInvoke(null,{tag:Kt.TRACER,name:un.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof wt||e instanceof Rl)){const m=new B(O.INVALID_TRACK,"the parameter is not a video track");return n.onError(m),m.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof wt?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),a=document.createElement("video");a.style.width="1px",a.style.height="1px",a.setAttribute("muted",""),a.muted=!0,a.setAttribute("playsinline",""),a.controls=!1,(Cn()||tm())&&(a.style.opacity="0.01",a.style.position="fixed",a.style.left="0",a.style.top="0",document.body.appendChild(a)),a.srcObject=new MediaStream([i]),a.play();const c=document.createElement("canvas");c.width=160,c.height=120;let l=0,u=0;try{const m=Date.now();l=await function(E,S,I,v){let y,b=0,D=null;return new ce((U,F)=>{function W(){b>v&&y&&(y(),U(b));const q=I.getContext("2d");if(!q){const ne=new B(O.UNEXPECTED_ERROR,"can not get canvas 2d context.");return T.error(ne.toString()),void F(ne)}q.drawImage(E,0,0,160,120);const Q=q.getImageData(0,0,I.width,I.height),ee=Math.floor(Q.data.length/3);if(D){for(let ne=0;ne<ee;ne+=3)if(Q.data[ne]!==D[ne])return b+=1,void(D=Q.data);D=Q.data}else D=Q.data}setTimeout(()=>{y&&(y(),U(b))},S),y=fy(()=>{W()},30)})}(a,t,c,4),u=Date.now()-m}catch(m){throw n.onError(m),m}tQ===lt.SAFARI&&(a.pause(),a.remove()),a.srcObject=null;const p=l>4,f={duration:u,changedPicNum:l,deviceLabel:r,result:p};return T.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(f))),n.onSuccess(f),p},setArea:pv,audioElementPlayCenter:Ir,resumeAudioContext:function(){Ir.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){aQ.processExternalMediaAEC(e)},registerExtensions:function(e){const t=L("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!ue(t).call(t,n.name)&&t.push(n.name);const r=n;r.__registered__=!0,r.logger.hookLog=T.extLog,r.reporter.hookApiInvoke=Ce.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(i=>{r.parameters[i]=L(i)})}),fx("PLUGIN_INFO",t)},ChannelMediaRelayError:$d,ChannelMediaRelayEvent:Ps,ChannelMediaRelayState:Pr,RemoteStreamFallbackType:YJ,RemoteStreamType:zJ,ConnectionDisconnectedReason:qe,AudienceLatencyLevelType:oz,AREAS:ot,preload:async function(e,t,n,r){return fM(e,t,n,r)}});return Object.defineProperties(fn,{onAudioAutoplayFailed:{get:()=>pi.onAudioAutoplayFailed,set:e=>{pi.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>pi.onAutoplayFailed,set:e=>{pi.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>fn._onSecurityPolicyViolation,set(e){fn._onSecurityPolicyViolation=e,px(e)}},__CLIENT_LIST__:{get:()=>L("SHOW_GLOBAL_CLIENT_LIST")?Ea:[]}}),hi.on(Gc.CAMERA_DEVICE_CHANGED,e=>{T.info("camera device changed",JSON.stringify(e)),fn.onCameraChanged&&fn.onCameraChanged(e),fn.safeEmit(cs.CAMERA_CHANGED,e)}),hi.on(Gc.RECORDING_DEVICE_CHANGED,e=>{T.info("microphone device changed",JSON.stringify(e)),fn.onMicrophoneChanged&&fn.onMicrophoneChanged(e),fn.safeEmit(cs.MICROPHONE_CHANGED,e)}),hi.on(Gc.PLAYOUT_DEVICE_CHANGED,e=>{T.debug("playout device changed",JSON.stringify(e)),fn.onPlaybackDeviceChanged&&fn.onPlaybackDeviceChanged(e),fn.safeEmit(cs.PLAYBACK_DEVICE_CHANGED,e)}),Ir.onAutoplayFailed=()=>{T.info("detect audio element autoplay failed"),pi.onAudioAutoplayFailed&&pi.onAudioAutoplayFailed()},Et.on("autoplay-failed",()=>{T.info("detect webaudio autoplay failed"),pi.onAudioAutoplayFailed&&pi.onAudioAutoplayFailed(),fn.safeEmit(cs.AUTOPLAY_FAILED)}),Et.on(xn.STATE_CHANGE,(e,t)=>{T.info("audio context state changed: ".concat(t," => ").concat(e)),fn.onAudioContextStateChanged&&fn.onAudioContextStateChanged(e,t),fn.safeEmit(cs.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),zt.on(Rc.NETWORK_STATE_CHANGE,(e,t)=>{T.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=fn),fn})})(O5);var P5=O5.exports;const Jl=U0(P5),Vee=()=>{const o=hc(),{cameraData:s}=o.state||{},d=To();console.log("Camera:",s),console.log("Camera ID:",s.id);const[h,_]=ve.useState({localAudioTrack:null,localVideoTrack:null,client:null}),g=ve.useRef(null),C="fa3a10495b62421c8f7179b868b65feb",A="007eJxTYDhbFWx+TO/u7KX/3y5KPtm5QfHIs21Kqtx6i91fsy1UmvVWgSEt0TjR0MDE0jTJzMjEyDDZIs3c0NwyycLMIsnMNC016ab/wrSGQEaGRd8XMjBCIYjPxpCUWJmbWMHAAAAfUyJv",P="baymax";console.log("APP_ID:",C),console.log("TOKEN:",A),console.log("CHANNEL:",P);const M=()=>{let G=localStorage.getItem("uid");if(!G){let Z=localStorage.getItem("lastUID");Z=Z?parseInt(Z)+1:1,G=Z.toString().padStart(5,"0"),localStorage.setItem("uid",G),localStorage.setItem("lastUID",Z)}return G},V=async()=>{const G=M(),Z=Jl.createClient({mode:"live",codec:"vp8",clientRoleOptions:{level:Jl.AudienceLatencyLevelType.AUDIENCE_LEVEL_LOW_LATENCY}});try{Z.setClientRole("host"),console.log("APP_ID",C,"CHANNEL",P),await Z.join(C,P,A,G);const z=await Jl.createMicrophoneAudioTrack(),$=await Jl.createCameraVideoTrack();await Z.publish([z,$]),g.current&&(g.current.innerHTML=""),$.play(g.current),remoteAudioTrack.play(),console.log("Host joined successfully with UID:",G),_({client:Z,localAudioTrack:z,localVideoTrack:$})}catch(z){console.error("Failed to join as host:",z)}},j=async()=>{const{client:G,localAudioTrack:Z,localVideoTrack:z}=h;try{Z&&Z.close(),z&&z.close();const $=document.getElementById(M());$&&$.remove(),G&&G.remoteUsers&&G.remoteUsers.forEach(pe=>{const K=document.getElementById(pe.uid);K&&K.remove()}),G&&await G.leave(),console.log("Stream ended successfully!")}catch($){console.error("Failed to end the stream:",$)}finally{window.location.href="/camera-home"}};return N.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-base-100 font-ubuntu",children:N.jsxs("div",{className:"relative w-full max-w-4xl p-8 bg-white rounded-lg shadow-lg",children:[N.jsx("button",{className:"absolute top-4 left-4 text-gray-700 p-4",onClick:()=>d("/camera-home"),children:N.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:N.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),N.jsxs("div",{className:"text-center",children:[N.jsx("img",{className:"mx-auto h-24 w-auto",src:"/logo.png",alt:"Logo"}),N.jsx("h2",{className:"mt-6 text-2xl font-extrabold text-gray-900",children:s.camera_name||"Main Door Camera"})]}),N.jsx("div",{className:"mt-8 bg-gray-200 rounded-lg w-full aspect-video flex items-center justify-center",ref:g,children:N.jsx("p",{className:"text-gray-500",children:"Video Player"})}),N.jsxs("div",{className:"mt-8 flex justify-between",children:[N.jsx("button",{className:"px-10 py-2 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75",onClick:V,children:"Watch Live"}),N.jsx("button",{className:"px-10 py-2 bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-75",onClick:j,children:"Leave"})]})]})})};var L5={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},kU=qs.createContext&&qs.createContext(L5),Fee=["attr","size","title"];function Bee(o,s){if(o==null)return{};var d=Wee(o,s),h,_;if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);for(_=0;_<g.length;_++)h=g[_],!(s.indexOf(h)>=0)&&Object.prototype.propertyIsEnumerable.call(o,h)&&(d[h]=o[h])}return d}function Wee(o,s){if(o==null)return{};var d={};for(var h in o)if(Object.prototype.hasOwnProperty.call(o,h)){if(s.indexOf(h)>=0)continue;d[h]=o[h]}return d}function PE(){return PE=Object.assign?Object.assign.bind():function(o){for(var s=1;s<arguments.length;s++){var d=arguments[s];for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(o[h]=d[h])}return o},PE.apply(this,arguments)}function MU(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(o);s&&(h=h.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),d.push.apply(d,h)}return d}function LE(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?MU(Object(d),!0).forEach(function(h){Gee(o,h,d[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):MU(Object(d)).forEach(function(h){Object.defineProperty(o,h,Object.getOwnPropertyDescriptor(d,h))})}return o}function Gee(o,s,d){return s=Hee(s),s in o?Object.defineProperty(o,s,{value:d,enumerable:!0,configurable:!0,writable:!0}):o[s]=d,o}function Hee(o){var s=Kee(o,"string");return typeof s=="symbol"?s:s+""}function Kee(o,s){if(typeof o!="object"||!o)return o;var d=o[Symbol.toPrimitive];if(d!==void 0){var h=d.call(o,s||"default");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(o)}function k5(o){return o&&o.map((s,d)=>qs.createElement(s.tag,LE({key:d},s.attr),k5(s.child)))}function mu(o){return s=>qs.createElement(zee,PE({attr:LE({},o.attr)},s),k5(o.child))}function zee(o){var s=d=>{var{attr:h,size:_,title:g}=o,C=Bee(o,Fee),A=_||d.size||"1em",P;return d.className&&(P=d.className),o.className&&(P=(P?P+" ":"")+o.className),qs.createElement("svg",PE({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},d.attr,h,C,{className:P,style:LE(LE({color:o.color||d.color},d.style),o.style),height:A,width:A,xmlns:"http://www.w3.org/2000/svg"}),g&&qs.createElement("title",null,g),o.children)};return kU!==void 0?qs.createElement(kU.Consumer,null,d=>s(d)):s(L5)}function Yee(o){return mu({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M332.8 320h38.4c6.4 0 12.8-6.4 12.8-12.8V172.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v134.4c0 6.4 6.4 12.8 12.8 12.8zm96 0h38.4c6.4 0 12.8-6.4 12.8-12.8V76.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v230.4c0 6.4 6.4 12.8 12.8 12.8zm-288 0h38.4c6.4 0 12.8-6.4 12.8-12.8v-70.4c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v70.4c0 6.4 6.4 12.8 12.8 12.8zm96 0h38.4c6.4 0 12.8-6.4 12.8-12.8V108.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v198.4c0 6.4 6.4 12.8 12.8 12.8zM496 384H64V80c0-8.84-7.16-16-16-16H16C7.16 64 0 71.16 0 80v336c0 17.67 14.33 32 32 32h464c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16z"},child:[]}]})(o)}function M5(o){return mu({tag:"svg",attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"},child:[]}]})(o)}function qee(o){return mu({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(o)}function Jee(o){return mu({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 255.531c.253 136.64-111.18 248.372-247.82 248.468-59.015.042-113.223-20.53-155.822-54.911-11.077-8.94-11.905-25.541-1.839-35.607l11.267-11.267c8.609-8.609 22.353-9.551 31.891-1.984C173.062 425.135 212.781 440 256 440c101.705 0 184-82.311 184-184 0-101.705-82.311-184-184-184-48.814 0-93.149 18.969-126.068 49.932l50.754 50.754c10.08 10.08 2.941 27.314-11.313 27.314H24c-8.837 0-16-7.163-16-16V38.627c0-14.254 17.234-21.393 27.314-11.314l49.372 49.372C129.209 34.136 189.552 8 256 8c136.81 0 247.747 110.78 248 247.531zm-180.912 78.784l9.823-12.63c8.138-10.463 6.253-25.542-4.21-33.679L288 256.349V152c0-13.255-10.745-24-24-24h-16c-13.255 0-24 10.745-24 24v135.651l65.409 50.874c10.463 8.137 25.541 6.253 33.679-4.21z"},child:[]}]})(o)}function Xee(o){return mu({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"},child:[]}]})(o)}function Qee(o){return mu({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(o)}const _u=()=>N.jsxs("div",{className:"w-full fixed bottom-0 left-0 right-0 bg-base-100 shadow-lg p-4 flex justify-around rounded-t-lg",children:[N.jsx(W_,{icon:N.jsx(Xee,{}),label:"Home",to:"/user-home"}),N.jsx(W_,{icon:N.jsx(Jee,{}),label:"History",to:"/histories"}),N.jsx(W_,{icon:N.jsx(Yee,{}),label:"Statistics"}),N.jsx(W_,{icon:N.jsx(Qee,{}),label:"Profile",to:"/profile"})]}),W_=({icon:o,label:s,to:d})=>N.jsxs(ad,{to:d,className:"flex flex-col items-center",children:[N.jsx("div",{className:"text-2xl text-primary mb-1",children:o}),N.jsx("span",{className:" font-lato text-primary font-bold text-xs",children:s})]});var w0={exports:{}},md={},x5={exports:{}},Zee="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",$ee=Zee,ete=$ee;function U5(){}function j5(){}j5.resetWarningCache=U5;var tte=function(){function o(h,_,g,C,A,P){if(P!==ete){var M=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw M.name="Invariant Violation",M}}o.isRequired=o;function s(){return o}var d={array:o,bigint:o,bool:o,func:o,number:o,object:o,string:o,symbol:o,any:o,arrayOf:s,element:o,elementType:o,instanceOf:s,node:o,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:j5,resetWarningCache:U5};return d.PropTypes=d,d};x5.exports=tte();var V5=x5.exports,I0={exports:{}},qo={},b0={exports:{}};(function(o,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=V;/*!
 * Adapted from jQuery UI core
 *
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/category/ui-core/
 */var d="none",h="contents",_=/input|select|textarea|button|object|iframe/;function g(j,G){return G.getPropertyValue("overflow")!=="visible"||j.scrollWidth<=0&&j.scrollHeight<=0}function C(j){var G=j.offsetWidth<=0&&j.offsetHeight<=0;if(G&&!j.innerHTML)return!0;try{var Z=window.getComputedStyle(j),z=Z.getPropertyValue("display");return G?z!==h&&g(j,Z):z===d}catch{return console.warn("Failed to inspect element style"),!1}}function A(j){for(var G=j,Z=j.getRootNode&&j.getRootNode();G&&G!==document.body;){if(Z&&G===Z&&(G=Z.host.parentNode),C(G))return!1;G=G.parentNode}return!0}function P(j,G){var Z=j.nodeName.toLowerCase(),z=_.test(Z)&&!j.disabled||Z==="a"&&j.href||G;return z&&A(j)}function M(j){var G=j.getAttribute("tabindex");G===null&&(G=void 0);var Z=isNaN(G);return(Z||G>=0)&&P(j,!Z)}function V(j){var G=[].slice.call(j.querySelectorAll("*"),0).reduce(function(Z,z){return Z.concat(z.shadowRoot?V(z.shadowRoot):[z])},[]);return G.filter(M)}o.exports=s.default})(b0,b0.exports);var F5=b0.exports;Object.defineProperty(qo,"__esModule",{value:!0});qo.resetState=ote;qo.log=ste;qo.handleBlur=Lp;qo.handleFocus=kp;qo.markForFocusLater=ate;qo.returnFocus=cte;qo.popWithoutFocus=dte;qo.setupScopedFocus=lte;qo.teardownScopedFocus=ute;var nte=F5,rte=ite(nte);function ite(o){return o&&o.__esModule?o:{default:o}}var lu=[],Xl=null,A0=!1;function ote(){lu=[]}function ste(){}function Lp(){A0=!0}function kp(){if(A0){if(A0=!1,!Xl)return;setTimeout(function(){if(!Xl.contains(document.activeElement)){var o=(0,rte.default)(Xl)[0]||Xl;o.focus()}},0)}}function ate(){lu.push(document.activeElement)}function cte(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,s=null;try{lu.length!==0&&(s=lu.pop(),s.focus({preventScroll:o}));return}catch{console.warn(["You tried to return focus to",s,"but it is not in the DOM anymore"].join(" "))}}function dte(){lu.length>0&&lu.pop()}function lte(o){Xl=o,window.addEventListener?(window.addEventListener("blur",Lp,!1),document.addEventListener("focus",kp,!0)):(window.attachEvent("onBlur",Lp),document.attachEvent("onFocus",kp))}function ute(){Xl=null,window.addEventListener?(window.removeEventListener("blur",Lp),document.removeEventListener("focus",kp)):(window.detachEvent("onBlur",Lp),document.detachEvent("onFocus",kp))}var O0={exports:{}};(function(o,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=C;var d=F5,h=_(d);function _(A){return A&&A.__esModule?A:{default:A}}function g(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document;return A.activeElement.shadowRoot?g(A.activeElement.shadowRoot):A.activeElement}function C(A,P){var M=(0,h.default)(A);if(!M.length){P.preventDefault();return}var V=void 0,j=P.shiftKey,G=M[0],Z=M[M.length-1],z=g();if(A===z){if(!j)return;V=Z}if(Z===z&&!j&&(V=G),G===z&&j&&(V=Z),V){P.preventDefault(),V.focus();return}var $=/(\bChrome\b|\bSafari\b)\//.exec(navigator.userAgent),pe=$!=null&&$[1]!="Chrome"&&/\biPod\b|\biPad\b/g.exec(navigator.userAgent)==null;if(pe){var K=M.indexOf(z);if(K>-1&&(K+=j?-1:1),V=M[K],typeof V>"u"){P.preventDefault(),V=j?Z:G,V.focus();return}P.preventDefault(),V.focus()}}o.exports=s.default})(O0,O0.exports);var hte=O0.exports,Jo={},pte=function(){},fte=pte,Ko={},B5={exports:{}};/*!
  Copyright (c) 2015 Jed Watson.
  Based on code that is Copyright 2013-2015, Facebook, Inc.
  All rights reserved.
*/(function(o){(function(){var s=!!(typeof window<"u"&&window.document&&window.document.createElement),d={canUseDOM:s,canUseWorkers:typeof Worker<"u",canUseEventListeners:s&&!!(window.addEventListener||window.attachEvent),canUseViewport:s&&!!window.screen};o.exports?o.exports=d:window.ExecutionEnvironment=d})()})(B5);var mte=B5.exports;Object.defineProperty(Ko,"__esModule",{value:!0});Ko.canUseDOM=Ko.SafeNodeList=Ko.SafeHTMLCollection=void 0;var _te=mte,Ete=gte(_te);function gte(o){return o&&o.__esModule?o:{default:o}}var ng=Ete.default,Ste=ng.canUseDOM?window.HTMLElement:{};Ko.SafeHTMLCollection=ng.canUseDOM?window.HTMLCollection:{};Ko.SafeNodeList=ng.canUseDOM?window.NodeList:{};Ko.canUseDOM=ng.canUseDOM;Ko.default=Ste;Object.defineProperty(Jo,"__esModule",{value:!0});Jo.resetState=Rte;Jo.log=wte;Jo.assertNodeList=W5;Jo.setElement=Ite;Jo.validateElement=kR;Jo.hide=bte;Jo.show=Ate;Jo.documentNotReadyOrSSRTesting=Ote;var Tte=fte,vte=Cte(Tte),yte=Ko;function Cte(o){return o&&o.__esModule?o:{default:o}}var ho=null;function Rte(){ho&&(ho.removeAttribute?ho.removeAttribute("aria-hidden"):ho.length!=null?ho.forEach(function(o){return o.removeAttribute("aria-hidden")}):document.querySelectorAll(ho).forEach(function(o){return o.removeAttribute("aria-hidden")})),ho=null}function wte(){}function W5(o,s){if(!o||!o.length)throw new Error("react-modal: No elements were found for selector "+s+".")}function Ite(o){var s=o;if(typeof s=="string"&&yte.canUseDOM){var d=document.querySelectorAll(s);W5(d,s),s=d}return ho=s||ho,ho}function kR(o){var s=o||ho;return s?Array.isArray(s)||s instanceof HTMLCollection||s instanceof NodeList?s:[s]:((0,vte.default)(!1,["react-modal: App element is not defined.","Please use `Modal.setAppElement(el)` or set `appElement={el}`.","This is needed so screen readers don't see main content","when modal is opened. It is not recommended, but you can opt-out","by setting `ariaHideApp={false}`."].join(" ")),[])}function bte(o){var s=!0,d=!1,h=void 0;try{for(var _=kR(o)[Symbol.iterator](),g;!(s=(g=_.next()).done);s=!0){var C=g.value;C.setAttribute("aria-hidden","true")}}catch(A){d=!0,h=A}finally{try{!s&&_.return&&_.return()}finally{if(d)throw h}}}function Ate(o){var s=!0,d=!1,h=void 0;try{for(var _=kR(o)[Symbol.iterator](),g;!(s=(g=_.next()).done);s=!0){var C=g.value;C.removeAttribute("aria-hidden")}}catch(A){d=!0,h=A}finally{try{!s&&_.return&&_.return()}finally{if(d)throw h}}}function Ote(){ho=null}var Eu={};Object.defineProperty(Eu,"__esModule",{value:!0});Eu.resetState=Nte;Eu.log=Dte;var hp={},pp={};function xU(o,s){o.classList.remove(s)}function Nte(){var o=document.getElementsByTagName("html")[0];for(var s in hp)xU(o,hp[s]);var d=document.body;for(var h in pp)xU(d,pp[h]);hp={},pp={}}function Dte(){}var Pte=function(s,d){return s[d]||(s[d]=0),s[d]+=1,d},Lte=function(s,d){return s[d]&&(s[d]-=1),d},kte=function(s,d,h){h.forEach(function(_){Pte(d,_),s.add(_)})},Mte=function(s,d,h){h.forEach(function(_){Lte(d,_),d[_]===0&&s.remove(_)})};Eu.add=function(s,d){return kte(s.classList,s.nodeName.toLowerCase()=="html"?hp:pp,d.split(" "))};Eu.remove=function(s,d){return Mte(s.classList,s.nodeName.toLowerCase()=="html"?hp:pp,d.split(" "))};var gu={};Object.defineProperty(gu,"__esModule",{value:!0});gu.log=Ute;gu.resetState=jte;function xte(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}var G5=function o(){var s=this;xte(this,o),this.register=function(d){s.openInstances.indexOf(d)===-1&&(s.openInstances.push(d),s.emit("register"))},this.deregister=function(d){var h=s.openInstances.indexOf(d);h!==-1&&(s.openInstances.splice(h,1),s.emit("deregister"))},this.subscribe=function(d){s.subscribers.push(d)},this.emit=function(d){s.subscribers.forEach(function(h){return h(d,s.openInstances.slice())})},this.openInstances=[],this.subscribers=[]},kE=new G5;function Ute(){console.log("portalOpenInstances ----------"),console.log(kE.openInstances.length),kE.openInstances.forEach(function(o){return console.log(o)}),console.log("end portalOpenInstances ----------")}function jte(){kE=new G5}gu.default=kE;var MR={};Object.defineProperty(MR,"__esModule",{value:!0});MR.resetState=Wte;MR.log=Gte;var Vte=gu,Fte=Bte(Vte);function Bte(o){return o&&o.__esModule?o:{default:o}}var Br=void 0,Fo=void 0,cd=[];function Wte(){for(var o=[Br,Fo],s=0;s<o.length;s++){var d=o[s];d&&d.parentNode&&d.parentNode.removeChild(d)}Br=Fo=null,cd=[]}function Gte(){console.log("bodyTrap ----------"),console.log(cd.length);for(var o=[Br,Fo],s=0;s<o.length;s++){var d=o[s],h=d||{};console.log(h.nodeName,h.className,h.id)}console.log("edn bodyTrap ----------")}function UU(){cd.length!==0&&cd[cd.length-1].focusContent()}function Hte(o,s){!Br&&!Fo&&(Br=document.createElement("div"),Br.setAttribute("data-react-modal-body-trap",""),Br.style.position="absolute",Br.style.opacity="0",Br.setAttribute("tabindex","0"),Br.addEventListener("focus",UU),Fo=Br.cloneNode(),Fo.addEventListener("focus",UU)),cd=s,cd.length>0?(document.body.firstChild!==Br&&document.body.insertBefore(Br,document.body.firstChild),document.body.lastChild!==Fo&&document.body.appendChild(Fo)):(Br.parentElement&&Br.parentElement.removeChild(Br),Fo.parentElement&&Fo.parentElement.removeChild(Fo))}Fte.default.subscribe(Hte);(function(o,s){Object.defineProperty(s,"__esModule",{value:!0});var d=Object.assign||function(je){for(var nt=1;nt<arguments.length;nt++){var Dt=arguments[nt];for(var fe in Dt)Object.prototype.hasOwnProperty.call(Dt,fe)&&(je[fe]=Dt[fe])}return je},h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(je){return typeof je}:function(je){return je&&typeof Symbol=="function"&&je.constructor===Symbol&&je!==Symbol.prototype?"symbol":typeof je},_=function(){function je(nt,Dt){for(var fe=0;fe<Dt.length;fe++){var ge=Dt[fe];ge.enumerable=ge.enumerable||!1,ge.configurable=!0,"value"in ge&&(ge.writable=!0),Object.defineProperty(nt,ge.key,ge)}}return function(nt,Dt,fe){return Dt&&je(nt.prototype,Dt),fe&&je(nt,fe),nt}}(),g=ve,C=V5,A=Ae(C),P=qo,M=ae(P),V=hte,j=Ae(V),G=Jo,Z=ae(G),z=Eu,$=ae(z),pe=Ko,K=Ae(pe),H=gu,Y=Ae(H);function ae(je){if(je&&je.__esModule)return je;var nt={};if(je!=null)for(var Dt in je)Object.prototype.hasOwnProperty.call(je,Dt)&&(nt[Dt]=je[Dt]);return nt.default=je,nt}function Ae(je){return je&&je.__esModule?je:{default:je}}function Le(je,nt){if(!(je instanceof nt))throw new TypeError("Cannot call a class as a function")}function Pe(je,nt){if(!je)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return nt&&(typeof nt=="object"||typeof nt=="function")?nt:je}function We(je,nt){if(typeof nt!="function"&&nt!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof nt);je.prototype=Object.create(nt&&nt.prototype,{constructor:{value:je,enumerable:!1,writable:!0,configurable:!0}}),nt&&(Object.setPrototypeOf?Object.setPrototypeOf(je,nt):je.__proto__=nt)}var Jt={overlay:"ReactModal__Overlay",content:"ReactModal__Content"},dt=function(nt){return nt.code==="Tab"||nt.keyCode===9},or=function(nt){return nt.code==="Escape"||nt.keyCode===27},Cr=0,Yn=function(je){We(nt,je);function nt(Dt){Le(this,nt);var fe=Pe(this,(nt.__proto__||Object.getPrototypeOf(nt)).call(this,Dt));return fe.setOverlayRef=function(ge){fe.overlay=ge,fe.props.overlayRef&&fe.props.overlayRef(ge)},fe.setContentRef=function(ge){fe.content=ge,fe.props.contentRef&&fe.props.contentRef(ge)},fe.afterClose=function(){var ge=fe.props,De=ge.appElement,Ke=ge.ariaHideApp,_t=ge.htmlOpenClassName,rn=ge.bodyOpenClassName,ni=ge.parentSelector,qn=ni&&ni().ownerDocument||document;rn&&$.remove(qn.body,rn),_t&&$.remove(qn.getElementsByTagName("html")[0],_t),Ke&&Cr>0&&(Cr-=1,Cr===0&&Z.show(De)),fe.props.shouldFocusAfterRender&&(fe.props.shouldReturnFocusAfterClose?(M.returnFocus(fe.props.preventScroll),M.teardownScopedFocus()):M.popWithoutFocus()),fe.props.onAfterClose&&fe.props.onAfterClose(),Y.default.deregister(fe)},fe.open=function(){fe.beforeOpen(),fe.state.afterOpen&&fe.state.beforeClose?(clearTimeout(fe.closeTimer),fe.setState({beforeClose:!1})):(fe.props.shouldFocusAfterRender&&(M.setupScopedFocus(fe.node),M.markForFocusLater()),fe.setState({isOpen:!0},function(){fe.openAnimationFrame=requestAnimationFrame(function(){fe.setState({afterOpen:!0}),fe.props.isOpen&&fe.props.onAfterOpen&&fe.props.onAfterOpen({overlayEl:fe.overlay,contentEl:fe.content})})}))},fe.close=function(){fe.props.closeTimeoutMS>0?fe.closeWithTimeout():fe.closeWithoutTimeout()},fe.focusContent=function(){return fe.content&&!fe.contentHasFocus()&&fe.content.focus({preventScroll:!0})},fe.closeWithTimeout=function(){var ge=Date.now()+fe.props.closeTimeoutMS;fe.setState({beforeClose:!0,closesAt:ge},function(){fe.closeTimer=setTimeout(fe.closeWithoutTimeout,fe.state.closesAt-Date.now())})},fe.closeWithoutTimeout=function(){fe.setState({beforeClose:!1,isOpen:!1,afterOpen:!1,closesAt:null},fe.afterClose)},fe.handleKeyDown=function(ge){dt(ge)&&(0,j.default)(fe.content,ge),fe.props.shouldCloseOnEsc&&or(ge)&&(ge.stopPropagation(),fe.requestClose(ge))},fe.handleOverlayOnClick=function(ge){fe.shouldClose===null&&(fe.shouldClose=!0),fe.shouldClose&&fe.props.shouldCloseOnOverlayClick&&(fe.ownerHandlesClose()?fe.requestClose(ge):fe.focusContent()),fe.shouldClose=null},fe.handleContentOnMouseUp=function(){fe.shouldClose=!1},fe.handleOverlayOnMouseDown=function(ge){!fe.props.shouldCloseOnOverlayClick&&ge.target==fe.overlay&&ge.preventDefault()},fe.handleContentOnClick=function(){fe.shouldClose=!1},fe.handleContentOnMouseDown=function(){fe.shouldClose=!1},fe.requestClose=function(ge){return fe.ownerHandlesClose()&&fe.props.onRequestClose(ge)},fe.ownerHandlesClose=function(){return fe.props.onRequestClose},fe.shouldBeClosed=function(){return!fe.state.isOpen&&!fe.state.beforeClose},fe.contentHasFocus=function(){return document.activeElement===fe.content||fe.content.contains(document.activeElement)},fe.buildClassName=function(ge,De){var Ke=(typeof De>"u"?"undefined":h(De))==="object"?De:{base:Jt[ge],afterOpen:Jt[ge]+"--after-open",beforeClose:Jt[ge]+"--before-close"},_t=Ke.base;return fe.state.afterOpen&&(_t=_t+" "+Ke.afterOpen),fe.state.beforeClose&&(_t=_t+" "+Ke.beforeClose),typeof De=="string"&&De?_t+" "+De:_t},fe.attributesFromObject=function(ge,De){return Object.keys(De).reduce(function(Ke,_t){return Ke[ge+"-"+_t]=De[_t],Ke},{})},fe.state={afterOpen:!1,beforeClose:!1},fe.shouldClose=null,fe.moveFromContentToOverlay=null,fe}return _(nt,[{key:"componentDidMount",value:function(){this.props.isOpen&&this.open()}},{key:"componentDidUpdate",value:function(fe,ge){this.props.isOpen&&!fe.isOpen?this.open():!this.props.isOpen&&fe.isOpen&&this.close(),this.props.shouldFocusAfterRender&&this.state.isOpen&&!ge.isOpen&&this.focusContent()}},{key:"componentWillUnmount",value:function(){this.state.isOpen&&this.afterClose(),clearTimeout(this.closeTimer),cancelAnimationFrame(this.openAnimationFrame)}},{key:"beforeOpen",value:function(){var fe=this.props,ge=fe.appElement,De=fe.ariaHideApp,Ke=fe.htmlOpenClassName,_t=fe.bodyOpenClassName,rn=fe.parentSelector,ni=rn&&rn().ownerDocument||document;_t&&$.add(ni.body,_t),Ke&&$.add(ni.getElementsByTagName("html")[0],Ke),De&&(Cr+=1,Z.hide(ge)),Y.default.register(this)}},{key:"render",value:function(){var fe=this.props,ge=fe.id,De=fe.className,Ke=fe.overlayClassName,_t=fe.defaultStyles,rn=fe.children,ni=De?{}:_t.content,qn=Ke?{}:_t.overlay;if(this.shouldBeClosed())return null;var Qo={ref:this.setOverlayRef,className:this.buildClassName("overlay",Ke),style:d({},qn,this.props.style.overlay),onClick:this.handleOverlayOnClick,onMouseDown:this.handleOverlayOnMouseDown},pr=d({id:ge,ref:this.setContentRef,style:d({},ni,this.props.style.content),className:this.buildClassName("content",De),tabIndex:"-1",onKeyDown:this.handleKeyDown,onMouseDown:this.handleContentOnMouseDown,onMouseUp:this.handleContentOnMouseUp,onClick:this.handleContentOnClick,role:this.props.role,"aria-label":this.props.contentLabel},this.attributesFromObject("aria",d({modal:!0},this.props.aria)),this.attributesFromObject("data",this.props.data||{}),{"data-testid":this.props.testId}),ta=this.props.contentElement(pr,rn);return this.props.overlayElement(Qo,ta)}}]),nt}(g.Component);Yn.defaultProps={style:{overlay:{},content:{}},defaultStyles:{}},Yn.propTypes={isOpen:A.default.bool.isRequired,defaultStyles:A.default.shape({content:A.default.object,overlay:A.default.object}),style:A.default.shape({content:A.default.object,overlay:A.default.object}),className:A.default.oneOfType([A.default.string,A.default.object]),overlayClassName:A.default.oneOfType([A.default.string,A.default.object]),parentSelector:A.default.func,bodyOpenClassName:A.default.string,htmlOpenClassName:A.default.string,ariaHideApp:A.default.bool,appElement:A.default.oneOfType([A.default.instanceOf(K.default),A.default.instanceOf(pe.SafeHTMLCollection),A.default.instanceOf(pe.SafeNodeList),A.default.arrayOf(A.default.instanceOf(K.default))]),onAfterOpen:A.default.func,onAfterClose:A.default.func,onRequestClose:A.default.func,closeTimeoutMS:A.default.number,shouldFocusAfterRender:A.default.bool,shouldCloseOnOverlayClick:A.default.bool,shouldReturnFocusAfterClose:A.default.bool,preventScroll:A.default.bool,role:A.default.string,contentLabel:A.default.string,aria:A.default.object,data:A.default.object,children:A.default.node,shouldCloseOnEsc:A.default.bool,overlayRef:A.default.func,contentRef:A.default.func,id:A.default.string,overlayElement:A.default.func,contentElement:A.default.func,testId:A.default.string},s.default=Yn,o.exports=s.default})(I0,I0.exports);var Kte=I0.exports;function H5(){var o=this.constructor.getDerivedStateFromProps(this.props,this.state);o!=null&&this.setState(o)}function K5(o){function s(d){var h=this.constructor.getDerivedStateFromProps(o,d);return h??null}this.setState(s.bind(this))}function z5(o,s){try{var d=this.props,h=this.state;this.props=o,this.state=s,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(d,h)}finally{this.props=d,this.state=h}}H5.__suppressDeprecationWarning=!0;K5.__suppressDeprecationWarning=!0;z5.__suppressDeprecationWarning=!0;function zte(o){var s=o.prototype;if(!s||!s.isReactComponent)throw new Error("Can only polyfill class components");if(typeof o.getDerivedStateFromProps!="function"&&typeof s.getSnapshotBeforeUpdate!="function")return o;var d=null,h=null,_=null;if(typeof s.componentWillMount=="function"?d="componentWillMount":typeof s.UNSAFE_componentWillMount=="function"&&(d="UNSAFE_componentWillMount"),typeof s.componentWillReceiveProps=="function"?h="componentWillReceiveProps":typeof s.UNSAFE_componentWillReceiveProps=="function"&&(h="UNSAFE_componentWillReceiveProps"),typeof s.componentWillUpdate=="function"?_="componentWillUpdate":typeof s.UNSAFE_componentWillUpdate=="function"&&(_="UNSAFE_componentWillUpdate"),d!==null||h!==null||_!==null){var g=o.displayName||o.name,C=typeof o.getDerivedStateFromProps=="function"?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error(`Unsafe legacy lifecycles will not be called for components using new component APIs.

`+g+" uses "+C+" but also contains the following legacy lifecycles:"+(d!==null?`
  `+d:"")+(h!==null?`
  `+h:"")+(_!==null?`
  `+_:"")+`

The above lifecycles should be removed. Learn more about this warning here:
https://fb.me/react-async-component-lifecycle-hooks`)}if(typeof o.getDerivedStateFromProps=="function"&&(s.componentWillMount=H5,s.componentWillReceiveProps=K5),typeof s.getSnapshotBeforeUpdate=="function"){if(typeof s.componentDidUpdate!="function")throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");s.componentWillUpdate=z5;var A=s.componentDidUpdate;s.componentDidUpdate=function(M,V,j){var G=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:j;A.call(this,M,V,G)}}return o}const Yte=Object.freeze(Object.defineProperty({__proto__:null,polyfill:zte},Symbol.toStringTag,{value:"Module"})),qte=dQ(Yte);Object.defineProperty(md,"__esModule",{value:!0});md.bodyOpenClassName=md.portalClassName=void 0;var jU=Object.assign||function(o){for(var s=1;s<arguments.length;s++){var d=arguments[s];for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(o[h]=d[h])}return o},Jte=function(){function o(s,d){for(var h=0;h<d.length;h++){var _=d[h];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(s,_.key,_)}}return function(s,d,h){return d&&o(s.prototype,d),h&&o(s,h),s}}(),Y5=ve,ME=Wp(Y5),Xte=m5,xE=Wp(Xte),Qte=V5,mt=Wp(Qte),Zte=Kte,VU=Wp(Zte),$te=Jo,ene=nne($te),Ja=Ko,FU=Wp(Ja),tne=qte;function nne(o){if(o&&o.__esModule)return o;var s={};if(o!=null)for(var d in o)Object.prototype.hasOwnProperty.call(o,d)&&(s[d]=o[d]);return s.default=o,s}function Wp(o){return o&&o.__esModule?o:{default:o}}function rne(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}function BU(o,s){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:o}function ine(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);o.prototype=Object.create(s&&s.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(o,s):o.__proto__=s)}var one=md.portalClassName="ReactModalPortal",sne=md.bodyOpenClassName="ReactModal__Body--open",td=Ja.canUseDOM&&xE.default.createPortal!==void 0,WU=function(s){return document.createElement(s)},GU=function(){return td?xE.default.createPortal:xE.default.unstable_renderSubtreeIntoContainer};function G_(o){return o()}var Gp=function(o){ine(s,o);function s(){var d,h,_,g;rne(this,s);for(var C=arguments.length,A=Array(C),P=0;P<C;P++)A[P]=arguments[P];return g=(h=(_=BU(this,(d=s.__proto__||Object.getPrototypeOf(s)).call.apply(d,[this].concat(A))),_),_.removePortal=function(){!td&&xE.default.unmountComponentAtNode(_.node);var M=G_(_.props.parentSelector);M&&M.contains(_.node)?M.removeChild(_.node):console.warn('React-Modal: "parentSelector" prop did not returned any DOM element. Make sure that the parent element is unmounted to avoid any memory leaks.')},_.portalRef=function(M){_.portal=M},_.renderPortal=function(M){var V=GU(),j=V(_,ME.default.createElement(VU.default,jU({defaultStyles:s.defaultStyles},M)),_.node);_.portalRef(j)},h),BU(_,g)}return Jte(s,[{key:"componentDidMount",value:function(){if(Ja.canUseDOM){td||(this.node=WU("div")),this.node.className=this.props.portalClassName;var h=G_(this.props.parentSelector);h.appendChild(this.node),!td&&this.renderPortal(this.props)}}},{key:"getSnapshotBeforeUpdate",value:function(h){var _=G_(h.parentSelector),g=G_(this.props.parentSelector);return{prevParent:_,nextParent:g}}},{key:"componentDidUpdate",value:function(h,_,g){if(Ja.canUseDOM){var C=this.props,A=C.isOpen,P=C.portalClassName;h.portalClassName!==P&&(this.node.className=P);var M=g.prevParent,V=g.nextParent;V!==M&&(M.removeChild(this.node),V.appendChild(this.node)),!(!h.isOpen&&!A)&&!td&&this.renderPortal(this.props)}}},{key:"componentWillUnmount",value:function(){if(!(!Ja.canUseDOM||!this.node||!this.portal)){var h=this.portal.state,_=Date.now(),g=h.isOpen&&this.props.closeTimeoutMS&&(h.closesAt||_+this.props.closeTimeoutMS);g?(h.beforeClose||this.portal.closeWithTimeout(),setTimeout(this.removePortal,g-_)):this.removePortal()}}},{key:"render",value:function(){if(!Ja.canUseDOM||!td)return null;!this.node&&td&&(this.node=WU("div"));var h=GU();return h(ME.default.createElement(VU.default,jU({ref:this.portalRef,defaultStyles:s.defaultStyles},this.props)),this.node)}}],[{key:"setAppElement",value:function(h){ene.setElement(h)}}]),s}(Y5.Component);Gp.propTypes={isOpen:mt.default.bool.isRequired,style:mt.default.shape({content:mt.default.object,overlay:mt.default.object}),portalClassName:mt.default.string,bodyOpenClassName:mt.default.string,htmlOpenClassName:mt.default.string,className:mt.default.oneOfType([mt.default.string,mt.default.shape({base:mt.default.string.isRequired,afterOpen:mt.default.string.isRequired,beforeClose:mt.default.string.isRequired})]),overlayClassName:mt.default.oneOfType([mt.default.string,mt.default.shape({base:mt.default.string.isRequired,afterOpen:mt.default.string.isRequired,beforeClose:mt.default.string.isRequired})]),appElement:mt.default.oneOfType([mt.default.instanceOf(FU.default),mt.default.instanceOf(Ja.SafeHTMLCollection),mt.default.instanceOf(Ja.SafeNodeList),mt.default.arrayOf(mt.default.instanceOf(FU.default))]),onAfterOpen:mt.default.func,onRequestClose:mt.default.func,closeTimeoutMS:mt.default.number,ariaHideApp:mt.default.bool,shouldFocusAfterRender:mt.default.bool,shouldCloseOnOverlayClick:mt.default.bool,shouldReturnFocusAfterClose:mt.default.bool,preventScroll:mt.default.bool,parentSelector:mt.default.func,aria:mt.default.object,data:mt.default.object,role:mt.default.string,contentLabel:mt.default.string,shouldCloseOnEsc:mt.default.bool,overlayRef:mt.default.func,contentRef:mt.default.func,id:mt.default.string,overlayElement:mt.default.func,contentElement:mt.default.func};Gp.defaultProps={isOpen:!1,portalClassName:one,bodyOpenClassName:sne,role:"dialog",ariaHideApp:!0,closeTimeoutMS:0,shouldFocusAfterRender:!0,shouldCloseOnEsc:!0,shouldCloseOnOverlayClick:!0,shouldReturnFocusAfterClose:!0,preventScroll:!1,parentSelector:function(){return document.body},overlayElement:function(s,d){return ME.default.createElement("div",s,d)},contentElement:function(s,d){return ME.default.createElement("div",s,d)}};Gp.defaultStyles={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.75)"},content:{position:"absolute",top:"40px",left:"40px",right:"40px",bottom:"40px",border:"1px solid #ccc",background:"#fff",overflow:"auto",WebkitOverflowScrolling:"touch",borderRadius:"4px",outline:"none",padding:"20px"}};(0,tne.polyfill)(Gp);md.default=Gp;(function(o,s){Object.defineProperty(s,"__esModule",{value:!0});var d=md,h=_(d);function _(g){return g&&g.__esModule?g:{default:g}}s.default=h.default,o.exports=s.default})(w0,w0.exports);var ane=w0.exports;const cne=U0(ane),dne=({title:o,count:s,camera:d,onHoverChange:h})=>{const[_,g]=ve.useState(!1),[C,A]=ve.useState(d.camera_name),[P,M]=ve.useState(d.app_id||""),[V,j]=ve.useState(d.channel||""),[G,Z]=ve.useState(d.token||""),z=To(),$=ae=>ae===0?"bg-neutral text-primary":"bg-accent text-white",pe=()=>{console.log("Edit clicked"),g(!0)},K=ae=>{z(`/camera/${ae.id}`,{state:{cameraData:ae}})},H=()=>{g(!1)},Y=async ae=>{ae.preventDefault();try{const Ae=await fetch(`${ac.API_BASE_URL}/api/v1/cameras/${d.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({camera:{camera_name:C,app_id:P,channel:V,token:G}})}),Le=await Ae.json();console.log(Le),Ae.ok?(console.log("Camera Details updated successfully:",Le),g(!1)):setError(Le.errors||"An error occurred")}catch{setError("Camera Details update failed. Please try again.")}console.log({name:C,appId:P,channel:V,token:G})};return N.jsxs("div",{className:"relative",children:[N.jsxs("div",{className:"absolute inset-0 flex p-8 text-black",children:[N.jsx("div",{className:"text-left",children:N.jsx("button",{onClick:()=>K(d),children:N.jsx("h3",{className:"text-lg font-bold",children:o})})}),N.jsx("div",{className:`absolute right-10 mr-12 text-right w-10 h-10 rounded-full ${$(s)}`,children:N.jsx("div",{className:" absolute right-3.5 top-1",children:N.jsxs("h3",{className:"font-bold text-xl",children:[s," "]})})}),N.jsx("div",{className:"absolute right-10 top-7 text-right w-10 h-10 rounded-full z-10 mt-1",children:N.jsx("button",{className:"p-2 text-xl text-gray-600 rounded-full hover:bg-gray-200 z-11",onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),onClick:pe,children:N.jsx(M5,{})})})]}),_&&N.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-10",children:N.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg",children:[N.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Edit Camera Settings"}),N.jsxs("form",{onSubmit:Y,children:[N.jsxs("div",{className:"mb-4",children:[N.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Name"}),N.jsx("input",{type:"text",value:C,onChange:ae=>A(ae.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline bg-white"})]}),N.jsxs("div",{className:"mb-4",children:[N.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"App ID"}),N.jsx("input",{type:"text",value:P,onChange:ae=>M(ae.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline bg-white"})]}),N.jsxs("div",{className:"mb-4",children:[N.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Channel"}),N.jsx("input",{type:"text",value:V,onChange:ae=>j(ae.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline bg-white"})]}),N.jsxs("div",{className:"mb-4",children:[N.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Token"}),N.jsx("input",{type:"text",value:G,onChange:ae=>Z(ae.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline bg-white"})]}),N.jsxs("div",{className:"flex items-center justify-between",children:[N.jsx("button",{type:"submit",className:"bg-primary hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Save"}),N.jsx("button",{type:"button",className:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",onClick:H,children:"Cancel"})]})]})]})})]})};function lne(){var G,Z;const o=hc(),[s,d]=ve.useState(((G=o.state)==null?void 0:G.userData)||JSON.parse(localStorage.getItem("user-data"))),h=((Z=s==null?void 0:s.user)==null?void 0:Z.cameras)||[],_=h.filter(z=>z.status==="Live").length,[g,C]=ve.useState(""),[A,P]=ve.useState(null),M=z=>{const $=h.map(pe=>pe.id===z.id?z:pe);d({...s,user:{...s.user,cameras:$}}),P(null)},V=()=>{P(null)},j=({camera:z,onSave:$,onCancel:pe})=>{const[K,H]=ve.useState(z.name),[Y,ae]=ve.useState(z.app_id||""),[Ae,Le]=ve.useState(z.channel||""),[Pe,We]=ve.useState(z.token||""),[Jt,dt]=ve.useState(z.status==="Live"),or=Yn=>{Yn.preventDefault();const je={...z,name:K,app_id:Y,channel:Ae,token:Pe,status:Jt?"Live":"Not Live"};$(je)},Cr=()=>{dt(!Jt)};return N.jsx("div",{className:"form-overlay",children:N.jsxs("div",{className:"form-container",children:[N.jsx("h2",{children:"Edit Camera Settings"}),N.jsxs("form",{onSubmit:or,children:[N.jsxs("div",{children:[N.jsx("label",{children:"Name"}),N.jsx("input",{type:"text",value:K,onChange:Yn=>H(Yn.target.value),required:!0})]}),N.jsxs("div",{children:[N.jsx("label",{children:"App ID"}),N.jsx("input",{type:"text",value:Y,onChange:Yn=>ae(Yn.target.value)})]}),N.jsxs("div",{children:[N.jsx("label",{children:"Channel"}),N.jsx("input",{type:"text",value:Ae,onChange:Yn=>Le(Yn.target.value)})]}),N.jsxs("div",{children:[N.jsx("label",{children:"Token"}),N.jsx("input",{type:"text",value:Pe,onChange:Yn=>We(Yn.target.value)})]}),N.jsxs("div",{children:[N.jsx("label",{children:"Status"}),N.jsxs("label",{className:"toggle-switch",children:[N.jsx("input",{type:"checkbox",checked:Jt,onChange:Cr}),N.jsx("span",{className:"slider"})]})]}),N.jsxs("div",{className:"form-buttons",children:[N.jsx("button",{type:"submit",children:"Save"}),N.jsx("button",{type:"button",onClick:pe,children:"Cancel"})]})]})]})})};return ve.useEffect(()=>{const z=new Date().getHours();z<12?C("Good Morning"):z<18?C("Good Afternoon"):C("Good Evening")},[]),N.jsxs("div",{className:"flex flex-col items-center",children:[N.jsxs("div",{className:"items-center rounded-lg p-6",children:[N.jsx("h1",{className:"text-2xl text-primary font-bold mb-4",children:g}),N.jsxs("p",{className:"text-lg text-gray-600 mb-6",children:[_," Active Device"]}),N.jsx("div",{children:["Live","Not Live"].map(z=>N.jsxs("div",{className:"mb-8",children:[N.jsx("h2",{className:"text-xl font-semibold mb-4 w-96",children:z}),N.jsx("div",{className:"grid grid-cols-1 gap-4",children:h.filter($=>$.status===z).map($=>N.jsx("div",{className:"relative rounded-3xl overflow-hidden shadow-lg cursor-pointer",style:{height:"200px",backgroundImage:`url(${$.image})`,backgroundSize:"cover",backgroundPosition:"center"},children:N.jsx(dne,{title:$.camera_name,camera:$})},$.id))})]},z))})]}),A&&N.jsx(j,{camera:A,onSave:M,onCancel:V,className:"z-10"}),N.jsx(_u,{})]})}const une=()=>{const o=To(),s=async()=>{localStorage.removeItem("user-data"),o("/user")};return N.jsx("div",{className:"flex flex-col items-center",children:N.jsx("div",{className:"items-center rounded-lg p-6",children:N.jsxs("div",{className:"font-ubuntu p-4 py-8 flex flex-col h-screen",children:[N.jsx("h1",{className:"text-2xl text-primary font-bold mb-4",children:"Profile Page"}),N.jsx("div",{className:"flex justify-center avatar",children:N.jsx("div",{className:"ring-primary ring-offset-base-100 w-24 rounded-full w-36 h-36",children:N.jsx("img",{src:"https://img.daisyui.com/images/stock/photo-1534528741775-53994a69daeb.jpg"})})}),N.jsx("h2",{className:"text-2xl text-primary font-bold flex justify-center p-5",children:"Username"}),N.jsx("div",{className:"flex justify-center py-2",children:N.jsxs("div",{class:"card w-96 h-24 rounded-xl bg-white shadow rounded-badge",children:[N.jsx(ad,{to:"/profile/particulars",children:N.jsxs("div",{class:"card h-12 px-4 flex flex-row items-center",children:[N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 25 25",fill:"none",children:N.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",fill:"#254777",d:"M12.5 2.5C10.751 2.49968 9.03241 2.95811 7.5159 3.82953C5.99939 4.70096 4.73797 5.95489 3.85753 7.46619C2.97709 8.97748 2.50844 10.6933 2.49834 12.4423C2.48825 14.1913 2.93707 15.9124 3.80001 17.4337C4.38327 16.6757 5.13305 16.062 5.99136 15.64C6.84968 15.218 7.79355 14.999 8.75 15H16.25C17.2064 14.999 18.1503 15.218 19.0086 15.64C19.867 16.062 20.6167 16.6757 21.2 17.4337C22.0629 15.9124 22.5117 14.1913 22.5017 12.4423C22.4916 10.6933 22.0229 8.97748 21.1425 7.46619C20.262 5.95489 19.0006 4.70096 17.4841 3.82953C15.9676 2.95811 14.249 2.49968 12.5 2.5ZM22.4287 20.095C24.1 17.9162 25.004 15.2459 25 12.5C25 5.59625 19.4037 0 12.5 0C5.59626 0 1.40665e-05 5.59625 1.40665e-05 12.5C-0.00411273 15.246 0.899895 17.9162 2.57126 20.095L2.56501 20.1175L3.00876 20.6337C4.18112 22.0044 5.63674 23.1045 7.2753 23.8583C8.91385 24.6121 10.6964 25.0016 12.5 25C15.0342 25.0046 17.5092 24.2349 19.5937 22.7937C20.4824 22.1797 21.2882 21.4538 21.9912 20.6337L22.435 20.1175L22.4287 20.095ZM12.5 5C11.5054 5 10.5516 5.39508 9.84835 6.09834C9.14509 6.80161 8.75 7.75543 8.75 8.74999C8.75 9.74455 9.14509 10.6984 9.84835 11.4016C10.5516 12.1049 11.5054 12.5 12.5 12.5C13.4946 12.5 14.4484 12.1049 15.1516 11.4016C15.8549 10.6984 16.25 9.74455 16.25 8.74999C16.25 7.75543 15.8549 6.80161 15.1516 6.09834C14.4484 5.39508 13.4946 5 12.5 5Z"})}),N.jsx("div",{className:"flex-1 px-4 text-lg font-lato text-primary font-semibold",children:"Edit Your Particulars"}),N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:N.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]})}),N.jsx("div",{class:"divider divider-start text-white m-0 h-0",children:"boo"}),N.jsx(ad,{to:"/profile/accsettings",children:N.jsxs("div",{class:"card h-12 px-4 flex flex-row items-center",children:[N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 25 25",fill:"none",children:N.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",fill:"#254777",d:"M14.8408 0.19C14.354 -5.58794e-08 13.7356 0 12.5001 0C11.2646 0 10.6475 -5.58794e-08 10.1593 0.19C9.51128 0.442764 8.99541 0.929707 8.72518 1.54375C8.60149 1.8225 8.55413 2.14875 8.53439 2.6225C8.52562 2.96575 8.42483 3.30121 8.24157 3.59715C8.0583 3.89309 7.79861 4.13973 7.48705 4.31375C7.16962 4.48138 6.81279 4.57018 6.44962 4.57193C6.08644 4.57368 5.72868 4.48831 5.40948 4.32375C4.96475 4.10125 4.64239 3.97875 4.32398 3.93875C3.62736 3.85185 2.9228 4.02975 2.36351 4.43375C1.9451 4.73625 1.6359 5.24125 1.01881 6.25C0.400404 7.25875 0.0925179 7.7625 0.022783 8.25625C-0.0693198 8.91375 0.120149 9.57875 0.549084 10.105C0.743816 10.345 1.01881 10.5463 1.4438 10.7987C2.07141 11.17 2.47403 11.8025 2.47403 12.5C2.47403 13.1975 2.07141 13.83 1.44511 14.2C1.01881 14.4537 0.743816 14.655 0.547768 14.895C0.336041 15.1549 0.180633 15.4521 0.0905237 15.7695C0.000414319 16.0868 -0.0226095 16.4179 0.022783 16.7438C0.0925179 17.2362 0.400404 17.7412 1.01881 18.75C1.63721 19.7588 1.9451 20.2625 2.36351 20.5662C2.92139 20.97 3.62663 21.1475 4.32398 21.0613C4.64239 21.0213 4.96475 20.8988 5.40948 20.6763C5.72884 20.5115 6.08685 20.426 6.45027 20.4277C6.8137 20.4295 7.17077 20.5184 7.48837 20.6862C8.12782 21.0362 8.50676 21.68 8.53439 22.3775C8.55413 22.8525 8.60149 23.1775 8.72518 23.4562C8.99359 24.0687 9.50937 24.5562 10.1593 24.81C10.6462 25 11.2646 25 12.5001 25C13.7356 25 14.354 25 14.8408 24.81C15.4889 24.5572 16.0047 24.0703 16.275 23.4562C16.3987 23.1775 16.446 22.8525 16.4658 22.3775C16.4921 21.68 16.8723 21.035 17.5131 20.6862C17.8305 20.5186 18.1874 20.4298 18.5505 20.4281C18.9137 20.4263 19.2715 20.5117 19.5907 20.6763C20.0354 20.8988 20.3578 21.0213 20.6762 21.0613C21.3735 21.1488 22.0788 20.97 22.6366 20.5662C23.055 20.2637 23.3642 19.7588 23.9813 18.75C24.5997 17.7412 24.9076 17.2375 24.9774 16.7438C25.0226 16.4178 24.9993 16.0867 24.909 15.7693C24.8187 15.452 24.663 15.1548 24.4511 14.895C24.2563 14.655 23.9813 14.4537 23.5563 14.2013C22.9287 13.83 22.5261 13.1975 22.5261 12.5C22.5261 11.8025 22.9287 11.17 23.555 10.8C23.9813 10.5463 24.2563 10.345 24.4524 10.105C24.6641 9.84507 24.8195 9.54786 24.9096 9.23054C24.9997 8.91322 25.0228 8.58208 24.9774 8.25625C24.9076 7.76375 24.5997 7.25875 23.9813 6.25C23.3629 5.24125 23.055 4.7375 22.6366 4.43375C22.0773 4.02975 21.3728 3.85185 20.6762 3.93875C20.3578 3.97875 20.0354 4.10125 19.5907 4.32375C19.2713 4.48854 18.9133 4.57402 18.5499 4.57227C18.1864 4.57052 17.8294 4.4816 17.5118 4.31375C17.2005 4.13958 16.941 3.89287 16.758 3.59694C16.575 3.30101 16.4744 2.96563 16.4658 2.6225C16.446 2.1475 16.3987 1.8225 16.275 1.54375C16.1412 1.23967 15.9457 0.963603 15.6997 0.731322C15.4536 0.499041 15.1617 0.315097 14.8408 0.19ZM12.5001 16.25C14.6974 16.25 16.4776 14.5712 16.4776 12.5C16.4776 10.4288 14.6961 8.75 12.5001 8.75C10.3028 8.75 8.52255 10.4288 8.52255 12.5C8.52255 14.5712 10.3041 16.25 12.5001 16.25Z"})}),N.jsx("div",{className:"flex-1 px-4 text-lg font-lato text-primary font-semibold",children:"Edit Account Settings"}),N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:N.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]})})]})}),N.jsx("div",{className:"flex justify-center py-2",children:N.jsxs("div",{class:"card w-96 h-24 rounded-xl bg-white shadow rounded-badge",children:[N.jsxs("div",{class:"card h-full px-4 flex flex-row items-center",children:[N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 25 25",fill:"none",children:N.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",fill:"#254777",d:"M12.5 0C5.6 0 0 5.6 0 12.5C0 19.4 5.6 25 12.5 25C19.4 25 25 19.4 25 12.5C25 5.6 19.4 0 12.5 0ZM18.3 8.5C18.1125 10.475 17.3 15.275 16.8875 17.4875C16.7125 18.425 16.3625 18.7375 16.0375 18.775C15.3125 18.8375 14.7625 18.3 14.0625 17.8375C12.9625 17.1125 12.3375 16.6625 11.275 15.9625C10.0375 15.15 10.8375 14.7 11.55 13.975C11.7375 13.7875 14.9375 10.875 15 10.6125C15.0087 10.5727 15.0075 10.5315 14.9966 10.4923C14.9857 10.453 14.9654 10.4171 14.9375 10.3875C14.8625 10.325 14.7625 10.35 14.675 10.3625C14.5625 10.3875 12.8125 11.55 9.4 13.85C8.9 14.1875 8.45 14.3625 8.05 14.35C7.6 14.3375 6.75 14.1 6.1125 13.8875C5.325 13.6375 4.7125 13.5 4.7625 13.0625C4.7875 12.8375 5.1 12.6125 5.6875 12.375C9.3375 10.7875 11.7625 9.7375 12.975 9.2375C16.45 7.7875 17.1625 7.5375 17.6375 7.5375C17.7375 7.5375 17.975 7.5625 18.125 7.6875C18.25 7.7875 18.2875 7.925 18.3 8.025C18.2875 8.1 18.3125 8.325 18.3 8.5Z"})}),N.jsx("div",{className:"flex-1 px-4 text-lg font-lato text-primary font-semibold",children:"Enable Telegram"}),N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:N.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]}),N.jsx("div",{class:"divider divider-start text-white m-0 h-0",children:"boo"}),N.jsxs("div",{class:"card h-full px-4 flex flex-row items-center",children:[N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 25 25",fill:"none",children:N.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",fill:"#254777",d:"M3.925 19.4625C3.925 18.125 5.4 15.625 6.9625 13.5125C8.525 15.625 10 18.125 10 19.4625C10 19.8614 9.92143 20.2564 9.76878 20.6249C9.61613 20.9934 9.39239 21.3283 9.11034 21.6103C8.82828 21.8924 8.49343 22.1161 8.1249 22.2688C7.75637 22.4214 7.36139 22.5 6.9625 22.5C5.2875 22.5 3.925 21.1375 3.925 19.4625ZM25 12.5C25 15.8152 23.683 18.9946 21.3388 21.3388C18.9946 23.683 15.8152 25 12.5 25C11.35 25 10.225 24.825 9.1625 24.5375C10.1538 24.1101 10.9981 23.4017 11.5912 22.4998C12.1844 21.5979 12.5003 20.542 12.5 19.4625C12.5 18.9 12.3625 18.25 12.1125 17.5H12.5C14.0625 17.5 15.4 18.125 15.9625 19.0375L17.7375 17.2625C16.6125 15.9 14.6875 15 12.5 15C11.9875 15 11.4875 15.05 11.0125 15.15C10.475 14.2 9.8125 13.1625 8.9875 12.0375L8.3875 11.25C9.275 11.0875 10 10.2875 10 9.375C10 8.375 9.125 7.5 8.125 7.5C7.125 7.5 6.25 8.375 6.25 9.375C6.25 9.6125 6.3 9.8375 6.3875 10.05L4.95 12.0375C3 14.6875 1.875 16.875 1.5375 18.5125C0.5625 16.725 0 14.675 0 12.5C0 9.18479 1.31696 6.00537 3.66117 3.66117C6.00537 1.31696 9.18479 0 12.5 0C14.1415 0 15.767 0.323322 17.2835 0.951506C18.8001 1.57969 20.1781 2.50043 21.3388 3.66117C22.4996 4.8219 23.4203 6.19989 24.0485 7.71646C24.6767 9.23303 25 10.8585 25 12.5ZM18.75 9.375C18.75 8.375 17.875 7.5 16.875 7.5C15.875 7.5 15 8.375 15 9.375C15 10.375 15.875 11.25 16.875 11.25C17.875 11.25 18.75 10.375 18.75 9.375Z"})}),N.jsx("div",{className:"flex-1 px-4 text-lg font-lato text-primary font-semibold",children:"Cry Detection Settings"}),N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:N.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]})]})}),N.jsx("div",{className:"flex justify-center py-2",children:N.jsxs("div",{class:"card w-96 h-24 rounded-xl bg-white shadow rounded-badge",children:[N.jsx(ad,{to:"/profile/editcams",children:N.jsxs("div",{class:"card h-12 px-4 flex flex-row items-center",children:[N.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"21",viewBox:"0 0 25 21",fill:"none",children:[N.jsx("path",{d:"M16.4062 11.2846C16.4062 12.4357 15.9947 13.5397 15.2621 14.3537C14.5296 15.1676 13.536 15.6249 12.5 15.6249C11.464 15.6249 10.4704 15.1676 9.73786 14.3537C9.0053 13.5397 8.59375 12.4357 8.59375 11.2846C8.59375 10.1335 9.0053 9.02953 9.73786 8.21557C10.4704 7.40161 11.464 6.94434 12.5 6.94434C13.536 6.94434 14.5296 7.40161 15.2621 8.21557C15.9947 9.02953 16.4062 10.1335 16.4062 11.2846Z",fill:"#254777"}),N.jsx("path",{d:"M3.125 3.47222C2.2962 3.47222 1.50134 3.83804 0.915291 4.48921C0.32924 5.14038 0 6.02355 0 6.94444L0 17.3611C0 18.282 0.32924 19.1652 0.915291 19.8163C1.50134 20.4675 2.2962 20.8333 3.125 20.8333H21.875C22.7038 20.8333 23.4987 20.4675 24.0847 19.8163C24.6708 19.1652 25 18.282 25 17.3611V6.94444C25 6.02355 24.6708 5.14038 24.0847 4.48921C23.4987 3.83804 22.7038 3.47222 21.875 3.47222H20.0438C19.215 3.47203 18.4203 3.10607 17.8344 2.45486L16.5406 1.01736C15.9547 0.366148 15.16 0.000196658 14.3313 0H10.6687C9.84002 0.000196658 9.04529 0.366148 8.45938 1.01736L7.16563 2.45486C6.57971 3.10607 5.78498 3.47203 4.95625 3.47222H3.125ZM3.90625 6.94444C3.69905 6.94444 3.50034 6.85299 3.35382 6.6902C3.20731 6.5274 3.125 6.30661 3.125 6.07639C3.125 5.84617 3.20731 5.62537 3.35382 5.46258C3.50034 5.29979 3.69905 5.20833 3.90625 5.20833C4.11345 5.20833 4.31216 5.29979 4.45868 5.46258C4.60519 5.62537 4.6875 5.84617 4.6875 6.07639C4.6875 6.30661 4.60519 6.5274 4.45868 6.6902C4.31216 6.85299 4.11345 6.94444 3.90625 6.94444ZM17.9688 11.2847C17.9688 12.8963 17.3926 14.4418 16.367 15.5814C15.3414 16.7209 13.9504 17.3611 12.5 17.3611C11.0496 17.3611 9.6586 16.7209 8.63301 15.5814C7.60742 14.4418 7.03125 12.8963 7.03125 11.2847C7.03125 9.67316 7.60742 8.12761 8.63301 6.98807C9.6586 5.84852 11.0496 5.20833 12.5 5.20833C13.9504 5.20833 15.3414 5.84852 16.367 6.98807C17.3926 8.12761 17.9688 9.67316 17.9688 11.2847Z",fill:"#254777"})]}),N.jsx("div",{className:"flex-1 px-4 text-lg font-lato text-primary font-semibold",children:"Add/Delete Camera"}),N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:N.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]})}),N.jsx("div",{class:"divider divider-start text-white m-0 h-0",children:"boo"}),N.jsxs("div",{class:"card h-12 px-4 flex flex-row items-center",children:[N.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"29",height:"24",viewBox:"0 0 29 24",fill:"none",children:[N.jsx("path",{d:"M5.75 8.875C5.75 8.875 2.53562 10.125 2 14.5M23.25 8.875C23.25 8.875 26.4644 10.125 27 14.5M10.75 8.875C10.75 8.875 13.75 9.60437 14.5 13.25C15.25 9.60437 18.25 8.875 18.25 8.875M12 18.25C12 18.25 9.375 18.7188 8.25 22M17 18.25C17 18.25 19.625 18.7188 20.75 22",stroke:"#254777","stroke-width":"3","stroke-linecap":"round"}),N.jsx("path",{d:"M14.5 19.5C16.2259 19.5 17.625 18.1009 17.625 16.375C17.625 14.6491 16.2259 13.25 14.5 13.25C12.7741 13.25 11.375 14.6491 11.375 16.375C11.375 18.1009 12.7741 19.5 14.5 19.5Z",stroke:"#254777","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"}),N.jsx("path",{d:"M20.75 9.5C22.8211 9.5 24.5 7.82107 24.5 5.75C24.5 3.67893 22.8211 2 20.75 2C18.6789 2 17 3.67893 17 5.75C17 7.82107 18.6789 9.5 20.75 9.5Z",stroke:"#254777","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"}),N.jsx("path",{d:"M8.25 9.5C10.3211 9.5 12 7.82107 12 5.75C12 3.67893 10.3211 2 8.25 2C6.17893 2 4.5 3.67893 4.5 5.75C4.5 7.82107 6.17893 9.5 8.25 9.5Z",stroke:"#254777","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"})]}),N.jsx("div",{className:"flex-1 px-4 text-lg font-lato text-primary font-semibold",children:"Trusted Members"}),N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:N.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]})]})}),N.jsx("div",{className:"flex justify-center py-2",children:N.jsx("div",{class:"card w-96 h-12 rounded-xl bg-white shadow rounded-badge",children:N.jsx("button",{onClick:s,className:"btn btn-primary text-white font-lato text-lg",children:"Log out"})})}),N.jsx(_u,{})]})})})},hne=()=>N.jsxs("div",{className:"font-ubuntu p-4 py-8 flex flex-col h-screen",children:[N.jsxs("div",{className:"flex-grow overflow-auto p-4",children:[N.jsxs("div",{className:"flex flex-row justify-between",children:[N.jsx("h1",{className:"text-2xl text-primary font-bold mb-4",children:"Edit Your Particulars"}),N.jsx(ad,{to:"/profile",children:N.jsx("h1",{className:"text-2xl text-primary font-medium mb-4",children:"Done"})})]}),N.jsx("div",{className:"flex justify-center avatar",children:N.jsx("div",{className:"ring-primary ring-offset-base-100 w-24 rounded-full w-36 h-36",children:N.jsx("img",{src:"https://img.daisyui.com/images/stock/photo-1534528741775-53994a69daeb.jpg"})})}),N.jsxs("label",{htmlFor:"doc",className:"flex justify-center p-5",children:[N.jsx("span",{className:"text-2xl text-primary-content cursor-pointer",children:"Set New Photo"}),N.jsx("input",{type:"file",id:"doc",name:"doc",accept:"image/png, image/jpeg",hidden:!0})]}),N.jsx("div",{className:"flex justify-center py-4",children:N.jsxs("div",{class:"card w-96 h-24 rounded-xl bg-white shadow rounded-badge",children:[N.jsxs("div",{class:"card h-12 px-4 flex flex-row items-center",children:[N.jsx("input",{type:"text",placeholder:"First Name",className:`input input-ghost w-full bg-transparent
                                focus:outline-none focus:border-none 
                                font-lato font-semibold text-xl`}),N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:N.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]}),N.jsx("div",{class:"divider divider-start text-white m-0 h-0",children:":P"}),N.jsxs("div",{class:"card h-12 px-4 flex flex-row items-center",children:[N.jsx("input",{type:"text",placeholder:"Last Name",className:`input input-ghost w-full bg-transparent
                                focus:outline-none focus:border-none 
                                font-lato font-semibold text-xl`}),N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:N.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]}),N.jsx("a",{className:"font-lato text-info text-sm px-4 py-1",children:"Enter your name and add an optional profile picture"})]})}),N.jsx("div",{className:"flex justify-center py-8",children:N.jsxs("div",{class:"card w-96 h-24 rounded-xl bg-white shadow rounded-badge",children:[N.jsxs("div",{class:"card h-full px-4 flex flex-row items-center",children:[N.jsx("div",{className:"flex-1 px-4 text-xl font-lato text-primary font-semibold",children:"Change Email"}),N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:N.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]}),N.jsx("div",{class:"divider divider-start text-white m-0 h-0",children:":P"}),N.jsxs("div",{class:"card h-full px-4 flex flex-row items-center",children:[N.jsx("div",{className:"flex-1 px-4 text-xl font-lato text-primary font-semibold",children:"Change Number"}),N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:N.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]})]})})]}),N.jsx(_u,{})]}),pne=()=>{const[o,s]=ve.useState(!1),d=()=>{s(!o)};return N.jsxs("div",{className:"font-ubuntu p-4 py-8 flex flex-col h-screen",children:[N.jsxs("div",{className:"flex-grow overflow-auto p-4",children:[N.jsxs("div",{className:"flex flex-row justify-between",children:[N.jsx("h1",{className:"text-2xl text-primary font-bold mb-4",children:"Edit Your Account Settings"}),N.jsx(ad,{to:"/profile",children:N.jsx("h1",{className:"text-2xl text-primary font-medium mb-4",children:"Done"})})]}),N.jsx("div",{className:"flex justify-center py-4",children:N.jsxs("div",{className:"card w-96 h-24 rounded-xl bg-white shadow rounded-badge",children:[N.jsxs("div",{className:"card h-12 px-4 flex flex-row items-center",children:[N.jsx("input",{type:"text",placeholder:"Username",className:"input input-ghost w-full bg-transparent focus:outline-none focus:border-none font-lato font-regular text-xl placeholder-primary"}),N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:N.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]}),N.jsx("div",{className:"divider divider-start text-white m-0 h-0",children:":P"}),N.jsxs("div",{className:"card h-12 px-4 flex flex-row justify-between items-center",children:[N.jsx("input",{type:o?"text":"password",placeholder:"Password",className:"input input-ghost w-full bg-transparent focus:outline-none focus:border-none font-lato font-regular text-xl placeholder-primary"}),N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"19",height:"13",viewBox:"0 0 19 13",fill:"none",onClick:d,className:"cursor-pointer",children:N.jsx("path",{fill:"#C3C6CF",d:o?"M10 2C6.13 2 2.73 4.11 1 7.5C2.73 10.89 6.13 13 10 13C13.87 13 17.27 10.89 19 7.5C17.27 4.11 13.87 2 10 2ZM10 11C8.34 11 7 9.66 7 8C7 6.34 8.34 5 10 5C11.66 5 13 6.34 13 8C13 9.66 11.66 11 10 11ZM10 6.5C9.17 6.5 8.5 7.17 8.5 8C8.5 8.83 9.17 9.5 10 9.5C10.83 9.5 11.5 8.83 11.5 8C11.5 7.17 10.83 6.5 10 6.5Z":"M19.71 18.29L15.3 13.88C14.57 14.39 13.81 14.82 13 15.17V17H7V15.17C4.88 14.39 2.88 12.88 1.3 11.12L0 12.42L1.41 13.83C3.21 15.61 6.4 18.5 10 18.5C13.6 18.5 16.79 15.61 18.59 13.83L20 12.42L19.71 12.12L19.71 18.29ZM12.83 10.5H7.17L12.83 15.5H12.83V10.5ZM19.41 8.41L18 7C16.2 5.21 13.01 2.32 9.41 2.32C5.81 2.32 2.62 5.21 0.82 7L0 7.82L1.41 9.23C3.21 11.02 6.4 13.91 10 13.91C13.6 13.91 16.79 11.02 18.59 9.23L20 7.82L19.41 8.41Z"})}),N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"17",viewBox:"0 0 10 17",fill:"none",children:N.jsx("path",{fill:"#C3C6CF",d:"M9.6024 9.4443L1.92021 17L0 15.1114L6.72209 8.5L0 1.88859L1.92021 0L9.6024 7.5557C9.85698 7.80617 10 8.14584 10 8.5C10 8.85416 9.85698 9.19383 9.6024 9.4443Z"})})]}),N.jsx("a",{className:"font-lato text-info text-sm px-4 py-1",children:"Change your username and view your current password"})]})}),N.jsx("div",{className:"flex flex-col items-center py-8",children:N.jsxs("div",{className:"w-96",children:[N.jsx("h1",{className:"text-2xl text-primary font-bold mb-4 px-4 text-left",children:"Change your Password"}),N.jsx("input",{type:"text",placeholder:"Current Password",class:`input w-full max-w shadow focus:shadow shadow-neutral focus:shadow-neutral font-lato text-lg font-normal gap-4
                        bg-white focus:outline-none border-secondary-content focus:border-secondary-content`}),N.jsx("div",{className:"py-2"}),N.jsx("input",{type:"text",placeholder:"New Password",class:`input w-full max-w shadow focus:shadow shadow-neutral focus:shadow-neutral font-lato text-lg font-normal
                        bg-white focus:outline-none border-secondary-content focus:border-secondary-content`}),N.jsx("div",{className:"py-2"}),N.jsx("input",{type:"text",placeholder:"Retype Password",class:`input w-full max-w shadow focus:shadow shadow-neutral focus:shadow-neutral font-lato text-lg font-normal
                        bg-white focus:outline-none border-secondary-content focus:border-secondary-content`}),N.jsx("div",{className:"py-4"}),N.jsx("button",{type:"submit",className:"w-full bg-primary text-white py-2 rounded-full hover:bg-primary font-ubunut font-bold text-xl",children:"Change Password"}),N.jsx("div",{className:"py-10"}),N.jsx("button",{type:"submit",className:"w-full bg-error text-white py-2 rounded-full hover:bg-error font-ubunut font-bold text-xl",children:"Delete Account"})]})})]}),N.jsx(_u,{})]})},fne=()=>N.jsxs("div",{className:"font-ubuntu p-4 py-8 flex flex-col h-screen",children:[N.jsxs("div",{className:"flex-grow overflow-auto p-4",children:[N.jsxs("div",{className:"flex flex-row justify-between",children:[N.jsx("h1",{className:"text-2xl text-primary font-bold mb-4",children:"Edit Camera's"}),N.jsx(ad,{to:"/profile",children:N.jsx("h1",{className:"text-2xl text-primary font-medium mb-4",children:"Done"})})]}),N.jsx("div",{className:"flex justify-center py-4",children:N.jsxs("div",{className:"card w-96 h-12 rounded-xl shadow rounded-badge flex flex-row items-center justify-between bg-white outline outline-secondary-content font-lato font-semibold text-lg text-primary",children:[N.jsx("span",{className:"px-4",children:"Bedroom"}),N.jsx("div",{className:"px-4",children:N.jsx("button",{className:"btn btn-circle btn-outline btn-error btn-xs",children:N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:N.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})})]})}),N.jsx("div",{className:"flex justify-center py-4",children:N.jsxs("div",{className:"card w-96 h-12 rounded-xl shadow rounded-badge flex flex-row items-center justify-between bg-white outline outline-secondary-content font-lato font-semibold text-lg text-primary",children:[N.jsx("span",{className:"px-4",children:"Living Room"}),N.jsx("div",{className:"px-4",children:N.jsx("button",{className:"btn btn-circle btn-outline btn-error btn-xs",children:N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:N.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})})]})}),N.jsx("div",{className:"flex justify-center py-4",children:N.jsxs("div",{className:"card w-96 h-12 rounded-xl shadow rounded-badge flex flex-row items-center justify-between bg-white outline outline-secondary-content font-lato font-semibold text-lg text-primary",children:[N.jsx("span",{className:"px-4",children:"Child Room"}),N.jsx("div",{className:"px-4",children:N.jsx("button",{className:"btn btn-circle btn-outline btn-error btn-xs",children:N.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:N.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})})]})}),N.jsx("div",{className:"flex justify-center py-4 flex flex-col items-center",children:N.jsx("button",{class:"btn rounded-xl btn-active btn-outline w-96 bg-white outline-neutral font-lato text-lg",children:"+ Add New Camera"})})]}),N.jsx(_u,{})]}),mne=()=>{w5();const o=hc(),{cameraData:s}=o.state||{},d=To(),[h,_]=ve.useState({localAudioTrack:null,localVideoTrack:null,client:null,remoteUsers:{},mediaRecorder:null,recordedChunks:[]}),g=ve.useRef(null),C=()=>{const M=new MediaStream;for(let j in h.remoteUsers){const G=h.remoteUsers[j];if(G.videoTrack){const Z=G.videoTrack.getMediaStreamTrack();M.addTrack(Z)}if(G.audioTrack){const Z=G.audioTrack.getMediaStreamTrack();M.addTrack(Z)}}const V=new MediaRecorder(M,{mimeType:"video/webm;codecs=vp9,opus"});V.ondataavailable=j=>{j.data.size>0&&_(G=>({...G,recordedChunks:[...G.recordedChunks,j.data]}))},V.onstop=()=>{const j=new Blob(h.recordedChunks,{type:"video/webm"}),G=URL.createObjectURL(j),Z=document.getElementById("download-link"),z=new Date,$=z.toISOString().split("T")[0],pe=z.toTimeString().split(" ")[0].replace(/:/g,"-"),K=`recording_${$}_${pe}.webm`;Z.href=G,Z.download=K,Z.style.display="block",Z.click(),setTimeout(()=>{window.location.reload()},1e4)},V.start(),_(j=>({...j,mediaRecorder:V})),document.getElementById("start-recording").disabled=!0,document.getElementById("stop-recording").disabled=!1},A=()=>{h.mediaRecorder&&(h.mediaRecorder.stop(),document.getElementById("start-recording").disabled=!1,document.getElementById("stop-recording").disabled=!0)},P=()=>{d("/user-home")};return ve.useEffect(()=>{const M=s==null?void 0:s.app_id,V=s==null?void 0:s.token,j=s==null?void 0:s.channel,G=async()=>{const z=Jl.createClient({mode:"live",codec:"vp8"});try{z.setClientRole("audience",{level:P5.AudienceLatencyLevelType.AUDIENCE_LEVEL_LOW_LATENCY}),console.log("APP_ID",M,"CHANNEL",j);const $=Math.floor(Math.random()*1e6);console.log("new_id",$),await z.join(M,j,V,$),z.on("user-published",async(pe,K)=>{if(console.log("user-published",pe,K),await z.subscribe(pe,K),console.log("subscribe success"),K==="video"){const H=pe.videoTrack;g.current&&(g.current.innerHTML=""),H.play(g.current)}K==="audio"&&pe.audioTrack.play(),_(H=>({...H,remoteUsers:{...H.remoteUsers,[pe.uid]:pe}}))}),z.on("user-unpublished",pe=>{console.log("user-unpublished",pe),g.current&&g.current.id===pe.uid.toString()&&(g.current.innerHTML="Video Player Here"),_(K=>{const H={...K.remoteUsers};return delete H[pe.uid],{...K,remoteUsers:H}})}),_(pe=>({...pe,client:z}))}catch($){console.error("Failed to join as audience:",$)}},Z=async()=>{h.client&&(await h.client.leave(),h.client.removeAllListeners(),g.current&&(g.current.innerHTML="Video Player Here"),_(z=>({...z,client:null})),console.log("Left the channel successfully"))};return window.joinChannel=G,window.leaveChannel=Z,document.getElementById("start-recording").addEventListener("click",C),document.getElementById("stop-recording").addEventListener("click",A),()=>{const z=document.getElementById("start-recording"),$=document.getElementById("stop-recording");z&&z.removeEventListener("click",C),$&&$.removeEventListener("click",A)}},[h,s]),N.jsx("div",{className:"flex flex-col items-center",children:N.jsxs("div",{className:"items-center rounded-lg w-96 p-6",children:[N.jsxs("header",{className:"flex items-center mb-6",children:[N.jsx("button",{className:"btn btn-ghost btn-sm mr-4",onClick:P,children:"<"}),N.jsx("h1",{className:"text-xl font-semibold",children:s.camera_name})]}),N.jsx("div",{className:"bg-gray-200 h-48 rounded-lg flex items-center justify-center mb-6",ref:g,children:N.jsx("span",{className:"text-gray-500",children:"Video Player Here"})}),N.jsxs("div",{className:"flex justify-around mb-6 p-4 rounded-lg border border-gray-300 shadow-lg",children:[N.jsx("button",{className:"btn btn-outline btn-primary",children:"📸"}),N.jsx("button",{className:"btn btn-outline btn-primary",children:"🔊"}),N.jsx("button",{className:"btn btn-outline btn-primary",children:"🎥"})]}),N.jsxs("div",{className:"flex justify-center pb-4",children:[N.jsx("button",{onClick:()=>window.joinChannel(),className:"btn btn-accent px-4 mx-4",children:"Watch "}),N.jsx("button",{onClick:()=>window.leaveChannel(),className:"btn btn-accent px-4 mx-4",children:"Leave"})]}),N.jsxs("div",{className:"mb-6",children:[N.jsx("p",{className:"font-medium",children:"Currently:"}),N.jsxs("p",{className:"text-gray-600",children:["Status: ",s.status]}),N.jsx("p",{className:"text-gray-600",children:"Noise Level: xxx db"})]}),N.jsxs("div",{className:"flex justify-center pb-4",children:[N.jsx("button",{id:"start-recording",className:"btn btn-success",children:"Start Recording"}),N.jsx("button",{id:"stop-recording",className:"btn btn-danger",disabled:!0,children:"Stop Recording"}),N.jsx("a",{id:"download-link",className:"btn btn-primary",style:{display:"none"},children:"Download Recording"})]}),N.jsxs("div",{children:[N.jsx("h2",{className:"text-lg font-semibold mb-2",children:"History:"}),N.jsxs("div",{className:"flex items-center mb-4",children:[N.jsx("img",{src:"./images/crybaby.png",alt:"cry icon",className:"w-10 h-10 mr-4"}),N.jsxs("div",{children:[N.jsx("p",{className:"font-medium",children:"Cry Detected at 7pm!"}),N.jsx("p",{className:"text-gray-600 text-sm",children:"Duration: 5mins"}),N.jsx("p",{className:"text-gray-600 text-sm",children:"Probability: 90%"})]})]})]})]})})};function q5(o,s){return function(){return o.apply(s,arguments)}}const{toString:_ne}=Object.prototype,{getPrototypeOf:xR}=Object,rg=(o=>s=>{const d=_ne.call(s);return o[d]||(o[d]=d.slice(8,-1).toLowerCase())})(Object.create(null)),Xo=o=>(o=o.toLowerCase(),s=>rg(s)===o),ig=o=>s=>typeof s===o,{isArray:Su}=Array,Mp=ig("undefined");function Ene(o){return o!==null&&!Mp(o)&&o.constructor!==null&&!Mp(o.constructor)&&Eo(o.constructor.isBuffer)&&o.constructor.isBuffer(o)}const J5=Xo("ArrayBuffer");function gne(o){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(o):s=o&&o.buffer&&J5(o.buffer),s}const Sne=ig("string"),Eo=ig("function"),X5=ig("number"),og=o=>o!==null&&typeof o=="object",Tne=o=>o===!0||o===!1,iE=o=>{if(rg(o)!=="object")return!1;const s=xR(o);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in o)&&!(Symbol.iterator in o)},vne=Xo("Date"),yne=Xo("File"),Cne=Xo("Blob"),Rne=Xo("FileList"),wne=o=>og(o)&&Eo(o.pipe),Ine=o=>{let s;return o&&(typeof FormData=="function"&&o instanceof FormData||Eo(o.append)&&((s=rg(o))==="formdata"||s==="object"&&Eo(o.toString)&&o.toString()==="[object FormData]"))},bne=Xo("URLSearchParams"),[Ane,One,Nne,Dne]=["ReadableStream","Request","Response","Headers"].map(Xo),Pne=o=>o.trim?o.trim():o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Hp(o,s,{allOwnKeys:d=!1}={}){if(o===null||typeof o>"u")return;let h,_;if(typeof o!="object"&&(o=[o]),Su(o))for(h=0,_=o.length;h<_;h++)s.call(null,o[h],h,o);else{const g=d?Object.getOwnPropertyNames(o):Object.keys(o),C=g.length;let A;for(h=0;h<C;h++)A=g[h],s.call(null,o[A],A,o)}}function Q5(o,s){s=s.toLowerCase();const d=Object.keys(o);let h=d.length,_;for(;h-- >0;)if(_=d[h],s===_.toLowerCase())return _;return null}const Z5=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,$5=o=>!Mp(o)&&o!==Z5;function N0(){const{caseless:o}=$5(this)&&this||{},s={},d=(h,_)=>{const g=o&&Q5(s,_)||_;iE(s[g])&&iE(h)?s[g]=N0(s[g],h):iE(h)?s[g]=N0({},h):Su(h)?s[g]=h.slice():s[g]=h};for(let h=0,_=arguments.length;h<_;h++)arguments[h]&&Hp(arguments[h],d);return s}const Lne=(o,s,d,{allOwnKeys:h}={})=>(Hp(s,(_,g)=>{d&&Eo(_)?o[g]=q5(_,d):o[g]=_},{allOwnKeys:h}),o),kne=o=>(o.charCodeAt(0)===65279&&(o=o.slice(1)),o),Mne=(o,s,d,h)=>{o.prototype=Object.create(s.prototype,h),o.prototype.constructor=o,Object.defineProperty(o,"super",{value:s.prototype}),d&&Object.assign(o.prototype,d)},xne=(o,s,d,h)=>{let _,g,C;const A={};if(s=s||{},o==null)return s;do{for(_=Object.getOwnPropertyNames(o),g=_.length;g-- >0;)C=_[g],(!h||h(C,o,s))&&!A[C]&&(s[C]=o[C],A[C]=!0);o=d!==!1&&xR(o)}while(o&&(!d||d(o,s))&&o!==Object.prototype);return s},Une=(o,s,d)=>{o=String(o),(d===void 0||d>o.length)&&(d=o.length),d-=s.length;const h=o.indexOf(s,d);return h!==-1&&h===d},jne=o=>{if(!o)return null;if(Su(o))return o;let s=o.length;if(!X5(s))return null;const d=new Array(s);for(;s-- >0;)d[s]=o[s];return d},Vne=(o=>s=>o&&s instanceof o)(typeof Uint8Array<"u"&&xR(Uint8Array)),Fne=(o,s)=>{const h=(o&&o[Symbol.iterator]).call(o);let _;for(;(_=h.next())&&!_.done;){const g=_.value;s.call(o,g[0],g[1])}},Bne=(o,s)=>{let d;const h=[];for(;(d=o.exec(s))!==null;)h.push(d);return h},Wne=Xo("HTMLFormElement"),Gne=o=>o.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(d,h,_){return h.toUpperCase()+_}),HU=(({hasOwnProperty:o})=>(s,d)=>o.call(s,d))(Object.prototype),Hne=Xo("RegExp"),e4=(o,s)=>{const d=Object.getOwnPropertyDescriptors(o),h={};Hp(d,(_,g)=>{let C;(C=s(_,g,o))!==!1&&(h[g]=C||_)}),Object.defineProperties(o,h)},Kne=o=>{e4(o,(s,d)=>{if(Eo(o)&&["arguments","caller","callee"].indexOf(d)!==-1)return!1;const h=o[d];if(Eo(h)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+d+"'")})}})},zne=(o,s)=>{const d={},h=_=>{_.forEach(g=>{d[g]=!0})};return Su(o)?h(o):h(String(o).split(s)),d},Yne=()=>{},qne=(o,s)=>o!=null&&Number.isFinite(o=+o)?o:s,IC="abcdefghijklmnopqrstuvwxyz",KU="0123456789",t4={DIGIT:KU,ALPHA:IC,ALPHA_DIGIT:IC+IC.toUpperCase()+KU},Jne=(o=16,s=t4.ALPHA_DIGIT)=>{let d="";const{length:h}=s;for(;o--;)d+=s[Math.random()*h|0];return d};function Xne(o){return!!(o&&Eo(o.append)&&o[Symbol.toStringTag]==="FormData"&&o[Symbol.iterator])}const Qne=o=>{const s=new Array(10),d=(h,_)=>{if(og(h)){if(s.indexOf(h)>=0)return;if(!("toJSON"in h)){s[_]=h;const g=Su(h)?[]:{};return Hp(h,(C,A)=>{const P=d(C,_+1);!Mp(P)&&(g[A]=P)}),s[_]=void 0,g}}return h};return d(o,0)},Zne=Xo("AsyncFunction"),$ne=o=>o&&(og(o)||Eo(o))&&Eo(o.then)&&Eo(o.catch),le={isArray:Su,isArrayBuffer:J5,isBuffer:Ene,isFormData:Ine,isArrayBufferView:gne,isString:Sne,isNumber:X5,isBoolean:Tne,isObject:og,isPlainObject:iE,isReadableStream:Ane,isRequest:One,isResponse:Nne,isHeaders:Dne,isUndefined:Mp,isDate:vne,isFile:yne,isBlob:Cne,isRegExp:Hne,isFunction:Eo,isStream:wne,isURLSearchParams:bne,isTypedArray:Vne,isFileList:Rne,forEach:Hp,merge:N0,extend:Lne,trim:Pne,stripBOM:kne,inherits:Mne,toFlatObject:xne,kindOf:rg,kindOfTest:Xo,endsWith:Une,toArray:jne,forEachEntry:Fne,matchAll:Bne,isHTMLForm:Wne,hasOwnProperty:HU,hasOwnProp:HU,reduceDescriptors:e4,freezeMethods:Kne,toObjectSet:zne,toCamelCase:Gne,noop:Yne,toFiniteNumber:qne,findKey:Q5,global:Z5,isContextDefined:$5,ALPHABET:t4,generateString:Jne,isSpecCompliantForm:Xne,toJSONObject:Qne,isAsyncFn:Zne,isThenable:$ne};function vt(o,s,d,h,_){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=o,this.name="AxiosError",s&&(this.code=s),d&&(this.config=d),h&&(this.request=h),_&&(this.response=_)}le.inherits(vt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:le.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const n4=vt.prototype,r4={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(o=>{r4[o]={value:o}});Object.defineProperties(vt,r4);Object.defineProperty(n4,"isAxiosError",{value:!0});vt.from=(o,s,d,h,_,g)=>{const C=Object.create(n4);return le.toFlatObject(o,C,function(P){return P!==Error.prototype},A=>A!=="isAxiosError"),vt.call(C,o.message,s,d,h,_),C.cause=o,C.name=o.name,g&&Object.assign(C,g),C};const ere=null;function D0(o){return le.isPlainObject(o)||le.isArray(o)}function i4(o){return le.endsWith(o,"[]")?o.slice(0,-2):o}function zU(o,s,d){return o?o.concat(s).map(function(_,g){return _=i4(_),!d&&g?"["+_+"]":_}).join(d?".":""):s}function tre(o){return le.isArray(o)&&!o.some(D0)}const nre=le.toFlatObject(le,{},null,function(s){return/^is[A-Z]/.test(s)});function sg(o,s,d){if(!le.isObject(o))throw new TypeError("target must be an object");s=s||new FormData,d=le.toFlatObject(d,{metaTokens:!0,dots:!1,indexes:!1},!1,function($,pe){return!le.isUndefined(pe[$])});const h=d.metaTokens,_=d.visitor||V,g=d.dots,C=d.indexes,P=(d.Blob||typeof Blob<"u"&&Blob)&&le.isSpecCompliantForm(s);if(!le.isFunction(_))throw new TypeError("visitor must be a function");function M(z){if(z===null)return"";if(le.isDate(z))return z.toISOString();if(!P&&le.isBlob(z))throw new vt("Blob is not supported. Use a Buffer instead.");return le.isArrayBuffer(z)||le.isTypedArray(z)?P&&typeof Blob=="function"?new Blob([z]):Buffer.from(z):z}function V(z,$,pe){let K=z;if(z&&!pe&&typeof z=="object"){if(le.endsWith($,"{}"))$=h?$:$.slice(0,-2),z=JSON.stringify(z);else if(le.isArray(z)&&tre(z)||(le.isFileList(z)||le.endsWith($,"[]"))&&(K=le.toArray(z)))return $=i4($),K.forEach(function(Y,ae){!(le.isUndefined(Y)||Y===null)&&s.append(C===!0?zU([$],ae,g):C===null?$:$+"[]",M(Y))}),!1}return D0(z)?!0:(s.append(zU(pe,$,g),M(z)),!1)}const j=[],G=Object.assign(nre,{defaultVisitor:V,convertValue:M,isVisitable:D0});function Z(z,$){if(!le.isUndefined(z)){if(j.indexOf(z)!==-1)throw Error("Circular reference detected in "+$.join("."));j.push(z),le.forEach(z,function(K,H){(!(le.isUndefined(K)||K===null)&&_.call(s,K,le.isString(H)?H.trim():H,$,G))===!0&&Z(K,$?$.concat(H):[H])}),j.pop()}}if(!le.isObject(o))throw new TypeError("data must be an object");return Z(o),s}function YU(o){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(o).replace(/[!'()~]|%20|%00/g,function(h){return s[h]})}function UR(o,s){this._pairs=[],o&&sg(o,this,s)}const o4=UR.prototype;o4.append=function(s,d){this._pairs.push([s,d])};o4.toString=function(s){const d=s?function(h){return s.call(this,h,YU)}:YU;return this._pairs.map(function(_){return d(_[0])+"="+d(_[1])},"").join("&")};function rre(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function s4(o,s,d){if(!s)return o;const h=d&&d.encode||rre,_=d&&d.serialize;let g;if(_?g=_(s,d):g=le.isURLSearchParams(s)?s.toString():new UR(s,d).toString(h),g){const C=o.indexOf("#");C!==-1&&(o=o.slice(0,C)),o+=(o.indexOf("?")===-1?"?":"&")+g}return o}class qU{constructor(){this.handlers=[]}use(s,d,h){return this.handlers.push({fulfilled:s,rejected:d,synchronous:h?h.synchronous:!1,runWhen:h?h.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){le.forEach(this.handlers,function(h){h!==null&&s(h)})}}const a4={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ire=typeof URLSearchParams<"u"?URLSearchParams:UR,ore=typeof FormData<"u"?FormData:null,sre=typeof Blob<"u"?Blob:null,are={isBrowser:!0,classes:{URLSearchParams:ire,FormData:ore,Blob:sre},protocols:["http","https","file","blob","url","data"]},jR=typeof window<"u"&&typeof document<"u",cre=(o=>jR&&["ReactNative","NativeScript","NS"].indexOf(o)<0)(typeof navigator<"u"&&navigator.product),dre=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",lre=jR&&window.location.href||"http://localhost",ure=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:jR,hasStandardBrowserEnv:cre,hasStandardBrowserWebWorkerEnv:dre,origin:lre},Symbol.toStringTag,{value:"Module"})),zo={...ure,...are};function hre(o,s){return sg(o,new zo.classes.URLSearchParams,Object.assign({visitor:function(d,h,_,g){return zo.isNode&&le.isBuffer(d)?(this.append(h,d.toString("base64")),!1):g.defaultVisitor.apply(this,arguments)}},s))}function pre(o){return le.matchAll(/\w+|\[(\w*)]/g,o).map(s=>s[0]==="[]"?"":s[1]||s[0])}function fre(o){const s={},d=Object.keys(o);let h;const _=d.length;let g;for(h=0;h<_;h++)g=d[h],s[g]=o[g];return s}function c4(o){function s(d,h,_,g){let C=d[g++];if(C==="__proto__")return!0;const A=Number.isFinite(+C),P=g>=d.length;return C=!C&&le.isArray(_)?_.length:C,P?(le.hasOwnProp(_,C)?_[C]=[_[C],h]:_[C]=h,!A):((!_[C]||!le.isObject(_[C]))&&(_[C]=[]),s(d,h,_[C],g)&&le.isArray(_[C])&&(_[C]=fre(_[C])),!A)}if(le.isFormData(o)&&le.isFunction(o.entries)){const d={};return le.forEachEntry(o,(h,_)=>{s(pre(h),_,d,0)}),d}return null}function mre(o,s,d){if(le.isString(o))try{return(s||JSON.parse)(o),le.trim(o)}catch(h){if(h.name!=="SyntaxError")throw h}return(d||JSON.stringify)(o)}const Kp={transitional:a4,adapter:["xhr","http","fetch"],transformRequest:[function(s,d){const h=d.getContentType()||"",_=h.indexOf("application/json")>-1,g=le.isObject(s);if(g&&le.isHTMLForm(s)&&(s=new FormData(s)),le.isFormData(s))return _?JSON.stringify(c4(s)):s;if(le.isArrayBuffer(s)||le.isBuffer(s)||le.isStream(s)||le.isFile(s)||le.isBlob(s)||le.isReadableStream(s))return s;if(le.isArrayBufferView(s))return s.buffer;if(le.isURLSearchParams(s))return d.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let A;if(g){if(h.indexOf("application/x-www-form-urlencoded")>-1)return hre(s,this.formSerializer).toString();if((A=le.isFileList(s))||h.indexOf("multipart/form-data")>-1){const P=this.env&&this.env.FormData;return sg(A?{"files[]":s}:s,P&&new P,this.formSerializer)}}return g||_?(d.setContentType("application/json",!1),mre(s)):s}],transformResponse:[function(s){const d=this.transitional||Kp.transitional,h=d&&d.forcedJSONParsing,_=this.responseType==="json";if(le.isResponse(s)||le.isReadableStream(s))return s;if(s&&le.isString(s)&&(h&&!this.responseType||_)){const C=!(d&&d.silentJSONParsing)&&_;try{return JSON.parse(s)}catch(A){if(C)throw A.name==="SyntaxError"?vt.from(A,vt.ERR_BAD_RESPONSE,this,null,this.response):A}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:zo.classes.FormData,Blob:zo.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};le.forEach(["delete","get","head","post","put","patch"],o=>{Kp.headers[o]={}});const _re=le.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ere=o=>{const s={};let d,h,_;return o&&o.split(`
`).forEach(function(C){_=C.indexOf(":"),d=C.substring(0,_).trim().toLowerCase(),h=C.substring(_+1).trim(),!(!d||s[d]&&_re[d])&&(d==="set-cookie"?s[d]?s[d].push(h):s[d]=[h]:s[d]=s[d]?s[d]+", "+h:h)}),s},JU=Symbol("internals");function Xh(o){return o&&String(o).trim().toLowerCase()}function oE(o){return o===!1||o==null?o:le.isArray(o)?o.map(oE):String(o)}function gre(o){const s=Object.create(null),d=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let h;for(;h=d.exec(o);)s[h[1]]=h[2];return s}const Sre=o=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(o.trim());function bC(o,s,d,h,_){if(le.isFunction(h))return h.call(this,s,d);if(_&&(s=d),!!le.isString(s)){if(le.isString(h))return s.indexOf(h)!==-1;if(le.isRegExp(h))return h.test(s)}}function Tre(o){return o.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,d,h)=>d.toUpperCase()+h)}function vre(o,s){const d=le.toCamelCase(" "+s);["get","set","has"].forEach(h=>{Object.defineProperty(o,h+d,{value:function(_,g,C){return this[h].call(this,s,_,g,C)},configurable:!0})})}class yi{constructor(s){s&&this.set(s)}set(s,d,h){const _=this;function g(A,P,M){const V=Xh(P);if(!V)throw new Error("header name must be a non-empty string");const j=le.findKey(_,V);(!j||_[j]===void 0||M===!0||M===void 0&&_[j]!==!1)&&(_[j||P]=oE(A))}const C=(A,P)=>le.forEach(A,(M,V)=>g(M,V,P));if(le.isPlainObject(s)||s instanceof this.constructor)C(s,d);else if(le.isString(s)&&(s=s.trim())&&!Sre(s))C(Ere(s),d);else if(le.isHeaders(s))for(const[A,P]of s.entries())g(P,A,h);else s!=null&&g(d,s,h);return this}get(s,d){if(s=Xh(s),s){const h=le.findKey(this,s);if(h){const _=this[h];if(!d)return _;if(d===!0)return gre(_);if(le.isFunction(d))return d.call(this,_,h);if(le.isRegExp(d))return d.exec(_);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,d){if(s=Xh(s),s){const h=le.findKey(this,s);return!!(h&&this[h]!==void 0&&(!d||bC(this,this[h],h,d)))}return!1}delete(s,d){const h=this;let _=!1;function g(C){if(C=Xh(C),C){const A=le.findKey(h,C);A&&(!d||bC(h,h[A],A,d))&&(delete h[A],_=!0)}}return le.isArray(s)?s.forEach(g):g(s),_}clear(s){const d=Object.keys(this);let h=d.length,_=!1;for(;h--;){const g=d[h];(!s||bC(this,this[g],g,s,!0))&&(delete this[g],_=!0)}return _}normalize(s){const d=this,h={};return le.forEach(this,(_,g)=>{const C=le.findKey(h,g);if(C){d[C]=oE(_),delete d[g];return}const A=s?Tre(g):String(g).trim();A!==g&&delete d[g],d[A]=oE(_),h[A]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const d=Object.create(null);return le.forEach(this,(h,_)=>{h!=null&&h!==!1&&(d[_]=s&&le.isArray(h)?h.join(", "):h)}),d}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,d])=>s+": "+d).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...d){const h=new this(s);return d.forEach(_=>h.set(_)),h}static accessor(s){const h=(this[JU]=this[JU]={accessors:{}}).accessors,_=this.prototype;function g(C){const A=Xh(C);h[A]||(vre(_,C),h[A]=!0)}return le.isArray(s)?s.forEach(g):g(s),this}}yi.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);le.reduceDescriptors(yi.prototype,({value:o},s)=>{let d=s[0].toUpperCase()+s.slice(1);return{get:()=>o,set(h){this[d]=h}}});le.freezeMethods(yi);function AC(o,s){const d=this||Kp,h=s||d,_=yi.from(h.headers);let g=h.data;return le.forEach(o,function(A){g=A.call(d,g,_.normalize(),s?s.status:void 0)}),_.normalize(),g}function d4(o){return!!(o&&o.__CANCEL__)}function Tu(o,s,d){vt.call(this,o??"canceled",vt.ERR_CANCELED,s,d),this.name="CanceledError"}le.inherits(Tu,vt,{__CANCEL__:!0});function l4(o,s,d){const h=d.config.validateStatus;!d.status||!h||h(d.status)?o(d):s(new vt("Request failed with status code "+d.status,[vt.ERR_BAD_REQUEST,vt.ERR_BAD_RESPONSE][Math.floor(d.status/100)-4],d.config,d.request,d))}function yre(o){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return s&&s[1]||""}function Cre(o,s){o=o||10;const d=new Array(o),h=new Array(o);let _=0,g=0,C;return s=s!==void 0?s:1e3,function(P){const M=Date.now(),V=h[g];C||(C=M),d[_]=P,h[_]=M;let j=g,G=0;for(;j!==_;)G+=d[j++],j=j%o;if(_=(_+1)%o,_===g&&(g=(g+1)%o),M-C<s)return;const Z=V&&M-V;return Z?Math.round(G*1e3/Z):void 0}}function Rre(o,s){let d=0;const h=1e3/s;let _=null;return function(){const C=this===!0,A=Date.now();if(C||A-d>h)return _&&(clearTimeout(_),_=null),d=A,o.apply(null,arguments);_||(_=setTimeout(()=>(_=null,d=Date.now(),o.apply(null,arguments)),h-(A-d)))}}const UE=(o,s,d=3)=>{let h=0;const _=Cre(50,250);return Rre(g=>{const C=g.loaded,A=g.lengthComputable?g.total:void 0,P=C-h,M=_(P),V=C<=A;h=C;const j={loaded:C,total:A,progress:A?C/A:void 0,bytes:P,rate:M||void 0,estimated:M&&A&&V?(A-C)/M:void 0,event:g,lengthComputable:A!=null};j[s?"download":"upload"]=!0,o(j)},d)},wre=zo.hasStandardBrowserEnv?function(){const s=/(msie|trident)/i.test(navigator.userAgent),d=document.createElement("a");let h;function _(g){let C=g;return s&&(d.setAttribute("href",C),C=d.href),d.setAttribute("href",C),{href:d.href,protocol:d.protocol?d.protocol.replace(/:$/,""):"",host:d.host,search:d.search?d.search.replace(/^\?/,""):"",hash:d.hash?d.hash.replace(/^#/,""):"",hostname:d.hostname,port:d.port,pathname:d.pathname.charAt(0)==="/"?d.pathname:"/"+d.pathname}}return h=_(window.location.href),function(C){const A=le.isString(C)?_(C):C;return A.protocol===h.protocol&&A.host===h.host}}():function(){return function(){return!0}}(),Ire=zo.hasStandardBrowserEnv?{write(o,s,d,h,_,g){const C=[o+"="+encodeURIComponent(s)];le.isNumber(d)&&C.push("expires="+new Date(d).toGMTString()),le.isString(h)&&C.push("path="+h),le.isString(_)&&C.push("domain="+_),g===!0&&C.push("secure"),document.cookie=C.join("; ")},read(o){const s=document.cookie.match(new RegExp("(^|;\\s*)("+o+")=([^;]*)"));return s?decodeURIComponent(s[3]):null},remove(o){this.write(o,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function bre(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}function Are(o,s){return s?o.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):o}function u4(o,s){return o&&!bre(s)?Are(o,s):s}const XU=o=>o instanceof yi?{...o}:o;function _d(o,s){s=s||{};const d={};function h(M,V,j){return le.isPlainObject(M)&&le.isPlainObject(V)?le.merge.call({caseless:j},M,V):le.isPlainObject(V)?le.merge({},V):le.isArray(V)?V.slice():V}function _(M,V,j){if(le.isUndefined(V)){if(!le.isUndefined(M))return h(void 0,M,j)}else return h(M,V,j)}function g(M,V){if(!le.isUndefined(V))return h(void 0,V)}function C(M,V){if(le.isUndefined(V)){if(!le.isUndefined(M))return h(void 0,M)}else return h(void 0,V)}function A(M,V,j){if(j in s)return h(M,V);if(j in o)return h(void 0,M)}const P={url:g,method:g,data:g,baseURL:C,transformRequest:C,transformResponse:C,paramsSerializer:C,timeout:C,timeoutMessage:C,withCredentials:C,withXSRFToken:C,adapter:C,responseType:C,xsrfCookieName:C,xsrfHeaderName:C,onUploadProgress:C,onDownloadProgress:C,decompress:C,maxContentLength:C,maxBodyLength:C,beforeRedirect:C,transport:C,httpAgent:C,httpsAgent:C,cancelToken:C,socketPath:C,responseEncoding:C,validateStatus:A,headers:(M,V)=>_(XU(M),XU(V),!0)};return le.forEach(Object.keys(Object.assign({},o,s)),function(V){const j=P[V]||_,G=j(o[V],s[V],V);le.isUndefined(G)&&j!==A||(d[V]=G)}),d}const h4=o=>{const s=_d({},o);let{data:d,withXSRFToken:h,xsrfHeaderName:_,xsrfCookieName:g,headers:C,auth:A}=s;s.headers=C=yi.from(C),s.url=s4(u4(s.baseURL,s.url),o.params,o.paramsSerializer),A&&C.set("Authorization","Basic "+btoa((A.username||"")+":"+(A.password?unescape(encodeURIComponent(A.password)):"")));let P;if(le.isFormData(d)){if(zo.hasStandardBrowserEnv||zo.hasStandardBrowserWebWorkerEnv)C.setContentType(void 0);else if((P=C.getContentType())!==!1){const[M,...V]=P?P.split(";").map(j=>j.trim()).filter(Boolean):[];C.setContentType([M||"multipart/form-data",...V].join("; "))}}if(zo.hasStandardBrowserEnv&&(h&&le.isFunction(h)&&(h=h(s)),h||h!==!1&&wre(s.url))){const M=_&&g&&Ire.read(g);M&&C.set(_,M)}return s},Ore=typeof XMLHttpRequest<"u",Nre=Ore&&function(o){return new Promise(function(d,h){const _=h4(o);let g=_.data;const C=yi.from(_.headers).normalize();let{responseType:A}=_,P;function M(){_.cancelToken&&_.cancelToken.unsubscribe(P),_.signal&&_.signal.removeEventListener("abort",P)}let V=new XMLHttpRequest;V.open(_.method.toUpperCase(),_.url,!0),V.timeout=_.timeout;function j(){if(!V)return;const Z=yi.from("getAllResponseHeaders"in V&&V.getAllResponseHeaders()),$={data:!A||A==="text"||A==="json"?V.responseText:V.response,status:V.status,statusText:V.statusText,headers:Z,config:o,request:V};l4(function(K){d(K),M()},function(K){h(K),M()},$),V=null}"onloadend"in V?V.onloadend=j:V.onreadystatechange=function(){!V||V.readyState!==4||V.status===0&&!(V.responseURL&&V.responseURL.indexOf("file:")===0)||setTimeout(j)},V.onabort=function(){V&&(h(new vt("Request aborted",vt.ECONNABORTED,_,V)),V=null)},V.onerror=function(){h(new vt("Network Error",vt.ERR_NETWORK,_,V)),V=null},V.ontimeout=function(){let z=_.timeout?"timeout of "+_.timeout+"ms exceeded":"timeout exceeded";const $=_.transitional||a4;_.timeoutErrorMessage&&(z=_.timeoutErrorMessage),h(new vt(z,$.clarifyTimeoutError?vt.ETIMEDOUT:vt.ECONNABORTED,_,V)),V=null},g===void 0&&C.setContentType(null),"setRequestHeader"in V&&le.forEach(C.toJSON(),function(z,$){V.setRequestHeader($,z)}),le.isUndefined(_.withCredentials)||(V.withCredentials=!!_.withCredentials),A&&A!=="json"&&(V.responseType=_.responseType),typeof _.onDownloadProgress=="function"&&V.addEventListener("progress",UE(_.onDownloadProgress,!0)),typeof _.onUploadProgress=="function"&&V.upload&&V.upload.addEventListener("progress",UE(_.onUploadProgress)),(_.cancelToken||_.signal)&&(P=Z=>{V&&(h(!Z||Z.type?new Tu(null,o,V):Z),V.abort(),V=null)},_.cancelToken&&_.cancelToken.subscribe(P),_.signal&&(_.signal.aborted?P():_.signal.addEventListener("abort",P)));const G=yre(_.url);if(G&&zo.protocols.indexOf(G)===-1){h(new vt("Unsupported protocol "+G+":",vt.ERR_BAD_REQUEST,o));return}V.send(g||null)})},Dre=(o,s)=>{let d=new AbortController,h;const _=function(P){if(!h){h=!0,C();const M=P instanceof Error?P:this.reason;d.abort(M instanceof vt?M:new Tu(M instanceof Error?M.message:M))}};let g=s&&setTimeout(()=>{_(new vt(`timeout ${s} of ms exceeded`,vt.ETIMEDOUT))},s);const C=()=>{o&&(g&&clearTimeout(g),g=null,o.forEach(P=>{P&&(P.removeEventListener?P.removeEventListener("abort",_):P.unsubscribe(_))}),o=null)};o.forEach(P=>P&&P.addEventListener&&P.addEventListener("abort",_));const{signal:A}=d;return A.unsubscribe=C,[A,()=>{g&&clearTimeout(g),g=null}]},Pre=function*(o,s){let d=o.byteLength;if(!s||d<s){yield o;return}let h=0,_;for(;h<d;)_=h+s,yield o.slice(h,_),h=_},Lre=async function*(o,s,d){for await(const h of o)yield*Pre(ArrayBuffer.isView(h)?h:await d(String(h)),s)},QU=(o,s,d,h,_)=>{const g=Lre(o,s,_);let C=0;return new ReadableStream({type:"bytes",async pull(A){const{done:P,value:M}=await g.next();if(P){A.close(),h();return}let V=M.byteLength;d&&d(C+=V),A.enqueue(new Uint8Array(M))},cancel(A){return h(A),g.return()}},{highWaterMark:2})},ZU=(o,s)=>{const d=o!=null;return h=>setTimeout(()=>s({lengthComputable:d,total:o,loaded:h}))},ag=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",p4=ag&&typeof ReadableStream=="function",P0=ag&&(typeof TextEncoder=="function"?(o=>s=>o.encode(s))(new TextEncoder):async o=>new Uint8Array(await new Response(o).arrayBuffer())),kre=p4&&(()=>{let o=!1;const s=new Request(zo.origin,{body:new ReadableStream,method:"POST",get duplex(){return o=!0,"half"}}).headers.has("Content-Type");return o&&!s})(),$U=64*1024,L0=p4&&!!(()=>{try{return le.isReadableStream(new Response("").body)}catch{}})(),jE={stream:L0&&(o=>o.body)};ag&&(o=>{["text","arrayBuffer","blob","formData","stream"].forEach(s=>{!jE[s]&&(jE[s]=le.isFunction(o[s])?d=>d[s]():(d,h)=>{throw new vt(`Response type '${s}' is not supported`,vt.ERR_NOT_SUPPORT,h)})})})(new Response);const Mre=async o=>{if(o==null)return 0;if(le.isBlob(o))return o.size;if(le.isSpecCompliantForm(o))return(await new Request(o).arrayBuffer()).byteLength;if(le.isArrayBufferView(o))return o.byteLength;if(le.isURLSearchParams(o)&&(o=o+""),le.isString(o))return(await P0(o)).byteLength},xre=async(o,s)=>{const d=le.toFiniteNumber(o.getContentLength());return d??Mre(s)},Ure=ag&&(async o=>{let{url:s,method:d,data:h,signal:_,cancelToken:g,timeout:C,onDownloadProgress:A,onUploadProgress:P,responseType:M,headers:V,withCredentials:j="same-origin",fetchOptions:G}=h4(o);M=M?(M+"").toLowerCase():"text";let[Z,z]=_||g||C?Dre([_,g],C):[],$,pe;const K=()=>{!$&&setTimeout(()=>{Z&&Z.unsubscribe()}),$=!0};let H;try{if(P&&kre&&d!=="get"&&d!=="head"&&(H=await xre(V,h))!==0){let Le=new Request(s,{method:"POST",body:h,duplex:"half"}),Pe;le.isFormData(h)&&(Pe=Le.headers.get("content-type"))&&V.setContentType(Pe),Le.body&&(h=QU(Le.body,$U,ZU(H,UE(P)),null,P0))}le.isString(j)||(j=j?"cors":"omit"),pe=new Request(s,{...G,signal:Z,method:d.toUpperCase(),headers:V.normalize().toJSON(),body:h,duplex:"half",withCredentials:j});let Y=await fetch(pe);const ae=L0&&(M==="stream"||M==="response");if(L0&&(A||ae)){const Le={};["status","statusText","headers"].forEach(We=>{Le[We]=Y[We]});const Pe=le.toFiniteNumber(Y.headers.get("content-length"));Y=new Response(QU(Y.body,$U,A&&ZU(Pe,UE(A,!0)),ae&&K,P0),Le)}M=M||"text";let Ae=await jE[le.findKey(jE,M)||"text"](Y,o);return!ae&&K(),z&&z(),await new Promise((Le,Pe)=>{l4(Le,Pe,{data:Ae,headers:yi.from(Y.headers),status:Y.status,statusText:Y.statusText,config:o,request:pe})})}catch(Y){throw K(),Y&&Y.name==="TypeError"&&/fetch/i.test(Y.message)?Object.assign(new vt("Network Error",vt.ERR_NETWORK,o,pe),{cause:Y.cause||Y}):vt.from(Y,Y&&Y.code,o,pe)}}),k0={http:ere,xhr:Nre,fetch:Ure};le.forEach(k0,(o,s)=>{if(o){try{Object.defineProperty(o,"name",{value:s})}catch{}Object.defineProperty(o,"adapterName",{value:s})}});const ej=o=>`- ${o}`,jre=o=>le.isFunction(o)||o===null||o===!1,f4={getAdapter:o=>{o=le.isArray(o)?o:[o];const{length:s}=o;let d,h;const _={};for(let g=0;g<s;g++){d=o[g];let C;if(h=d,!jre(d)&&(h=k0[(C=String(d)).toLowerCase()],h===void 0))throw new vt(`Unknown adapter '${C}'`);if(h)break;_[C||"#"+g]=h}if(!h){const g=Object.entries(_).map(([A,P])=>`adapter ${A} `+(P===!1?"is not supported by the environment":"is not available in the build"));let C=s?g.length>1?`since :
`+g.map(ej).join(`
`):" "+ej(g[0]):"as no adapter specified";throw new vt("There is no suitable adapter to dispatch the request "+C,"ERR_NOT_SUPPORT")}return h},adapters:k0};function OC(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new Tu(null,o)}function tj(o){return OC(o),o.headers=yi.from(o.headers),o.data=AC.call(o,o.transformRequest),["post","put","patch"].indexOf(o.method)!==-1&&o.headers.setContentType("application/x-www-form-urlencoded",!1),f4.getAdapter(o.adapter||Kp.adapter)(o).then(function(h){return OC(o),h.data=AC.call(o,o.transformResponse,h),h.headers=yi.from(h.headers),h},function(h){return d4(h)||(OC(o),h&&h.response&&(h.response.data=AC.call(o,o.transformResponse,h.response),h.response.headers=yi.from(h.response.headers))),Promise.reject(h)})}const m4="1.7.2",VR={};["object","boolean","number","function","string","symbol"].forEach((o,s)=>{VR[o]=function(h){return typeof h===o||"a"+(s<1?"n ":" ")+o}});const nj={};VR.transitional=function(s,d,h){function _(g,C){return"[Axios v"+m4+"] Transitional option '"+g+"'"+C+(h?". "+h:"")}return(g,C,A)=>{if(s===!1)throw new vt(_(C," has been removed"+(d?" in "+d:"")),vt.ERR_DEPRECATED);return d&&!nj[C]&&(nj[C]=!0,console.warn(_(C," has been deprecated since v"+d+" and will be removed in the near future"))),s?s(g,C,A):!0}};function Vre(o,s,d){if(typeof o!="object")throw new vt("options must be an object",vt.ERR_BAD_OPTION_VALUE);const h=Object.keys(o);let _=h.length;for(;_-- >0;){const g=h[_],C=s[g];if(C){const A=o[g],P=A===void 0||C(A,g,o);if(P!==!0)throw new vt("option "+g+" must be "+P,vt.ERR_BAD_OPTION_VALUE);continue}if(d!==!0)throw new vt("Unknown option "+g,vt.ERR_BAD_OPTION)}}const M0={assertOptions:Vre,validators:VR},Ba=M0.validators;class dd{constructor(s){this.defaults=s,this.interceptors={request:new qU,response:new qU}}async request(s,d){try{return await this._request(s,d)}catch(h){if(h instanceof Error){let _;Error.captureStackTrace?Error.captureStackTrace(_={}):_=new Error;const g=_.stack?_.stack.replace(/^.+\n/,""):"";try{h.stack?g&&!String(h.stack).endsWith(g.replace(/^.+\n.+\n/,""))&&(h.stack+=`
`+g):h.stack=g}catch{}}throw h}}_request(s,d){typeof s=="string"?(d=d||{},d.url=s):d=s||{},d=_d(this.defaults,d);const{transitional:h,paramsSerializer:_,headers:g}=d;h!==void 0&&M0.assertOptions(h,{silentJSONParsing:Ba.transitional(Ba.boolean),forcedJSONParsing:Ba.transitional(Ba.boolean),clarifyTimeoutError:Ba.transitional(Ba.boolean)},!1),_!=null&&(le.isFunction(_)?d.paramsSerializer={serialize:_}:M0.assertOptions(_,{encode:Ba.function,serialize:Ba.function},!0)),d.method=(d.method||this.defaults.method||"get").toLowerCase();let C=g&&le.merge(g.common,g[d.method]);g&&le.forEach(["delete","get","head","post","put","patch","common"],z=>{delete g[z]}),d.headers=yi.concat(C,g);const A=[];let P=!0;this.interceptors.request.forEach(function($){typeof $.runWhen=="function"&&$.runWhen(d)===!1||(P=P&&$.synchronous,A.unshift($.fulfilled,$.rejected))});const M=[];this.interceptors.response.forEach(function($){M.push($.fulfilled,$.rejected)});let V,j=0,G;if(!P){const z=[tj.bind(this),void 0];for(z.unshift.apply(z,A),z.push.apply(z,M),G=z.length,V=Promise.resolve(d);j<G;)V=V.then(z[j++],z[j++]);return V}G=A.length;let Z=d;for(j=0;j<G;){const z=A[j++],$=A[j++];try{Z=z(Z)}catch(pe){$.call(this,pe);break}}try{V=tj.call(this,Z)}catch(z){return Promise.reject(z)}for(j=0,G=M.length;j<G;)V=V.then(M[j++],M[j++]);return V}getUri(s){s=_d(this.defaults,s);const d=u4(s.baseURL,s.url);return s4(d,s.params,s.paramsSerializer)}}le.forEach(["delete","get","head","options"],function(s){dd.prototype[s]=function(d,h){return this.request(_d(h||{},{method:s,url:d,data:(h||{}).data}))}});le.forEach(["post","put","patch"],function(s){function d(h){return function(g,C,A){return this.request(_d(A||{},{method:s,headers:h?{"Content-Type":"multipart/form-data"}:{},url:g,data:C}))}}dd.prototype[s]=d(),dd.prototype[s+"Form"]=d(!0)});class FR{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let d;this.promise=new Promise(function(g){d=g});const h=this;this.promise.then(_=>{if(!h._listeners)return;let g=h._listeners.length;for(;g-- >0;)h._listeners[g](_);h._listeners=null}),this.promise.then=_=>{let g;const C=new Promise(A=>{h.subscribe(A),g=A}).then(_);return C.cancel=function(){h.unsubscribe(g)},C},s(function(g,C,A){h.reason||(h.reason=new Tu(g,C,A),d(h.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const d=this._listeners.indexOf(s);d!==-1&&this._listeners.splice(d,1)}static source(){let s;return{token:new FR(function(_){s=_}),cancel:s}}}function Fre(o){return function(d){return o.apply(null,d)}}function Bre(o){return le.isObject(o)&&o.isAxiosError===!0}const x0={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(x0).forEach(([o,s])=>{x0[s]=o});function _4(o){const s=new dd(o),d=q5(dd.prototype.request,s);return le.extend(d,dd.prototype,s,{allOwnKeys:!0}),le.extend(d,s,null,{allOwnKeys:!0}),d.create=function(_){return _4(_d(o,_))},d}const Vn=_4(Kp);Vn.Axios=dd;Vn.CanceledError=Tu;Vn.CancelToken=FR;Vn.isCancel=d4;Vn.VERSION=m4;Vn.toFormData=sg;Vn.AxiosError=vt;Vn.Cancel=Vn.CanceledError;Vn.all=function(s){return Promise.all(s)};Vn.spread=Fre;Vn.isAxiosError=Bre;Vn.mergeConfig=_d;Vn.AxiosHeaders=yi;Vn.formToJSON=o=>c4(le.isHTMLForm(o)?new FormData(o):o);Vn.getAdapter=f4.getAdapter;Vn.HttpStatusCode=x0;Vn.default=Vn;const Wre=()=>{const[o,s]=ve.useState([]);return ve.useEffect(()=>{Vn.get(`${ac.API_BASE_URL}/api/v1/videos`).then(d=>{s(d.data)}).catch(d=>{console.error("There was an error fetching the videos!",d)})},[]),N.jsxs("div",{children:[N.jsx("h1",{children:"All Videos"}),N.jsxs("table",{children:[N.jsx("thead",{children:N.jsxs("tr",{children:[N.jsx("th",{children:"ID"}),N.jsx("th",{children:"Title"}),N.jsx("th",{children:"Url Link"}),N.jsx("th",{children:"User ID"}),N.jsx("th",{children:"Created At"}),N.jsx("th",{children:"Is Critical?"})]})}),N.jsx("tbody",{children:o.map(d=>N.jsxs("tr",{children:[N.jsx("td",{children:d.id}),N.jsx("td",{children:d.title}),N.jsx("td",{children:N.jsx("a",{href:d.file_path,children:d.file_path})}),N.jsx("td",{children:d.user_id}),N.jsx("td",{children:new Date(d.created_at).toLocaleString()}),N.jsx("td",{children:d.is_critical?"Yes":"No"})]},d.id))})]})]})},Gre="1297c1a58c0a4f40a55d1f1f7c52b7cd",Hre="007eJxTYEg/ri4k+nW6eEZt6PHK+pJD7j7LJ+tmTTer9Z/g2t44L1uBwdDI0jzZMNHUItkg0STNxCDR1DTFMM0wzTzZ1CjJPDlFznRhWkMgI4P6/5esjAwQCOKzMSQlVuYmVjAwAAALex71",Kre="baymax",zre=({videos:o})=>{const[s,d]=ve.useState({client:null,remoteUsers:{},streamingCount:0,displayCount:0,mediaRecorder:null,recordedChunks:[]});ve.useEffect(()=>{(async()=>{const C=Jl.createClient({mode:"live",codec:"vp8"});await C.join(Gre,Kre,Hre,null),C.on("user-published",async(A,P)=>{if(P==="video"){await C.subscribe(A,P);const M=A.videoTrack;d(j=>{const G=j.displayCount+1,Z={...j.remoteUsers,[A.uid]:A},z=j.streamingCount+1;return{...j,displayCount:G,remoteUsers:Z,streamingCount:z}});const V=document.createElement("div");V.classList.add("card","mt-4","col-md-6"),V.id=`camera-${A.uid}`,V.innerHTML=`
            <div class="card-body text-center">
              <h1 class="card-title">Camera ${s.displayCount}</h1>
              <div id="camera-${A.uid}-preview" style="width: 320px; height: 240px;"></div>
              <p class="card-text">UID: ${A.uid}</p>
              <a href="/camera_broadcast" class="btn btn-primary btn-lg">Watch Live</a>
            </div>
          `,document.getElementById("camera-list").appendChild(V),M.play(`camera-${A.uid}-preview`,{fit:"contain",muted:!1})}}),C.on("user-unpublished",A=>{const P=document.getElementById(`camera-${A.uid}`);P&&P.remove(),d(M=>{const V={...M.remoteUsers};delete V[A.uid];const j=M.streamingCount-1;return{...M,remoteUsers:V,streamingCount:j}})}),d(A=>({...A,client:C}))})()},[]);const h=()=>{const g=new MediaStream;for(let A in s.remoteUsers){const P=s.remoteUsers[A];if(P.videoTrack){const M=P.videoTrack.getMediaStreamTrack();g.addTrack(M)}}const C=new MediaRecorder(g,{mimeType:"video/webm;codecs=vp9"});C.ondataavailable=A=>{A.data.size>0&&d(P=>({...P,recordedChunks:[...P.recordedChunks,A.data]}))},C.onstop=async()=>{const A=new Blob(s.recordedChunks,{type:"video/webm"}),P=new FormData;P.append("video[title]",`Recording ${new Date().toLocaleString()}`),P.append("video[file]",A,`recording_${new Date().toISOString().replace(/[:.]/g,"-")}.webm`);for(let[V,j]of P.entries())console.log(`${V}: ${j}`);const M=document.querySelector('meta[name="csrf-token"]').getAttribute("content");await fetch("/videos",{method:"POST",headers:{"X-CSRF-Token":M},body:P}),setTimeout(()=>{window.location.reload()},5e3)},C.start(),d(A=>({...A,mediaRecorder:C})),document.getElementById("start-recording").disabled=!0,document.getElementById("stop-recording").disabled=!1},_=()=>{s.mediaRecorder.stop(),document.getElementById("start-recording").disabled=!1,document.getElementById("stop-recording").disabled=!0};return N.jsxs("div",{className:"container mx-auto mt-5",children:[N.jsx("h1",{className:"text-3xl font-bold",children:"Video Recording"}),N.jsx("div",{id:"camera-list",className:"grid grid-cols-1 md:grid-cols-2 gap-4"}),N.jsx("div",{className:"mt-4",children:N.jsxs("h2",{className:"text-xl",children:["Total Streaming Devices: ",N.jsx("span",{id:"streaming-count",children:s.streamingCount})]})}),N.jsx("button",{id:"start-recording",className:"btn btn-success mt-4",onClick:h,children:"Start Recording"}),N.jsx("button",{id:"stop-recording",className:"btn btn-error mt-4 ml-4",onClick:_,disabled:!0,children:"Stop Recording"}),N.jsx("h2",{className:"mt-10 text-2xl",children:"Uploaded Videos"}),N.jsx("ul",{className:"mt-4",children:o&&o.length>0?o.map(g=>N.jsxs("li",{className:"mb-4",children:[N.jsx("h3",{className:"text-lg font-semibold",children:g.title}),g.file.attached?N.jsxs("video",{controls:!0,className:"w-full max-w-md",children:[N.jsx("source",{src:g.file.url,type:"video/webm"}),"Your browser does not support the video tag."]}):N.jsx("p",{children:"No video available"})]},g.id)):N.jsx("p",{children:"No videos availabledddd"})}),N.jsx(Wre,{})]})},Yre=({id:o,title:s,time:d,isCritical:h,file_path:_,onEdit:g,onDelete:C})=>{const[A,P]=ve.useState(!1),M=To(),V=()=>{P(!A)},j=()=>{P(!1),g(o)},G=()=>{P(!1),C(o)},Z=()=>{M(`/video/${encodeURIComponent(s)}/${encodeURIComponent(_)}`)};return N.jsxs("div",{className:`cursor-pointer flex items-center justify-between bg-neutral px-3 py-4 mb-2 rounded-lg shadow ${h?"border-2 border-red-500":"bg-gray-100"}`,children:[N.jsxs("div",{className:"flex items-center",children:[N.jsx("div",{className:"w-24 h-14 bg-gray-300 rounded mr-4"}),N.jsxs("div",{onClick:Z,children:[N.jsx("h2",{className:"",children:s}),N.jsx("p",{className:"text-sm text-gray-600",children:d})]})]}),N.jsxs("div",{className:"relative flex items-center",children:[h&&N.jsx(qee,{className:"text-red-500 mr-4"}),N.jsxs("div",{className:"text-gray-600",onClick:V,children:[N.jsx(M5,{}),A&&N.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white border rounded shadow-lg",children:[N.jsx("button",{className:"block w-full text-left px-4 py-2 text-gray-800 hover:bg-gray-100",onClick:j,children:"Edit"}),N.jsx("button",{className:"block w-full text-left px-4 py-2 text-gray-800 hover:bg-gray-100",onClick:G,children:"Delete"})]})]})]})]})},qre=()=>{const[o,s]=ve.useState([]),[d,h]=ve.useState("desc"),[_,g]=ve.useState(!1),[C,A]=ve.useState(null),[P,M]=ve.useState({title:"",file_path:"",duration:"",is_critical:!1,user_id:""});console.log(localStorage.getItem("user-data")),ve.useEffect(()=>{Vn.get(`${ac.API_BASE_URL}/api/v1/videos`).then(K=>{s(K.data)}).catch(K=>{console.error("There was an error fetching the videos!",K)})},[]);const V=[...o].sort((K,H)=>{const Y=new Date(K.created_at),ae=new Date(H.created_at);return d==="asc"?Y-ae:ae-Y}),j=()=>{h(K=>K==="asc"?"desc":"asc")},G=K=>{const H=o.find(Y=>Y.id===K);A(H),M({title:H.title||"",file_path:H.file_path||"",duration:H.duration||"",is_critical:H.is_critical||!1,user_id:H.user_id||""}),g(!0),console.log("Modal should open, "+_)},Z=K=>{Vn.delete(`${ac.API_BASE_URL}/api/v1/videos/${K}`).then(H=>{s(o.filter(Y=>Y.id!==K))}).catch(H=>{console.error("There was an error deleting the video!",H)})},z=K=>{const{name:H,value:Y,type:ae,checked:Ae}=K.target;M(Le=>({...Le,[H]:ae==="checkbox"?Ae:Y}))},$=K=>{K.preventDefault(),Vn.put(`http://localhost:3000/api/v1/videos/${C.id}`,P).then(H=>{s(o.map(Y=>Y.id===C.id?H.data:Y)),g(!1),A(null)}).catch(H=>{console.error("There was an error updating the video!",H)})},pe=()=>{g(!1),A(null)};return N.jsx("div",{className:"flex flex-col items-center",children:N.jsxs("div",{className:"items-center rounded-lg p-6",children:[N.jsxs("div",{className:"flex-grow overflow-auto p-4",children:[N.jsx("h1",{className:"text-2xl text-primary font-bold mb-4",children:"History"}),N.jsxs("div",{className:"flex justify-between items-center pt-2 mb-4",children:[N.jsx("span",{className:"text-gray-600",children:"All"}),N.jsxs("button",{onClick:j,className:"text-gray-600",children:["Sort By: Date (",d==="asc"?"Ascending":"Descending",")"]})]}),V.map(K=>N.jsx("div",{className:"mb-4",children:N.jsx(Yre,{id:K.id,title:K.title,time:new Date(K.created_at).toLocaleString(),isCritical:K.is_critical,file_path:K.file_path,onEdit:G,onDelete:Z})},K.id))]}),N.jsx(_u,{}),N.jsx(cne,{isOpen:_,onRequestClose:pe,contentLabel:"Edit Video",className:"modal",overlayClassName:"overlay",ariaHideApp:!1,children:C&&N.jsxs("div",{children:[N.jsx("h2",{children:"Edit Video"}),N.jsxs("form",{onSubmit:$,children:[N.jsxs("div",{children:[N.jsx("label",{children:"Title:"}),N.jsx("input",{type:"text",name:"title",value:P.title,onChange:z,className:"border p-1"})]}),N.jsxs("div",{children:[N.jsx("label",{children:"File Path:"}),N.jsx("input",{type:"text",name:"file_path",value:P.file_path,onChange:z,className:"border p-1"})]}),N.jsxs("div",{children:[N.jsx("label",{children:"Duration:"}),N.jsx("input",{type:"number",name:"duration",value:P.duration,onChange:z,className:"border p-1"})]}),N.jsx("div",{children:N.jsxs("label",{children:[N.jsx("input",{type:"checkbox",name:"is_critical",checked:P.is_critical,onChange:z}),"Critical"]})}),N.jsxs("div",{children:[N.jsx("label",{children:"User ID:"}),N.jsx("input",{type:"text",name:"user_id",value:P.user_id,onChange:z,className:"border p-1"})]}),N.jsx("button",{type:"submit",className:"bg-blue-500 text-white p-2 mt-2",children:"Save"}),N.jsx("button",{onClick:pe,className:"bg-gray-500 text-white p-2 mt-2 ml-2",children:"Cancel"})]})]})})]})})},Jre=()=>{const{filePath:o,title:s}=w5(),d=To();return N.jsx("div",{className:"min-h-screen flex items-center justify-center bg-base-100 font-ubuntu",children:N.jsxs("div",{className:"relative w-full max-w-sm p-6 bg-white rounded-lg shadow-lg",children:[N.jsx("button",{className:"absolute top-4 left-4 text-gray-700",onClick:()=>d("/histories"),children:N.jsx("svg",{className:"h-6 w-6 m-4 mt-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:N.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),N.jsx("div",{className:"text-center",children:N.jsx("h2",{className:"mt-4 text-xl font-extrabold text-gray-900",children:s})}),N.jsx("div",{className:"mt-16 bg-gray-100 rounded-lg w-full h-40 flex items-center justify-center",children:N.jsx("div",{className:"video-player flex items-center justify-center mt-4",children:N.jsxs("video",{controls:!0,children:[N.jsx("source",{src:o,type:"video/mp4"}),"Your browser does not support the video tag."]})})}),N.jsxs("div",{className:"mt-20 bg-gray-100 rounded-lg w-full h-12 flex items-center justify-center",children:[N.jsx("button",{className:"mx-2",children:N.jsx("svg",{className:"h-6 w-6 text-gray-700",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:N.jsx("path",{fillRule:"evenodd",d:"M5 8a3 3 0 00-3 3v3a3 3 0 003 3h5a3 3 0 003-3V9H8.5V4H8a1 1 0 00-1 1v3H5zM4 8H2V7a1 1 0 011-1h1v2z",clipRule:"evenodd"})})}),N.jsx("button",{className:"mx-2",children:N.jsx("svg",{className:"h-6 w-6 text-gray-700",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:N.jsx("path",{fillRule:"evenodd",d:"M15 12a3 3 0 01-3 3H7a3 3 0 01-3-3V9a3 3 0 013-3h5a3 3 0 013 3v3zM16 11h2V9a1 1 0 00-1-1h-1v3z",clipRule:"evenodd"})})})]}),N.jsxs("div",{className:"mt-4",children:[N.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Currently:"}),N.jsxs("p",{className:"mt-2 text-gray-600",children:["90% Chance of Crying",N.jsx("br",{}),"Immediate Attention needed!",N.jsx("br",{}),"Duration: 6mins"]})]})]})})};function Xre(){const[o,s]=ve.useState({username:"",password:""}),[d,h]=ve.useState(""),_=To(),g=P=>{const{name:M,value:V}=P.target;s({...o,[M]:V})},C=P=>{localStorage.setItem("camera-data",JSON.stringify(P)),_("/camera-home",{state:{cameraData:P}})},A=async P=>{P.preventDefault(),h(""),console.log("Form submitted:",o),console.log("Username:",o.username),console.log("Password",o.password);try{const M=await fetch(`${ac.API_BASE_URL}/api/v1/sessions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:o.username,email:o.username,password:o.password})}),V=await M.json();console.log("data: ",V),M.ok?(console.log("User logged in successfully:",V),C(V)):h(V.message)}catch{h("An error occurred. Please try again.")}};return N.jsx("div",{className:"min-h-screen flex items-center justify-center bg-neutral font-ubuntu",children:N.jsxs("div",{className:"w-full max-w-md p-8 space-y-6 bg-base-100 shadow-lg rounded-lg",children:[N.jsxs("div",{className:"text-center",children:[N.jsx("img",{className:"mx-auto h-48 w-auto",src:"/logo.png",alt:"Crybaby"}),N.jsx("h2",{className:"mt-6 text-3xl font-extrabold text-gray-900",children:"crybaby"}),N.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Log in to your account"}),d&&N.jsx("p",{className:"text-red-500 text-center mt-4",children:d})]}),N.jsxs("form",{className:"mt-4 space-y-6",onSubmit:A,children:[N.jsxs("div",{className:"rounded-md shadow-sm -space-y-px",children:[N.jsxs("div",{children:[N.jsx("label",{htmlFor:"username",className:"sr-only",children:"Username"}),N.jsx("input",{id:"username",name:"username",type:"text",autoComplete:"username",required:!0,className:"appearance-none bg-white rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Username",value:o.username,onChange:g})]}),N.jsxs("div",{children:[N.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),N.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"my-4 appearance-none rounded-none bg-white relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Password",value:o.password,onChange:g})]})]}),N.jsx("div",{children:N.jsx("button",{type:"submit",className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-primary hover:bg-primary-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Login"})})]})]})})}function Qre(){var C,A;const o=To(),s=hc(),[d,h]=ve.useState(((C=s.state)==null?void 0:C.cameraData)||JSON.parse(localStorage.getItem("camera-data"))),_=((A=d==null?void 0:d.user)==null?void 0:A.cameras)||[];console.log(d);const g=P=>{console.log("Camera deets:",P),o(`/live/${P.id}`,{state:{cameraData:P}})};return N.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-base-100 font-ubuntu",children:[N.jsxs("div",{className:"text-center mb-8",children:[N.jsx("img",{className:"mx-auto h-36 w-auto",src:"/logo.png",alt:"Crybaby"}),N.jsx("h2",{className:"mt-6 text-2xl font-extrabold text-gray-900",children:"Your Available Cameras"})]}),N.jsx("div",{className:"carousel carousel-center rounded-box ",children:_.map(P=>N.jsxs("div",{className:"text-center carousel-item grid grid-cols-1 mx-4",children:[N.jsx("img",{src:"https://i.pinimg.com/736x/cb/b8/59/cbb859fac53e70d017e42d4b54e06861.jpg",alt:P.camera_name,className:"h-64 w-64 object-cover rounded-lg shadow-md cursor-pointer ",onClick:()=>g(P)}),N.jsx("p",{className:"mt-2 text-lg font-medium text-gray-900",children:P.camera_name})]},P.id))})]})}function Zre(){return N.jsx(Nee,{children:N.jsxs(Cee,{children:[N.jsx(Qr,{path:"/",element:N.jsx(kee,{})}),N.jsx(Qr,{path:"/user",element:N.jsx(jee,{})}),N.jsx(Qr,{path:"/live/:id",element:N.jsx(Vee,{})}),N.jsx(Qr,{path:"/camera/:id",element:N.jsx(mne,{})}),N.jsx(Qr,{path:"/user-home",element:N.jsx(lne,{})}),N.jsx(Qr,{path:"/profile",element:N.jsx(une,{})}),N.jsx(Qr,{path:"/profile/particulars",element:N.jsx(hne,{})}),N.jsx(Qr,{path:"/profile/accsettings",element:N.jsx(pne,{})}),N.jsx(Qr,{path:"/profile/editcams",element:N.jsx(fne,{})}),N.jsx(Qr,{path:"/vidrecord",element:N.jsx(zre,{})}),N.jsx(Qr,{path:"/histories",element:N.jsx(qre,{})}),N.jsx(Qr,{path:"/video/:title/:filePath",element:N.jsx(Jre,{})}),N.jsx(Qr,{path:"/camlogin",element:N.jsx(Xre,{})}),N.jsx(Qr,{path:"/camera-home",element:N.jsx(Qre,{})})]})})}const $re=_5(document.getElementById("root"));$re.render(N.jsx(qs.StrictMode,{children:N.jsx(Zre,{})}));
